{"categories":[{"title":"Chez","uri":"https://lvsq.net/categories/chez/"},{"title":"Emacs","uri":"https://lvsq.net/categories/emacs/"},{"title":"Erlang","uri":"https://lvsq.net/categories/erlang/"},{"title":"Golang","uri":"https://lvsq.net/categories/golang/"},{"title":"Java","uri":"https://lvsq.net/categories/java/"},{"title":"Leetcode","uri":"https://lvsq.net/categories/leetcode/"},{"title":"Lisp","uri":"https://lvsq.net/categories/lisp/"},{"title":"Pl","uri":"https://lvsq.net/categories/pl/"},{"title":"Racket","uri":"https://lvsq.net/categories/racket/"},{"title":"Scheme","uri":"https://lvsq.net/categories/scheme/"},{"title":"Science","uri":"https://lvsq.net/categories/science/"},{"title":"Tool","uri":"https://lvsq.net/categories/tool/"},{"title":"æ–‡å²","uri":"https://lvsq.net/categories/%E6%96%87%E5%8F%B2/"}],"posts":[{"content":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†å¾€å¾€è¯»å®Œå°±å¿˜è®°ï¼Œæˆ–è€…è®°ä½äº†å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯è½¬æ¢ä¸æˆèƒ½åŠ›ï¼Œæ‰è´¹äº†å¾ˆå¤šå¿ƒåŠ›å’Œæ—¶é—´ï¼Œæ‰€ä»¥è¯»ä¹¦æ–¹æ³•å°¤ä¸ºé‡è¦ã€‚æˆ‘è‡ªå°ä¹Ÿè¯»è¿‡ä¸€äº›ä¹¦ï¼Œä¸è¿‡ä»æ²¡æœ‰ç ”ç©¶è¿‡æ–¹æ³•è®ºï¼Œä¹Ÿå±äºä¸å¾—è¦é¢†çš„è¿™ä¸€ç±»ï¼Œæ‰€ä»¥æ½¦å€’åŠç”Ÿï¼Œé¡½æ„šä¸å ªã€‚\nå¤äººä¹‹ä¸­æœ‰å¾ˆå¤šè¯»ä¹¦å‰å®³çš„ï¼Œä¹Ÿæµä¼ ä¸‹æ¥ä¸€äº›è¯»ä¹¦ä¹‹é“ï¼Œæ¯”å¦‚äº”æŸ³ä¸æ±‚ç”šè§£ï¼Œå§é¾™è§‚å…¶å¤§ç•¥ã€‚ä¸¤ä½å…ˆè´¤éƒ½æ˜¯å–„å­¦ä¹‹å£«ï¼Œå…¶æ³•è•´å«è‡³ç†ï¼Œè‹¥æˆ‘ç­‰ä¸æ˜å°±é‡Œï¼Œå®¹æ˜“å •å…¥æ‡’æƒ°ã€‚æŸç§ç¨‹åº¦ä¸Šï¼Œäºè´¹æ›¼å­¦ä¹ æ³•æ®Šé€”åŒå½’ã€‚\nå¦å¤–éœ€è¦æŒ‡å‡ºçš„æ˜¯å­¦ä¹ åº”å½“æ˜¯ç³»ç»Ÿæ€§çš„ï¼Œç¢ç‰‡åŒ–å­¦ä¹ ä¸å¯å–ï¼Œè¿™ç§æ–¹å¼å¾—åˆ°çš„æ˜¯ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯çŸ¥è¯†ã€‚\nè´¹æ›¼å­¦ä¹ æ³•æœ‰å››ä¸ªæ ¸å¿ƒè¯ï¼šæ¦‚å¿µã€è®²æˆã€å®¡æŸ¥ã€ç®€åŒ–ã€‚\næ¦‚å¿µ æ¦‚å¿µæ˜¯æŒ‡æˆ‘ä»¬å¯¹éœ€è¦å­¦ä¹ çš„ç›®æ ‡æœ‰ç›¸å½“çš„æ¦‚å¿µï¼Œè¿™åŒ…æ‹¬æˆ‘ä»¬æ‰“ç®—å­¦ä¹ ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†å¾—åˆ°å“ªäº›çŸ¥è¯†ç­‰ç­‰ã€‚\nä¿—è¯­è¯´ï¼šå¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€åŠã€‚åœ¨å­¦ä¹ ä¹‹å‰æˆ‘ä»¬åº”å½“è°¨æ…åœ°æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®šè¦å­¦å—ï¼Ÿå¦‚æœæ˜¯è‚¯å®šçš„ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆèŠ±ä¸€ç‚¹ç‚¹æ—¶é—´åˆæ­¥äº†è§£ä¸€ä¸‹å°†è¦å­¦ä¹ çš„é¢†åŸŸçš„ä¸»è¦æ€æ½®æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›æƒå¨çš„ä¸“å®¶å’Œä¹¦ç±ï¼Ÿç„¶åå°±å¯ä»¥ä¹°ä¸€äº›ä¹¦å¹¶åˆ¶å®šåˆç†çš„è®¡åˆ’å¼€å§‹è¿™æ®µæ—…ç¨‹äº†ã€‚\nå…³äºä¹°ä¹¦ï¼Œæˆ‘çš„å»ºè®®æ˜¯å°½é‡é€‰æ‹©ç»å…¸è‘—ä½œï¼Œä¸ç”¨å¤ªå¤šï¼Œè´ªå¤šåè€Œåš¼ä¸çƒ‚ã€‚å¦å¤–ä¹Ÿè¦è€ƒè™‘å‡ºç‰ˆç¤¾ï¼Œä¸€èˆ¬å‡ºåçš„å‡ºç‰ˆç¤¾ç¼–è¾‘çš„ä¹¦è´¨é‡ä¼šæœ‰ä¿éšœï¼Œæ¯”å¦‚æ–‡å²ç±»çš„ï¼Œä¸­åä¹¦å±€ï¼Œä¸Šå¤ç­‰å¾ˆä¸é”™ã€‚\nç¿»å¼€ä¹¦æœ¬ä¹‹å‰ï¼Œéœ€æå‡ºè‡ªå·±çš„æœŸæœ›ï¼Œå³æˆ‘å¸Œæœ›æœ¬ä¹¦èƒ½æä¾›ç»™æˆ‘å…³äºæŸæŸé—®é¢˜çš„ç­”æ¡ˆï¼Œé˜…è¯»ä¸­æ—¶åˆ»å›´ç»•è¯¥é—®é¢˜è¿›è¡Œæ€è€ƒï¼Œè¿™æ ·å¯æ±²å–æƒ³è¦çš„çŸ¥è¯†ã€‚\nä¸€ä¸ªé¢†åŸŸçš„çŸ¥è¯†ç‚¹å¾€å¾€æå¤šï¼Œå› æ­¤é˜…è¯»æ—¶ä¸åº”è¢«åŠ¨åœ°å…¨ç›˜æ¥å—ï¼Œåº”ä¸»åŠ¨åŠ å·¥çŸ¥è¯†ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¼šå½’çº³ã€ç­›é€‰å’Œåˆ†æï¼Œè¿™å¯¹äºå½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æä¸ºé‡è¦ã€‚\nè®²æˆ è¿™æ˜¯è´¹æ›¼å­¦ä¹ æ³•çš„æ ¸å¿ƒã€‚é€šè¿‡å‘å…¶ä»–äººè®²æˆè‡ªå·±ä¹ å¾—çš„çŸ¥è¯†ï¼Œæ¥å·©å›ºè‡ªèº«æ‰€å­¦ï¼Œå¹¶ä¸”åˆ©ç”¨ä»–äººçš„åé¦ˆå’Œè´¨ç–‘æ¥æŸ¥ç¼ºè¡¥æ¼ï¼Œä»è€Œæ›´åŠ ç†è§£è¯¥é¢†åŸŸï¼Œè¿™æ˜¯ä¸€ç§æ­£å‘ç§¯æçš„è¿­ä»£ã€‚å½“æˆ‘ä»¬èƒ½å¤Ÿç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è§£é‡ŠæŸä¸ªé¢†åŸŸçš„çŸ¥è¯†ï¼Œå¹¶ä¸”èƒ½è®©ä¸€ä½é—¨å¤–æ±‰äº§ç”Ÿå…±é¸£ï¼Œé‚£ä¹ˆå¯ä»¥è¯´æˆ‘ä»¬å¯¹äºè¯¥é¢†åŸŸæœ‰ç›¸å½“çš„ç†è§£äº†ã€‚\nç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è®²æˆå¾ˆé‡è¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡ç‚¼çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šåŠ å…¥è‡ªå·±çš„æƒ³æ³•ï¼Œå¹¶ä¸å…¶ä»–çŸ¥è¯†äº¤å‰ææºï¼Œé€æ¸å½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚ä½“ç³»æ˜¯ç‹¬ç«‹æ€è€ƒçš„åŸºçŸ³ï¼Œå› æ­¤å¯¹ä»»ä½•äº‹éƒ½èƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œè€Œä¸æ˜¯äººäº‘äº¦äº‘ã€‚\né€šä¿—åœ°è®²ï¼Œè¿™æ˜¯ç”¨è¾“å‡ºæ¥å€’é€¼è¾“å…¥ã€‚å¦‚æœè‡ªå·±ä¸èƒ½è§£é‡Šæ¸…æ¥šï¼Œåªèƒ½è¯´æ˜è¿˜æ²¡æœ‰æŒæ¡ç²¾é«“ã€‚ä»»ä½•å¤æ‚çš„äº‹æƒ…èƒŒåéƒ½æœ‰ä¸€ä¸ªç®€å•çš„çœŸç†ã€‚\nå®¡æŸ¥ å­Ÿå­è¯´ï¼šå°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦ã€‚æ‰€ä»¥å­¦ä¹ å¿…éœ€å…·å¤‡æ€€ç–‘ç²¾ç¥ï¼Œå½“ç„¶ä¸æ˜¯ç›²ç›®çš„æ€€ç–‘ï¼Œæ€€ç–‘ä¸€åˆ‡æ˜¯ä¸€ç§æµªè´¹ã€‚å¥½å¥‡å¿ƒæ˜¯é©±ä½¿äººç±»è¿›æ­¥çš„åŸåŠ¨åŠ›ï¼Œå¹¼å„¿å¯¹ä»€ä¹ˆéƒ½å¥½å¥‡ï¼Œè¿™ä¼šä¿ƒè¿›ä»–ä»¬æˆé•¿ï¼Œå’Œè®¤è¯†ä¸–ç•Œã€‚æˆäººä¸¢æ‰äº†ç«¥çœŸï¼ŒæŸäº›æ–¹é¢çœ‹æ˜¯ä¸€ç§æŸå¤±ã€‚å²å®¶è’™æ–‡é€šå…ˆç”Ÿè€ƒè¯•é¥¶æœ‰è¶£å‘³ï¼Œä¸æ˜¯ä»–å‡ºé¢˜è€ƒå­¦ç”Ÿï¼Œè€Œæ˜¯ç”±å­¦ç”Ÿå‡ºé¢˜é—®ä»–ã€‚å¦‚æœå­¦ç”Ÿç§¯ç´¯ä¸å¤Ÿï¼Œå¥½å¥‡ä¸è¶³ï¼Œä¾¿æƒ³å‡ºä¸äº†å¥½é¢˜ï¼Œæ‰€ä»¥å¾€å¾€è€ƒç”Ÿä¸€å‡ºå£ï¼Œè’™å…ˆç”Ÿå°±çŸ¥é“è¯¥ç”Ÿå­¦é—®å¦‚ä½•äº†ã€‚\nç®€åŒ– äººçš„ç²¾åŠ›ç›¸å½“æœ‰é™ï¼Œå†µä¸”æˆå¹´ä¹‹åå„ç§æ‚äº‹çº·è‡³æ²“æ¥ï¼Œæ²‰ä¸‹å¿ƒå­¦ä¹ çš„æ—¶é—´å°‘ä¹‹åˆå°‘ï¼Œæ‰€ä»¥æ›´åº”å½“é›†ä¸­ç²¾ç¥ï¼Œç¼©å°èŒƒå›´ã€‚\nä¸‹é¢é™„ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œæ¾„æ¸…è„‰ç»œï¼š\n","id":0,"section":"posts","summary":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†","tags":["éšæƒ³"],"title":"è´¹æ›¼å­¦ä¹ æ³•","uri":"https://lvsq.net/2022/03/feynman_technique/","year":"2022"},{"content":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;; + `doom-font\u0026#39; ;; + `doom-variable-pitch-font\u0026#39; ;; + `doom-big-font\u0026#39; -- used for `doom-big-font-mode\u0026#39;; use this for ;; presentations or streaming. ;; ;; They all accept either a font-spec, font string (\u0026#34;Input Mono-12\u0026#34;), or xlfd ;; font string. You generally only need these two: ;;(setq doom-font (font-spec :family \u0026#34;monaco\u0026#34; :size 14 :weight \u0026#39;semi-light) ;; doom-variable-pitch-font (font-spec :family \u0026#34;sans\u0026#34; :size 13)) ;; There are two ways to load a theme. Both assume the theme is installed and ;; available. You can either set `doom-theme\u0026#39; or manually load a theme with the ;; `load-theme\u0026#39; function. This is the default: (setq doom-theme \u0026#39;doom-monokai-pro) ;; If you use `org\u0026#39; and don\u0026#39;t want your org files in the default location below, ;; change `org-directory\u0026#39;. It must be set before org loads! (setq org-directory \u0026#34;~/work/emacs-org/\u0026#34;) ;; This determines the style of line numbers in effect. If set to `nil\u0026#39;, line ;; numbers are disabled. For relative line numbers, set this to `relative\u0026#39;. (setq display-line-numbers-type t) ;; Here are some additional functions/macros that could help you configure Doom: ;; ;; - `load!\u0026#39; for loading external *.el files relative to this one ;; - `use-package!\u0026#39; for configuring packages ;; - `after!\u0026#39; for running code after a package has loaded ;; - `add-load-path!\u0026#39; for adding directories to the `load-path\u0026#39;, relative to ;; this file. Emacs searches the `load-path\u0026#39; when you load packages with ;; `require\u0026#39; or `use-package\u0026#39;. ;; - `map!\u0026#39; for binding new keys ;; ;; To get information about any of these functions/macros, move the cursor over ;; the highlighted symbol at press \u0026#39;K\u0026#39; (non-evil users must press \u0026#39;C-c c k\u0026#39;). ;; This will open documentation for it, including demos of how they are used. ;; ;; You can also try \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) to jump to their definition and see how ;; they are implemented. (custom-set-faces ;; custom-set-faces was added by Custom. ;; If you edit it by hand, you could mess it up, so be careful. ;; Your init file should contain only one such instance. ;; If there is more than one, they won\u0026#39;t work right. \u0026#39;(default ((t (:family \u0026#34;Monaco\u0026#34; :foundry \u0026#34;nil\u0026#34; :slant normal :weight normal :height 150 :width normal)))) \u0026#39;(rainbow-delimiters-depth-1-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;light green\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-2-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;goldenrod2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-3-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark magenta\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-4-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark cyan\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-5-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark blue\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-6-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;PaleVioletRed2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-7-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;SpringGreen4\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-8-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;chocolate3\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-9-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;blue\u0026#34;))))) (setq auto-save-default t) (run-with-idle-timer 5 t #\u0026#39;save-some-buffers t) (setq make-backup-files t) (setq confirm-kill-emacs nil) (set-frame-position (selected-frame) 0 0) (add-to-list \u0026#39;default-frame-alist \u0026#39;(fullscreen . maximized)) (setq initial-frame-alist \u0026#39;((top . 1) (left . 1) (width . 114) (height . 32))) ;;org-mode (setq org-superstar-headline-bullets-list \u0026#39;(\u0026#34;âœ¿\u0026#34; \u0026#34;âœ¸\u0026#34; \u0026#34;â—‰\u0026#34; \u0026#34;â–\u0026#34; \u0026#34;â—‹\u0026#34; )) ;;(setq org-todo-keywords \u0026#39;((sequence \u0026#34;TODO(t)\u0026#34; \u0026#34;STARTED(s!)\u0026#34; \u0026#34;WAITING(w@/!)\u0026#34; \u0026#34;|\u0026#34; \u0026#34;DONE(d@/!)\u0026#34; \u0026#34;CANCELLED(c@/!)\u0026#34;))) (setf org-todo-keyword-faces \u0026#39;((\u0026#34;TODO\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#95A5A6\u0026#34;))(\u0026#34;STRT\u0026#34;. (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#2E8B57\u0026#34;))(\u0026#34;DONE\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#3498DB\u0026#34;)))) (setq org-log-done \u0026#39;time) (setq org-cycle-include-plain-lists t) (setq org-export-coding-system \u0026#39;utf-8) (setq org-src-fontify-natively t) (setq org-html-doctype \u0026#34;html5\u0026#34;) (setq org-html-xml-declaration nil) (setq org-html-head \u0026#34;\u0026lt;link rel=\u0026#39;stylesheet\u0026#39; href=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css\u0026#39; integrity=\u0026#39;sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js\u0026#39; integrity=\u0026#39;sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js\u0026#39; integrity=\u0026#39;sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;) (org-babel-do-load-languages \u0026#39;org-babel-load-languages \u0026#39;((emacs-lisp . t) (c . t) (java . t) (go . t) (racket . t) (python . t) (latex . t) (shell . t) (js . t) (lisp . t) (scheme . t))) (setq-default prettify-symbols-alist \u0026#39;((\u0026#34;#+BEGIN_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+END_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+begin_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;#+end_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;\u0026gt;=\u0026#34; . \u0026#34;â‰¥\u0026#34;)(\u0026#34;=\u0026gt;\u0026#34; . \u0026#34;â‡¨\u0026#34;))) (setq prettify-symbols-unprettify-at-point \u0026#39;right-edge) (add-hook \u0026#39;org-mode-hook \u0026#39;prettify-symbols-mode) (setq org-adapt-indentation nil) : ;;auto-wrap (global-visual-line-mode 1) ;1 for on, 0 for off. ;;racket (require \u0026#39;racket-mode) (setq racket-program \u0026#34;/Applications/Racket v8.4/bin/racket\u0026#34;) (setq tab-always-indent \u0026#39;complete) ;; ä½¿ç”¨tabè‡ªåŠ¨è¡¥å…¨ (add-to-list \u0026#39;auto-mode-alist \u0026#39;(\u0026#34;\\\\.rkt\\\\\u0026#39;\u0026#34; . racket-mode)) (add-to-list \u0026#39;magic-mode-alist \u0026#39;(\u0026#34;^#lang racket\u0026#34; . :racket-mode)) ;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ;; language evniroment (set-language-environment \u0026#39;UTF-8) (set-locale-environment \u0026#34;UTF-8\u0026#34;) (define-coding-system-alias \u0026#39;UTF-8 \u0026#39;utf-8) ;; elfeed (setq elfeed-db-directory \u0026#34;~/work/emacs-org/elfeed\u0026#34;) (setq rmh-elfeed-org-files (list \u0026#34;~/work/emacs-org/elfeed/elfeed.org\u0026#34;)) (add-hook! \u0026#39;elfeed-search-mode-hook #\u0026#39;elfeed-update) ;;(add-hook \u0026#39;elfeed-new-entry-hook ;; (elfeed-make-tagger :before \u0026#34;2 weeks ago\u0026#34; ;; :remove \u0026#39;unread)) ;; lsp (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred) :custom ;; what to use when checking on-save. \u0026#34;check\u0026#34; is default, I prefer clippy (lsp-rust-analyzer-cargo-watch-command \u0026#34;clippy\u0026#34;) (lsp-eldoc-render-all t) (lsp-idle-delay 0.6) ;; enable / disable the hints as you prefer: (lsp-inlay-hint-enable t) ;; These are optional configurations. See https://emacs-lsp.github.io/lsp-mode/page/lsp-rust-analyzer/#lsp-rust-analyzer-display-chaining-hints for a full list (lsp-rust-analyzer-display-lifetime-elision-hints-enable \u0026#34;skip_trivial\u0026#34;) (lsp-rust-analyzer-display-chaining-hints t) (lsp-rust-analyzer-display-lifetime-elision-hints-use-parameter-names nil) (lsp-rust-analyzer-display-closure-return-type-hints t) (lsp-rust-analyzer-display-parameter-hints nil) (lsp-rust-analyzer-display-reborrow-hints nil) :config (add-hook \u0026#39;lsp-mode-hook \u0026#39;lsp-ui-mode)) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure :commands lsp-ui-mode :custom (lsp-ui-peek-always-show t) (lsp-ui-sideline-show-hover t) (lsp-ui-doc-enable nil)) (use-package flycheck :ensure) ;;rust ;;refer: https://robert.kra.hn/posts/rust-emacs-setup/ (use-package rustic :ensure :bind (:map rustic-mode-map (\u0026#34;M-j\u0026#34; . lsp-ui-imenu) (\u0026#34;M-?\u0026#34; . lsp-find-references) (\u0026#34;C-c C-c l\u0026#34; . flycheck-list-errors) (\u0026#34;C-c C-c a\u0026#34; . lsp-execute-code-action) (\u0026#34;C-c C-c r\u0026#34; . lsp-rename) (\u0026#34;C-c C-c q\u0026#34; . lsp-workspace-restart) (\u0026#34;C-c C-c Q\u0026#34; . lsp-workspace-shutdown) (\u0026#34;C-c C-c s\u0026#34; . lsp-rust-analyzer-status)) :config ;; uncomment for less flashiness ;; (setq lsp-eldoc-hook nil) ;; (setq lsp-enable-symbol-highlighting nil) ;; (setq lsp-signature-auto-activate nil) ;; comment to disable rustfmt on save (setq rustic-format-on-save t) (add-hook \u0026#39;rustic-mode-hook \u0026#39;rk/rustic-mode-hook)) (defun rk/rustic-mode-hook () ;; so that run C-c C-c C-r works without having to confirm, but don\u0026#39;t try to ;; save rust buffers that are not file visiting. Once ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should ;; no longer be necessary. (when buffer-file-name (setq-local buffer-save-without-query t)) (add-hook \u0026#39;before-save-hook \u0026#39;lsp-format-buffer nil t)) init.el ;;; init.el -*- lexical-binding: t; -*- ;; This file controls what Doom modules are enabled and what order they load ;; in. Remember to run \u0026#39;doom sync\u0026#39; after modifying it! ;; NOTE Press \u0026#39;SPC h d h\u0026#39; (or \u0026#39;C-h d h\u0026#39; for non-vim users) to access Doom\u0026#39;s ;; documentation. There you\u0026#39;ll find a \u0026#34;Module Index\u0026#34; link where you\u0026#39;ll find ;; a comprehensive list of Doom\u0026#39;s modules and what flags they support. ;; NOTE Move your cursor over a module\u0026#39;s name (or its flags) and press \u0026#39;K\u0026#39; (or ;; \u0026#39;C-c c k\u0026#39; for non-vim users) to view its documentation. This works on ;; flags as well (those symbols that start with a plus). ;; ;; Alternatively, press \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) on a module to browse its ;; directory (for easy access to its source code). ;;; æ·»åŠ ä¸­å›½æº ;;(setq package-archives \u0026#39;((\u0026#34;gnu\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/gnu/\u0026#34;) ;; (\u0026#34;melpa\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa/\u0026#34;) ;; (\u0026#34;melpa-stable\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa-stable/\u0026#34;) ;; (\u0026#34;org\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/org/\u0026#34;))) (doom! :input ;; chinese ;;japanese ;;layout ; auie,ctsrnm is the superior home row :completion company ; the ultimate code completion backend ;;helm ; the *other* search engine for love and life ;;ido ; the other *other* search engine... ivy ; a search engine for love and life vertico ; the search engine of the future :ui ;;deft ; notational velocity for Emacs doom ; what makes DOOM look the way it does doom-dashboard ; a nifty splash screen for Emacs doom-quit ; DOOM quit-message prompts when you quit Emacs ;;(emoji +unicode) ; ğŸ™‚ hl-todo ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW ;;hydra ;;indent-guides ; highlighted indent columns ;;ligatures ; ligatures and symbols to make your code pretty again ;;minimap ; show a map of the code on the side modeline ; snazzy, Atom-inspired modeline, plus API ;;nav-flash ; blink cursor line after big motions ;;neotree ; a project drawer, like NERDTree for vim ophints ; highlight the region an operation acts on (popup +defaults) ; tame sudden yet inevitable temporary windows ;;tabs ; a tab bar for Emacs treemacs ; a project drawer, like neotree but cooler ;;unicode ; extended unicode support for various languages vc-gutter ; vcs diff in the fringe vi-tilde-fringe ; fringe tildes to mark beyond EOB ;;window-select ; visually switch windows workspaces ; tab emulation, persistence \u0026amp; separate workspaces ;;zen ; distraction-free coding or writing :editor (evil +everywhere); come to the dark side, we have cookies file-templates ; auto-snippets for empty files fold ; (nigh) universal code folding (format +onsave) ; automated prettiness ;;god ; run Emacs commands without modifier keys ;;lispy ; vim for lisp, for people who don\u0026#39;t like vim ;;multiple-cursors ; editing in many places at once ;;objed ; text object editing for the innocent ;;parinfer ; turn lisp into python, sort of ;;rotate-text ; cycle region at point between text candidates snippets ; my elves. They type so I don\u0026#39;t have to word-wrap ; soft wrapping with language-aware indent :emacs dired ; making dired pretty [functional] electric ; smarter, keyword-based electric-indent ;;ibuffer ; interactive buffer management undo ; persistent, smarter undo for your inevitable mistakes vc ; version-control and Emacs, sitting in a tree :term eshell ; the elisp shell that works everywhere shell ; simple shell REPL for Emacs ;;term ; basic terminal emulator for Emacs vterm ; the best terminal emulation in Emacs :checkers syntax ; tasing you for every semicolon you forget ;;(spell +flyspell) ; tasing you for misspelling mispelling ;;grammar ; tasing grammar mistake every you make :tools ;;ansible ;;biblio ; Writes a PhD for you (citation needed) ;;debugger ; FIXME stepping through code, to help you add bugs ;;direnv ;;docker ;;editorconfig ; let someone else argue about tabs vs spaces ;;ein ; tame Jupyter notebooks with emacs (eval +overlay) ; run code, run (also, repls) ;;gist ; interacting with github gists lookup ; navigate your code and its documentation lsp ; M-x vscode magit ; a git porcelain for Emacs ;;make ; run make tasks from Emacs ;;pass ; password manager for nerds ;;pdf ; pdf enhancements ;;prodigy ; FIXME managing external services \u0026amp; code builders ;;rgb ; creating color strings ;;taskrunner ; taskrunner for all your projects ;;terraform ; infrastructure as code ;;tmux ; an API for interacting with tmux ;;upload ; map local to remote projects via ssh/ftp :os (:if IS-MAC macos) ; improve compatibility with macOS tty ; improve the terminal Emacs experience :lang ;;agda ; types of types of types of types... ;;beancount ; mind the GAAP ;;cc ; C \u0026gt; C++ == 1 ;;clojure ; java with a lisp ;;common-lisp ; if you\u0026#39;ve seen one lisp, you\u0026#39;ve seen them all ;;coq ; proofs-as-programs ;;crystal ; ruby at the speed of c ;;csharp ; unity, .NET, and mono shenanigans ;;data ; config/data formats ;;(dart +flutter) ; paint ui and not much else ;;dhall ;;elixir ; erlang done right ;;elm ; care for a cup of TEA? emacs-lisp ; drown in parentheses ;;erlang ; an elegant language for a more civilized age ;;ess ; emacs speaks statistics ;;factor ;;faust ; dsp, but you get to keep your soul ;;fortran ; in FORTRAN, GOD is REAL (unless declared INTEGER) ;;fsharp ; ML stands for Microsoft\u0026#39;s Language ;;fstar ; (dependent) types and (monadic) effects and Z3 ;;gdscript ; the language you waited for (go +lsp) ; the hipster dialect ;;(haskell +lsp) ; a language that\u0026#39;s lazier than I am ;;hy ; readability of scheme w/ speed of python ;;idris ; a language you can depend on json ; At least it ain\u0026#39;t XML ;;(java +meghanada) ; the poster child for carpal tunnel syndrome (java +lsp) javascript ; all(hope(abandon(ye(who(enter(here)))))) ;;julia ; a better, faster MATLAB ;;kotlin ; a better, slicker Java(Script) ;;latex ; writing papers in Emacs has never been so fun ;;lean ; for folks with too much to prove ;;ledger ; be audit you can be ;;lua ; one-based indices? one-based indices markdown ; writing docs for people to ignore ;;nim ; python + lisp at the speed of c ;;nix ; I hereby declare \u0026#34;nix geht mehr!\u0026#34; ;;ocaml ; an objective camel (org +pretty) ; organize your plain life in plain text ;;php ; perl\u0026#39;s insecure younger brother ;;plantuml ; diagrams for confusing people more ;;purescript ; javascript, but functional python ; beautiful is better than ugly ;;qt ; the \u0026#39;cutest\u0026#39; gui framework ever racket ; a DSL for DSLs ;;raku ; the artist formerly known as perl6 ;;rest ; Emacs as a REST client ;;rst ; ReST in peace ;;(ruby +rails) ; 1.step {|i| p \u0026#34;Ruby is #{i.even? ? \u0026#39;love\u0026#39; : \u0026#39;life\u0026#39;}\u0026#34;} ;;rust ; Fe2O3.unwrap().unwrap().unwrap().unwrap() ;;scala ; java, but good ;;(scheme +guile) ; a fully conniving family of lisps sh ; she sells {ba,z,fi}sh shells on the C xor ;;sml ;;solidity ; do you need a blockchain? No. ;;swift ; who asked for emoji variables? ;;terra ; Earth and Moon in alignment for performance. ;;web ; the tubes yaml ; JSON, but readable ;;zig ; C, but simpler :email ;;(mu4e +org +gmail) ;;notmuch ;;(wanderlust +gmail) :app ;;calendar ;;emms ;;everywhere ; *leave* Emacs!? You must be joking ;;irc ; how neckbeards socialize (rss +org) ; emacs as an RSS reader ;;twitter ; twitter client https://twitter.com/vnought :config ;;literate (default +bindings +smartparens)) packages.el ;; -*- no-byte-compile: t; -*- ;;; $DOOMDIR/packages.el ;; To install a package with Doom you must declare them here and run \u0026#39;doom sync\u0026#39; ;; on the command line, then restart Emacs for the changes to take effect -- or ;; use \u0026#39;M-x doom/reload\u0026#39;. ;; To install SOME-PACKAGE from MELPA, ELPA or emacsmirror: ;(package! some-package) ;; To install a package directly from a remote git repo, you must specify a ;; `:recipe\u0026#39;. You\u0026#39;ll find documentation on what `:recipe\u0026#39; accepts here: ;; https://github.com/raxod502/straight.el#the-recipe-format ;(package! another-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34;)) ;; If the package you are trying to install does not contain a PACKAGENAME.el ;; file, or is located in a subdirectory of the repo, you\u0026#39;ll need to specify ;; `:files\u0026#39; in the `:recipe\u0026#39;: ;(package! this-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34; ; :files (\u0026#34;some-file.el\u0026#34; \u0026#34;src/lisp/*.el\u0026#34;))) ;; If you\u0026#39;d like to disable a package included with Doom, you can do so here ;; with the `:disable\u0026#39; property: ;(package! builtin-package :disable t) ;; You can override the recipe of a built in package without having to specify ;; all the properties for `:recipe\u0026#39;. These will inherit the rest of its recipe ;; from Doom or MELPA/ELPA/Emacsmirror: ;(package! builtin-package :recipe (:nonrecursive t)) ;(package! builtin-package-2 :recipe (:repo \u0026#34;myfork/package\u0026#34;)) ;; Specify a `:branch\u0026#39; to install a package from a particular branch or tag. ;; This is required for some packages whose default branch isn\u0026#39;t \u0026#39;master\u0026#39; (which ;; our package manager can\u0026#39;t deal with; see raxod502/straight.el#279) ;(package! builtin-package :recipe (:branch \u0026#34;develop\u0026#34;)) ;; Use `:pin\u0026#39; to specify a particular commit to install. ;(package! builtin-package :pin \u0026#34;1a2b3c4d5e\u0026#34;) ;; Doom\u0026#39;s packages are pinned to a specific commit and updated from release to ;; release. The `unpin!\u0026#39; macro allows you to unpin single packages... ;(unpin! pinned-package) ;; ...or multiple packages ;(unpin! pinned-package another-pinned-package) ;; ...Or *all* packages (NOT RECOMMENDED; will likely break things) ;(unpin! t) (package! racket-mode) (package! spacemacs-theme) elfeed.org * root :elfeed: ** Programming :programming: *** https://www.reddit.com/r/functionalprogramming/.rss :Reddit: ** News :news: *** https://news.ycombinator.com/rss :Hack News: ","id":1,"section":"posts","summary":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;;","tags":["emacs"],"title":"æˆ‘çš„Doom Emacsé…ç½®","uri":"https://lvsq.net/2022/02/my-doom-emacs-config/","year":"2022"},{"content":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘äº†ç”¨æˆ·æŠ˜è…¾çš„æ—¶é—´ï¼Œè€Œä¸”å¯åŠ¨å¾ˆå¿«ï¼Œæä¾›è¶…è¿‡60é—¨ç¼–ç¨‹è¯­è¨€çš„å¯é€‰é¡¹ï¼Œå¯è°“ååˆ†å¼ºå¤§ã€‚\nç¬”è€…å¹³æ—¶ä¼šä½¿ç”¨Golangå¼€å‘ï¼Œæ‰€ä»¥ç¬¬ä¸€æ—¶é—´å¼€å¯äº†Golangçš„æ”¯æŒï¼Œç”±äºDoom Emacsçš„èµ„æ–™æ¯”è¾ƒå°‘ï¼Œåœ¨é…ç½®çš„è¿‡ç¨‹ä¸­èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œç»è¿‡ä¸€ç•ªæŠ˜è…¾ä¹‹åç»ˆäºæœ‰ä¸€ä¸ªå¯ç”¨çš„ç‰ˆæœ¬ï¼Œå¯èƒ½è¿˜æœ‰é—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰å‘ç°ï¼Œç°è®°å½•ä¸€ä¸‹ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚\nDoomå®‰è£…å®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ï¼š\nç¬¬ä¸€æ­¥ ä¿®æ”¹ ~/doom.d/init.el, å¯ç”¨ï¼ˆSPC f Pï¼‰æ‰¾åˆ°è¯¥æ–‡ä»¶\nåœ¨ (doom! ä¸‹é¢æ‰¾åˆ°ï¼š\n:lang (go +lsp)\n:tools (lsp)\n:editor (sinppets, evil +everywhere, format +onsave)\nï¼šcompletion (company)\n()ä¸­çš„é¡¹ç›®éƒ½æ‰“å¼€\nç¬¬äºŒæ­¥ æ‰¾åˆ°~/doom.d/config.el,æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\n;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred)) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure t :commands lsp-ui-mode) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ç¬¬ä¸‰æ­¥ å®‰è£…ä¾èµ–åŒ…ï¼š\ngo install github.com/motemen/gore/cmd/gore@latest go install github.com/stamblerre/gocode@latest go install golang.org/x/tools/cmd/godoc@latest go install golang.org/x/tools/cmd/goimports@latest go install golang.org/x/tools/cmd/gorename@latest go install golang.org/x/tools/cmd/guru@latest go install github.com/cweill/gotests/...@latest go install github.com/fatih/gomodifytags@latest # gopls for (+lsp) go install golang.org/x/tools/gopls@latest # golangci go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest è¿™æ˜¯é’ˆå¯¹Go \u0026gt;= v1.16çš„ï¼Œä½äºè¿™ä¸ªç‰ˆæœ¬çš„ç”¨go getï¼Œ æˆ‘æƒ³ç°åœ¨å¤§å®¶ç”¨çš„éƒ½æ˜¯æ–°ç‰ˆæœ¬äº†ã€‚\nç¬¬å››æ­¥ æ‰§è¡Œ~/.emacs.d/bin/doom sync æˆ–è€… (SPC h r r) ä½¿é…ç½®ç”Ÿæ•ˆ\nç¬¬äº”æ­¥ é‡å¯ä¸€ä¸‹Emacså³å¯\n","id":2,"section":"posts","summary":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘","tags":["emacs","golang"],"title":"Doom Emacs Golang ç¯å¢ƒé…ç½®","uri":"https://lvsq.net/2021/12/doom-emacs-golang-env/","year":"2021"},{"content":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œä»£ç å°±å®Œæˆäº†ã€‚\n#lang racket (require racket/cmdline) (define show-bytes (make-parameter #t)) (define show-lines (make-parameter #t)) (define show-words (make-parameter #t)) (define files (make-parameter null)) (define re-chan (make-channel)) (define cmd-line (command-line #:program \u0026#34;r-wc\u0026#34; #:once-any [(\u0026#34;-c\u0026#34; \u0026#34;--bytes\u0026#34; \u0026#34;--chars\u0026#34;) \u0026#34;The number of bytes\u0026#34; (show-bytes #t) (show-lines #f) (show-words #f)] [(\u0026#34;-l\u0026#34; \u0026#34;--lines\u0026#34;) \u0026#34;The number of lines\u0026#34; (show-lines #t) (show-bytes #f) (show-words #f)] [(\u0026#34;-w\u0026#34; \u0026#34;--words\u0026#34;) \u0026#34;The muber of words\u0026#34; (show-words #t) (show-bytes #f) (show-lines #f)] #:args file (files file))) (define (do-work) (if (null? (files)) (displayln \u0026#34;Please enter the file name\u0026#34;) (begin (for-each scan-file (files)) (let loop ([finished 0]) (unless (= finished (length (files))) (let ((re (channel-get re-chan))) (match re ((list l w b f) (displayln (append (for/list ([d (list l w b)] [t (list (show-lines) (show-words) (show-bytes) )] #:when t) d) f))))) (loop (add1 finished))))))) (define (scan-file f) (thread (lambda () (call-with-input-file f (lambda (in) (let loop ([a-line (read-line in)] [bytes 0] [lines 0] [words 0]) (if (eof-object? a-line) (channel-put re-chan (list lines words bytes f)) (let-values (((w b) (parse-line a-line))) (loop (read-line in) (+ bytes b) (add1 lines) (+ words w)))))))))) (define (parse-line a-line) (define s (open-input-string a-line)) (if (null? a-line) (values 0 0) (let loop ([w 0] [b 0] [pre-char #\\a]) (define bl b) (define c (read-char s)) (unless (eof-object? c) (set! bl (+ (char-utf-8-length c) b))) (if (eof-object? c) (values (add1 w) (add1 b)) (case c [(#\\space) (loop (if (char-whitespace? pre-char) w (add1 w)) (add1 b) c)] [else (loop w bl c)]))))) (do-work) ç„¶åç”¨racoç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº, åå­—å°±å«r-wcï¼Œå’Œwcç¨å¾®åŒºåˆ†ä¸€ä¸‹ï¼š\nraco exe -o r-wc r-wc.rkt å°±åƒä½¿ç”¨wcå‘½ä»¤ä¸€æ ·ï¼Œ\nâœ racket ./r-wc -h usage: r-wc [ \u0026lt;option\u0026gt; ... ] [\u0026lt;file\u0026gt;] ... \u0026lt;option\u0026gt; is one of / -c, --bytes, --chars | The number of bytes | -l, --lines | The number of lines | -w, --words \\ The muber of words --help, -h Show this help -- Do not treat any remaining argument as a switch (at this level) /|\\ Brackets indicate mutually exclusive options. Multiple single-letter switches can be combined after one `-`. For example, `-h-` is the same as `-h --`. ä¸Šé¢çš„ç¨‹åºæ‰§è¡Œæ•ˆç‡ä¸æ˜¯å¾ˆå¥½ï¼Œä¸»è¦è¡¨ç°åœ¨è¯»å–æ–‡ä»¶ï¼Œå’Œè§£ææ¯ä¸€è¡Œæ—¶ï¼Œå ç”¨çš„æ—¶é—´å’Œå†…å­˜å¤ªå¤§ã€‚Racketæä¾›äº†ä¸€ä¸ªç‰¹æ€§Sequences ï¼Œå®ƒå¯ä»¥ä¸for å½¢å¼ä¸€æ ·éå†æ•°æ®ç»“æœï¼Œä½†æ˜¯æ•ˆç‡å´é«˜å¾ˆå¤šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨Sequencesæ¥é‡æ„æˆ‘ä»¬çš„ç¨‹åºï¼Œå°†ä¸Šæ–‡çš„ä¸¤ä¸ªå‡½æ•°scan-file å’Œparse-line ä¿®æ”¹ä¸ºï¼š\n(define (scan-file f) (thread (lambda () (define bytes 0) (define lines 0) (define words 0) (call-with-input-file f (lambda (in) (for ([a-line (in-bytes-lines in)]) (let-values (((w b) (parse-line-seq a-line))) (set! bytes (+ bytes b)) (set! lines (add1 lines)) (set! words (+ words w)))) (channel-put re-chan (list lines words bytes f))))))) (define (parse-line a-line) (define pre-char #\\a) (define w 0) (define b 0) (if (null? a-line) (values 0 0) (for ([c (in-bytes a-line)]) (case c [(#\\space) (unless (char-whitespace? pre-char) (set! w (add1 w))) (set! b (add1 b))] [else (set! b (add1 b))]) (set! pre-char c))) (values (add1 w) (add1 b))) ä¸¤ä¸ªç‰ˆæœ¬å¯¹æ¯”ä¸€ä¸‹(æ–‡ä»¶å¤§å°100MB)ï¼š\nOld version Sequences version wc æ—¶é—´ 4.6s 0.8s 0.4s å³°å€¼å†…å­˜ 132M 115M 1M ç»è¿‡Sequencesé‡æ„ä¹‹åï¼Œæ‰§è¡Œæ—¶é—´æœ‰äº†å·¨å¤§çš„æå‡ï¼Œå¹¶ä¸”æœ€å¤§å†…å­˜ä½¿ç”¨é‡ä¹Ÿæœ‰æ‰€å‡å°‘ï¼Œä¸è¿‡ä¸wcè¿˜æ˜¯æœ‰ä¸å°‘å·®è·ã€‚å¸Œæœ›æœ‰ä¸€å¤©èƒ½å¤Ÿæ‰¾åˆ°è¶…è¶Šwcçš„æ–¹æ³•ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":3,"section":"posts","summary":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œ","tags":["racket"],"title":"ä¸åˆ°60è¡Œä»£ç ï¼Œç”¨Racketå®ç°wcå‘½ä»¤","uri":"https://lvsq.net/2021/08/racket-wc/","year":"2021"},{"content":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…çš„å­—èŠ‚æ•°ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™å¯¹äºæˆ‘ä»¬è°ƒè¯•å’Œä¼˜åŒ–ä»£ç å¾ˆæœ‰å¸®åŠ©ï¼Œä¸è¿‡Matthew Flattå¹¶æ²¡æœ‰æ‰“ç®—å°†Racketçš„timeå‡½æ•°æ·»åŠ è¿™ä¸€åŠŸèƒ½ï¼Œå°½ç®¡å¦‚æ­¤ï¼ŒMatthew Flattæä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œåªæ˜¯ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚\nChez Schemeçš„timeå‡½æ•°æ‰“å°çš„æ ¼å¼å¦‚ä¸‹ï¼š\n19 collections\n0.201254290s elapsed cpu time, including 0.183228711s collecting\n0.201678000s elapsed real time, including 0.183665000s collecting\n160012160 bytes allocated, including 113015168 bytes reclaimed\nä¸€ä¸‹æ˜¯æ”¹è¿›çš„timeå‡½æ•°ï¼Œåå­—å«time2:\n(define (time2 proc lst) (let ([mem-before (current-memory-use \u0026#39;cumulative)]) (let-values ([(r cpu-time real-time gc-time) (time-apply proc lst)]) (let ([mem-now (current-memory-use \u0026#39;cumulative)]) (values r (format \u0026#34;~ams elapsed cpu time\u0026#34; cpu-time) (format \u0026#34;~ams elapsed real time\u0026#34; real-time) (format \u0026#34;~ams elapsed gc time\u0026#34; gc-time) (format \u0026#34;~a bytes allocated\u0026#34; (- mem-now mem-before))))))) \u0026gt; (time2 make-list \u0026#39;(10000000 0)) \u0026#34;177ms elapsed cpu time\u0026#34; \u0026#34;178ms elapsed real time\u0026#34; \u0026#34;153ms elapsed gc time\u0026#34; \u0026#34;160100112 bytes allocated\u0026#34; (time2 make-bytes \u0026#39;(10000)) \u0026#34;0ms elapsed cpu time\u0026#34; \u0026#34;0ms elapsed real time\u0026#34; \u0026#34;0ms elapsed gc time\u0026#34; \u0026#34;10544 bytes allocated\u0026#34; åˆ†é…çš„å­—èŠ‚æ•°ä¸ä¼šéå¸¸ç²¾ç¡®ï¼Œæ¯”å¦‚æ²¡æœ‰è€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œä¸è¿‡åœ¨REPLä¸­å€’æ˜¯å¯ä»¥ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šæœ‰å¤ªå¤§çš„åå·®ã€‚\ncurrent-memory-useå’Œcustodian\ncurrent-memory-useå‡½æ•°çš„å‚æ•°æœ‰3ç§æ¨¡å¼ï¼š\n(current-memory-use [mode]) â†’ exact-nonnegative-integer?\nmode : (or/c #f \u0026lsquo;cumulative custodian?) = #f\nç¬¬ä¸‰ç§modeå«åš custodian? ï¼Œ è¿™æ˜¯Racketæä¾›çš„ä¸€ç§ç›‘æŠ¤æœºåˆ¶.\ncustodian å¯ä»¥ç”¨æ¥ç®¡ç†ä¸€ç»„çº¿ç¨‹ã€æ–‡ä»¶æµç«¯å£ã€TCPç«¯å£ã€TCPç›‘å¬å™¨ã€UDP socketsã€å­—èŠ‚è½¬æ¢å™¨ã€placeã€‚å½“çº¿ç¨‹æˆ–è€…ç«¯å£ç­‰ç­‰è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ç½®äº(current-custodian)çš„ç›‘æŠ¤ä¹‹ä¸‹ï¼Œé™¤äº†root custodian, æ¯ä¸€ä¸ªcustodianéƒ½å¤„äºå…¶çˆ¶çº§çš„custodiançš„ç®¡ç†ä¹‹ä¸‹ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå±‚æ¬¡ç»“æ„ã€‚\nå½“ä¸€ä¸ªcustodianè¢«( custodian-shutdown-all )å…³é—­æ—¶ï¼Œå®ƒä¼šç«‹å³ä¸”å¼ºåˆ¶ç»ˆç»“å…¶ä¸‹ç®¡ç†çš„çº¿ç¨‹ã€ç«¯å£ç­‰ç­‰ã€‚\ncustodianåœ¨å¾ˆå¤šåœºæ™¯ä¸­å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç”¨äºé‡Šæ”¾èµ„æºï¼š\n#lang racket (define done-chan (make-channel)) (define (print-hello) (define my-cust (make-custodian)) ;; å®šä¹‰ç›‘æŠ¤äºº,ä¾¿äºæ¸…ç†æ‰€æœ‰ç›¸å…³èµ„æº (parameterize ([current-custodian my-cust]) (thread (lambda () (let loop () (displayln \u0026#34;Hello\u0026#34;) (sleep 3) (loop)))) (thread (lambda () (let loop () (define item (channel-get done-chan)) (custodian-shutdown-all my-cust)))))) (print-hello) ;; (channel-put done-chan #t) è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªcustodianï¼Œ å¹¶å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ç”±è¿™ä¸ªcustodianç®¡ç†ï¼ˆ(parameterize ([current-custodian my-cust]))ï¼‰ã€‚ä¸€ä¸ªçº¿ç¨‹æ¯éš”3ç§’é’Ÿæ‰“å°ä¸€ä¸ªâ€œHelloâ€ï¼Œæ°¸ä¸åœæ­¢ã€‚å¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…done-chan æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ¶ˆæ¯ï¼Œåˆ™å…³é—­custodian, åŒæ—¶å…³é—­è¿™ä¸ªcustodianä¸‹çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±é‡Šæ”¾äº†èµ„æºã€‚\ncustodianè¿˜å¯ä»¥ç”¨æ¥é™åˆ¶å†…å­˜çš„ä½¿ç”¨é‡ï¼š\n(custodian-limit-memory (current-custodian) (* 2 1024)) (define x (make-bytes (* 4 1024))) è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šæç¤ºout of memoryï¼ˆåœ¨REPLæ— æ•ˆï¼‰ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":4,"section":"posts","summary":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…","tags":["racket"],"title":"æ”¹è¿›Racketçš„timeå‡½æ•°","uri":"https://lvsq.net/2021/07/racket-time-improvement/","year":"2021"},{"content":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š\n(thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰:\n(define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©ç”¨therad-waitæ¥ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæˆ.\n(define worker (thread (lambda () (for ([i 100]) (printf \u0026#34;Working hard... ~a~n\u0026#34; i))))) (thread-wait worker) (displayln \u0026#34;Worker finished\u0026#34;) Thread Mailboxes æ¯ä¸ªçº¿ç¨‹å…·å¤‡ä¸€ä¸ªé‚®ç®±æ¥æ¥å—æ¶ˆæ¯ï¼Œthread-sendç”¨äºå¼‚æ­¥åœ°å‘ä¸€ä¸ªçº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œthread-receiveå¯è·å–é‚®ç®±ä¸­æœ€è€çš„æ¶ˆæ¯,å¦‚æœ‰å¿…è¦çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ã€‚ è¿™å°±æ˜¯Actorå¹¶å‘æ¨¡å‹ï¼ŒErlangä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ¨¡å‹ã€‚\n(define worker-thread (thread (lambda () (let loop () (match (thread-receive) [(? number? num) (printf \u0026#34;Processing ~a~n\u0026#34; num) (loop)] [\u0026#39;done (printf \u0026#34;Done~n\u0026#34;)]))))) (for ([i 20]) (thread-send worker-thread i)) (thread-send worker-thread \u0026#39;done) (thread-wait worker-thread) Semaphores ç”¨äºåŒæ­¥ã€‚\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (semaphore-wait output-semaphore) (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i) (semaphore-post output-semaphore))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) æˆ–è€…ä½¿ç”¨call-with-semaphoreï¼Œä¸ç”¨æ˜¾å¼åœ°é‡Šæ”¾ä¿¡å·é‡\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (call-with-semaphore output-semaphore (lambda () (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i))))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) Channels é€šé“ç”¨äºçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®,Golangé‡‡å–çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚\nchannel-putç”¨æ¥å‘é€æ•°æ®åˆ°é€šé“ï¼Œchannel-getå¯ä»¥ä»é€šé“ä¸­è·å–æ•°æ®.\n(define result-channel (make-channel)) (define result-thread (thread (lambda () (let loop () (display (channel-get result-channel)) (loop))))) (define work-channel (make-channel)) (define (make-worker thread-id) (thread (lambda () (let loop () (define item (channel-get work-channel)) (case item [(DONE) (channel-put result-channel (format \u0026#34;Thread ~a done\\n\u0026#34; thread-id))] [else (channel-put result-channel (format \u0026#34;Thread ~a processed ~a\\n\u0026#34; thread-id item)) (loop)]))))) (define work-threads (map make-worker \u0026#39;(1 2))) (for ([item \u0026#39;(A B C D E F G H DONE DONE)]) (channel-put work-channel item)) (for-each thread-wait work-threads) (channel-put result-channel \u0026#34;\u0026#34;) ; waits until result-thread has printed all other output ç¼“å†²å¼‚æ­¥é€šé“Buffered Asynchronous Channels ä¸ä¸Šè¿°çš„channelç±»ä¼¼ï¼Œåªæ˜¯BACä¼šæœ‰ä¸€å®šçš„ç¼“å†²åŒºï¼Œä¸€èˆ¬ä¸ä¼šè¢«é˜»å¡ï¼Œé™¤éç¼“å†²åŒºæ»¡äº†ï¼ˆputæ“ä½œï¼‰æˆ–è€…ç©ºï¼ˆgetæ“ä½œï¼‰.\n(require racket/async-channel) (define print-thread (thread (lambda () (let loop () (displayln (thread-receive)) (loop))))) (define (safer-printf . items) (thread-send print-thread (apply format items))) (define work-channel (make-async-channel 3)) (define (make-worker-thread thread-id) (thread (lambda () (let loop () (define item (async-channel-get work-channel)) (safer-printf \u0026#34;Thread ~a processing item: ~a\u0026#34; thread-id item) (loop))))) (for-each make-worker-thread \u0026#39;(1 2 3)) (for ([item \u0026#39;(a b c d e f g h i j k l m)]) (async-channel-put work-channel item)) åŒæ­¥äº‹ä»¶å’Œsync (define main-thread (current-thread)) (define alarm (alarm-evt (+ 3000 (current-inexact-milliseconds)))) (define channel (make-channel)) (define (make-worker-thread thread-id) (thread (lambda () (define evt (sync channel alarm)) (cond [(equal? evt alarm) (thread-send main-thread \u0026#39;alarm)] [else (thread-send main-thread (format \u0026#34;Thread ~a received ~a\u0026#34; thread-id evt))])))) (make-worker-thread 1) (make-worker-thread 2) (make-worker-thread 3) (channel-put channel \u0026#39;A) (channel-put channel \u0026#39;B) (let loop () (match (thread-receive) [\u0026#39;alarm (displayln \u0026#34;Done\u0026#34;)] [result (displayln result) (loop)])) æ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":5,"section":"posts","summary":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š (thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰: (define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©","tags":["racket","thread"],"title":"Racket å¹¶å‘ä¸åŒæ­¥","uri":"https://lvsq.net/2021/07/racket-concurrency/","year":"2021"},{"content":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set!\né€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ª.rkt æ–‡ä»¶é‡Œçš„å†…å®¹å±äºæŸä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åå°±æ˜¯æ–‡ä»¶åã€‚\nåœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼šmod_demo\nâ”œâ”€â”€ mod_demo\nâ”‚ â”œâ”€â”€ ext\nâ”‚ â”‚ â””â”€â”€ cake.rkt\nâ”‚ â””â”€â”€ main.rkt\nmod_demoç›®å½•ä¸‹æœ‰ä¸€ä¸ªmain.rktæ¨¡å—ï¼Œå’Œä¸€ä¸ªextç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªcake.rktçš„æ¨¡å—ã€‚\ncake.rktçš„å†…å®¹å¦‚ä¸‹ï¼š\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (provide print-cake) æ„å‘³ç€å°†å‡½æ•°print-cakeå¯¼å‡ºï¼Œåœ¨æ¨¡å—å¤–éƒ¨å°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°äº†ï¼›è¿˜æœ‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°show, è¯¥å‡½æ•°æœªå¯¼å‡ºï¼Œæ‰€ä»¥å¤–éƒ¨æ— æ³•è®¿é—®ã€‚ main.rktçš„å†…å®¹ä¸ºï¼š\n#lang racket (require \u0026#34;ext/cake.rkt\u0026#34;) (print-cake (random 30)) (require \u0026ldquo;ext/cake.rkt\u0026rdquo;) å°†cakeæ¨¡å—å¼•å…¥ï¼Œå¼•ç”¨è·¯å¾„ç¬¦åˆUnixé£æ ¼(ä½†æ˜¯ï¼Œä¸èƒ½ä»¥æ–‡ä»¶åˆ†éš”ç¬¦å³\u0026rsquo;/\u0026lsquo;ä½œä¸ºå¼€å§‹æˆ–è€…ç»“æŸ)ï¼Œä¹Ÿæ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œ(require \u0026ldquo;./ext/cake.rkt\u0026rdquo;) ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚\nCollections collectionä¸­çš„æ¨¡å—é€šè¿‡ä¸å¸¦å¼•å·çš„ã€æ— åç¼€çš„è·¯å¾„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼šä»¥ä¸‹æ¨¡å—å¼•ç”¨äº†ä½œä¸ºâ€œracketâ€ collectionä¸€éƒ¨åˆ†çš„â€œdate.rktâ€åº“ï¼š\n#lang racket (require racket/date) (printf \u0026#34;Today is ~s\\n\u0026#34; (date-\u0026gt;string (seconds-\u0026gt;date (current-seconds)))) æ³¨æ„ï¼Œ(require racket/date)æ²¡æœ‰å¸¦åŒå¼•å·ã€‚åƒracket/dateè¿™æ ·çš„æ¨¡å—çœ‹èµ·æ¥åƒä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå½“requireçœ‹åˆ°ä¸€ä¸ªæœªåŠ å¼•å·çš„æ¨¡å—å¼•ç”¨æ—¶ï¼Œå®ƒä¼šå°†å¼•ç”¨è½¬æ¢ä¸ºåŸºäºcollectionçš„æ¨¡å—è·¯å¾„ï¼š\né¦–å…ˆï¼Œå¦‚æœæœªå¼•ç”¨çš„è·¯å¾„ä¸åŒ…å« /ï¼Œç„¶å requireä¼šè‡ªåŠ¨å‘å¼•ç”¨æ·»åŠ ä¸€ä¸ªâ€œ/mainâ€ã€‚ä¾‹å¦‚ï¼Œ( require slideshow )ç­‰æ•ˆäº( require slideshow/main )ã€‚ å…¶æ¬¡ï¼Œrequire å‘è·¯å¾„éšå¼æ·»åŠ äº†â€œ.rktâ€åç¼€ã€‚ æœ€åï¼Œrequireé€šè¿‡åœ¨å·²å®‰è£…çš„collectionä¸­æœç´¢æ¥è§£æè·¯å¾„ï¼Œè€Œä¸æ˜¯å°†è·¯å¾„è§†ä¸ºç›¸å¯¹äºå°é—­æ¨¡å—çš„è·¯å¾„ã€‚ Packages and Collections ä¸€ä¸ªpackageæ˜¯ä¸€ç»„é€šè¿‡RacketåŒ…ç®¡ç†å™¨å®‰è£…çš„åº“çš„é›†åˆã€‚Racket ç¨‹åºä¸ç›´æ¥å¼•ç”¨åŒ…ã€‚ç›¸åï¼Œç¨‹åºé€šè¿‡collectionså¼•ç”¨åº“ï¼Œå¹¶ä¸”æ·»åŠ æˆ–åˆ é™¤åŒ…ä¼šæ›´æ”¹å¯ç”¨çš„åŸºäºé›†åˆçš„åº“é›†ã€‚\næ·»åŠ Collections libraryçš„æ—¨åœ¨è·¨å¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œå› æ­¤å°†åº“çš„æºæ–‡ä»¶ä¿å­˜åœ¨ä¸€ä¸ªç›®å½•ä¸­å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œæ›´ä¸èƒ½å°†åº“å¤åˆ¶åˆ°ä¸åŒçš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯æ–°å¢ä¸€ä¸ªcollectionï¼Œå°†libæ”¾åœ¨collectionä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸å¸¦å¼•å·çš„è·¯å¾„å¼•ç”¨å®ƒï¼Œå°±åƒRacket å‘è¡Œç‰ˆä¸­åŒ…å«çš„åº“ä¸€æ ·ã€‚\nä¸ç”¨æ‹…å¿ƒï¼Œåˆ›å»ºä¸€ä¸ªåŒ…æ— éœ€æäº¤åˆ°å…¬å¼€çš„åŒ…æœåŠ¡å™¨ï¼Œå¯ä»¥å®‰è£…åˆ°æœ¬åœ°æ¥ä½¿ç”¨ã€‚\né‡‡ç”¨raco pkgå‘½ä»¤è¡Œå·¥å…·ï¼š raco pkg install \u0026ndash;link /path/to/mod_demo\nå®‰è£…ä¹‹åï¼Œåœ¨ä»»ä½•æ¨¡å—ä¸­ä½¿ç”¨(require mod_demo/ext/cake)éƒ½ä¼šä»/path/to/mod_demo/ext/cake.rktå¯¼å…¥print-cakeå«å‡½æ•°ã€‚\n\u0026gt; (require mod_demo/ext/cake) \u0026gt; (print-cake 4) ...... .-||||||-. | | ------------ \u0026gt; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å®‰è£…çš„ç›®å½•åç§°æ—¢ç”¨ä½œåŒ…åç§°åˆç”¨ä½œåŒ…æä¾›çš„collection\nå°†libæ”¾å…¥collectionä¹‹åï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨raco makeæ¥ç¼–è¯‘åº“çš„æºæ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨raco setupæ›´åŠ æ–¹ä¾¿ã€‚å°¤å…¶æ˜¯ä¿®æ”¹äº†æ¨¡å—ä»£ç åï¼Œä½¿ç”¨raco setupä¼šé‡æ–°ç¼–è¯‘æ‰€æœ‰åº“æ–‡ä»¶ï¼Œå¹¶é‡æ–°å®‰è£…åŒ…ã€‚ä¸raco makeä¸åŒçš„æ˜¯ï¼Œraco setup åé¢çš„å‚æ•°æ˜¯åŒ…åï¼Œå³raco setup mod_demo, è€Œraco makeåé¢æ˜¯æ¨¡å—åï¼Œå³raco make main.rktã€‚\næ¨¡å—è¯­æ³• æ¨¡å—æ–‡ä»¶å¼€å¤´å¤„çš„#langå…¶å®æ˜¯æ¨¡å—å½¢å¼çš„ç®€å†™ï¼Œä½†ä¸èƒ½ç”¨äºREPLã€‚\næ¨¡å—å½¢å¼ æ™®é€šå½¢å¼çš„æ¨¡å—å£°æ˜ï¼Œå¯ä»¥å·¥ä½œäºREPL\n(module name-id initial-module-path decl \u0026hellip;)\nname-idæ˜¯æ¨¡å—çš„åå­—ï¼Œinitial-module-path ä¸ºåˆå§‹åŒ–å¯¼å…¥ï¼Œæ¯ä¸ªdeclå¯ä»¥æ˜¯å¯¼å…¥ï¼Œæˆ–è€…å¯¼å‡ºï¼Œæˆ–è€…å®šä¹‰ï¼Œæˆ–è€…è¡¨è¾¾å¼ã€‚\ninitial-module-pathæ˜¯å¿…é¡»çš„ï¼Œæ¨¡å—å†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªç¯å¢ƒï¼ˆSICPä¸­çš„ç¯å¢ƒï¼Œå³ä¸Šä¸‹æ–‡ï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨çš„æŒ‡ä»¤æ˜¯éœ€è¦é€šè¿‡initial-module-pathå¼•å¯¼çš„ã€‚å¸¸ç”¨çš„initial-module-pathæ˜¯racket, require/define/provideç­‰ç­‰éƒ½æ¥è‡ªracketã€‚å¦ä¸€ä¸ªå¸¸ç”¨çš„initial-module-pathæ˜¯racket-base,å®ƒæä¾›çš„åŠŸèƒ½è¾ƒå°‘ï¼Œä½†ä»ç„¶æ˜¯å¾ˆå¸¸ç”¨ã€‚\nä¸Šä¸€èŠ‚ä¸­çš„â€œcake.rktâ€ä¹Ÿå¯ä»¥å†™æˆï¼š\n(module cake racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline))) è¿™ç§æ¨¡å—å½¢å¼æ˜¯å¯ä»¥è¢«REPLæ±‚å€¼çš„ï¼ˆæ³¨æ„(require \u0026lsquo;cake)ï¼Œ æ¨¡å—åcakeéœ€è¦è¢«quoteï¼Œå› ä¸ºè¿™æ—¶cakeæ˜¯éæ–‡ä»¶çš„æ¨¡å—å£°æ˜ï¼‰ï¼š\n\u0026gt; (require \u0026#39;cake) \u0026gt; (print-cake 3) ... .-|||-. | | --------- å£°æ˜ä¸€ä¸ªæ¨¡å—ï¼Œå…¶bodyä¸ä¼šè¢«ç«‹åˆ»æ±‚å€¼ï¼Œåªæœ‰åœ¨æ˜¾å¼åœ°è¢«requireä¹‹åæ‰ä¼šæ±‚å€¼ä¸€æ¬¡ã€‚\n\u0026gt; (module hi racket (printf \u0026#34;Hello\\n\u0026#34;)) \u0026gt; (require \u0026#39;hi) Hello \u0026gt; (require \u0026#39;hi) #lang #langå£°æ˜çš„æ¨¡å—çš„bodyæ²¡æœ‰ç‰¹å®šçš„è¯­æ³•ï¼Œå› ä¸ºå…¶è¯­æ³•ç”±#langä¹‹åçš„åç§°æ‰€å†³å®šã€‚\næ¯”å¦‚ï¼Œ#lang racketçš„è¯­æ³•æ˜¯ï¼š\n#lang racket decl ... ç­‰åŒäºï¼š\n(module name racket decl ...) nameæ˜¯åŒ…å«#langå½¢å¼çš„æ–‡ä»¶å\nå­æ¨¡å— ä¸€ä¸ªæ¨¡å—å¯ä»¥åµŒå¥—åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œçˆ¶æ¨¡å—å¯ä»¥ç›´æ¥è®¿é—®å­æ¨¡å—å¯¼å‡ºçš„å‡½æ•°ã€å®šä¹‰ã€è¡¨è¾¾å¼ã€‚\n#lang racket (module zoo racket (provide tiger) (define tiger \u0026#34;Tony\u0026#34;)) (require \u0026#39;zoo) tiger module* module*å½¢å¼ç±»ä¼¼moduleï¼š\n(module* name-id initial-module-path-or-#f decl ...) module*ä¸moduleçš„ä¸åŒä¹‹å¤„åœ¨äºï¼š\nç”±moduleå£°æ˜çš„å­æ¨¡å—ï¼Œå¯ä»¥è¢«å…¶çˆ¶æ¨¡å—require, ä½†æ˜¯å­æ¨¡å—ä¸èƒ½requireçˆ¶æ¨¡å—ï¼› ç”±module*å£°æ˜çš„å­—æ¨¡å—ï¼Œå¯ä»¥requireçˆ¶æ¨¡å—ï¼Œä½†æ˜¯çˆ¶æ¨¡å—ä¸èƒ½requireè¯¥å­æ¨¡å—ï¼› æ­¤å¤–ï¼Œmodule*å½¢å¼å¯ä»¥ç”¨#fä»£æ›¿initial-module-pathï¼Œè¿™æ„å‘³ç€ï¼Œå­æ¨¡å—å¯ä»¥è®¿é—®çˆ¶æ¨¡å—æ‰€ä»¥ç»‘å®šï¼ŒåŒ…æ‹¬æœªé€šè¿‡provideå¯¼å‡ºçš„ç»‘å®šã€‚\nå› æ­¤ï¼Œç”¨module*å’Œ#fæ¥å£°æ˜ä¸€ä¸ªæ¨¡å—çš„ä¸€ä¸ªç”¨é€”æ˜¯ï¼Œå°†æŸä¸ªæ¨¡å—æœªprovideå‡ºå»çš„ç»‘å®šå¯¼å‡ºã€‚\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* extras #f (provide show)) å°½ç®¡showå‡½æ•°æœªå¯¼å‡ºï¼Œä½†æ˜¯å­æ¨¡å—extraså´å°†å…¶å¯¼å‡ºäº†ï¼Œå¤–éƒ¨ç¨‹åºå¯ä»¥ä½¿ç”¨(require (submod \u0026ldquo;caske.rkt\u0026rdquo; extras))æ¥è®¿é—®éšè—çš„showå‡½æ•°ã€‚\nMainå’ŒTestå­æ¨¡å— #lang racket (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* main #f (print-cake 10)) è¿™ä¸ªâ€œcake.rktâ€å˜ä½“ï¼ŒåŒ…å«äº†ä¸€ä¸ªmainå­æ¨¡å—ï¼Œå¹¶è°ƒç”¨äº†print-cakeå‡½æ•°ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œè¿è¡Œä¸€ä¸ªæ¨¡å—æ—¶å¹¶ä¸ä¼šè¿è¡Œå…¶ä¸­ç”±module*å£°æ˜çš„å­æ¨¡å—ï¼Œä½†æ˜¯mainå­æ¨¡å—é™¤å¤–ã€‚\nmainå­æ¨¡å—å¹¶ä¸ä¸€å®šç”±module*å£°æ˜ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨çˆ¶æ¨¡å—çš„ç»‘å®šï¼Œä¹Ÿå¯ä»¥ç”±moduleæ¥å£°æ˜ã€‚ æ›´å¸¸è§çš„åšæ³•æ˜¯ç”±module+æ¥å£°æ˜\n``lisp (module+ name-id decl \u0026hellip;)\nmodule+å£°æ˜çš„æ¨¡å—å°±åƒé‡‡ç”¨module*å£°æ˜ä¸”ä½¿ç”¨#fä½œä¸ºinitial-module-pathçš„æ¨¡å—ã€‚æ­¤å¤–ï¼Œå¤šä¸ªmodule+æ¨¡å—å¯ä»¥åŒåï¼ŒåŒåçš„æ¨¡å—ä¼šç»„åˆæˆä¸€ä¸ªæ¨¡å—ã€‚è¿™ç§ç»„åˆç‰¹æ€§å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªtestæ¨¡å—ï¼Œåœ¨ä½¿ç”¨ raco testå‘½ä»¤æ—¶å°±å¯ä»¥å¤§æ˜¾èº«æ‰‹äº†ã€‚ å‡è®¾\u0026#34;physics.rkt\u0026#34; ä¸ºï¼š ```lisp #lang racket (module+ test (require rackunit) (define Îµ 1e-10)) (provide drop to-energy) (define (drop t) (* 1/2 9.8 t t)) (module+ test (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ)) (define (to-energy m) (* m (expt 299792458.0 2))) (module+ test (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) å¯¼å…¥\u0026quot;physics.rkt\u0026quot; æ—¶ï¼Œå¹¶ä¸ä¼šè¿è¡Œdropå’Œto-energyçš„æµ‹è¯•ï¼Œä¸è¿‡è¿è¡Œraco test physics.rktå°†ä¼šæ‰§è¡Œè¿™äº›æµ‹è¯•ã€‚\nè¿™ç­‰ä»·äºä½¿ç”¨module*:\n#lang racket (provide drop to-energy) (define (drop t) (* 1/2 49/5 t t)) (define (to-energy m) (* m (expt 299792458 2))) (module* test #f (require rackunit) (define Îµ 1e-10) (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ) (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) module+çš„ç»„åˆè¡Œä¸ºå¯¹mainæ¨¡å—ä¹Ÿæœ‰å¸®åŠ©ï¼Œå³ä½¿ä¸éœ€è¦ç»„åˆï¼Œ ( module+ main \u0026hellip;. )ä¹Ÿæ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒæ¯”( module* main #f \u0026hellip;. )æ›´å…·å¯è¯»æ€§ ã€‚\nRequire requireçš„å®šä¹‰ä¸ºï¼š\n(require require-spec \u0026hellip;)\nonly-in ç”¨æ¥é™åˆ¶æ¨¡å—å¯¼å‡ºçš„ç»‘å®šï¼Œä¹Ÿå¯é‡å‘½åç»‘å®š\n\u0026gt; (module m (lib \u0026#34;racket\u0026#34;) (provide tastes-great? less-filling?) (define tastes-great? #t) (define less-filling? #t)) \u0026gt; (require (only-in \u0026#39;m tastes-great?)) \u0026gt; tastes-great? #t \u0026gt; less-filling? less-filling?: undefined; cannot reference an identifier before its definition in module: top-level \u0026gt; (require (only-in \u0026#39;m [less-filling? lite?])) \u0026gt; lite? #t except-in æ˜¯only-inçš„è¡¥å……ï¼Œç”¨æ¥æ’é™¤æŸäº›ç»‘å®š\n(except-in require-spec id \u0026hellip;)\nrename-in ä¸only-inç±»ä¼¼ã€‚\n(rename-in require-spec [orig-id bind-id] \u0026hellip;)\nprefix-in (prefix-in prefix-id require-spec) ç»™æ¯ä¸€ä¸ªrequire-specçš„ç»‘å®šæ·»åŠ å‰ç¼€\nProvide (provide provide-spec \u0026hellip;)\nprovide-specå…è®¸é€’å½’å®šä¹‰ï¼š\nid: æœ€ç®€å•çš„å½¢å¼ï¼Œä¸Šæ–‡ä¸­å¤šæ¬¡å‡ºç°\n(rename-out [orig-id export-id] \u0026hellip;): é‡å‘½åå¯¼å‡ºçš„ç»‘å®š\n(struct-out struct-id): å¯¼å‡ºstruct\n(all-defined-out): å¯¼å‡ºæ‰€æœ‰ç»‘å®šï¼Œä¸æ¨è\n(all-from-out module-path): å¯¼å‡ºæ‰€æœ‰ç”±module-pathæŒ‡å®šçš„ç»‘å®š\n(except-out provide-spec id \u0026hellip;): æ’é™¤idæŒ‡å®šçš„ç»‘å®š\n(prefix-out prefix-id provide-spec)ï¼šç»™æ¯ä¸ªå¯¼å‡ºç»‘å®šæ·»åŠ ä¸€ä¸ªå‰ç¼€\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":6,"section":"posts","summary":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set! é€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥","tags":["racket","module"],"title":"Racket Modules","uri":"https://lvsq.net/2021/07/racket-modules/","year":"2021"},{"content":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜:\nç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ içš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º(i, $a_i$) å’Œ (i, 0) ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\nè¯´æ˜ï¼šä¸èƒ½å€¾æ–œå®¹å™¨\næ›´è¯¦ç»†çš„æè¿°è¯·è®¿é—®ï¼šhttps://leetcode-cn.com/problems/container-with-most-water/\né¦–å…ˆå¯ä»¥æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯æš´åŠ›æ±‚è§£ï¼Œå°†æ‰€æœ‰çš„é¢ç§¯éƒ½è®¡ç®—å‡ºæ¥ï¼Œå–æœ€å¤§å€¼å³å¯ã€‚ä¸‹é¢ç»™å‡º(Racket)[https://racket-lang.org/]çš„ä»£ç ï¼Œå¾—ç›Šäºå‡½æ•°å¼è¯­è¨€å’ŒSè¡¨è¾¾å¼å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œä»£ç å¯ä»¥å¾ˆçŸ­ï¼š\n(define/contract (max-area height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define len (length height)) (cond ((\u0026lt; len 2) 0) ((= len 2) (area (list 1 (car height)) (list 2 (cadr height)))) (else (max (each-area height) (max-area (cdr height)))))) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (define (each-area height) (let ([first (list 1 (car height))]) (foldl max 0 (map (lambda (i h) (area first (list i h))) (range 2 (add1 (length height)) ) (cdr height))))) ä¸Šè¿°è§£æ³•è™½ç„¶æ­£ç¡®ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½, å¦‚æœæœ‰10000ä¸ªæ•´æ•°ï¼Œå³n=10000ï¼Œå…¶æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†2ç§’ï¼š\n(time (max-area (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 2387 real time: 2466 gc time: 137 é‚£ä¹ˆæœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•å—ï¼Ÿ\næ˜¾ç„¶å¯ä»¥è®¤ä¸ºæ‰€æœ‰æ•´æ•°éƒ½ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨æˆ–è€…æ•°ç»„ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå«headï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªæ•´æ•°, è¡¨ç¤ºä¸ºï¼šhead -\u0026gt; (i, $h_i$)ï¼Œiä¸ºåˆ—è¡¨ä¸‹æ ‡ï¼Œ $h_i$ä»£è¡¨ç¬¬iä¸ªæ•´æ•°å€¼ï¼›å¦ä¸€ä¸ªå«tailï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸ºtail -\u0026gt; (j, $h_j$)ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…åˆ©ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨ï¼Œå°±èƒ½è®¡ç®—å‡ºæœ€å¤§çš„é¢ç§¯ï¼Œå…¶è¿‡ç¨‹ä¸ºï¼š\nè®¡ç®—ç”±headå’Œtailå›´æˆçš„çŸ©å½¢çš„é¢ç§¯$S_{ij}$, çŸ©å½¢çš„é•¿åº¦x = j - i, é«˜åº¦y = min ($h_i$, $h_j$); å°†çŸ©å½¢æ”¶çª„ä¸€æ ¼ï¼Œå³xå‡å°‘1ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æ”¶çª„æ–¹å¼ï¼š å°†é«˜åº¦çŸ­çš„ä¸€ä¾§æ”¶çª„ï¼Œé‚£ä¹ˆï¼Œæ”¶çª„åé«˜åº¦å¯èƒ½å˜å¤§ï¼Œåˆ™é¢ç§¯å¯èƒ½å¢å¤§; å°†é«˜åº¦é•¿çš„ä¸€ä¾§æ”¶çª„ï¼Œç”±äºå¦ä¸€ä¾§ä¸å˜,ä½†æ˜¯é•¿åº¦å˜å°äº†ä¸€æ ¼ï¼Œåˆ™é¢ç§¯ä¼šå˜å°; å› æ­¤ï¼Œéœ€è¦ç§»åŠ¨é«˜åº¦çŸ­çš„ä¸€ä¾§ï¼Œæ‰æœ‰å¯èƒ½æ‰¾åˆ°é¢ç§¯æ›´å¤§çš„çŸ©å½¢ å¾ˆæ˜¾ç„¶ï¼Œä½¿ç”¨åŒæŒ‡é’ˆç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†$O(n)$ã€‚\nRacket ç‰ˆæœ¬ ;;better solution (define/contract (max-area-pair-pointer height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (let ([len (length height)]) (if (\u0026lt; len 2) 0 (let loop ([h height] [hindex (range 0 len)] [rheight (reverse height)] [rindex (reverse (range 0 len))] [maxa 0]) (let* ([head (list (car hindex) (car h))] [tail (list (car rindex) (car rheight))] [a (area head tail)]) (if (= (car head) (car tail)) maxa (if (\u0026gt; (cadr head) (cadr tail)) (loop h hindex (cdr rheight) (cdr rindex) (max maxa a)) (loop (cdr h) (cdr hindex) rheight rindex (max maxa a))) )))))) å¦‚æœä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¡ç®—10000ä¸ªæ•´æ•°çš„é¢ç§¯ï¼Œæ‰§è¡Œæ—¶é—´åªéœ€1æ¯«ç§’ï¼Œè€Œä¸”ä¸éœ€è¦GCï¼ˆå¯¹ç…§æš´åŠ›ç ´è§£ç‰ˆæœ¬ï¼Œ2+ç§’ï¼‰\n(time (max-area-pair-pointer (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 1 real time: 1 gc time: 0 Rustç‰ˆæœ¬ åŒæ—¶æä¾›ä¸€ä¸ªRustç‰ˆæœ¬çš„å®ç°ï¼Œ\nuse std::cmp::{max, min}; type HeightType = i64; #[derive(Debug)] struct Solution {} impl Solution { pub fn max_area(height: Vec\u0026lt;HeightType\u0026gt;) -\u0026gt; HeightType { let len = height.len(); return if len \u0026lt; 2 { 0 } else { let mut max_area = 0; let mut hi = 0; let mut ti = len - 1; while ti \u0026gt; hi { let hd = height.get(hi).unwrap(); let td = height.get(ti).unwrap(); let a = ((ti - hi) as HeightType) * min(hd, td); max_area = max(max_area, a); if hd \u0026lt; td { hi += 1; } else { ti -= 1; } } max_area }; } } ä¸¤ä¸ªç‰ˆæœ¬åšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒï¼š\nsize Racket(8.0 CS) Rust(1.50.0) 100000 49ms 60ms 1000000 560ms 550ms 10000000 5s 5.6s ä¸¤ä¸ªç‰ˆæœ¬çš„å®ç°å‡æœªä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–,ä»¤äººæ„å¤–çš„æ˜¯Racketçš„æ‰§è¡Œæ•ˆç‡ä¸Rustå‡ ä¹æ²¡æœ‰å·®åˆ«ï¼Œä½¿ç”¨äº†CSç¼–è¯‘å™¨çš„RacketçœŸæ˜¯çªé£çŒ›è¿›ã€‚ ç”±äºæˆ‘çš„Rustç»éªŒå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæˆ–è®¸æœ‰æ›´å¥½çš„å†™æ³•ã€‚ä»æµ‹è¯•å¯ä»¥çœ‹åˆ°Racketè‡³å°‘åœ¨CPUå¯†é›†å‹åº”ç”¨ä¸­å¯å ªå¤§ç”¨ã€‚\n","id":7,"section":"posts","summary":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜: ç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨","tags":[],"title":"ã€ç››æœ€å¤šæ°´çš„å®¹å™¨ã€‘é—®é¢˜çš„æ±‚è§£","uri":"https://lvsq.net/2021/05/container-with-most-water/","year":"2021"},{"content":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚\nå®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15æ—¥\nåœ¨æŸäº›æ–¹é¢ï¼Œå­¦ä¹ è®¡ç®—æœºç¼–ç¨‹ä¸å­¦ä¹ æ–°è¯­è¨€ç›¸ä¼¼ã€‚å®ƒéœ€è¦å­¦ä¹ æ–°çš„ç¬¦å·å’Œæœ¯è¯­ï¼Œå¿…é¡»æ­£ç¡®ç»„ç»‡è¿™äº›ç¬¦å·å’Œæœ¯è¯­ä»¥æŒ‡å¯¼è®¡ç®—æœºè¯¥æ€ä¹ˆåšã€‚è®¡ç®—æœºä»£ç è¿˜å¿…é¡»è¶³å¤Ÿæ¸…æ™°ï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºå‘˜å¯ä»¥é˜…è¯»å’Œç†è§£ã€‚\nå°½ç®¡å­˜åœ¨è¿™äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œéº»çœç†å·¥å­¦é™¢çš„ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç å¹¶ä¸èƒ½æ¿€æ´»ä¸è¯­è¨€å¤„ç†æœ‰å…³çš„å¤§è„‘åŒºåŸŸã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒæ¿€æ´»äº†ä¸€ä¸ªç§°ä¸ºå¤šéœ€æ±‚ç½‘ç»œçš„åˆ†å¸ƒå¼ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¹Ÿè¢«æ‹›å‹Ÿç”¨äºè§£å†³å¤æ‚çš„è®¤çŸ¥ä»»åŠ¡ï¼Œä¾‹å¦‚è§£å†³æ•°å­¦é—®é¢˜æˆ–å¡«å­—æ¸¸æˆã€‚\nä½†æ˜¯ï¼Œå°½ç®¡é˜…è¯»è®¡ç®—æœºä»£ç ä¼šæ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œï¼Œä½†ä¸æ•°å­¦æˆ–é€»è¾‘é—®é¢˜ç›¸æ¯”ï¼Œå®ƒä¼¼ä¹æ›´å¤šåœ°ä¾èµ–äºç½‘ç»œçš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™è¡¨æ˜ç¼–ç ä¹Ÿä¸èƒ½ç²¾ç¡®åœ°å¤åˆ¶æ•°å­¦çš„è®¤çŸ¥éœ€æ±‚ã€‚\nâ€œç†è§£è®¡ç®—æœºä»£ç ä¼¼ä¹æ˜¯è‡ªå·±çš„äº‹ã€‚å®ƒä¸è¯­è¨€ä¸åŒï¼Œæ•°å­¦ä¸é€»è¾‘ä¹Ÿä¸ç›¸åŒã€‚â€éº»çœç†å·¥å­¦é™¢ç ”ç©¶ç”Ÿï¼Œè¯¥ç ”ç©¶çš„ä¸»è¦ä½œè€…å®‰å¨œÂ·ä¼Šå‡¡è¯ºå¨ƒï¼ˆAnna Ivanovaï¼‰è¯´ã€‚\nEvelina Fedorenkoï¼ŒFrederick A.å’ŒCarole J. MiddletonèŒä¸šå‘å±•ç¥ç»ç§‘å­¦å‰¯æ•™æˆï¼Œéº¦æˆˆæ–‡è„‘ç§‘å­¦ç ”ç©¶æ‰€çš„æˆå‘˜ï¼Œæ˜¯è¯¥è®ºæ–‡çš„é«˜çº§ä½œè€…ï¼Œè¯¥è®ºæ–‡ä»Šå¤©å‘è¡¨åœ¨eLifeä¸Šã€‚éº»çœç†å·¥å­¦é™¢è®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½å®éªŒå®¤å’Œå¡”å¤«èŒ¨å¤§å­¦çš„ç ”ç©¶äººå‘˜ä¹Ÿå‚ä¸äº†è¿™é¡¹ç ”ç©¶ã€‚\nè¯­è¨€ä¸è®¤çŸ¥ Fedorenkoç ”ç©¶çš„ä¸»è¦é‡ç‚¹æ˜¯è¯­è¨€ä¸å…¶ä»–è®¤çŸ¥åŠŸèƒ½ä¹‹é—´çš„å…³ç³»ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¥¹ä¸€ç›´åœ¨ç ”ç©¶å…¶ä»–åŠŸèƒ½æ˜¯å¦ä¾èµ–äºå¤§è„‘çš„è¯­è¨€ç½‘ç»œï¼ˆåŒ…æ‹¬BrocaåŒºåŸŸå’Œå¤§è„‘å·¦åŠçƒçš„å…¶ä»–åŒºåŸŸï¼‰çš„é—®é¢˜ã€‚åœ¨å…ˆå‰çš„å·¥ä½œä¸­ï¼Œå¥¹çš„å®éªŒå®¤è¡¨æ˜ï¼ŒéŸ³ä¹å’Œæ•°å­¦ä¼¼ä¹å¹¶æœªæ¿€æ´»è¯¥è¯­è¨€ç½‘ç»œã€‚\nâ€œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰å…´è¶£æ¢ç´¢è¯­è¨€å’Œè®¡ç®—æœºç¼–ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œéƒ¨åˆ†åŸå› æ˜¯è®¡ç®—æœºç¼–ç¨‹æ˜¯ä¸€ä¸ªæ–°å‘æ˜ï¼Œæˆ‘ä»¬çŸ¥é“ä¸å¯èƒ½æœ‰ä»»ä½•ç¡¬è¿çº¿æœºåˆ¶ä½¿æˆ‘ä»¬æˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œâ€ä¼Šä¸‡è¯ºå¨ƒè¯´ã€‚\nå¥¹è¯´ï¼Œå…³äºå¤§è„‘å¦‚ä½•å­¦ä¹ ç¼–ç ï¼Œå­˜åœ¨ä¸¤ç§æ€æƒ³æµæ´¾ã€‚æœ‰äººè®¤ä¸ºï¼Œè¦ç²¾é€šç¼–ç¨‹ï¼Œå°±å¿…é¡»ç²¾é€šæ•°å­¦ã€‚å¦ä¸€ä¸ªå»ºè®®è®¤ä¸ºï¼Œç”±äºç¼–ç å’Œè¯­è¨€ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè¯­è¨€æŠ€èƒ½å¯èƒ½æ›´ç›¸å…³ã€‚ä¸ºäº†é˜æ˜è¿™ä¸€é—®é¢˜ï¼Œç ”ç©¶äººå‘˜ç€æ‰‹ç ”ç©¶åœ¨é˜…è¯»è®¡ç®—æœºä»£ç æ—¶å¤§è„‘æ´»åŠ¨æ¨¡å¼æ˜¯å¦ä¼šä¸è¯­è¨€ç›¸å…³çš„å¤§è„‘æ´»åŠ¨é‡å ã€‚\nç ”ç©¶äººå‘˜åœ¨æœ¬ç ”ç©¶ä¸­é‡ç‚¹å…³æ³¨ä»¥å¯è¯»æ€§ç€ç§°çš„ä¸¤ç§ç¼–ç¨‹è¯­è¨€â€”â€”Pythonå’ŒScratchJrã€‚ScratchJrè¿™æ˜¯ä¸€ç§ä¸“ä¸º5å²åŠ5å²ä»¥ä¸Šå„¿ç«¥è®¾è®¡çš„å¯è§†åŒ–ç¼–ç¨‹è¯­è¨€ã€‚ç ”ç©¶å¯¹è±¡å‡ä¸ºç²¾é€šæµ‹è¯•è¯­è¨€çš„å¹´è½»äººã€‚å½“ç¨‹åºå‘˜èººåœ¨åŠŸèƒ½ç£å…±æŒ¯ï¼ˆfMRIï¼‰æ‰«æä»ªä¸­æ—¶ï¼Œç ”ç©¶äººå‘˜å‘ä»–ä»¬å±•ç¤ºäº†ä»£ç ç‰‡æ®µï¼Œå¹¶è¦æ±‚ä»–ä»¬é¢„æµ‹ä»£ç å°†äº§ç”Ÿä»€ä¹ˆåŠ¨ä½œã€‚\nç ”ç©¶äººå‘˜å‡ ä¹çœ‹ä¸åˆ°å¤§è„‘è¯­è¨€åŒºåŸŸå¯¹ä»£ç çš„ååº”ã€‚ç›¸åï¼Œä»–ä»¬å‘ç°ç¼–ç ä»»åŠ¡ä¸»è¦æ¿€æ´»äº†æ‰€è°“çš„å¤šéœ€æ±‚ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œçš„æ´»åŠ¨éå¸ƒæ•´ä¸ªå¤§è„‘çš„é¢å¶å’Œé¡¶å¶ï¼Œé€šå¸¸æ˜¯ä¸ºéœ€è¦åŒæ—¶è®°ä½è®¸å¤šä¿¡æ¯çš„ä»»åŠ¡è€Œæ‹›å‹Ÿçš„ï¼Œå®ƒè´Ÿè´£æˆ‘ä»¬æ‰§è¡Œå„ç§å¿ƒç†ä»»åŠ¡çš„èƒ½åŠ›ã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œå®ƒæ‰€åšçš„å‡ ä¹æ‰€æœ‰åœ¨è®¤çŸ¥ä¸Šéƒ½å…·æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ï¼Œä½¿æ‚¨éš¾ä»¥æ€è€ƒã€‚â€\nå…ˆå‰çš„ç ”ç©¶è¡¨æ˜ï¼Œæ•°å­¦å’Œé€»è¾‘é—®é¢˜ä¼¼ä¹ä¸»è¦å–å†³äºå·¦åŠçƒçš„å¤šä¸ªéœ€æ±‚åŒºåŸŸï¼Œè€Œæ¶‰åŠç©ºé—´å¯¼èˆªçš„ä»»åŠ¡æ¯”å³åŠçƒæ›´å¤šåœ°æ¿€æ´»å³åŠçƒã€‚éº»çœç†å·¥å­¦é™¢çš„ç ”ç©¶å°ç»„å‘ç°ï¼Œè¯»å–è®¡ç®—æœºä»£ç ä¼¼ä¹å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œçš„å·¦ä¾§å’Œå³ä¾§ï¼Œè€ŒScratchJræ¿€æ´»å³ä¾§çš„ç¨‹åº¦è¦æ¯”å·¦ä¾§é«˜ä¸€äº›ã€‚è¿™ä¸€å‘ç°è¿èƒŒäº†æ•°å­¦å’Œç¼–ç ä¾èµ–ç›¸åŒå¤§è„‘æœºåˆ¶çš„å‡è®¾ã€‚\nç»éªŒçš„å½±å“ ç ”ç©¶äººå‘˜è¯´ï¼Œå°½ç®¡ä»–ä»¬æ²¡æœ‰å‘ç°ä»»ä½•ä¼¼ä¹ä¸“é—¨ç”¨äºç¼–ç¨‹çš„åŒºåŸŸï¼Œä½†æ˜¯è¿™ç§å…·æœ‰ç‰¹æ®Šè„‘æ´»åŠ¨çš„åŒºåŸŸå¯èƒ½ä¼šåœ¨å…·æœ‰æ›´å¤šç¼–ç ç»éªŒçš„äººä¸­å‘å±•ã€‚\nFedorenkoè¯´ï¼šâ€œå¦‚æœæ‚¨è˜ç”¨äº†ä»¥30å¹´æˆ–40å¹´çš„ç‰¹å®šè¯­è¨€ç¼–å†™ä»£ç çš„ä¸“ä¸šç¨‹åºå‘˜çš„äººï¼Œæ‚¨å¯èƒ½ä¼šå¼€å§‹çœ‹åˆ°æŸäº›ä¸“ä¸šåŒ–çŸ¥è¯†ï¼Œæˆ–è€…æ˜¯å¤šä¸ªéœ€æ±‚ç³»ç»ŸæŸäº›éƒ¨åˆ†çš„ç»“æ™¶â€ï¼ŒFedorenkoè¯´ã€‚â€œå¯¹äºé‚£äº›ç†Ÿæ‚‰ç¼–ç å¹¶ä¸”å¯ä»¥æœ‰æ•ˆåœ°å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œä½†ç»éªŒç›¸å¯¹æœ‰é™çš„äººæ¥è¯´ï¼Œä¼¼ä¹æ‚¨è¿˜çœ‹ä¸åˆ°ä»»ä½•ä¸“ä¸šåŒ–çŸ¥è¯†ã€‚â€\nçº¦ç¿°Â·éœæ™®é‡‘æ–¯å¤§å­¦çš„ä¸€ç»„ç ”ç©¶äººå‘˜åœ¨åŒä¸€æœŸeLifeä¸Šå‘è¡¨çš„ä¸€ç¯‡ä¼´éšè®ºæ–‡ä¸­ä¹ŸæŠ¥å‘Šè¯´ï¼Œè§£å†³ä»£ç é—®é¢˜å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œè€Œä¸æ˜¯è¯­è¨€åŒºåŸŸã€‚\nç ”ç©¶ç»“æœè¡¨æ˜ï¼Œå¯¹äºç¼–ç åº”è¯¥ä»¥åŸºäºæ•°å­¦çš„æŠ€èƒ½è¿˜æ˜¯åŸºäºè¯­è¨€çš„æŠ€èƒ½è¿›è¡Œæ•™æˆï¼Œå°šæ— å®šè®ºã€‚ç ”ç©¶äººå‘˜è¯´ï¼Œéƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå­¦ä¹ ç¼–ç¨‹å¯èƒ½ä¼šåŒæ—¶ä¾èµ–è¯­è¨€å’Œå¤šç§éœ€æ±‚ç³»ç»Ÿï¼Œå³ä½¿â€”ä¸€æ—¦å­¦ä¼šäº†ç¼–ç¨‹ï¼Œå°±ä¸ä¼šä¾èµ–è¯­è¨€åŒºåŸŸã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œä¸¤ä¸ªé˜µè¥éƒ½å®£ç§°ï¼Œå®ƒå¿…é¡»ä¸æ•°å­¦ç»“åˆåœ¨ä¸€èµ·ï¼Œå¿…é¡»ä¸è¯­è¨€ç»“åˆåœ¨ä¸€èµ·ã€‚â€ â€œä½†æ˜¯çœ‹æ¥ï¼Œè®¡ç®—æœºç§‘å­¦æ•™è‚²è€…å°†ä¸å¾—ä¸å¼€å‘è‡ªå·±çš„æ–¹æ³•æ¥æœ€æœ‰æ•ˆåœ°æ•™æˆä»£ç ã€‚â€\nå…¨æ–‡å®Œã€‚\nå¦‚æœæ‚¨æƒ³çœ‹åŸæ–‡ï¼Œå¯ä»¥è®¿é—®ï¼šé“¾æ¥\n","id":8,"section":"posts","summary":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚ å®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15","tags":[],"title":"å¯¹å¤§è„‘è€Œè¨€ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç ä¸é˜…è¯»è¯­è¨€ä¸åŒ","uri":"https://lvsq.net/2020/12/brain-reading-computer-code/","year":"2020"},{"content":"ä½œè€…\nMATTHEW FLATT, University of Utah,\nUSACANER DERICI, Indiana University, USA\nR. KENT DYBVIG, Cisco Systems, Inc., USA\nANDREW W. KEEP, Cisco Systems, Inc., USA\nGUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina\nSARAH SPALL, Indiana University, USA\nSAM TOBIN-HOCHSTADT, Indiana University, USA\nJON ZEPPIERI, independent researcher, USA\næ¦‚è¦\næˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Racketï¼Œå¹¶ä¸”è¿è¡Œè‰¯å¥½â€”â€”åªè¦å¯¹Chez Schemeè¿›è¡Œä¸€äº›ä¿®è¡¥ï¼Œå°±å¯ä»¥è¿è¡ŒDrRacketã€‚ Racketå‘è¡Œç‰ˆå¯ä»¥è‡ªè¡Œæ„å»ºï¼Œå¹¶ä¸”å‡ ä¹æ‰€æœ‰æ ¸å¿ƒâ€‹â€‹çš„Racketæµ‹è¯•å¥—ä»¶éƒ½å¯ä»¥é€šè¿‡ã€‚å°½ç®¡ä»æœ‰ä¸€äº›å·¥ä½œå¯ä»¥æé«˜ç«¯åˆ°ç«¯çš„æ€§èƒ½ï¼Œä½†æœ€ç»ˆçš„å®ç°è¿˜æ˜¯ä¸é”™çš„ã€‚ æˆ‘ä»¬è¯„ä¼°çš„æœ€ä¸å¯é¢„æµ‹çš„éƒ¨åˆ†æ˜¯ï¼ŒRacketå’ŒChez Schemeä¹‹é—´çš„ä¸åŒå°†å˜å¾—å¤šå¤§ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›ä¸åŒã€‚æˆ‘ä»¬å¸Œæœ›Racket CSæˆä¸ºä¸»è¦çš„Racketå®ç°ï¼Œå¹¶ä¸”æˆ‘ä»¬é¼“åŠ±å…¶ä»–è¯­è¨€å®ç°è€…å°†Chez Schemeè§†ä¸ºç›®æ ‡è™šæ‹Ÿæœºã€‚\nè¯¥æ–‡è¯¦ç»†åœ°ä»‹ç»äº†Racket CSæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œä»¥åŠä¸Chez Schemeä¹‹é—´çš„å·®å¼‚ï¼Œ å®Œæ•´å†…å®¹è§(https://dl.acm.org/doi/epdf/10.1145/3341642)\n","id":9,"section":"posts","summary":"ä½œè€… MATTHEW FLATT, University of Utah, USACANER DERICI, Indiana University, USA R. KENT DYBVIG, Cisco Systems, Inc., USA ANDREW W. KEEP, Cisco Systems, Inc., USA GUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina SARAH SPALL, Indiana University, USA SAM TOBIN-HOCHSTADT, Indiana University, USA JON ZEPPIERI, independent researcher, USA æ¦‚è¦ æˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Ra","tags":["pl"],"title":"åŸºäºChez Schemeé‡å»ºRacket","uri":"https://lvsq.net/2020/10/rebuilding-racket/","year":"2020"},{"content":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„è®¡ç®—æœºè¯­è¨€Java, Python, Cç­‰ç­‰å‡ ä¹ä¸€è‡´é‡‡ç”¨Lexical Scoping,ç¨‹åºå‘˜æ²¡æœ‰æœºä¼šå¯Ÿè§‰åˆ°å¼‚æ ·ï¼Œä»è€Œæ©ç›–äº†è¿˜æœ‰å…¶ä»–ä½œç”¨åŸŸçš„äº‹å®ï¼Œè®¸å¤šæ•™ç§‘ä¹¦ä¹Ÿå¾ˆé…åˆåœ°ä¸€ç¬”å¸¦è¿‡ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯æ‚¨å·²ç»æ´å¯Ÿäº†ä¸åŒä½œç”¨åŸŸçš„å·®å¼‚å’Œå†…æ¶µï¼Œè‡ªè§‰åœ°è§„é¿äº†é—®é¢˜ã€‚æˆ‘è¡·å¿ƒçš„å¸Œæœ›æ‰€æœ‰ç¨‹åºå‘˜éƒ½æ˜¯ç¬¬äºŒç§å¯èƒ½ã€‚\næœ¬æ–‡å°†æµ…æ˜¾åœ°æè¿°ä¸¤ç§ä½œç”¨åŸŸçš„ç‰¹ç‚¹åŠå·®å¼‚ï¼Œå¸Œæœ›å¯ä»¥è§£é‡Šåœ°æ¸…æ¥šä¸€ç‚¹ï¼Œå¦‚æœè¯»å®Œä¹‹åæ‚¨æ›´åŠ æ¨¡ç³Šäº†ï¼Œè¯·è®°ä½ï¼Œè¿™å¹¶éæˆ‘çš„æœ¬æ„ã€‚\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œåç§°ç»‘å®šçš„ä½œç”¨åŸŸï¼ˆåç§°ä¸å®ä½“çš„å…³è”ï¼Œæ¯”å¦‚å˜é‡ï¼‰æ˜¯ç¨‹åºä¸­åç§°ç»‘å®šæœ‰æ•ˆçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åç§°å¯ä»¥è¢«å¼•ç”¨åˆ°ä¸€ä¸ªå®ä½“ã€‚ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œåç§°å¯èƒ½æŒ‡å‘ä¸åŒçš„å®ä½“ï¼ˆå®ƒå¯èƒ½å…·æœ‰ä¸åŒçš„ç»‘å®šï¼‰ï¼Œæˆ–è€…æ ¹æœ¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ˆå®ƒå¯èƒ½æ˜¯æœªç»‘å®šçš„ï¼‰ã€‚ä½œç”¨åŸŸä¹Ÿç§°ä¸ºå®ä½“çš„å¯è§æ€§ï¼Œ å°¤å…¶åœ¨è¾ƒæ—©çš„æŠ€æœ¯æ–‡çŒ®ä¸­å¯è§ï¼Œè¿™æ˜¯ä»æ‰€å¼•ç”¨çš„å®ä½“çš„è§’åº¦å‡ºå‘ï¼Œè€Œéå¼•ç”¨çš„åç§°ã€‚\næœ¯è¯­\u0026quot;scope\u0026ldquo;ä¹Ÿç”¨äºæŒ‡ä»£ç¨‹åºä¸­æœ‰æ•ˆçš„åç§°ç»‘å®šçš„é‚£éƒ¨åˆ†é›†åˆï¼Œæ›´åŠ æ­£ç¡®çš„ç§°å‘¼åº”è¯¥æ˜¯ä¸Šä¸‹æ–‡ æˆ–è€… ç¯å¢ƒ\nLexical Scoping è¯æ³•ä½œç”¨åŸŸï¼ŒæŸäº›ä¹¦ä¸­ä¹Ÿå«é™æ€ä½œç”¨åŸŸï¼Œå…¶åœ¨ç¼–å†™ä»£ç æ—¶æˆ–è€…è¯´å®šä¹‰æ—¶å°±ç¡®å®šçš„ï¼Œé€šè¿‡æ–‡æœ¬ï¼ˆæºä»£ç ï¼‰å°±å¯ä»¥è§‚å¯Ÿåˆ°åç§°ä¸å®ä½“çš„å…³è”ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šåœ¨è·ç¦»è¢«è°ƒç”¨ä»£ç æœ€è¿‘çš„ç¯å¢ƒä¸­å»æŸ¥æ‰¾ç»‘å®šï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç¯å¢ƒï¼Œåœ¨ä¼˜å…ˆä»æœ€é‡Œé¢ä¸€å±‚çš„ç¯å¢ƒæŸ¥æ‰¾ã€‚\næ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n(setf x 1) ;; bind x to 1 (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) ;; result is 6 (format t \u0026#34;X = ~d \u0026#34; x) ;; X = 1 å…ˆç»‘å®šxä¸º1ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªå‡½æ•°fï¼Œfä¸­çš„å˜é‡xç»‘å®šä¸º2ï¼Œå®é™…ä¸Šfå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œç”±äºä¸¤ä¸ªxçš„ç¯å¢ƒä¸åŒï¼Œæ‰€ä»¥äº’ä¸å¹²æ‰°ï¼Œç»“æœæ­£æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œè¿™å°±å±äºè¯æ³•ä½œç”¨åŸŸã€‚\nDynamic Scoping åŠ¨æ€ä½œç”¨åŸŸæ›¾ç»è®©å¾ˆå¤šäººæ·±æ¶ç—›ç»ï¼Œä»¥è‡³äºä¸æ„¿æ„å†æèµ·å®ƒã€‚æ—©æœŸçš„Lispæ™®éä½¿ç”¨äº†åŠ¨æ€ä½œç”¨åŸŸï¼Œå¹¶å¸¦æ¥äº†éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯Lisp Machineè¢«Unixæ‰“è´¥çš„é™¤äº†å•†ä¸šå› ç´ ä¹‹å¤–çš„é‡è¦åŸå› ï¼ŒLispè‡³ä»Šæœªæˆä¸ºä¸»æµè¯­è¨€å°±ä¸éš¾ç†è§£äº†ï¼Œå°½ç®¡Lispçš„è¯­æ³•æœ€ç²¾ç‚¼ã€æœ€ä¼˜ç¾ï¼Œè¿˜å…·æœ‰æœ€å¼ºæ‚çš„å®ç³»ç»Ÿï¼Œè¿˜æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªä½¿ç”¨GCçš„è¯­è¨€\u0026hellip;\nåº†å¹¸çš„æ˜¯ï¼ŒScheme, Common Lispç­‰Lispæ–¹è¨€å·²ç»éƒ½æ˜¯ç”¨äº†Lexial Scopingï¼ˆå±€éƒ¨å˜é‡ã€‚æ‰€ä»¥æŸäº›æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠLexical Scopingå’ŒLocal Variableç­‰ä»·ï¼‰, æˆ‘ä»¬æ— éœ€å†ä¸ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜è€Œçƒ¦æ¼ï¼Œçæƒœç”Ÿå‘½ï¼Œä¸æ˜¯å—ï¼Ÿ ä¸è¿‡Scheme, Common Lispè¿˜æ˜¯ä¿ç•™äº†åŠ¨æ€ä½œç”¨åŸŸçš„æ“ä½œï¼ŒSchemeå¯ä»¥å‚è€ƒFluid Binding, Common Lispçš„åŠ¨æ€ä½œç”¨åŸŸå°†åœ¨åæ–‡ä¸¾ä¾‹è¯´æ˜ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬æ— éœ€ä¸ºè¿™ä¸ªä¿ç•™æ‹…å¿§ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæˆ‘ä»¬å¾ˆå°‘éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚\næ‰€è°“dynamic scopingå°±æ˜¯è¯´ï¼Œåœ¨å‡½æ•°å®šä¹‰ä¸­å­˜åœ¨äº†â€œè‡ªç”±å˜é‡â€ï¼ˆfree variableï¼‰, ä¼šåœ¨è¿è¡Œæ—¶éšç€å‡½æ•°çš„â€œè°ƒç”¨ä½ç½®â€ä¸åŒè€Œå‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼Œä½†æ˜¯ç¨ä½œå˜åŒ–ï¼š\n(defvar x 1) ;; bind x to 1, x is a free variable (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) (format t \u0026#34;X = ~d \u0026#34; x) (let ((x 100)) (format t \u0026#34;Inner X is ~d \u0026#34; x)) (defvar x 1)å®šä¹‰äº†xï¼Œå€¼ä¸º1ï¼Œä½†æ˜¯è¿™ä¸ªxå±äºè‡ªç”±å˜é‡ï¼Œå¤„äºåŠ¨æ€ä½œç”¨åŸŸï¼Œå› ä¸ºLispè‡ªåŠ¨å°†å…¨å±€å˜é‡å³ç”±defvarã€defparameterã€specialå®šä¹‰çš„å˜é‡è‡ªåŠ¨å£°æ˜ä¸ºåŠ¨æ€ä½œç”¨åŸŸã€‚ xå¯¹äº(lambda (y) (* x y))æ¥è¯´æ˜¯â€œ è‡ªç”± â€ çš„ï¼Œå®ƒå¯ä¸ä¼šåœ¨æ„xç»‘å®šä¸º2æˆ–è€…ä»»ä½•å…¶ä»–å€¼ï¼Œå› ä¸º(let ((x 2)) \u0026hellip;)ä¸­æŒ‡å®šçš„xå·²ç»ä¸æ˜¯(lambda \u0026hellip;)çš„å‚æ•°äº†ã€‚\næ‰€ä»¥å½“æˆ‘ä»¬æ‰§è¡Œ(funcall f 3) æ—¶ï¼Œå…¶ç»“æœä¸åƒè¯æ³•ä½œç”¨åŸŸé‚£æ ·ç­‰äº6ï¼Œè€Œæ˜¯3\n(format t \u0026ldquo;X = ~d \u0026quot; x) ä¾ç„¶è¾“å‡ºï¼š X = 1\n(let ((x 100)) (format t \u0026ldquo;Inner X is ~d \u0026quot; x)) è¾“å‡ºä¸ºï¼šInner X is 100ã€‚ ç­‰ç­‰ï¼Œè¿™é‡Œçš„xä¸ºä»€ä¹ˆåˆæ˜¯100äº†ï¼Ÿ è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„ç¯å¢ƒ å—ï¼Ÿï¼\nå¦‚æœå°†å‡½æ•°fæ”¾åˆ°ä¸åŒçš„ä½ç½®æ‰§è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ä¸Šé¢(funcall f 3)æ˜¯åœ¨é¡¶å±‚æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬æ¢åˆ°letä¸­æ‰§è¡Œä¼šæ€ä¹ˆæ ·ï¼Ÿ\n(let ((x 2)) (funcall f 3)) è¿™æ¬¡å±…ç„¶è¿”å›6ï¼Œè€Œä¸æ˜¯3äº†ã€‚\nçœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿå‡½æ•°fçš„è¡Œä¸ºï¼Œä¼šéšç€è°ƒç”¨ä½ç½®çš„ä¸€ä¸ªåå«xçš„å˜é‡çš„å€¼çš„ä¸åŒè€Œå˜åŒ–ã€‚è™½ç„¶éƒ½å«xï¼Œä½†å¹¶ä¸æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯åå­—ç›¸åŒè€Œå·²ã€‚é¡ºå¸¦æä¸€å¥ï¼Œç°åœ¨å¯ä»¥ç†è§£Javaä¸­namespaceçš„ç”¨å¤„äº†å§ã€‚\nè¯æ³•ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°è¯æ³•ä¸Šä¸‹æ–‡è§£å†³çš„ï¼Œè€ŒåŠ¨æ€ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå³ä½ç½®ï¼‰è§£å†³çš„ã€‚è¿™æ˜¯ç¼–è¯‘å™¨å¿…é¡»é¢å¯¹å¹¶è§£å†³çš„é—®é¢˜ï¼Œæˆ–è®¸ç¼–å†™ç¨‹åºæ—¶æ— éœ€è¿‡å¤šå…³æ³¨ï¼Œä½†æ˜¯å¤šäº†è§£ä¸€ä¸‹ä¸€å®šå¤§æœ‰è£¨ç›Šã€‚å°½ç®¡åŠ¨æ€ä½œç”¨åŸŸå­˜åœ¨å¾ˆå¤§é—®é¢˜ï¼Œä½†å®ƒå¹¶éæ´ªæ°´çŒ›å…½ï¼Œå®ƒå¯ä»¥ä½¿å…¨å±€å˜é‡æ›´æ˜“äºç®¡ç†ï¼›å‡è®¾æ‚¨å¸Œæœ›ä¸´æ—¶æ”¹å˜è‡ªç”±å˜é‡çš„å€¼æ—¶ï¼Œä¹Ÿå¯ä»¥å£°æ˜ä¸ºdynamic socpingï¼›å¦å¤–åœ¨å¼‚å¸¸å¤„ç†ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ¨æ€ä½œç”¨åŸŸå°†å¤„ç†ç¨‹åºä¸å¼‚å¸¸ç›¸å…³è”ã€‚\n","id":10,"section":"posts","summary":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„","tags":["lexical","scoping"],"title":"Lexical Scoping and Dynamic Scoping","uri":"https://lvsq.net/2020/09/lexical-dynamic-scoping/","year":"2020"},{"content":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š\nè®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼›\néå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°åˆ—è¡¨çš„å·¦ä¾§ï¼Œæ‰€æœ‰å¤§äºæˆ–ç­‰äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°å³ä¾§ï¼›\nåˆ†åˆ«å¯¹å·¦ä¾§å’Œå³ä¾§çš„å…ƒç´ è¿›è¡Œå¿«æ’ï¼›\né‡å¤ä¸Šè¿°çš„æ­¥éª¤ï¼Œæ’åºå®Œæˆï¼›\nåœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åºnä¸ªå…ƒç´ éœ€è¦$O(nlog n)$å¤æ‚åº¦ï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦$O(n^2)$,ä½†ä¸€èˆ¬å¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µã€‚\nä»ç®—æ³•çš„åŸç†å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦å¤šæ¬¡æ‰§è¡Œé‡å¤çš„æ“ä½œï¼Œè‡ªç„¶é‡‡ç”¨é€’å½’å¯ä»¥å‡å°‘å¾ˆå¤šä»£ç ï¼Œè‹¥é—®é€’å½’æŠ€æœ¯å“ªå®¶å¼ºï¼Ÿé¦–å±ˆä¸€æŒ‡Lisp,ä¸‹é¢ç»™å‡ºCLç‰ˆæœ¬çš„å¿«æ’å®ç°ï¼ˆç®€æ˜“ç‰ˆæœ¬ï¼Œåªæ”¯æŒæ•°å­—ç±»å‹çš„åˆ—è¡¨ï¼Œå…¶ä»–ç±»å‹çš„æ’åºåªéœ€å¢åŠ ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å³å¯ï¼Œæœ¬æ–‡ä¸æ‰©å±•ï¼‰ï¼š\n(defun quickSort (lst) (let ( (len (list-length lst)) (st (lambda (l pk) ;; stå‡½æ•°å®ç°ä¸Šè¿°ç¬¬2æ­¥ (let ((left nil) (right nil)) (dolist (each l) (if (\u0026lt; each pk) (push each left) (push each right))) (values left right) ) ) ) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) (quickSort \u0026#39;(1 2 6 3 5 4)) =\u0026gt; (1 2 3 4 5 6) stå‡½æ•°å¯ä»¥ç”¨å®æ¥å®ç°ï¼š\n(defmacro st (lst pk) (let ((gslist (gensym))) `(let ((,gslist ,lst)) (let ((left nil) (right nil)) (dolist (each ,gslist) (if (\u0026lt; each ,pk) (push each left) (push each right))) (values left right) ) ) ) ) (defun quickSort (lst) (let ( (len (list-length lst)) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) ","id":11,"section":"posts","summary":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š è®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼› éå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äº","tags":["lisp"],"title":"å¿«é€Ÿæ’åºï¼ˆLispç‰ˆæœ¬ï¼‰","uri":"https://lvsq.net/2020/07/quick-sort-in-cl/","year":"2020"},{"content":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡ºäº†ä¸€ä¸ªå…³äºå…«çš‡åçš„é¢˜ç›®ï¼Œè¿™æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç»å…¸çš„é—®é¢˜ï¼Œå½“å¹´ä¸Šå­¦æ—¶æ›¾ç»å°½è„‘æ±ä»ç„¶äº‘å±±é›¾ç½©ï¼Œä¸å¾—å…¶è§£ã€‚å¦‚ä»Šå†æ¬¡ç›¸é‡ï¼Œå²‚èƒ½å†åå£ä¸Šè§‚ï¼Ÿï¼æ›´ä½•å†µæ‰‹è¾¹å·²æœ‰è¶æ‰‹çš„å…µå™¨ã€‚è¯•çœ‹Erlangçš„å®ç°ï¼š\n-module(queens). -export([queens/1]). queens(0) -\u0026gt; [[]]; queens(N) -\u0026gt; [[Row | Columns] || Columns \u0026lt;- queens(N - 1), Row \u0026lt;- lists:seq(1, 8) -- Columns, safe(Row, Columns, 1)]. safe(_Row, [], _N) -\u0026gt; true; safe(Row, [Column | Columns], N) -\u0026gt; (Row /= Column + N) andalso (Row /= Column - N) andalso safe(Row, Columns, (N + 1)). ä»å¤´è‡³å°¾10è¡Œä»£ç ï¼Œå¦‚æœä¸æ˜¯ä¸ºäº†ä½¿ä»£ç ç¾è§‚ï¼Œ6è¡Œè¶³çŸ£ï¼ˆè¿™è¿˜åŒ…æ‹¬äº†**-module** å’Œ**-export** ä¸¤è¡Œå£°æ˜è¯­æ³•ï¼Œä¸ç®—æ³•æœ¬èº«æ— å…³çš„ä»£ç ï¼‰ã€‚å¦‚æ­¤ç®€çŸ­å°½ç„¶å¯ä»¥æ¸…æ™°åœ°å®ç°å¤æ‚çš„å…«çš‡å é—®é¢˜ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼ç¨‹åºè¯­è¨€å¾—å†™å¤šå°‘è¡Œï¼Ÿæœ¬æ–‡çš„é‡ç‚¹ä¸åœ¨äºæ¯”è¾ƒè¿™ä¸ªï¼ŒErlangæ˜¯ä¸€é—¨éå¸¸å¼ºå¤§çš„è¯­è¨€ï¼Œå¯¹äºæˆ‘æ¥è¯´Erlangå¥½æ¯”æ¢æ˜¥ï¼Œä½†æ˜¯Schemeæ‰æ˜¯æ—é»›ç‰å‘€ï¼Œæ‰€ä»¥æ¯«ä¸è¿Ÿç–‘ç”¨Schemeæ¥å®ç°ï¼š\n(define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence)))) ) (define (enumerate-interval low high) (if (\u0026gt; low high) \u0026#39;() (cons low (enumerate-interval (+ low 1) high))) ) (define (flatmap proc seq) (accumulate append \u0026#39;() (map proc seq)) ) (define empty-board \u0026#39;()) (define (safe? k position) (let loop ([new-queen (car position)] [rest-queens (cdr position)] [i 1]) (if (null? rest-queens) #t (let ([rest-current-queen (car rest-queens)]) (if (or (= new-queen rest-current-queen) (= new-queen (+ rest-current-queen i)) (= new-queen (- rest-current-queen i)) ) #f (loop new-queen (cdr rest-queens) (+ i 1)) ) ) ) ) ) (define (adjoin-position new-row k rest-of-queens) (cons new-row rest-of-queens) ) (define (queens board-size) (define (queen-cols k) (if (= k 0) (list empty-board) (filter (lambda (position) (safe? k position)) ;è¿‡æ»¤æ— æ•ˆçš„è§£ (flatmap (lambda (rest-of-queens) (map (lambda (new-row) ;æ‰©å……ï¼ˆk-1ï¼‰ä¸ªçš‡åçš„æ¯ä¸€ä¸ªè§£ï¼Œç»™æ¯ä¸ªè§£éƒ½å¢åŠ ç¬¬kä¸ªçš‡å (adjoin-position new-row k rest-of-queens)) (enumerate-interval 1 board-size) ) ) (queen-cols (- k 1)) ;å‰ï¼ˆk-1ï¼‰ä¸ªæœ‰æ•ˆçš„çš‡åï¼Œè™½ç„¶æ˜¯å¤ªè™šå¹»å¢ƒï¼Œä½†å¯ä»¥è®¤ä¸ºæ˜¯äº‹å® ) ) ) ) (queen-cols board-size) ) Schemeç‰ˆæœ¬æ¯”Erlangç‰ˆæœ¬ä»£ç å¢åŠ äº†ä¸å°‘ï¼ŒåŸå› åœ¨äºå…¶æ²¡æœ‰æ¨¡å¼åŒ¹é… å’Œåˆ—è¡¨æ¨å¯¼ è¿™ä¸¤å¤§åˆ©å™¨ï¼Œä¸è¿‡æˆ‘æ›´å–œæ¬¢Schemeå¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ„é€ æˆ‘éœ€è¦çš„ä¸€åˆ‡ï¼Œè€Œä¸”S-è¡¨è¾¾å¼çœ‹èµ·æ¥ååˆ†ä¼˜ç¾è‡ªç„¶ã€‚Schemeç‰ˆæœ¬å®é™…ä¸Šè§£å†³äº†n-çš‡åï¼Œæ›´è¿›ä¸€æ­¥äº†ã€‚\näº‹æƒ…åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸï¼ŒåŸå› åœ¨äºæˆ‘åˆšå¼€å§‹å®ç°Schemeç‰ˆæœ¬çš„å…«çš‡åæ—¶ï¼Œé€‰æ‹©ç¿»è¯‘Erlangä»£ç ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼ä¸€ç•ªæŒ£æ‰ä¹‹åï¼Œæ„è¯†åˆ°è¯¥é—®é¢˜å±äºéç¡®å®šæ€§è®¡ç®—ï¼ŒçŒ›ç„¶æƒ³èµ·ã€ŠSICPã€‹ä¸­æœ‰ä¸€èŠ‚ä¸“é—¨ä»‹ç»äº†æ­¤ç§è®¡ç®—ï¼Œä¹Ÿå³æœ¬æ–‡çš„ä¸»è§’â€”â€”amb\néç¡®å®šæ€§è®¡ç®— ambè¿™ä¸ªåå­—æºäºambiguous ,å…¶å«ä¹‰å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£ã€‚ä¸€ç•ªæŠ«è‚æ²¥èƒ†ä¹‹åï¼Œç»ˆäºçª¥åˆ°äº†ä¸€äº›é—¨å¾„ï¼Œè¶æœºå˜æ¸…å¾ˆå¤šçŸ¥è¯†ç‚¹ã€‚æˆ‘å°†å°½åŠ›å¹³é“ºç›´è¿°ï¼Œç®€è¦çš„ä»‹ç»è¿™ç§å¼ºå¤§ä¸”ååˆ†æœ‰ç”¨çš„æ­¦å™¨ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸ªé—®é¢˜ï¼š\nå‡è®¾æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­éƒ½æ˜¯ä¸€äº›æ­£æ•´æ•°ï¼Œæ¯”å¦‚l1 = [1 2 3 4 5], l2 = [3 4 6 7 8]ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»l1å’Œl2ä¸­å„å–ä¸€ä¸ªæ•°å­—ï¼Œç›¸åŠ ä¹‹åï¼Œå¦‚æœæ˜¯ç´ æ•°ï¼Œåˆ™æ»¡è¶³è¦æ±‚ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå¯¹äºè¿™ä¸ªç®€å•çš„é—®é¢˜ï¼Œç›¸ä¿¡éš¾ä¸å€’å¤§å®¶ï¼Œé‡‡ç”¨å›æº¯ç®—æ³•è½»æ˜“å°±è§£å†³äº†ï¼Œè¿™é‡Œåªæ˜¯æƒ³å¼•å‡ºâ€œéç¡®å®šæ€§è®¡ç®—â€çš„æ¦‚å¿µã€‚éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†ç±»ä¼¼ï¼Œå¯¹äºâ€œç”Ÿæˆå’Œæ£€æµ‹å¼â€çš„åº”ç”¨ç‰¹åˆ«æœ‰ä»·å€¼ï¼Œå®ƒå¾€å¾€åªæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼Œè¿™å¥è¯å¾ˆæœ‰æ„æ€ï¼Œå¦‚æœæš‚æ—¶æ²¡æœ‰ç†è§£ä¸ç”¨ç€æ€¥ï¼Œç»§ç»­å¾€ä¸‹çœ‹ã€‚\nå¯¹äºéç¡®å®šæ€§è®¡ç®—ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè¡¨è¾¾å¼æ˜¯å…è®¸å­˜åœ¨å¤šä¸ªå€¼çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„é—®é¢˜çš„è§£è‡³å°‘æœ‰(1 4),(2 3)ä¸¤ä¸ªè§£å§ã€‚\næœ‰ä¸€ä»¶å¾ˆæœ‰æ•™ç›Šçš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†å¯¹äºæ—¶é—´çš„ä¸åŒçœ‹æ³•ã€‚æµå¤„ç†åˆ©ç”¨äº†æƒ°æ€§æ±‚å€¼ï¼Œè¿™ä¼šç»™æˆ‘ä»¬ä¸€ç§é”™è§‰ï¼Œä»¿ä½›æ‰€æœ‰å¯èƒ½çš„ç»“æœçš„å‡ºç°æ²¡æœ‰æ—¶é—´é¡ºåºï¼›å¯¹äºéç¡®å®šæ€§çš„æ±‚å€¼ï¼Œä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¯¹ä¸€ä¸ªå¯èƒ½çš„ä¸–ç•Œçš„æ¢ç´¢ï¼Œæ¯ä¸€ä¸ªå€¼éƒ½ç”±ä¸€æ¬¡é€‰æ‹©æ‰€ç¡®å®šï¼ŒæŸäº›é€‰æ‹©ä¼šèµ°å…¥æ­»èƒ¡åŒï¼Œè€Œå¦ä¸€äº›ä¼šå¾—åˆ°æœ‰ç”¨çš„å€¼ï¼Œæ‰€ä»¥éç¡®å®šæ€§è®¡ç®—ç»™æˆ‘ä»¬çš„æ„Ÿè§‰æ˜¯ï¼Œæ—¶é—´æ˜¯æœ‰åˆ†æ”¯çš„ã€‚ç¨‹åºå½“ä¸­ä¼šä¿å­˜æ‰€æœ‰å¯èƒ½çš„ä¸åŒæ‰§è¡Œå†å²ï¼Œåœ¨é‡åˆ°ä¸€ä¸ªæ­»èƒ¡åŒæ—¶ï¼Œæ€»æ˜¯å¯ä»¥å›åˆ°ä»¥å‰çš„é€‰æ‹©ç‚¹ï¼Œå¹¶æ²¿ç€å¦ä¸€ä¸ªåˆ†æ”¯ç»§ç»­ä¸‹å»ã€‚\nä¸‹é¢å°†è¦å®ç°çš„éç¡®å®šæ€§æ±‚å€¼å™¨ç§°ä¸ºâ€”â€”ambæ±‚å€¼å™¨\nambæ±‚å€¼å™¨ å‡è®¾ç›®å‰å·²ç»æ‰©å……äº†Schemeä»¥æ”¯æŒéç¡®å®šæ€§è®¡ç®—ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„ç§°ä¸ºambçš„æ–°å½¢å¼ï¼Œè¡¨è¾¾å¼ $(amb \u0026lt;e_1\u0026gt; \u0026lt;e_2\u0026gt; \u0026hellip; \u0026lt;e_n\u0026gt;)$ ä¼šâ€œæœ‰æ­§ä¹‰åœ°â€è¿”å›nä¸ªè¡¨è¾¾å¼ä¹‹ä¸€çš„å€¼ï¼Œæ¯”å¦‚ï¼š\n(list (amb 1 2 3) (amb \u0026#39;a \u0026#39;b)) å¯ä»¥æœ‰å¦‚ä¸‹6ä¸ªå¯èƒ½çš„å€¼ï¼š (1 a) (1 b) (2 a) (2 b) (3 a) (3 b)\nå¯¹äºæ²¡æœ‰é€‰é¡¹çš„ambï¼Œå³(amb) â€”â€”è§†ä¸ºæ²¡æœ‰å¯æ¥æ”¶å€¼çš„è¡¨è¾¾å¼ï¼Œè¿™å°†å¯¼è‡´æ±‚å€¼â€œfailâ€ã€‚\nambæ±‚å€¼å™¨åœ¨æ¯ä¸ªé€‰æ‹©ç‚¹ï¼Œæ€»æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªå¯èƒ½æ€§ï¼Œå¦‚æœé€‰æ‹©çš„ç»“æœå¤±è´¥ï¼Œé‚£ä¹ˆæ±‚å€¼å™¨è‡ªåŠ¨åœ°å›æº¯åˆ°æœ€è¿‘çš„é€‰æ‹©ç‚¹ï¼Œå»å°è¯•ä¸‹ä¸€ä¸ªå¯èƒ½æ€§ã€‚å¦‚æœå®ƒç”¨å®Œäº†æ‰€ä»¥çš„å¯èƒ½æ€§ï¼Œåˆ™è‡ªåŠ¨é€€å›åˆ°ä¸Šä¸€ä¸ªé€‰æ‹©ç‚¹ï¼Œå¹¶ä»é‚£é‡Œç»§ç»­ï¼ˆè¿™ä¸ªâ€œç»§ç»­â€å¾ˆæœ‰æ„æ€ï¼Œåæ–‡ä¼šçœ‹åˆ°ï¼Œâ€œç»§ç»­â€ä¸ä½†æ˜¯ç»“è®ºï¼Œè¿˜æ˜¯å…¶å®ç°çš„æ–¹å¼ï¼Œä¸€è¯­åŒå…³ï¼‰ä¸‹å»ã€‚ä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆ ç®—æ³•ã€‚\né€»è¾‘è°œé¢˜ åœ¨è®¨è®ºambæ±‚å€¼å™¨çš„å®ç°ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€é“é€»è¾‘è°œé¢˜ï¼š\næ›¹æ“ã€å­™æƒã€åˆ˜å¤‡ã€è¢ç»ã€é©¬è¶…5äººä½åœ¨ä¸€æ ‹5å±‚çš„æ¥¼æˆ¿é‡Œé¢ï¼Œæ¯äººä½ä¸€å±‚ã€‚æ›¹æ“ä¸ä½é¡¶å±‚ï¼Œå­™æƒä¸ä½åº•å±‚ï¼Œåˆ˜å¤‡ä¸ä½é¡¶å±‚ä¹Ÿä¸ä½åº•å±‚ï¼Œè¢ç»æ¯”åˆ˜å¤‡é«˜ä¸€å±‚ï¼Œé©¬è¶…ä¸åˆ˜å¤‡ä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œåˆ˜å¤‡ä¸å­™æƒä¹Ÿä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œè¯·é—®ä»–ä»¬å„ä½åœ¨å“ªä¸€å±‚ï¼Ÿ\nåœ¨æ²¡æœ‰ambæ—¶ï¼Œä»£ç æ€ä¹ˆå†™å‘¢ï¼Ÿææ€•ä¸å®¹æ˜“å§ã€‚ä½†æ˜¯ç°åœ¨æœ‰äº†ambæ±‚å€¼å™¨ï¼Œç¬é—´ç¾å¥½äº†ï¼š\n(define (multiple-dwelling) (let ( [caocao (amb 1 2 3 4 5)] [sunquan (amb 1 2 3 4 5)] [liubei (amb 1 2 3 4 5)] [yuanshao (amb 1 2 3 4 5)] [machao (amb 1 2 3 4 5)] ) (require (distinct? (list caocao sunquan liubei yuanshao machao))) (require (not (= caocao 5))) (require (not (= sunquan 1))) (require (not (= liubei 5))) (require (not (= liubei 1))) (require (\u0026gt; yuanshao liubei)) (require (not (= (abs (- machao liubei)) 1)) (require (not (= (abs (- sunquan liubei)) 1)) (list (list \u0026#39;caocao caocao) (list \u0026#39;sunquan sunquan) (list \u0026#39;liubei liubei) (list \u0026#39;yuanshao yuanshao) (list \u0026#39;machao machao)) ) ) ä¸Šè¿°ä»£ç åªæ˜¯æè¿°é—®é¢˜çš„å…³ç³»ï¼Œå³å„ä¸ªrequireéƒ¨åˆ†ï¼ˆå…ˆä¸è€ƒè™‘æ€§èƒ½é—®é¢˜ã€‚è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„â€œæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•â€å—ï¼Ÿï¼‰ï¼Œå¹¶æ²¡æœ‰æ·»åŠ ä»€ä¹ˆâ€œå¤„ç†é€»è¾‘â€ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿä¸‹é¢ç»“æœï¼š\n((caocao 3) (sunquan 2) (liubei 4) (yuanshao 5) (machao 1))\nå±…ç„¶å¾—åˆ°äº†è°œé¢˜çš„è§£ï¼Œè¿™æ˜¯ä»€ä¹ˆé­”æ³•ï¼Ÿï¼Ÿï¼Ÿ\nambè½»è€Œæ˜“ä¸¾åœ°è§£å†³äº†è¿™ç§éœ€è¦å¤§é‡å›æº¯çš„é—®é¢˜ã€‚\nå®ç° ç°åœ¨è¯¥è°ˆä¸€è°ˆç¥å¥‡çš„ambå¦‚ä½•å®ç°äº†å§ã€‚å‰æ–‡å·²ç»å¤šæ¬¡æåˆ°è¿‡ï¼Œambæ±‚å€¼çš„è¿‡ç¨‹å¯èƒ½ä¼šä¸æ–­çš„å›æº¯ï¼Œè¿™åŠ¿å¿…å¯¼è‡´ç¨‹åºæµç¨‹çš„è·³è½¬ï¼Œç¨‹åºè·³è½¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€å¯æ²¡æœ‰break,continueä¹‹ç±»çš„è¯­æ³•ï¼Œå› ä¸ºæ ¹æœ¬ä¸éœ€è¦ï¼Œé‚£ä¹ˆå‡½æ•°å¼è¯­è¨€æœ‰å•¥ï¼Ÿç­”æ¡ˆæ˜¯continuation(ç¿»è¯‘æˆç»§ç»­ï¼Œæˆ–è€…å»¶ç»­éƒ½å¯ä»¥ã€‚è¿˜è®°å¾—â€œä¸€è¯­åŒå…³â€å—ï¼Ÿ)\nSchemeå†…ç½®äº†è¿™ä¸ªå¼ºå¤§çš„æ§åˆ¶æŠ½è±¡ï¼Œè¿‡ç¨‹åä¸ºï¼šcall-with-current-continuationï¼Œ åå­—ç•¥é•¿ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯ç”¨å…¶ç¼©å†™ï¼šcall/ccã€‚å›¿äºç¯‡å¹…ï¼Œæœ¬æ–‡ä¸æ‰“ç®—ä»‹ç»continuationï¼Œå¦‚æœæƒ³è¯¦ç»†äº†è§£å®ƒï¼Œè¯·è‡ªè¡Œæœç´¢ã€‚\nå¸¸è§„æ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸€ä¸ªå‚æ•°ï¼šæ‰§è¡Œç¯å¢ƒenvã€‚ambæ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé™¤äº†æ‰§è¡Œç¯å¢ƒenvä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªcontinuationè¿‡ç¨‹ï¼ˆä¸€ä¸ªæˆåŠŸå»¶ç»­ã€ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼‰ã€‚å¯¹ä¸€ä¸ªè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œç»“æŸåä¼šè°ƒç”¨è¿™ä¸¤ä¸ªcontinuationè¿‡ç¨‹ä¹‹ä¸€ï¼šå¦‚æœæ­¤æ¬¡æ±‚å€¼å¾—åˆ°äº†ä¸€ä¸ªç»“æœï¼Œåˆ™è°ƒç”¨æˆåŠŸå»¶ç»­ï¼›å¦‚æœç»“æœæ˜¯é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™è°ƒç”¨å¤±è´¥å»¶ç»­ã€‚\næˆåŠŸå»¶ç»­çš„å·¥ä½œæ˜¯ï¼šæ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶å°†è®¡ç®—è¿›è¡Œå»ä¸‹ï¼Œä¸è¿™ä¸ªå€¼ä¸€èµ·ï¼ŒæˆåŠŸå»¶ç»­è¿‡ç¨‹è¿˜å°†å¾—åˆ°ä¸€ä¸ªå¦ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼Œå¦‚æœä½¿ç”¨è¯¥å€¼æ—¶é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™éœ€è¦è°ƒç”¨è¿™ä¸ªå¤±è´¥å»¶ç»­ã€‚\nå¤±è´¥å»¶ç»­çš„å·¥ä½œæ˜¯ï¼šè¯•æ¢éç¡®å®šæ€§è¿‡ç¨‹çš„å¦ä¸€ä¸ªåˆ†æ”¯ã€‚éç¡®å®šæ€§è®¡ç®—çš„æœ€å…³é”®çš„ç‰¹å¾ï¼Œåœ¨äºè¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºäºä¸åŒå¯èƒ½æ€§ä¹‹é—´çš„é€‰æ‹©ã€‚\næˆ‘æ‰¿è®¤æœ‰ç‚¹çƒ§è„‘ï¼Œä½†è¿˜ç®—æ¸…æ™°ï¼Œè®©é€’å½’åœ¨è„‘æµ·ä¸­å¥”æ¶Œå§ã€‚\nåˆ©ç”¨å®æ¥ç®€åŒ–ambçš„æ„é€ ï¼Œä»£ç å‚è€ƒè¿™é‡Œï¼š\n(define amb-fail \u0026#39;*) (define initialize-amb-fail (lambda () (set! amb-fail (lambda () (error \u0026#34;amb tree exhausted\u0026#34;))))) (initialize-amb-fail) (define-syntax amb (syntax-rules () ((amb alt ...) (let ((prev-amb-fail amb-fail)) ;ä¿å­˜å‰ä¸€ä¸ªé€‰æ‹©ç‚¹ (call/cc (lambda (sk) ;å¯¹äºæ•´ä¸ªambè¡¨è¾¾å¼æ„é€ ä¸€ä¸ªskçš„contnuation (call/cc (lambda (fk) ;å¯¹äºæ¯ä¸€ä¸ªambçš„é€‰é¡¹æ„é€ ä¸€ä¸ªfkçš„continuation (set! amb-fail ;å…ˆæŠŠamb-failè®¾ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯å°†amb-failæ¢å¤åˆ°è¿›å…¥ambå‰çš„å€¼ (lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) ) (sk alt) ;ç«‹å³è¿”å›è‡ªå·±çš„åˆ†æ”¯çš„å€¼,ä»è€Œå¼•èµ·ambè¡¨è¾¾å¼ä¸­é€”è¿”å›ã€‚æ³¨æ„ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œæ—¶éƒ½ä¼šå¼•èµ· amb ç«‹å³è¿”å›ã€‚åé¢çš„åˆ†æ”¯éƒ½è¿˜æ²¡æœ‰æ‰§è¡Œï¼ ) ) ... (prev-amb-fail) ) ) ) ) ) ) ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼ˆä¹Ÿå¯ä»¥å«åˆ†æ”¯ï¼‰ä¼šè¢«ç«‹å³è¿”å›ï¼Œåé¢çš„æš‚æ—¶ä¸æ‰§è¡Œã€‚å‡è®¾è¯¥å€¼è¢«è®¤ä¸ºæ˜¯â€œæ— æ•ˆçš„ï¼ˆæ¯”å¦‚åº”ç”¨è¯¥å€¼åï¼Œæ‰§è¡Œåˆ°(amb)äº†ï¼‰â€ï¼Œåˆ™æ‰§è¡Œ(prev-amb-fail)ï¼Œè€Œprev-amb-failåœ¨è¿›å…¥ambçš„æ—¶å€™è¢«ç»‘å®šåˆ°äº†amb-failï¼Œ ä¸è¿‡amb-failå·²è¢«è®¾ç½®æˆäº†ä¸€ä¸ªå‡½æ•°ï¼š\n(lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) å®ƒå…ˆæŠŠamb-failè®¾ç½®æˆprev-amb-fail,ä¹Ÿå°±æ˜¯è¿›å…¥ï¼ˆamb alt \u0026hellip;ï¼‰ä¹‹å‰çš„å€¼ï¼Œ ç„¶åç”¨(fk \u0026lsquo;fail)è¿”å›\u0026rsquo;failåˆ°åˆ†æ”¯çš„continuationï¼Œå³å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯ï¼ˆä¸‹ä¸€ä¸ªé€‰é¡¹ï¼‰äº†ã€‚\nååˆ†ç²¾å·§çš„ç¨‹åºï¼ï¼ï¼\nä¸Šè¿°çš„ambæ¯æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå¦‚æœéœ€è¦è¿”å›æ‰€æœ‰æœ‰æ•ˆçš„ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢å®šä¹‰çš„å®ï¼š\n(define-syntax bag-of (syntax-rules () ((bag-of e) (let ((prev-amb-fail amb-fail) (results \u0026#39;())) (if (call/cc (lambda (k) (set! amb-fail (lambda () (k #f))) ;\u0026lt;-----+ (let ((v e)) ;amb-fail will be modified by e | (set! results (cons v results)) ;| (k #t)))) ;| (amb-fail)) ;so this amb-fail may not be ---+ (set! amb-fail prev-amb-fail) (reverse! results))))) (bag-of (let ([a (amb 1 2 3)] [b (amb 0 -1 2)]) (if (= (+ a b) 1) (list a b) (amb)) )) ;ç»“æœä¸ºï¼š((1 0) (2 -1)) å›åˆ°n-çš‡åé—®é¢˜ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å·²æ‰‹æ¡ambè¿™æŠŠåˆ©å™¨ï¼Œæ˜¯æ—¶å€™é‡æ„ä¸€ä¸‹n-çš‡åé—®é¢˜äº†ã€‚\n(define number-between (lambda (lo hi) (let loop ((i lo)) (if (\u0026gt; i hi) (amb) (amb i (loop (+ i 1))))))) ; (amb 1 (amb 2 (amb 3 ... ))) (define (n-queens n) (call/cc (lambda (return) (let add-queen ([i 0] [result \u0026#39;()]) (when (\u0026lt; i n) ;æœ€å¤šæ‘†å‡ ä¸ªçš‡å (let ([new-queen (number-between 1 n)]) (if (safe? n (append (list new-queen) result)) ;æ–°åŠ å…¥çš„çš‡åå¿…é¡»æ˜¯æœ‰æ•ˆçš„ (add-queen (+ i 1) (append (list new-queen) result)) (amb)) ) ) (return result) ) ) ) ) (bag-of (n-queens 8)) ;8ä¸ªçš‡åçš„æ‰€æœ‰è§£ è¯¥ç‰ˆæœ¬æ¯”ä¹‹å‰çš„Schemeç‰ˆæœ¬çš„å®ç°æ”¹è¿›äº†å¾ˆå¤šï¼Œç°åœ¨åªéœ€è¦æè¿°ä¸€ä¸‹æˆ‘çš„é—®é¢˜çš„å…³ç³»å³å¯ï¼Œç¨‹åºä¼šè‡ªåŠ¨é€‰æ‹©æ‰€æœ‰æ­£ç¡®çš„å€¼ï¼Œæ— éœ€å…³å¿ƒè®¡ç®—æœºå†…éƒ¨åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨é¢å¯¹å¾ˆå¤šé€»è¾‘é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°è§£å†³äº†ã€‚\nä¹Ÿè®¸æœ‰äººä¼šé—®ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼è¯­è¨€æ¥å¤„ç†çš„è¯ï¼Œå¯èƒ½å‡ ä¸ªåµŒå¥—çš„å¾ªç¯ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœï¼Œå¦‚æ­¤å¤§è´¹å‘¨ç« çš„ä»‹ç»è¿™ä¸ªå«ambçš„æŠ€æœ¯ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆä»·å€¼å‘¢ï¼Ÿ é‚£å°±æ¥èŠä¸€èŠã€‚\næœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ åœ¨è°ˆè®ºæ„ä¹‰ä¹‹å‰ï¼Œå®¹è®¸æˆ‘æä¸€ä¸ªé—®é¢˜\nä¸ºä»€ä¹ˆSQLè¯­è¨€è¦è®¾è®¡æˆè¿™æ ·ï¼Ÿä¸å‘½ä»¤å¼è¯­è¨€å¦‚æ­¤çš„ä¸åŒï¼Ÿ\né¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè®¡ç®—æœºç§‘å­¦å¤„ç†çš„æ˜¯å‘½ä»¤å¼ï¼ˆæ€æ ·åšï¼‰çš„çŸ¥è¯†ï¼Œè€Œæ•°å­¦å¤„ç†çš„æ˜¯è¯´æ˜å¼ï¼ˆæ˜¯ä»€ä¹ˆï¼‰çš„çŸ¥è¯†ã€‚ äº‹å®ä¸Šï¼Œäººç±»ä¸å¯èƒ½åªé¢ä¸´å…¶ä¸­ä¸€ç§é—®é¢˜ï¼Œç¨‹åºè®¾è®¡ä¸­ä¸€ä¸ªé‡è¦çš„åˆ†æ”¯å°±æ˜¯é€»è¾‘ç¨‹åºè®¾è®¡ï¼Œæœ‰å¾ˆå¤šé—®é¢˜æˆ–è€…æ•°æ®ä¹‹é—´å­˜åœ¨ç€å…³è”å…³ç³»ï¼Œéš¾ä»¥è§‚æµ‹åˆ°ç»“è®ºï¼Œæè¿°å®ƒä»¬çš„å…³ç³»å¾ˆç®€å•ï¼Œä½†æ˜¯ç›´æ¥å‘Šè¯‰è®¡ç®—æœºå¦‚ä½•å»åšå´ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥ä¸ºè‹¥å¹²æ­¤ç±»é—®é¢˜ç¼–å†™å‘½ä»¤å¼ä»£ç ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ‰€æœ‰è¿™æ ·çš„é—®é¢˜éƒ½ç¼–å†™ä»£ç ï¼Œæ˜¾ç„¶ä¿¡æ¯ä¹‹é—´çš„å…³ç³»æ˜¯å¤šç§å¤šæ ·çš„ï¼Œé‚£ä¹ˆä»£ç å°±éœ€è¦ç›¸åº”çš„å˜åŒ–ï¼Œå¾€å¾€ä¿®æ”¹è¿™æ ·çš„ä»£ç æ˜¯å¾ˆå›°éš¾çš„ï¼Œ ç”šè‡³éœ€è¦é‡æ–°è®¾è®¡å¹¶ç¼–ç ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç¨‹åºè®¾è®¡å¯ä»¥å¤„ç†è¯´æ˜å¼çš„çŸ¥è¯†ï¼Œå²‚ä¸æ˜¯å¤§å¤§å‡è½»äº†ç¨‹åºå‘˜çš„å·¥ä½œäº†å‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€çš„è®¾è®¡æ˜¯åŸºäºlambdaç†è®ºï¼Œå›´ç»•ç€æ•°å­¦å‡½æ•°å€¼çš„è®¡ç®—ç»„ç»‡èµ·æ¥çš„ï¼Œä¾é å…¶å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œåœ¨å¤„ç†é€»è¾‘é—®é¢˜ä¸Šæ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼Œå¯ä»¥åŒ–ç¹ä¸ºç®€ã€‚\nè¯´åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ï¼Œä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ä¹‹é—´å­˜åœ¨ç€ç§ç§è”ç³»å‘¢ï¼ŸSQLæ­£æ˜¯æè¿°äº†è¿™ç§å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰æ•°æ®åº“æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ•°æ®ï¼ˆselectï¼‰, æ•°æ®åœ¨ä»€ä¹ˆä½ç½®ï¼ˆfromï¼‰, å“ªäº›æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆwhereï¼‰å°±è¡Œäº†ï¼Œå¹¶ä¸éœ€è¦å‘Šè¯‰æ•°æ®åº“è¯¥å¦‚ä½•å…·ä½“æ“ä½œï¼Œæ•°æ®åº“å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„æè¿°ï¼ˆSQLï¼‰å°±èƒ½å¤Ÿå‡†ç¡®çš„è¿”å›ç»“æœï¼Œè¿™çœŸæ˜¯å…³äºéç¡®å®šæ€§è®¡ç®—çš„ä¸€ä¸ªæå¥½çš„ä¾‹å­ï¼Œæ­¤æ—¶æˆ‘ä»¬æ€»è¯¥æ˜ç™½ä¸ºä»€ä¹ˆæ•°æ®åº“å«åšå…³ç³»å‹æ•°æ®åº“ äº†å§ã€‚æˆ‘ä»¬ä¸å¦¨è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸é‡‡ç”¨æè¿°çš„æ–¹å¼æ¥æŸ¥è¯¢æ•°æ®ï¼Œç¨‹åºå‘˜ä»¬è¯¥æ€ä¹ˆåšï¼Ÿè¿˜èƒ½å¤Ÿè½»æ˜“çš„æŸ¥æ‰¾åˆ°éœ€è¦çš„æ•°æ®å—ï¼Ÿ\nåˆšæ‰æˆ‘æå‡ºçš„é—®é¢˜ï¼Œæƒ³å¿…æ­¤åˆ»åº”è¯¥æœ‰ç­”æ¡ˆäº†ã€‚\n","id":12,"section":"posts","summary":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡º","tags":["scheme"],"title":"ä»â€œå…«çš‡åâ€åˆ°amb","uri":"https://lvsq.net/2020/05/n-queens/","year":"2020"},{"content":" ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah\nä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°å…¶ä»–è¯­è¨€ 2ï¼‰ç”¨äºæ„å»ºå¯ä¼¸ç¼©å’Œå¼¹æ€§å¹¶å‘ç³»ç»Ÿçš„OTPåº“å’Œä¸­é—´ä»¶ï¼Œä»¥åŠ 3ï¼‰ä¸è¯­è¨€è¯­ä¹‰ç´§å¯†è€¦åˆçš„BEAMè™šæ‹Ÿæœºå’ŒOTPã€‚\nå•ç‹¬ä½¿ç”¨è¿™äº›ç»„ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨å°†è·å¾—äºšå†›ã€‚ä½†æ˜¯ï¼Œå°†è¿™ä¸‰ä¸ªå› ç´ æ”¾åœ¨ä¸€èµ·ï¼Œæ‚¨å°†è·å¾—å¯ä¼¸ç¼©ï¼Œçµæ´»çš„è½¯å®æ—¶ç³»ç»Ÿçš„æ— å¯äº‰è®®çš„èµ¢å®¶ã€‚å¼•ç”¨Joe Armstrongçš„è¯ï¼šâ€œæ‚¨å¯ä»¥å¤åˆ¶Erlangåº“ï¼Œä½†æ˜¯å¦‚æœå®ƒä¸èƒ½åœ¨BEAMä¸Šè¿è¡Œï¼Œåˆ™æ— æ³•æ¨¡æ‹Ÿè¯­ä¹‰â€ã€‚è¿™æ˜¯ç”±ç½—ä¼¯ç‰¹Â·ç»´å°”ä¸ï¼ˆRobert Virdingï¼‰çš„ã€Šç¬¬ä¸€æ¡ç¼–ç¨‹è§„åˆ™ã€‹å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œè¯¥æ¡è§„å®šï¼šâ€œä»»ä½•å¦ä¸€ç§è¶³å¤Ÿå¤æ‚çš„å¹¶å‘ç¨‹åºéƒ½ä½¿ç”¨å¦ä¸€ç§è¯­è¨€ï¼ŒåŒ…å«éæ­£å¼çš„ï¼Œä¸´æ—¶æŒ‡å®šçš„ï¼Œbugç¼ èº«çš„ç¼“æ…¢çš„Erlangä¸€åŠå®ç°ã€‚â€\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æƒ³æ¢ç´¢BEAM VMå†…éƒ¨ã€‚æˆ‘ä»¬å°†åœ¨é€‚ç”¨çš„æƒ…å†µä¸‹å°†å®ƒä»¬ä¸JVMè¿›è¡Œæ¯”è¾ƒå’Œå¯¹æ¯”ï¼Œå¼ºè°ƒæ‚¨ä¸ºä»€ä¹ˆè¦æ³¨æ„å®ƒä»¬å¹¶åŠ ä»¥æ³¨æ„ã€‚é•¿æœŸä»¥æ¥ï¼Œæ­¤ç»„ä»¶ä¸€ç›´è¢«è§†ä¸ºé»‘åŒ£å­ï¼Œå¹¶ä¸”åœ¨ä¸äº†è§£åŸå› æˆ–å«ä¹‰çš„æƒ…å†µä¸‹è¢«è§†ä¸ºç†æ‰€å½“ç„¶ã€‚ç°åœ¨è¯¥æ”¹å˜è¿™ç§æƒ…å†µäº†ï¼\nBEAMçš„äº®ç‚¹ å‘æ˜Erlangå’ŒBEAM VMæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„æ­£ç¡®å·¥å…·ã€‚å®ƒä»¬æ˜¯ç”±çˆ±ç«‹ä¿¡å¼€å‘çš„ï¼Œæ—¨åœ¨å¸®åŠ©å®ç°å¤„ç†ç§»åŠ¨å’Œå›ºå®šç½‘ç»œçš„ç”µä¿¡åŸºç¡€è®¾æ–½ã€‚è¯¥åŸºç¡€æ¶æ„æœ¬è´¨ä¸Šæ˜¯é«˜åº¦å¹¶å‘å’Œå¯ä¼¸ç¼©çš„ã€‚å®ƒå¿…é¡»æ˜¾ç¤ºè½¯å®æ—¶å±æ€§ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ã€‚æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ‰‹æœºä¸Šä¸ç¥–æ¯è¿›è¡Œç¯èŠé€šè¯æ—¶æ‰çº¿æˆ–Fortniteçš„åœ¨çº¿æ¸¸æˆä½“éªŒä¸ä¼šå—åˆ°ç³»ç»Ÿå‡çº§ï¼Œé«˜ç”¨æˆ·è´Ÿè½½æˆ–è½¯ä»¶ï¼Œç¡¬ä»¶å’Œç½‘ç»œä¸­æ–­çš„å½±å“ã€‚BEAM VMé€šè¿‡æä¾›å¯åœ¨å¯é¢„æµ‹çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¹‹ä¸Šè¿è¡Œçš„å¾®è°ƒåŠŸèƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥è§£å†³è®¸å¤šæŒ‘æˆ˜ã€‚\nå®ƒçš„ç§˜è¯€æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œå®ƒä»¬ä¸å…±äº«å†…å­˜ï¼Œç”±è°ƒåº¦ç¨‹åºç®¡ç†ï¼Œè¯¥è°ƒåº¦ç¨‹åºå¯ä»¥è·¨å¤šä¸ªå†…æ ¸ç®¡ç†æ•°ç™¾ä¸‡ä¸ªè¿›ç¨‹ã€‚å®ƒä½¿ç”¨åŸºäºæ¯ä¸ªè¿›ç¨‹è¿è¡Œçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ä»¥å‡å°‘å¯¹å…¶ä»–è¿›ç¨‹çš„å½±å“ã€‚ç»“æœï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“è½¯å®æ—¶å±æ€§ã€‚BEAMä¹Ÿæ˜¯å”¯ä¸€ä½¿ç”¨è§„æ¨¡å¹¿æ³›ä¸”å…·æœ‰å†…ç½®åˆ†å‘æ¨¡å‹çš„VMï¼Œå®ƒå…·æœ‰å†…ç½®çš„åˆ†å‘æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…è®¸ç¨‹åºé€æ˜åœ°åœ¨å¤šå°è®¡ç®—æœºä¸Šè¿è¡Œã€‚\nJVMçš„äº®ç‚¹ Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æ˜¯â€‹â€‹ç”±Sun Microsystemå¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¯åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„â€œä¸€æ¬¡å†™å…¥â€ä»£ç çš„å¹³å°ã€‚ä»–ä»¬åˆ›å»ºäº†ä¸€ç§ç±»ä¼¼äºC++çš„é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æ˜¯å†…å­˜å®‰å…¨ï¼Œå› ä¸ºå…¶è¿è¡Œæ—¶é”™è¯¯æ£€æµ‹ä¼šæ£€æŸ¥æ•°ç»„èŒƒå›´å’ŒæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚åœ¨Internetæ—¶ä»£ï¼ŒJVMç”Ÿæ€ç³»ç»Ÿå˜å¾—éå¸¸æµè¡Œï¼Œä½¿å…¶æˆä¸ºä¼ä¸šæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®é™…æ ‡å‡†ã€‚æ»¡è¶³å¹¿æ³›ç”¨ä¾‹çš„è™šæ‹Ÿæœºå’Œå¯æ»¡è¶³ä¼ä¸šå‘å±•éœ€æ±‚çš„ä»¤äººå°è±¡æ·±åˆ»çš„åº“é›†ä½¿å¹¿æ³›çš„é€‚ç”¨æ€§æˆä¸ºå¯èƒ½ã€‚\nJVMè®¾è®¡æ—¶è€ƒè™‘äº†æ•ˆç‡ã€‚å®ƒçš„å¤§å¤šæ•°æ¦‚å¿µæ˜¯æµè¡Œæ“ä½œç³»ç»Ÿä¸­åŠŸèƒ½çš„æŠ½è±¡ï¼Œä¾‹å¦‚æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„çº¿ç¨‹æ¨¡å‹ã€‚JVMæ˜¯é«˜åº¦å¯å®šåˆ¶çš„ï¼ŒåŒ…æ‹¬åƒåœ¾æ”¶é›†å™¨ï¼ˆGCï¼‰å’Œç±»åŠ è½½å™¨ã€‚ä¸€äº›æœ€å…ˆè¿›çš„GCå®ç°æä¾›é«˜åº¦å¯è°ƒæ•´çš„åŠŸèƒ½ï¼Œä»¥é€‚åº”åŸºäºå…±äº«å†…å­˜çš„ç¼–ç¨‹æ¨¡å‹ã€‚JVMå…è®¸æ‚¨åœ¨ç¨‹åºè¿è¡Œæ—¶æ›´æ”¹ä»£ç ã€‚è€Œä¸”ï¼ŒJITç¼–è¯‘å™¨å…è®¸å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬æœºä»£ç ï¼Œç›®çš„æ˜¯åŠ å¿«åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†ã€‚\nJavaä¸–ç•Œä¸­çš„å¹¶å‘æ€§ä¸»è¦ä¸åœ¨å¹¶è¡Œçº¿ç¨‹ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæœ‰å…³ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ˜¯å¿«é€Ÿçš„ã€‚ç”±äºå¹¶å‘åŸè¯­çš„å…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå› æ­¤ä½¿ç”¨å¹¶å‘åŸè¯­è¿›è¡Œç¼–ç¨‹æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ï¼Œäººä»¬å°è¯•ç®€åŒ–å’Œç»Ÿä¸€å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œæœ€æˆåŠŸçš„å°è¯•æ˜¯Akkaæ¡†æ¶ã€‚\nå¹¶å‘ä¸å¹¶è¡Œ å¦‚æœéƒ¨åˆ†ä»£ç åœ¨å¤šä¸ªå†…æ ¸ï¼Œå¤„ç†å™¨æˆ–è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œï¼Œåˆ™æˆ‘ä»¬è°ˆè®ºå¹¶è¡Œä»£ç æ‰§è¡Œï¼Œè€Œå¹¶å‘ç¼–ç¨‹æ˜¯æŒ‡ç‹¬ç«‹å¤„ç†åˆ°è¾¾ç³»ç»Ÿçš„äº‹ä»¶ã€‚å¯ä»¥åœ¨å•çº¿ç¨‹ç¡¬ä»¶ä¸Šæ¨¡æ‹Ÿå¹¶å‘æ‰§è¡Œï¼Œè€Œå¹¶è¡Œæ‰§è¡Œåˆ™ä¸èƒ½ã€‚å°½ç®¡è¿™ç§åŒºåˆ«ä¼¼ä¹å¾ˆå¤æ€ªï¼Œä½†è¿™ç§å·®å¼‚å¯¼è‡´éœ€è¦è§£å†³çš„é—®é¢˜éå¸¸ä¸åŒã€‚æƒ³æƒ³å¾ˆå¤šå¨å¸ˆåœ¨åšä¸€ç›˜Carbonaraæ„å¤§åˆ©é¢ã€‚åœ¨å¹¶è¡Œæ–¹æ³•ä¸­ï¼Œå°†ä»»åŠ¡åˆ†é…ç»™å¯ç”¨å¨å¸ˆçš„æ•°é‡ï¼Œå¹¶ä¸”åªè¦å®Œæˆè¿™äº›å¨å¸ˆå®Œæˆå…¶ç‰¹å®šä»»åŠ¡çš„é€Ÿåº¦ï¼Œå°±å¯ä»¥å®Œæˆå•ä¸ªéƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ªå¹¶å‘çš„ä¸–ç•Œä¸­ï¼Œæ¯ä½å¨å¸ˆå°†è·å¾—ä¸€éƒ¨åˆ†ï¼Œæ¯ä½å¨å¸ˆå°†å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚æ‚¨å°†å¹¶è¡Œæ€§ç”¨äºé€Ÿåº¦ï¼Œå¹¶å‘æ€§ç”¨äºè§„æ¨¡ã€‚\nå¹¶è¡Œæ‰§è¡Œè¯•å›¾å°†é—®é¢˜çš„æœ€ä½³åˆ†è§£è§£å†³ä¸ºå½¼æ­¤ç‹¬ç«‹çš„éƒ¨åˆ†ã€‚å°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ï¼Œç‚¸ç“œé‡Œé˜¿å¡ç«è…¿ï¼Œå°†ä½©å…‹ç«‹è¯ºå¥¶é…ªç£¨ç¢1ã€‚å…±äº«æ•°æ®ï¼ˆæˆ–åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºé¤ç›˜ï¼‰ç”±é”ï¼Œäº’æ–¥é”å’Œå„ç§å…¶ä»–æŠ€æœ¯å¤„ç†ï¼Œä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å¦ä¸€ç§çœ‹å¾…è¿™ç§æƒ…å†µçš„æ–¹å¼æ˜¯å­˜åœ¨æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åˆ©ç”¨å°½å¯èƒ½å¤šçš„å¹¶è¡ŒCPUèµ„æºæ¥å°½å¿«å®Œæˆå·¥ä½œã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¹¶â€‹â€‹å‘ç¼–ç¨‹å¤„ç†è®¸å¤šäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶åœ¨ä¸åŒçš„æ—¶é—´åˆ°è¾¾ç³»ç»Ÿï¼Œå¹¶å°è¯•åœ¨åˆç†çš„æ—¶é—´å†…å¤„ç†æ‰€æœ‰äº‹ä»¶ã€‚åœ¨å¤šæ ¸æˆ–åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸Šï¼ŒæŸäº›æ‰§è¡Œæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚å¦ä¸€ç§çœ‹å¾…å®ƒçš„æ–¹æ³•æ˜¯ï¼ŒåŒä¸€ä½å¨å¸ˆæŒ‰ç…§å§‹ç»ˆç›¸åŒçš„é¡ºåºç®—æ³•ï¼Œå°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ç­‰ã€‚è·¨è¿‡ç¨‹ï¼ˆæˆ–åšé¥­ï¼‰çš„å˜åŒ–æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œè¿™äº›æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰å­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸­ã€‚\nJVMæ˜¯ä¸ºå¹¶è¡Œè€Œæ„å»ºçš„ï¼Œè€ŒBEAMæ˜¯ä¸ºå¹¶å‘æ„å»ºçš„ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªæœ¬è´¨ä¸Šä¸åŒçš„é—®é¢˜ï¼Œéœ€è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚\nBEAMå’Œå¹¶å‘ BEAMæä¾›è½»é‡çº§æµç¨‹ä¸ºæ­£åœ¨è¿è¡Œçš„ä»£ç æä¾›ä¸Šä¸‹æ–‡ã€‚è¿™äº›è¿›ç¨‹ä¹Ÿç§°ä¸ºactorï¼Œä¸å…±äº«å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œå°†æ•°æ®ä»ä¸€ä¸ªè¿›ç¨‹å¤åˆ¶åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯è™šæ‹Ÿæœºé€šè¿‡å„ä¸ªè¿›ç¨‹æ‹¥æœ‰çš„é‚®ç®±å®ç°çš„åŠŸèƒ½ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯ä¸€ç§éé˜»å¡æ“ä½œï¼Œè¿™æ„å‘³ç€å°†æ¶ˆæ¯å‘é€åˆ°å¦ä¸€ä¸ªè¿›ç¨‹å‡ ä¹æ˜¯å³æ—¶çš„ï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡å‘é€è€…çš„æ‰§è¡Œã€‚å‘é€çš„æ¶ˆæ¯é‡‡ç”¨ä¸å¯å˜æ•°æ®çš„å½¢å¼ï¼Œä»å‘é€è¿‡ç¨‹çš„å †æ ˆå¤åˆ¶åˆ°æ¥æ”¶è€…çš„é‚®ç®±ã€‚æ— éœ€åœ¨è¿›ç¨‹ä¹‹é—´ä½¿ç”¨é”å’Œäº’æ–¥é”å³å¯å®ç°æ­¤ç›®çš„ï¼Œè€Œåœ¨å¤šä¸ªè¿›ç¨‹å¹¶è¡Œå°†æ¶ˆæ¯å‘é€åˆ°åŒä¸€æ”¶ä»¶äººçš„æƒ…å†µä¸‹ï¼Œåªéœ€å¯¹é‚®ç®±è¿›è¡Œé”å®šå³å¯ã€‚\nä¸å˜çš„æ•°æ®å’Œæ¶ˆæ¯ä¼ é€’ä½¿ç¨‹åºå‘˜èƒ½å¤Ÿç¼–å†™å½¼æ­¤ç‹¬ç«‹å·¥ä½œçš„æµç¨‹ï¼Œå¹¶ä¸“æ³¨äºåŠŸèƒ½è€Œä¸æ˜¯å†…å­˜çš„ä½çº§ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ã€‚äº‹å®è¯æ˜ï¼Œè¿™ç§ç®€å•çš„è®¾è®¡ä¸ä»…é€‚ç”¨äºå•ä¸ªçº¿ç¨‹ï¼Œè€Œä¸”é€‚ç”¨äºåœ¨åŒä¸€VMä¸­è¿è¡Œçš„æœ¬åœ°è®¡ç®—æœºä¸Šçš„å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„åˆ†å‘ï¼Œåœ¨æ•´ä¸ªç½‘ç»œä¸Šé€šè¿‡VMå’Œè®¡ç®—æœºé›†ç¾¤è¿è¡Œã€‚å¦‚æœæ¶ˆæ¯åœ¨è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å¯å˜çš„ï¼Œåˆ™å¯ä»¥ä¸åŠ é”åœ°å°†å®ƒä»¬å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–è®¡ç®—æœºï¼‰ï¼Œä»è€Œåœ¨åˆ†å¸ƒå¼å¤šæ ¸ä½“ç³»ç»“æ„ä¸Šå‡ ä¹çº¿æ€§åœ°æ‰©å±•ã€‚è¿›ç¨‹åœ¨æœ¬åœ°VMä¸Šçš„å¯»å€æ–¹å¼ä¸VMç¾¤é›†ä¸­çš„å¯»å€æ–¹å¼ç›¸åŒï¼Œæ— è®ºæ¥æ”¶è¿›ç¨‹çš„ä½ç½®å¦‚ä½•ï¼Œæ¶ˆæ¯å‘é€éƒ½æ˜¯é€æ˜çš„ã€‚\nè¿›ç¨‹ä¸å…±äº«å†…å­˜ï¼Œå› æ­¤æ‚¨å¯ä»¥å¤åˆ¶æ•°æ®ä»¥æ¢å¤å¼¹æ€§å¹¶åˆ†å‘æ•°æ®ä»¥å®ç°è§„æ¨¡æ‰©å±•ã€‚è¿™æ„å‘³ç€åœ¨ä¸¤ä¸ªä¸åŒçš„æœºå™¨ä¸Šå…·æœ‰ç›¸åŒè¿›ç¨‹çš„ä¸¤ä¸ªå®ä¾‹ï¼Œå½¼æ­¤ä¹‹é—´å…±äº«çŠ¶æ€æ›´æ–°ã€‚å¦‚æœä¸€å°è®¡ç®—æœºå‘ç”Ÿæ•…éšœï¼Œåˆ™å¦ä¸€å°è®¡ç®—æœºå…·æœ‰æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç»§ç»­å¤„ç†è¯¥è¯·æ±‚ï¼Œä»è€Œä½¿ç³»ç»Ÿå…·æœ‰å®¹é”™èƒ½åŠ›ã€‚å¦‚æœä¸¤å°è®¡ç®—æœºéƒ½å¯è¿è¡Œï¼Œåˆ™ä¸¤ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä»è€Œä¸ºæ‚¨æä¾›å¯ä¼¸ç¼©æ€§ã€‚BEAMä¸ºæ‰€æœ‰è¿™äº›æ— ç¼é›†æˆæä¾›äº†é«˜åº¦ä¼˜åŒ–çš„åŸè¯­ï¼Œè€ŒOTPï¼ˆâ€œæ ‡å‡†åº“â€ï¼‰åˆ™æä¾›äº†æ›´é«˜çº§åˆ«çš„ç»“æ„ä»¥ç®€åŒ–ç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚\nAkkaåœ¨å¤åˆ¶æ›´é«˜çº§åˆ«çš„ç»“æ„æ–¹é¢åšå¾—å¾ˆå¥½ï¼Œä½†æ˜¯ç”±äºç¼ºå°‘JVMæä¾›çš„åŸè¯­è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå—åˆ°äº†é™åˆ¶ï¼Œä»è€Œä½¿å…¶å¯ä»¥é«˜åº¦ä¼˜åŒ–å¹¶å‘æ€§ã€‚å°½ç®¡JVMçš„åŸè¯­æ”¯æŒæ›´å¹¿æ³›çš„ç”¨ä¾‹ï¼Œä½†ç”±äºå®ƒä»¬æ²¡æœ‰ç”¨äºé€šä¿¡çš„å†…ç½®åŸè¯­ä¸”é€šå¸¸åŸºäºå…±äº«å†…å­˜æ¨¡å‹ï¼Œå› æ­¤å®ƒä»¬ä½¿å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¼–ç¨‹å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¾‹å¦‚ï¼Œæ‚¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä½•å¤„æ”¾ç½®å…±äº«å†…å­˜ï¼Ÿä»¥åŠè®¿é—®å®ƒçš„æˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ\nè°ƒåº¦å™¨ æˆ‘ä»¬æåˆ°è¿‡ï¼ŒBEAMçš„æœ€å¼ºåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿå°†ç¨‹åºåˆ†è§£ä¸ºå°çš„ï¼Œè½»é‡çº§çš„è¿‡ç¨‹ã€‚ç®¡ç†è¿™äº›è¿‡ç¨‹æ˜¯è°ƒåº¦ç¨‹åºçš„ä»»åŠ¡ã€‚ä¸JVMå°†å…¶çº¿ç¨‹æ˜ å°„åˆ°OSçº¿ç¨‹å¹¶è®©æ“ä½œç³»ç»Ÿè°ƒåº¦å®ƒä»¬ä¸åŒï¼ŒBEAMå¸¦æœ‰è‡ªå·±çš„è°ƒåº¦ç¨‹åºã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç¨‹åºä¸ºæ¯ä¸ªå†…æ ¸å¯åŠ¨ä¸€ä¸ªOSçº¿ç¨‹ï¼Œå¹¶ä¼˜åŒ–å®ƒä»¬ä¹‹é—´çš„å·¥ä½œè´Ÿè½½ã€‚æ¯ä¸ªè¿‡ç¨‹éƒ½åŒ…å«è¦æ‰§è¡Œçš„ä»£ç å’Œéšæ—¶é—´å˜åŒ–çš„çŠ¶æ€ã€‚è°ƒåº¦ç¨‹åºä¼šé€‰æ‹©è¿è¡Œé˜Ÿåˆ—ä¸­å‡†å¤‡è¿è¡Œçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºå…¶èµ‹äºˆå®šé‡çš„reductionsï¼ˆè¯‘è€…æ³¨ï¼š2000ä¸ªï¼‰ï¼Œå…¶ä¸­æ¯æ¬¡reductionéƒ½å¤§è‡´ç­‰åŒäºä¸€æ¡æŒ‡ä»¤ã€‚ä¸€æ—¦è¿›ç¨‹ç”¨å°½äº†reductionsï¼Œä¼šè¢«I/Oé˜»å¡ï¼Œç­‰å¾…æ¶ˆæ¯æˆ–ä»£ç å®Œæˆï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šåœ¨è¿è¡Œé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹å¹¶å°†å…¶åˆ†æ´¾ï¼ˆæ­¤å¥ç¿»è¯‘æœ‰é—®é¢˜ï¼šåŸæ–‡æ˜¯Once the process has either run out of reductions, is blocked by I/O, is waiting for a message or completes executing its code, the scheduler picks the next process in the run queue and dispatches it. å¦‚æœæ‚¨æœ‰æ›´å¥½çš„ç¿»è¯‘è¯·ä¸åæŒ‡æ•™ï¼‰ã€‚è¿™ç§è°ƒåº¦æŠ€æœ¯ç§°ä¸ºæŠ¢å…ˆå¼ã€‚\næˆ‘ä»¬å¤šæ¬¡æåˆ°Akkaæ¡†æ¶ï¼Œå› ä¸ºå®ƒçš„æœ€å¤§ç¼ºç‚¹æ˜¯éœ€è¦åœ¨è°ƒåº¦å¤„æ·»åŠ æ³¨è§£ï¼Œå› ä¸ºè°ƒåº¦ä¸æ˜¯åœ¨JVMçº§åˆ«è¿›è¡Œçš„ã€‚é€šè¿‡è§£é™¤ç¨‹åºå‘˜çš„æ§åˆ¶ï¼Œå¯ä»¥ä¿ç•™å’Œä¿è¯è½¯å®æ—¶å±æ€§ï¼Œä»è€Œå‡ä½äº†å¯¼è‡´è¿›ç¨‹é¥¿æ­»çš„é£é™©ã€‚\nè¿›ç¨‹å›´ç»•ç€è°ƒåº¦ç¨‹åºçº¿ç¨‹ï¼Œå¹¶æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨CPUã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è°ƒæ•´è°ƒåº¦ç¨‹åºï¼Œä½†æ˜¯å®ƒå¾ˆå°‘è§ï¼Œä»…åœ¨è¾¹ç¼˜å’Œè¾¹ç•Œæƒ…å†µä¸‹æ‰éœ€è¦ï¼Œå› ä¸ºé»˜è®¤é€‰é¡¹æ¶µç›–äº†å¤§å¤šæ•°ä½¿ç”¨æ¨¡å¼ã€‚\nå…³äºè°ƒåº¦ç¨‹åºï¼Œç»å¸¸å‡ºç°ä¸€ä¸ªæ•æ„Ÿçš„è¯é¢˜ï¼šå¦‚ä½•å¤„ç†æœ¬æœºå®ç°çš„å‡½æ•°ï¼ˆNIFï¼‰ã€‚NIFæ˜¯ç”¨Cç¼–å†™çš„ä»£ç ç‰‡æ®µï¼Œè¢«ç¼–è¯‘ä¸ºåº“å¹¶åœ¨ä¸BEAMç›¸åŒçš„å†…å­˜ç©ºé—´ä¸­è¿è¡Œä»¥æé«˜é€Ÿåº¦ã€‚NIFçš„é—®é¢˜åœ¨äºå®ƒä»¬ä¸æ˜¯æŠ¢å å¼çš„ï¼Œå¹¶ä¸”ä¼šå½±å“è°ƒåº¦ç¨‹åºã€‚åœ¨æœ€æ–°çš„BEAMç‰ˆæœ¬ä¸­ï¼Œæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå³è„è°ƒåº¦ç¨‹åºï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶NIFã€‚è‚®è„çš„è°ƒåº¦ç¨‹åºæ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œçš„å•ç‹¬çš„è°ƒåº¦ç¨‹åºï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘NIFå¯¹ç³»ç»Ÿé€ æˆçš„ä¸­æ–­ã€‚è„è¿™ä¸ªè¯æ˜¯æŒ‡è¿™äº›è°ƒåº¦ç¨‹åºè¿è¡Œçš„ä»£ç çš„æ€§è´¨ã€‚\nåƒåœ¾æ”¶é›†å™¨ å½“ä»Šï¼Œç°ä»£çš„é«˜çº§ç¼–ç¨‹è¯­è¨€å¤§å¤šä½¿ç”¨åƒåœ¾å›æ”¶å™¨è¿›è¡Œå†…å­˜ç®¡ç†ã€‚BEAMè¯­è¨€ä¹Ÿä¸ä¾‹å¤–ã€‚å½“æ‚¨è¦ç¼–å†™é«˜çº§å¹¶å‘ä»£ç æ—¶ï¼Œä¿¡ä»»è™šæ‹Ÿæœºæ¥å¤„ç†èµ„æºå’Œç®¡ç†å†…å­˜éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºè¿™å¯ä»¥ç®€åŒ–ä»»åŠ¡ã€‚å½’åŠŸäºåŸºäºä¸å¯å˜çŠ¶æ€çš„å†…å­˜æ¨¡å‹ï¼Œåƒåœ¾æ”¶é›†å™¨çš„åŸºç¡€å®ç°éå¸¸ç®€å•æœ‰æ•ˆã€‚æ•°æ®è¢«å¤åˆ¶è€Œä¸æ˜¯çªå˜ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸å…±äº«å†…å­˜è¿™ä¸€äº‹å®æ¶ˆé™¤äº†ä»»ä½•è¿›ç¨‹çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå› æ­¤ä¸éœ€è¦ç®¡ç†å®ƒä»¬ã€‚\nBEAMçš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰åœ¨æ¯ä¸ªè¿›ç¨‹çš„åŸºç¡€ä¸Šè¿è¡Œåƒåœ¾å›æ”¶ï¼Œè€Œä¸ä¼šå½±å“åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„å…¶ä»–è¿›ç¨‹ã€‚ç»“æœï¼ŒErlangä¸­çš„åƒåœ¾æ”¶é›†ä¸ä¼šâ€œstop-the-worldâ€ã€‚å®ƒå¯ä»¥é˜²æ­¢å¤„ç†å»¶è¿Ÿé«˜å³°ï¼Œå› ä¸ºVMä¸ä¼šä»æ•´ä½“ä¸Šåœæ­¢â€”â€”ä»…ç‰¹å®šè¿›ç¨‹åœæ­¢ï¼Œå¹¶ä¸”ç»ä¸ä¼šåŒæ—¶åœæ­¢æ‰€æœ‰è¿›ç¨‹ã€‚å®é™…ä¸Šï¼Œè¿™åªæ˜¯æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”è¢«è§†ä¸ºå¦ä¸€ç§reductionã€‚åƒåœ¾æ”¶é›†å™¨æ”¶é›†è¿‡ç¨‹å°†è¿‡ç¨‹æš‚åœå¾ˆçŸ­çš„æ—¶é—´é—´éš”ï¼Œé€šå¸¸æ˜¯å¾®ç§’ã€‚ä»£ä»·æ˜¯ï¼Œå°†æœ‰è®¸å¤šå°çš„çˆ†å‘ï¼ˆburstsï¼‰ï¼Œä»…åœ¨è¿›ç¨‹éœ€è¦æ›´å¤šå†…å­˜æ—¶æ‰è§¦å‘ã€‚å•ä¸ªè¿›ç¨‹é€šå¸¸ä¸ä¼šåˆ†é…å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œé€šè¿‡åœ¨ç»ˆæ­¢æ—¶ç«‹å³é‡Šæ”¾æ‰€æœ‰åˆ†é…çš„å†…å­˜ï¼Œè¿›ä¸€æ­¥é™ä½äº†å½±å“ã€‚JVMçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å…·å¤‡åˆ‡æ¢åƒåœ¾æ”¶é›†å™¨çš„èƒ½åŠ›ï¼Œå› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨å•†ç”¨GCï¼Œè¿˜å¯ä»¥åœ¨JVMä¸­å®ç°ä¸é—´æ–­çš„GCã€‚\nLukas Larssonåœ¨ä¸€ç¯‡å‡ºè‰²çš„åšå®¢æ–‡ç« ä¸­è®¨è®ºäº†åƒåœ¾æ”¶é›†å™¨çš„åŠŸèƒ½ã€‚æœ‰è®¸å¤šå¤æ‚çš„ç»†èŠ‚ï¼Œä½†å·²å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ä»¥æœ‰æ•ˆåœ°å¤„ç†ä¸å¯å˜æ•°æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿›ç¨‹åœ¨å †æ ˆå’Œå †ä¹‹é—´åˆ†é…äº†æ•°æ®ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨çŸ­æš‚çš„è¿‡ç¨‹ä¸­å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œã€‚\nè¿™ä¸ªä¸»é¢˜ä¸Šç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜æ˜¯BEAMä½¿ç”¨å¤šå°‘å†…å­˜ã€‚è™šæ‹Ÿæœºåœ¨åå°åˆ†é…äº†å¤§å—å†…å­˜ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰åˆ†é…å™¨æ¥æœ‰æ•ˆåœ°å­˜å‚¨æ•°æ®å¹¶æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚è¿™æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„æ•ˆæœï¼š 1ï¼‰åœ¨ä¸éœ€è¦ç©ºé—´ä¹‹åï¼Œå·²ç”¨å†…å­˜é€æ¸å‡å°‘ 2ï¼‰é‡æ–°åˆ†é…å¤§é‡æ•°æ®å¯èƒ½æ„å‘³ç€å°†å½“å‰å·¥ä½œå†…å­˜åŠ å€ã€‚\nå¦‚æœç¡®å®éœ€è¦ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´åˆ†é…å™¨ç­–ç•¥æ¥å‡è½»ç¬¬ä¸€ä¸ªå½±å“ã€‚å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°ä¸åŒç±»å‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåˆ™ç¬¬äºŒä¸ªæ˜“äºç›‘è§†å’Œè®¡åˆ’ã€‚ï¼ˆWombatOAMå°±æ˜¯è¿™æ ·ä¸€ç§æä¾›å¼€ç®±å³ç”¨çš„ç³»ç»ŸæŒ‡æ ‡çš„ç›‘è§†å·¥å…·ã€‚ï¼‰\nçƒ­ä»£ç åŠ è½½ çƒ­ä»£ç åŠ è½½å¯èƒ½æ˜¯BEAMå¼•ç”¨æœ€å¤šçš„ç‹¬ç‰¹åŠŸèƒ½ã€‚çƒ­ä»£ç åŠ è½½æ„å‘³ç€å¯ä»¥é€šè¿‡æ›´æ”¹ç³»ç»Ÿä¸­çš„å¯è¿è¡Œä»£ç æ¥æ›´æ–°åº”ç”¨ç¨‹åºé€»è¾‘ï¼ŒåŒæ—¶ä¿ç•™å†…éƒ¨æµç¨‹çŠ¶æ€ã€‚è¿™æ˜¯é€šè¿‡æ›¿æ¢å·²åŠ è½½çš„BEAMæ–‡ä»¶å¹¶æŒ‡ç¤ºVMæ›¿æ¢æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­çš„ä»£ç å¼•ç”¨æ¥å®ç°çš„ã€‚\nå¯¹äºç”µä¿¡åŸºç¡€æ¶æ„æ— éœ€åœæœºä»£ç å‡çº§è€Œè¨€ï¼Œè¿™æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„åŠŸèƒ½ï¼Œè¢«è£å‡çš„ç¡¬ä»¶å¯ç”¨äºå¤„ç†é«˜å³°ã€‚å¦‚ä»Šï¼Œåœ¨å®¹å™¨åŒ–æ—¶ä»£ï¼Œå…¶ä»–æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°äº§çº¿çš„æ›´æ–°ã€‚ä»æœªä½¿ç”¨è¿‡å®ƒçš„äººä¼šè®¤ä¸ºå®ƒæ˜¯ä¸é‡è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨å¼€å‘å·¥ä½œæµç¨‹ä¸­ä»ç„¶æœ‰ç”¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ›¿æ¢éƒ¨åˆ†ä»£ç æ¥åŠ å¿«è¿­ä»£é€Ÿåº¦ï¼Œè€Œä¸å¿…é‡æ–°å¯åŠ¨ç³»ç»Ÿæ¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚å³ä½¿è¯¥åº”ç”¨ç¨‹åºå¹¶éè®¾è®¡ä¸ºå¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå‡çº§ï¼Œä¹Ÿå¯ä»¥å‡å°‘é‡æ–°ç¼–è¯‘å’Œé‡æ–°éƒ¨ç½²æ‰€éœ€çš„æ—¶é—´ã€‚\nä½•æ—¶ä¸ä½¿ç”¨BEAM æ­£ç¡®çš„å·¥å…·éå¸¸é‡è¦ã€‚æ‚¨éœ€è¦ä¸€ä¸ªé€Ÿåº¦æå¿«çš„ç³»ç»Ÿï¼Œä½†ä¸å…³å¿ƒå¹¶å‘æ€§å—ï¼Ÿå¹¶è¡Œå¤„ç†ä¸€äº›äº‹ä»¶ï¼Œå¹¶ä¸”å¿…é¡»å¿«é€Ÿå¤„ç†å®ƒä»¬ï¼Ÿæ˜¯å¦éœ€è¦è®¡ç®—å›¾å½¢ï¼Œäººå·¥æ™ºèƒ½æˆ–åˆ†ææ•°æ®ï¼Ÿæ²¿C ++ï¼ŒPythonæˆ–Javaè·¯çº¿èµ°ã€‚ç”µä¿¡åŸºç¡€è®¾æ–½ä¸éœ€è¦å¿«é€Ÿè¿è¡Œï¼Œå› æ­¤é€Ÿåº¦ä»æ¥éƒ½ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹ã€‚åœ¨åŠ¨æ€ç±»å‹çš„è¾…åŠ©ä¸‹ï¼Œå®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œæ‰€æœ‰ç±»å‹æ£€æŸ¥ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘å™¨æ—¶é—´ä¼˜åŒ–å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚å› æ­¤ï¼Œæ•°å­—è¿ç®—æœ€å¥½ç•™ç»™JVMï¼ŒGoæˆ–å…¶ä»–ç¼–è¯‘æˆæœ¬åœ°è¯­è¨€çš„è¯­è¨€ä½¿ç”¨ã€‚æ¯«ä¸å¥‡æ€ªï¼Œåœ¨JVMä¸Šè¿è¡Œçš„Erlangç‰ˆæœ¬Erjangä¸Šçš„æµ®ç‚¹è¿ç®—æ¯”BEAMå¿«5000ï¼…ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°BEAMå¤§æ”¾å¼‚å½©çš„åœ°æ–¹æ˜¯åˆ©ç”¨å®ƒçš„å¹¶å‘æ¥å®‰æ’æ•°å­—è¿ç®—ï¼Œå°†åˆ†æå¤–åŒ…ç»™Cï¼ŒJuliaï¼ŒPythonæˆ–Rustã€‚æ‚¨å¯ä»¥åœ¨BEAMå¤–éƒ¨åšmapï¼Œè€Œåœ¨BEAMå†…éƒ¨åšreduce(è¯‘è€…æ³¨ï¼šmap-reduceæ€æƒ³)ã€‚\nå£å¤´ç¦…æ€»æ˜¯å¾ˆå¿«ã€‚äººç±»æ„ŸçŸ¥åˆºæ¿€ï¼ˆäº‹ä»¶ï¼‰å¹¶åœ¨å¤§è„‘ä¸­è¿›è¡Œå¤„ç†éœ€è¦å‡ ç™¾æ¯«ç§’ï¼Œè¿™æ„å‘³ç€å¯¹äºè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œå¾®ç§’æˆ–çº³ç§’çš„å“åº”æ—¶é—´å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨ä¹Ÿä¸ä¼šå°†BEAMç”¨äºå¾®æ§åˆ¶å™¨ï¼Œè¿™å¤ªæµªè´¹èµ„æºäº†ã€‚ä½†æ˜¯å¯¹äºå…·æœ‰æ›´å¤šå¤„ç†èƒ½åŠ›çš„åµŒå…¥å¼ç³»ç»Ÿï¼ˆå¤šæ ¸å·²æˆä¸ºå¸¸æ€ï¼‰ï¼Œæ‚¨éœ€è¦å¹¶å‘æ€§ï¼Œè€ŒBEAMä»¤äººçœ¼å‰ä¸€äº®ã€‚ä¸Šä¸–çºª90å¹´ä»£ï¼Œæˆ‘ä»¬å®ç°äº†ç”µè¯äº¤æ¢æœºï¼Œä»¥å¤„ç†è¿è¡Œåœ¨å…·æœ‰16MBå†…å­˜çš„åµŒå…¥å¼æ¿ä¸Šçš„æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚RaspberryPiéƒ½æœ‰å¤šå°‘å†…å­˜äº†ï¼Ÿè¿˜æœ‰ï¼Œç¡¬å®æ—¶ç³»ç»Ÿï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›BEAMç®¡ç†æ‚¨çš„å®‰å…¨æ°”å›Šæ§åˆ¶ç³»ç»Ÿã€‚ä½ éœ€è¦ç¡¬ä¿è¯ ä»…ä»…æ˜¯ç¡¬å®æ—¶æ“ä½œç³»ç»Ÿï¼Œæ²¡æœ‰åƒåœ¾æ”¶é›†æˆ–å¼‚å¸¸çš„è¯­è¨€ã€‚åœ¨è¯¸å¦‚GRiSPä¹‹ç±»çš„è£¸æœºä¸Šè¿è¡Œçš„Erlang VMçš„å®ç°å°†ä¸ºæ‚¨æä¾›ç±»ä¼¼çš„ä¿è¯ã€‚\nç»“è®º ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å®Œæˆå·¥ä½œã€‚å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªè½¯å®æ—¶ç³»ç»Ÿï¼Œè€Œè¯¥ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿç«‹å³æ‰©å±•å¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ï¼Œå¹¶ä¸”æ— éœ€é‡æ–°å‘æ˜è½®å­å°±å¯ä»¥åšåˆ°ï¼Œé‚£ä¹ˆBEAMæ˜¯æ‚¨æ­£åœ¨å¯»æ‰¾çš„ç»è¿‡éªŒè¯çš„æŠ€æœ¯ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªé»‘åŒ£å­ã€‚ä¸çŸ¥é“å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºé©¾é©¶æ³•æ‹‰åˆ©ï¼Œæ— æ³•è·å¾—æœ€ä½³æ€§èƒ½æˆ–æ— æ³•ç†è§£å¥‡æ€ªå£°éŸ³æ¥è‡ªé©¬è¾¾çš„å“ªä¸ªéƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åº”è¯¥æ›´å¤šåœ°äº†è§£BEAMï¼Œäº†è§£å…¶å†…éƒ¨ç»“æ„å¹¶å‡†å¤‡å¯¹å…¶è¿›è¡Œå¾®è°ƒå’Œä¿®å¤çš„åŸå› ã€‚å¯¹äºåœ¨å®é™…ä»»åŠ¡ä¸­ä½¿ç”¨Erlangå’ŒElixirçš„äººï¼ˆè¯‘è€…æ³¨ï¼šin anger çš„æ„æ€æ˜¯to do or use something in a real situationï¼‰ï¼Œæˆ‘ä»¬å¼€è®¾äº†ä¸€å¤©çš„è®²å¸ˆæŒ‡å¯¼è¯¾ç¨‹ï¼Œè¯¥è¯¾ç¨‹é€šä¿—æ˜“æ‡‚å¹¶è§£é‡Šæ‚¨æ‰€çœ‹åˆ°çš„å¾ˆå¤šå†…å®¹ï¼ŒåŒæ—¶ä¸ºæ‚¨å‡†å¤‡å¤§è§„æ¨¡å¤„ç†å¤§è§„æ¨¡å¹¶å‘åšå¥½å‡†å¤‡ã€‚åœ¨è¿™é‡Œäº†è§£æ›´å¤šã€‚æˆ‘ä»¬ä¹Ÿæ¨èErik Stenmanæ’°å†™çš„å…³äºBEAMçš„ä¹¦å’ŒDmytro Lytovchenkoçš„æ–‡ç« é›†â€”â€”BEAM Wisdomsã€‚\n","id":13,"section":"posts","summary":"ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah ä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°","tags":["erlang"],"title":"[è¯‘]BEAM vs JVM","uri":"https://lvsq.net/2020/05/beam-vs-jvm/","year":"2020"},{"content":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º\u0026quot;abcx\u0026quot;ï¼Œé•¿åº¦4ï¼Œè¯¦ç»†æè¿°å¯è®¿é—®https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/\n(let* ( [s \u0026#34;abbabcx\u0026#34;] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) å®ç°çš„æ€è·¯ä¸ºï¼š\nç”±äºå­—ç¬¦å¯ä»¥æœ‰ASCIIç è¡¨ç¤ºï¼Œæ•…å¯ä»¥ç”¨ä¸€ä¸ªé•¿åº¦ä¸º128çš„å‘é‡vecæ¥ä¿å­˜æ¯ä¸ªå­—ç¬¦åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æœ€åä¸€æ¬¡çš„ä½ç½®ã€‚ç»´æŠ¤ä¸€ä¸ªå˜é‡dæ¥è®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦çš„èµ·å§‹ä½ç½®ã€‚ å¦‚æœï¼š\nåˆ¤æ–­æŸå­—ç¬¦æ˜¯å¦é‡å¤ï¼š 1.1 æŸå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œæ‰§è¡Œç¬¬2æ­¥ 1.2 æŸå­—ç¬¦éç¬¬ä¸€æ¬¡å‡ºç°ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼Œåœ¨dä¹‹åï¼Œåˆ™å°†dè®¾ç½®ä¸ºè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ã€‚ç”±äºä¹‹å‰çš„æœ€å¤§é•¿åº¦å·²ç»ç”±ansä¿å­˜ï¼Œæ‰€ä»¥åªéœ€è¦è®¡ç®—å‰©ä¸‹çš„å­ä¸²çš„é•¿åº¦èƒ½ä¸èƒ½å¤§äºansï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆdè®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å°±å¥½äº† è®¡ç®—å½“å‰ä½ç½®å’Œdçš„é•¿åº¦len ä¿å­˜å…¶ä½ç½®åˆ°vec å¦‚æœlenå¤§äºansï¼Œæ”¹å˜ansä¸ºlen è¿™ç§å®ç°åªéœ€éå†ä¸€éå°±å¯ä»¥è®¡ç®—å‡ºç»“æœï¼Œæ€§èƒ½éå¸¸æ£’ã€‚å½“ç„¶æš´åŠ›è®¡ç®—æˆ–è€…æ»‘åŠ¨çª—å£ä¹Ÿå¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼Œåªæ˜¯éœ€è¦å¤šæ¬¡éå†ï¼Œæ€§èƒ½æ¯”ä¸ä¸Šã€‚\næ¦‚è¦åˆ†æ ä¸Šæ–‡è¯´åˆ°æ€§èƒ½é—®é¢˜ï¼Œæ‹¿ç‚¹æ•°æ®å‡ºæ¥è¯æ˜ä¸€ä¸‹å§ã€‚\nå°†ä¸Šé¢çš„ä»£ç ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œä½œä¸ºä¸€ä¸ªdefinitionï¼Œå¹¶ä¿å­˜åœ¨longest_substr.ssæ–‡ä»¶ä¸­ï¼Œ\n(define longest-substr (lambda (str) (let* ( [s str] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) ) ) Chez Schemeæä¾›äº†ä¸€ä¸ªæ¦‚è¦åˆ†æå·¥å…·ï¼Œéå¸¸å¥½ç”¨ï¼Œæ¥è¯•ç”¨ä¸€ä¸‹ï¼š ç”Ÿæˆçš„htmlå¯ä»¥éå¸¸ç›´è§‚çš„çœ‹åˆ°è¯¥å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ å­—ç¬¦ä¸²è¶Šé•¿ï¼Œæ‰§è¡Œæ¬¡æ•°è¶Šå¤šï¼Œæ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘å‘¢ï¼Ÿé€‰ä¸€ä¸ªä¸Šé¢ä¾‹å­ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²æ¥çœ‹çœ‹ï¼š\n\u0026gt; (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) no collections 0.000003672s elapsed cpu time 0.000002000s elapsed real time 1792 bytes allocated 12 \u0026gt; æ¶ˆè€—çš„CPUæ—¶é—´0.000003672sï¼Œå¯ä»¥è¯´éå¸¸çŸ­äº†ï¼Œä¸”åˆ†é…çš„å†…å­˜ä»…ä»…1792ä¸ªå­—èŠ‚ã€‚è¶…ä¹å¯»å¸¸çš„æ€§èƒ½ï¼Œæˆ‘æƒ³åº”è¯¥æœ‰ä¸¤ä¸ªæ–¹é¢åŸå› ï¼š\nç®—æ³• Scheme å’Œ Chez Scheme ","id":14,"section":"posts","summary":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º","tags":["scheme"],"title":"æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²-Schemeå®ç°","uri":"https://lvsq.net/2020/03/longest-substr/","year":"2020"},{"content":"\nä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿åå‡½æ•°å¼ç¼–ç¨‹è§„åˆ™ï¼Œå°±å¯ä»¥å¿«é€Ÿè°ƒè¯•åº”ç”¨ç¨‹åºã€‚å½“å‡½æ•°è¢«éš”ç¦»æ—¶ï¼Œæ‚¨ä¸å¿…å¤„ç†å½±å“è¾“å‡ºçš„éšè—çŠ¶æ€çš„æ›´æ”¹ã€‚\nè½¯ä»¶å·¥ç¨‹å¸ˆå…¼ä½œè€…Eric Elliotå®šä¹‰äº†ä»¥ä¸‹å‡½æ•°ç¼–ç¨‹ã€‚\nå‡½æ•°å¼ç¼–ç¨‹æ˜¯é€šè¿‡ç»„åˆçº¯å‡½æ•°ï¼Œé¿å…å…±äº«çŠ¶æ€ï¼Œå¯å˜æ•°æ®å’Œå‰¯ä½œç”¨æ¥æ„å»ºè½¯ä»¶çš„è¿‡ç¨‹ã€‚å‡½æ•°å¼ç¼–ç¨‹æ˜¯å£°æ˜æ€§çš„ï¼Œè€Œä¸æ˜¯å‘½ä»¤æ€§çš„ï¼Œåº”ç”¨ç¨‹åºçŠ¶æ€é€šè¿‡çº¯å‡½æ•°æµåŠ¨ã€‚ä¸é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ç›¸åï¼Œåè€…é€šå¸¸å°†åº”ç”¨ç¨‹åºçŠ¶æ€ä¸å¯¹è±¡ä¸­çš„æ–¹æ³•å…±äº«å¹¶æ”¾ç½®åœ¨å¯¹è±¡ä¸­ã€‚\næˆ‘å°†æ›´è¿›ä¸€æ­¥ï¼šå‡½æ•°å¼ç¼–ç¨‹ï¼ˆå¦‚é¢å‘å¯¹è±¡å’Œè¿‡ç¨‹å¼ç¼–ç¨‹ï¼‰ä»£è¡¨ç€èŒƒå¼çš„è½¬å˜ã€‚å®ƒåœ¨ç¼–å†™ä»£ç æ—¶é‡‡ç”¨äº†ç‹¬ç‰¹çš„æ€ç»´æ–¹å¼ï¼Œå¹¶å¼•å…¥äº†ä¸€å¥—å…¨æ–°çš„è§„åˆ™ã€‚\n4ä¸ªé‡è¦æ¦‚å¿µ è¦å®Œå…¨æŒæ¡å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¿…é¡»é¦–å…ˆäº†è§£ä»¥ä¸‹ç›¸å…³æ¦‚å¿µã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å‰¯ä½œç”¨ å‡½æ•°æ„æˆ å…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å¦‚æœç»™çº¯å‡½æ•°æä¾›ç›¸åŒçš„è¾“å…¥ï¼Œåˆ™å®ƒæ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„è¾“å‡ºã€‚æ­¤å±æ€§ä¹Ÿç§°ä¸ºå¹‚ç­‰ã€‚å¹‚ç­‰æ„å‘³ç€å‡½æ•°åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸è°ƒç”¨æ¬¡æ•°æ— å…³ã€‚\nå‰¯ä½œç”¨ çº¯å‡½æ•°ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„å‡½æ•°æ— æ³•ä¸å¤–éƒ¨ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚\nä¾‹å¦‚ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°†APIè°ƒç”¨è§†ä¸ºå‰¯ä½œç”¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºAPIè°ƒç”¨è¢«è®¤ä¸ºæ˜¯ä¸å—æ‚¨ç›´æ¥æ§åˆ¶çš„å¤–éƒ¨ç¯å¢ƒã€‚ä¸€ä¸ªAPIå¯èƒ½æœ‰å‡ ä¸ªä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œä¾‹å¦‚è¶…æ—¶æˆ–å¤±è´¥ï¼Œæˆ–è€…ç”šè‡³å¯èƒ½è¿”å›æ„å¤–çš„å€¼ã€‚å®ƒä¸é€‚åˆçº¯å‡½æ•°çš„å®šä¹‰ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨APIæ—¶éƒ½éœ€è¦ä¸€è‡´çš„ç»“æœã€‚\nå…¶ä»–å¸¸è§çš„å‰¯ä½œç”¨åŒ…æ‹¬ï¼š\næ•°æ®å˜åŒ– DOMæ“ä½œ è¯·æ±‚æœ‰å†²çªçš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰æ—¶é—´time.Now() å‡½æ•°æ„æˆ å‡½æ•°æ„æˆçš„åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šå°†ä¸¤ä¸ªçº¯å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ä»¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚è¿™æ„å‘³ç€ä¸ºç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡ºçš„æ¦‚å¿µåœ¨è¿™é‡Œä»ç„¶é€‚ç”¨ã€‚å› æ­¤ï¼Œä»ç®€å•çš„çº¯å‡½æ•°å¼€å§‹åˆ›å»ºæ›´é«˜çº§çš„å‡½æ•°å¾ˆé‡è¦ã€‚\nå…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯åˆ›å»ºä¸ä¿æŒçŠ¶æ€çš„å‡½æ•°ã€‚å…±äº«çŠ¶æ€å°¤å…¶ä¼šåœ¨çº¯å‡½æ•°ä¸­å¼•å…¥å‰¯ä½œç”¨æˆ–å¯å˜æ€§é—®é¢˜ï¼Œä½¿å®ƒä»¬å˜å¾—ä¸çº¯ç²¹ã€‚\nä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰çŠ¶æ€éƒ½ä¸å¥½ã€‚æœ‰æ—¶ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªçŠ¶æ€æ‰èƒ½è§£å†³ç‰¹å®šçš„è½¯ä»¶é—®é¢˜ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿çŠ¶æ€å¯è§å’Œæ˜¾å¼ï¼Œä»¥æ¶ˆé™¤ä»»ä½•å‰¯ä½œç”¨ã€‚ç¨‹åºä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ä»çº¯å‡½æ•°ä¸­æ´¾ç”Ÿæ–°æ•°æ®ã€‚è¿™æ ·ï¼Œå°±ä¸éœ€è¦å¯èƒ½å¼•èµ·å‰¯ä½œç”¨çš„å¯å˜æ•°æ®ã€‚\nç°åœ¨æˆ‘ä»¬å·²ç»æ¶µç›–äº†åŸºç¡€ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€äº›åœ¨Goä¸­ç¼–å†™åŠŸèƒ½ä»£ç æ—¶è¦éµå¾ªçš„è§„åˆ™ã€‚\nåŠŸèƒ½ç¼–ç¨‹è§„åˆ™ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§èŒƒä¾‹ã€‚å› æ­¤ï¼Œå¾ˆéš¾ä¸ºè¿™ç§ç¼–ç¨‹é£æ ¼å®šä¹‰ç¡®åˆ‡çš„è§„åˆ™ã€‚ä¹Ÿä¸ä¸€å®šæ€»æ˜¯éµå¾ªè¿™äº›è§„åˆ™ã€‚æœ‰æ—¶ï¼Œæ‚¨ç¡®å®éœ€è¦ä¾èµ–æ‹¥æœ‰çŠ¶æ€çš„åŠŸèƒ½ã€‚\nä½†æ˜¯ï¼Œä¸ºäº†å°½å¯èƒ½ä¸¥æ ¼åœ°éµå¾ªå‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ï¼Œæˆ‘å»ºè®®åšæŒä»¥ä¸‹å‡†åˆ™ã€‚\næ²¡æœ‰å¯å˜æ•°æ®ä»¥é¿å…å‰¯ä½œç”¨ æ— çŠ¶æ€ï¼ˆæˆ–è€…éšå¼çŠ¶æ€ï¼Œä¾‹å¦‚å¾ªç¯è®¡æ•°å™¨ï¼‰ ç»™å˜é‡èµ‹å€¼åè¯·å‹¿ä¿®æ”¹ é¿å…å‰¯ä½œç”¨ï¼Œä¾‹å¦‚APIè°ƒç”¨ æˆ‘ä»¬åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªå¥½çš„â€œå‰¯ä½œç”¨â€æ˜¯å¼ºå¤§çš„æ¨¡å—åŒ–ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸æ˜¯è‡ªä¸Šè€Œä¸‹åœ°è¿›è¡Œè½¯ä»¶å·¥ç¨‹ï¼Œè€Œæ˜¯é¼“åŠ±è‡ªä¸‹è€Œä¸Šçš„ç¼–ç¨‹é£æ ¼ã€‚é¦–å…ˆå®šä¹‰æ¨¡å—ï¼ŒæŠŠå°†æ¥å¯èƒ½ä½¿ç”¨çš„åŒç±»çº¯å‡½æ•°ç»„åˆèµ·æ¥ã€‚æ¥ä¸‹æ¥ï¼Œå¼€å§‹ç¼–å†™é‚£äº›å°çš„ï¼Œæ— çŠ¶æ€çš„ç‹¬ç«‹å‡½æ•°ï¼Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚\nå®è´¨ä¸Šæˆ‘ä»¬æ˜¯åœ¨åˆ›å»ºé»‘åŒ£å­ã€‚ç¨åï¼Œæˆ‘ä»¬å°†æŒ‰ç…§è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼å°†å„ä¸ªå—æ†ç»‘åœ¨ä¸€èµ·ã€‚è¿™ä½¿æ‚¨å¯ä»¥å»ºç«‹å¼ºå¤§çš„æµ‹è¯•åŸºç¡€ï¼Œå°¤å…¶æ˜¯å¯ä»¥éªŒè¯çº¯å‡½æ•°æ­£ç¡®æ€§çš„å•å…ƒæµ‹è¯•ã€‚\nä¸€æ—¦æ‚¨å¯ä»¥ä¿¡ä»»æ‚¨çš„æ¨¡å—ï¼Œå°±å¯ä»¥å°†æ¨¡å—æ†ç»‘åœ¨ä¸€èµ·äº†ã€‚å¼€å‘è¿‡ç¨‹ä¸­çš„è¿™ä¸€æ­¥è¿˜æ¶‰åŠç¼–å†™é›†æˆæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä¸¤ä¸ªç»„ä»¶çš„æ­£ç¡®é›†æˆã€‚\n5ä¸ªç¤ºä¾‹ ä¸ºäº†æ›´å…¨é¢åœ°æè¿°Goå‡½æ•°ç¼–ç¨‹çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬æ¢ç´¢äº”ä¸ªåŸºæœ¬ç¤ºä¾‹ã€‚\næ›´æ–°å­—ç¬¦ä¸² è¿™æ˜¯çº¯å‡½æ•°çš„æœ€ç®€å•ç¤ºä¾‹ã€‚é€šå¸¸ï¼Œå½“æ‚¨è¦æ›´æ–°å­—ç¬¦ä¸²æ—¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\nnameï¼š= \u0026#34;first name\u0026#34; nameï¼š= name + \u0026#34;last name\u0026#34; ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„è§„åˆ™ï¼Œå› ä¸ºä¸èƒ½åœ¨å‡½æ•°å†…ä¿®æ”¹å˜é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥é‡å†™ä»£ç æ®µï¼Œä»¥ä¾¿æ¯ä¸ªå€¼éƒ½å…·æœ‰è‡ªå·±çš„å˜é‡ã€‚\nä¸‹é¢çš„ä»£ç æ®µä¸­çš„ä»£ç æ›´å…·å¯è¯»æ€§ã€‚\nfirstname := \u0026#34;first\u0026#34; lastname := \u0026#34;last\u0026#34; fullname := firstname + \u0026#34; \u0026#34; + lastname åœ¨æŸ¥çœ‹éå‡½æ•°å¼ä»£ç æ®µæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æµè§ˆç¨‹åºä»¥ç¡®å®šæœ€æ–°çŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰¾åˆ°nameå˜é‡çš„ç»“æœå€¼ã€‚è¿™éœ€è¦æ›´å¤šçš„ç²¾åŠ›å’Œæ—¶é—´æ¥äº†è§£è¯¥åŠŸèƒ½çš„ä½œç”¨ã€‚\né¿å…æ›´æ–°æ•°ç»„ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿ç”¨ä¸å˜æ•°æ®é€šè¿‡çº¯å‡½æ•°å¾—å‡ºæ–°çš„ä¸å˜æ•°æ®çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡éœ€è¦æ›´æ–°æ•°ç»„æ—¶åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„æ¥å®ç°\nåœ¨éå‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæ›´æ–°æ•°ç»„å¦‚ä¸‹ï¼š\nnames := [3]string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} // Add Lucas to the array names[2] = \u0026#34;Lucas\u0026#34; è®©æˆ‘ä»¬æ ¹æ®åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹è¿›è¡Œå°è¯•ã€‚\nnames := []string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} allNames := append(names, \u0026#34;Lucas\u0026#34;) é¿å…æ›´æ–°map è¿™æ˜¯å‡½æ•°ç¼–ç¨‹çš„æç«¯ç¤ºä¾‹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰å­—ç¬¦ä¸²ç±»å‹çš„é”®å’Œæ•´æ•°ç±»å‹çš„å€¼çš„mapã€‚è¯¥mapåŒ…å«æˆ‘ä»¬ä»ç„¶ç•™åœ¨å®¶ä¸­çš„æ°´æœæ•°é‡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆšè´­ä¹°äº†è‹¹æœï¼Œå¹¶å¸Œæœ›å°†å…¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} // Buy five apples fruits[\u0026#34;apples\u0026#34;] = 5 æˆ‘ä»¬å¯ä»¥åœ¨åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹ä¸‹å®Œæˆç›¸åŒçš„åŠŸèƒ½ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} newFruits := map[string]int{\u0026#34;apples\u0026#34;: 5} allFruits := make(map[string]int, len(fruits) + len(newFruits)) for k, v := range fruits { allFruits[k] = v } for k, v := range newFruits { allFruits[k] = v } ç”±äºæˆ‘ä»¬ä¸æƒ³ä¿®æ”¹åŸå§‹mapï¼Œå› æ­¤ä»£ç ä¼šéå†ä¸¤ä¸ªmapï¼Œå¹¶å°†å€¼æ·»åŠ åˆ°æ–°mapã€‚è¿™æ ·ï¼Œæ•°æ®ä¿æŒä¸å˜ã€‚\næ­£å¦‚æ‚¨å¯èƒ½é€šè¿‡ä»£ç çš„é•¿åº¦å¯ä»¥çœ‹å‡ºçš„é‚£æ ·ï¼Œæ­¤ä»£ç æ®µçš„æ€§èƒ½æ¯”å¯¹mapè¿›è¡Œç®€å•çš„å¯å˜æ›´æ–°è¦å·®å¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬è¦éå†ä¸¤ä¸ªmapã€‚è¿™æ˜¯æ‚¨ä¸ºä»£ç æ€§èƒ½äº¤æ¢æ›´å¥½çš„ä»£ç è´¨é‡çš„æ—¶é—´ã€‚\né«˜é˜¶å‡½æ•°å’ŒæŸ¯é‡ŒåŒ– å¤§å¤šæ•°ç¨‹åºå‘˜åœ¨ä»–ä»¬çš„ä»£ç ä¸­é€šå¸¸ä¸ä¼šä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼Œä½†æ˜¯åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æŸ¯é‡ŒåŒ–å¾ˆæ–¹ä¾¿ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå°†ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ã€‚å°½ç®¡è¿™å·²ç»æ˜¯ä¸€ä¸ªçº¯ç²¹çš„åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¯¦ç»†è¯´æ˜è¯¥ç¤ºä¾‹ï¼Œä»¥å±•ç¤ºå¦‚ä½•é€šè¿‡curringåˆ›å»ºæ›´é«˜çº§çš„åŠŸèƒ½ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ã€‚æ¥ä¸‹æ¥ï¼Œè¯¥å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºé—­åŒ…ã€‚å› ä¸ºè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥å®ƒå°†è®°ä½å¤–éƒ¨èŒƒå›´ï¼Œè¯¥èŒƒå›´åŒ…å«åˆå§‹è¾“å…¥å‚æ•°ã€‚\nfunc add ï¼ˆx intï¼‰func ï¼ˆy intï¼‰int { return funcï¼ˆy intï¼‰int { return x + y } } ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•curryingå¹¶åˆ›å»ºæ›´å¤šé«˜çº§çº¯å‡½æ•°ã€‚\nfunc main() { // Create more variations add10 := add(10) add20 := add(20) // Currying fmt.Println(add10(1)) // 11 fmt.Println(add20(1)) // 21 } è¿™ç§æ–¹æ³•åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¾ˆå¸¸è§ï¼Œå°½ç®¡æ‚¨é€šå¸¸ä¸ä¼šåœ¨èŒƒå¼ä¹‹å¤–çœ‹åˆ°å®ƒã€‚\né€’å½’ é€’å½’æ˜¯ä¸€ç§é€šå¸¸ç”¨äºè§„é¿å¾ªç¯ä½¿ç”¨çš„è½¯ä»¶æ¨¡å¼ã€‚å› ä¸ºå¾ªç¯å§‹ç»ˆä¿æŒå†…éƒ¨çŠ¶æ€ä»¥æ˜ç¡®å¾ªç¯åœ¨å“ªä¸€è½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ä¸‹ä½¿ç”¨å¾ªç¯ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µå°è¯•è®¡ç®—æ•°å­—çš„é˜¶ä¹˜ã€‚é˜¶ä¹˜æ˜¯ä¸€ä¸ªæ•´æ•°ä¸å…¶ä¸‹æ‰€æœ‰æ•´æ•°çš„ä¹˜ç§¯ã€‚å› æ­¤ï¼Œé˜¶ä¹˜4ç­‰äº24ï¼ˆ= 4 * 3 * 2 * 1ï¼‰ã€‚\né€šå¸¸ï¼Œæ‚¨å°†ä¸ºæ­¤ä½¿ç”¨å¾ªç¯ã€‚\nfunc factorial(fac int) int { result := 1 for ; fac \u0026gt; 0; fac-- { result *= fac } return result } ä¸ºäº†åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ä¸­å®Œæˆæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é€’å½’ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å°†ä¸€éåˆä¸€éåœ°è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œç›´åˆ°è¾¾åˆ°é˜¶ä¹˜çš„æœ€ä½æ•´æ•°ä¸ºæ­¢ã€‚\nfunc calculateFactorial(fac int) int { if fac == 0 { return 1 } return fac * calculateFactorial(fac - 1) } ç»“è®º è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä»å‡½æ•°å¼ç¼–ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼š\nå°½ç®¡Golangæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†å®ƒå¹¶éä¸ºæ­¤ç›®çš„è€Œè®¾è®¡çš„ï¼Œå¦‚ç¼ºå°‘Mapï¼ŒFilterå’ŒReduceå‡½æ•°ã€‚ å‡½æ•°å¼ç¼–ç¨‹æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºå‡½æ•°æ˜¯çº¯ç²¹çš„ï¼Œå› æ­¤æ˜“äºç†è§£ çº¯å‡½æ•°æ›´æ˜“äºæµ‹è¯•ï¼Œå› ä¸ºæ²¡æœ‰å†…éƒ¨çŠ¶æ€ä¼šæ”¹å˜è¾“å‡º åŸæ–‡åœ¨æ­¤: https://blog.logrocket.com/functional-programming-in-go/\n","id":15,"section":"posts","summary":"ä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿","tags":["functional"],"title":"ä½¿ç”¨Golangè¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹","uri":"https://lvsq.net/2020/03/fp-in-go/","year":"2020"},{"content":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚\né˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š\næ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ªç©ºé˜Ÿåˆ—\né€‰æ‹©å‡½æ•° (empty-queue? \u0026lt;queue\u0026gt; ) æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º (front-queue \u0026lt;queue\u0026gt; ) è¿”å›æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„æ•°æ®ï¼Œå…¶ä¸ä¼šä¿®æ”¹é˜Ÿåˆ— (length-queue \u0026lt;queue\u0026gt; ) è¿”å›é˜Ÿåˆ—é•¿åº¦\næ”¹å˜å‡½æ•° (insert-queue! \u0026lt;queue\u0026gt; \u0026lt;item\u0026gt; ) å°†æ•°æ®æ’å…¥æœ«ç«¯ (delete-queue! \u0026lt;queue\u0026gt; ) åˆ é™¤åˆ—å¤´çš„æ•°æ®\næ‰“å°å‡½æ•° (print-queue \u0026lt;queue\u0026gt;)\n(module FIFO-QUEUE (make-queue empty-queue? front-queue insert-queue! delete-queue! length-queue print-queue) (define front-ptr (lambda (q) (caar q))) (define set-front-ptr! (lambda (q item) (set-car! (car q) item))) (define rear-ptr (lambda (q) (cdar q))) (define set-rear-ptr! (lambda (q item) (set-cdr! (car q) item))) (define make-queue (lambda () (cons (cons \u0026#39;() \u0026#39;()) 0))) (define empty-queue? (lambda (q) (null? (front-ptr q)))) (define front-queue (lambda (q) (if (empty-queue? q) (error \u0026#34;FRONT called with an empty queue\u0026#34; q) (car (front-ptr q))))) (define (insert-queue! q item) (let ((new-pair (cons item \u0026#39;()))) (if (empty-queue? q) (begin (set-front-ptr! q new-pair) (set-rear-ptr! q new-pair) (set-cdr! q (+ 1 (cdr q))) q) (begin (set-cdr! (rear-ptr q) new-pair) (set-rear-ptr! q new-pair) (set-cdr! q ( + 1 (cdr q))) q) ) ) ) (define delete-queue! (lambda (q) (if (empty-queue? q) (error \u0026#34;DELETE! called with an empty queue\u0026#34; q) (begin (set-front-ptr! q (cdr (front-ptr q))) (set-cdr! q (- (cdr q) 1)) q) ) ) ) (define length-queue (lambda (q) (cdr q))) (define print-queue (lambda (q) (if (empty-queue? q) \u0026#39;() (front-ptr q)) )) ) å‰4ä¸ªè¿‡ç¨‹æ˜¯ç”¨äºå†…éƒ¨çš„å¸®åŠ©å‡½æ•°ï¼Œé˜Ÿåˆ—ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åˆ—å¤´ï¼ˆfront-ptrï¼‰,ä¸€ä¸ªæŒ‡å‘åˆ—å°¾ï¼ˆrear-ptrï¼‰ï¼Œè¿™æ ·å¯ä»¥å¼¥è¡¥åŸç”Ÿçš„set-car!å’Œset-cdr!çš„ä¸è¶³ã€‚\n\u0026gt; (load \u0026#34;/path/to/FIFO-QUEUE.scm\u0026#34;) ;;åŠ è½½FIFO-QUEUEæ¨¡å— \u0026gt; (import FIFO-QUEUE) \u0026gt; (define q (make-queue)) \u0026gt; (insert-queue! q 1) ;; (((1) 1) . 1), æœ€åä¸€ä¸ªæ•°å­—1è¡¨ç¤ºé˜Ÿåˆ—é•¿åº¦, åœ¨é˜Ÿåˆ—æœ‰åˆ é™¤æˆ–è€…æ’å…¥æ—¶ï¼ŒåŠæ—¶ä¿®æ”¹è¯¥å€¼ï¼Œä¸ºäº†åœ¨å–é˜Ÿåˆ—é•¿åº¦æ—¶å‡å°å¼€é”€ï¼Œå¦åˆ™è¦éå†ä¸€æ¬¡æ‰è¡Œ \u0026gt; (insert-queue! q 2) ;; (((1 2) 2) . 2) \u0026gt; (insert-queue! q 3) ;; (((1 2 3) 3) . 3) \u0026gt; (insert-queue! q 4) ;; (((1 2 3 4) 4) . 4) \u0026gt; (delete-queue! q) ;; (((2 3 4) 4) . 3) \u0026gt; (delete-queue! q) ;; (((3 4) 4) . 2) \u0026gt; (front-queue q) ;; 3 \u0026gt; (length-queue q) ;; 2 ","id":16,"section":"posts","summary":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚ é˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š æ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ª","tags":["scheme"],"title":"Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—","uri":"https://lvsq.net/2020/03/fifo-queue/","year":"2020"},{"content":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯èƒ½ä½¿ç”¨Schemeæ ‡å‡†æœºåˆ¶ã€‚\nHash Tables ç•¥è¿‡ã€‚åº”ä½¿ç”¨æ ‡å‡†hash table.\nExtend-Syntax Macros æœ¬èŠ‚ä»‹ç»äº†extend-syntaxï¼Œå®ƒæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ä½†æ˜“äºä½¿ç”¨çš„åŸºäºæ¨¡å¼åŒ¹é…çš„è¯­æ³•æ‰©å±•å·¥å…·ã€‚ ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•è½¬æ¢ä¸ä½¿ç”¨define-syntaxå’Œsyntax-caseç¼–å†™çš„è¯­æ³•è½¬æ¢ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºextend-syntaxäº§ç”Ÿçš„è½¬æ¢ä¸ä¼šè‡ªåŠ¨éµå¾ªè¯æ³•ä½œç”¨åŸŸã€‚\né€šå¸¸ä¸å¯èƒ½å°†ä½¿ç”¨syntax-caseç¼–å†™çš„è¯­æ³•æŠ½è±¡ä¸ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•æŠ½è±¡æ— ç¼åœ°æ··åˆåœ¨ä¸€èµ·ã€‚ é€šå¸¸å°½å¯èƒ½åªä½¿ç”¨å…¶ä¸­ä¸€ç§ã€‚ ä»…åœ¨è¿ç§»åˆ°syntax-caseæ—¶æä¾›äº†å¯¹syntax-caseæ‰©å±•å™¨ä¸­extend-syntaxçš„æ”¯æŒã€‚\n(extend-syntax (name key \u0026hellip;) (pat fender template) \u0026hellip;)\næ ‡è¯†ç¬¦name æ˜¯è¦å®šä¹‰çš„å¥æ³•æ‰©å±•åæˆ–è¯­æ³•å…³é”®å­—ã€‚ å½“ç³»ç»Ÿæ‰©å±•å™¨å¤„ç†carä¸ºname çš„ä»»ä½•listè¡¨è¾¾å¼æ—¶ï¼Œå°†åœ¨è¯¥è¡¨è¾¾å¼ä¸Šè°ƒç”¨extend-syntaxç”Ÿæˆçš„è¯­æ³•è½¬æ¢è¿‡ç¨‹ã€‚ å…¶ä½™çš„æ ‡è¯†ç¬¦key \u0026hellip; æ˜¯åœ¨æ‰©å±•è¿‡ç¨‹ä¸­è¦åœ¨è¾“å…¥è¡¨è¾¾å¼ä¸­è¯†åˆ«çš„å…¶ä»–å…³é”®å­—ï¼ˆä¾‹å¦‚condä¸­çš„elseæˆ–caseï¼‰ã€‚\nkeyåˆ—è¡¨ä¹‹åçš„æ¯ä¸ªå­å¥éƒ½åŒ…å«ä¸€ä¸ªæ¨¡å¼pat ï¼Œä¸€ä¸ªå¯é€‰çš„fender å’Œä¸€ä¸ªtemplate ã€‚ å¯é€‰çš„fender ç»å¸¸è¢«çœç•¥ã€‚pat æŒ‡å®šäº†è¯­æ³•ï¼Œç”¨äºåŒ¹é…å­å¥ã€‚æ¨¡å¼ä¸­ä¸æ˜¯å…³é”®å­—ï¼ˆæ¨¡å¼å˜é‡ï¼‰çš„æ ‡è¯†ç¬¦ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ã€‚fender å¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯Schemeè¡¨è¾¾å¼ï¼Œå®ƒæŒ‡å®šè¾“å…¥è¡¨è¾¾å¼ï¼ˆé€šè¿‡æ¨¡å¼å˜é‡è®¿é—®ï¼‰ä¸Šçš„é™„åŠ çº¦æŸï¼Œå¿…é¡»é€‰æ‹©è¿™äº›çº¦æŸæ‰èƒ½é€‰æ‹©å­å¥ã€‚template é€šå¸¸æ ¹æ®æ¨¡å¼å˜é‡æ¥æŒ‡å®šè¾“å‡ºé‡‡ç”¨ä»€ä¹ˆå½¢å¼ã€‚\nåœ¨æ‰©å±•è¿‡ç¨‹ä¸­ï¼Œè½¬æ¢è¿‡ç¨‹extend-syntaxä¼šå°è¯•ä»¥ç»™å®šçš„å­å¥çš„é¡ºåºå°†è¾“å…¥è¡¨è¾¾å¼ä¸æ¯ä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¾“å…¥è¡¨è¾¾å¼åŒ¹é…äº†æŸä¸ªæ¨¡å¼ï¼Œåˆ™å°†æ¨¡å¼å˜é‡ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ï¼Œå¹¶å¯¹å­å¥çš„fender ï¼ˆå¦‚æœæœ‰ï¼‰è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœfender è¿”å›ä¸€ä¸ªçœŸå€¼ï¼Œåˆ™æ‰§è¡Œç»™å®šçš„æ‰©å±•ã€‚ å¦‚æœè¾“å…¥ä¸æ¨¡å¼ä¸åŒ¹é…ï¼Œæˆ–è€…fender è¿”å›é”™è¯¯å€¼ï¼Œåˆ™è½¬æ¢è¿‡ç¨‹å°†å°è¯•ä¸‹ä¸€ä¸ªå­å¥ã€‚å¦‚æœæ— æ³•é€‰æ‹©ä»»ä½•å­å¥ï¼Œåˆ™ä¼šå¼•å‘æ¡ä»¶ç±»å‹**ï¼†assertion**çš„å¼‚å¸¸ã€‚\nåœ¨æ¨¡å¼å†…ï¼Œçœç•¥å·ï¼ˆ\u0026hellip;ï¼‰å¯ç”¨äºæŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªå‡ºç°çš„å‰é¢çš„æ¨¡å¼ç‰‡æ®µæˆ–åŸå‹ã€‚ç±»ä¼¼åœ°ï¼Œå¯ä»¥åœ¨è¾“å‡ºä¸­ä½¿ç”¨çœç•¥å·æ¥æŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªæ‰©å±•åŸå‹çš„ç»“æ„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å±•åŸå‹å¿…é¡»åŒ…å«è¾“å…¥æ¨¡å¼åŸå‹çš„ä¸€éƒ¨åˆ†ã€‚\nç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå®šä¹‰äº†rec, ä½¿ç”¨å•ä¸ªå…³é”®å­—ï¼Œä¸€ä¸ªå­å¥ï¼Œä¸”æ²¡æœ‰fenderå’Œçœç•¥å·\n(extend-syntax (rec) [(rec id val) (let ([id #f]) (set! id val) id)]) ç¬¬äºŒä¸ªä¾‹å­ï¼Œå®šä¹‰äº†whenï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨çœç•¥å·\n(extend-syntax (when) [(when test exp1 exp2 ...) (if test (begin exp1 exp2 ...) #f)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºletçš„å®šä¹‰ã€‚ letçš„å®šä¹‰æ˜¾ç¤ºäº†å¤šä¸ªçœç•¥å·çš„ä½¿ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨äºæ ‡è¯†ç¬¦/å€¼åºå¯¹ï¼Œå¦ä¸€ä¸ªç”¨äºbodyä¸­çš„è¡¨è¾¾å¼ã€‚å®ƒè¿˜è¡¨æ˜åŸå‹ä¸å¿…æ˜¯å•ä¸ªæ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”åœ¨templateä¸­å¯ä»¥å°†åŸå‹çš„å„ä¸ªéƒ¨åˆ†å½¼æ­¤åˆ†å¼€ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) ((lambda (x ...) b1 b2 ...) e ...)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºlet*ï¼Œå…¶è¯­æ³•ä¸letç›¸åŒï¼Œä½†æ˜¯æ ¹æ®letä»¥ä¸¤ä¸ªå­å¥ï¼ˆä¸€ä¸ªç”¨äºåŸºæœ¬æƒ…å†µï¼Œä¸€ä¸ªç”¨äºé€’å½’æ­¥éª¤ï¼‰é€’å½’å®šä¹‰ï¼Œå› ä¸ºå®ƒå¿…é¡»äº§ç”Ÿä¸€ä¸ªåµŒå¥—ç»“æ„ã€‚\n(extend-syntax (let*) [(let* () b1 b2 ...) (let () b1 b2 ...)] [(let* ([x e] more ...) b1 b2 ...) (let ([x e]) (let* (more ...) b1 b2 ...))]) å®šä¹‰å¼andéœ€è¦3ä¸ªå­å¥ã€‚ç¬¬ä¸€ä¸ªå­å¥å¯¹äºè¯†åˆ«**(and)æ˜¯å¿…è¦çš„ï¼Œåä¸¤ä¸ªä»¥é€’å½’æ–¹å¼å®šä¹‰æ‰€æœ‰å…¶ä»–and**å½¢å¼ã€‚\n(extend-syntax (and) [(and) #t] [(and x) x] [(and x y ...) (if x (and y ...) #f)]) condçš„å®šä¹‰éœ€è¦å››ä¸ªå­å¥ã€‚ ä¸let*ä¸€æ ·ï¼Œå¿…é¡»å¯¹condè¿›è¡Œé€’å½’æè¿°ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒä¼šäº§ç”ŸåµŒå¥—çš„ifè¡¨è¾¾å¼ï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸€ä¸ªçœç•¥å·åŸå‹ä¸è¶³ä»¥æè¿°æ‰€æœ‰å¯èƒ½çš„condå­å¥ã€‚ condçš„å®šä¹‰è¿˜è¦æ±‚é™¤condä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šelseä½œä¸ºå…³é”®å­—ã€‚ è¿™æ˜¯å®šä¹‰ï¼š\n(extend-syntax (cond else) [(cond) #f] [(cond (else e1 e2 ...)) (begin e1 e2 ...)] [(cond (test) more ...) (or test (cond more ...))] [(cond (test e1 e2 ...) more ...) (if test (begin e1 e2 ...) (cond more ...))]) ä¸ºäº†ä½¿letçš„è¯­æ³•ç»å¯¹æ­£ç¡®ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¿…é¡»è¦æ±‚è¾“å…¥ä¸­çš„ç»‘å®šæ ‡è¯†ç¬¦æ˜¯ç¬¦å·ã€‚ å¦‚æœæˆ‘ä»¬è¾“å…¥ç±»ä¼¼**ï¼ˆletï¼ˆ[3 x]ï¼‰xï¼‰çš„å†…å®¹ï¼Œåˆ™ä¸ä¼šä»let**ä¸­å¾—åˆ°é”™è¯¯ï¼Œå› ä¸ºå®ƒä¸ä¼šæ£€æŸ¥éªŒè¯æ ‡è¯†ç¬¦ä½ç½®ä¸­çš„å¯¹è±¡æ˜¯å¦ä¸ºç¬¦å·ã€‚ ç›¸åï¼Œlambdaå¯èƒ½ä¼šæŠ±æ€¨ï¼Œæˆ–è€…å¯èƒ½æ˜¯æ‰©å±•å®Œæˆå¾ˆä¹…ä¹‹åçš„æ±‚å€¼ç¨‹åºã€‚ è¿™æ˜¯fenders èµ·ä½œç”¨çš„åœ°æ–¹ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) (andmap symbol? \u0026#39;(x ...)) ((lambda (x ...) b1 b2 ...) e ...)]) \u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰ä¸Šçš„symbol?çš„andmapç¡®ä¿æ¯ä¸ªç»‘å®šæ ‡è¯†ç¬¦éƒ½æ˜¯ä¸€ä¸ªç¬¦å·ã€‚ fender ä»…ä»…æ˜¯Schemeè¡¨è¾¾å¼ã€‚ åœ¨è¯¥è¡¨è¾¾å¼ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ä¸å­å¥çš„template éƒ¨åˆ†ç›¸åŒçš„è§„åˆ™æ¥æ‰©å±•å¼•ç”¨çš„å¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†**\u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰**æ‰©å±•åˆ°æ ‡è¯†ç¬¦/å€¼å¯¹ä¸­çš„æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚\nextend-syntaxé€šå¸¸å¯ä»¥å¤„ç†æ‚¨çš„ä¸€åˆ‡éœ€æ±‚ï¼Œä½†æ˜¯æŸäº›è¯­æ³•æ‰©å±•å®šä¹‰è¦æ±‚èƒ½å¤ŸåŒ…å«å¯¹ä»»æ„Schemeè¡¨è¾¾å¼æ±‚å€¼çš„ç»“æœã€‚ è¯¥åŠŸèƒ½ç”±withæä¾›ã€‚\n(with ((pat expr) \u0026hellip;) template)\nwithä»…åœ¨extend-syntaxå†…éƒ¨çš„template å†…æœ‰æ•ˆã€‚ withæ¨¡å¼ä¸extend-syntaxæ¨¡å¼ç›¸åŒï¼Œwithè¡¨è¾¾å¼ä¸extend-syntaxçš„fenders ç›¸åŒï¼Œwithæ¨¡æ¿ä¸extend-syntaxæ¨¡æ¿ç›¸åŒã€‚\nwithå¯ç”¨äºå¼•å…¥æ–°çš„æ¨¡å¼æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦ç»‘å®šåˆ°extend-syntaxæ¨¡æ¿ä¸­çš„ä»»æ„Schemeè¡¨è¾¾å¼æ‰€ç”Ÿæˆçš„è¡¨è¾¾å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œwithå…è®¸ä»extend-syntaxçš„å£°æ˜å¼æ ·å¼è½¬ä¸ºfull Schemeçš„è¿‡ç¨‹å¼æ ·å¼ã€‚\nwithçš„ä¸€ç§å¸¸è§ç”¨æ³•æ˜¯åœ¨æ¨¡æ¿ä¸­å¼•å…¥ä¸´æ—¶æ ‡è¯†ç¬¦æˆ–ä¸´æ—¶æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚ å¦‚æœåœ¨extend-syntaxæ¡†æ¶å†…æ‰§è¡Œï¼Œwithä¹Ÿå¯ç”¨äºæ‰§è¡Œå¯èƒ½ç¬¨æ‹™æˆ–æ•ˆç‡ä½ä¸‹çš„å¤æ‚è½¬æ¢ã€‚\nä¾‹å¦‚ï¼Œoréœ€è¦ä½¿ç”¨ä¸´æ—¶æ ‡è¯†ç¬¦ã€‚ æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®šä¹‰orï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (let ([temp x]) (if temp temp (or y ...)))]) è¿™ä¼šä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°å°†orè¡¨è¾¾å¼æ”¾ç½®åœ¨tempå‘ç”Ÿçš„èŒƒå›´å†…ä¸ºæ­¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…ï¼Œå› ä¸ºextend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸã€‚ ï¼ˆè¿™æ˜¯define-syntaxä¼˜äºextend-syntaxçš„åŸå› ä¹‹ä¸€ã€‚ï¼‰\n(let ([temp #t]) (or #f temp)) â‡’ #f å¦‚æœå°†æ ‡è¯†ç¬¦tempæ¢ä¸ªåå­—ï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚å°±å¯ä»¥ç†è§£\u0026quot;extend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸ\u0026quot;è¿™å¥è¯äº†ã€‚ å®é™…ä¸Šï¼Œä¸Šè¿°çš„(let \u0026hellip;)è¡¨è¾¾å¼ï¼Œå±•å¼€ä¹‹åå°±å˜æˆäº†ï¼š\n(let ([temp #t]) (let ([temp #f]) (if temp temp (or temp)) ) ) ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨gensymå’Œwithæ¥åˆ›å»ºä¸´æ—¶æ ‡è¯†ç¬¦ï¼Œå¦‚ä¸‹ï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (with ([temp (gensym)]) (let ([temp x]) (if temp temp (or y ...))))]) è€Œä¸”ï¼Œwithå¯ä»¥ä»¥extend-syntaxæ— æ³•ç›´æ¥ä½¿ç”¨çš„æ–¹å¼æ¥ç»„åˆè¾“å…¥æ¨¡å¼çš„å…ƒç´ ï¼Œä¾‹å¦‚ä»¥ä¸‹folding-plusç¤ºä¾‹:\n(extend-syntax (folding-plus) [(folding-plus x y) (and (number? \u0026#39;x) (number? \u0026#39;y)) (with ([val (+ \u0026#39;x \u0026#39;y)]) val)] [(folding-plus x y) (+ x y)]) å¦‚æœxå’Œyå‡ä¸ºæ•°å­—å¸¸æ•°ï¼Œåˆ™folding-plusæŠ˜å ä¸ºï¼ˆ+ x yï¼‰çš„å€¼ã€‚ å¦åˆ™ï¼Œfolding-plusè½¬æ¢ä¸ºï¼ˆ+ x yï¼‰ä»¥ä¾›ä»¥åè¯„ä¼°ã€‚ fenderåœ¨æ‰©å±•æ—¶æ£€æŸ¥æ“ä½œæ•°æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¹¶ä½¿ç”¨withè¿›è¡Œæ±‚å€¼ã€‚ ä¸fenderä¸€æ ·ï¼Œæ‰©å±•ä»…åœ¨å¸¦å¼•å·çš„è¡¨è¾¾å¼å†…æ‰§è¡Œï¼Œå› ä¸ºquoteå°†æ•°æ®ä¸Schemeè¡¨è¾¾å¼çš„å…¶ä½™éƒ¨åˆ†åŒºåˆ†å¼€ã€‚\nä¸‹é¢çš„ç¤ºä¾‹åˆ©ç”¨withå…è®¸æˆ‘ä»¬å°†æ¨¡å¼ç»‘å®šåˆ°è¡¨è¾¾å¼è¿™ä¸€äº‹å®ï¼Œå°†æ¨¡å¼å˜é‡åˆ—è¡¨ç»‘å®šåˆ°ä¸´æ—¶ç¬¦å·åˆ—è¡¨ã€‚ æ­¤ä¸´æ—¶åˆ—è¡¨å¸®åŠ©æˆ‘ä»¬å®ç°sigmaè¯­æ³•æ‰©å±•ã€‚ sigmaä¸lambdaç›¸ä¼¼ï¼Œé™¤äº†å®ƒåœ¨æ ‡è¯†ç¬¦åˆ—è¡¨ä¸­åˆ†é…æ ‡è¯†ç¬¦è€Œä¸æ˜¯åˆ›å»ºæ–°ç»‘å®šä¹‹å¤–ã€‚ å®ƒå¯ç”¨äºå¹¶è¡Œæ‰§è¡Œä¸€ç³»åˆ—åˆ†é…ã€‚\n(extend-syntax (sigma) [(sigma (x ...) e1 e2 ...) (with ([(t ...) (map (lambda (x) (gensym)) \u0026#39;(x ...))]) (lambda (t ...) (set! x t) ... e1 e2 ...))]) (let ([x \u0026#39;a] [y \u0026#39;b]) ((sigma (x y) (list x y)) y x)) â‡’ (b a) ç»“æ„ä½“ æœ¬èŠ‚ä»‹ç»ä¸€ç§æœºåˆ¶ï¼Œç±»ä¼¼äºç¬¬7.15èŠ‚çš„recordå®šä¹‰æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ä½¿ç”¨å›ºå®šçš„å‘½åå­—æ®µé›†åˆ›å»ºæ•°æ®ç»“æ„ã€‚ ä¸recordç±»å‹ä¸åŒï¼Œç»“æ„ä½“ç±»å‹ä¸æ˜¯å”¯ä¸€ç±»å‹ï¼Œè€Œæ˜¯å®ç°ä¸ºå‘é‡ã€‚ å…·ä½“è€Œè¨€ï¼Œå°†ç»“æ„ä½“å®ç°ä¸ºå‘é‡ï¼Œå…¶é•¿åº¦æ¯”å­—æ®µæ•°å¤§ä¸€å€ï¼Œå¹¶ä¸”å…¶ç¬¬ä¸€ä¸ªå…ƒç´ åŒ…å«è¯¥ç»“æ„ä½“çš„ç¬¦å·åç§°ã€‚\nå°†ç»“æ„ä½“è¡¨ç¤ºä¸ºå‘é‡å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šç®€åŒ–ç»“æ„ä½“çš„è¯»å–å’Œæ‰“å°ä»¥åŠç»“æ„ä½“å®šä¹‰å·¥å…·çš„æ‰©å±•ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®æœ‰ä¸€äº›ç¼ºç‚¹ã€‚ ä¸€ä¸ªæ˜¯åœ¨ä¸é€‚å½“çš„æƒ…å†µä¸‹ï¼Œç»“æ„ä½“å¯èƒ½ä¼šè¢«é”™è¯¯åœ°è§†ä¸ºæ™®é€šå‘é‡ã€‚å½“åœ¨ç¨‹åºä¸­å¤„ç†ç»“æ„ä½“å’Œå‘é‡æ—¶ï¼Œåœ¨æ£€æŸ¥æ›´é€šç”¨çš„å‘é‡ç±»å‹ä¹‹å‰ï¼Œå¿…é¡»æ³¨æ„å…ˆå¯»æ‰¾æ›´å…·ä½“çš„ç»“æ„ä½“ç±»å‹ï¼Œä¾‹å¦‚åœ¨ä¸€ç³»åˆ—condå­å¥ä¸­ã€‚ä¸€ä¸ªç±»ä¼¼çš„ç¼ºç‚¹æ˜¯ï¼Œç»“æ„ä½“å®ä¾‹å®¹æ˜“è¢«æœ‰æ„æˆ–æ— æ„åœ°â€œä¼ªé€ â€ã€‚ ä¹Ÿä¸å¯èƒ½æ§åˆ¶å¦‚ä½•æ‰“å°å’Œè¯»å–ç»“æ„ä½“ã€‚\né€šè¿‡define-structureåˆ›å»ºç»“æ„ä½“ã€‚ æ¯ä¸ªç»“æ„ä½“å®šä¹‰å¼éƒ½å®šä¹‰ä¸€ä¸ªæ„é€ è¿‡ç¨‹ï¼Œä¸€ä¸ªç±»å‹è°“è¯ï¼Œæ¯ä¸ªå­—æ®µçš„è®¿é—®è¿‡ç¨‹ä»¥åŠæ¯ä¸ªå­—æ®µçš„åˆ†é…è¿‡ç¨‹ã€‚define-structureå…è®¸ç¨‹åºå‘˜æ§åˆ¶å“ªäº›å­—æ®µæ˜¯æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°ï¼Œä»¥åŠå“ªäº›å­—æ®µç”±æ„é€ å‡½æ•°è¿‡ç¨‹æ˜¾å¼åˆå§‹åŒ–ã€‚define-structureéå¸¸ç®€å•ï¼Œä½†å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´è¶³å¤Ÿå¼ºå¤§ï¼Œå¦‚æœè¿˜ä¸è¶³ä»¥åº”ä»˜åº”ç”¨ç¨‹åºçš„éœ€æ±‚è¿˜å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰©å±•ä»¥æ»¡è¶³ä¹‹ã€‚ æœ¬èŠ‚æœ«å°¾ç»™å‡ºçš„define-structureå®šä¹‰å¯ä»¥ä½œä¸ºæ›´å¤æ‚å˜ä½“çš„èµ·ç‚¹ã€‚\n(define-structure (name id1 \u0026hellip;) ((id2 expr) \u0026hellip;))\ndefine-structureå½¢å¼å¯ä»¥å‡ºç°åœ¨ä»»æ„ä½ç½®ã€‚\ndefine-structureå®šä¹‰ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„name ï¼Œå¹¶åˆ›å»ºä¸€ç»„ç”¨äºæ„é€ å’Œæ“ä½œè¯¥ç»“æ„å®ä¾‹çš„è¿‡ç¨‹ã€‚ æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; å‘½åæ•°æ®ç»“æ„çš„å­—æ®µã€‚\nä¸‹é¢çš„è¿‡ç¨‹éƒ½æœ‰define-structureå®šä¹‰ï¼š\nåä¸º**make-**name çš„æ„é€ è¿‡ç¨‹ åä¸ºname? çš„ç±»å‹è°“è¯ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸ºname-field çš„è®¿é—®è¿‡ç¨‹ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸º**set-**name-field! çš„åˆ†é…è¿‡ç¨‹ æ ‡è¯†ç¬¦id1 \u0026hellip; å‘½åçš„å­—æ®µç”±æ„é€ å‡½æ•°çš„å‚æ•°åˆå§‹åŒ–ã€‚ ç”±æ ‡è¯†ç¬¦id2 \u0026hellip; å‘½åçš„å­—æ®µè¢«æ˜¾å¼åˆå§‹åŒ–ä¸ºè¡¨è¾¾å¼expr \u0026hellip; çš„å€¼ã€‚æ¯ä¸ªè¡¨è¾¾å¼éƒ½åœ¨æ ‡è¯†ç¬¦id1 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…è¿›è¡Œæ±‚å€¼ï¼Œå¹¶ä¸”åœ¨æ ‡è¯†ç¬¦id2 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…å‡ºç°ï¼ˆç±»ä¼¼let*ï¼‰ ã€‚\nä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæ„é€ å‡½æ•°çš„è¡Œä¸ºå°±åƒå®šä¹‰ä¸ºï¼š\n(define make-name (lambda (id1 ...) (let* ([id2 expr ] ...) body ))) å…¶ä¸­body æ ¹æ®æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; çš„å€¼æ„å»ºç»“æ„ä½“ã€‚\nå¦‚æœä¸éœ€è¦é™¤æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–çš„å­—æ®µä»¥å¤–çš„å…¶ä»–å­—æ®µï¼Œåˆ™å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå­è¡¨è¾¾å¼*( (id2 expr) \u0026hellip;)* ã€‚\nä»¥ä¸‹ç®€å•ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨Schemeä¸­å®šä¹‰pairï¼ˆå¦‚æœå®ƒä»¬ä¸å­˜åœ¨çš„è¯ï¼‰ã€‚ è¿™ä¸¤ä¸ªå­—æ®µéƒ½ç”±æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–ã€‚\n(define-structure (pare car cdr)) (define p (make-pare â€™a â€™b)) (pare? p) â‡’ #t (pair? p) â‡’ #f (pare? â€™(a . b)) â‡’ #f (pare-car p) â‡’ a (pare-cdr p) â‡’ b (set-pare-cdr! p (make-pare \u0026#39;b \u0026#39;c)) (pare-car (pare-cdr p)) â‡’ b (pare-cdr (pare-cdr p)) â‡’ c ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªæ–¹ä¾¿çš„å­—ç¬¦ä¸²æ•°æ®ç»“æ„ï¼Œç§°ä¸ºstrext-string ï¼Œè¯¥ç»“æ„ä¼šæ ¹æ®éœ€è¦å¢é•¿ã€‚æœ¬ä¾‹å­ä¸­ï¼Œä¼šæ˜¾å¼åœ°åˆå§‹åŒ–ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œè¯¥å­—æ®µåœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ã€‚\n(define-structure (stretch-string length fill) ([string (make-string length fill)])) (define stretch-string-ref (lambda (s i) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-ref (stretch-string-string s) i)))) (define stretch-string-set! (lambda (s i c) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-set! (stretch-string-string s) i c)))) (define stretch-string-fill! (lambda (s c) (string-fill! (stretch-string-string s) c) (set-stretch-string-fill! s c))) (define stretch-stretch-string! (lambda (s i n) (set-stretch-string-length! s i) (let ([str (stretch-string-string s)] [fill (stretch-string-fill s)]) (let ([xtra (make-string (- i n) fill)]) (set-stretch-string-string! s (string-append str xtra)))))) é€šå¸¸ï¼Œå¤§å¤šæ•°è‡ªåŠ¨å®šä¹‰çš„è¿‡ç¨‹éƒ½ç”¨äºå®šä¹‰æ›´ç‰¹æ®Šçš„è¿‡ç¨‹ï¼Œ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯´çš„å°±æ˜¯stretch-string-ref ** å’Œstretch-string-set!ã€‚è€Œstretch-string-length** å’Œ stretch-string-stringæ˜¯æƒŸä¸€ç›´æ¥ä½¿ç”¨çš„è‡ªåŠ¨ç”Ÿæˆçš„è¿‡ç¨‹ã€‚\n(define ss (make-stretch-string 2 #\\X)) (stretch-string-string ss) â‡’ \u0026#34;XX\u0026#34; (stretch-string-ref ss 3) â‡’ #\\X (stretch-string-length ss) â‡’ 4 (stretch-string-string ss) â‡’ \u0026#34;XXXX\u0026#34; (stretch-string-fill! ss #\\@) (stretch-string-string ss) â‡’ \u0026#34;@@@@\u0026#34; (stretch-string-ref ss 5) â‡’ #\\@ (stretch-string-string ss) â‡’ \u0026#34;@@@@@@\u0026#34; (stretch-string-set! ss 7 #\\=) (stretch-string-length ss) â‡’ 8 (stretch-string-string ss) â‡’ \u0026#34;@@@@@@@=\u0026#34; ã€ŠThe Scheme Programming Languageã€‹ï¼ˆç¬¬4ç‰ˆï¼‰çš„8.4èŠ‚å®šä¹‰äº†define-structureçš„ç®€åŒ–å˜ä½“ï¼Œä½œä¸ºä½¿ç”¨syntax-caseçš„ç¤ºä¾‹ã€‚ ä¸‹é¢ç»™å‡ºçš„å®šä¹‰å®ç°äº†å®Œæ•´ç‰ˆæœ¬ã€‚\n(define-syntax define-structure (lambda (x) (define gen-id (lambda (template-id . args) (datum-\u0026gt;syntax template-id (string-\u0026gt;symbol (apply string-append (map (lambda (x) (if (string? x) x (symbol-\u0026gt;string (syntax-\u0026gt;datum x)))) args)))))) (syntax-case x () ((_ (name field1 ...)) (andmap identifier? #\u0026#39;(name field1 ...)) #\u0026#39;(define-structure (name field1 ...) ())) ((_ (name field1 ...) ((field2 init) ...)) (andmap identifier? #\u0026#39;(name field1 ... field2 ...)) (with-syntax ((constructor (gen-id #\u0026#39;name \u0026#34;make-\u0026#34; #\u0026#39;name)) (predicate (gen-id #\u0026#39;name #\u0026#39;name \u0026#34;?\u0026#34;)) ((access ...) (map (lambda (x) (gen-id x #\u0026#39;name \u0026#34;-\u0026#34; x)) #\u0026#39;(field1 ... field2 ...))) ((assign ...) (map (lambda (x) (gen-id x \u0026#34;set-\u0026#34; #\u0026#39;name \u0026#34;-\u0026#34; x \u0026#34;!\u0026#34;)) #\u0026#39;(field1 ... field2 ...))) (structure-length (+ (length #\u0026#39;(field1 ... field2 ...)) 1)) ((index ...) (let f ([i 1] [ids #\u0026#39;(field1 ... field2 ...)]) (if (null? ids) \u0026#39;() (cons i (f (+ i 1) (cdr ids))))))) #\u0026#39;(begin (define constructor (lambda (field1 ...) (let* ([field2 init] ...) (vector \u0026#39;name field1 ... field2 ...)))) (define predicate (lambda (x) (and (vector? x) (#3%fx= (vector-length x) structure-length) (eq? (vector-ref x 0) \u0026#39;name)))) (define access (lambda (x) (vector-ref x index))) ... (define assign (lambda (x update) (vector-set! x index update))) ...)))))) ","id":17,"section":"posts","summary":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯","tags":["scheme"],"title":"å…¼å®¹æ€§ï¼ˆCompatibility Features in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/compatibility/","year":"2020"},{"content":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹ç³»ç»Ÿï¼ˆpthreadsï¼‰ä¹‹ä¸Šå®ç°ï¼Œå¹¶åœ¨åŸºäºWindowsçš„ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨Windows APIã€‚ æœ‰å…³çº¿ç¨‹åˆ›å»ºå’Œäº¤äº’çš„åŸºæœ¬è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…ç³»ç»Ÿä¸Šçš„ç›¸åº”æ–‡æ¡£ã€‚\nå¤§å¤šæ•°åŸç”Ÿçš„Schemeè¿‡ç¨‹éƒ½æ˜¯çº¿ç¨‹å®‰å…¨ çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶è°ƒç”¨å®ƒä»¬ã€‚ è¿™åŒ…æ‹¬è¯¸å¦‚conså’Œmake-stringä¹‹ç±»çš„åˆ†é…æ“ä½œï¼Œè¯¸å¦‚carå’Œvector-refä¹‹ç±»çš„è®¿é—®å™¨ï¼Œè¯¸å¦‚**+å’Œsqrtä¹‹ç±»çš„æ•°å­—è¿ç®—ç¬¦ä»¥åŠè¯¸å¦‚appendå’Œmap**ä¹‹ç±»çš„éç ´åæ€§çš„é«˜çº§åŸç”Ÿæ“ä½œã€‚\nç®€å•çš„å˜åŠ¨è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚set-carï¼ï¼Œvector-setï¼å’Œrecordå­—æ®µå˜åŠ¨å™¨ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åŒæ ·ï¼Œå¯¹å±€éƒ¨å˜é‡çš„åˆ†é…ï¼ŒåŒ…æ‹¬ï¼ˆæœªå¯¼å‡ºçš„ï¼‰åº“å’Œé¡¶çº§ç¨‹åºå˜é‡çš„åˆ†é…ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nå¤§å¤šæ•°I/Oæ“ä½œåº”è¢«è§†ä¸ºå…·æœ‰ç ´åæ€§ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šä¿®æ”¹ç«¯å£çš„å†…éƒ¨ç»“æ„ã€‚\nä½¿ç”¨æ²¡æœ‰è¿›è¡Œåˆé€‚çš„åŒæ­¥ç­–ç•¥çš„éçº¿ç¨‹å®‰å…¨çš„è¿ç®—ç¬¦å¯èƒ½ä¼šç ´åå®ƒä»¬æ‰€æ“ä½œçš„å¯¹è±¡ã€‚ è¿™ç§æŸåå¯èƒ½å¯¼è‡´é”™è¯¯çš„è¡Œä¸ºï¼Œå†…å­˜æ•…éšœï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿä¸­æ­¢çš„ä¸å¯æ¢å¤çš„é”™è¯¯ã€‚\nçº¿ç¨‹åˆ›å»º (fork-thread thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—0ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚\nfork-threadåœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è°ƒç”¨thunk ï¼Œå¹¶è¿”å›ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚\né™¤äº†æ‰“å°å®ƒå¤–ï¼Œfork-threadè¿”å›çš„çº¿ç¨‹å¯¹è±¡æ— æ³•æ‰§è¡Œä»»ä½•æ“ä½œã€‚\né™¤äº†ä½¿ç”¨fork-threadä»¥å¤–ï¼Œå¯é€šè¿‡å¤–éƒ¨ä»£ç æ¥åˆ›å»ºçš„çº¿ç¨‹å¿…é¡»åœ¨è§¦åŠä»»ä½•Schemeæ•°æ®æˆ–è°ƒç”¨ä»»ä½•Schemeè¿‡ç¨‹ä¹‹å‰è°ƒç”¨Sactivate_thread\n(thread? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè¿”å›#t,å¦åˆ™è¿”å›#f\n(get-thread-id)\nè¿”å›ï¼šå½“å‰çº¿ç¨‹çš„id\nçº¿ç¨‹idæ˜¯ç”±çº¿ç¨‹åˆ†é…çš„çº¿ç¨‹å·ï¼Œå¹¶ä¸”ä¸get-process-idè¿”å›çš„è¿›ç¨‹idæ²¡æœ‰å…³ç³»ï¼Œè¿›ç¨‹idåœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚\näº’æ–¥é” (make-mutex)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„äº’æ–¥é”å¯¹è±¡\n(mutex? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯äº’æ–¥é”ï¼Œè¿”å›#t\n(mutex-acquire mutex) | (mutex-acquire mutex block?)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-acquireè·å–ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚å¯é€‰çš„boolå‚æ•°blockï¼Ÿ é»˜è®¤ä¸º#tï¼ŒæŒ‡å®šçº¿ç¨‹æ˜¯å¦åº”é˜»å¡ç­‰å¾…äº’æ–¥é”ã€‚blockï¼Ÿ å¦‚æœçœç•¥æˆ–ä¸ºtrueï¼Œåˆ™çº¿ç¨‹å°†é˜»å¡ï¼Œç›´åˆ°è·å–äº†äº’æ–¥é”ä¸ºæ­¢ï¼Œå¹¶è¿”å›æœªæŒ‡å®šçš„å€¼ã€‚\nå¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”äº’æ–¥é”å½“å‰å·²å±äºå…¶ä»–çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ï¼Œmutex-acquireç«‹å³è¿”å›å€¼**#f**ï¼Œä»¥æŒ‡ç¤ºäº’æ–¥é”ä¸å¯ç”¨ã€‚ å¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”æˆåŠŸè·å–äº†äº’æ–¥é”ï¼Œmutex-acquireè¿”å›#tã€‚\näº’æ–¥é”åœ¨Posixçº¿ç¨‹æœ¯è¯­ä¸­æ˜¯é€’å½’çš„ï¼Œè¿™æ„å‘³ç€è°ƒç”¨çº¿ç¨‹å¯ä»¥ä½¿ç”¨äº’æ–¥é”è·å–ï¼ˆé‡æ–°ï¼‰è·å–å®ƒå·²ç»æ‹¥æœ‰çš„äº’æ–¥é”ï¼ˆæ³¨ï¼šé”æ˜¯å¯ä»¥é‡å…¥çš„ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡Šæ”¾äº’æ–¥é”éœ€è¦æ‰§è¡Œç›¸ç­‰æ•°é‡çš„mutex-releaseã€‚\n(mutex-release mutex)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-releaseé‡Šæ”¾ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚ å¦‚æœmutex ä¸å±äºè°ƒç”¨çº¿ç¨‹ï¼ˆå³é‡Šæ”¾åˆ«äººçš„äº’æ–¥é”ï¼‰ï¼Œåˆ™ä¼šå¯¼è‡´æ— æ³•é¢„æ–™çš„è¡Œä¸ºã€‚\n(with-mutex mutex body1 body2 \u0026hellip;)\nwith-mutexè®¡ç®—è¡¨è¾¾å¼mutex ï¼Œå…¶å¿…é¡»å¯ä»¥è®¡ç®—ä¸ºä¸€ä¸ªäº’æ–¥é”ï¼Œè·å–é”ï¼Œå¹¶è®¡ç®—body1 body2 \u0026hellip; ,ç„¶åé‡Šæ”¾é”ã€‚æ— è®ºbodyæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯é€šè¿‡æ§åˆ¶æ“ä½œï¼ˆå³å¯èƒ½ç”±äºé”™è¯¯è€ŒæŠ›åˆ°continuationï¼‰é‡Šæ”¾äº’æ–¥é‡ï¼Œè¿™éƒ½ä¼šå¯¼è‡´with-mutexå½¢å¼çš„éæœ¬åœ°é€€å‡ºã€‚å¦‚æœæ§åˆ¶éšåé€šè¿‡continuationè°ƒç”¨è¿”å›åˆ°bodyï¼Œåˆ™å°†é‡æ–°è·å–äº’æ–¥é”ã€‚\nä¸ç›´æ¥ä½¿ç”¨mutex-acquireå’Œmutex-releaseç›¸æ¯”ï¼Œä½¿ç”¨with-mutexé€šå¸¸æ›´æ–¹ä¾¿ï¼Œæ›´å®‰å…¨ã€‚\næ¡ä»¶ (make-condition)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„æ¡ä»¶å¯¹è±¡\n(thread-condition? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œè¿”å›#t\n(condition-wait cond mutex) | (condition-wait cond mutex timeout)\nè¿”å›ï¼šå¦‚æœè°ƒç”¨çº¿ç¨‹è¢«æ¡ä»¶å”¤é†’è¿”å›#tï¼Œå¦‚æœè°ƒç”¨çº¿ç¨‹è¶…æ—¶ç­‰å¾…è¿”å›#f\ncond å¿…é¡»æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”mutex å¿…é¡»æ˜¯äº’æ–¥é”ã€‚ å¯é€‰å‚æ•°timeout æ˜¯ç±»å‹ä¸ºtime-durationæˆ–time-utcæˆ–**#fçš„æ—¶é—´è®°å½•ï¼Œè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶ã€‚ é»˜è®¤ä¸º#f**ã€‚\ncondition-waitç­‰å¾…ç”±cond æ ‡è¯†çš„æ¡ä»¶ï¼Œä¸”ç­‰å¾…æŒ‡å®šçš„timeoutæ—¶é•¿ã€‚åœ¨è°ƒç”¨condition-waitæ—¶ï¼Œè°ƒç”¨çº¿ç¨‹å¿…é¡»å·²è·å–äº’æ–¥é”mutex ã€‚ç”±äºè°ƒç”¨condition-waitçš„å‰¯ä½œç”¨è€Œé‡Šæ”¾äº†mutex ã€‚å½“ç¨åé€šè¿‡ä¸‹è¿°çš„è¿‡ç¨‹ä¹‹ä¸€ä»æ¡ä»¶å˜é‡é‡Šæ”¾çº¿ç¨‹æˆ–è¶…æ—¶åˆ°æœŸæ—¶ï¼Œå°†é‡æ–°è·å–mutex ï¼Œå¹¶è¿”å›condition-waitã€‚\n(condition-signal cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-signalé‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªã€‚\n(condition-broadcast cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-broadcasté‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹\né” é”æ¯”äº’æ–¥é”æ›´åŸç”Ÿï¼Œä½†æ˜¯æ›´åŠ çµæ´»å’Œæœ‰æ•ˆã€‚\nåªè¦é”åœ¨è¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­åˆ†é…ï¼Œå®ƒä»¬è¿˜å¯ä»¥ç‹¬ç«‹äºçº¿ç¨‹ç³»ç»Ÿä½¿ç”¨ï¼ˆåŒ…æ‹¬åœ¨Chez Schemeçš„éçº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼‰ä»¥åœ¨åˆ†ç¦»çš„Schemeè¿›ç¨‹ä¸­æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ é”åªæ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³iptræˆ–uptrå¤–éƒ¨ç±»å‹ï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡è®¡ç®—æœºçš„æœ¬æœºå­—èŠ‚åºï¼Œå¯èƒ½æ˜¯ä½¿ç”¨define-ftypeå®šä¹‰çš„å¤§ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚å¿…é¡»åœ¨é©»ç•™äºSchemeå †å¤–éƒ¨çš„å†…å­˜ä¸­æ˜¾å¼åˆ†é…å®ƒï¼Œå¹¶åœ¨é€‚å½“æ—¶æ˜¾å¼é‡Šæ”¾ã€‚å½“ä»…æ¶‰åŠçº¿ç¨‹æ—¶ï¼ˆå³ï¼Œå½“ä¸æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡foreign-allocåˆ†é…å†…å­˜ã€‚ å½“æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼Œåº”åœ¨è¿›ç¨‹å…±äº«çš„æŸä¸ªåŒºåŸŸä¸­åˆ†é…è¯¥é”ã€‚\nä½¿ç”¨ftype-init-lock! åˆå§‹åŒ–åï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥å°è¯•é€šè¿‡**ftype-lock!æˆ–ftype-spin-lock!é”å®šlock ã€‚ä¸€æ—¦é”å·²è¢«é”å®šå¹¶ä¸”åœ¨è§£é”ä¹‹å‰ï¼Œå³ä½¿é€šè¿‡æœ€è¿‘é”å®šå®ƒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œå†ä¸€æ¬¡å°è¯•é”å®šè¯¥é”ä¹Ÿä¼šå¤±è´¥ã€‚ ä»»ä½•è¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥ä½¿ç”¨ftype-unlock!**æ¥è§£é”lockï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡æœ€è¿‘é”å®šé”çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ¥è§£é”ã€‚\né”æœºåˆ¶æä¾›çš„ç»“æ„å¾ˆå°‘ï¼Œå¹¶ä¸”åˆ†é…å’Œä½¿ç”¨ä¸­çš„é”™è¯¯å¯èƒ½å¯¼è‡´å†…å­˜é”™è¯¯ï¼Œæ­»é”å’Œå…¶ä»–é—®é¢˜ã€‚ å› æ­¤ï¼Œé€šå¸¸å»ºè®®ä»…å°†é”ç”¨ä½œæ›´é«˜çº§åˆ«æŠ½è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æŒ‰è§„èŒƒæ–¹å¼ä½¿ç”¨é”ã€‚\n(define lock (make-ftype-pointer uptr (foreign-alloc (ftype-sizeof uptr)))) (ftype-init-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #t (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-spin-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr index)\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\n**ftype-init-lock!**åº”è¯¥åœ¨ä½¿ç”¨ä»»ä½•å…¶ä»–è¿ç®—ç¬¦ä¹‹å‰ç”¨äºåˆå§‹åŒ–é”ï¼› å¦‚æœä¸è¿™æ ·åšï¼Œåˆ™å…¶ä»–æ“ä½œç¬¦çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚\nftype-lock! å¯ç”¨äºåŠ é”ã€‚å¦‚æœå‘ç°åœ¨æ“ä½œæ—¶é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›#tï¼›å¦‚æœå‘ç°è¯¥é”å·²åŠ é”ï¼Œåˆ™è¿”å›#fä¸”ä¸æ›´æ”¹è¯¥é”ã€‚\nftype-spin-lock! ä¹Ÿå¯ä»¥ç”¨æ¥åŠ é”ã€‚ å¦‚æœåœ¨æ“ä½œæ—¶å‘ç°è¯¥é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›ï¼› å¦‚æœå‘ç°è¯¥é”å·²é”å®šï¼Œå®ƒå°†ä¸€ç›´ç­‰å¾…ç›´åˆ°é”è¢«è§£é”ï¼Œç„¶åå†é”å®šå¹¶è¿”å›ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–è¿›ç¨‹æˆ–è€…çº¿ç¨‹æ¥é‡Šæ”¾è¯¥é”ï¼Œè¯¥æ“ä½œä¸ä¼šè¿”å›ä¸”ä¸èƒ½ä»¥æ­£å¸¸çš„æ–¹å¼ï¼ˆåŒ…æ‹¬GCï¼‰ä¸­æ–­ã€‚ä¹Ÿä¸ä¿è¯å…¬å¹³ï¼Œå› æ­¤å³ä½¿å…¶ä»–è¿›ç¨‹æ­£åœ¨ä¸»åŠ¨é”å®šå’Œé‡Šæ”¾è¯¥é”ï¼Œè¿›ç¨‹ä¹Ÿå¯èƒ½æ— é™æœŸæŒ‚èµ·ã€‚\nftype-unlock! ç”¨äºè§£é”ã€‚å¦‚æœå‘ç°é”å·²è¢«é”å®šï¼Œåˆ™å°†å…¶è§£é”å¹¶è¿”å›ã€‚ å¦åˆ™ï¼Œå®ƒå°†è¿”å›è€Œä¸æ›´æ”¹é”ã€‚\nåŸå­æ“ä½œLocked increment and decrement å½“éœ€è¦åŸå­é€’å¢æˆ–é€’å‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¤„æè¿°çš„é”å®šæ“ä½œã€‚\n(ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\n(ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\nftype-locked-incr! è‡ªåŠ¨è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œå°†å€¼åŠ 1ï¼Œç„¶åå°†æ–°å€¼å†™å›è¯¥å­—æ®µã€‚ åŒæ ·ï¼Œftype-locked-decr! åŸå­è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œä»è¯¥å€¼ä¸­å‡å»1ï¼Œç„¶åå°†æ–°å€¼å†™å›åˆ°è¯¥å­—æ®µä¸­ã€‚ å¦‚æœæ–°å€¼ä¸º0ï¼Œåˆ™ä¸¤è€…éƒ½è¿”å›#tï¼Œå¦åˆ™è¿”å›#fã€‚\nå¼•ç”¨è®¡æ•° åœ¨Schemeå †ä¹‹å¤–ç®¡ç†å†…å­˜çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨Schemeå­˜å‚¨ç®¡ç†ç³»ç»Ÿé€šè¿‡ftype guardians æ‰§è¡Œå¼•ç”¨è®¡æ•°ã€‚ åœ¨å¼•ç”¨è®¡æ•°çš„å†…å­˜ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¿å­˜ç€æŒ‡å‘å®ƒçš„æŒ‡é’ˆè®¡æ•°ã€‚ å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å¢åŠ ï¼›è€Œåœ¨åˆ é™¤æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å‡å°ã€‚ å½“è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œä¸å†éœ€è¦è¯¥å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç”¨äºå…¶ä»–ç›®çš„ã€‚\n(ftype-guardian ftype-name)\nftype-name å¿…é¡»å‘½åä¸€ä¸ªftypeã€‚ ftypeçš„ç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼ˆæˆ–åœ¨unionsçš„æƒ…å†µä¸‹ä¸ºç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼‰å¿…é¡»æ˜¯å…·æœ‰æœ¬åœ°å°¾æ•°çš„å­—é•¿æ•´æ•°ï¼ˆiptræˆ–uptrï¼‰ã€‚ å‡å®šæ­¤å­—æ®µä¿å­˜å¼•ç”¨è®¡æ•°ã€‚\nè¿”å›æ–°çš„ftype guardian g ï¼Œå¯ä»¥ä½¿ç”¨å…¶æ³¨å†Œftype-name ç±»å‹ï¼ˆæˆ–ftype-nam eçš„æŸäº›å­ç±»å‹ï¼‰çš„ftype-pointerã€‚ é€šè¿‡ä½¿ç”¨ftypeæŒ‡é’ˆä½œä¸ºå‚æ•°è°ƒç”¨g ï¼Œå¯ä»¥å‘g æ³¨å†ŒftypeæŒ‡é’ˆã€‚\nftype guardianä¸ä¼šåƒæ™®é€šçš„guardiané‚£æ ·è‡ªåŠ¨ä¿æŠ¤å…¶æ³¨å†Œçš„ftypeæŒ‡é’ˆå…é­å›æ”¶ã€‚è€Œæ˜¯ï¼Œå¯¹äºæ¯ä¸ªé€šè¿‡æ™®é€šï¼ˆéå¼±ï¼Œéç›‘æŠ¤äººæŒ‡é’ˆï¼‰å˜å¾—ä¸å¯è®¿é—®çš„å·²æ³¨å†Œçš„ftypeæŒ‡é’ˆï¼Œguardianä¼šå‡å°‘ftypeæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å€¼ä¸º0ï¼Œåˆ™ftypeæŒ‡é’ˆå°†ä¿ç•™å¹¶å¯ä»¥ä»guardianä¸­æ£€ç´¢ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆçš„å¼•ç”¨è®¡æ•°å€¼éé›¶ï¼Œåˆ™ä¸ä¼šä¿ç•™ftypeæŒ‡é’ˆã€‚å‡è®¾å›æ”¶å™¨å¤–éƒ¨çš„ä»£ç æ­£ç¡®ç»´æŠ¤äº†å¼•ç”¨è®¡æ•°ï¼Œåˆ™ä»ftype guardianæ£€ç´¢çš„å¯¹è±¡ï¼ˆé€šè¿‡ä¸å¸¦å‚æ•°çš„è°ƒç”¨ï¼‰å°†ç¡®ä¿å…·æœ‰0å¼•ç”¨è®¡æ•°ã€‚å›æ”¶å™¨ä½¿ç”¨ç­‰æ•ˆçš„ftype-locked-decr!æ¥å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œä»¥æ”¯æŒç”±å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­çš„éSchemeå¯¹è±¡ã€‚åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œç¨‹åºæœ¬èº«åº”ä½¿ç”¨ftype-locked-incr! å’Œftype-locked-decr! æˆ–éSchemeç­‰æ•ˆé¡¹ï¼ˆä¾‹å¦‚ï¼Œç¬¬4.8èŠ‚ä¸­æ‰€è¿°Cè¯­è¨€çš„scheme.hä¸­çš„ LOCKED_INCRå’ŒLOCKED_DECRå®ï¼‰æ¥ç»´æŠ¤å¼•ç”¨è®¡æ•°ã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä¸ºftypeå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ftypeå’Œä¸€ä¸ªåˆ†é…å™¨ï¼Œè¯¥å¯¹è±¡é‡Šæ”¾ä»¥å‰åˆ†é…çš„ä¸”ä¸å†å¯è®¿é—®çš„ftypeå¯¹è±¡ã€‚\nmodule (A make-A free-dropped-As) (define-ftype A (struct [refcount uptr] [data int])) (define g (ftype-guardian A)) (define free-dropped-As (lambda () (let ([a (g)]) (when a (printf \u0026#34;freeing ~s\\n\u0026#34; (ftype-ref A (data) a)) (foreign-free (ftype-pointer-address a)) (free-dropped-As))))) (define make-A (lambda (n) (free-dropped-As) (let ([a (make-ftype-pointer A (foreign-alloc (ftype-sizeof A)))]) (ftype-set! A (refcount) a 1) (ftype-set! A (data) a n) (g a) a)))) æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…ï¼Œä¸¢å¼ƒå¹¶ç«‹å³å›æ”¶æŒ‡å‘Açš„ftypeæŒ‡é’ˆè¿›è¡Œæµ‹è¯•ã€‚\n\u0026gt; (do ([i 10 (fx- i 1)]) ((fx= i 0)) (make-A i) (collect)) freeing 10 freeing 9 freeing 8 freeing 7 freeing 6 freeing 5 freeing 4 freeing 3 freeing 2 \u0026gt; (free-dropped-As) freeing 1 ç”±ftype guardianä¿æŠ¤çš„å¯¹è±¡å¯èƒ½åŒ…å«æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¿™äº›å…¶ä»–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¹Ÿåº”åœ¨åˆ†é…åŒ…å«å¯¹è±¡æ—¶å¢åŠ ï¼Œå¹¶åœ¨é‡Šæ”¾åŒ…å«å¯¹è±¡æ—¶å‡å°‘ã€‚\nçº¿ç¨‹å‚æ•° (make-thread-parameter object) | (make-thread-parameter object procedure)\nåˆ›å»ºçº¿ç¨‹å‚æ•°åï¼Œå°†åœ¨æ¯ä¸ªå½“å‰çº¿ç¨‹å’Œå°†æ¥çš„çº¿ç¨‹ä¸­æ”¾ç½®ä¸€ä¸ªå•ç‹¬çš„ä½ç½®ï¼Œä»¥ä¿å­˜å‚æ•°çš„å†…éƒ¨çŠ¶æ€å˜é‡çš„å€¼ã€‚ ï¼ˆå½“è¯¥å‚æ•°å˜å¾—ä¸å¯è®¿é—®æ—¶ï¼Œå­˜å‚¨ç®¡ç†å™¨å¯ä»¥æ¶ˆé™¤è¯¥ä½ç½®ã€‚ï¼‰ä¸€ä¸ªçº¿ç¨‹ä¸­å¯¹çº¿ç¨‹å‚æ•°çš„æ›´æ”¹ä¸ä¼šè¢«å…¶ä»–ä»»ä½•çº¿ç¨‹çœ‹åˆ°ã€‚\nåˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼ˆè¯·å‚é˜…fork-threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»æ´¾ç”Ÿçº¿ç¨‹ç»§æ‰¿ã€‚ ç±»ä¼¼åœ°ï¼Œå½“ç¬¬ä¸€æ¬¡æ¿€æ´»é€šè¿‡å…¶ä»–æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ—¶ï¼ˆè¯·å‚è§4.8èŠ‚ä¸­çš„Sactivate_threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»ä¸»ï¼ˆåŸå§‹ï¼‰çº¿ç¨‹ç»§æ‰¿ã€‚\nå¤§å¤šæ•°å†…ç½®å‚æ•°æ˜¯çº¿ç¨‹å‚æ•°ï¼Œä½†æœ‰äº›æ˜¯å…¨å±€çš„ã€‚ åœ¨ä»–ä»¬å®šä¹‰çš„åœ°æ–¹å·²ç»æ ‡æ³¨äº†æ˜¯çº¿ç¨‹çš„è¿˜æ˜¯å…¨å±€çš„ã€‚ åœ¨éçº¿ç¨‹ç‰ˆæœ¬çš„Chez Schemeä¸­ï¼Œå†…ç½®å…¨å±€å‚æ•°å’Œçº¿ç¨‹å‚æ•°ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚\nI/O ç¼“å†²åŒº Chez Schemeä¸ºæé«˜æ•ˆç‡è€Œç¼“å†²æ–‡ä»¶I/Oæ“ä½œï¼Œä½†æ˜¯ç¼“å†²çš„I/Oä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç¼“å†²ç«¯å£å¯èƒ½ä¼šç ´åè¯¥ç«¯å£ï¼Œä»è€Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶æœ€ç»ˆå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ã€‚\nå½“ä»¥ç¼“å†²æ¨¡å¼noneæ‰“å¼€æ—¶ï¼Œå¯ä»¥ç¦ç”¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ä¸Šçš„ç¼“å†²ã€‚ ä½†æ˜¯ï¼Œç”±äºéœ€è¦æ”¯æŒå…ˆè¡Œï¼ˆlookaheadï¼‰ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨è¾“å…¥ç«¯å£ä¸Šçš„ç¼“å†²ï¼Œå¹¶ä¸”ç”±äºè¦åœ¨å­—ç¬¦å’Œå­—èŠ‚ä¹‹é—´è¿›è¡Œè½¬æ¢çš„ä»£ç è½¬æ¢å™¨æœ‰æ—¶éœ€è¦å…ˆè¡Œè¾“å…¥ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨æ–‡æœ¬ç«¯å£ï¼ˆç”šè‡³æ˜¯æ–‡æœ¬è¾“å‡ºç«¯å£ï¼‰ä¸Šçš„ç¼“å†²ã€‚\nå› æ­¤ï¼Œé™¤éåœ¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£å¼€å¯ç¼“å†²æ¨¡å¼ä¸ºnoneçš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦åˆ™ä¸¤ä¸ªçº¿ç¨‹ç»ä¸åº”è¯¥å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç«¯å£ã€‚æ›¿ä»£æ–¹æ³•åŒ…æ‹¬æŒ‡å®šä¸€ä¸ªçº¿ç¨‹ä¸ºç»™å®šç«¯å£æ‰§è¡Œæ‰€æœ‰I / Oï¼Œå’Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›é€šç”¨ç«¯å£åŒ…è£…ç¨‹åºï¼Œä»…åœ¨è·å–äº’æ–¥é‡åæ‰å°†è¯·æ±‚è½¬å‘åˆ°ç«¯å£ã€‚\nåˆå§‹çš„æ§åˆ¶å°ä»¥åŠå½“å‰çš„è¾“å…¥å’Œè¾“å‡ºç«¯å£ä»¥åŠtranscriptç«¯å£éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¤šä¸ªçº¿ç¨‹å‘æ§åˆ¶å°æ‰“å°é”™è¯¯å’Œ/æˆ–è°ƒè¯•æ¶ˆæ¯æ˜¯å®‰å…¨çš„ã€‚å³ä½¿åœ¨åŒä¸€è¡Œå†…ï¼Œè¾“å‡ºä¹Ÿå¯èƒ½æ˜¯äº¤é”™çš„ï¼Œä½†æ˜¯ç«¯å£ä¸ä¼šæŸåã€‚ è¿™äº›ç«¯å£çš„çº¿ç¨‹å®‰å…¨æ€§æ˜¯é€šè¿‡ä¸ºæ¯ä¸ªI/Oæ“ä½œè·å–ä¸€ä¸ªäº’æ–¥é”çš„é«˜æˆæœ¬æ¥å®ç°çš„ã€‚\nå®ä¾‹ï¼šæœ‰ç•Œé˜Ÿåˆ— ä»¥ä¸‹ä»£ç æ‘˜è‡ªæ–‡ç« â€œA Scheme for native threads1â€ï¼Œå®ƒä½¿ç”¨è®¸å¤šçº¿ç¨‹ç³»ç»ŸåŠŸèƒ½å®ç°äº†æœ‰ç•Œé˜Ÿåˆ—ã€‚ æœ‰ç•Œé˜Ÿåˆ—å…·æœ‰å›ºå®šæ•°é‡çš„å¯ç”¨æ’æ§½ã€‚ å½“é˜Ÿåˆ—å·²æ»¡æ—¶å°è¯•å…¥é˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚ å°è¯•ä»ç©ºé˜Ÿåˆ—ä¸­å‡ºé˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚\n(define-record-type bq (fields (immutable data) (mutable head) (mutable tail) (immutable mutex) (immutable ready) (immutable room)) (protocol (lambda (new) (lambda (bound) (new (make-vector bound) 0 0 (make-mutex) (make-condition) (make-condition)))))) (define dequeue! (lambda (q) (with-mutex (bq-mutex q) (let loop () (let ([head (bq-head q)]) (cond [(= head (bq-tail q)) (condition-wait (bq-ready q) (bq-mutex q)) (loop)] [else (bq-head-set! q (incr q head)) (condition-signal (bq-room q)) (vector-ref (bq-data q) head)])))))) (define enqueue! (lambda (item q) (with-mutex (bq-mutex q) (let loop () (let* ([tail (bq-tail q)] [tail^ (incr q tail)]) (cond [(= tail^ (bq-head q)) (condition-wait (bq-room q) (bq-mutex q)) (loop)] [else (vector-set! (bq-data q) tail item) (bq-tail-set! q tail^) (condition-signal (bq-ready q))])))))) (define incr (lambda (q i) (modulo (+ i 1) (vector-length (bq-data q))))) ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æœ‰ç•Œé˜Ÿåˆ—åœ¨ä¸€ç»„çº¿ç¨‹ä¸­çš„åº”ç”¨ï¼Œè¿™äº›çº¿ç¨‹åˆ†åˆ«æ‰®æ¼”æ•°æ®çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ã€‚\n(define job-queue) (define die? #f) (define make-job (let ([count 0]) (define fib (lambda (n) (if (\u0026lt; n 2) n (+ (fib (- n 2)) (fib (- n 1)))))) (lambda (n) (set! count (+ count 1)) (printf \u0026#34;Adding job #~s = (lambda () (fib ~s))\\n\u0026#34; count n) (cons count (lambda () (fib n)))))) (define make-producer (lambda (n) (rec producer (lambda () (printf \u0026#34;producer ~s posting a job\\n\u0026#34; n) (enqueue! (make-job (+ 20 (random 10))) job-queue) (if die? (printf \u0026#34;producer ~s dying\\n\u0026#34; n) (producer)))))) (define make-consumer (lambda (n) (rec consumer (lambda () (printf \u0026#34;consumer ~s looking for a job~%\u0026#34; n) (let ([job (dequeue! job-queue)]) (if die? (printf \u0026#34;consumer ~s dying\\n\u0026#34; n) (begin (printf \u0026#34;consumer ~s executing job #~s~%\u0026#34; n (car job)) (printf \u0026#34;consumer ~s computed: ~s~%\u0026#34; n ((cdr job))) (consumer)))))))) (define (bq-test np nc) (set! job-queue (make-bq (max nc np))) (do ([np np (- np 1)]) ((\u0026lt;= np 0)) (fork-thread (make-producer np))) (do ([nc nc (- nc 1)]) ((\u0026lt;= nc 0)) (fork-thread (make-consumer nc)))) è¿™æ˜¯ç¤ºä¾‹ç¨‹åºè¿è¡Œåçš„å¯èƒ½çš„å‰å‡ è¡Œè¾“å‡ºï¼š\n\u0026gt; (begin (bq-test 3 4) (system \u0026#34;sleep 3\u0026#34;) (set! die? #t)) producer 3 posting a job Adding job #1 = (lambda () (fib 29)) producer 3 posting a job Adding job #2 = (lambda () (fib 26)) producer 3 posting a job Adding job #3 = (lambda () (fib 22)) producer 3 posting a job Adding job #4 = (lambda () (fib 21)) producer 2 posting a job Adding job #5 = (lambda () (fib 29)) producer 1 posting a job Adding job #6 = (lambda () (fib 29)) consumer 4 looking for a job producer 3 posting a job Adding job #7 = (lambda () (fib 24)) consumer 4 executing job #1 consumer 3 looking for a job producer 2 posting a job Adding job #8 = (lambda () (fib 26)) consumer 3 executing job #2 consumer 3 computed: 121393 consumer 3 looking for a job producer 1 posting a job Adding job #9 = (lambda () (fib 26)) ... åœ¨â€œA Scheme for native threads1â€ä¸­ç»™å‡ºäº†å…¶ä»–ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¯æ‚¬æŒ‚çº¿ç¨‹çš„å®šä¹‰å’Œåœ¨æ— æ³•è®¿é—®æ—¶è‡ªåŠ¨ç»ˆæ­¢çš„çº¿ç¨‹ã€‚\nR. Kent Dybvig. A Scheme for native threads. In Symposium in Honor of Mitchell Wand, August 2009. http://www.ccs.neu.edu/events/wand-symposium/.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":18,"section":"posts","summary":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹","tags":["thread","scheme"],"title":"çº¿ç¨‹ï¼ˆThread System in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/thread/","year":"2020"},{"content":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å›æ”¶ä¸è¯¥å¯¹è±¡å…³è”çš„å­˜å‚¨ã€‚ ä¸ºäº†å›æ”¶æ­¤å­˜å‚¨ï¼ŒChez Schemeä½¿ç”¨äº†ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¯¥åƒåœ¾æ”¶é›†å™¨åœ¨ç¨‹åºè¿è¡Œæ—¶å®šæœŸè¿è¡Œã€‚ åƒåœ¾æ”¶é›†å™¨ä»ä¸€ç»„å·²çŸ¥çš„æ ¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœºå™¨æ³¨å†Œï¼‰ï¼ŒæŸ¥æ‰¾æ‰€æœ‰å¯è®¿é—®å¯¹è±¡ï¼Œå¹¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¤åˆ¶å®ƒä»¬ï¼Œä»¥æ¶ˆé™¤å¯è®¿é—®å¯¹è±¡ä¹‹é—´çš„ç¢ç‰‡ï¼Œå¹¶å›æ”¶ä¸å¯è®¿é—®å¯¹è±¡æ‰€å ç”¨çš„å­˜å‚¨ã€‚\nå›æ”¶ç”±é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºè‡ªåŠ¨è§¦å‘ï¼Œè¯¥å¤„ç†ç¨‹åºé€šè¿‡collect-requestä¸­æ–­è°ƒç”¨ï¼Œè¯¥ä¸­æ–­åœ¨åˆ†é…äº†å¤§çº¦nä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´åå‘ç”Ÿï¼Œå…¶ä¸­næ˜¯å‚æ•°collect-trip-bytes çš„å€¼ã€‚ é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºé€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectç¨‹åºæ¥è¿›è¡Œä¼šç¡ã€‚ å¯ä»¥é€šè¿‡æ›´æ”¹å‚æ•°collect-request-handler çš„å€¼æ¥é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºã€‚ ç¨‹åºè¿˜å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨collectæ¥å¯¼è‡´åœ¨collect-requestä¸­æ–­ä¹‹é—´å‘ç”Ÿå›æ”¶ã€‚\nChez Schemeçš„å›æ”¶å™¨æ˜¯åŸºäºåˆ†ä»£ çš„ã€‚å®ƒæ ¹æ®å¯¹è±¡çš„å¹´é¾„ï¼ˆå¤§è‡´æ¥è¯´ï¼Œå›æ”¶å¹¸å­˜æ•°ï¼‰æ¥å¯¹å¯¹è±¡è¿›è¡Œåˆ†ç±»ï¼Œä¸”è€å¯¹è±¡æ¯”å¹´è½»å¯¹è±¡å›æ”¶çš„é¢‘ç‡è¦ä½ã€‚ç”±äºå¹´è½»å¯¹è±¡æ¯”è€å¯¹è±¡æ›´å¿«åœ°å˜ä¸ºä¸å¯è®¿é—®ï¼Œå› æ­¤ç»“æœæ˜¯å¤§å¤šæ•°çš„å›æ”¶èŠ±è´¹çš„æ—¶é—´æ›´å°‘ã€‚ç³»ç»Ÿè¿˜ç»´æŠ¤ä¸€ä¸ªé™æ€ä»£ï¼ˆstatic generation, ç±»ä¼¼Javaçš„æ°¸ä¹…ä»£ï¼‰ï¼Œä¸ä¼šå¯¹æ­¤å­˜å‚¨è¿›è¡Œå›æ”¶ã€‚ä»…å½“å‹ç¼©å †ï¼ˆScompact_heapï¼‰æˆ–è¦collectçš„target-generation å‚æ•°ä¸ºstaticç¬¦å·æ—¶ï¼Œæ‰å°†å¯¹è±¡æ”¾å…¥é™æ€ä»£ä¸­ã€‚\néé™æ€ä»£çš„ç¼–å·ä»æœ€å¹´è½»çš„ä¸–ä»£ï¼ˆå¼€å§‹äº0ï¼‰åˆ°collect-maximum-generationçš„å½“å‰å€¼ã€‚å­˜å‚¨ç®¡ç†å™¨å°†æ–°åˆ†é…çš„å¯¹è±¡æ”¾å…¥ç¬¬0ä»£ã€‚åœ¨ç¬¬0ä»£çš„å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ç¬¬0ä»£çš„å¯¹è±¡æŒªåˆ°ç¬¬1ä»£ï¼Œç±»ä¼¼åœ°ï¼Œåœ¨ç¬¬1ä»£å›æ”¶æœŸé—´ï¼Œå­˜æ´»çš„ç¬¬0ä»£å’Œç¬¬1ä»£å¯¹è±¡ç§»åŠ¨åˆ°ç¬¬2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨æœ€å¤§éé™æ€å¯¹è±¡å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å¹¸å­˜çš„éé™æ€å¯¹è±¡éƒ½å°†ç§»åŠ¨ï¼ˆå¯èƒ½è¿”å›ï¼‰åˆ°æœ€å¤§éé™æ€ä»£ä¸­ã€‚ é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡æœ‰å¯èƒ½è·³è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ï¼Œä½†è¿™åœ¨è®¸å¤šå¯¹è±¡ä¸Šä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œå¹¶ä¸”å¦‚æœè¿™äº›å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œåˆ™æœ€ç»ˆå°†å›æ”¶å®ƒä»¬çš„å­˜å‚¨ã€‚\nç»´æŠ¤å†…éƒ¨è®¡æ•°å™¨gc-tripæ¥æ§åˆ¶ä½•æ—¶å›æ”¶æ¯ä¸€ä»£ã€‚ æ¯æ¬¡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collect æ—¶ï¼ˆä»é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºå¼€å§‹ï¼‰ï¼Œgc-tripéƒ½ä¼šåŠ 1ã€‚åœ¨collect-generationåŸºæ•°ä¸ºr çš„æƒ…å†µä¸‹ï¼Œå›æ”¶çš„ä¸–ä»£ç¼–å·ä¸ºg ï¼Œå…¶gc-tripæ˜¯$r^g$çš„å€æ•°ã€‚ å¦‚æœå°†collect-generation-radixè®¾ç½®ä¸º4ï¼Œåˆ™ç³»ç»Ÿå°†æ¯æ¬¡æ”¶é›†0ä»£ï¼Œæ¯4æ¬¡æ”¶é›†1ä»£ï¼Œæ¯16æ¬¡æ”¶é›†2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚\næ¯æ¬¡æŸä¸ªä¸–ä»£g è°ƒç”¨collectæ—¶ï¼Œè¯¥ä¸–ä»£g è¢«å›æ”¶ä¸”gc-tripå‰è¿›åˆ°ä¸‹ä¸ª$r^g$çš„è¾¹ç•Œï¼Œä½†æ˜¯ä¸ä¼šè¶…è¿‡$r^{g+1}$çš„è¾¹ç•Œï¼Œr ä¸å˜è¿˜æ˜¯collect-generation-radixçš„å€¼ã€‚\nå¦‚æœä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°tg è°ƒç”¨collectï¼Œåˆ™tg ç¡®å®šç›®æ ‡ä»£ã€‚ å½“g æ˜¯æœ€å¤§çš„éé™æ€ä»£æ—¶ï¼Œtg å¿…é¡»ä¸ºg æˆ–ä¸ºstaticã€‚ å¦åˆ™ï¼Œtg å¿…é¡»ä¸ºg æˆ–g + 1 ã€‚ å½“ç›®æ ‡ä»£æ˜¯staticç¬¦å·æ—¶ï¼Œéé™æ€ä»£ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å°†ç§»åŠ¨åˆ°é™æ€ä»£ä¸­ã€‚é™æ€ä»£ä¸­çš„å¯¹è±¡ä»ä¸ä¼šè¢«å›æ”¶ã€‚ è¿™åœ¨åŠ è½½å’Œåˆå§‹åŒ–åº”ç”¨ç¨‹åºçš„æ°¸ä¹…ä»£ç å’Œæ•°æ®ç»“æ„ä¹‹åéå¸¸æœ‰ç”¨ï¼Œä»¥å‡å°‘åç»­å›æ”¶çš„å¼€é”€ã€‚\né€šè¿‡è®¾ç½®æœ¬èŠ‚ä¸­æè¿°çš„å‚æ•°ï¼Œå¯ä»¥å¯¹å›æ”¶å™¨çš„è¡Œä¸ºè¿›è¡Œå®è´¨æ€§çš„è°ƒæ•´ã€‚é€šè¿‡é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºä¸”ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectï¼Œç”šè‡³æœ‰å¯èƒ½å®Œå…¨è¦†ç›–æ”¶é›†å™¨çš„é»˜è®¤ç­–ç•¥æ¥ç¡®å®šä½•æ—¶å›æ”¶æ¯ä¸ªä¸–ä»£ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectæ¥é‡æ–°å®šä¹‰å¤„ç†ç¨‹åºï¼Œä»¥åœ¨é•¿æ—¶é—´å†…å°†æœ€å¤§çš„éé™æ€ä»£è§†ä¸ºé™æ€ä»£ï¼Œè¯¥å‚æ•°åœ¨è¯¥æ—¶é—´æ®µå†…ç»ä¸ç­‰äºæœ€å¤§çš„éé™æ€ä»£ã€‚\n(collect) | (collect g) | (collect g tg)\ng å¿…é¡»æ˜¯ä¸å¤§äºæœ€å¤§éé™æ€ä»£ï¼ˆcollect-maximum-generationè¿”å›çš„å€¼ï¼‰çš„éè´Ÿç¡®å®šç¼–å·ã€‚ å¦‚æœg å·²ç»æ˜¯æœ€å¤§çš„éé™æ€ä»£ç¼–å·ï¼Œåˆ™tg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg çš„fixnumæˆ–staticç¬¦å·ã€‚ å¦åˆ™ï¼Œtg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg æˆ–å¤§äºg çš„fixnumã€‚\næ­¤è¿‡ç¨‹ä½¿å­˜å‚¨ç®¡ç†å™¨æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚ collectæ˜¯é€šè¿‡collect-requestå¤„ç†ç¨‹åºå®šæœŸè°ƒç”¨çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¾å¼è°ƒç”¨å®ƒï¼Œä»¥åœ¨ç‰¹å®šæ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨è®¡æ—¶è®¡ç®—ä¹‹å‰ï¼‰å¼ºåˆ¶è¿›è¡Œå›æ”¶ã€‚ åœ¨Chez Schemeçš„çº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼Œè°ƒç”¨collectçš„çº¿ç¨‹å¿…é¡»æ˜¯å”¯ä¸€çš„æ´»åŠ¨çº¿ç¨‹ã€‚\nç³»ç»Ÿå°†æ ¹æ®g å’Œtg ï¼ˆå¦‚æœæä¾›ï¼‰ç¡®å®šå›æ”¶å“ªäº›ä¸–ä»£ï¼Œå¦‚æœ¬èŠ‚çš„ä»‹ç»ä¸­æ‰€è¿°ã€‚\n(collect-rendezvous)\nè¯·æ±‚åƒåœ¾å›æ”¶çš„æ–¹å¼åº”è¯¥ä¸ç”±ç³»ç»Ÿè‡ªåŠ¨å‘èµ·çš„GCçš„æ–¹å¼ç›¸ä¸€è‡´ã€‚æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ç»è¿‡åè°ƒï¼Œä»¥ä¾¿å…¶ä¸­ä¸€ä¸ªè°ƒç”¨collect-requestå¤„ç†ç¨‹åºï¼Œè€Œå…¶ä»–çº¿ç¨‹æš‚åœç›´åˆ°å¤„ç†ç¨‹åºè¿”å›ã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœcollect-requestå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…collect-request-handlerï¼‰æ²¡æœ‰è°ƒç”¨collectï¼Œé‚£ä¹ˆcollect-rendezvouså®é™…ä¸Šä¸ä¼šæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚\ncollect-notify\nå¦‚æœå°†collect-notifyè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¯å½“è¿è¡ŒGCæ—¶ï¼Œå›æ”¶å™¨éƒ½ä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-notifyè®¾ç½®ä¸º#fã€‚\ncollect-trip-bytes\nChez Schemeåœ¨å†…éƒ¨ä»¥å¤§å—åˆ†é…å†…å­˜ï¼Œå¹¶é€šè¿‡å†…è”æ“ä½œå°†è¿™äº›å—ç»†åˆ†ä»¥æé«˜æ•ˆç‡ã€‚å­˜å‚¨ç®¡ç†å™¨ç¡®å®šæ˜¯å¦ä¸ºæ¯ä¸ªåˆ†é…çš„å¤§å—ä»…è¯·æ±‚ä¸€æ¬¡å›æ”¶ã€‚æ­¤å¤–ï¼Œåœ¨å­˜å‚¨ç®¡ç†å™¨è¯·æ±‚å›æ”¶å’Œå…‘ç°å›æ”¶è¯·æ±‚ä¹‹é—´å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå°¤å…¶æ˜¯å¦‚æœé€šè¿‡with-interrupts-disabledæˆ–disable-interruptsä¸´æ—¶ç¦ç”¨äº†ä¸­æ–­æ—¶ã€‚å› æ­¤ï¼Œcollect-trip-bytesä»…æ˜¯ä¸€ç§è¿‘ä¼¼åº¦é‡ã€‚\ncollect-generation-radix\næ­¤å‚æ•°ç¡®å®šé»˜è®¤æƒ…å†µä¸‹çš„collect-requestå¤„ç†ç¨‹åºè°ƒç”¨ä¸å¸¦å‚æ•°çš„collectæ—¶å›æ”¶æ¯ä¸€ä»£çš„é¢‘ç‡ã€‚æ¯$r^g$æ¬¡å‘ç”Ÿä¸€æ¬¡å¯¹åº”ä¸–ä»£çš„å›æ”¶ï¼Œå…¶ä¸­r æ˜¯collect-generation-radixçš„å€¼ï¼Œg æ˜¯ä¸–ä»£æ•°ã€‚\nå°†collect-generation-radixè®¾ç½®ä¸º1ä¼šå¼ºåˆ¶æ‰€æœ‰ä¸–ä»£æ¯æ¬¡éƒ½è¢«å›æ”¶ï¼Œ å°†collect-generation-radixè®¾ç½®ä¸ºéå¸¸å¤§çš„æ•°ç›®å°†æ— é™æœŸæœ‰æ•ˆåœ°å»¶è¿Ÿè¾ƒæ—©çš„ä¸€ä»£çš„å›æ”¶ã€‚\ncollect-maximum-generation\næ­¤å‚æ•°ç¡®å®šå½“å‰å¯ä»¥ä½¿ç”¨çš„æœ€å¤§éé™æ€ä¸–ä»£æ•°,å®ƒçš„å€¼æ˜¯1åˆ°254èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œä»…ä½¿ç”¨ä¸¤ä¸ªéé™æ€ç”Ÿæˆã€‚ è®¾ç½®ä¸º2æ—¶ï¼Œå°†ä½¿ç”¨ä¸‰ä¸ªéé™æ€ä¸–ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚ å½“è®¾ç½®ä¸º254æ—¶ï¼Œå°†ä½¿ç”¨255ä¸ªéé™æ€ä»£ï¼Œå†åŠ ä¸Šä¸€ä¸ªé™æ€ä»£ï¼Œæ€»å…±256ä¸ªä¸–ä»£ã€‚å¢åŠ ä¸–ä»£æ•°å¯ä»¥å‡å°‘äº†æ”¶é›†æ—§å¯¹è±¡çš„é¢‘ç‡ï¼Œæ½œåœ¨åœ°å‡å°‘äº†æ”¶é›†å¼€é”€ï¼Œä½†åŒæ—¶ä¹Ÿæ½œåœ¨åœ°å¢åŠ äº†ç³»ç»Ÿä¸­ä¿ç•™çš„ä¸å¯è®¿é—®å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œå¢åŠ äº†æ‰€éœ€çš„å†…å­˜æ€»é‡ã€‚\ncollect-request-handler\ncollect-request-handlerçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“ç³»ç»Ÿè®¤ä¸ºåº”è¯¥è¦è¿›è¡ŒGCæ—¶ï¼ˆå³ï¼Œè‡ªä¸Šæ¬¡GCä»¥æ¥ï¼Œç³»ç»Ÿåˆ†é…äº†ç”±å‚æ•°collect-trip-bytesè§„å®šçš„å­˜å‚¨é‡ä¹‹åï¼‰ï¼Œè¯¥è¿‡ç¨‹åœ¨ä¸å¸¦å‚æ•°çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-request-handlerä»…è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectã€‚ å¯ä»¥é€šè¿‡å°†collect-request-handlerè®¾ç½®ä¸ºä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„è¿‡ç¨‹æ¥ç¦ç”¨è‡ªåŠ¨æ”¶é›†ï¼Œä¾‹å¦‚ï¼š\n(collect-request-handler void) ä¹Ÿå¯ä»¥åˆ©ç”¨é˜²æ­¢ä»»ä½•ä¸­æ–­çš„critical-sectionæ¥ä¸´æ—¶ç¦ç”¨GC\nrelease-minimum-generation\næ­¤å‚æ•°çš„å€¼å¿…é¡»ä»‹äº0åˆ°collect-maximum-generationçš„å€¼ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹é—´ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºcollect-maximum-generationçš„å€¼ã€‚\nå½“åˆ†é…æ–°æ•°æ®ä¸”è¿›è¡ŒGCæ—¶ï¼Œstorage-managementä¼šè‡ªåŠ¨åœ°ä»æ“ä½œç³»ç»Ÿä¸­è¯·æ±‚é¢å¤–çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ç›¸åº”åœ°ï¼Œåœ¨å †æ˜¾è‘—å‡å°çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå°è¯•å°†å…ˆå‰ä»æ“ä½œç³»ç»Ÿè·å¾—çš„æŸäº›è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä»…åœ¨é’ˆå¯¹æœ€å¤§éé™æ€æ—¶ä»£çš„GCä¹‹åæ‰è¿™æ ·åšã€‚ä¹Ÿå¯ä»¥è®©ç³»ç»Ÿåœ¨å¯¹æ›´å¹´è½»çš„ä¸–ä»£å›æ”¶ä¹‹åå°±æ‰§è¡Œæ­¤æ“ä½œï¼Œæ–¹æ³•æ˜¯å°†release-minimum-generationçš„å€¼æ›´æ”¹ä¸ºå°äºcollect-maximum-generationçš„å€¼ã€‚ç”±å‚æ•°æŒ‡å®šçš„ä¸–ä»£ï¼Œæˆ–è€…ä»»ä½•è¾ƒè€çš„ä¸–ä»£æ˜¯GCçš„ç›®æ ‡ä¸–ä»£æ—¶ï¼Œå­˜å‚¨ç®¡ç†ç³»ç»Ÿå°†åœ¨GCä¹‹åå°è¯•å°†ä¸éœ€è¦çš„è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\nå½“collect-maximum-generationè®¾ç½®ä¸ºä¸€ä¸ªæ–°å€¼g æ—¶ï¼Œrelease-minimum-generationä¹ŸåŒæ—¶éšå¼åœ°æ›´æ”¹ä¸ºg ï¼Œæœ‰ä¸¤ä¸ªå‰æï¼šï¼ˆaï¼‰ä¿®æ”¹å‰è¿™ä¸¤ä¸ªå‚æ•°å…·æœ‰ç›¸åŒçš„å€¼ï¼›ï¼ˆbï¼‰release-minimum-generationçš„å€¼å¤§äºg\nheap-reserve-ratio\næ­¤å‚æ•°ç¡®å®šäº†ä¿ç•™çš„å†…å­˜çš„å¤§æ¦‚æ•°é‡ï¼ˆæ²¡æœ‰è¿”å›ç»™OSï¼Œå¦‚release-minimum-generationæ‰€æè¿°çš„ï¼‰ä¸å½“å‰å·²å ç”¨çš„å†…å­˜é‡ï¼ˆä¸åŒ…å«å·²å˜ä¸ºé™æ€çš„å†…å­˜åŒºåŸŸï¼‰çš„æ¯”ä¾‹ï¼Œå®ƒçš„å€¼å¿…é¡»æ˜¯ä¸ç²¾ç¡®çš„éè´Ÿæ•´æ•°å€¼ï¼› å¦‚æœè®¾ç½®ä¸ºç²¾ç¡®çš„å®æ•°å€¼ï¼Œåˆ™ç²¾ç¡®çš„å€¼å°†è½¬æ¢ä¸ºä¸ç²¾ç¡®çš„å€¼ã€‚é»˜è®¤å€¼1.0ï¼Œä¸ºæ¯ä¸ªå½“å‰å ç”¨çš„éé™æ€é¡µé¢ä¿ç•™ä¸€é¡µå†…å­˜ã€‚ å°†å…¶è®¾ç½®ä¸ºè¾ƒå°çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°çš„å¹³å‡è™šæ‹Ÿå†…å­˜å ç”¨é‡ï¼Œè€Œå°†å…¶è®¾ç½®ä¸ºè¾ƒå¤§çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°‘çš„æ“ä½œç³»ç»Ÿè°ƒç”¨ä»¥è¯·æ±‚å’Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚\nå¼±åºå¯¹ï¼Œæš‚æ—¶åºå¯¹å’Œå®ˆæŠ¤è€…Weak Pairs, Ephemeron Pairs, and Guardians weak pairså…è®¸ç¨‹åºç»´æŠ¤æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆã€‚ æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆä¸ä¼šé˜»æ­¢å­˜å‚¨ç®¡ç†ç³»ç»Ÿå›æ”¶è¯¥å¯¹è±¡ï¼Œä½†æ˜¯åªè¦è¯¥å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æ˜¯å¯è®¿é—®çš„ï¼Œå®ƒä»ç„¶æœ‰æ•ˆã€‚\nephemeron pairsä¸weak pairsç±»ä¼¼ï¼Œä½†æ˜¯ephemeron pairsæ‹¥æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œå…¶ä¸­ä»…ä»…åœ¨ç¬¬ä¸€ä¸ªæŒ‡é’ˆå­˜åœ¨çš„æƒ…å†µç¬¬äºŒä¸ªæŒ‡é’ˆæ‰èƒ½å­˜åœ¨\nguardianså…è®¸ç¨‹åºä¿æŠ¤å¯¹è±¡å…é­åƒåœ¾å›æ”¶å™¨çš„é‡åˆ†é…ï¼Œå¹¶ç¡®å®šè¯¥å¯¹è±¡ä½•æ—¶è¢«é‡æ–°åˆ†é…ã€‚\nweak paris, ephemeron pairs å’Œguardianså…è®¸ç¨‹åºå°†æœ‰å…³å¯¹è±¡çš„ä¿¡æ¯ä¿ç•™åœ¨å•ç‹¬çš„æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚å“ˆå¸Œè¡¨ï¼‰ä¸­ï¼Œè€Œæ— éœ€æ‹…å¿ƒç»´æŠ¤æ­¤ä¿¡æ¯å°†å¯¼è‡´å¯¹è±¡æ— é™æœŸåœ°ä¿ç•™åœ¨ç³»ç»Ÿä¸­ã€‚\nå¦å¤–ï¼Œguardianså…è®¸æ— é™æœŸåœ°ä»é‡Šæ”¾å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥é‡ç”¨å®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨å¯¹è±¡ä¸­çš„æ•°æ®æ‰§è¡Œæ¸…ç†æˆ–å…¶ä»–æ“ä½œã€‚\n(weak-cons obj1 obj2)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„å¼±åºå¯¹\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚å¼±åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\nå¼±åºå¯¹å¯ä»¥ä½¿ç”¨**weak-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ å¼±åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆ å¼±åºå¯¹çš„carä¸­çš„å¼±æŒ‡é’ˆå°±åƒæ™®é€šæŒ‡é’ˆä¸€æ ·ï¼Œåªè¦å®ƒæŒ‡å‘çš„å¯¹è±¡å¯ä»¥é€šè¿‡ç³»ç»Ÿä¸­æŸä¸ªåœ°æ–¹çš„æ™®é€šï¼ˆéå¼±ï¼‰æŒ‡é’ˆè®¿é—®å³å¯ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåƒåœ¾æ”¶é›†å™¨åœ¨æŸä¸ªæ—¶å€™è¯†åˆ«å‡ºä¸å­˜åœ¨æŒ‡å‘è¯¥å¯¹è±¡çš„éå¼±æŒ‡é’ˆï¼Œåˆ™å®ƒå°†æ¯ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„å¼±æŒ‡é’ˆæ›¿æ¢ä¸ºâ€œ broken weak-pointerâ€å¯¹è±¡**#!bwp**ï¼Œå¹¶ä¸¢å¼ƒè¯¥å¯¹è±¡ã€‚\nå¼±åºå¯¹çš„cdrå­—æ®µä¸æ˜¯å¼±æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¼±åºå¯¹æ¥æ„é€ å¼±ä¿æŒå¯¹è±¡çš„åˆ—è¡¨ã€‚å¯ä»¥åƒä½¿ç”¨æ™®é€šçš„åˆ—è¡¨çš„å¤„ç†æ“ä½œï¼ˆä¾‹å¦‚lengthï¼Œmapå’Œassvï¼‰æ¥æ“ä½œè¿™äº›listã€‚å¼±åºå¯¹å¯ä»¥ä½¿ç”¨set-car!å’Œset-cdr!æ¥ä¿®æ”¹ï¼› åœ¨set-car!ä¹‹åï¼Œcarå­—æ®µåŒ…å«æŒ‡å‘æ–°å¯¹è±¡çš„å¼±æŒ‡é’ˆï¼Œä»£æ›¿äº†æ—§å¯¹è±¡ã€‚å¼±åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ç›¸åŒã€‚ å¼±åºå¯¹æ²¡æœ‰readerè¯­æ³•ã€‚å¼±åºå¯¹åœ¨è¢«å†™å…¥ç„¶åè¢«è¯»å–æ—¶æˆä¸ºæ™®é€šå¯¹ã€‚\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (car p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (weak-pair? obj)\n(weak-pair? (weak-cons â€™a â€™b)) â‡’ #t (weak-pair? (cons â€™a â€™b)) â‡’ #f (weak-pair? \u0026#34;oops\u0026#34;) â‡’ #f (ephemeron-cons obj1 obj2)\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚æš‚æ—¶åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\næš‚æ—¶åºå¯¹å¯ä»¥ä½¿ç”¨**ephemeron-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ æš‚æ—¶åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆï¼Œå¹¶ä¸”ä»…ä»…åœ¨pairçš„carå­˜åœ¨æ—¶cdræ‰èƒ½ä¿ç•™ æš‚æ—¶åºå¯¹çš„è¡Œä¸ºä¸å¼±åºå¯¹ç±»ä¼¼ï¼Œä¸è¿‡cdræœ‰ç‰¹æ®Šçš„å¤„ç†ï¼šå¦‚æœcarè¢«è®¾ç½®ä¸º**#!bwpçš„åŒæ—¶ä¹Ÿä¼šå°†cdrè®¾ç½®ä¸º#!bwp**ã€‚ç”±äºåŒæ—¶å°†carå’Œcdrå­—æ®µè®¾ç½®ä¸ºä¸º**#!bwp**ï¼Œå› æ­¤å¯ä»¥é€šè¿‡cdrå¯¹è±¡å¼•ç”¨carå¯¹è±¡è¿™ä¸€äº‹å®æœ¬èº«å¹¶ä¸æ„å‘³ç€å¿…é¡»ä¿ç•™carï¼ˆä¸å¼±åºå¯¹ä¸åŒï¼‰ã€‚ ç›¸åï¼Œå‡ºäºæŸç§åŸå› ï¼Œcarå¿…é¡»ç‹¬ç«‹äºcdrå¯¹è±¡ä¿å­˜ã€‚\nä¸å¼±åºå¯¹å’Œå…¶ä»–å¯¹ä¸€æ ·ï¼Œæš‚æ—¶åºå¯¹ä½¿ç”¨**set-car!å’Œset-cdr!**æ¥ä¿®æ”¹æ•°æ®ï¼Œæš‚æ—¶åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ä¸€æ ·ï¼Œä½†æ²¡æœ‰readerè¯­æ³•\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (cdr p) â‡’ #!bwp (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x x)) ; not an ephemeron pair (set! x \u0026#39;*) (collect) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) ä¸å¼±åºå¯¹ä¸€æ ·ï¼Œå¦‚æœåœ¨å°†xè®¾ç½®ä¸º*ä¹‹å‰è¿›è¡Œäº†åƒåœ¾å›æ”¶å°†è¯¥pairæå‡ä¸ºè¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™ä¸Šé¢ä¸­é—´ç¤ºä¾‹çš„æœ€åä¸¤ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šå¯èƒ½è¿”å›ï¼ˆa . bï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸Šé¢çš„æœ€åä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæœ€åä¸¤ä¸ªè¡¨è¾¾å¼çš„ç»“æœå°†å§‹ç»ˆä¸ºï¼ˆa . bï¼‰ï¼Œå› ä¸ºå¼±åºå¯¹çš„cdræŒæœ‰éå¼±å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥éå¼±å¼•ç”¨é˜»æ­¢carå­—æ®µå˜** #!bwp**ã€‚\n(ephemeron-pair? obj)\n(ephemeron-pair? (ephemeron-cons \u0026#39;a \u0026#39;b)) â‡’ #t (ephemeron-pair? (cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? (weak-cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? \u0026#34;oops\u0026#34;) â‡’ #f (bwp-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯æ–­å¼€çš„broken weak-pairå¯¹è±¡ï¼Œåˆ™è¿”å›#tï¼Œå¦åˆ™è¿”å›#f\n(bwp-object? #!bwp) â‡’ #t (bwp-object? \u0026#39;bwp) â‡’ #f (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect (collect-maximum-generation)) (car p) â‡’ #!bwp (bwp-object? (car p)) â‡’ #t (make-guardian)\nGuardiansç”±è¦ä¿æŠ¤çš„å¯¹è±¡ç»„çš„è¿‡ç¨‹è¡¨ç¤ºã€‚åˆ›å»ºguardianåï¼Œæ³¨å†Œå¯¹è±¡ç»„ä¸ºç©ºã€‚ é€šè¿‡å°†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ˆæŠ¤è€…ï¼Œå¯ä»¥å‘guardianæ³¨å†Œå¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) x â‡’ (aaa . bbb) (G x) æ³¨å†Œå¯¹è±¡æ—¶ä¹Ÿå¯ä»¥æŒ‡å®šâ€œrepresentativeâ€ï¼ˆå³ï¼Œyï¼‰å¯¹è±¡ã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(define y (cons \u0026#39;ccc \u0026#39;ddd)) y â‡’ (ccc . ddd) (G y \u0026#39;rep) ä¸å®ˆæŠ¤è€…å…³è”çš„ä¸€ç»„æ³¨å†Œå¯¹è±¡åœ¨é€»è¾‘ä¸Šç»†åˆ†ä¸ºä¸¤ä¸ªä¸ç›¸äº¤çš„å­ç»„ï¼šä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œå¯è®¿é—®â€å¯¹è±¡ï¼Œä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œä¸å¯è®¿é—®â€å¯¹è±¡ã€‚ä¸å¯è®¿é—®çš„å¯¹è±¡æ˜¯å·²è¢«è¯æ˜æ— æ³•è®¿é—®çš„å¯¹è±¡ï¼ˆé€šè¿‡guardianæœºåˆ¶æœ¬èº«æˆ–é€šè¿‡å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µé™¤å¤–ï¼‰ï¼Œå¯è®¿é—®çš„å¯¹è±¡æ˜¯æœªç»è¯æ˜çš„å¯¹è±¡ã€‚â€œå·²è¯æ˜â€ä¸€è¯åœ¨è¿™é‡Œå¾ˆé‡è¦ï¼šå¯èƒ½æ˜¯å¯è®¿é—®ç»„ä¸­çš„æŸäº›å¯¹è±¡ç¡®å®æ˜¯ä¸å¯è®¿é—®çš„ï¼Œä½†è¿™å°šæœªå¾—åˆ°è¯æ˜ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç›´åˆ°å¯¹è±¡å®é™…ä¸Šå˜å¾—ä¸å¯è®¿é—®å¾ˆä¹…ä¹‹åï¼ˆåœ¨å½“å‰å®ç°ä¸­ï¼Œç›´åˆ°å‘ç”ŸåŒ…å«å¯¹è±¡çš„ä¸–ä»£çš„åƒåœ¾å›æ”¶ï¼‰ï¼Œæ‰å¯èƒ½åšå‡ºè¿™ç§è¯æ˜ã€‚\nå‘guardianæ³¨å†Œçš„å¯¹è±¡æœ€åˆè¢«æ”¾ç½®åœ¨å¯è®¿é—®ç»„ä¸­ï¼Œå¹¶åœ¨å®ƒä»¬å˜å¾—ä¸å¯è®¿é—®åçš„æŸä¸ªæ—¶åˆ»ç§»å…¥ä¸å¯è®¿é—®ç»„ã€‚ ä¸å¯è®¿é—®ç»„ä¸­çš„å¯¹è±¡æ˜¯é€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„guardianæ¥æ£€ç´¢çš„ã€‚ å¦‚æœä¸å¯è®¿é—®ç»„ä¸­æ²¡æœ‰å¯¹è±¡ï¼Œåˆ™guardianè¿”å›#fã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(G) â‡’ #f (set! x #f) (set! y #f) (collect) (G) â‡’ (aaa . bbb) ; ä¹Ÿæœ‰å¯èƒ½è¿™ä¸ªåæ‰“å°å‡ºæ¥ (G) â‡’ rep ; è¿™ä¸ªå…ˆæ‰“å°å‡ºæ¥ (G) â‡’ #f å¯¹Gçš„åˆå§‹è°ƒç”¨è¿”å›#fï¼Œå› ä¸ºç»‘å®šåˆ°xå’Œyçš„å¯¹æ˜¯å‘Gæ³¨å†Œçš„å”¯ä¸€å¯¹è±¡ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥é€šè¿‡è¿™äº›ç»‘å®šè®¿é—®è¿™äº›åºå¯¹ã€‚è°ƒç”¨collectæ—¶ï¼Œå¯¹è±¡å°†ç§»å…¥ä¸å¯è®¿é—®çš„ç»„ã€‚ å› æ­¤ï¼Œå¯¹Gçš„ä¸¤ä¸ªè°ƒç”¨è¿”å›å…ˆå‰ç»‘å®šåˆ°xçš„åºå¯¹å’Œå…ˆå‰ç»‘å®šåˆ°yçš„åºå¯¹çš„representativeï¼Œå°½ç®¡å¯èƒ½ä¸æ‰€ç¤ºé¡ºåºç›¸åã€‚ ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºå¼±åºå¯¹ï¼Œå¦‚æœå¯¹è±¡å·²è¿ç§»åˆ°è¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™è°ƒç”¨collectå®é™…ä¸Šå¯èƒ½ä¸è¶³ä»¥è¯æ˜è¯¥å¯¹è±¡ä¸å¯è®¿é—®ã€‚ï¼‰\nå®é™…ä¸Šï¼Œä»guardiané‚£é‡Œè·å–çš„å¯¹è±¡åœ¨ä»»ä½•æ–¹é¢éƒ½æ²¡æœ‰ç‰¹æ®Šçš„åœ°ä½ã€‚ æ­¤åŠŸèƒ½é¿å…äº†å…±äº«æˆ–å¾ªç¯ç»“æ„å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ã€‚ ç”±ä¸å¯è®¿é—®å¯¹è±¡ç»„æˆçš„å…±äº«æˆ–å¾ªç¯ç»“æ„å°†è¢«å®Œæ•´ä¿ç•™ï¼Œå°†æ³¨å†Œç”±guardianä¿æŠ¤çš„éƒ¨åˆ†éƒ½æ”¾ç½®åœ¨è¯¥guardianä¸å¯è®¿é—®çš„é›†åˆä¸­ã€‚ ç„¶åï¼Œç¨‹åºå‘˜å¯ä»¥å®Œå…¨æ§åˆ¶ç»“æ„çš„å¤„ç†é¡ºåºã€‚\nä¸€ä¸ªå¯¹è±¡å¯ä»¥åœ¨guardianå¤„å¤šæ¬¡æ³¨å†Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤šæ¬¡æ£€ç´¢è¯¥å¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (G x) (G x) (set! x #f) (collect) (G) â‡’ (aaa . bbb) (G) â‡’ (aaa . bbb) å®ƒä¹Ÿå¯ä»¥å‘ä¸æ­¢ä¸€ä¸ªguardianæ³¨å†Œï¼Œå¹¶ä¸”guardianæœ¬èº«ä¹Ÿå¯ä»¥å‘å…¶ä»–guardianæ³¨å†Œã€‚ åœ¨æ²¡æœ‰â€œrepresentativeâ€çš„æƒ…å†µä¸‹å‘guardianæ³¨å†Œçš„å¯¹è±¡ï¼Œå¹¶æ”¾ç½®åœ¨ä¸€ä¸ªå¼±åºå¯¹æˆ–æš‚æ—¶å¯¹çš„carå­—æ®µä¸­ï¼Œå…¶ç›´åˆ°ä»guardianå¤„å°†è¿”å›å¹¶ç”±ç¨‹åºä¸¢å¼ƒï¼Œæˆ–è€…ç›´åˆ°guardianæœ¬èº«è¢«ä¸¢å¼ƒä¸ºæ­¢ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (collect) (set! y (G)) y â‡’ (aaa . bbb) (car p) â‡’ (aaa . bbb) (set! y #f) (collect 1) (car p) â‡’ #!bwp å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæŒ‡å®šäº†representativeï¼ˆå¯¹è±¡æœ¬èº«é™¤å¤–ï¼‰ï¼Œåˆ™åœ¨ä»guardianå¤„è·å¾—representativeçš„åŒæ—¶ï¼Œä¹Ÿä¼šä»å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µä¸­ä¸¢å¼ƒå—ä¿æŠ¤çš„å¯¹è±¡ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x \u0026#39;rep) (set! x #f) (collect) (G) â‡’ rep ; è·å¾—representativeçš„å€¼ (car p) â‡’ #!bwp ; è‡ªåŠ¨ä¸¢å¼ƒ ä¸‹é¢çš„ç¤ºä¾‹è¯´æ˜äº†å½“guardianæœ¬èº«ä¸¢å¼ƒæ—¶ï¼Œè¯¥å¯¹è±¡å·²è¢«é‡Šæ”¾å¹¶ä¸”å¼±åºå¯¹çš„carå­—æ®µè®¾ç½®ä¸º#!bwpï¼š\n(define G (make-guardian)) (define x (cons aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (set! G #f) (collect) (car p) â‡’ #!bwp ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨guardianæ¥é‡Šæ”¾å¤–éƒ¨å­˜å‚¨ï¼Œå°±åƒç”±Cåº“â€œmallocâ€å’Œâ€œfreeâ€æ“ä½œç®¡ç†å­˜å‚¨ã€‚\n(define malloc (let ([malloc-guardian (make-guardian)]) (lambda (size) ; first free any storage that has been dropped. to avoid long ; delays, it might be better to deallocate no more than, say, ; ten objects for each one allocated (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f)))) ; then allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x)))) do-mallocå¿…é¡»è¿”å›ä¸€ä¸ªSchemeå¯¹è±¡â€œheaderâ€ï¼Œè¯¥headerå°è£…ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆï¼ˆå¯èƒ½æ˜¯æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡æ­¤headerå¯¹å¤–éƒ¨å­˜å‚¨è¿›è¡Œæ‰€æœ‰è®¿é—®ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¿…é¡»æ³¨æ„åœ¨åˆ é™¤ç›¸åº”çš„headerä¹‹åï¼Œåœ¨Schemeä¹‹å¤–ä¸å­˜åœ¨æŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆã€‚ do-freeå¿…é¡»ä½¿ç”¨å°è£…çš„æŒ‡é’ˆé‡Šæ”¾å¤–éƒ¨å­˜å‚¨ã€‚è¿™ä¸¤ä¸ªåŸè¯­éƒ½å¯ä»¥ä½¿ç”¨å¤–éƒ¨åˆ†é…å’Œå¤–éƒ¨æ— å…³çš„å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¤–éƒ¨è¿‡ç¨‹å¯¼å…¥çš„Cåº“â€œmallocâ€å’Œâ€œfreeâ€è¿ç®—ç¬¦è¿›è¡Œå®šä¹‰ã€‚\nå¦‚æœä¸å¸Œæœ›è°ƒç”¨mallocæ¥é‡Šæ”¾å­˜å‚¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨collect-requestå¤„ç†å™¨æ¥æ£€æŸ¥å¹¶é‡Šæ”¾å·²ä¸¢å¼ƒçš„å­˜å‚¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define malloc) (let ([malloc-guardian (make-guardian)]) (set! malloc (lambda (size) ; allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x))) (collect-request-handler (lambda () ; first, invoke the collector (collect) ; then free any storage that has been dropped (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f))))))) é€šè¿‡ä¸€ç‚¹é‡æ„ï¼Œå°±æœ‰å¯èƒ½å°†å°è£…çš„å¤–éƒ¨åœ°å€æ³¨å†Œä¸ºå¸¦headerçš„representativeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdo-freeå°†ä»…å°†å¤–éƒ¨åœ°å€ä½œä¸ºå‚æ•°ã€‚ è¿™å°†ä½¿æ ‡å¤´ä¸€æ—¦å˜å¾—ä¸å¯è®¿é—®ï¼Œä¾¿å¯ä»¥å°†å…¶ä»Schemeå †ä¸­åˆ é™¤ã€‚\né”å¯¹è±¡Locking Objects æ¥è‡ªCè¯­è¨€çš„å˜é‡æˆ–æ•°æ®ç»“æ„åˆ°Schemeå¯¹è±¡çš„æ‰€æœ‰æŒ‡é’ˆï¼Œé€šå¸¸åº”åœ¨è¾“å…¥ï¼ˆæˆ–é‡æ–°è¾“å…¥ï¼‰Schemeä¹‹å‰ä¸¢å¼ƒã€‚ å½“æ— æ³•éµå¾ªè¯¥å‡†åˆ™æ—¶ï¼Œå¯ä»¥é€šè¿‡é”å®šå¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Slock_objecté”å®šè¯¥å¯¹è±¡ã€‚\n(lock-object obj)\né”å®šå¯¹è±¡å¯é˜²æ­¢å­˜å‚¨ç®¡ç†å™¨æ”¶å›æˆ–é‡å®šä½è¯¥å¯¹è±¡ã€‚ åº”è°¨æ…ä½¿ç”¨é”å®šï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡å¹¶å¢åŠ å­˜å‚¨ç®¡ç†å¼€é”€ã€‚\nå¦‚æœæœªè§£é”å¯¹è±¡ï¼Œé”å®šä¹Ÿä¼šå¯¼è‡´æ„å¤–ä¿ç•™å­˜å‚¨ç©ºé—´ã€‚ å¯ä»¥é€šè¿‡è§£é”å¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Sunlock_objectæ¥è§£é”å¯¹è±¡ã€‚\né”å®šç«‹å³æ•°ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è¢«é™æ€åŒ–çš„å¯¹è±¡æ˜¯ä¸å¿…è¦ä½†æ— å®³çš„ã€‚\n(unlock-object obj)\né€šè¿‡è¿ç»­è°ƒç”¨lock-objectï¼ŒSlock_objectæˆ–åŒæ—¶è°ƒç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¤šæ¬¡é”å®šå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å…ˆé€šè¿‡ç›¸ç­‰æ¬¡æ•°çš„å¯¹unlock-objectæˆ–Sunlock_objectçš„è°ƒç”¨æ¥å°†å…¶è§£é”ã€‚\né™¤éå­˜åœ¨æŒ‡å‘å¯¹è±¡çš„å•ç‹¬çš„CæŒ‡é’ˆï¼Œå¦åˆ™ä¹Ÿæ— éœ€é”å®šåŒ…å«åœ¨é”å®šå¯¹è±¡ä¸­çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œé”å®šåºå¯¹çš„carä¸­çš„å¯¹è±¡ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»…å…è®¸é€šè¿‡å¤–éƒ¨å¯¹è±¡æ¥é—´æ¥è®¿é—®çš„å†…éƒ¨å¯¹è±¡ï¼Œåˆ™åº”å°†å…¶è§£é”ï¼Œä»¥ä¾¿å›æ”¶å™¨åœ¨å›æ”¶æœŸé—´å¯ä»¥è‡ªç”±åœ°é‡åˆ†é…å®ƒã€‚\nè§£é”ç«‹å³å€¼ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è®¾ä¸ºé™æ€çš„å¯¹è±¡æ˜¯ä¸å¿…è¦çš„ï¼Œæ— æ•ˆçš„ï¼Œä½†æ— å®³ã€‚\n(locked-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯é”å®šçš„ï¼Œç«‹å³çš„æˆ–é™æ€çš„ï¼Œè¿”å›#t\nå¦‚æœå›æ”¶å™¨æ— æ³•é‡åˆ†é…æˆ–å›æ”¶objï¼Œåˆ™è¯¥è°“è¯å°†è¿”å›trueï¼ŒåŒ…æ‹¬ç«‹å³å€¼ï¼Œä¾‹å¦‚fixnumsï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ä»¥åŠå·²è®¾ä¸ºé™æ€çš„å¯¹è±¡ã€‚\n","id":19,"section":"posts","summary":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨","tags":["scheme"],"title":"å­˜å‚¨ç®¡ç†(Storage Management in Chez Scheme)","uri":"https://lvsq.net/2020/02/storage-management/","year":"2020"},{"content":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;)\nè¿”å›ï¼šæœªæŒ‡å®š\nè­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢ç¨‹åºç»§ç»­è¿è¡Œä½†å¯èƒ½åœ¨ä»¥åå¯¼è‡´æ›´ä¸¥é‡é—®é¢˜çš„æƒ…å†µã€‚ é€šå¸¸æœ€å¥½æ˜¯è¯†åˆ«ç¨‹åºå‘˜å·²è°ƒç”¨çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜å¯èƒ½ä¸çŸ¥é“çš„å…¶ä»–è¿‡ç¨‹ã€‚ msgå¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶åº”æè¿°å¼‚å¸¸æƒ…å†µã€‚irritantå¯ä»¥æ˜¯ä»»ä½•Schemeå¯¹è±¡ï¼Œå¹¶ä¸”åº”åŒ…å«å¯èƒ½å¯¼è‡´æˆ–ä¸¥é‡æ¶‰åŠå¼‚å¸¸æƒ…å†µçš„å€¼ã€‚\n(assertion-violationf who msg irritant \u0026hellip;) | (errorf who msg irritant \u0026hellip;) | (warningf who msg irritant \u0026hellip;)\nè¿™äº›è¿‡ç¨‹ç±»ä¼¼äºassertion-violation, error, warning, æ‰€ä¸åŒçš„åœ¨äº msg è®¾å®šä¸ºä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²\nä¸­æ–­ Chez Schemeå…è®¸ç¨‹åºåœ¨å‘ç”Ÿå„ç§äº‹ä»¶æ—¶æ§åˆ¶Schemeç³»ç»Ÿçš„æ“ä½œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬é”®ç›˜ä¸­æ–­ï¼Œç”±set-timerè®¾ç½®çš„å†…éƒ¨è®¡æ—¶å™¨åˆ°æœŸï¼Œç”±ä¸­æ–­è°ƒç”¨å¼•å‘çš„æ–­ç‚¹æˆ–è€…æ¥è‡ªå­˜å‚¨ç®¡ç†å™¨çš„è¯·æ±‚å¯åŠ¨GCã€‚\næ— è®ºä½•æ—¶breakè¢«è°ƒç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šç«‹å³å¯ç”¨ä¸­æ–­å¤„ç†ç¨‹åº\n(break who msg irritant \u0026hellip;) | (break who) | (break)\nbreakå‚æ•°éµå¾ªä¸Šè¿°errorfçš„åè®®ã€‚é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆè¯·å‚è§break-handlerï¼‰æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯å¹¶è°ƒç”¨è°ƒè¯•å™¨ã€‚å¯ä»¥çœç•¥æ ¼å¼å­—ç¬¦ä¸²å’Œå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºå‘å‡ºçš„æ¶ˆæ¯ä½¿ç”¨whoå‚æ•°æ ‡è¯†ä¸­æ–­ï¼Œä½†ä¸æä¾›æœ‰å…³ä¸­æ–­çš„æ›´å¤šä¿¡æ¯ã€‚å¦‚æœä¹Ÿçœç•¥äº†whoå‚æ•°ï¼Œåˆ™ä¸ä¼šç”Ÿæˆä»»ä½•æ¶ˆæ¯ã€‚å¦‚æœè°ƒè¯•å™¨æ­£å¸¸é€€å‡ºï¼Œåˆ™é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºå°†æ­£å¸¸è¿”å›ã€‚\nbreak-handler\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“å‰çš„ä¸­æ–­å¤„ç†ç¨‹åºç”±breakè°ƒç”¨ï¼Œå®ƒä¼ é€’å…¶å‚æ•°ã€‚æœ‰å…³é»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºçš„æè¿°ï¼Œè¯·å‚è§breakã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ç¦ç”¨breaksã€‚\n(break-handler (lambda args (void))) (set-timer n)\nn å¿…é¡»ä¸ºéè´Ÿæ•´æ•°ã€‚å½“n ä¸ºéé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å¯åŠ¨ä¸€ä¸ªå†…éƒ¨è®¡æ—¶å™¨ï¼Œå…¶åˆå§‹å€¼ä¸ºnã€‚ç»è¿‡nä¸ªtickåï¼Œå°†å‘ç”Ÿè®¡æ—¶å™¨ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´è®¡æ—¶å™¨ä¸­æ–­å¤„ç†ç¨‹åºè¢«è°ƒç”¨ã€‚tickä¸æ˜¯ç»Ÿä¸€çš„æ—¶é—´å•ä½ï¼Œè€Œæ˜¯åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ¯ä¸ªè¿‡ç¨‹è°ƒç”¨è¦å®Œæˆå¤šå°‘å·¥ä½œã€‚\nå½“nä¸ºé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å…³é—­è®¡æ—¶å™¨ã€‚\nengineæœºåˆ¶å»ºç«‹åœ¨è®¡æ—¶å™¨ä¸­æ–­ä¹‹ä¸Šï¼Œå› æ­¤ä¸åº”ä¸engineå…±åŒä½¿ç”¨ã€‚\n(register-signal-handler sig procedure)\nregister-signal-handlerç”¨äºä¸ºç»™å®šçš„åº•å±‚ä¿¡å·å»ºç«‹ä¿¡å·å¤„ç†ç¨‹åºã€‚ sigå¿…é¡»æ˜¯æ ‡è¯†æœ‰æ•ˆä¿¡å·çš„ç²¾ç¡®æ•´æ•°ï¼Œè¿‡ç¨‹åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚åœ¨æ³¨å†Œäº†ç»™å®šsignalçš„å¤„ç†ç¨‹åºä¹‹åï¼Œæ”¶åˆ°äº†ç»™å®šçš„signalä¼šè°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚signalç¼–å·ä¼šä¼ é€’ç»™è¯¥å¤„ç†ç¨‹åºï¼Œä»è€Œå…è®¸åŒä¸€å¤„ç†ç¨‹åºç”¨äºä¸åŒçš„ä¿¡å·ï¼ŒåŒæ—¶åŒºåˆ†å®ƒä»¬ã€‚\nä»¥è¿™ç§æ–¹å¼å¤„ç†çš„ä¿¡å·ç±»ä¼¼äºé”®ç›˜ä¸­æ–­ï¼Œå› ä¸ºåœ¨å°†ä¿¡å·ä¼ é€’åˆ°è¿›ç¨‹æ—¶ä¸ä¼šç«‹å³è°ƒç”¨å¤„ç†ç¨‹åºï¼Œè€Œæ˜¯åœ¨ä¿¡å·ä¼ é€’ååœ¨æŸä¸ªè¿‡ç¨‹è°ƒç”¨è¾¹ç•Œå¤„è°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚å› æ­¤ï¼Œä¸ºå†…å­˜æ•…éšœï¼Œéæ³•æŒ‡ä»¤ç­‰å»ºç«‹å¤„ç†ç¨‹åºé€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå¯¼è‡´æ•…éšœæˆ–éæ³•æŒ‡ä»¤çš„ä»£ç å°†åœ¨è°ƒç”¨å¤„ç†ç¨‹åºä¹‹å‰ç»§ç»­æ‰§è¡Œï¼ˆå¯èƒ½æ˜¯é”™è¯¯çš„ï¼‰ä¸€æ®µæ—¶é—´ã€‚\nå¦å¤–ï¼Œä»…åœ¨åŸºäºUnixçš„ç³»ç»Ÿä¸Šæ‰æ”¯æŒregister-signal-handlerã€‚\nç¯å¢ƒ ç¯å¢ƒæ˜¯åŒ…å«æ ‡è¯†ç¬¦ç»‘å®šçš„é¡¶çº§ï¼ˆfirst-classï¼‰å¯¹è±¡ã€‚å®ƒä»¬ç±»ä¼¼äºæ¨¡å—ï¼Œä½†æ˜¯ä¸æ¨¡å—ä¸åŒï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ“ä½œã€‚ç¯å¢ƒå¯ä»¥ä½œä¸ºevalï¼Œexpandä»¥åŠè¿‡ç¨‹çš„å®šä¹‰ï¼Œåˆ†é…æˆ–å¼•ç”¨é¡¶çº§å€¼çš„å¯é€‰å‚æ•°ã€‚\næœ‰å‡ ç§å†…ç½®ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤åˆ¶ç°æœ‰ç¯å¢ƒæˆ–ä»ç°æœ‰ç¯å¢ƒä¸­é€‰æ‹©çš„ç»‘å®šæ¥åˆ›å»ºæ–°ç¯å¢ƒã€‚\nç¯å¢ƒå¯ä»¥æ˜¯å¯å˜çš„æˆ–ä¸å˜çš„ã€‚å¯å˜çš„ç¯å¢ƒå¯ä»¥ä½¿ç”¨æ–°çš„ç»‘å®šè¿›è¡Œæ‰©å±•ï¼Œå¯ä»¥ä¿®æ”¹å…¶ç°æœ‰ç»‘å®šï¼Œè¿˜å¯ä»¥åˆ†é…å…¶å˜é‡ã€‚ä¸å˜çš„ç¯å¢ƒä¸èƒ½ä»¥ä»»ä½•è¿™äº›æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚\nè”æƒ³ä¸€ä¸‹SICPä¸­å…³äºç¯å¢ƒçš„å†…å®¹ (environment? obj)\n(environment? (interaction-environment)) â‡’ #t (environment? \u0026#39;interaction-environment) â‡’ #f (environment? (copy-environment (scheme-environment))) â‡’ #t (environment? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #t (environment-mutable? env)\n(environment-mutable? (interaction-environment)) â‡’ #t (environment-mutable? (scheme-environment)) â‡’ #f (environment-mutable? (copy-environment (scheme-environment))) â‡’ #t (environment-mutable? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #f (scheme-environment)\nscheme-environmentè¿”å›ä¸€ä¸ªåŒ…å«åˆå§‹é¡¶çº§ç»‘å®šçš„ç¯å¢ƒã€‚è¯¥ç¯å¢ƒå¯¹åº”äºSchemeæ¨¡å—ã€‚æ­¤è¿‡ç¨‹è¿”å›çš„ç¯å¢ƒæ˜¯ä¸å¯å˜çš„ã€‚\n(define cons 3) (top-level-value \u0026#39;cons (scheme-environment)) â‡’ #\u0026lt;procedure cons\u0026gt; (set-top-level-value! \u0026#39;cons 3 (scheme-environment)) â‡’ exception (copy-environment env) | (copy-environment env mutable?) | (copy-environment env mutable? syms)\ncopy-environmentè¿”å›envçš„å‰¯æœ¬ï¼Œå³åŒ…å«ä¸env ç›¸åŒç»‘å®šçš„æ–°ç¯å¢ƒã€‚mutable? å¦‚æœä¸ºtrueï¼Œåˆ™è¯¥environmentæ˜¯å¯å˜çš„ï¼Œåä¹‹åˆ™ä¸å¯å˜ï¼›\nä»env å¤åˆ¶åˆ°æ–°ç¯å¢ƒçš„ç»‘å®šé›†ç”±syms ç¡®å®šï¼Œå…¶é»˜è®¤å€¼ä¸ºï¼ˆenvironment-symbols envï¼‰ã€‚æ¯ä¸ªsyms å…ƒç´ çš„ç»‘å®šï¼ˆå¦‚æœæœ‰ï¼‰éƒ½è¢«å¤åˆ¶åˆ°æ–°ç¯å¢ƒä¸­ï¼Œå¹¶ä¸”æ–°ç¯å¢ƒä¸­ä¸å­˜åœ¨å…¶ä»–ç»‘å®šã€‚\nåœ¨å½“å‰çš„å®ç°ä¸­ï¼Œæ°¸è¿œä¸ä¼šæ”¶é›†ç¯å¢ƒä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤é‡å¤ä½¿ç”¨å¤åˆ¶ç¯å¢ƒæœ€ç»ˆå°†å¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚\n(define e (copy-environment (scheme-environment))) (eval \u0026#39;(define cons +) e) (eval \u0026#39;(cons 3 4) e) â‡’ 7 (eval \u0026#39;(cons 3 4) (scheme-environment)) â‡’ (3 . 4) (environment-symbols env)\næ­¤è¿‡ç¨‹è¿”å›ä»£è¡¨ç¯å¢ƒenvä¸­ç»‘å®šçš„æ ‡è¯†ç¬¦çš„ç¬¦å·åˆ—è¡¨ã€‚å®ƒä¸»è¦ç”¨äºæ„å»ºè¦ä»ä¸€ç§ç¯å¢ƒå¤åˆ¶åˆ°å¦ä¸€ç§ç¯å¢ƒçš„ç¬¦å·åˆ—è¡¨ã€‚\n(define listless-environment (copy-environment (scheme-environment) #t (remq \u0026#39;list (environment-symbols (scheme-environment))))) (eval \u0026#39;(let ([x (cons 3 4)]) x) listless-environment) â‡’ (3 . 4) (eval \u0026#39;(list 3 4) listless-environment) â‡’ exception ç¼–è¯‘ã€æ±‚å€¼å’ŒåŠ è½½ (eval obj) | (eval obj env)\nevalå°†obj è§†ä¸ºè¡¨è¾¾å¼çš„è¡¨ç¤ºå½¢å¼ã€‚å®ƒåœ¨ç¯å¢ƒenvä¸­è®¡ç®—è¡¨è¾¾å¼å¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœæœªæä¾›ä»»ä½•ç¯å¢ƒï¼Œåˆ™é»˜è®¤ä¸ºç”±äº¤äº’ç¯å¢ƒè¿”å›çš„ç¯å¢ƒã€‚ å•å‚æ•°æ±‚å€¼æ˜¯Chez Schemeçš„æ‰©å±•ã€‚å½“ç¯å¢ƒå¯å˜æ—¶ï¼ŒChez Schemeè¿˜å…è®¸objè¡¨ç¤ºéè¡¨è¾¾å½¢å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªdefinitionã€‚ Chez Schemeè¿˜å…è®¸objä½œä¸ºä¸€ä¸ªannotationï¼Œé»˜è®¤æ±‚å€¼ç¨‹åºåˆ©ç”¨æ³¨é‡Šå°†æºæ–‡ä»¶ä¿¡æ¯åˆå¹¶åˆ°é”™è¯¯æ¶ˆæ¯ä¸­ï¼Œå¹¶å°†æºæ–‡ä»¶ä¿¡æ¯ä¸ç¼–è¯‘åçš„ä»£ç ç›¸å…³è”ã€‚\nåœ¨Chez Schemeä¸­ï¼Œevalå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œä»…å°†å…¶å‚æ•°ä¼ é€’ç»™å½“å‰æ±‚å€¼å™¨ï¼ˆè¯·å‚é˜…current-evalï¼‰ã€‚é»˜è®¤çš„è¯„ä¼°å™¨æ˜¯compileï¼Œå®ƒé€šè¿‡å½“å‰çš„æ‰©å±•å™¨ï¼ˆå‚é˜…current-expandï¼‰æ‰©å±•è¡¨è¾¾å¼ï¼Œå¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰§è¡Œç”Ÿæˆçš„ä»£ç ï¼Œå¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœå­˜åœ¨ç¯å¢ƒå‚æ•°env ï¼Œåˆ™compileå°†å…¶ä¼ é€’ç»™å½“å‰çš„æ‰©å±•å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºsc-expandã€‚\n(compile obj) | (compile obj env)\nobj å¯ä»¥ä¸ºSchemeè¡¨è¾¾å¼ï¼Œåœ¨æŒ‡å®šçš„ç¯å¢ƒï¼ˆæˆ–äº¤äº’ç¯å¢ƒï¼Œå¦‚æœæœªæä¾›ç¯å¢ƒï¼‰ä¸­ä½¿ç”¨å½“å‰æ‰©å±•å™¨ï¼ˆcurrent-expandçš„å€¼ï¼‰è¿›è¡Œæ‰©å±•ï¼‰ï¼Œç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œç„¶åæ‰§è¡Œã€‚ compileæ˜¯current-evalå‚æ•°çš„é»˜è®¤å€¼ã€‚\n(compile \u0026#39;(cons 1 2)) =\u0026gt; (1 . 2) (interpret obj) | (interpret obj env)\nè§£é‡Šç±»ä¼¼äºç¼–è¯‘ï¼Œåªæ˜¯è¡¨è¾¾å¼æ˜¯è§£é‡Šçš„è€Œä¸æ˜¯ç¼–è¯‘çš„ï¼ˆthe expression is interpreted rather than compiledï¼‰ã€‚è§£é‡Šå¯ä»¥ç”¨ä½œç¼–è¯‘çš„æ›¿ä»£å“ï¼Œä½†æœ‰ä»¥ä¸‹è­¦å‘Šï¼š\nè§£é‡Šåçš„ä»£ç è¿è¡Œé€Ÿåº¦å¤§å¤§é™ä½ è§£é‡Šåçš„ä»£ç ä¸ä¼šç”Ÿæˆæ£€æŸ¥å™¨ä¿¡æ¯ï¼Œå› æ­¤æ£€æŸ¥å™¨å¯¹äºè§£é‡Šçš„ä»£ç ä¸å¦‚åœ¨ç¼–è¯‘çš„ä»£ç ä¸­æœ‰ç”¨ã€ æ— æ³•è§£é‡Šå¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼ï¼Œå› æ­¤è§£é‡Šå™¨éœ€è¦ä¸ºæ‰€æœ‰å¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼è°ƒç”¨ç¼–è¯‘å™¨ï¼ˆè¿™æ˜¯é€æ˜å®Œæˆçš„ï¼‰ å½“æ±‚å€¼å½¢å¼è¿è¡Œæ—¶é—´è¾ƒçŸ­æ—¶ï¼Œè§£é‡Šæœ‰æ—¶æ¯”ç¼–è¯‘æ›´å¿«ï¼Œå› ä¸ºå®ƒé¿å…äº†åœ¨æ±‚å€¼ä¹‹å‰é€šè¿‡ç¼–è¯‘å®Œæˆçš„æŸäº›å·¥ä½œã€‚\n(load path) | (load path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚ loadè¯»å–å¹¶æ±‚å€¼path æŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œloadä½¿ç”¨evalæ±‚å€¼æºæ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-proc ï¼Œåˆ™loadå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-proc å¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\neval-procå‚æ•°æœ‰åŠ©äºå®ç°åµŒå…¥çš„ç±»ä¼¼äºSchemeçš„è¯­è¨€ï¼Œå¹¶æœ‰åŠ©äºä½¿ç”¨ç”¨äºSchemeç¨‹åºçš„æ›¿ä»£è¯„ä¼°æœºåˆ¶ã€‚ eval-procä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–ç”¨é€”ã€‚ä¾‹å¦‚ï¼Œ\n(load \u0026#34;myfile.ss\u0026#34; (lambda (x) (pretty-print (if (annotation? x) (annotation-stripped x) x)) (newline) (eval x))) å¯¹æ¯ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼ä¹‹å‰ä½¿ç”¨pretty-printæ‰“å°ã€‚\nå‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-library path) | (load-library path eval-proc)\nload-libraryä¸loadç›¸åŒï¼Œé™¤äº†å®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rsä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒï¼chezscheme**è¦†ç›–\n(load-program path) | (load-program path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚åŠ è½½ç¨‹åºè¯»å–å¹¶æ±‚å€¼pathæŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚ è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚å¦‚æœåŒ…å«æºä»£ç ï¼Œåˆ™åŠ è½½ç¨‹åºä¼šå°†ä»£ç ä»¥é¡¶çº§ç¨‹åºå½¢å¼åŒ…è£…èµ·æ¥ï¼Œä»¥ä¾¿å°†æ–‡ä»¶çš„å†…å®¹è§†ä¸ºRNRSé¡¶çº§ç¨‹åºï¼ˆSchemeç¼–ç¨‹è¯­è¨€ï¼Œç¬¬4ç‰ˆçš„10.3èŠ‚ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½ç¨‹åºä½¿ç”¨evalæ±‚å€¼æ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-procï¼Œåˆ™è£…å…¥ç¨‹åºå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¯„ä¼°çš„è¡¨è¾¾å¼ã€‚ä¼ é€’ç»™eval-procçš„è¡¨è¾¾å¼å¯èƒ½æ˜¯æ³¨é‡Šæˆ–æœªæ³¨é‡Šçš„å€¼ã€‚ å‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-compiled-from-port input-port)\nload-compiled-from-portè¯»å–å¹¶æ±‚å€¼æ¥è‡ªinput-portçš„å¯¹è±¡ä»£ç çš„å†…å®¹ï¼Œè¿™äº›input-portæ˜¯äº‹å…ˆç”±è¯¸å¦‚compile-file, compile-script, compile-library, compile-to-portåˆ›å»ºçš„ è¿”å›å€¼æ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè¯¥è¡¨è¾¾å¼çš„ç¼–è¯‘å½¢å¼ä¸ºinput-portã€‚å¦‚æœinput-portä¸ºç©ºï¼Œåˆ™ç»“æœå€¼æœªæŒ‡å®šã€‚\n(compile-file input-filename) | (compile-file input-filename output-filename)\ninput-filename å’Œoutput-filename å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚input-filename å¿…é¡»æ˜¯å·²å­˜åœ¨çš„å¯è¯»æ–‡ä»¶ã€‚å®ƒå¿…é¡»åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªæºè¡¨è¾¾å¼çš„åºåˆ—ï¼›å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™ç¼–è¯‘æ–‡ä»¶ä¼šå¼•å‘æ¡ä»¶ç±»å‹ä¸ºï¼†syntaxçš„å¼‚å¸¸ã€‚\næ­£å¸¸æ±‚å€¼è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚ compile-fileå¯¹æ•´ä¸ªæºæ–‡ä»¶æ‰§è¡Œç¼–è¯‘è¿‡ç¨‹ï¼Œä»è€Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚éšååŠ è½½ç›®æ ‡æ–‡ä»¶ï¼ˆè¯·å‚è§loadï¼‰æ—¶ï¼Œä¸éœ€è¦ç¼–è¯‘è¿‡ç¨‹ï¼Œå¹¶ä¸”æ–‡ä»¶åŠ è½½é€šå¸¸å¿«å‡ å€ã€‚\n(compile-script input-filename) | (compile-script input-filename output-filename)\ncompile-scriptä¸compile-fileç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºï¼Œå®ƒä¼šä»æºæ–‡ä»¶å¤åˆ¶å¼€å¤´çš„**#!è¡Œåˆ°ç›®æ ‡æ–‡ä»¶ï¼ŒåŒæ—¶è¯¥è¡Œä¸ä¼šè¢«å‹ç¼©ï¼Œå°½ç®¡å‚æ•°compile-compressed**è¢«è®¾ç½®ä¸º#tï¼Œå…¶ä»–ä»£ç ä¼šè¢«å‹ç¼©ï¼Œè¿™æ ·ä¼šä¿è¯æ“ä½œç³»ç»Ÿå¯ä»¥æ­£ç¡®åœ°è§£é‡Šã€‚\ncompile-scriptå…è®¸ä»æºè„šæœ¬åˆ›å»ºå·²ç¼–è¯‘çš„è„šæœ¬æ–‡ä»¶ï¼Œä»¥å‡å°‘è„šæœ¬åŠ è½½æ—¶é—´ã€‚ä¸æºä»£ç è„šæœ¬ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨**\u0026ndash;script**å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œå·²ç¼–è¯‘çš„è„šæœ¬ã€‚\n(compile-library input-filename) | (compile-library input-filename oiutput-filename)\ncompile-libraryä¸compile-fileç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rs**ä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒ!chezschemeè¦†ç›–ã€‚\n(compile-program input-filename) | (compile-program input-filename output-filename)\ncompile-programç±»ä¼¼äºcompile-scriptï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå®ç°äº†RNRSé¡¶çº§ç¨‹åºçš„è¯­ä¹‰ï¼Œè€Œcompile-scriptåˆ™å®ç°äº†äº¤äº’å¼é¡¶çº§ç¨‹åºçš„è¯­ä¹‰ã€‚ä¸é€šè¿‡compile-fileæˆ–compile-scriptè¿›è¡Œç¼–è¯‘ç›¸æ¯”ï¼Œç”Ÿæˆçš„å·²ç¼–è¯‘ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚\ncompile-programè¿”å›ç”±ç¼–è¯‘çš„é¡¶å±‚ç¨‹åºç›´æ¥è°ƒç”¨çš„åº“çš„åˆ—è¡¨ï¼Œä¸åŒ…æ‹¬ï¼ˆrnrsï¼‰å’Œï¼ˆchezschemeï¼‰ä¹‹ç±»çš„å†…ç½®åº“\n(compile-whole-program input-filename output-filename) | (compile-whole-program input-filename output-filename libs-visible?)\ncompile-whole-programæ¥å—ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºåç§°è¾“å…¥ï¼Œè¯¥æ–‡ä»¶åä¸ºé¡¶çº§ç¨‹åºå‘½åä¸ºâ€œ whole program optimizationâ€ï¼ˆwpoï¼‰æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒ…å«è¯¥ç¨‹åºåŠå…¶æ‰€ä¾èµ–çš„æ¯ä¸ªåº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œå‰ææ˜¯éœ€è¦ä¸€ä¸ªå¯ä»¥æ‰¾åˆ°åº“çš„wpoæ–‡ä»¶ã€‚\nå¦‚æœwpoæ–‡ä»¶æ‰¾ä¸åˆ°æ‰€éœ€åº“ï¼Œä½†å¯ä»¥æ‰¾åˆ°è¯¥åº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™è¯¥åº“ä¸ä¼šåˆå¹¶åˆ°ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚è¿™äº›åº“å°†åœ¨è¿è¡Œæ—¶åŠ è½½ã€‚ compile-whole-programè¿”å›è¿™äº›åº“çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„åº“ï¼Œåˆ™ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶æ˜¯è‡ªåŒ…å«çš„ï¼Œå¹¶ä¸”compile-whole-programè¿”å›ç©ºåˆ—è¡¨ã€‚\nå¦‚æœlibs-visible? è®¾ç½®ä¸ºéfalseï¼Œåˆ™åº“åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶æ˜¯å¯è§çš„ï¼ˆä¾›environmentå’Œevalä½¿ç”¨ï¼‰ï¼Œä»»ä½•åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­å¹¶åœ¨è¿è¡Œæ—¶ä¿ç•™ä¸‹æ¥çš„ç›®æ ‡æ–‡ä»¶æ‰€è¦æ±‚çš„åº“éƒ½æ˜¯å¯è§çš„ã€‚\nå½“generate-wpo-fileså‚æ•°è®¾ç½®ä¸º#tæ—¶ï¼Œè¿‡ç¨‹compile-fileï¼Œcompile-programï¼Œcompile-libraryï¼Œcompile-scriptå’Œcompile-whole-libraryä¼šç”Ÿæˆwpoæ–‡ä»¶ä»¥åŠæ™®é€šç›®æ ‡æ–‡ä»¶ã€‚ ï¼ˆé»˜è®¤å€¼ä¸º#fï¼‰ã€‚å¦å¤–å¦‚æœä¼ é€’å¯é€‰çš„wpoç«¯å£æ—¶ï¼Œcompile-portå’Œcompile-to-portä¹Ÿä¼šè¿™æ ·åšã€‚\n(compile-whole-library input-filename output-filename)\ncompile-whole-libraryç±»ä¼¼äºcompile-whole-programï¼Œä¸åŒä¹‹å¤„åœ¨äºinput-filenameå¿…é¡»ä¸ºåº“æŒ‡å®šä¸€ä¸ªwpoæ–‡ä»¶ï¼Œæ‰€æœ‰åº“è‡ªåŠ¨æ˜¾ç¤ºï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„wpoæ–‡ä»¶ï¼ˆå½“generate-wpo-filesä¸º#tæ—¶ï¼‰ä»¥åŠç”¨äºç”Ÿæˆçš„åº“ç»„åˆçš„ç›®æ ‡æ–‡ä»¶ã€‚\n(compile-port input-port output-port) | (compile-port input-port output-port sfd) | (compile-port input-port output-port sfd wpo-port)\ninput-port å¿…é¡»æ˜¯æ–‡æœ¬è¾“å…¥ç«¯å£ã€‚out-port å’Œwpo-portï¼ˆå¦‚æœå­˜åœ¨ï¼‰å¿…é¡»æ˜¯äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ã€‚å¦‚æœå­˜åœ¨sfd ,å¿…é¡»æ˜¯æºæ–‡ä»¶æè¿°ç¬¦ã€‚\n(make-boot-file output-filename base-boot-list input-filename \u0026hellip;)\næ‰€æœ‰å‚æ•°éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚\nmake-boot-fileå°†å¼•å¯¼æ ‡å¤´ï¼ˆboot headerï¼‰å†™å…¥ä»¥output-filename å‘½åçš„æ–‡ä»¶ï¼Œç„¶åä¾æ¬¡å†™å…¥æ¯ä¸ªinput-filename çš„ç›®æ ‡ä»£ç ã€‚å¦‚æœå°šæœªç¼–è¯‘è¾“å…¥æ–‡ä»¶ï¼Œmake-boot-fileå°†åœ¨å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚\nå¼•å¯¼æ–‡ä»¶é€šè¿‡\u0026ndash;bootæˆ–-bå‘½ä»¤è¡Œé€‰é¡¹æ˜¾å¼åŠ è½½ï¼Œæˆ–åŸºäºå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°éšå¼åŠ è½½ã€‚\n(make-boot-header output-filename base-boot1 base-boot2\u0026hellip;)\nè¯¥è¿‡ç¨‹å·²åŒ…å«åœ¨make-boot-fileä¸­ï¼Œå¹¶æä¾›äº†å‘åå…¼å®¹æ€§ã€‚\n(make-boot-header output-filename base-boot1 base-boot2 \u0026hellip;) ç­‰ä»·äºï¼š (make-boot-file output-filename â€™(base-boot1 base-boot2 \u0026hellip;))\næºç›®å½•å’Œæ–‡ä»¶ source-directories\nsource-directoriesçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²éƒ½å‘½åä¸€ä¸ªç›®å½•è·¯å¾„ã€‚å½“é€šè¿‡load, load-library, load-program, include, visit, or revisitåœ¨äº¤äº’å¼æ£€æŸ¥å™¨ä¸­å‘ç”Ÿè¯­æ³•é”™è¯¯æˆ–æ‰“å¼€æºæ–‡ä»¶æ—¶ï¼Œsource-directoryç¡®å®šç”¨äºæœç´¢æºæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶çš„ç›®å½•é›†ã€‚\né»˜è®¤å€¼ä¸ºåˆ—è¡¨ï¼ˆâ€œ.â€ï¼‰ï¼Œè¿™æ„å‘³ç€ä»…åœ¨å½“å‰ç›®å½•ä¸­æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•æ‰èƒ½æ‰¾åˆ°æºæ–‡ä»¶ï¼Œé™¤éä½¿ç”¨ç»å¯¹è·¯å¾„å‘½åã€‚\n(with-source-path who name procedure)\nè¿‡ç¨‹with-source-pathä¾æ¬¡æœç´¢å½“å‰æºç›®å½•è·¯å¾„ï¼Œä»¥æŸ¥æ‰¾å…·æœ‰æŒ‡å®šåç§°çš„æ–‡ä»¶ï¼Œå¹¶åœ¨ç»“æœä¸Šè°ƒç”¨è¿‡ç¨‹ã€‚å¦‚æœæœªæ‰¾åˆ°è¿™æ ·çš„æ–‡ä»¶ï¼Œåˆ™å¼•å‘**\u0026amp;assertionå’Œ\u0026amp;whoå¼‚å¸¸ï¼Œ\u0026amp;who**çš„å€¼ä¸ºwho çš„å€¼\nå¦‚æœname æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ä»¥./ï¼ˆWindowsä¸‹æ˜¯./ï¼‰ï¼Œæˆ–è€…../ï¼ˆWindowsä¸‹æ˜¯..\\ï¼‰ï¼Œæˆ–è€…æºç›®å½•åˆ—è¡¨ä¸­åªåŒ…å«â€œ.â€ï¼Œæˆ–è€…é»˜è®¤å€¼ \u0026ldquo;\u0026quot;ï¼Œç›¸å½“äº \u0026ldquo;.\u0026quot;ï¼Œä¸æ‰§è¡Œæœç´¢å¹¶è¿”å›nameã€‚\nwho å¿…é¡»æ˜¯ç¬¦å·ï¼Œname å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œprocedure åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚\nä»¥ä¸‹ç¤ºä¾‹å‡å®šæ–‡ä»¶â€œ pieâ€å­˜åœ¨äºç›®å½•â€œ ../spamâ€ä¸­ï¼Œä½†ä¸åœ¨â€œ ../hamâ€æˆ–å½“å‰ç›®å½•ä¸­ã€‚\n(define find-file (lambda (fn) (with-source-path \u0026#39;find-file fn values))) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ exception in find-file: pie not found (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;../spam/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;/pie\u0026#34;) â‡’ \u0026#34;/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;./pie\u0026#34;) â‡’ \u0026#34;./pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;../pie\u0026#34;) â‡’ \u0026#34;../ham/pie\u0026#34; ç¼–è¯‘å™¨ç®¡ç† optimize-level\nè¯¥å‚æ•°å¯ä»¥æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3è¿™4ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚\nç†è®ºä¸Šï¼Œæ­¤å‚æ•°æ§åˆ¶ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¼˜åŒ–é‡ã€‚ å®é™…ä¸Šï¼Œå®ƒåªæ˜¯é—´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºä¼˜åŒ–çº§åˆ«3ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œä¸å®‰å…¨â€ä»£ç ï¼‰ä¸ä¼˜åŒ–çº§åˆ«0-2ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œå®‰å…¨â€ä»£ç ï¼‰ä¹‹é—´ã€‚ å®‰å…¨ä»£ç ä¼šæ‰§è¡Œå®Œæ•´ç±»å‹å’ŒèŒƒå›´æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼Œå°è¯•åº”ç”¨éè¿‡ç¨‹ï¼Œå°è¯•å¯¹non-pairçš„caræ“ä½œæˆ–å°è¯•å¼•ç”¨å‘é‡çš„æœ«å°¾ï¼Œå‡ä¼šå¯¼è‡´ å¼•å‘å¼‚å¸¸ã€‚ å¯¹äºä¸å®‰å…¨çš„ä»£ç ï¼Œç›¸åŒçš„æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ï¼ŒSchemeå †æŸåï¼ˆè¿™å¯èƒ½åœ¨ä»¥åå¼•èµ·çœ‹ä¼¼æ— å…³çš„é—®é¢˜ï¼‰ï¼Œç³»ç»Ÿå´©æºƒæˆ–å…¶ä»–ä¸è‰¯è¡Œä¸ºã€‚ä¸å®‰å…¨çš„ä»£ç é€šå¸¸ä¼šæ›´å¿«ï¼Œä½†æ˜¯åº”è¯¥è°¨æ…ä½¿ç”¨ä¼˜åŒ–çº§åˆ«3ï¼Œå¹¶ä¸”ä»…è¿ç”¨åœ¨å¿…é¡»å°½å¿«è¿è¡Œä¸”ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ä»£ç ä¸­ã€‚\nå°½ç®¡ç¼–è¯‘å™¨ä¸ºä¼˜åŒ–0è‡³2çº§ç”Ÿæˆäº†ç›¸åŒçš„ä»£ç ï¼Œä½†å¦‚æœéœ€è¦ï¼Œç”¨æˆ·å®šä¹‰çš„å®è½¬æ¢å™¨å¯ä»¥åŒºåˆ†ä¸åŒçš„çº§åˆ«ã€‚\nä¸€ç§ä½¿ç”¨ä¼˜åŒ–çº§åˆ«çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ–‡ä»¶ä¸Šï¼Œå¼ºåˆ¶ä½¿ç”¨eval-whenã€‚ ä¾‹å¦‚:\n(eval-when (compile) (optimize-level 3)) ä¹Ÿå¯ä»¥é€šè¿‡\u0026ndash;optimize-levelå‘½ä»¤è¡Œé€‰é¡¹è®¾ç½®ä¼˜åŒ–çº§åˆ«ã€‚æ­¤é€‰é¡¹å¯¹äºé€šè¿‡\u0026ndash;programå‘½ä»¤è¡Œé€‰é¡¹åœ¨ä¼˜åŒ–çº§åˆ«3è¿è¡ŒRNRSé¡¶å±‚ç¨‹åºç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºeval-whenå¯¹RNRSé¡¶å±‚ç¨‹åºæ— æ•ˆã€‚\n($primitive variable) | ($primitive 2 variable) | ($primitive 3 variable)\nvariable å¿…é¡»æ˜¯ä¸€ä¸ªåŸå§‹procedureçš„åå­—ã€‚** $primitive**è¯­æ³•å½¢å¼å…è®¸ä»¥å•ä¸ªåŸå§‹å¼•ç”¨çš„ç²’åº¦æ§åˆ¶ä¼˜åŒ–çº§åˆ«ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ç”¨äºè®¿é—®åŸå§‹å€¼ã€‚\nè¡¨è¾¾å¼ï¼ˆ$primitive variableï¼‰å¯ä»¥ç¼©å†™ä¸º**#%variable**ã€‚\n(#%car â€™(a b c)) â‡’ a (let ([car cdr]) (car \u0026#39;(a b c))) â‡’ (b c) (let ([car cdr]) (#%car \u0026#39;(a b c))) â‡’ a (begin (set! car cdr) (#%car \u0026#39;(a b c))) â‡’ a debug-level\nè¯¥å‚æ•°å¯ä»¥é‡‡ç”¨0ã€1ã€2å’Œ3è¿™å››ä¸ªå€¼ä¹‹ä¸€ã€‚å®ƒç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ä¿ç•™è°ƒè¯•ä¿¡æ¯çš„é‡è¦æ€§ï¼Œå…¶ä¸­0çš„é‡è¦æ€§æœ€ä½ï¼Œè€Œ3çš„é‡è¦æ€§æœ€é«˜ã€‚ é»˜è®¤å€¼æ˜¯1ã€‚ä»9.0ç‰ˆå¼€å§‹ï¼Œå®ƒä»…ç”¨äºç¡®å®šåœ¨éå°¾éƒ¨ä½ç½®é‡åˆ°çš„å¼•èµ·é”™è¯¯çš„è°ƒç”¨æ˜¯å¦è¢«è§†ä¸ºåœ¨å°¾éƒ¨ä½ç½®ï¼ˆå› æ­¤ï¼Œå¯¼è‡´è°ƒç”¨è€…çš„å¸§ä¸å‡ºç°åœ¨å †æ ˆå›æº¯ä¸­ï¼‰ã€‚ è¿™å‘ç”Ÿåœ¨ä½äº2çš„è°ƒè¯•çº§åˆ«ã€‚\næ¦‚è¦åˆ†æProfiling ChezSchemeæ”¯æŒä¸¤ç§ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼šæºä»£ç æ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æã€‚\nå¯ç”¨æºæ¦‚è¦åˆ†æåï¼Œç¼–è¯‘å™¨ä¼šå¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œä»¥è®¡ç®—æ¯ä¸ªæºä»£ç è¡¨è¾¾å¼çš„æ‰§è¡Œæ¬¡æ•°ã€‚ è¯¥ä¿¡æ¯å¯ä»¥HTMLæ ¼å¼æ˜¾ç¤ºæˆ–æ‰“åŒ…åœ¨åˆ—è¡¨ä¸­ï¼Œä»¥è¿›è¡Œä»»æ„ç”¨æˆ·å®šä¹‰çš„å¤„ç†ã€‚ ä¹Ÿå¯ä»¥å°†å…¶è½¬å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†åŠ è½½åˆ°ç¼–è¯‘å™¨çš„æ¦‚è¦åˆ†æä¿¡æ¯æ•°æ®åº“ä¸­ï¼Œä»¥ç”¨äºæºä»£ç çº§ä¼˜åŒ–ã€‚\næºä»£ç æ¦‚è¦åˆ†æè‡³å°‘åŒ…å«ä¸‹é¢ä¸€äº›æ­¥éª¤ï¼š\nç¼–è¯‘ä»£ç ä¸”å¼€å¯source profiling è¿è¡Œç¼–è¯‘åçš„ä»£ç ç”Ÿæˆæºä»£ç æ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä¸” è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·æºæˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨æºæ¦‚è¦åˆ†æã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ï¼š\nprofile-dump-html ä»¥HTMLæ ¼å¼æ˜¾ç¤ºï¼Œä»¥ä¾¿ç¨‹åºå‘˜å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ä½¿ç”¨å½©è‰²ç¼–ç ç³»ç»Ÿæ‰§è¡Œæ¯ä¸ªè¡¨è¾¾å¼çš„é¢‘ç‡ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥è½»æ¾å‘ç°â€œçƒ­ç‚¹â€ profile-dump-list ä»¥é€‚åˆç”¨æˆ·å®šä¹‰çš„åå¤„ç†çš„å½¢å¼; profile-dump ä»¥é€‚åˆäºé€šè¿‡ä¸Šè¿°æ–¹æ³•ä¹‹ä¸€æˆ–æŸäº›è‡ªå®šä¹‰æ–¹å¼è¿›è¡Œç¦»çº¿å¤„ç†çš„å½¢å¼ï¼Œæˆ– profile-dump-data ä»¥é€‚åˆåŠ è½½åˆ°ç¼–è¯‘å™¨æ•°æ®åº“ä¸­çš„å½¢å¼ã€‚\nç”±profile-dump-dataè½¬å‚¨çš„æ¦‚è¦åˆ†æä¿¡æ¯é€šè¿‡profile-load-dataåŠ è½½åˆ°ç¼–è¯‘å™¨çš„profilingæ•°æ®åº“ä¸­ã€‚ é™¤éé€šè¿‡profile-dump-dataæ˜¾å¼è½¬å‚¨å¹¶é€šè¿‡profile-load-dataåŠ è½½ï¼Œå¦åˆ™åˆ†æä¿¡æ¯å¯¹ç¼–è¯‘å™¨ä¸å¯ç”¨ã€‚\nå½“ä½¿ç”¨å—æ¦‚è¦æ–‡ä»¶ä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œæ­¥éª¤æ˜¯ç›¸ä¼¼çš„ï¼š\nç¼–è¯‘ä»£ç å¹¶å¼€å¯block profiling è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ åŠ è½½æ¦‚è¦ä¿¡æ¯ï¼Œä¸” é‡æ–°ç¼–è¯‘ä»£ç  é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·å—æˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨å—åˆ†æã€‚ æ¦‚è¦æ–‡ä»¶ä¿¡æ¯å¿…é¡»é€šè¿‡profile-dump-dataè½¬å‚¨ï¼Œå¹¶é€šè¿‡profile-load-dataåŠ è½½ã€‚ ä¸æºé…ç½®æ–‡ä»¶ä¿¡æ¯ä¸€æ ·ï¼Œå—é…ç½®æ–‡ä»¶ä¿¡æ¯å¯ä»¥ä¸è½¬å‚¨ä¿¡æ¯çš„åŠ è½½è¿‡ç¨‹ç›¸åŒæˆ–ä¸åŒã€‚\nå¯¹äºå—ä¼˜åŒ–ï¼Œè¦é‡æ–°ç¼–è¯‘çš„ä»£ç å¿…é¡»ç›¸åŒã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€æ‰€æ¶‰åŠçš„æ–‡ä»¶å¿…é¡»æœªç»ä¿®æ”¹ï¼Œå¹¶ä¸”å…¶ä»–ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šé—´æ¥å½±å“ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ã€‚\nå‡ºäºåŒæ ·çš„åŸå› ï¼Œå½“è¦åŒæ—¶ä½¿ç”¨æºæ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œå¿…é¡»å…ˆæ”¶é›†å¹¶åŠ è½½æºä¿¡æ¯ï¼Œç„¶åå†è¿è¡Œæ¶‰åŠå—æ¦‚è¦åˆ†æçš„ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ç¼–è¯‘ã€‚ å³ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š\n1. ç¼–è¯‘ä»£ç å¹¶èµ·å¼€æºä»£ç æ¦‚è¦åˆ†æ 2. è¿è¡Œä»£ç ç”Ÿæˆsource-profilingä¿¡æ¯ 2. è½¬å‚¨source-profiling 3. åŠ è½½source-profiling 3. é‡æ–°ç¼–è¯‘ä»£ç ï¼Œå¹¶å¼€å¯å—æ¦‚è¦åˆ†æ 4. è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ 4. è½¬å‚¨block-profiling 5. åŠ è½½source-å’Œblock-profiling 5. é‡æ–°ç¼–è¯‘ä»£ç  æ ‡è®°æ¯ä¸ªæ­¥éª¤çš„æ•°å­—æ—¢æŒ‡ç¤ºæ­¥éª¤çš„é¡ºåºï¼ŒåˆæŒ‡ç¤ºå¿…é¡»åœ¨åŒä¸€è®¡åˆ’è¿‡ç¨‹ä¸­æ‰§è¡Œçš„é¡ºåºã€‚ ï¼ˆå¦‚æœéœ€è¦ï¼Œæ‰€æœ‰æ­¥éª¤éƒ½å¯ä»¥åœ¨åŒä¸€Schemeæµç¨‹ä¸­æ‰§è¡Œã€‚ï¼‰ å½“compile-profileè®¾ç½®ä¸ºé»˜è®¤å€¼#fæ—¶ï¼Œå°†ç¦ç”¨æºå’Œå—åˆ†æã€‚\nå‡è®¾æ–‡ä»¶/tmp/fatfib/fatfib.ssåŒ…å«ä»¥ä¸‹ä»£ç ï¼š\n(define fat+ (lambda (x y) (if (zero? y) x (fat+ (1+ x) (1- y))))) (define fatfib (lambda (x) (if (\u0026lt; x 2) 1 (fat+ (fatfib (1- x)) (fatfib (1- (1- x))))))) æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·åŠ è½½fatfib.sså¹¶ä¸”å¼€å¯æ¦‚è¦åˆ†æï¼š\n(parameterize ([compile-profile \u0026#39;source]) (load \u0026#34;/tmp/fatfib/fatfib.ss\u0026#34;)) ç„¶åè¿è¡Œä»£ç ï¼š\n(fatfib 20) â‡’ 10946 è¿è¡Œï¼ˆæˆ–å¤šæ¬¡è¿è¡Œï¼‰ä¹‹åï¼Œè½¬å‚¨æ¦‚è¦æ–‡ä»¶ä¸ºä¸€äº›htmlæ–‡ä»¶é›†åˆï¼š ä½¿ç”¨profile-dump-html\n(profile-dump-html) è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºprofile.htmlçš„æ–‡ä»¶\nåœ¨å›¾ä¸­ï¼Œæ‰§è¡Œæœ€é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘çº¢è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºï¼Œè€Œæ‰§è¡Œæœ€ä¸é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘ç´«è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºã€‚\ncompile-profile\nå½“å°†æ­¤å‚æ•°è®¾ç½®ä¸ºç¬¦å·sourceæˆ–å¸ƒå°”å€¼**#tæ—¶ï¼Œç¼–è¯‘å™¨å°†ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¿™äº›æŒ‡ä»¤å¯¹æºä»£ç çš„æ¯ä¸ªéƒ¨åˆ†æ‰§è¡Œçš„æ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸ºç¬¦å·blockæ—¶ï¼Œç¼–è¯‘å™¨ç±»ä¼¼åœ°ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¯¥æŒ‡ä»¤å¯¹æ¯ä¸ªä»£ç å—çš„æ‰§è¡Œæ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸º#f**ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ’å…¥è¿™äº›æŒ‡ä»¤ã€‚\nå½“compile-profileä¸ºéfalseæ—¶ç”Ÿæˆçš„ä»£ç è¾ƒå¤§ä¸”æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤ä»…åœ¨éœ€è¦æ¦‚è¦åˆ†æä¿¡æ¯æ—¶æ‰åº”è®¾ç½®æ­¤å‚æ•°ã€‚å¯ç”¨æ¦‚è¦åˆ†ææ£€æµ‹åç¼–è¯‘çš„ä»£ç çš„æ¦‚è¦æ–‡ä»¶è®¡æ•°å™¨å°†æ— é™æœŸä¿ç•™ï¼Œå³ä½¿ä¸å®ƒä»¬å…³è”çš„ä»£ç å·²è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ è¿™æ ·å¯ä»¥å¾—åˆ°æ›´å®Œæ•´å’Œå‡†ç¡®çš„æ¦‚è¦åˆ†ææ•°æ®ï¼Œä½†ä¼šå¯¼è‡´åŠ¨æ€ç”Ÿæˆæˆ–åŠ è½½ä»£ç çš„ç¨‹åºå‡ºç°ç©ºé—´æ³„æ¼ï¼Œç¨‹åºå¯ä»¥é€šè¿‡profile-release-countersè¿‡ç¨‹æ˜¾å¼åœ°é‡Šæ”¾è®¡æ•°å™¨ï¼Œä»è€Œé¿å…æ½œåœ¨çš„ç©ºé—´æ³„æ¼ã€‚\n(profile-clear)\nè°ƒç”¨æ­¤è¿‡ç¨‹ä¼šæ¸…ç©ºæ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä»£ç æ¯ä¸ªéƒ¨åˆ†å…³è”çš„è®¡æ•°éƒ½è¢«ç½®ä¸º0\n(profile-release-counters)\nè°ƒç”¨æ­¤è¿‡ç¨‹å°†ä¸¢å¼ƒæ¦‚è¦åˆ†æ\n(profile-dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆè‡ªå¯åŠ¨æˆ–ä¸Šæ¬¡è°ƒç”¨profile-clearä»¥æ¥æ”¶é›†çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ä¿¡æ¯çš„è½¬å‚¨ã€‚ å®ƒè¿”å›ä¸€ä¸ªpairçš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªpairçš„caræ˜¯ä¸€ä¸ªsource-objectï¼Œè€Œcdræ˜¯ä¸€ä¸ªç²¾ç¡®çš„éè´Ÿæ•´æ•°è®¡æ•°ã€‚\nprofile-dumpä¼˜äºprofile-dump-listçš„ä¼˜ç‚¹åœ¨äºï¼Œprofile-dumpä»…æ‰§è¡Œæœ€å°‘çš„å¤„ç†ï¼Œå¹¶ä¿ç•™å®Œæ•´çš„æºå¯¹è±¡ï¼ŒåŒ…æ‹¬å…¶åµŒå…¥å¼æºæ–‡ä»¶æè¿°ç¬¦ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºå°†æ¦‚è¦åˆ†æä¿¡æ¯è½¬å‚¨åˆ°ä¸€å°è®¡ç®—æœºä¸Šçš„faslæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šè¿›è¡Œåç»­å¤„ç†ã€‚\n(profile-dump-html) | (profile-dump-html prefix) | (profile-dump-html prefix dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªHTMLæ–‡ä»¶ï¼ŒåŒ…æ‹¬profile.htmlï¼ˆå…¶ä¸­åŒ…å«ç”¨é¢œè‰²ç¼–ç çš„æ‘˜è¦ä¿¡æ¯ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ–‡ä»¶source.htmlï¼Œå…¶ä¸­æ¯ä¸ªæºæ–‡ä»¶æºéƒ½åŒ…å«ç”¨æºä»£ç è¿›è¡Œé¢œè‰²ç¼–ç çš„å‰¯æœ¬ï¼Œå¦‚å‰å¯¼ä¸­æ‰€è¿°ï¼š åœ¨æœ¬èŠ‚ä¸­ã€‚ å¦‚æœæŒ‡å®šäº†prefix ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆçš„HTMLæ–‡ä»¶çš„åç§°ä¹‹å‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå‰ç¼€ä¸º**â€œ /tmp/â€ï¼Œåˆ™ç”Ÿæˆçš„æ–‡ä»¶å°†æ”¾ç½®åœ¨ç›®å½•/tmpä¸­ã€‚ åŸå§‹æ¦‚è¦åˆ†æä¿¡æ¯æ˜¯ä»è½¬å‚¨è·å–çš„ï¼Œé»˜è®¤ä¸ºprofile-dump**è¿”å›çš„å€¼\n(profile-palette)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯è‡³å°‘ä¸‰å¯¹çš„éç©ºå‘é‡ã€‚ æ¯ä¸ªpairçš„caræ˜¯èƒŒæ™¯è‰²ï¼Œè€Œcdræ˜¯å‰æ™¯ï¼ˆæ–‡æœ¬ï¼‰è‰²ã€‚ æ¯ç§é¢œè‰²éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ¯ä¸ªå­—ç¬¦ä¸²éƒ½åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ ç¬¬ä¸€ç»„ç”¨äºæœªé…ç½®çš„ä»£ç ï¼Œç¬¬äºŒå¯¹ç”¨äºæœªæ‰§è¡Œçš„é…ç½®çš„ä»£ç ã€‚ ç¬¬ä¸‰ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€ä½çš„ä»£ç ï¼Œç¬¬å››ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡å€’æ•°ç¬¬äºŒä½çš„ä»£ç ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„ä»£ç ã€‚ ç¨‹åºå‘˜å¯èƒ½å¸Œæœ›æä¾›è‡ªå·±çš„è°ƒè‰²æ¿ä»¥å¢å¼ºå¯è§æ€§æˆ–æ›´æ”¹æ‰€ç”¨é¢œè‰²çš„æ•°é‡ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œé»‘è‰²èƒŒæ™¯ç”¨äºæœªé…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œç°è‰²èƒŒæ™¯ç”¨äºæœªæ‰§è¡Œçš„é…ç½®æ–‡ä»¶çš„ä»£ç ã€‚ æ ¹æ®æ‰§è¡Œé¢‘ç‡ï¼Œç´«è‰²åˆ°çº¢è‰²çš„èƒŒæ™¯é¢œè‰²ç”¨äºæ‰§è¡Œçš„æ¦‚è¦åˆ†æä»£ç ï¼Œè€Œæœ€é¢‘ç¹æ‰§è¡Œçš„ä»£ç ä½¿ç”¨çº¢è‰²ã€‚\n(profile-palette) â‡’ #((\u0026#34;#111111\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#607D8B\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#9C27B0\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#673AB7\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#3F51B5\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#2196F3\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00BCD4\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#4CAF50\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#CDDC39\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFEB3B\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFC107\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF9800\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#F44336\u0026#34; . \u0026#34;white\u0026#34;)) (profile-palette ; set palette with rainbow colors and black text ; for all but unprofiled or unexecuted code \u0026#39;#((\u0026#34;#000000\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#666666\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#8B00FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#6600FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#0000FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00FF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFFF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF7F00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF0000\u0026#34; . \u0026#34;black\u0026#34;))) ; red (profile-line-number-color)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–#fã€‚ å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™profile-dump-htmlä½¿ç”¨æŒ‡å®šçš„é¢œè‰²åœ¨æ¯ä¸ªæºæ–‡ä»¶çš„htmlå‘ˆç°ä¸­åŒ…æ‹¬è¡Œå·ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸º#fï¼Œåˆ™ä¸åŒ…å«è¡Œå·ã€‚\nä¸ªæ€§åŒ–ï¼ˆWaiter Customizationï¼‰ (new-cafe) | (new-cafe eval-proc)\nChez Schemeé€šè¿‡waiter æˆ–read-eval-printå¾ªç¯ï¼ˆREPLï¼‰ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚ waiteråœ¨ç§°ä¸ºcafÌeçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå°†ç”¨æˆ·ç½®äºcafÌeä¸­å¹¶åˆ†é…waiter ã€‚ new-cafeåœ¨æ—§çš„cafÌeä¹‹ä¸Šå¼€å¯äº†ä¸€ä¸ªæ–°çš„Scheme cafÌeã€‚ é™¤äº†å¯åŠ¨waiter ä¹‹å¤–ï¼Œnew-cafeè¿˜è®¾ç½®äº†cafÌeçš„é‡ç½®å’Œé€€å‡ºå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…reset-handlerå’Œexit-handlerï¼‰ã€‚ é€€å‡ºcafÌeä¼šè¿”å›åˆ°åˆ›å»ºè¯¥cafÌeçš„cafÌeã€‚ä»æœ€åˆçš„cafÌeé€€å‡ºåä¼šå®Œå…¨é€€å‡ºäº†Schemeã€‚ cafÌeå¯ä»¥é€šè¿‡æ˜¾å¼è°ƒç”¨exitæˆ–é€šè¿‡æ¥æ”¶end-of-fileï¼ˆUnixç³»ç»Ÿä¸Šä¸ºâ€œ control-Dâ€ï¼‰æ¥é€€å‡ºã€‚åœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™exitçš„ä»»ä½•å€¼éƒ½æ˜¯ä»new-cafeè¿”å›çš„ã€‚\n\u0026gt; (define x 1) \u0026gt; x 1 \u0026gt; (new-cafe) \u0026gt;\u0026gt; x 1 \u0026gt;\u0026gt; (define y 2) \u0026gt;\u0026gt; y 2 \u0026gt;\u0026gt; (exit 1) 1 å¦‚æœæŒ‡å®šäº†å¯é€‰çš„eval-proc å‚æ•°ï¼Œåˆ™ä½¿ç”¨eval-proc æ±‚å€¼ä»æ§åˆ¶å°è¾“å…¥çš„ç¨‹åºã€‚ å¦åˆ™ï¼Œå°†ä½¿ç”¨å‚æ•°current-eval çš„å€¼ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\n\u0026gt; (new-cafe (lambda (x) x)) \u0026gt;\u0026gt; 3 3 \u0026gt;\u0026gt; (a . (b . (c . ()))) (a b c) \u0026gt; (define sum (lambda (ls) (if (null? ls) 0 (+ (car ls) (sum (cdr ls)))))) \u0026gt; (new-cafe sum) \u0026gt;\u0026gt; (1 2 3) 6 æ—¶é—´å’Œæ—¥æœŸ æ—¶é—´ç”±æ—¶é—´å¯¹è±¡è¡¨ç¤ºã€‚ æ—¶é—´å¯¹è±¡è®°å½•ç‰¹å®šæ—¶é—´æˆ–æŒç»­æ—¶é—´çš„çº³ç§’å’Œç§’ï¼Œä»¥åŠæ ‡è¯†æ—¶é—´å¯¹è±¡æ€§è´¨çš„time type ã€‚ æ—¶é—´ç±»å‹æ˜¯ä»¥ä¸‹ç¬¦å·ä¹‹ä¸€ï¼š time-utc: ä»â€œçºªå…ƒâ€1970å¹´1æœˆ1æ—¥0ç‚¹0åˆ†0ç§’ä»¥æ¥çš„æ—¶é—´ time-monotonic: ä»è¿‡å»æŸä¸ªä»»æ„æ—¶é—´ç‚¹å¼€å§‹ç»è¿‡çš„æ—¶é—´ï¼Œç†æƒ³æƒ…å†µä¸‹æ— éœ€è¿›è¡Œè°ƒæ•´ã€‚ time-duration: ä¸¤ä¸ªæ—¶é—´çš„é—´éš”ã€‚å½“ä½œä¸ºcurrent-timeçš„å‚æ•°æ—¶ï¼Œå…¶è¡Œä¸ºä¸time-monotonicç±»ä¼¼ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ—¶é—´å¯¹è±¡ç›¸å‡çš„ç»“æœ time-process: å½“å‰è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ time-thread: å½“å‰çº¿ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ å¦‚æœæœªè¿è¡Œçº¿ç¨‹ï¼Œæˆ–è€…ç³»ç»Ÿä¸å…è®¸ç¡®å®šå•ä¸ªçº¿ç¨‹æ—¶é—´ï¼Œåˆ™è¯¥æ—¶é—´ä¸time-processç›¸åŒã€‚ time-collector-cpu: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†CPUæ¶ˆè€—çš„æ—¶é—´ã€‚ time-collector-real: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†å®æ—¶æ¶ˆè€—çš„æ—¶é—´\næ—¥æœŸç”±æ—¥æœŸå¯¹è±¡è¡¨ç¤ºã€‚ æ—¥æœŸå¯¹è±¡è®°å½•ç‰¹å®šæ—¥æœŸçš„çº³ç§’ï¼Œç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œæ—¥ï¼Œæœˆå’Œå¹´ï¼Œä»¥åŠæ ‡è¯†æ—¶åŒºçš„åç§»é‡ã€‚\n(current-time) | (current-time time-type)\ntime-type å¿…é¡»æ˜¯ä¸Šè¿°çš„æ—¶é—´å¯¹è±¡ä¹‹ä¸€ï¼Œé»˜è®¤ä¸ºtime-utc\n(current-time) â‡’ #\u0026lt;time-utc 1198815722.473668000\u0026gt; (current-time â€™time-process) â‡’ #\u0026lt;time-process 0.120534264\u0026gt; (make-time type nsec sec)\ntype å¿…é¡»æ˜¯ä¸Šé¢åˆ—å‡ºçš„æ—¶é—´ç±»å‹ç¬¦å·ä¹‹ä¸€ã€‚ nsec è¡¨ç¤ºçº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚sec è¡¨ç¤ºç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç²¾ç¡®çš„æ•´æ•°ã€‚\n(make-time \u0026#39;time-utc 787511000 1198783214) (make-time \u0026#39;time-duration 10 5) (make-time \u0026#39;time-duration 10 -5) (time? obj)\n(time? (current-time)) â‡’ #t (time? (make-time â€™time-utc 0 0)) â‡’ #t (time? \u0026#34;1400 hours\u0026#34;) â‡’ #f (time-type time)\nè¿”å›time çš„æ—¶é—´ç±»å‹\n(time-nanosecond time)\nè¿”å›time çš„çº³ç§’\n(time-second time)\nè¿”å›time çš„ç§’\n(set-time-type! time type) | (set-time-nanosecond! time nsec) | (set-time-second! time sec)\næ¯ä¸€ä¸ªè¿‡ç¨‹éƒ½ä¼šä¿®æ”¹æ—¶é—´å¯¹è±¡ï¼Œåªæ”¹å˜å±€éƒ¨ï¼Œè€Œå…¶ä»–å€¼åˆ™ä¸å—å½±å“ã€‚ ä¾‹å¦‚ï¼Œset-time-nanosecond! åªæ›´æ”¹çº³ç§’æ—¶é—´ï¼Œè€Œä¸æ›´æ”¹ç§’æˆ–ç±»å‹ã€‚ ç‰¹åˆ«åœ°ï¼Œå½“æ—¶é—´å¯¹è±¡çš„ç±»å‹æ”¹å˜æ—¶ï¼Œå€¼å¹¶ä¸ä¼šæ›´æ”¹ã€‚\n(time=? time1 time2) | (time\u0026lt;? time1 time2) | (time\u0026gt;? time1 time2) | (time\u0026lt;=? time1 time2) | (time\u0026gt;=? time1 time2)\næ—¶é—´æ¯”è¾ƒã€‚\n(copy-time time)\nå¤åˆ¶æ—¶é—´ã€‚\n(define t1 (current-time)) (define t2 (copy-time t1)) (eq? t2 t1) â‡’ #f (eqv? (time-second t2) (time-second t1)) â‡’ #t (eqv? (time-nanosecond t2) (time-nanosecond t1)) â‡’ #t (time-difference time1 time2 ) | (time-difference! time1 time2 ) | (add-duration time timed) | (add-duration! time timed) | (subtract-duration time timed) | (subtract-duration! time timed)\nå¯¹äºtime-differenceï¼Œtime1å’Œtime2å¿…é¡»å…·æœ‰ç›¸åŒçš„æ—¶é—´ç±»å‹ï¼Œç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ å¯¹äºadd-durationï¼Œadd-durationï¼ï¼Œsubtract-durationå’Œsubtract-durationï¼ï¼Œtimedå¿…é¡»å…·æœ‰æ—¶é—´ç±»å‹time-durationï¼Œå¹¶ä¸”ç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸æ—¶é—´ç›¸åŒçš„æ—¶é—´å¯¹è±¡ã€‚ time-differenceï¼ï¼Œadd-durationï¼å’Œsubtract-durationï¼ å¯èƒ½å…·æœ‰ç ´åæ€§ï¼Œå³æ¯ä¸ªå¯¹è±¡éƒ½å¯èƒ½ä¿®æ”¹å¹¶è¿”å›å…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ–è€…å¯èƒ½åˆ†é…äº†æ–°çš„æ—¶é—´å¯¹è±¡\n(let ([delay (make-time \u0026#39;time-duration 0 1)]) (let ([t1 (current-time \u0026#39;time-monotonic)]) (sleep delay) (let ([t2 (current-time \u0026#39;time-monotonic)]) (let ([t3 (time-difference t2 t1)]) (and (eq? (time-type t3) \u0026#39;time-duration) (time\u0026gt;=? t3 delay) (time=? (add-duration t1 t3) t2) (time=? (subtract-duration t2 t3) t1)))))) â‡’ #t (current-date) | (current-date offset)\nå¦‚ä¸Šæ‰€è¿°ï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»é‡ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥è·å¾—UTC.offsetè¡¨ç¤ºUTCä»¥ä¸œä»¥ç§’ä¸ºå•ä½çš„æ—¶åŒºåç§»é‡ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\nå¦‚æœæœªæä¾›offset ï¼Œåˆ™ä½¿ç”¨å½“å‰æ—¶åŒºçš„offsetï¼Œä»¥åŠdate-dstï¼Ÿ å’Œdate-zone-nameæŠ¥å‘Šæœ‰å…³æ—¶åŒºçš„ä¿¡æ¯ã€‚ å¦‚æœæä¾›äº†åç§»é‡ï¼Œé‚£ä¹ˆdate-dstï¼Ÿ å’Œç»“æœæ—¥æœŸå¯¹è±¡ä¸Šçš„date-zone-nameéƒ½æ˜¯**#f**ã€‚\n(current-date) â‡’ #\u0026lt;date Thu Dec 27 23:23:20 2007\u0026gt; (current-date 0) â‡’ #\u0026lt;date Fri Dec 28 04:23:20 2007\u0026gt; (date-zone-name (current-date)) â‡’ \u0026#34;EST\u0026#34; or other system-provided string (date-zone-name (current-date 0)) â‡’ #f (make-date nsec sec min hour day mon year) | (make-date nsec sec min hour day mon year offset)\nnsecä»£è¡¨çº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚secä»£è¡¨ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº62çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚minä»£è¡¨åˆ†é’Ÿï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº60çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚hourå¿…é¡»æ˜¯ç²¾ç¡®çš„éè´Ÿæ•´æ•° å°äº24ã€‚dayå¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤dayâ‰¤31ã€‚ï¼ˆå®é™…ä¸Šé™å¯èƒ½å–å†³äºæœˆä»½å’Œå¹´ä»½ã€‚ï¼‰monè¡¨ç¤ºæœˆä»½å¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤monâ‰¤12ã€‚å¹´å¿…é¡» æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå®ƒåº”è‡³å°‘ä¸º1970ã€‚offsetè¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯-86400åˆ°+86400ï¼ˆå«ï¼‰èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥æŒ‡å®šUTCã€‚\n(make-date 0 0 0 0 1 1 1970 0) â‡’ #\u0026lt;date Thu Jan 1 00:00:00 1970\u0026gt; (make-date 0 30 7 9 23 9 2007 -14400) â‡’ #\u0026lt;date Sun Sep 23 09:07:30 2007\u0026gt; (date-zone-name (make-date 0 30 7 9 23 9 2007 -14400)) â‡’ #f (string? (date-zone-name (make-date 0 30 7 9 23 9 2007))) â‡’ #t (date-nanosecond date) | (date-second date) | (date-minute date) | (date-hour date) | (date-day date) | (date-month date) | (date-year date) | (date-zone-offset date)\nå¦‚å­—é¢çš„æ„æ€ï¼Œ è¿”å›æ—¥æœŸçš„å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(date-week-day date) | (date-year-day date)\né€šè¿‡è¿™äº›è¿‡ç¨‹ï¼Œå¯ä»¥ç¡®å®šä»¥date è¡¨ç¤ºçš„æ—¥æœŸæ˜¯æ˜ŸæœŸå‡ è¿˜æ˜¯æ¯å¹´çš„æŸå¤©ã€‚ week-dayæ˜¯å°äº7çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0è¡¨ç¤ºæ˜ŸæœŸæ—¥ï¼Œ1è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œä¾æ­¤ç±»æ¨ã€‚ year-dayæ˜¯å°äº367çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0ä»£è¡¨ä¸€å¹´çš„ç¬¬ä¸€å¤©ï¼ˆ1æœˆ1æ—¥ï¼‰ï¼Œ1ä»£è¡¨ç¬¬äºŒå¤©ï¼Œ2ä»£è¡¨ç¬¬ä¸‰å¤©ï¼Œä¾æ­¤ç±»æ¨ã€‚\n(time-utc-\u0026gt;date time) | (time-utc-\u0026gt;date time offset) | (date-\u0026gt;time-utc date)\nè¿™äº›è¿‡ç¨‹ç”¨äºåœ¨æ—¶é—´å’Œæ—¥æœŸå¯¹è±¡ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ time-utc-\u0026gt;dateçš„æ—¶é—´å‚æ•°å¿…é¡»å…·æœ‰time-type utcï¼Œdate-\u0026gt;time-utcå§‹ç»ˆè¿”å›å¸¦æœ‰time-type utcçš„æ—¶é—´å¯¹è±¡ã€‚\nå¯¹äºtime-utc-\u0026gt;dateï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„ç§’æ•°ä¸­çš„æ—¶åŒºåç§»ï¼Œå¦‚æœ¬èŠ‚å¼€å¤´æ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\n(date-and-time) | (date-and-time date)\nå­—ç¬¦ä¸²å§‹ç»ˆé‡‡ç”¨ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºçš„æ ¼å¼ï¼Œé•¿åº¦å§‹ç»ˆä¸º24ã€‚\n(date-and-time) â‡’ \u0026#34;Fri Jul 13 13:13:13 2001\u0026#34; (defined (make-date 0 0 0 0 1 1 2007 0)) (date-and-time d) â‡’ \u0026#34;Mon Jan 01 00:00:00 2007\u0026#34; (sleep time)\ntime å¿…é¡»æ˜¯ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ sleep å¯¼è‡´è°ƒç”¨çº¿ç¨‹åœ¨å¤§çº¦ç”±æ—¶é—´å¯¹è±¡æŒ‡ç¤ºçš„æ—¶é—´é‡å†…æš‚åœæ“ä½œï¼Œé™¤éè¯¥è¿›ç¨‹æ”¶åˆ°ä¸­æ–­ç¡çœ æ“ä½œçš„ä¿¡å·ã€‚ å®é™…ç¡çœ æ—¶é—´å–å†³äºç³»ç»Ÿæ—¶é’Ÿçš„ç²’åº¦ä»¥åŠç³»ç»Ÿè¿è¡Œå…¶ä»–çº¿ç¨‹å’Œè¿›ç¨‹çš„ç¹å¿™ç¨‹åº¦ã€‚\næ—¶é—´å’Œç»Ÿè®¡ (time expr) timeæ±‚å€¼expr ï¼Œå¹¶ä¸”ä½œä¸ºå‰¯ä½œç”¨ï¼Œæ‰“å°ï¼ˆåˆ°console-outputç«¯å£ï¼‰cpuæ—¶é—´é‡ï¼Œå®æ—¶æ—¶é—´é‡ï¼Œåˆ†é…çš„å­—èŠ‚æ•°ä»¥åŠä¸æ±‚å€¼expr ç›¸å…³çš„æ”¶é›†å¼€é”€ã€‚\n\u0026gt; (time (collect)) (time (collect)) 1 collection 1 ms elapsed cpu time, including 1 ms collecting 1 ms elapsed real time, including 1 ms collecting 160 bytes allocated, including 8184 bytes reclaimed (cpu-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥æ¶ˆè€—çš„cpuæ—¶é—´é‡ã€‚\nè¯¥é‡ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ è¯¥æ•°é‡åŒ…æ‹¬â€œsystemâ€æ—¶é—´å’Œâ€œuserâ€æ—¶é—´ï¼Œå³ä»£è¡¨è¿›ç¨‹åœ¨å†…æ ¸ä¸­èŠ±è´¹çš„æ—¶é—´ä»¥åŠåœ¨è¿›ç¨‹æœ¬èº«ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚\n(real-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥ç»è¿‡çš„å®æ—¶æ—¶é—´\nä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´æ€»é‡\n(bytes-allocated) | (bytes-allocated g)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ•°\nå¦‚æœæä¾›äº†g ï¼Œåˆ™bytes-allocatedè¿”å›æŒ‡å®šgenerationä¸­å½“å‰ä¸ºSchemeå¯¹è±¡åˆ†é…çš„å­—èŠ‚æ•°ã€‚ g å¿…é¡»ä¸ºéè´Ÿç²¾ç¡®æ•´æ•°ï¼Œä¸”ä¸å¾—å¤§äºæœ€å¤§éé™æ€generationï¼Œå³ï¼Œcollect-maximum-generationè¿”å›çš„å€¼æˆ–ç¬¦å·ä¸ºstaticã€‚ å¦‚æœæœªæä¾›g ï¼Œåˆ™bytes-allocatedè¿”å›æ‰€æœ‰generationä¸­åˆ†é…çš„å­—èŠ‚æ€»æ•°ã€‚\n(initial-bytes-allocated)\nè¿”å›ï¼šåŠ è½½å¯åŠ¨æ–‡ä»¶ååˆ†é…çš„æ€»å­—èŠ‚æ•°\n(bytes-deallocated)\nè¿”å›ï¼šåƒåœ¾å›æ”¶å™¨é‡Šæ”¾çš„æ€»å­—èŠ‚æ•°\né€šè¿‡å°†ï¼ˆbytes-deallocatedï¼‰å’Œï¼ˆbytes-allocatedï¼‰ç›¸åŠ å¹¶å‡å»ï¼ˆinitial-bytes-allocatedï¼‰ï¼Œå¯ä»¥è·å¾—å½“å‰è¿›ç¨‹åˆ†é…çš„æ€»å­—èŠ‚æ•°ï¼ˆæ— è®ºæ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ï¼‰ã€‚\n(current-memory-bytes)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ€»æ•°ï¼ŒåŒ…æ‹¬å¼€é”€.\ncurrent-memory-bytesè¿”å›å †çš„æ€»å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä¸ä»…åŒ…æ‹¬Schemeå¯¹è±¡å ç”¨çš„å­—èŠ‚ï¼Œè¿˜åŒ…æ‹¬å„ç§å½¢å¼çš„å¼€é”€ï¼ˆåŒ…æ‹¬ç¢ç‰‡å’Œä¿ç•™ä½†å½“å‰ä¸å ç”¨çš„å†…å­˜ï¼‰ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿä¸­å½“å‰è¿›ç¨‹çš„å †å†…å­˜é‡çš„å‡†ç¡®åº¦é‡å€¼\n(maximum-memory-bytes)\nè¿”å›ï¼šåˆ†é…è¿‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å¼€é”€\n(reset-maximum-memory-bytes!)\nå°†å †å†…å­˜çš„æœ€å¤§è®°å½•å€¼é‡ç½®ä¸ºå½“å‰å †å¤§å°\n(collections)\nè¿”å›ï¼šåˆ°ç›®å‰ä¸ºæ­¢çš„åƒåœ¾å›æ”¶æ¬¡æ•°\n(statistics)\nè¿”å›ï¼šåŒ…å«å½“å‰ç»Ÿè®¡ä¿¡æ¯çš„sstatsè®°å½•\nstatisticså°†å„ç§æ—¶é—´å’Œåˆ†é…ç»Ÿè®¡ä¿¡æ¯æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªsstatsè®°å½•ã€‚ sstatsè®°å½•å…·æœ‰ä»¥ä¸‹å­—æ®µï¼š\ncpu, æ¶ˆè€—çš„cpuæ—¶é—´ real, ç»è¿‡çš„æ—¶é—´ bytes, åˆ†é…çš„å­—èŠ‚æ•° gc-count, gcæ¬¡æ•° gc-real, gcç»å†çš„æ—¶é—´ gc-bytes, gcå›æ”¶çš„å­—èŠ‚æ•° æ‰€æœ‰å€¼éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç®—\nstatisticså¯ä»¥åƒå¦‚ä¸‹å®šä¹‰ï¼š\n(define statistics (lambda () (make-sstats (current-time â€™time-thread) (current-time â€™time-monotonic) (- (+ (bytes-allocated) (bytes-deallocated)) (initial-bytes-allocated)) (collections) (current-time â€™time-collector-cpu) (current-time â€™time-collector-real) (bytes-deallocated)))) (make-sstats cpu real bytes gc-count gc-cpu gc-real gc-bytes) è¿”å›ï¼šsstatsè®°å½•\n(sstats-cpu s) | (sstats-real s) | (sstats-bytes s) | (sstats-gc-count s) | (sstats-gc-cpu s) | (sstats-gc-real s) | (sstats-gc-bytes s)\nè¿”å›ï¼šs å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(set-sstats-cpu! s new-value) | (set-sstats-real! s new-value) | (set-sstats-bytes! s new-value) | (set-sstats-gc-count! s new-value) | (set-sstats-gc-cpu! s new-value) | (set-sstats-gc-real! s new-value) | (set-sstats-gc-bytes! s new-value)\nè®¾ç½®å¯¹åº”éƒ¨åˆ†çš„å€¼\n(sstats-difference s1 s2)\næ¯”è¾ƒä¸¤ä¸ªsstats\nenable-object-counts\nenable-object-countsçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒç¡®å®šæ”¶é›†å™¨åœ¨è¿è¡Œæ—¶æ˜¯å¦è®°å½•å¯¹è±¡è®¡æ•°ï¼Œä»è€Œç¡®å®šè¿‡ç¨‹å¯¹è±¡è®¡æ•°è¿”å›çš„object-countsæ˜¯å¦å‡†ç¡®ã€‚ ç”±äºå¯ç”¨å¯¹è±¡è®¡æ•°ä¼šå¢åŠ æ”¶é›†çš„å¼€é”€ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹è¯¥å‚æ•°è®¾ç½®ä¸º#fã€‚\n(object-counts)\nè¿‡ç¨‹object-countsxè¿”å›ä¸€ä¸ªåµŒå¥—çš„å…³è”åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨è¡¨ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨å®ä¾‹çš„æ¯ä¸ªå †åˆ†é…çš„åŸå§‹ç±»å‹å’Œè®°å½•ç±»å‹åˆ†é…çš„å¯¹è±¡è®¡æ•°å’Œå­—èŠ‚ã€‚ ï¼ˆå †åˆ†é…çš„åŸºæœ¬ç±»å‹åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œpairå’Œå‘é‡ï¼Œä½†ä¸åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œfixnumæˆ–å­—ç¬¦ã€‚ï¼‰ä»…å½“enable-object-countsxxä¸º#tæ—¶ï¼Œæ”¶é›†å™¨æ‰ä¼šæ”¶é›†å¯¹è±¡è®¡æ•°ã€‚\nobject-countsxè¿”å›çš„å…³è”åˆ—è¡¨å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š ((type (generation count . bytes) \u0026hellip;) \u0026hellip;)\ntypeæ˜¯åŸå§‹ç±»å‹çš„åç§°ï¼Œä»¥ç¬¦å·ï¼ˆä¾‹å¦‚ï¼Œå¯¹ï¼‰è¡¨ç¤ºï¼Œæˆ–è€…æ˜¯record-typeæè¿°ç¬¦ï¼ˆrtdï¼‰ã€‚ generationæ˜¯ä»‹äº0å’Œï¼ˆcollect-maximum-generationï¼‰çš„å€¼ï¼ˆåŒ…å«åœ¨å†…ï¼‰æˆ–è¡¨ç¤ºé™æ€ç”Ÿæˆçš„ç¬¦å·staticä¹‹é—´çš„éè´Ÿå›ºå®šç¼–å·ã€‚ countå’Œå­—èŠ‚æ˜¯éè´Ÿçš„fixnumã€‚\n(collect-request-handler void) (enable-object-counts #t) (define-record-type frob (fields x)) (define x (make-frob (make-frob #f))) (collect 3 3) (cdr (assoc 3 (cdr (assoc (record-type-descriptor frob) (object-counts))))) =\u0026gt; (2. 16) æˆæœ¬ä¸­å¿ƒ Cost Centers æˆæœ¬ä¸­å¿ƒç”¨äºåœ¨æ±‚å€¼é€‰å®šçš„ä»£ç æ®µæ—¶è·Ÿè¸ªåˆ†é…çš„å­—èŠ‚ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤å’Œ/æˆ–ç»è¿‡çš„CPUæ—¶é—´ã€‚ æˆæœ¬ä¸­å¿ƒæ˜¯é€šè¿‡è¿‡ç¨‹make-cost-centeråˆ›å»ºçš„ï¼Œè€Œæˆæœ¬æ˜¯é€šè¿‡with-cost-centerè¿‡ç¨‹è¿›è¡Œè·Ÿè¸ªçš„ã€‚\nä»…ä¸ºæ­¤ç›®çš„ä»£ç è·Ÿè¸ªåˆ†é…å’ŒæŒ‡ä»¤è®¡æ•°ã€‚ è¯¥å·¥å…·ç”±ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼šgenerate-allocation-countså’Œgenerate-instruction-countsã€‚ é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ£€æµ‹ã€‚ å†…ç½®ç¨‹åºæ²¡æœ‰æ£€æµ‹ï¼Œè§£é‡Šä»£ç æˆ–éSchemeä»£ç ä¹Ÿæ²¡æœ‰ã€‚ ä»…å½“è¿‡ç¨‹with-cost-centerçš„å¯é€‰å‚æ•°*timed?*æœ‰å€¼ä¸”ä¸ä¸ºfalseæ—¶æ‰ä¼šè·Ÿè¸ªç»å†çš„æ—¶é—´\nwith-cost-centerè¿‡ç¨‹å³ä½¿åœ¨ä½¿ç”¨åŒä¸€æˆæœ¬ä¸­å¿ƒé‡æ–°è¾“å…¥ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä½¿ç”¨å¹¶é€šè¿‡ç»§ç»­è°ƒç”¨é€€å‡ºæˆ–é‡æ–°è¾“å…¥ä¸€æ¬¡æˆ–å¤šæ¬¡åï¼Œä¹Ÿè¦éµå¾ªä¸Šè¿°æ³¨æ„äº‹é¡¹æ¥å‡†ç¡®è·Ÿè¸ªæˆæœ¬ã€‚\ngenerate-allocation-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªåˆ†é…ç‚¹æ’å…¥ä¸€å°æ®µæŒ‡ä»¤ï¼Œä»¥è·Ÿè¸ªå‘ç”Ÿçš„åˆ†é…é‡ã€‚æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\ngenerate-instruction-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨å°†åœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªå—ä¸­æ’å…¥ç®€çŸ­çš„æŒ‡ä»¤åºåˆ—ï¼Œä»¥è·Ÿè¸ªè¯¥å—æ‰§è¡Œçš„æŒ‡ä»¤æ•°ã€‚ æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\n(make-cost-center)\nè¿”å›: æ–°çš„æˆæœ¬ä¸­å¿ƒ\n(with-cost-center cost-center thunk) | (with-cost-center timed? cost-center thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—é›¶å‚æ•°çš„è¿‡ç¨‹ã€‚ with-cost-centerè°ƒç”¨ä¸å¸¦å‚æ•°çš„thunk å¹¶è¿”å›å…¶å€¼ã€‚ å®ƒè¿˜å¯ä»¥åŠ¨æ€è®¡ç®—åˆ†é…çš„å­—èŠ‚æ•°ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤ä»¥åŠåœ¨è®¡ç®—thunk è°ƒç”¨æ—¶æ‰€ç»è¿‡çš„cpuæ—¶é—´ï¼Œå¹¶å°†è·Ÿè¸ªçš„æˆæœ¬æ·»åŠ åˆ°æˆæœ¬ä¸­å¿ƒè®°å½•ä¸­ã€‚\nå¦‚ä¸Šæ‰€è¿°ï¼Œä»…å¯¹äºå°†å‚æ•°generate-allocation-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªåˆ†é…è®¡æ•°ï¼Œå¹¶ä¸”ä»…å¯¹å°†generate-instruction-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªæŒ‡ä»¤è®¡æ•°ã€‚ ä»…åœ¨æä¾›timed? ä¸”ä¸ä¸ºfalseçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè·Ÿè¸ªcpuæ—¶é—´ï¼Œå…¶ä¸­åŒ…æ‹¬åœ¨å·²æµ‹é‡çš„ä»£ç ï¼Œæœªæµ‹é‡ä»£ç å’ŒéSchemeä»£ç ä¸­èŠ±è´¹çš„cpuæ—¶é—´ã€‚\n(cost-center-instruction-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„æŒ‡ä»¤æ•°\n(cost-center-allocation-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„å·²åˆ†é…å­—èŠ‚æ•°\n(cost-center-time cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„CPUæ—¶é—´\n(reset-cost-center! cost-center)\næ­¤è¿‡ç¨‹å°†æˆæœ¬ä¸­å¿ƒè®°å½•çš„æˆæœ¬é‡ç½®ä¸ºé›¶ã€‚\nå‚æ•° æœ¬èŠ‚ä»‹ç»äº†ç”¨äºåˆ›å»ºå’Œæ“ä½œå‚æ•°çš„æœºåˆ¶ã€‚ å¯ä»¥ä½¿ç”¨make-parameteræ–¹ä¾¿åœ°åˆ›å»ºæ–°å‚æ•°ã€‚ ä½†æ˜¯ï¼Œé™¤äº†å®ƒä»¬çš„è¡Œä¸ºå¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½å°†å‚æ•°ä¸å…¶ä»–è¿‡ç¨‹åŒºåˆ†å¼€ã€‚ å¦‚æœè°ƒç”¨å‚æ•°æ—¶å¿…é¡»é‡‡å–æ¯”é€šè¿‡make-parameteræœºåˆ¶å®¹æ˜“å®¹çº³çš„æ›´ä¸ºå¤æ‚çš„åŠ¨ä½œï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨case-lambdaå®šä¹‰è¯¥å‚æ•°\n(make-parameter object) | (make-parameter object procudure)\nmake-parameteræ¥å—ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å†…éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯åº”ç”¨äºåˆå§‹å€¼å’Œæ‰€æœ‰åç»­å€¼çš„è¿‡æ»¤å™¨ã€‚ è¿‡æ»¤å™¨åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœè¯¥å€¼ä¸åˆé€‚ï¼Œåˆ™è¿‡æ»¤å™¨åº”å¼•å‘å¼‚å¸¸æˆ–å°†å€¼è½¬æ¢ä¸ºæ›´åˆé€‚çš„å½¢å¼ã€‚\nä¾‹å¦‚ï¼Œprint-lengthçš„é»˜è®¤å®šä¹‰å¦‚ä¸‹ï¼š\n(define print-length (make-parameter #f (lambda (x) (unless (or (not x) (and (fixnum? x) (fx\u0026gt;= x 0))) (assertion-violationf â€™print-length \u0026#34;~s is not a positive fixnum or #f\u0026#34; x)) x))) (print-length) â‡’ #f (print-length 3) (print-length) â‡’ 3 (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123...)\u0026#34; (print-length #f) (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123456)\u0026#34; make-parameterçš„å®šä¹‰ä½¿ç”¨case-lambdaå¾ˆç®€å•ï¼š\n(define make-parameter (case-lambda [(init guard) (let ([v (guard init)]) (case-lambda [() v] [(u) (set! v (guard u))]))] [(init) (make-parameter init (lambda (x) x))])) (parameterize ((param expr) \u0026hellip;) body1 body2 \u0026hellip;)\nä½¿ç”¨è¯­æ³•å½¢å¼parameterizeï¼Œå¯ä»¥ä»¥ç±»ä¼¼äºæ™®é€šå˜é‡çš„fluid-letçš„æ–¹å¼æ›´æ”¹å‚æ•°çš„å€¼ã€‚ åœ¨è®¡ç®—bodyæ—¶ï¼Œå°†æ¯ä¸ªparam è®¾ç½®ä¸ºç›¸åº”çš„expr çš„å€¼ã€‚\n(define test (make-parameter 0)) (test) â‡’ 0 (test 1) (test) â‡’ 1 (parameterize ([test 2]) (test)) â‡’ 2 (test) â‡’ 1 (parameterize ([test 2]) (test 3) (test)) â‡’ 3 (test) â‡’ 1 (define k (lambda (x) x)) (begin (set! k (call/cc k)) â€™k) â‡’ k (parameterize ([test 2]) (test (call/cc k)) (test)) â‡’ k (test) â‡’ 1 (k3) â‡’3 (test) â‡’ 1 è™šæ‹Ÿå¯„å­˜å™¨Virtual registers ç¼–è¯‘å™¨æ”¯æŒä¸€ç»„æœ‰é™çš„è™šæ‹Ÿå¯„å­˜å™¨ ï¼Œä»¥ä¾›éœ€è¦é«˜é€Ÿï¼Œå…¨å±€å’Œå¯å˜å­˜å‚¨ä½ç½®çš„ç¨‹åºä½¿ç”¨ã€‚ å¼•ç”¨æˆ–åˆ†é…è™šæ‹Ÿå¯„å­˜å™¨å¯èƒ½æ¯”è®¿é—®å¯åˆ†é…çš„å±€éƒ¨å˜é‡æˆ–å…¨å±€å˜é‡æ›´å¿«ï¼Œå¹¶ä¸”è®¿é—®æ—¶æ°¸è¿œä¸ä¼šæ¯”å®ƒä»¬æ›´æ…¢ï¼Œè€Œä¸”è¿™æ ·åšçš„ä»£ç åºåˆ—é€šå¸¸æ›´å°ã€‚ åˆ†é…å¯èƒ½ä¼šæ˜¾è‘—åŠ å¿«ï¼Œå› ä¸ºä¸éœ€è¦è·Ÿè¸ªä»è™šæ‹Ÿå¯„å­˜å™¨åˆ°å¹´è½»å¯¹è±¡çš„æŒ‡é’ˆï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨äºè¾ƒæ—©ä¸€ä¸–ä»£ä¸­çš„å¯å˜ä½ç½®ã€‚ åœ¨ç³»ç»Ÿçš„çº¿ç¨‹ç‰ˆæœ¬ä¸Šï¼Œè™šæ‹Ÿå¯„å­˜å™¨æ˜¯â€œæ¯ä¸ªçº¿ç¨‹â€çš„ï¼Œå› æ­¤å¯ä»¥ä»¥æ¯”çº¿ç¨‹å‚æ•°ä½å»‰çš„æ–¹å¼ç”¨ä½œthread-localå­˜å‚¨ã€‚\nè¯¥æ¥å£åŒ…å«ä¸‰ä¸ªè¿‡ç¨‹ï¼švirtual-register-countï¼ˆè¿”å›è™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡ï¼‰ï¼Œset-virtual-register!ï¼ˆè®¾ç½®æŒ‡å®šçš„è™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰å’Œvirtual-registerï¼ˆè·å–æŒ‡å®šè™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰ã€‚\nè™šæ‹Ÿå¯„å­˜å™¨ç”±å°äºè™šæ‹Ÿå¯„å­˜å™¨æ•°é‡çš„éè´Ÿfixnumç´¢å¼•æŒ‡å®šã€‚ ä¸ºäº†è·å¾—set-virtual-register!å’Œvirtual-registerçš„æœ€ä½³æ€§èƒ½ï¼Œç´¢å¼•åº”è¯¥æ˜¯ç›´æ¥åµŒå…¥åœ¨è°ƒç”¨ä¸­çš„å¸¸é‡ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡å¯¹è°ƒç”¨çš„ä¼˜åŒ–æ¥ä¼ æ’­ï¼‰ã€‚ ä¸ºäº†é¿å…å°†è¿™äº›å¸¸é‡æ”¾åœ¨æºä»£ç ä¸­ï¼Œç¨‹åºå‘˜åº”è€ƒè™‘ä½¿ç”¨æ ‡è¯†ç¬¦å®ä¸ºè™šæ‹Ÿå¯„å­˜å™¨å‘½åï¼Œä¾‹å¦‚ï¼š\n(define-syntax current-state (identifier-syntax [id (virtual-register 0)] [(set! id e) (set-virtual-register! 0 e)])) (set! current-state \u0026#39;start) current-state â‡’ start è™šæ‹Ÿå¯„å­˜å™¨å¿…é¡»è¢«è§†ä¸ºåº”ç”¨ç¨‹åºçº§èµ„æºï¼Œå³ï¼Œæ‰“ç®—ç”±å¤šä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨çš„åº“é€šå¸¸ä¸åº”ä½¿ç”¨è™šæ‹Ÿå¯„å­˜å™¨ï¼Œä»¥é¿å…ä¸åº”ç”¨ç¨‹åºä½¿ç”¨å¯„å­˜å™¨å†²çªã€‚\n(virtual-register-count)\nä»9.0ç‰ˆå¼€å§‹ï¼Œè™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡è®¾ç½®ä¸º16ã€‚é™¤éé€šè¿‡æºé‡æ–°ç¼–è¯‘Chez Schemeï¼Œå¦åˆ™æ— æ³•æ›´æ”¹ã€‚\n(set-virtual-register! k x)\n**set-virtual-register!**å°†x å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­ã€‚ k å¿…é¡»æ˜¯å°äºï¼ˆvirtual-register-countï¼‰çš„å€¼çš„éè´Ÿfixnumã€‚\n(virtual-register k)\nvirtual-registerè¿”å›æœ€åä¸€æ¬¡å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­çš„å€¼ï¼ˆåœ¨å½“å‰çº¿ç¨‹ä¸Šï¼‰ã€‚\nç¯å¢ƒæŸ¥è¯¢å’Œè®¾ç½®Environmental Queries and Settings (scheme-version)\nChez Schemeçš„ç‰ˆæœ¬\n(threaded?)\nè¿”å›ï¼š#tï¼ˆå¦‚æœåœ¨ç³»ç»Ÿä¸ºçº¿ç¨‹ç‰ˆæœ¬ï¼‰ï¼Œå¦åˆ™è¿”å›#f\n(get-process-id)\nè¿”å›ï¼šå½“å‰è¿›ç¨‹çš„PID\n(getenv key)\nè¿”å›ï¼šç¯å¢ƒä¸­key çš„å€¼ï¼Œæˆ– #f\n(getenv \u0026#34;HOME\u0026#34;) â‡’ \u0026#34;/u/freddy\u0026#34; (putenv key value)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n(putenv \u0026#34;SCHEME\u0026#34; \u0026#34;rocks!\u0026#34;) (getenv \u0026#34;SCHEME\u0026#34;) â‡’ \u0026#34;rocks!\u0026#34; (get-registry key)\nè¿”å›ï¼škey çš„æ³¨å†Œè¡¨å€¼ï¼Œæˆ–è€…**#f**\n(put-registry! key val) | (remove-registry! key)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n","id":20,"section":"posts","summary":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;) è¿”å›ï¼šæœªæŒ‡å®š è­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢","tags":["scheme"],"title":"ç³»ç»Ÿæ“ä½œ(System Operations in Chez Scheme)","uri":"https://lvsq.net/2020/02/system-operations/","year":"2020"},{"content":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›trueçš„è°“è¯ã€ä»¥åŠæ¯ä¸ªå­—æ®µçš„è®¿é—®procedureå’Œé’ˆå¯¹å¯å˜å­—æ®µçš„èµ‹å€¼procedureã€‚æ€»çš„æ¥è¯´ï¼Œä¸Javaä¸­çš„POJOç±»æ¯”è¾ƒç›¸ä¼¼ï¼Œä¸è¿‡ä¸ç”¨è‡ªå®šä¹‰getterå’Œsetteræ–¹æ³•ï¼Œè¿™ä¸Kotlinå€’ä¸ºç±»ä¼¼ï¼Œä¾‹å¦‚ï¼š\n(define-record-type point (fields x y)) åˆ›å»ºäº†ä¸€ä¸ªåä¸ºpointçš„recordç±»å‹ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå­—æ®µxå’Œyï¼Œå’Œå¦‚ä¸‹å‡ ä¸ªå®šä¹‰å¼ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š\n(make-point x y) æ„é€ å‡½æ•° (point? obj) è°“è¯ (point-x p) å­—æ®µxçš„è®¿é—®å™¨ (point-y p) å­—æ®µyçš„è®¿é—®å™¨ é»˜è®¤ä¸‹ï¼Œå­—æ®µæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å¯ä»¥å£°æ˜ä¸ºå¯å˜çš„ï¼ˆmutableï¼‰ã€‚å¦‚ä¸‹å®šä¹‰pointä¸­ï¼Œå­—æ®µxæ˜¯å¯å˜çš„ï¼Œä½†yç»´æŒä¸å˜ï¼š\n(define-record-type point (fields (mutable x) y)) å½“ç„¶äº¦å¯æ˜¾å¼åœ°å°†å­—æ®µå£°æ˜ä¸ºä¸å¯å˜çš„ï¼š\n(define-record-type point (fields (mutable x) (immutable y))) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdefine-record-typeé™¤äº†ç”Ÿæˆäº†ä¸Šè¿°çš„å‡ ä¸ªå®šä¹‰å¼ä¹‹å¤–ï¼Œè¿˜ä¸ºå­—æ®µxå¢åŠ äº†ä¸€ä¸ªèµ‹å€¼è¿‡ç¨‹ï¼š\n(point-x-set! p x)\nè¯¥èµ‹å€¼è¿‡ç¨‹å¯ä»¥ç”¨äºæ”¹å˜xçš„å†…å®¹\n(define p (make-point 36 -17)) (point-x-set! p (- (point-x p) 12)) (point-x p) =\u0026gt; 24 è‡ªåŠ¨ç”Ÿæˆçš„å‡ ä¸ªå®šä¹‰å¼æ˜¯å…è®¸æ”¹å˜åç§°çš„ï¼Œä¸‹é¢çš„pointå®šä¹‰å¼ï¼Œå…¶æ„é€ å‡½æ•°åä¸ºmkpoint, è°“è¯ä¸ºispoint?ï¼Œxå’Œyçš„è®¿é—®å™¨åˆ†åˆ«ä¸ºx-valå’Œy-val, xçš„èµ‹å€¼å™¨ä¸ºset-x-val!\n(define-record-type (point mkpoint ispoint?) (fields (mutable x x-val set-x-val!) (immutable y y-val))) é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ä¸€ä¸ªrecord definitionåˆ›å»ºä¸€ä¸ªæ–°ç±»å‹ï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥ç”¨Javaæ¥è§£é‡Šï¼Œå³å¯¹äºåŒä¸€ä¸ªPOJOç±»newå‡ºä¸¤ä¸ªå®ä¾‹ï¼Œä½†è¿™ä¸¤ä¸ªå®ä¾‹å¹¶ä¸èƒ½equalï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define (f p) (define-record-type point (fields x y)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #f ç¬¬ä¸€ä¸ªfçš„è°ƒç”¨å³(f \u0026lsquo;make)è¿”å›ä¸€ä¸ªpointç±»å‹çš„pï¼Œå°†pä¼ é€’ç»™ç¬¬äºŒä¸ªfï¼Œä½†pæ˜¯ç”±ç¬¬ä¸€ä¸ªè°ƒç”¨ç”Ÿæˆçš„ç±»å‹ï¼Œæ‰€ä»¥point?è¿”å›#fã€‚æŒ‰ç…§SICPçš„è¯´æ³•ï¼Œè¿™ä¸¤ä¸ªdefine-record-typeå¹¶ä¸åœ¨ä¸€ä¸ªç¯å¢ƒä¸­ï¼Œåªæ˜¯åå­—ä¸€æ ·è€Œå·²ã€‚\né»˜è®¤çš„ç”Ÿäº§è¡Œä¸º(generative behavior)æˆ–è®¸å¯ä»¥ç”±è®°å½•å®šä¹‰å¼ä¸­çš„nongenerativeå­å¥æ¥é‡è½½ï¼š\n(define (f p) (define-record-type point (fields x y) (nongenerative)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #t ä»¥è¿™ç§æ–¹å¼åˆ›å»ºçš„è®°å½•ç±»å‹ä»ç„¶ä¸åŒäºç”±å®šä¹‰å‡ºç°åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¸­åˆ›å»ºçš„è®°å½•ç±»å‹ï¼Œå³ä½¿è¿™äº›å®šä¹‰åœ¨è¯­æ³•ä¸Šæ˜¯ç›¸åŒçš„ï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative)) (point? p)) (g (f)) =\u0026gt; #f ç”šè‡³å¯ä»¥é€šè¿‡åœ¨nongenerativeå­å¥ä¸­åŒ…å«uidï¼ˆå”¯ä¸€idï¼‰æ¥è¦†ç›–å®ƒï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (point? p)) (g (f)) =\u0026gt; #t è®°å½•ç±»å‹å¯ä»¥å®šä¹‰ä¸ºæœ‰parentå­å¥çš„å­ç±»å‹ï¼Œå³ä¸€ä¸ªè®°å½•ç±»å‹å¯ä»¥å£°æ˜ä¸ºæŸä¸€ä¸ªè®°å½•ç±»å‹çš„å­ç±»å‹ï¼Œå¦‚æœæŒ‡å®šäº†çˆ¶ç±»å‹ï¼Œåˆ™å­ç±»å‹å°†ç»§æ‰¿çˆ¶ç±»å‹æ‰€æœ‰å­—æ®µï¼Œä¸”å­ç±»å‹çš„æ¯ä¸ªå®ä¾‹éƒ½è¢«è§†ä¸ºçˆ¶ç±»å‹çš„å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»å‹çš„è®¿é—®å™¨å’Œå­—æ®µç­‰ç­‰ã€‚\n(define-record-type point (fields x y)) (define-record-type cpoint (parent point) (fields color)) (define cp (make-cpoint 3 4 \u0026#39;red)) (point? (make-cpoint 3 4 \u0026#39;red)) =\u0026gt; #t (cpoint? (make-point 3 4)) =\u0026gt; #f (define cp (make-cpoint 3 4 \u0026#39;red)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (cpoint-color cp) =\u0026gt; red åˆ°ç›®å‰ä¸ºæ­¢ï¼Œdefine-record-typeå®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°æ¥å—recordåŒ…å«çš„å­—æ®µä¸€æ ·å¤šçš„å‚æ•°ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥é‡å†™é»˜è®¤å€¼ï¼Œè¿™é‡Œéœ€è¦å¼•å…¥protocolå­å¥ï¼Œä»¥ä¸‹å®šä¹‰å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå­—æ®µçš„ç‚¹è®°å½•ï¼šxï¼Œyå’Œdï¼Œå…¶ä¸­dè¡¨ç¤ºè·åŸç‚¹çš„ä½ç§»ã€‚æ„é€ å‡½æ•°ä»ç„¶åªæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå³xå’Œyå€¼ï¼Œå¹¶å°†dåˆå§‹åŒ–ä¸ºxå’Œyå¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚\n(define-record-type point (fields x y d) (protocol (lambda (new) (lambda (x y) (new x y (sqrt (+ (* x x) (* y y)))))))) (define p (make-point 3 4)) (point-x p) =\u0026gt; 3 (point-y p) =\u0026gt; 4 (point-d p) =\u0026gt; 5 å¦å¤–ï¼Œå­ç±»å‹çš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•°é¡ºåºæ˜¯ä¸å¯æ”¹å˜çš„ï¼Œå³å…ˆæ˜¯çˆ¶ç±»å‹æ„é€ å‡½æ•°çš„å­—æ®µï¼Œç„¶åæ‰æ˜¯å­ç±»å‹çš„å‚æ•°ï¼Œå¦‚æœéœ€è¦æ”¹å˜å­ç±»å‹çš„æ„é€ å‡½æ•°çš„å‚æ•°é¡ºåºè¯¥å¦‚ä½•å‘¢ï¼Ÿ\n(define-record-type cpoint (parent point) (fields color) (protocol (lambda (pargs-\u0026gt;new) (lambda (x c y) ((pargs-\u0026gt;new x y) c))))) (define cp (make-cpoint 3 \u0026#39;red 4)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (point-d cp) =\u0026gt; 5 (cpoint-color cp) =\u0026gt; red æœ€åæ¥çœ‹çœ‹define-record-typeçš„è¯­æ³•å½¢å¼ï¼š\nsyntax: (define-record-type record-name clause \u0026hellip;)\nsyntax: (define-record-type (record-name constructor pred) clause \u0026hellip;)\nFields clauseè¯­æ³•å½¢å¼:\n(fields field-spec \u0026hellip;)\nfield-specå¿…é¡»æ˜¯ä¸‹é¢5ä¸ªä¸­çš„ä¸€ä¸ª:\nfield-name (immmutable field-name) (mutable field-name) (immmutable field-name accessor-name) (mutable field-name accessor-name mutator-name) define-record in Chez Scheme Chez Schemeä¾ç„¶æ”¯æŒ$R^6RS$ä¸­ä¼ ç»Ÿçš„recordç±»å‹çš„å®šä¹‰ï¼Œå¦å¤–è¿˜æä¾›ä¸€ä¸ªæ–°çš„è¯­æ³•ï¼Œå³define-recordï¼Œå…¶è¯­æ³•å½¢å¼ä¸define-record-typeä¸€æ ·ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œdefine-recordä¸­çš„å­—æ®µé»˜è®¤æ˜¯å¯å˜çš„ï¼Œè¿™ä¸$R^6RS$ä¸­çš„recordç›¸åï¼Œå› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªè®°å½•ç±»å‹æ—¶ï¼ŒåŒæ—¶ä¼šå®šä¹‰ä¸‹åˆ—è¿‡ç¨‹ï¼š\n(define-record point (x y)) (make-point x y) ;;\tconstructor (point? obj) ;;\tpredicate (point-x p) ;;\taccessor for field x (point-y p) ;;\taccessor for field y (set-point-x! p obj) ;;\tmutator for field x (set-point-y! p obj) ;;\tmutator for field y é€šè¿‡å¯¹define-record-typeçš„äº†è§£ï¼Œå¯ä»¥å‘ç°å…¶éå¸¸OOï¼Œsmalltalkæ˜¯å¦å—å…¶å½±å“ä¸å¾—è€ŒçŸ¥ï¼Œè‡³å°‘ç»è¿‡çºµå‘æ¯”è¾ƒå¯¹äºæˆ‘ä»¬å­¦ä¹ æŠ€æœ¯å¤§æœ‰è£¨ç›Šã€‚\n","id":21,"section":"posts","summary":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›tr","tags":["scheme"],"title":"Schemeè¯­æ³•define-record-typeä»‹ç»","uri":"https://lvsq.net/2020/02/define-record-type/","year":"2020"},{"content":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åœ¨ Chez Scheme ä¸­ä»¥â€œå¾®æ¨¡å—â€çº§åˆ«ä½¿ç”¨ï¼Œå› ä¸º Chez Scheme ä¸­çš„æ¨¡å—å’Œ import å½¢å¼å±äºå®šä¹‰ï¼Œå¹¶ä¸”å¯ä»¥å‡ºç°åœ¨å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»æ„ä½ç½®ï¼ŒåŒ…æ‹¬åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“æˆ–å…¶ä»–å±€éƒ¨ä½œç”¨åŸŸä¸­ã€‚\nå¾®æ¨¡å—ä¸å‡½æ•°å­°å¥½ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯è§†æƒ…å†µè€Œå®šï¼Ÿï¼Ÿï¼Ÿ\næ¨¡å—æ§åˆ¶ç»‘å®šçš„å¯è§æ€§ï¼Œå¯ä»¥ç”¨ä½œæ‰©å±•è¯æ³•ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ›´ç²¾ç¡®åœ°æ§åˆ¶ç»‘å®šçš„å¯è§èŒƒå›´ã€‚æ¨¡å—å¯¼å‡ºæ ‡è¯†ç¬¦çš„ç»‘å®šï¼Œå³å˜é‡ç»‘å®šã€å…³é”®å­—ç»‘å®šæˆ–æ¨¡å—åç»‘å®šã€‚æ¨¡å—å¯ä»¥æ˜¯å…·åçš„æŠ‘æˆ–åŒ¿åçš„ã€‚åªè¦æ¨¡å—åå¯è§ï¼Œé‚£ä¹ˆåœ¨å…·åæ¨¡å—å‡ºç°å¤„å¯¼å…¥çš„ç»‘å®šéƒ½å¯è§ã€‚åŒ¿åæ¨¡å—ä¸­å¯¼å‡ºçš„ç»‘å®šï¼Œåœ¨æ¨¡å—å‡ºç°çš„åœ°æ–¹è¢«éšå¼åœ°å¯¼å…¥ã€‚åŒ¿åæ¨¡å—å¯ç”¨äºéšè—ä¸€ç»„ç»‘å®šä¸­çš„ä¸€äº›ç»‘å®šï¼ŒåŒæ—¶å…è®¸å…¶ä½™ç»‘å®šå¯è§ã€‚\nè¯­æ³• (module name interface defn \u0026hellip; init \u0026hellip;)\n(module interface defn \u0026hellip; init \u0026hellip;)\nname æ˜¯æ ‡è¯†ç¬¦ï¼Œdefn \u0026hellip; æ˜¯å®šä¹‰ï¼Œinit \u0026hellip; æ˜¯è¡¨è¾¾å¼ã€‚interface æ˜¯å½¢å¦‚ (export \u0026hellip;) çš„å¯¼å‡ºè¡¨ï¼Œå…¶ä¸­æ¯ä¸ª export éƒ½æ˜¯æ ‡è¯†ç¬¦ identifier æŠ‘æˆ–å½¢å¼ (identifier export \u0026hellip;)ã€‚\næ¨¡å—ç”±ä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰å®šä¹‰å’Œä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰åˆå§‹åŒ–è¡¨è¾¾å¼åºåˆ—ç»„æˆã€‚æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼ˆå¯ç†è§£ä¸ºå˜é‡æˆ–è€…çŠ¶æ€ï¼Œä¸‹åŒï¼‰åœ¨æ¨¡å—çš„ç¨‹åºä½“ä¸­å¯è§ï¼Œè¢«å¯¼å‡ºçš„æ ‡è¯†ç¬¦åœ¨æ¨¡å—çš„å¯¼å…¥ä½œç”¨åŸŸå†…äº¦å¯è§ã€‚æ¨¡å—æ¥å£ä¸­åˆ—å‡ºçš„æ¯ä¸ªæ ‡è¯†ç¬¦å¿…é¡»åœ¨è¯¥æ¨¡å—ä¸­å®šä¹‰æˆ–è¢«å¯¼å…¥è¯¥åˆ°æ¨¡å—ã€‚module å½¢å¼æ˜¯ä¸€ç§å®šä¹‰ï¼Œå› æ­¤å¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ï¼ŒåŒ…æ‹¬åµŒå¥—åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“ã€ library å½¢å¼ã€é¡¶å±‚ç¨‹åºï¼Œä»¥åŠåµŒå¥—åœ¨å…¶ä»–æ¨¡å—ä¸­ã€‚æ­¤å¤–ï¼Œå› ä¸ºæ¨¡å—åçš„ä½œç”¨åŸŸä¸å…¶ä»–æ ‡è¯†ç¬¦ç›¸åŒï¼Œæ‰€ä»¥æ¨¡å—å’Œåº“å¯ä»¥åƒå˜é‡å’Œå…³é”®å­—é‚£æ ·å¯¼å‡ºæ¨¡å—åã€‚\næ¨¡å—åä¸å…¶ä»–æ ‡è¯†ç¬¦å ç”¨ç›¸åŒçš„åå­—ç©ºé—´ï¼Œå¹¶éµå¾ªç›¸åŒçš„ä½œç”¨åŸŸè§„åˆ™ã€‚é™¤éè¢«å¯¼å‡ºï¼Œå¦åˆ™æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ä»…åœ¨è¯¥æ¨¡å—ä¸­å¯è§ã€‚\næ¨¡å—å†…çš„è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨åœ¨æ¨¡å—å¤–éƒ¨ç»‘å®šçš„æ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (module m (plusx) (define plusx (lambda (y) (+ x y)))) (import m) (let ([x 4]) (plusx 5))) ; =\u0026gt; 8,æ³¨æ„ä¸æ˜¯9å“¦ï¼Œå¯ä»¥å°†plusxè§†ä¸ºï¼š(define plusx (lambda (y) (+ 3 y)))) åŒæ ·ï¼Œimportä¸ä¼šé˜»æ­¢è®¿é—®å‡ºç°å¯¼å…¥è¡¨å•çš„å¯è§æ ‡è¯†ç¬¦ï¼Œä½†importæ ‡è¯†ç¬¦æ‰€è¦†ç›–çš„å˜é‡é™¤å¤–ï¼ˆå•¥å«è¦†ç›–ï¼Œçœ‹ä¸‹é¢ä¸¤æ®µä»£ç ï¼‰ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import m) (list x y)) ; =\u0026gt; (local-x m-y) æ¨¡å—mä¸­å®šä¹‰äº†æ ‡è¯†ç¬¦y, åœ¨å…¶è¢«importä¹‹åä¼šè¦†ç›–letä¸­çš„yï¼›\n(module m (y) (define y \u0026#39;m-y)) (let () (import m) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (list x y)) ; =\u0026gt; (local-x local-y) ) å…ˆimport mï¼Œä¹‹åå†å®šä¹‰yï¼Œæ¨¡å—ä¸­å®šä¹‰çš„yä¸ä¼šè¦†ç›–letçš„yã€‚\nå¦ä¸€æ–¹é¢ï¼Œåœ¨æ¨¡å—ä¸­ä½¿ç”¨ import-only ä¼šå»ºç«‹ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨åŸŸï¼Œå…¶ä¸­å”¯ä¸€å¯è§çš„æ˜¯è¢«å¯¼å…¥æ¨¡å—æ‰€å¯¼å‡ºçš„æ ‡è¯†ç¬¦ï¼Œä¸‹é¢çš„ä»£ç ä¸­åªæœ‰yå¯è§ã€‚ å¯¹äºé™æ€éªŒè¯ï¼Œæœ‰æ—¶ä¸å¸Œæœ›ä½¿ç”¨ä»»ä½•æ ‡è¯†ç¬¦ï¼Œé™¤äº†æ˜ç¡®å¯¼å…¥æ¨¡å—æˆ–æœ¬åœ°èŒƒå›´çš„æ ‡è¯†ç¬¦å¤–ï¼Œè¿™æœ‰æ—¶æ˜¯åˆä¹éœ€è¦çš„ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import-only m) x) ; =\u0026gt; Error: x is not visible é™¤éé€šè¿‡â€œimport-onlyâ€å¯¼å…¥çš„æ¨¡å—å¯¼å‡ºâ€œimportâ€æˆ–â€œimport-onlyâ€ä»¥åŠè‡³å°‘ä¸€ä¸ªæ¨¡å—çš„åç§°ï¼Œå¦åˆ™æ— æ³•åœ¨â€œimport-onlyâ€èŒƒå›´å†…è¿›è¡Œåç»­å¯¼å…¥ã€‚ è¦åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—å¯¼å‡ºçš„éš”ç¦»èŒƒå›´è€Œåˆä¸ä½¿â€œimportâ€æˆ–â€œimport-onlyâ€å¯è§ï¼Œå¿…é¡»ä»¥ç›¸åŒçš„â€œimport-onlyâ€å½¢å¼åˆ—å‡ºæ‰€æœ‰è¦å¯¼å…¥çš„æ¨¡å—ã€‚\nå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«æ¯ä¸ªå…¶ä»–æ¨¡å—çš„å¯¼å‡ºçš„æ¨¡å—ã€‚\n(module m2 (y) (define y \u0026#39;y)) (module m1 (x) (define x \u0026#39;x)) (module mega-module (cons x y) (import m1) (import m2) (import scheme)) (let ([y 3]) (import-only mega-module) (cons x y)) ; =\u0026gt; (x . y) åœ¨å®ƒè¢«ç¼–è¯‘ä¹‹å‰ï¼Œæºç¨‹åºè¢«ç¿»è¯‘æˆä¸å«è¯­æ³•æŠ½è±¡ã€è¯­æ³•å®šä¹‰ã€åº“å®šä¹‰ã€æ¨¡å—å®šä¹‰ä»¥åŠ import å½¢å¼çš„æ ¸å¿ƒè¯­è¨€ç¨‹åºã€‚ç¿»è¯‘ç”±è¯­æ³•å±•å¼€å™¨è´Ÿè´£ï¼Œè¯­æ³•å±•å¼€å™¨ä»¥é€’å½’ä¸‹é™çš„æ–¹å¼å¤„ç†æºç¨‹åºä¸­çš„å½¢å¼ã€‚\nmodule å’Œ import ç‰¹æ®Šå½¢å¼ä»…å½±å“æ ‡è¯†ç¬¦(identifier)åœ¨æºç¨‹åºä¸­çš„å¯è§æ€§ï¼Œè€Œä¸å½±å“å…¶å«ä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œæ— è®ºå˜é‡è¢«ç»‘å®šåˆ°åœ¨æ¨¡å—å†…éƒ¨æˆ–å¤–éƒ¨å®šä¹‰çš„ä½ç½®ï¼Œimport éƒ½ä¸ä¼šå¼•å…¥æ–°ä½ç½®ã€‚ä¸ºäº†ä¿æŒç”±æ¨¡å—å’Œè¯­æ³•æŠ½è±¡å»ºç«‹çš„ä½œç”¨åŸŸå…³ç³»ï¼Œå±€éƒ¨å˜é‡åœ¨å¿…è¦æ—¶ä¼šè¢«é‡å‘½åã€‚å› æ­¤ï¼Œè¡¨è¾¾å¼ï¼š\n(let ([x 1]) (module m (x setter) (define-syntax x (identifier-syntax z)) (define setter (lambda (x) (set! z x))) (define z 5)) (let ([y x] [z 0]) (import m) (setter 3) (+ x y z))) ; =\u0026gt; 4 ç­‰ä»·äºä¸‹é¢çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­æ ‡è¯†ç¬¦è¢«ç»Ÿä¸€åœ°æ›´åï¼Œå¹¶å¸¦ä¸Šäº†ä¸‹æ ‡ï¼š\n(let ([x0 1]) (define-syntax x1 (identifier-syntax z1)) (define setter1 (lambda (x2) (set! z1 x2))) (define z1 5) (let ([y3 x0] [z3 0]) (setter1 3) (+ x1 y3 z3))) äº’é€’å½’module (module (a b) (module a (x) (define x (lambda () y))) (module b (y) (define y (lambda () x))) (import a) (import b)) æ­¤æ¨¡å¼çš„ä¸€èˆ¬åŒ–è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…è®¸å®šä¹‰å¤šä¸ªäº’é€’å½’çš„æ¨¡å—\n(define-syntax rec-modules (syntax-rules (module) [(_ (module m (id ...) form ...) ...) (module (m ...) (module m (id ...) form ...) ... (import m) ...)])) ç»„åˆmodule ç”±äºæ¨¡å—å¯ä»¥é‡æ–°å¯¼å‡ºæ‰€å¯¼å…¥çš„ç»‘å®šï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åœ¨å•ä¸ªæ¨¡å—ä¸Šæä¾›å¤šä¸ªè§†å›¾ï¼Œå°±åƒä¸‹é¢çš„ s å’Œ t ä¸º r æä¾›çš„è§†å›¾é‚£æ ·ï¼Œæˆ–è€…å°†å‡ ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªå¤åˆï¼Œå°±åƒ r é‚£æ ·ã€‚\n(module p (x y) (define x 1) (define y 2)) (module q (y z) (define y 3) (define z 4)) (module r (a b c d) (import* p (a x) (b y)) (import* q (c y) (d z))) (module s (a c) (import r)) (module t (b d) (import r)) import* ç¨å¾®è§£é‡Šä¸€ä¸‹import*, å…¶è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š\n(define-syntax import* (syntax-rules () [(_ m) (begin)] [(_ m (new old)) (module (new) (module (tmp) (import m) (alias tmp old)) (alias new tmp))] [(_ m id) (module (id) (import m))] [(_ m spec0 spec1 ...) (begin (import* m spec0) (import* m spec1 ...))])) å®ƒæ”¯æŒé‡å‘½åimportçš„ç»‘å®šå’Œé€‰æ‹©æ€§å¯¼å…¥ç‰¹å®šçš„ç»‘å®šï¼Œæ— éœ€ä½¿ç”¨å†…ç½®çš„importå­å½¢å¼æ¥é€‰æ‹©å’Œé‡å‘½åæ ‡è¯†ç¬¦ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š\n(let () (import* scheme (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) (let () (import* (rnrs) (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) å…ƒå®šä¹‰Meta Definitions è¯­æ³•ï¼š(meta . definition)\nmeta å…³é”®å­—å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥æ”¾åœ¨ä»»ä½•å®šä¹‰å…³é”®å­—å‰é¢çš„å‰ç¼€ï¼Œä¾‹å¦‚ï¼Œ\n(meta define x 3)\nå®ƒå‘Šè¯‰å±•å¼€å™¨ï¼Œè¯¥å®šä¹‰å¼äº§ç”Ÿçš„ä»»ä½•å˜é‡å®šä¹‰éƒ½åªæ˜¯å±•å¼€æœŸå®šä¹‰ï¼Œåªèƒ½ç”¨äºå…¶ä»–å…ƒå®šä¹‰çš„å³ä¾§ï¼Œæœ€ä¸»è¦æ˜¯ç”¨åœ¨è½¬æ¢å™¨è¡¨è¾¾å¼ä¸­ã€‚å®ƒç”¨äºå®šä¹‰å±•å¼€æœŸè¾…åŠ©å‡½æ•°ï¼Œä»¥åŠä¾›ä¸€ä¸ªæˆ–å¤šä¸ª syntax-case è½¬æ¢å™¨æ‰€ä½¿ç”¨çš„å…¶ä»–ä¿¡æ¯ã€‚\nå…ƒå®šä¹‰çš„è¯­ä¹‰ç±»ä¼¼äºlet*ï¼Œå®ƒå¯ä»¥æ˜¯è‡ªé€’å½’ï¼Œä½†ä¸æ˜¯äº’é€’å½’çš„ã€‚\nå…ƒå®šä¹‰é€šè¿‡å®å±•å¼€ä¼ æ’­ï¼Œå› æ­¤å¯ä»¥ç¼–å†™ï¼Œä¾‹å¦‚ï¼š\n(module (a) (meta define-record foo (x)) (define-syntax a (let ([q (make-foo #\u0026#39;\u0026#39;q)]) (lambda (x) (foo-x q))))) a ï¼›=\u0026gt; q æ¡ä»¶å±•å¼€Conditional expansion å¯ä»¥é€šè¿‡ meta-cond åœ¨å±•å¼€æœŸåšå‡ºå†³ç­–ï¼Œè¿™ç±»ä¼¼äº condï¼Œä½†æ˜¯æ˜¯åœ¨å±•å¼€æœŸæ±‚å€¼å¹¶æµ‹è¯•è¡¨è¾¾å¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é¢„æœŸä¸ºå®šä¹‰çš„ä¸Šä¸‹æ–‡ä¸­ä»¥åŠåœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚\nè¯­æ³•ï¼š(meta-cond clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ª clauseï¼Œå…¶ä½™çš„å¿…é¡»é‡‡å–ä»¥ä¸‹å½¢å¼ï¼š\n(test expr1 expr2 \u0026hellip;)\næœ€åä¸€ä¸ª cluase é™¤å¯é‡‡å–ä¸Šè¿°å½¢å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ else å­å¥å½¢å¼ï¼š\n(else expr1 expr2 \u0026hellip;)\nåœ¨å±•å¼€æœŸé—´ï¼Œtest è¡¨è¾¾å¼ä¼šè¢«é¡ºåºåœ°æ±‚å€¼ï¼Œç›´åˆ°æŸæ¡è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸæˆ–è€…æ±‚å€¼å®Œæ‰€æœ‰çš„è¡¨è¾¾å¼ä¸ºæ­¢ã€‚å¦‚æœä¸€æ¡ test è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºåŒ…å«ç›¸åº”è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦‚æœæ²¡æœ‰æ±‚å€¼ä¸ºçœŸçš„ test è¡¨è¾¾å¼ï¼Œä¸”å­˜åœ¨ else å­å¥ï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºç”±æ¥è‡ªäº else å­å¥çš„è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦åˆ™ï¼Œmeta-cond è¡¨è¾¾å¼å±•å¼€ä¸ºå¯¹ void è¿‡ç¨‹çš„è°ƒç”¨ã€‚\nmeta-cond å¯ä»¥æŒ‰å¦‚ä¸‹å®šä¹‰ï¼š\n(define-syntax meta-cond (syntax-rules () [(_ [a0 a1 a2 ...] [b0 b1 b2 ...] ...) (let-syntax ([expr (cond [a0 (identifier-syntax (begin a1 a2 ...))] [b0 (identifier-syntax (begin b1 b2 ...))] ...)]) expr)])) meta-cond ç”¨äºåœ¨å±•å¼€æœŸä»ä¸€ç»„å¯èƒ½çš„å½¢å¼ä¸­è¿›è¡Œé€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥å®šä¹‰è¿‡ç¨‹çš„å®‰å…¨ï¼ˆè¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰å’Œä¸å®‰å…¨ï¼ˆä¸è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰ç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®ç¼–è¯‘æœŸä¼˜åŒ–çº§åˆ«å†³å®šè°ƒç”¨ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:\n(meta-cond [(= (optimize-level) 3) (unsafe-frob x)] [else (safe-frob x)]) åˆ«åAliases è¯­æ³•ï¼š(alias id1 id2)\nalias æ˜¯ä¸€ç±»å®šä¹‰ï¼Œå¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ã€‚å®ƒç”¨äºå°†ç»‘å®šä»ä¸€ä¸ªæ ‡è¯†ç¬¦è½¬ç§»åˆ°å¦ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (alias y x) (set! y 4) (list x y)) ; =\u0026gt; (4 4) ç”±äºå±•å¼€æ˜¯ç”±å·¦è‡³å³è¿›è¡Œçš„ï¼Œåˆ«ååº”è¯¥å‡ºç°åœ¨å³ä¾§çš„æ ‡è¯†ç¬¦çš„å®šä¹‰ä¹‹åï¼Œä¾‹å¦‚ï¼š\n(let () (import-only (chezscheme)) (define y 3) (alias x y) x) ; =\u0026gt; 3 è€Œä¸æ˜¯ï¼š\n(let () (import-only (chezscheme)) (alias x y) (define y 3) x) ; =\u0026gt; exception: unbound identifier ","id":22,"section":"posts","summary":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥","tags":["modules"],"title":"Chez Scheme Modules","uri":"https://lvsq.net/2020/01/modules/","year":"2020"},{"content":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚\n(define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_ ((a1 v1) (a2 v2) ...) bodys ...) (let ((a1 v1)) (my-let* ((a2 v2) ...) bodys ...)) ) ) ) æ³¨æ„ï¼Œmy-let*æ˜¯å¯ä»¥é€’å½’ä½¿ç”¨çš„ï¼Œä»¥åŠ**\u0026hellip;**çš„ç”¨æ³•ã€‚\n(define-syntax my-let* (syntax-rules () ( (_ () bodys ...) (let () bodys ...) ) ( (_ ((a1 v1) ...) bodys ...) (let () (define a1 v1) ... bodys ... ) ) ) ) è¿™ä¸ªå®ç°æ–¹å¼ä¸ä¸Šé¢çš„ä¸åŒï¼Œä¸Šé¢çš„æ˜¯åµŒå¥—letï¼Œè¿™é‡Œå°†ç›´æ¥æŒ‰é¡ºåºdefineå†…éƒ¨å˜é‡ï¼Œä»£ç æ›´çŸ­ã€‚æ³¨æ„æ­¤å¤„çš„**\u0026hellip;**çš„ç”¨æ³•ã€‚\n","id":23,"section":"posts","summary":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚ (define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_","tags":["scheme"],"title":"è‡ªå®šä¹‰ Let*","uri":"https://lvsq.net/2020/01/my-let/","year":"2020"},{"content":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©å±•æœŸé—´ä¼šæš‚æ—¶æ›´æ”¹keywordçš„ç°æœ‰ç»‘å®šï¼Œè€Œä¸æ˜¯å¼•å…¥keywordçš„æ–°ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰©å±•form1 form2 \u0026hellip;çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªkeywordçš„å¯è§èŒƒå›´ï¼ˆæˆ–é¡¶çº§ï¼‰å°†ä¼šä¸´æ—¶æ›¿æ¢ä¸ºæ–°çš„ç»‘å®šå…³ç³»ã€‚\n(let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 2 ) ) ) (let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (fluid-let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 1 ) ) ) å¯¹æ¯”ä¸Šè¿°ä¸¤æ®µä»£ç ï¼Œå¯çŸ¥ï¼šä¸¤ä¸ªè¡¨è¾¾å¼åŸºæœ¬ç›¸åŒçš„ï¼Œé™¤äº†å‰è€…é‡‡ç”¨å†…éƒ¨let-synctaxè¯­æ³•ï¼Œç¬¬äºŒä¸ªé‡‡ç”¨fluid-let-syntaxè¯­æ³•ã€‚åœ¨ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œ(g 1)æ‰©å±•ä¸­çš„å‡ºç°çš„få¼•ç”¨çš„æ˜¯let-boundçš„å˜é‡fï¼Œè€Œç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œfå¼•ç”¨çš„æ˜¯ç”±fluid-let-syntaxç»‘å®šçš„f\n","id":24,"section":"posts","summary":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©","tags":["module","syntactic"],"title":"Syntactic Extension and Modules in Chez Scheme","uri":"https://lvsq.net/2020/01/syntactic-extension-and-modules/","year":"2020"},{"content":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„å¯ä»¥å…±äº«æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ–æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œåœ¨é‡‡ç”¨æ­¤ç§å‚æ•°ä¼ é€’è§„åˆ™çš„è¯­è¨€çš„è§£é‡Šå™¨ä¸­ï¼Œå¯ä»¥ç”¨ boxes å®ç° call-by-reference çš„è¯­ä¹‰ã€‚è§£é‡Šæœ‰ç‚¹ç»•ï¼ŒæŒ‰æˆ‘çš„ç†è§£boxeså°±ç›¸å½“äºGolangçš„structã€Javaä¸­çš„ç±»ï¼Œå°†ä¸€äº›çŠ¶æ€åŒ…è£…æˆä¸€ä¸ªæ•´å—ï¼Œå¤–ç•Œé€šè¿‡å¼•ç”¨è¯¥æ•´å—çš„æŒ‡é’ˆæ¥è®¿é—®å†…éƒ¨çš„å„ä¸ªçŠ¶æ€ã€‚\nBoxes çš„å­—é¢å½¢å¼å¸¦æœ‰å‰ç¼€ #\u0026amp; (å‘éŸ³ä¸º â€œhash-ampersandâ€). ä¾‹å¦‚ï¼Œ #\u0026amp;(a b c) æ˜¯ä¸€ä¸ª boxï¼Œå†…å®¹ä¸ºåˆ—è¡¨ (a b c). è¯»å–å™¨è‹¥é‡åˆ° #!r6rs ï¼Œåˆ™ä¼šåœ¨å…¶åçš„è¾“å…¥æµä¸­ç¦ç”¨ box è¯­æ³•ï¼Œé™¤éåœ¨æ›´è¿‘çš„ä½ç½®é‡åˆ° #!chezscheme.\næ‰€æœ‰ boxes é»˜è®¤æ˜¯å¯å˜çš„ï¼ŒåŒ…æ‹¬å¸¸é‡ã€‚ç¨‹åºå¯ä»¥é€šè¿‡ box-immutable åˆ›å»ºä¸å¯å˜ boxes. å°è¯•ä¿®æ”¹ä¸å¯å˜ box ä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ç”¨æ³•ï¼š\n(box? obj) å¦‚æœ obj æ˜¯ box, åˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box? \u0026#39;#\u0026amp;a) =\u0026gt; #t (box? \u0026#39;a) =\u0026gt; #f (box? (box 3)) =\u0026gt; #t (box obj) åˆ›å»ºä¸€ä¸ªç”±objç»„æˆçš„box\n(box \u0026#39;a) =\u0026gt; #\u0026amp;a (box (box \u0026#39;(a b c))) =\u0026gt; #\u0026amp;#\u0026amp;(a b c) (unbox box) è¿”å›boxçš„å†…å®¹\n(unbox #\u0026amp;a) =\u0026gt; a (unbox #\u0026amp;#\u0026amp;(a b c)) =\u0026gt; #\u0026amp;(a b c) (let ([b (box \u0026#34;hi\u0026#34;)]) (unbox b)) =\u0026gt; \u0026#34;hi\u0026#34; (set-box! box obj) box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ set-box! æŠŠ box çš„å†…å®¹è®¾ç½®ä¸º obj.\n(let ([b (box \u0026#39;x)]) (set-box! b \u0026#39;y) b) =\u0026gt; #\u0026amp;y (let ([incr! (lambda (x) (set-box! x (+ (unbox x) 1)))]) (let ([b (box 3)]) (incr! b) (unbox b))) =\u0026gt; 4 (box-cas! box old-obj new-obj) å¦‚æœ box è¢«æ”¹å˜ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f. box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ è‹¥ box å¾…æ›¿æ¢çš„å†…å®¹å’Œ old-obj ç›¸åŒ(åŸºäº eq?), åˆ™ box-cas! è‡ªåŠ¨å°† box çš„å†…å®¹æ›¿æ¢ä¸º new-obj; è‹¥ä¸ç›¸åŒï¼Œåˆ™ box ä¿æŒä¸å˜ã€‚å³CASæ“ä½œï¼ŒåŸå­çš„ã€‚\n(define b (box \u0026#39;old)) (box-cas! b \u0026#39;old \u0026#39;new) =\u0026gt; #t (unbox b) =\u0026gt; \u0026#39;new (box-cas! b \u0026#39;other \u0026#39;wrong) =\u0026gt; #f (unbox b) =\u0026gt; \u0026#39;new (mutable-box? obj) å¦‚æœ obj æ˜¯å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(immutable-box? obj) å¦‚æœ obj æ˜¯ä¸å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box-immutable obj) è¿”å›ä¸€ä¸ªå†…å®¹ä¸ºobjçš„ä¸å¯å˜çš„boxã€‚Boxes é€šå¸¸ç”¨æ¥æ”¯æŒå…±äº«çš„ï¼Œå¯å˜çš„ç»“æ„ï¼Œæ‰€ä»¥ä¸å¯å˜çš„ box ä¸€èˆ¬æ²¡ä»€ä¹ˆç”¨ã€‚\n","id":25,"section":"posts","summary":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„","tags":["scheme"],"title":"Chez Schemeä¸­Boxesä»‹ç»","uri":"https://lvsq.net/2020/01/boxes-in-chez/","year":"2020"},{"content":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x)))\n(atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦ï¼›list-headå’ŒSchemeæ ‡å‡†è¿‡ç¨‹list-tailå¯èƒ½ä¼šåŒæ—¶ä½¿ç”¨æ¥åˆ‡å‰²ä¸€ä¸ªlistï¼Œä¸åŒç‚¹åœ¨äºï¼Œlist-tailä¸ä¼šåˆ†é…å†…å­˜è€Œåªæ˜¯è¿”å›æºlistçš„ä¸€ä¸ªå­åˆ—è¡¨ï¼Œlist-headæ€»æ˜¯è¿”å›æºlistå‰nä¸ªå…ƒç´ çš„å‰¯æœ¬\n(list-head \u0026#39;(a b c) 0) â‡’ () (list-head \u0026#39;(a b c) 2) â‡’ (a b) (list-head \u0026#39;(a b c) 3) â‡’ (a b c) (list-head \u0026#39;(a b c . d) 2) â‡’ (a b) (list-head \u0026#39;(a b c . d) 3) â‡’ (a b c) (list-head \u0026#39;#1=(a . #1#) 5) â‡’ (a a a a a) last-pair(Chez) ç”¨æ³•ï¼š(last-pair list) åˆ—è¡¨ä¸èƒ½ä¸ºç©ºã€‚ last-pairè¿”å›åˆ—è¡¨çš„æœ€åä¸€å¯¹ï¼ˆpairï¼‰ï¼ˆä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼‰, listå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„åˆ—è¡¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€åä¸€å¯¹æ˜¯åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ å’Œç»ˆæ­¢å¯¹è±¡çš„ä¸€ä¸ªpairã€‚\n(last-pair \u0026#39;(a b c d)) â‡’ (d) (last-pair \u0026#39;(a b c.d)) â‡’ (c . d) list-copy(Chez) ç”¨æ³•ï¼š (list-copy list) è¿”å›ä¸€ä¸ªlistçš„å‰¯æœ¬ï¼Œequal?ï¼ˆç»“æ„å’Œå€¼ç›¸åŒï¼‰åˆ¤æ–­ä¸º#t\nlist*(Chez) ç”¨æ³•ï¼š(list* obj \u0026hellip; final-obj) è¿”å›ä¸€ä¸ªç”±obj \u0026hellip; final-obj ç»„æˆçš„list, ä¸R6RSçš„**cons***ç›¸åŒ\nmake-list(Chez) ç”¨æ³•ï¼š (make-list n) æˆ–è€… (make-list n obj) è¿”å›nä¸ªå¯¹è±¡çš„åˆ—è¡¨ã€‚næ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ å¦‚æœobjä¸æŒ‡å®šï¼Œåˆ™è¿”å›çš„listæ˜¯ä¸ç¡®å®šçš„\n(make-list 0 \u0026#39;()) =\u0026gt; () (make-list 3 0) =\u0026gt; (0 0 0) (make-list 2 \u0026#34;hi\u0026#34;) =\u0026gt; (\u0026#34;hi\u0026#34; \u0026#34;hi\u0026#34;) iota(Chez) ç”¨æ³•ï¼š(iota n) è¿”å›ä» 0ï¼ˆåŒ…å«ï¼‰åˆ° nï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨ï¼Œné¡»ä¸ºç²¾ç¡®çš„éè´Ÿæ•´æ•°\n(iota 0) =\u0026gt; () (iota 5) =\u0026gt; (0 1 2 3 4) enumerate(Chez) ç”¨æ³•ï¼š (enumerate ls) è¿”å›: ä» 0ï¼ˆåŒ…å«ï¼‰åˆ°é•¿åº¦ lsï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨\n(enumerate \u0026#39;()) =\u0026gt; () (enumerate \u0026#39;(a b c)) =\u0026gt; (0 1 2) (let ([ls \u0026#39;(a b c)]) (map cons ls (enumerate ls))) =\u0026gt; ((a . 0) (b . 1) (c . 2)) remq! | remv! | remove!(Chez) ç”¨æ³•ï¼š (remq! obj list) | (remv! obj list) | (remove! obj list) è¿”å›: åˆ—è¡¨ä¸­æ‰€æœ‰ obj éƒ½è¢«ç§»é™¤åçš„åˆ—è¡¨ è¿™äº›è¿‡ç¨‹ä¸ R6RS ä¸­çš„ remq, remv, åŠ remove è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯ remq!, remv! å’Œ remove! ä½¿ç”¨è¾“å…¥åˆ—è¡¨ä¸­çš„pairæ¥æ„æˆè¾“å‡ºåˆ—è¡¨ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„ç›¸åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(remq! \u0026#39;a \u0026#39;(a b a c a d)) â‡’ (b c d) (remv! #\\a \u0026#39;(#\\a #\\b #\\c)) =\u0026gt; (#\\b #\\c) (remove! \u0026#39;(c) \u0026#39;((a) (b) (c))) =\u0026gt; ((a) (b)) substq | substv | subst | substq! | substv! | subst!(Chez) ç”¨æ³•ï¼š (subs* new old tree) è¿”å›ï¼šåœ¨treeä¸­å°†åŒ¹é…åˆ°çš„oldå…ƒç´ å…¨éƒ¨æ›¿æ¢ä¸ºnewä¹‹åçš„tree. å¯¹äº substq å’Œ substq! ï¼Œç›¸ç­‰æ€§æµ‹è¯•æ˜¯åŸºäº eq?, substv å’Œ substv! æ˜¯åŸºäº eqv?, è€Œ subst å’Œ subst! æ˜¯åŸºäº equal? substq!, substv!, å’Œ subst! æ‰§è¡Œç ´åæ€§çš„æ›¿æ¢ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„å¯¹åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(substq \u0026#39;a \u0026#39;b \u0026#39;((b c) b a)) =\u0026gt; ((a c) a a) (substv 2 1 \u0026#39;((1 . 2) (1 . 4) . 1)) =\u0026gt; ((2 . 2) (2 . 4) . 2) (subst \u0026#39;a \u0026#39;(a . b) \u0026#39;((a . b) (c a . b) . c)) =\u0026gt; (a (c . a) . c) (let ([tr \u0026#39;((b c) b a)]) (substq! \u0026#39;a \u0026#39;b tr) tr) =\u0026gt; ((a c) a a) reverse! ç”¨æ³•ï¼š(reverse! list) è¿”å›ï¼šå°†åŸliståå‘è¾“å‡º reverse! é€šè¿‡åè½¬å…¶é“¾æ¥ç ´åæ€§åœ°åå‘æ’åºåˆ—è¡¨ã€‚ä»¥ reverse! å–ä»£ reverse å‡å°‘äº†ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”ä½¿ç”¨ reverse æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(reverse! \u0026#39;()) =\u0026gt; () (reverse! \u0026#39;(a b c)) =\u0026gt; (c b a) (let ([x \u0026#39;(a b c)]) (reverse! x) x) =\u0026gt; (a) (let ([x \u0026#39;(a b c)]) (set! x (reverse! x)) x) =\u0026gt; (c b a) append! ç”¨æ³•ï¼š(append! list \u0026hellip;) è¿”å›ï¼šå°†æ‰€æœ‰è¾“å…¥listä¸²è”èµ·æ¥çš„åˆ—è¡¨ å¦‚åŒ append, append! è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå…¶ä¸­å…ƒç´ ä¾æ¬¡ä¸ºç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬ä¸‰ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç­‰ç­‰ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ append! é‡ç”¨æ‰€æœ‰å‚æ•°ä¸­çš„ç‚¹å¯¹ä»¥æ„é€ æ–°åˆ—è¡¨ã€‚å³ï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨å‚æ•°çš„æœ€åä¸€ä¸ªcdr, å…¶åä¸€å…ƒç´ å˜ä¸ºæŒ‡å‘ä¸‹ä¸€ä¸ªåˆ—è¡¨å‚æ•°ã€‚é™¤æœ€åä¸€ä¸ªå‚æ•°å¤–ï¼Œå¦‚æœä»»ä¸€å‚æ•°ä¸ºç©ºåˆ—è¡¨ï¼Œå®ƒå®è´¨ä¸Šä¼šè¢«å¿½ç•¥ã€‚æœ€åä¸€ä¸ªå‚æ•°ï¼ˆå¹¶ä¸ä¸€å®šå¾—æ˜¯åˆ—è¡¨ï¼‰æ˜¯ä¸å˜çš„ã€‚\nç›¸æ¯”äº append, append! è¿›è¡Œæ›´å°‘çš„ç©ºé—´åˆ†é…ï¼ˆå› ä¸ºåªä¿®æ”¹æŒ‡é’ˆï¼Œå¹¶æ²¡æœ‰æ•°æ®æ‹·è´ï¼‰ï¼Œä½†å¹¶ä¸ä¸€å®šæ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(append! \u0026#39;(a b) \u0026#39;(c d)) =\u0026gt; (a b c d) (let ([x \u0026#39;(a b)]) (append! x \u0026#39;(c d)) x) =\u0026gt; (a b c d) (append \u0026#39;(1 2 (3 4)) \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) (append \u0026#39;(1 2 (3 4)) \u0026#39;() \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) ","id":26,"section":"posts","summary":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x))) (atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦","tags":["scheme"],"title":"Scheme/Chez Scheme å¯¹è±¡æ“ä½œ","uri":"https://lvsq.net/2019/12/operations-on-objects/","year":"2019"},{"content":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚\n(make-engine thunk)\né€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thunk(å½¢å®è½¬æ¢ç¨‹åº)ç»™make-engineæ¥åˆ›å»ºä¸€ä¸ªengineã€‚thunkçš„bodyæ˜¯ä¼šè¢«engineæ‰§è¡Œçš„è®¡ç®—ï¼Œengineæœ¬èº«æ˜¯å¸¦3ä¸ªå‚æ•°çš„è¿‡ç¨‹ï¼š\nticksï¼š ä¸€ä¸ªæ­£æ•´æ•°ï¼ŒæŒ‡å®šæä¾›ç»™engineçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼ˆåŸæ–‡ç”¨çš„æ˜¯fuelè¿™ä¸ªå•è¯ï¼Œæ„æ€æ˜¯ç‡ƒæ–™ï¼Œæ­£å¯¹åº”è¿™engineçš„æœ¬æ„ï¼Œååˆ†è´´åˆ‡ï¼‰çš„æ•°é‡ï¼Œengineå°†ä¼šæ‰§è¡Œåˆ°æ—¶é—´ç‰‡ç”¨å®Œæˆ–è€…è®¡ç®—å®Œæˆä¸ºæ­¢ï¼› completeï¼š ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç”¨äºæŒ‡å®šè®¡ç®—å®Œæˆåçš„æ“ä½œã€‚å®ƒçš„å‚æ•°æ˜¯å‰©ä½™çš„æ—¶é—´ç‰‡æ•°é‡å’Œè®¡ç®—äº§ç”Ÿçš„å€¼ï¼› expireï¼š ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æŒ‡å®šå¦‚æœåœ¨è®¡ç®—å®Œæˆä¹‹å‰æ—¶é—´ç‰‡ç”¨å®Œäº†è¯¥æ€ä¹ˆåŠã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªèƒ½ä»ä¸­æ–­ç‚¹ç»§ç»­è¿›è¡Œè®¡ç®—çš„æ–°å¼•æ“ã€‚ å°†å¼•æ“åº”ç”¨äºå…¶å‚æ•°æ—¶ï¼Œå®ƒå°†å¼€å¯ä¸€ä¸ªæ—¶é•¿ä¸ºticksçš„è®¡æ—¶å™¨ï¼Œå¦‚æœå¼•æ“è®¡ç®—åœ¨è®¡æ—¶å™¨æ‰§è¡Œä¹‹å‰å®Œæˆï¼Œç³»ç»Ÿå°†è°ƒç”¨completeï¼Œå¹¶å°†å‰©ä½™çš„tickså’Œè®¡ç®—äº§ç”Ÿçš„å€¼ä¼ é€’ç»™å®ƒï¼›\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœè®¡æ—¶å™¨åœ¨å¼•æ“è®¡ç®—å®Œæˆä¹‹å‰è€—å°½äº†ï¼Œåˆ™ç³»ç»Ÿä¼šä»ä¸­æ–­è®¡ç®—çš„continuationä¸­åˆ›å»ºä¸€ä¸ªæ–°å¼•æ“ï¼Œå¹¶ä½¿è¯¥å¼•æ“è¿‡æœŸã€‚completeå’Œexpireä¼šè¢«æ–°å¼•æ“ç»§ç»­ä½¿ç”¨ã€‚If, on the other hand, the timer goes off before the engine computation completes, the system creates a new engine from the continuation of the in- terrupted computation and passes this engine to expire. complete and expire are invoked in the continuation of the engine invocation.\nçœ‹çœ‹å…·ä½“çš„ä¾‹å­ï¼š\n(define eng (make-engine (lambda () 3))) (eng 10 ;; ticks (lambda (ticks value) value) ;; complete (lambda (x) x) ;; expire ) â‡’ 3 é€šå¸¸å°†åˆ—è¡¨ä½œä¸ºå®Œæ•´è¿‡ç¨‹ä¼ é€’ç»™å¼•æ“ï¼Œä½¿å¼•æ“å®Œæˆæ—¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å‰©ä½™çš„ticksï¼Œå¦ä¸€ä¸ªå…ƒç´ æ˜¯è®¡ç®—è¿”å›çš„å€¼ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚\n(define eng (make-engine (lambda () 3))) (eng 10 list (lambda (x) x)) â‡’ (9 3) åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè®¡ç®—å€¼ä¸º3ï¼Œè¿˜å‰©ä¸‹9ä¸ªæ—¶é—´ç‰‡ï¼Œå³ï¼Œéœ€è¦ä¸€å•ä½çš„æ—¶é—´ç‰‡æ¥è®¡ç®—å‡º3ã€‚\nå†çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼š å…ˆå®šä¹‰ä¸€ä¸ªè®¡ç®—è£´æ³¢é‚£åˆ‡å€¼çš„å‡½æ•°\n(define fibonacci (lambda (n) (let fib ([i n]) (cond [(= i 0) 0] [(= i 1) 1] [else (+ (fib (- i 1)) (fib (- i 2)))])))) åˆ›å»ºengine\n(define eng (make-engine (lambda () (fibonacci 10)))) (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ (21 55) æ¯æ¬¡æ—¶é—´ç‰‡ï¼ˆç‡ƒæ–™ï¼‰ç”¨å®Œæ—¶ï¼Œåˆ°æœŸç¨‹åºéƒ½ä¼šå°†engåˆ†é…ç»™æ–°å¼•æ“ã€‚æ•´ä¸ªè®¡ç®—éœ€è¦4ä¸ªblocksï¼Œæ¯ä¸ªblockåŒ…å«50ä¸ªticksã€‚æœ€å50ä¸ªç‡ƒæ–™ä¸­ï¼Œæœ‰21ä¸ªéƒ½ç”¨æ‰äº†ã€‚å› æ­¤ï¼Œä½¿ç”¨çš„ç‡ƒæ–™æ€»é‡ä¸º179ä¸ªã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ç»Ÿè®¡ä¸€ä¸‹æ¶ˆè€—çš„ticksæ•°é‡\n(define mileage (lambda (thunk) (let loop ([eng (make-engine thunk)] [total-ticks 0]) (eng 50 (lambda (ticks . values) (+ total-ticks (- 50 ticks))) (lambda (new-eng) (loop new-eng (+ total-ticks 50))))))) (mileage (lambda () (fibonacci 10))) â‡’ 179 å†çœ‹çœ‹ä¸€ä¸ªä¾‹å­â€”â€”round-robin:\n(define round-robin (lambda (engs) (if (null? engs) \u0026#39;() ((car engs) 1 ;;ticks (lambda (ticks value) (cons value (round-robin (cdr engs)))) ;;complete (lambda (eng) ;;expire (round-robin (append (cdr engs) (list eng)))))))) (round-robin (map (lambda (x) (make-engine (lambda () (fibonacci x)))) \u0026#39;(4 5 2 8 3 7 6 2))) â‡’ (1 1 2 3 5 8 13 21) è¿™æ®µä»£ç éœ€è¦è´¹äº›æ€é‡ï¼Œé¦–å…ˆmapå‡½æ•°åˆ›å»ºäº†8ä¸ªengine, ç„¶åä»£å…¥round-robinå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¾æ¬¡æ‰§è¡Œå„ä¸ªengineï¼Œä½†æ˜¯æ¯ä¸ªengineåˆ†é…çš„æ—¶é—´ç‰‡åªæœ‰1ï¼Œå¯¹äºå‚æ•°\u0026rsquo;(4 5 2 8 3 7 6 2)ï¼Œæ•°å­—è¶Šå°ï¼Œè¶Šå…ˆæ‰§è¡Œå®Œæˆï¼Œæ‰€ä»¥è¶Šæ—©æ‰§è¡Œcompleteå‡½æ•°ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯æ’å¥½é¡ºåºçš„äº†ï¼Œå¾ˆæ£’çš„ç¨‹åºï¼\n","id":27,"section":"posts","summary":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚ (make-engine thunk) é€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thun","tags":["engine","scheme"],"title":"Engine in Scheme","uri":"https://lvsq.net/2019/12/engine-in-scheme/","year":"2019"},{"content":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schemeæä¾›äº†caseè¯­æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œè¿™ä¸Javaä¸­çš„switchè¯­æ³•éå¸¸ç›¸ä¼¼ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹caseçš„è¯­æ³•ï¼š\n(case expr0 clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªclauseä¹‹å¤–ï¼Œæ¯ä¸ªå­å¥éƒ½å¿…é¡»é‡‡ç”¨ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š\n((key \u0026hellip;) expr1 expr2 \u0026hellip;) (key expr1 expr2 \u0026hellip;) æ¯ä¸€ä¸ªkeyå€¼éƒ½åº”è¯¥æ˜¯ä¸åŒçš„ï¼Œæœ€åä¸€ä¸ªå­å¥è¦ä¹ˆæ˜¯ä¸Šè¿°é‚£ç§å½¢å¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„elseå­å¥\n(else expr1 expr2 \u0026hellip;) é‚£ä¹ˆè¿”å›å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n(define p (lambda (x) (case x [(\u0026#34;abc\u0026#34; \u0026#34;def\u0026#34;) \u0026#39;one \u0026#39;1] [((a b c)) \u0026#39;two] [else #f]))) (p (string #\\d #\\e #\\f)) â‡’ 1 (p \u0026#39;(a b c)) â‡’ two (p \u0026#34;eee\u0026#34;) â‡’ #f ä¸Šé¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°pï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°x\nå¦‚æœxä¸ºå­—ç¬¦ä¸²\u0026quot;abc\u0026quot;æˆ–è€…\u0026quot;def\u0026quot;ï¼Œåˆ™è¿”å›1ï¼› å¦‚æœxä¸ºåˆ—è¡¨((a b c)ï¼Œåˆ™è¿”å›two å…¶ä»–æƒ…å†µè¿”å›#f å¯è§ï¼Œæœ‰äº†caseè¯­æ³•å¤šæ¡ä»¶åˆ¤æ–­å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šï¼Œå¹¶ä¸”ä»£ç ä¹Ÿå®¹æ˜“è¯»äº†ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç”¨condæ¥å†™ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æè¿°caseçš„è¯­æ³•è€Œæ²¡æœ‰ä½¿ç”¨cond\nå†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ï¼š\n(let ([ls \u0026#39;(ii iv)]) (case (cadr ls) [i 1] [ii 2] [iii 3] [(iiii iv) 4] [else \u0026#39;out-of-range])) â‡’ 4 record-case æ¥çœ‹çœ‹å¦ä¸€ä¸ªå¾ˆç±»ä¼¼çš„æ‰©å±•ï¼Œä¹Ÿååˆ†æœ‰ç”¨ï¼Œå®ƒå°±æ˜¯record-caseã€‚å®ƒå¯ä»¥ä»¥recordä¸ºå•ä½æ¥åšæ¡ä»¶åˆ¤æ–­å¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚\nè¯­æ³•æ ¼å¼ï¼š (record-case expr clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªå­å¥ä¹‹å¤–ï¼Œæ¯ä¸ªclauseçš„æ ¼å¼å¦‚ä¸‹ï¼š\n((key \u0026hellip;) formals body1 body2 \u0026hellip;)\næ¯ä¸€ä¸ªkeyéƒ½ä¸åº”è¯¥ç›¸åŒ, æœ€åä¸€ä¸ªclauseå¯èƒ½æ˜¯ä¸Šè¿°çš„æ ¼å¼æˆ–è€…æ˜¯ä¸€ä¸ªelseå­å¥ï¼š\n(else body1 body2 \u0026hellip;)\nexprå¿…é¡»æ˜¯ä¸€ä¸ªpairã€‚Chezä¼šæ‹¿(car expr)ä¸å„ä¸ªå­å¥ä¸­çš„keyè¿›è¡Œæ¯”è¾ƒï¼ˆç”¨eqv?ï¼‰æ¥ç¡®å®šå“ªä¸€ä¸ªclauseåŒ¹é…, ç„¶å(cdr expr)å°†ä¸formalsç»‘å®šã€‚\næ¥çœ‹æ¢ä¸€ä¸ªä¾‹å­ï¼š\n(define calc (lambda (x) (record-case x [(add) (x y) (+ x y)] [(sub) (x y) (- x y)] [(mul) (x y) (* x y)] [(div) (x y) (/ x y)] [else (assertion-violationf \u0026#39;calc \u0026#34;invalid expression ~s\u0026#34; x)]))) (calc \u0026#39;(add 3 4)) =\u0026gt; 7 (calc \u0026#39;(div 3 4)) =\u0026gt; 3/4 ","id":28,"section":"posts","summary":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schem","tags":["chez","scheme"],"title":"Chez Schemeä¸­çš„caseæ‰©å±•","uri":"https://lvsq.net/2019/12/case-in-chez-scheme/","year":"2019"},{"content":" æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´è‡³ï¼Œå…‹å°½å…¶ç”¨ï¼Œä¸Šä¸‹ä¸€ä½“ï¼Œä¿±ä¸å€¦è€Œäº‹å¯æ¯•çŸ£\nå‘¨äº‘æˆåº·ï¼Œæ±‰è¨€æ–‡æ™¯ã€‚æ— æœ‰å…­åå¹´ä¸æ°‘ä¼‘æ¯ï¼Œç´¯è—è“„ç§¯ï¼Œæ±‰æ­¦å¼€ç–†ä¹‹åŠŸä¾¿æ˜¯ç©ºæ–‡ï¼Œæ­¤åšç§¯è–„å‘è€³ï¼Œä¿—è¯­è¨€ï¼Œèƒ³è†Šæ”¶å›æ¥ï¼Œæ‰“å‡ºå»æ‰æœ‰åŠ›\næ­¦å¸ä¸€ä»£é›„ä¸»ï¼Œæ–‡æ²»æ­¦åŠŸï¼Œå¥‹é«˜ç¥–ä¹‹ä½™çƒˆï¼Œæ‰¿ä¸‰ç‹ä¹‹åœ£ç»ªï¼Œå¼€ä¸‡ä¸–ä¸æ‹”ä¹‹åŸºï¼Œå¾å›½æ–¯æ°‘ä¹‹å¹¸ï¼Œé“­è®°æ±‰é’\n","id":29,"section":"posts","summary":"æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´","tags":["éšæƒ³"],"title":"ç»§å­¦å½•","uri":"https://lvsq.net/2019/12/think/","year":"2019"},{"content":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚\nå…ˆçœ‹çœ‹è¯¥è¯­æ³•æè¿°ï¼š (fluid-let ((var expr) \u0026hellip;) body1 body2 \u0026hellip;) returns: the values of the body body1 body2 \u0026hellip; libraries: (chezscheme)\nè¯¥Bindingçš„ä½œç”¨ç±»ä¼¼å±€éƒ¨å˜é‡ï¼Œä¸set! æ¯”è¾ƒç›¸ä¼¼ã€‚ç”±fluid-letå®šä¹‰çš„å˜é‡å¿…é¡»å·²ç»‘å®šåˆ°é¡¶å±‚(top level)æˆ–è€…å°é—­çš„lambdaå†…æˆ–è€…å…¶ä»–å½¢å¼çš„ç»‘å®šï¼Œè¿™å¾ˆå…³é”®ï¼\nè¯·çœ‹ä»£ç ï¼š\n(let ([x 3]) (+ (fluid-let ([x 5]) x) x)) â‡’ 8 å…ˆå®šä¹‰å˜é‡x=3ï¼Œç„¶ååœ¨åŠ æ³•æ“ä½œå½“ä¸­ä¸´æ—¶å°†xçš„å€¼æ”¹ä¸º5ï¼Œæœ€åç»“æœä¸º8ï¼Œå¦‚æœå°†fluid-letä¸­çš„xæ¢ä¸ªåå­—ï¼Œæ¯”å¦‚yï¼Œå°†å¦‚ä½•å‘¢ï¼Ÿ ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼š\nException: variable y is not bound\nyæ²¡æœ‰ç»‘å®šï¼Œæ˜¯çš„ï¼Œyå³æ²¡æœ‰åœ¨é¡¶å±‚ä¸­è¢«å®šä¹‰ï¼Œä¹Ÿæœªåœ¨æŸä¸ªlambdaä¸­æˆ–è€…ä»»ä½•å…¶ä»–å½¢å¼ï¼Œè¿™é‡Œåªèƒ½æ˜¯x\nå†å­¦ä¹ ä¸‹ä¸¤ä¸ªä¾‹å­ï¼ŒåŠ æ·±å°è±¡ï¼š\n(let ([x \u0026#39;a]) (letrec ([f (lambda (y) (cons x y))]) (fluid-let ([x \u0026#39;b]) (f \u0026#39;c)) )) â‡’ (b . c) (let ([x \u0026#39;a]) (call/cc (lambda (k) (fluid-let ([x \u0026#39;b]) (letrec ([f (lambda (y) (k \u0026#39;*))]) (f \u0026#39;*))))) x) â‡’ a Fluid Bindingå®é™…ä¸Šæ˜¯Schemeå¯¹Dynamic Scopingçš„ä¿ç•™ï¼ŒSchemeä½¿ç”¨çš„æ˜¯Lexical Scopingï¼Œ å¯¹äºè¿™ä¸¤ç§Scopingæ›´è¯¦ç»†çš„æè¿°å¯å‚è€ƒLexical Scoping and Dynamic Scoping\n","id":30,"section":"posts","summary":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚ å…ˆçœ‹çœ‹è¯¥è¯­æ³•æ","tags":["fluid-let","Scheme"],"title":"Fluid Binding in Chez Scheme","uri":"https://lvsq.net/2019/12/fluid-binding/","year":"2019"},{"content":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚\nè¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec var expr) syntax returns: value of expr libraries: (chezscheme)\nThe syntactic form rec creates a recursive object from expr by establishing a binding of var within expr to the value of expr. In essence, it is a special case of letrec for self-recursive objects.\nThis form is useful for creating recursive objects (especially procedures) that do not depend on external variables for the recursion, which are sometimes undesirable because the exter-nal bindings can change. For example, a recursive procedure defined at top level depends on the value of the top-level variable given as its name. If the value of this variable should change, the meaning of the procedure itself would change. If the procedure is defined instead with rec, its meaning is independent of the variable to which it is bound.\nç®€è¦ç¿»è¯‘ä¸€ä¸‹ï¼š è¯­æ³•rec é€šè¿‡åœ¨exprä¸­å»ºç«‹varä¸exprçš„å€¼çš„ç»‘å®šï¼Œåˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ˜¯letrecç”¨äºè‡ªé€’å½’å¯¹è±¡çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚\nè¯­æ³•recé€šè¿‡ç»‘å®šexprä¸­åˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ï¼Œç”¨æ¥ è¿™ç§å½¢å¼å¯¹äºåˆ›å»ºä¸ä¾èµ–äºå¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’çš„é€’å½’å¯¹è±¡ï¼ˆå°¤å…¶æ˜¯è¿‡ç¨‹ï¼‰å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤–éƒ¨ç»‘å®šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥æœ‰æ—¶è¿™æ˜¯ä¸å¯å–çš„ã€‚\nçœ‹ä¸€ä¸ªä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹ï¼š ç»™å®šä¸€ä¸ªå…¨æ˜¯æ•°å­—çš„listï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°å­—nï¼Œç®—å‡º$1+2+\u0026hellip;+n$çš„å’Œï¼Œæœ€ç»ˆè¿”å›å’Œçš„list.\n(map (rec sum (lambda (x) (if (= x 0) 0 (+ x (sum (- x 1)))))) â€™(0 1 2 3 4 5)) â‡’ (0 1 3 6 10 15) å¦‚æœæ²¡æœ‰recè¯­æ³•ï¼Œç”¨letrecä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç¨æ˜¾éº»çƒ¦ï¼Œä»£ç ä¹Ÿå¤šä¸€äº›ï¼Œæ‰€ä»¥recè¿˜æ˜¯å¾ˆå¥½ç”¨çš„\næœ€åçœ‹ä¸€ä¸‹recè¯­æ³•çš„å®šä¹‰ï¼š\n(define-syntax rec (syntax-rules () [(_ x e) (letrec ((x e)) x)])) ","id":31,"section":"posts","summary":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚ è¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec","tags":["Scheme","Chez","rec"],"title":"Recursive Bindings in Chez Scheme","uri":"https://lvsq.net/2019/12/recursive-bindings/","year":"2019"},{"content":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´ï¼ŒåŠ¨æ‰‹å†™äº†ä¸€ä¸ªï¼Œç›®å‰å·²ç»åœ¨å…¬å¸å†…éƒ¨è¿è¡Œäº†å‡ å¹´ï¼Œæ•ˆæœè‰¯å¥½ï¼Œå¹¶ä¸”å·²ç»å¼€æºåœ¨Githubä¸Šï¼Œä»¥é£¨å„ä½ã€‚\nç‰¹ç‚¹ï¼š\nAPIç®€æ´\næ”¯æŒ3ç§äº‹ä»¶ï¼š\nUP DOWN JOIN åŸºäºVert.X\nå¼•å…¥ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;net.lvsq\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jgossip\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\nint gossip_port = 60001; String cluster = \u0026#34;gossip_cluster\u0026#34;; GossipSettings settings = new GossipSettings(); settings.setGossipInterval(1000); try { String myIpAddress = InetAddress.getLocalHost().getHostAddress(); List\u0026lt;SeedMember\u0026gt; seedNodes = new ArrayList\u0026lt;\u0026gt;(); SeedMember seed = new SeedMember(); seed.setCluster(cluster); seed.setIpAddress(myIpAddress); seed.setPort(60001); seedNodes.add(seed); gossipService = new GossipService(cluster, myIpAddress, gossip_port, null, seedNodes, settings, (member, state) -\u0026gt;System.out.println(\u0026#34;member:\u0026#34; + member + \u0026#34; state: \u0026#34; + state)); } catch (Exception e) { e.printStackTrace(); } gossipService.start(); è¯¦ç»†ä»‹ç»è¯·çœ‹ =\u0026gt; é¡¹ç›®åœ°å€\næ¬¢è¿å¤§å®¶forkï¼Œ å¦‚æœè§‰å¾—å¥½è¯·start ~~~\n","id":32,"section":"posts","summary":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›","tags":["jgossip","gossip"],"title":"Jgossip - gossipåè®®çš„å¼€æºå®ç°","uri":"https://lvsq.net/2019/12/jgossip/","year":"2019"},{"content":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ \nGolangçš„å®ç°ï¼š\n/** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result := \u0026amp;ListNode{} nodes := []*ListNode{} var carry = 0 for { node, c := add(l1, l2, carry) carry = c if node != nil { nodes = append(nodes, node) if l1 != nil \u0026amp;\u0026amp; l1.Next != nil { l1 = l1.Next } else { l1 = nil } if l2 != nil \u0026amp;\u0026amp; l2.Next != nil { l2 = l2.Next } else { l2 = nil } if carry \u0026gt; 0 \u0026amp;\u0026amp; (l1 == nil \u0026amp;\u0026amp; l2 == nil) { nodes = append(nodes, \u0026amp;ListNode{Val:carry}) } } else { break } } for i, n := range nodes{ if i == 0 { result = n } if i + 1 \u0026lt; len(nodes) { n.Next = nodes[i + 1] } } return result } func add (n1 *ListNode, n2 *ListNode, carry int) (*ListNode, int) { node := \u0026amp;ListNode{} if (n1 == nil \u0026amp;\u0026amp; n2 == nil) { return nil, 0 } if n1 == nil { n1 = \u0026amp;ListNode{Val : 0} } if n2 == nil { n2 = \u0026amp;ListNode{Val : 0} } sum := n1.Val + n2.Val + carry carry = 0 if sum \u0026gt; 9 { carry = 1 sum = sum - 10 } node.Val = sum return node, carry } ä¸‹é¢æä¾›Schemeç‰ˆæœ¬çš„å®ç°ã€(1 0) + (9 1 2) = (0 2 2)ã€‘ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œä¸é¢˜ç›®è¦æ±‚ç¨æœ‰ä¸åŒï¼Œè¿™é‡Œé‡‡ç”¨listï¼Œè€Œä¸æ˜¯é¢˜ç›®è¦æ±‚çš„é“¾è¡¨ï¼Œä½†å®é™…ä¸Šåº”æ˜¯ä¸€æ ·çš„ã€‚æ¯”è¾ƒä¹‹ä¸‹å¯ä»¥çœ‹å‡ºï¼Œç›¸å¯¹è€Œè¨€ï¼ŒSchemeè¯­è¨€çš„å®ç°æ›´åŠ ç®€çŸ­ä¼˜é›…ï¼Œå¾—ç›Šäºå…¶å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›\n(letrec ( [Polishing (lambda (l num) (if (eq? num 0) l (Polishing (append l \u0026#39;(0)) (- num 1))) ) ] [Align (lambda (l1 l2) (let ([len1 (length l1)] [len2 (length l2)]) (if [eq? len1 len2] [list l1 l2] [if (\u0026gt; len1 len2) (list l1 (Polishing l2 (- len1 len2))) (list (Polishing l1 (- len2 len1)) l2)])) ) ] [Add (lambda (l1 l2) (let ([ l (Align l1 l2)]) (Carry (map (lambda (x y) (+ x y)) (car l) (cadr l)) 0) ) ) ] [Carry (lambda (l c) (if (null? l) (if [eq? c 0] \u0026#39;() [cons c l]) (cons (mod ( + (car l) c ) 10) (Carry (cdr l) (quotient ( + (car l) c) 10))) ) ) ]) (Add \u0026#39;(1 0) \u0026#39;(9 1 2))) Golangç‰ˆæœ¬å’ŒSchemeç‰ˆæœ¬çš„å®ç°æ€è·¯ä¸ç›¸åŒï¼Œç®€è¦æè¿°ä¸€ä¸‹åè€…ï¼š\n(1 0) + (9 1 2), å…ˆè¿›è¡Œè¡¥ä½ï¼š (1 0 0) + (9 1 2), æŒ‰é¡ºåºç›¸åŠ ï¼Œå¾—ï¼š (10 1 2), å†è®¡ç®—è¿›ä½ï¼š (0 2 2) ","id":33,"section":"posts","summary":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ  Golangçš„å®ç°ï¼š /** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result","tags":["Scheme","leetcode"],"title":"ä¸¤æ•°ç›¸åŠ ","uri":"https://lvsq.net/2019/12/leetcode-2/","year":"2019"},{"content":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘ã€‚\né—®é¢˜æè¿° å‡è®¾æˆ‘ä»¬å·²ç»æœ‰è¶³å¤Ÿå¤šçš„1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†é’±å¸ï¼Œä»»æ„ç»™å®šé‡‘é¢æ¯”å¦‚1å…ƒï¼Œé—®æœ‰å¤šå°‘ç§ç»„åˆæ–¹å¼ï¼Ÿ æ¢è¨€ä¹‹ï¼Œ$$1x+2y+5z = 100$$ æ±‚x,y,zçš„è§£æœ‰å¤šå°‘ä¸ª\næ€è·¯ ç»„åˆæ–¹å¼çš„æ€»å’Œåº”ä¸ºï¼š\nä»»æ„æ‰£å»ä¸€ç§é’±å¸æ¯”å¦‚1åˆ†ï¼Œ1å…ƒé‡‡ç”¨2åˆ†ï¼Œ5åˆ†ä¸¤ç§é’±å¸çš„ç»„åˆæ•°ï¼Œå†åŠ ä¸Šï¼š\næ€»é¢ä¸ºï¼ˆ1å…ƒ-1åˆ†ï¼‰ï¼Œé‡‡ç”¨1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†ä¸‰ç§é’±å¸çš„ç»„åˆæ•°ï¼›\nå¾ˆæ˜æ˜¾è¿™å¯ä»¥å¾ˆå®¹æ˜“ç”¨é€’å½’å®ç°\nç¨ä½œä¸€ç‚¹è§£é‡Šï¼š\na. ä¸Šé¢ä¸¤æ­¥çš„æ„æ€æ˜¯ï¼šä¸å¸¦1åˆ†çš„ç»„åˆæ•° + å¸¦1åˆ†çš„ç»„åˆæ•° = å…¨éƒ¨çš„ç»„åˆæ•°ï¼› è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„\nb. ä¸Šè¿°ç¬¬2æ­¥ï¼Œï¼ˆ1å…ƒ-1åˆ†ï¼‰çš„æ„æ€æ˜¯ï¼šè¿™æ ·å¯ä»¥ä¿è¯ä»»æ„ä¸€ç§ç»„åˆæ–¹å¼å†åŠ 1åˆ†éƒ½ç­‰äº1å…ƒï¼Œä¿è¯è‡³å°‘æœ‰1ä¸ª1åˆ†çš„é’±å¸\n(letrec [ (A (lambda (n d) (if (= 0 (mod n d)) 1 0))) (B (lambda (n d) (cond [(not (pair? d)) 0] [(null? d) 0] [(= 0 n) 1] [(\u0026gt; 0 n) 0] [(= 1 (length d)) (A n (car d))] [else ( + (B n (cdr d)) (B (- n (car d)) d)) ] ) ) ) ] [B 100 \u0026#39;(1 2 5)] ) ","id":34,"section":"posts","summary":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘","tags":["Scheme","SICP"],"title":"é’±å¸ç»„åˆé—®é¢˜","uri":"https://lvsq.net/2019/12/count-coins/","year":"2019"},{"content":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quot;x-\u0026quot;ï¼‰è¯¥å¦‚ä½•å¼€å‘åšç´§è¦çš„ä»‹ç»ã€‚\nä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œæœ‰ä¸€ç‚¹éœ€è¦keep in mindï¼Œå³å¢åŠ æ‰©å±•çš„ä½ç½®ä¸åŒï¼Œæ‰€ç”¨çš„æ–¹æ³•ä¸åŒï¼Œæ‰€ä»¥éœ€è¦å¯¹Swaggerçš„æ ‡å‡†æœ‰æ‰€äº†è§£ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ springfoxç›®å‰åªå…è®¸ä¸‰ç§æ‰©å±•å®ç°:\nListVendorExtension:åˆ—è¡¨çš„å½¢å¼,è¯¥å¯¹è±¡æ”¯æŒæ³›å‹ï¼Œæœ€ç»ˆå½¢å¼ï¼šâ€x-fieldâ€:[{field:value}] ObjectVendorExtension:å¯¹è±¡çš„æ‰©å±•å½¢å¼,æœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯ï¼šâ€x-fieldâ€:[{field:value}] StringVendorExtension:stringç±»å‹çš„æ‰©å±•å®ç°ï¼Œæœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯â€x-fieldâ€:â€valueâ€ Swaggeræ ¹å¯¹è±¡æ‰©å±• ä»¥åœ¨infoä¸­æ·»åŠ ä¸€ä¸ªx-logoä¸ºä¾‹\n\u0026#34;info\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;swagger-bootstrap-uiï¼ï¼ï¼\u0026#34;, \u0026#34;termsOfService\u0026#34;: \u0026#34;http://www.xxx.com/\u0026#34;, \u0026#34;contact\u0026#34;: { \u0026#34;name\u0026#34;: pxxxx@domain.com\u0026#34; }, \u0026#34;x-logo\u0026#34;: { \u0026#34;url\u0026#34;: \u0026#34;http://\u0026#34;, \u0026#34;color\u0026#34;: \u0026#34;#090807\u0026#34; } }, ... åå°ä»£ç ï¼š\nObjectVendorExtension logo = new ObjectVendorExtension(\u0026#34;x-logo\u0026#34;); logo.addProperty(new StringVendorExtension(\u0026#34;url\u0026#34;, \u0026#34;https://xxx.svg\u0026#34;)); logo.addProperty(new StringVendorExtension(\u0026#34;color\u0026#34;, \u0026#34;#090807\u0026#34;)); return new ApiInfoBuilder() .title(\u0026#34;swagger-bootstrap-uiï¼ï¼\u0026#34;) .extensions(Lists.newArrayList(logo)) .description(\u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;) .termsOfServiceUrl(\u0026#34;http://www.xxx.com/\u0026#34;) .version(\u0026#34;1.0.0\u0026#34;) .build(); å†…éƒ¨å¯¹è±¡æ‰©å±• ç»™Pathæ·»åŠ ä¸€ä¸ªæ‰©å±•å±æ€§x-orderä¸ºä¾‹\n@Component @Order(Ordered.HIGHEST_PRECEDENCE+100) public class OperationPositionBulderPlugin implements OperationBuilderPlugin { @Override public void apply(OperationContext context) { context.operationBuilder().extensions(Lists.newArrayList(new StringVendorExtension(\u0026#34;x-order\u0026#34;,\u0026#34;1\u0026#34;))); } @Override public boolean supports(DocumentationType delimiter) { return true; } } è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ\n","id":35,"section":"posts","summary":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quo","tags":["swagger","vendorExtensions"],"title":"Swagger å¦‚ä½•ä½¿ç”¨vendorExtensionsè¿›è¡Œæ‰©å±•","uri":"https://lvsq.net/2019/11/swagger-vendor/","year":"2019"},{"content":" ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹ï¼Œå¦‚å¹³åŸå›å¹¿çº³å¼‚å›½å®¾å®¢ï¼›è‹ç§¦ä¸Šä¹¦äºä¸ƒå›½ï¼›è€å­éæ¸¸å¤©ä¸‹è€…çš†å¯è¯å„å›½æ–‡å­—å¹¶æ— å¤§ä¹–ã€‚ ã€Šå²ç±€ç¯‡ã€‹æ–‡é¦–ç›–äº‘â€œå¤ªå²ç±€ä¹¦â€ï¼Œäººå¤šè¯¯ä»¥å¤ªå²ç±€æ‰€ä½œï¼Œå¦‚æ­¤ä¾¿æœ›æ–‡ç”Ÿä¹‰äº†ã€‚å¤ªå²ä¹ƒå®˜èŒï¼Œç‹å›½ç»´å…ˆç”Ÿå¼•ã€Šè¯´æ–‡ã€‹è§£é‡Šï¼Œç±€å³è¯»ï¼Œè¯»å³ç±€ä¹¦ã€‚å¦å¤ªå²ç±€ä¹¦ä¹ƒå‘¨ä¸–ä¹‹æˆè¯­ï¼Œç»éäººåã€‚ è¿‘æ—¥å¾—é—»æ±‰æ–‡å¸éœ¸é™µè¢«å‘ç°ï¼Œè‡ªå…ƒä»¥é™ï¼Œè°¬ä¼ éœ¸é™µåœ¨å‡¤å‡°å˜´ï¼Œå¦‚ä»Šå¾—ä»¥ç¡®è®¤ï¼Œæ­¤æ¡ˆç»ˆäºå‹¾é”€ã€‚ã€Šæ±‰ä¹¦.æ–‡å¸çºªã€‹è½½ï¼šâ€œä¹™å·³ï¼Œè‘¬éœ¸é™µâ€ã€‚å‡¤å‡°å˜´ä¹Ÿå¥½ï¼Œæ±Ÿæ‘ä¹Ÿç½¢ï¼Œåœ¨å²ä¹¦ä¸Šåªæ˜¯ä¸€è¡Œå­—ã€‚å‘¨çŸ¥å…¬å…ƒå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå½“æ—¶æœ‰ä¸ªâ€œå«å›½â€å¹¶æœªç»Ÿä¸€ï¼Œä½†æ˜¯å²ä¹¦ä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå«å›½é™¤å¤–ã€‚â€ï¼›960å¹´ï¼Œå®‹æœç»Ÿä¸€ä¸­åŸï¼Œä½†æ˜¯ç°åœ¨çš„æ±Ÿæµ™åœ°åŒºè¿˜å­˜åœ¨ä¸€ä¸ªâ€œå´è¶Šå›½â€ï¼Œè¿‡äº†18å¹´æ‰çŒ®åœŸå…¥å®‹ï¼Œå²ä¹¦ä¹Ÿä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œ960å¹´ï¼Œå®‹æœ‰ä¸­å›½ï¼Œå´è¶Šé™¤å¤–â€ã€‚å«å›½å’Œå´è¶Šéƒ½åªæ˜¯å²ä¹¦ä¸Šçš„ä¸€è¡Œå­—ï¼Œè¿™å°±æ˜¯å†å²çš„çœ‹æ³•ã€‚1949å¹´ï¼Œå…±äº§å…šç»Ÿä¸€äº†ä¸­å›½ï¼Œå°æ¹¾å­¤æ‚¬ä¸€éš…ï¼Œå…¶å¤„å¢ƒå’Œå‰è€…æ¯”ç…§å¹¶æ— äºŒè‡´ï¼Œå°†æ¥å²ä¹¦ä¸Šçš„å°æ¹¾ä¹Ÿåªæ˜¯ä¸€è¡Œå­—ã€‚ ","id":36,"section":"posts","summary":"ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹","tags":["æ–‡å²"],"title":"å†å²ä¸èƒ½ç¢°","uri":"https://lvsq.net/2019/11/do-not-touch-history/","year":"2019"},{"content":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»åŠ¨8ä¸ªå­—ç¬¦ C-x C-f æŸ¥æ‰¾æˆ–è€…æ–°å»ºä¸€ä¸ªæ–‡ä»¶ C-x C-b åˆ—å‡ºç¼“å†²åŒºã€‚ C-x 1 å…³é—­ç¼“å†²åŒºåˆ—è¡¨ã€‚å°†éœ€è¦åˆ é™¤çš„ç¼“å†²åŒºæ ‡â€œdâ€(é€‰ä¸­ï¼ŒæŒ‰d),ç„¶åæŒ‰â€œxâ€æ‰§è¡Œåˆ é™¤æ ‡è®°çš„æ‰€æœ‰ç¼“å†²åŒº C-x b åˆ‡æ¢ç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºåå­—ï¼ŒRET C-x C-q å¼€å¯æˆ–è€…å…³é—­bufferçš„åªè¯»æ¨¡å¼ C-x k å…³é—­å½“å‰ç¼“å†²åŒº C-x C-s ä¿å­˜å½“å‰æ–‡ä»¶ C-x s ä¿å­˜æ‰€æœ‰æ–‡ä»¶ C-x h å…¨é€‰ M-w å¤åˆ¶ C-y ç²˜è´´ C-w å‰ªåˆ‡ C-s å¾€å‰æœç´¢ C-r å¾€åæœç´¢. DEL ä¹Ÿå¯ä»¥å¾€åæœç´¢ï¼Œ C-/ undo M-x calendar æ‰“å¼€æ—¥å†ã€‚æŒ‰ q é€€å‡ºã€‚ã€g d åˆ°æŒ‡å®šæ—¥æœŸã€‘ã€. åˆ°ä»Šæ—¥ï¼ˆä¸å±…ä¸­ï¼‰ã€‘ã€\u0026gt; å‰ä¸€ä¸ªæœˆã€‘ã€\u0026lt; åä¸€ä¸ªæœˆã€‘ M-x *-mode é€‰æ‹©Major mode M-x shell è¿è¡Œä¸€ä¸ªshell M-x eshell è¿è¡Œä¸€ä¸ªeshell C-a ç§»åˆ°è¡Œé¦– C-a C-kã€C-S-backspace åˆ é™¤æ•´è¡Œ C-u 5 C-S-backspaceã€M-5 C-S-backspace åˆ é™¤å5è¡Œï¼Œä¸åŠ æ•°å­—åˆ™åˆ é™¤4è¡Œï¼ˆé»˜è®¤ï¼‰ï¼Œå¦‚æœæ•°å­—ä¸ºè´Ÿæ•°ï¼Œåˆ™å¾€å‰åˆ  C-g åœæ­¢å½“å‰çš„å‘½ä»¤ C-k åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°è¡Œå°¾æ‰€æœ‰å­—ç¬¦ M-% æŸ¥æ‰¾åŠæ›¿æ¢ã€‚è¾“å…¥è¦è¢«æ›¿æ¢çš„è¯ï¼Œå›è½¦ï¼Œç„¶åè¾“å…¥è¦æ›¿æ¢çš„è¯ï¼Œå†å›è½¦ã€‚è¾“å…¥==y==æ›¿æ¢å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==n==å¿½ç•¥å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==q==ç»“æŸï¼Œ è¾“å…¥ ==!== æ›¿æ¢å‰©ä¸‹çš„å…¨éƒ¨ M-x occur RET xxx RET æ–°å¼€ä¸€ä¸ªçª—å£æ¥åˆ—å‡ºåŒ¹é…çš„è¡Œï¼Œç‚¹å‡»å°±ä¼šè·³è½¬åˆ°å¯¹åº”çš„ä½ç½®ï¼Œç¼–ç¨‹æ—¶æœ‰ç”¨ C-x C-t å½“å‰è¡Œä¸ä¸Šä¸€è¡Œæ¢ä½ç½® Org-Mode å¿«æ·é”® ç”¨é€” C-c . æ’å…¥æ—¶é—´ C-c C-e å¯¼å‡ºå…¶å®ƒæ ¼å¼ C-c C-s åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==SCHEDULED==â€å…³é”®å­—çš„æ—¶é—´æˆ³ã€‚ C-c C-d åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==DEADLINE==â€å…³é”®å­—çš„æ—¶é—´æˆ³ C-c C-t å°†å½“å‰é¡¹çš„çŠ¶æ€åœ¨ï¼ˆunmarkedï¼‰-\u0026gt;TODO-\u0026gt;DONE ä¹‹é—´å¾ªç¯åˆ‡æ¢ M-RET æ’å…¥ä¸€ä¸ªåŒçº§æ ‡é¢˜ M-LEFT/RIGHT å°†å½“å‰çš„æ ‡é¢˜æå‡/é™ä½ä¸€ä¸ªç­‰çº§ C-c C-c æ’å…¥æ ‡ç­¾tagã€‚ å…‰æ ‡åœ¨æ ‡é¢˜ä¸­ C-c C-q æ’å…¥æ ‡ç­¾tagã€‚å…‰æ ‡åœ¨ä»»æ„ä½ç½® C-c , è®¾ç½®å½“å‰æ ‡é¢˜çš„ä¼˜å…ˆçº§,â€™Aâ€˜ã€â€™Bâ€˜å’Œâ€™Câ€˜ã€‚â€™Aâ€˜æ˜¯æœ€é«˜çº§åˆ«ï¼Œå¦‚ä¸æŒ‡å®šï¼Œâ€™Bâ€˜æ˜¯é»˜è®¤çš„ C-c \\ æŸ¥æ‰¾æ ‡ç­¾tag S-Tab å±•å¼€æ‰€æœ‰æ ‡é¢˜ Tab å±•å¼€å…‰æ ‡æ‰€åœ¨æ ‡é¢˜ [==[== Link ==][== Description]==]== åˆ›å»ºé“¾æ¥ C-c C-l ç¼–è¾‘é“¾æ¥ C-c C-o æ‰“å¼€é“¾æ¥ C-c | (ç«–çº¿ï¼Œnot L) è¾“å…¥ åˆ— x è¡Œï¼Œ æ’å…¥ä¸€ä¸ªè¡¨æ ¼ [/] æˆ–è€… [%] é€šè¿‡åœ¨TODOé¡¹ç›®ä¸‹æ–°å»ºä¸€ä¸ªå¤§çº²æ ‘ï¼Œå¹¶åœ¨å­æ ‘ä¸Šæ ‡è®°å­ä»»åŠ¡æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸ºäº†èƒ½å¯¹å·²ç»å®Œæˆçš„ä»»åŠ¡æœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼Œä½ å¯ä»¥åœ¨æ ‡é¢˜çš„ä»»ä½•åœ°æ–¹æ’å…¥â€˜[/]â€™æˆ–è€…â€˜[%]â€™ã€‚å½“æ¯ä¸ªå­ä»»åŠ¡çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæˆ–è€…å½“ä½ åœ¨æ ‡è®°ä¸ŠæŒ‰ C-c C-æ—¶ï¼Œè¿™äº›æ ‡è®°çŠ¶æ€ä¹Ÿä¼šéšä¹‹æ›´æ–° \u0026lt;s Tab å¼€å¯ä¸€ä¸ªä»£ç å—ã€‚ #+begin_src c -n -t -h 7 -w 40: cä¸ºæ‰€æ·»åŠ çš„è¯­è¨€,-n æ˜¾ç¤ºè¡Œå·,-t æ¸…é™¤æ ¼å¼,-h 7 è®¾ç½®é«˜åº¦ä¸º7 -w 40è®¾ç½®å®½åº¦ä¸º40 C-c ' æ‰“å¼€ä¸€ä¸ªbuffer, è¾“å…¥ä»£ç ï¼Œå†æŒ‰ä¸€æ¬¡å¿«æ·é”®ï¼Œå°†ä»£ç å†™å…¥buffer C-c C-c è¿è¡Œæºä»£ç ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªRESULTå— å†…å®¹å…ƒæ•°æ® è¯¦æƒ…è§æ–‡å Markdown-Mode å¿«æ·é”® ç”¨é€” C-c C-c p ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-c v ç”Ÿæˆ basename.html å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-a u æ’å…¥=\u0026lt;\u0026gt;=è¿™æ ·çš„é“¾æ¥ C-c C-a f æ’å…¥è„šæ³¨é“¾æ¥ C-c C-a l æ’å…¥==è¿™æ ·çš„é“¾æ¥ Org-Mode å†…å®¹å…ƒæ•°æ® å¿«æ·é”® å†…å®¹ ç”¨é€” s #+begin_src \u0026hellip; #+end_src e #+begin_example \u0026hellip; #+end_example : å•è¡Œçš„ä¾‹å­ä»¥å†’å·å¼€å¤´ q #+begin_quote \u0026hellip; #+end_quote é€šå¸¸ç”¨äºå¼•ç”¨ï¼Œä¸é»˜è®¤æ ¼å¼ç›¸æ¯”å·¦å³éƒ½ä¼šç•™å‡ºç¼©è¿› v #+begin_verse \u0026hellip; #+end_verse é»˜è®¤å†…å®¹ä¸æ¢è¡Œï¼Œéœ€è¦ç•™å‡ºç©ºè¡Œæ‰èƒ½æ¢è¡Œ c #+begin_center \u0026hellip; #+end_center l #+begin_latex \u0026hellip; #+end_latex L #+latex: h #+begin_html \u0026hellip; #+end_html H #+html: a #+begin_ascii \u0026hellip; #+end_ascii A #+ascii: i #+index: line I #+include: line ","id":37,"section":"posts","summary":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»","tags":["emacs"],"title":"Emacs","uri":"https://lvsq.net/2019/11/emacs/","year":"2019"},{"content":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†å¾€å¾€è¯»å®Œå°±å¿˜è®°ï¼Œæˆ–è€…è®°ä½äº†å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯è½¬æ¢ä¸æˆèƒ½åŠ›ï¼Œæ‰è´¹äº†å¾ˆå¤šå¿ƒåŠ›å’Œæ—¶é—´ï¼Œæ‰€ä»¥è¯»ä¹¦æ–¹æ³•å°¤ä¸ºé‡è¦ã€‚æˆ‘è‡ªå°ä¹Ÿè¯»è¿‡ä¸€äº›ä¹¦ï¼Œä¸è¿‡ä»æ²¡æœ‰ç ”ç©¶è¿‡æ–¹æ³•è®ºï¼Œä¹Ÿå±äºä¸å¾—è¦é¢†çš„è¿™ä¸€ç±»ï¼Œæ‰€ä»¥æ½¦å€’åŠç”Ÿï¼Œé¡½æ„šä¸å ªã€‚\nå¤äººä¹‹ä¸­æœ‰å¾ˆå¤šè¯»ä¹¦å‰å®³çš„ï¼Œä¹Ÿæµä¼ ä¸‹æ¥ä¸€äº›è¯»ä¹¦ä¹‹é“ï¼Œæ¯”å¦‚äº”æŸ³ä¸æ±‚ç”šè§£ï¼Œå§é¾™è§‚å…¶å¤§ç•¥ã€‚ä¸¤ä½å…ˆè´¤éƒ½æ˜¯å–„å­¦ä¹‹å£«ï¼Œå…¶æ³•è•´å«è‡³ç†ï¼Œè‹¥æˆ‘ç­‰ä¸æ˜å°±é‡Œï¼Œå®¹æ˜“å •å…¥æ‡’æƒ°ã€‚æŸç§ç¨‹åº¦ä¸Šï¼Œäºè´¹æ›¼å­¦ä¹ æ³•æ®Šé€”åŒå½’ã€‚\nå¦å¤–éœ€è¦æŒ‡å‡ºçš„æ˜¯å­¦ä¹ åº”å½“æ˜¯ç³»ç»Ÿæ€§çš„ï¼Œç¢ç‰‡åŒ–å­¦ä¹ ä¸å¯å–ï¼Œè¿™ç§æ–¹å¼å¾—åˆ°çš„æ˜¯ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯çŸ¥è¯†ã€‚\nè´¹æ›¼å­¦ä¹ æ³•æœ‰å››ä¸ªæ ¸å¿ƒè¯ï¼šæ¦‚å¿µã€è®²æˆã€å®¡æŸ¥ã€ç®€åŒ–ã€‚\næ¦‚å¿µ æ¦‚å¿µæ˜¯æŒ‡æˆ‘ä»¬å¯¹éœ€è¦å­¦ä¹ çš„ç›®æ ‡æœ‰ç›¸å½“çš„æ¦‚å¿µï¼Œè¿™åŒ…æ‹¬æˆ‘ä»¬æ‰“ç®—å­¦ä¹ ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†å¾—åˆ°å“ªäº›çŸ¥è¯†ç­‰ç­‰ã€‚\nä¿—è¯­è¯´ï¼šå¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€åŠã€‚åœ¨å­¦ä¹ ä¹‹å‰æˆ‘ä»¬åº”å½“è°¨æ…åœ°æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®šè¦å­¦å—ï¼Ÿå¦‚æœæ˜¯è‚¯å®šçš„ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆèŠ±ä¸€ç‚¹ç‚¹æ—¶é—´åˆæ­¥äº†è§£ä¸€ä¸‹å°†è¦å­¦ä¹ çš„é¢†åŸŸçš„ä¸»è¦æ€æ½®æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›æƒå¨çš„ä¸“å®¶å’Œä¹¦ç±ï¼Ÿç„¶åå°±å¯ä»¥ä¹°ä¸€äº›ä¹¦å¹¶åˆ¶å®šåˆç†çš„è®¡åˆ’å¼€å§‹è¿™æ®µæ—…ç¨‹äº†ã€‚\nå…³äºä¹°ä¹¦ï¼Œæˆ‘çš„å»ºè®®æ˜¯å°½é‡é€‰æ‹©ç»å…¸è‘—ä½œï¼Œä¸ç”¨å¤ªå¤šï¼Œè´ªå¤šåè€Œåš¼ä¸çƒ‚ã€‚å¦å¤–ä¹Ÿè¦è€ƒè™‘å‡ºç‰ˆç¤¾ï¼Œä¸€èˆ¬å‡ºåçš„å‡ºç‰ˆç¤¾ç¼–è¾‘çš„ä¹¦è´¨é‡ä¼šæœ‰ä¿éšœï¼Œæ¯”å¦‚æ–‡å²ç±»çš„ï¼Œä¸­åä¹¦å±€ï¼Œä¸Šå¤ç­‰å¾ˆä¸é”™ã€‚\nç¿»å¼€ä¹¦æœ¬ä¹‹å‰ï¼Œéœ€æå‡ºè‡ªå·±çš„æœŸæœ›ï¼Œå³æˆ‘å¸Œæœ›æœ¬ä¹¦èƒ½æä¾›ç»™æˆ‘å…³äºæŸæŸé—®é¢˜çš„ç­”æ¡ˆï¼Œé˜…è¯»ä¸­æ—¶åˆ»å›´ç»•è¯¥é—®é¢˜è¿›è¡Œæ€è€ƒï¼Œè¿™æ ·å¯æ±²å–æƒ³è¦çš„çŸ¥è¯†ã€‚\nä¸€ä¸ªé¢†åŸŸçš„çŸ¥è¯†ç‚¹å¾€å¾€æå¤šï¼Œå› æ­¤é˜…è¯»æ—¶ä¸åº”è¢«åŠ¨åœ°å…¨ç›˜æ¥å—ï¼Œåº”ä¸»åŠ¨åŠ å·¥çŸ¥è¯†ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¼šå½’çº³ã€ç­›é€‰å’Œåˆ†æï¼Œè¿™å¯¹äºå½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æä¸ºé‡è¦ã€‚\nè®²æˆ è¿™æ˜¯è´¹æ›¼å­¦ä¹ æ³•çš„æ ¸å¿ƒã€‚é€šè¿‡å‘å…¶ä»–äººè®²æˆè‡ªå·±ä¹ å¾—çš„çŸ¥è¯†ï¼Œæ¥å·©å›ºè‡ªèº«æ‰€å­¦ï¼Œå¹¶ä¸”åˆ©ç”¨ä»–äººçš„åé¦ˆå’Œè´¨ç–‘æ¥æŸ¥ç¼ºè¡¥æ¼ï¼Œä»è€Œæ›´åŠ ç†è§£è¯¥é¢†åŸŸï¼Œè¿™æ˜¯ä¸€ç§æ­£å‘ç§¯æçš„è¿­ä»£ã€‚å½“æˆ‘ä»¬èƒ½å¤Ÿç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è§£é‡ŠæŸä¸ªé¢†åŸŸçš„çŸ¥è¯†ï¼Œå¹¶ä¸”èƒ½è®©ä¸€ä½é—¨å¤–æ±‰äº§ç”Ÿå…±é¸£ï¼Œé‚£ä¹ˆå¯ä»¥è¯´æˆ‘ä»¬å¯¹äºè¯¥é¢†åŸŸæœ‰ç›¸å½“çš„ç†è§£äº†ã€‚\nç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è®²æˆå¾ˆé‡è¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡ç‚¼çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šåŠ å…¥è‡ªå·±çš„æƒ³æ³•ï¼Œå¹¶ä¸å…¶ä»–çŸ¥è¯†äº¤å‰ææºï¼Œé€æ¸å½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚ä½“ç³»æ˜¯ç‹¬ç«‹æ€è€ƒçš„åŸºçŸ³ï¼Œå› æ­¤å¯¹ä»»ä½•äº‹éƒ½èƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œè€Œä¸æ˜¯äººäº‘äº¦äº‘ã€‚\né€šä¿—åœ°è®²ï¼Œè¿™æ˜¯ç”¨è¾“å‡ºæ¥å€’é€¼è¾“å…¥ã€‚å¦‚æœè‡ªå·±ä¸èƒ½è§£é‡Šæ¸…æ¥šï¼Œåªèƒ½è¯´æ˜è¿˜æ²¡æœ‰æŒæ¡ç²¾é«“ã€‚ä»»ä½•å¤æ‚çš„äº‹æƒ…èƒŒåéƒ½æœ‰ä¸€ä¸ªç®€å•çš„çœŸç†ã€‚\nå®¡æŸ¥ å­Ÿå­è¯´ï¼šå°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦ã€‚æ‰€ä»¥å­¦ä¹ å¿…éœ€å…·å¤‡æ€€ç–‘ç²¾ç¥ï¼Œå½“ç„¶ä¸æ˜¯ç›²ç›®çš„æ€€ç–‘ï¼Œæ€€ç–‘ä¸€åˆ‡æ˜¯ä¸€ç§æµªè´¹ã€‚å¥½å¥‡å¿ƒæ˜¯é©±ä½¿äººç±»è¿›æ­¥çš„åŸåŠ¨åŠ›ï¼Œå¹¼å„¿å¯¹ä»€ä¹ˆéƒ½å¥½å¥‡ï¼Œè¿™ä¼šä¿ƒè¿›ä»–ä»¬æˆé•¿ï¼Œå’Œè®¤è¯†ä¸–ç•Œã€‚æˆäººä¸¢æ‰äº†ç«¥çœŸï¼ŒæŸäº›æ–¹é¢çœ‹æ˜¯ä¸€ç§æŸå¤±ã€‚å²å®¶è’™æ–‡é€šå…ˆç”Ÿè€ƒè¯•é¥¶æœ‰è¶£å‘³ï¼Œä¸æ˜¯ä»–å‡ºé¢˜è€ƒå­¦ç”Ÿï¼Œè€Œæ˜¯ç”±å­¦ç”Ÿå‡ºé¢˜é—®ä»–ã€‚å¦‚æœå­¦ç”Ÿç§¯ç´¯ä¸å¤Ÿï¼Œå¥½å¥‡ä¸è¶³ï¼Œä¾¿æƒ³å‡ºä¸äº†å¥½é¢˜ï¼Œæ‰€ä»¥å¾€å¾€è€ƒç”Ÿä¸€å‡ºå£ï¼Œè’™å…ˆç”Ÿå°±çŸ¥é“è¯¥ç”Ÿå­¦é—®å¦‚ä½•äº†ã€‚\nç®€åŒ– äººçš„ç²¾åŠ›ç›¸å½“æœ‰é™ï¼Œå†µä¸”æˆå¹´ä¹‹åå„ç§æ‚äº‹çº·è‡³æ²“æ¥ï¼Œæ²‰ä¸‹å¿ƒå­¦ä¹ çš„æ—¶é—´å°‘ä¹‹åˆå°‘ï¼Œæ‰€ä»¥æ›´åº”å½“é›†ä¸­ç²¾ç¥ï¼Œç¼©å°èŒƒå›´ã€‚\nä¸‹é¢é™„ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œæ¾„æ¸…è„‰ç»œï¼š\n","id":38,"section":"posts","summary":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†","tags":["éšæƒ³"],"title":"è´¹æ›¼å­¦ä¹ æ³•","uri":"https://lvsq.net/2022/03/feynman_technique/","year":"2022"},{"content":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;; + `doom-font\u0026#39; ;; + `doom-variable-pitch-font\u0026#39; ;; + `doom-big-font\u0026#39; -- used for `doom-big-font-mode\u0026#39;; use this for ;; presentations or streaming. ;; ;; They all accept either a font-spec, font string (\u0026#34;Input Mono-12\u0026#34;), or xlfd ;; font string. You generally only need these two: ;;(setq doom-font (font-spec :family \u0026#34;monaco\u0026#34; :size 14 :weight \u0026#39;semi-light) ;; doom-variable-pitch-font (font-spec :family \u0026#34;sans\u0026#34; :size 13)) ;; There are two ways to load a theme. Both assume the theme is installed and ;; available. You can either set `doom-theme\u0026#39; or manually load a theme with the ;; `load-theme\u0026#39; function. This is the default: (setq doom-theme \u0026#39;doom-monokai-pro) ;; If you use `org\u0026#39; and don\u0026#39;t want your org files in the default location below, ;; change `org-directory\u0026#39;. It must be set before org loads! (setq org-directory \u0026#34;~/work/emacs-org/\u0026#34;) ;; This determines the style of line numbers in effect. If set to `nil\u0026#39;, line ;; numbers are disabled. For relative line numbers, set this to `relative\u0026#39;. (setq display-line-numbers-type t) ;; Here are some additional functions/macros that could help you configure Doom: ;; ;; - `load!\u0026#39; for loading external *.el files relative to this one ;; - `use-package!\u0026#39; for configuring packages ;; - `after!\u0026#39; for running code after a package has loaded ;; - `add-load-path!\u0026#39; for adding directories to the `load-path\u0026#39;, relative to ;; this file. Emacs searches the `load-path\u0026#39; when you load packages with ;; `require\u0026#39; or `use-package\u0026#39;. ;; - `map!\u0026#39; for binding new keys ;; ;; To get information about any of these functions/macros, move the cursor over ;; the highlighted symbol at press \u0026#39;K\u0026#39; (non-evil users must press \u0026#39;C-c c k\u0026#39;). ;; This will open documentation for it, including demos of how they are used. ;; ;; You can also try \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) to jump to their definition and see how ;; they are implemented. (custom-set-faces ;; custom-set-faces was added by Custom. ;; If you edit it by hand, you could mess it up, so be careful. ;; Your init file should contain only one such instance. ;; If there is more than one, they won\u0026#39;t work right. \u0026#39;(default ((t (:family \u0026#34;Monaco\u0026#34; :foundry \u0026#34;nil\u0026#34; :slant normal :weight normal :height 150 :width normal)))) \u0026#39;(rainbow-delimiters-depth-1-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;light green\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-2-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;goldenrod2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-3-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark magenta\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-4-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark cyan\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-5-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark blue\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-6-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;PaleVioletRed2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-7-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;SpringGreen4\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-8-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;chocolate3\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-9-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;blue\u0026#34;))))) (setq auto-save-default t) (run-with-idle-timer 5 t #\u0026#39;save-some-buffers t) (setq make-backup-files t) (setq confirm-kill-emacs nil) (set-frame-position (selected-frame) 0 0) (add-to-list \u0026#39;default-frame-alist \u0026#39;(fullscreen . maximized)) (setq initial-frame-alist \u0026#39;((top . 1) (left . 1) (width . 114) (height . 32))) ;;org-mode (setq org-superstar-headline-bullets-list \u0026#39;(\u0026#34;âœ¿\u0026#34; \u0026#34;âœ¸\u0026#34; \u0026#34;â—‰\u0026#34; \u0026#34;â–\u0026#34; \u0026#34;â—‹\u0026#34; )) ;;(setq org-todo-keywords \u0026#39;((sequence \u0026#34;TODO(t)\u0026#34; \u0026#34;STARTED(s!)\u0026#34; \u0026#34;WAITING(w@/!)\u0026#34; \u0026#34;|\u0026#34; \u0026#34;DONE(d@/!)\u0026#34; \u0026#34;CANCELLED(c@/!)\u0026#34;))) (setf org-todo-keyword-faces \u0026#39;((\u0026#34;TODO\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#95A5A6\u0026#34;))(\u0026#34;STRT\u0026#34;. (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#2E8B57\u0026#34;))(\u0026#34;DONE\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#3498DB\u0026#34;)))) (setq org-log-done \u0026#39;time) (setq org-cycle-include-plain-lists t) (setq org-export-coding-system \u0026#39;utf-8) (setq org-src-fontify-natively t) (setq org-html-doctype \u0026#34;html5\u0026#34;) (setq org-html-xml-declaration nil) (setq org-html-head \u0026#34;\u0026lt;link rel=\u0026#39;stylesheet\u0026#39; href=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css\u0026#39; integrity=\u0026#39;sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js\u0026#39; integrity=\u0026#39;sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js\u0026#39; integrity=\u0026#39;sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;) (org-babel-do-load-languages \u0026#39;org-babel-load-languages \u0026#39;((emacs-lisp . t) (c . t) (java . t) (go . t) (racket . t) (python . t) (latex . t) (shell . t) (js . t) (lisp . t) (scheme . t))) (setq-default prettify-symbols-alist \u0026#39;((\u0026#34;#+BEGIN_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+END_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+begin_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;#+end_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;\u0026gt;=\u0026#34; . \u0026#34;â‰¥\u0026#34;)(\u0026#34;=\u0026gt;\u0026#34; . \u0026#34;â‡¨\u0026#34;))) (setq prettify-symbols-unprettify-at-point \u0026#39;right-edge) (add-hook \u0026#39;org-mode-hook \u0026#39;prettify-symbols-mode) (setq org-adapt-indentation nil) : ;;auto-wrap (global-visual-line-mode 1) ;1 for on, 0 for off. ;;racket (require \u0026#39;racket-mode) (setq racket-program \u0026#34;/Applications/Racket v8.4/bin/racket\u0026#34;) (setq tab-always-indent \u0026#39;complete) ;; ä½¿ç”¨tabè‡ªåŠ¨è¡¥å…¨ (add-to-list \u0026#39;auto-mode-alist \u0026#39;(\u0026#34;\\\\.rkt\\\\\u0026#39;\u0026#34; . racket-mode)) (add-to-list \u0026#39;magic-mode-alist \u0026#39;(\u0026#34;^#lang racket\u0026#34; . :racket-mode)) ;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ;; language evniroment (set-language-environment \u0026#39;UTF-8) (set-locale-environment \u0026#34;UTF-8\u0026#34;) (define-coding-system-alias \u0026#39;UTF-8 \u0026#39;utf-8) ;; elfeed (setq elfeed-db-directory \u0026#34;~/work/emacs-org/elfeed\u0026#34;) (setq rmh-elfeed-org-files (list \u0026#34;~/work/emacs-org/elfeed/elfeed.org\u0026#34;)) (add-hook! \u0026#39;elfeed-search-mode-hook #\u0026#39;elfeed-update) ;;(add-hook \u0026#39;elfeed-new-entry-hook ;; (elfeed-make-tagger :before \u0026#34;2 weeks ago\u0026#34; ;; :remove \u0026#39;unread)) ;; lsp (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred) :custom ;; what to use when checking on-save. \u0026#34;check\u0026#34; is default, I prefer clippy (lsp-rust-analyzer-cargo-watch-command \u0026#34;clippy\u0026#34;) (lsp-eldoc-render-all t) (lsp-idle-delay 0.6) ;; enable / disable the hints as you prefer: (lsp-inlay-hint-enable t) ;; These are optional configurations. See https://emacs-lsp.github.io/lsp-mode/page/lsp-rust-analyzer/#lsp-rust-analyzer-display-chaining-hints for a full list (lsp-rust-analyzer-display-lifetime-elision-hints-enable \u0026#34;skip_trivial\u0026#34;) (lsp-rust-analyzer-display-chaining-hints t) (lsp-rust-analyzer-display-lifetime-elision-hints-use-parameter-names nil) (lsp-rust-analyzer-display-closure-return-type-hints t) (lsp-rust-analyzer-display-parameter-hints nil) (lsp-rust-analyzer-display-reborrow-hints nil) :config (add-hook \u0026#39;lsp-mode-hook \u0026#39;lsp-ui-mode)) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure :commands lsp-ui-mode :custom (lsp-ui-peek-always-show t) (lsp-ui-sideline-show-hover t) (lsp-ui-doc-enable nil)) (use-package flycheck :ensure) ;;rust ;;refer: https://robert.kra.hn/posts/rust-emacs-setup/ (use-package rustic :ensure :bind (:map rustic-mode-map (\u0026#34;M-j\u0026#34; . lsp-ui-imenu) (\u0026#34;M-?\u0026#34; . lsp-find-references) (\u0026#34;C-c C-c l\u0026#34; . flycheck-list-errors) (\u0026#34;C-c C-c a\u0026#34; . lsp-execute-code-action) (\u0026#34;C-c C-c r\u0026#34; . lsp-rename) (\u0026#34;C-c C-c q\u0026#34; . lsp-workspace-restart) (\u0026#34;C-c C-c Q\u0026#34; . lsp-workspace-shutdown) (\u0026#34;C-c C-c s\u0026#34; . lsp-rust-analyzer-status)) :config ;; uncomment for less flashiness ;; (setq lsp-eldoc-hook nil) ;; (setq lsp-enable-symbol-highlighting nil) ;; (setq lsp-signature-auto-activate nil) ;; comment to disable rustfmt on save (setq rustic-format-on-save t) (add-hook \u0026#39;rustic-mode-hook \u0026#39;rk/rustic-mode-hook)) (defun rk/rustic-mode-hook () ;; so that run C-c C-c C-r works without having to confirm, but don\u0026#39;t try to ;; save rust buffers that are not file visiting. Once ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should ;; no longer be necessary. (when buffer-file-name (setq-local buffer-save-without-query t)) (add-hook \u0026#39;before-save-hook \u0026#39;lsp-format-buffer nil t)) init.el ;;; init.el -*- lexical-binding: t; -*- ;; This file controls what Doom modules are enabled and what order they load ;; in. Remember to run \u0026#39;doom sync\u0026#39; after modifying it! ;; NOTE Press \u0026#39;SPC h d h\u0026#39; (or \u0026#39;C-h d h\u0026#39; for non-vim users) to access Doom\u0026#39;s ;; documentation. There you\u0026#39;ll find a \u0026#34;Module Index\u0026#34; link where you\u0026#39;ll find ;; a comprehensive list of Doom\u0026#39;s modules and what flags they support. ;; NOTE Move your cursor over a module\u0026#39;s name (or its flags) and press \u0026#39;K\u0026#39; (or ;; \u0026#39;C-c c k\u0026#39; for non-vim users) to view its documentation. This works on ;; flags as well (those symbols that start with a plus). ;; ;; Alternatively, press \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) on a module to browse its ;; directory (for easy access to its source code). ;;; æ·»åŠ ä¸­å›½æº ;;(setq package-archives \u0026#39;((\u0026#34;gnu\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/gnu/\u0026#34;) ;; (\u0026#34;melpa\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa/\u0026#34;) ;; (\u0026#34;melpa-stable\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa-stable/\u0026#34;) ;; (\u0026#34;org\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/org/\u0026#34;))) (doom! :input ;; chinese ;;japanese ;;layout ; auie,ctsrnm is the superior home row :completion company ; the ultimate code completion backend ;;helm ; the *other* search engine for love and life ;;ido ; the other *other* search engine... ivy ; a search engine for love and life vertico ; the search engine of the future :ui ;;deft ; notational velocity for Emacs doom ; what makes DOOM look the way it does doom-dashboard ; a nifty splash screen for Emacs doom-quit ; DOOM quit-message prompts when you quit Emacs ;;(emoji +unicode) ; ğŸ™‚ hl-todo ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW ;;hydra ;;indent-guides ; highlighted indent columns ;;ligatures ; ligatures and symbols to make your code pretty again ;;minimap ; show a map of the code on the side modeline ; snazzy, Atom-inspired modeline, plus API ;;nav-flash ; blink cursor line after big motions ;;neotree ; a project drawer, like NERDTree for vim ophints ; highlight the region an operation acts on (popup +defaults) ; tame sudden yet inevitable temporary windows ;;tabs ; a tab bar for Emacs treemacs ; a project drawer, like neotree but cooler ;;unicode ; extended unicode support for various languages vc-gutter ; vcs diff in the fringe vi-tilde-fringe ; fringe tildes to mark beyond EOB ;;window-select ; visually switch windows workspaces ; tab emulation, persistence \u0026amp; separate workspaces ;;zen ; distraction-free coding or writing :editor (evil +everywhere); come to the dark side, we have cookies file-templates ; auto-snippets for empty files fold ; (nigh) universal code folding (format +onsave) ; automated prettiness ;;god ; run Emacs commands without modifier keys ;;lispy ; vim for lisp, for people who don\u0026#39;t like vim ;;multiple-cursors ; editing in many places at once ;;objed ; text object editing for the innocent ;;parinfer ; turn lisp into python, sort of ;;rotate-text ; cycle region at point between text candidates snippets ; my elves. They type so I don\u0026#39;t have to word-wrap ; soft wrapping with language-aware indent :emacs dired ; making dired pretty [functional] electric ; smarter, keyword-based electric-indent ;;ibuffer ; interactive buffer management undo ; persistent, smarter undo for your inevitable mistakes vc ; version-control and Emacs, sitting in a tree :term eshell ; the elisp shell that works everywhere shell ; simple shell REPL for Emacs ;;term ; basic terminal emulator for Emacs vterm ; the best terminal emulation in Emacs :checkers syntax ; tasing you for every semicolon you forget ;;(spell +flyspell) ; tasing you for misspelling mispelling ;;grammar ; tasing grammar mistake every you make :tools ;;ansible ;;biblio ; Writes a PhD for you (citation needed) ;;debugger ; FIXME stepping through code, to help you add bugs ;;direnv ;;docker ;;editorconfig ; let someone else argue about tabs vs spaces ;;ein ; tame Jupyter notebooks with emacs (eval +overlay) ; run code, run (also, repls) ;;gist ; interacting with github gists lookup ; navigate your code and its documentation lsp ; M-x vscode magit ; a git porcelain for Emacs ;;make ; run make tasks from Emacs ;;pass ; password manager for nerds ;;pdf ; pdf enhancements ;;prodigy ; FIXME managing external services \u0026amp; code builders ;;rgb ; creating color strings ;;taskrunner ; taskrunner for all your projects ;;terraform ; infrastructure as code ;;tmux ; an API for interacting with tmux ;;upload ; map local to remote projects via ssh/ftp :os (:if IS-MAC macos) ; improve compatibility with macOS tty ; improve the terminal Emacs experience :lang ;;agda ; types of types of types of types... ;;beancount ; mind the GAAP ;;cc ; C \u0026gt; C++ == 1 ;;clojure ; java with a lisp ;;common-lisp ; if you\u0026#39;ve seen one lisp, you\u0026#39;ve seen them all ;;coq ; proofs-as-programs ;;crystal ; ruby at the speed of c ;;csharp ; unity, .NET, and mono shenanigans ;;data ; config/data formats ;;(dart +flutter) ; paint ui and not much else ;;dhall ;;elixir ; erlang done right ;;elm ; care for a cup of TEA? emacs-lisp ; drown in parentheses ;;erlang ; an elegant language for a more civilized age ;;ess ; emacs speaks statistics ;;factor ;;faust ; dsp, but you get to keep your soul ;;fortran ; in FORTRAN, GOD is REAL (unless declared INTEGER) ;;fsharp ; ML stands for Microsoft\u0026#39;s Language ;;fstar ; (dependent) types and (monadic) effects and Z3 ;;gdscript ; the language you waited for (go +lsp) ; the hipster dialect ;;(haskell +lsp) ; a language that\u0026#39;s lazier than I am ;;hy ; readability of scheme w/ speed of python ;;idris ; a language you can depend on json ; At least it ain\u0026#39;t XML ;;(java +meghanada) ; the poster child for carpal tunnel syndrome (java +lsp) javascript ; all(hope(abandon(ye(who(enter(here)))))) ;;julia ; a better, faster MATLAB ;;kotlin ; a better, slicker Java(Script) ;;latex ; writing papers in Emacs has never been so fun ;;lean ; for folks with too much to prove ;;ledger ; be audit you can be ;;lua ; one-based indices? one-based indices markdown ; writing docs for people to ignore ;;nim ; python + lisp at the speed of c ;;nix ; I hereby declare \u0026#34;nix geht mehr!\u0026#34; ;;ocaml ; an objective camel (org +pretty) ; organize your plain life in plain text ;;php ; perl\u0026#39;s insecure younger brother ;;plantuml ; diagrams for confusing people more ;;purescript ; javascript, but functional python ; beautiful is better than ugly ;;qt ; the \u0026#39;cutest\u0026#39; gui framework ever racket ; a DSL for DSLs ;;raku ; the artist formerly known as perl6 ;;rest ; Emacs as a REST client ;;rst ; ReST in peace ;;(ruby +rails) ; 1.step {|i| p \u0026#34;Ruby is #{i.even? ? \u0026#39;love\u0026#39; : \u0026#39;life\u0026#39;}\u0026#34;} ;;rust ; Fe2O3.unwrap().unwrap().unwrap().unwrap() ;;scala ; java, but good ;;(scheme +guile) ; a fully conniving family of lisps sh ; she sells {ba,z,fi}sh shells on the C xor ;;sml ;;solidity ; do you need a blockchain? No. ;;swift ; who asked for emoji variables? ;;terra ; Earth and Moon in alignment for performance. ;;web ; the tubes yaml ; JSON, but readable ;;zig ; C, but simpler :email ;;(mu4e +org +gmail) ;;notmuch ;;(wanderlust +gmail) :app ;;calendar ;;emms ;;everywhere ; *leave* Emacs!? You must be joking ;;irc ; how neckbeards socialize (rss +org) ; emacs as an RSS reader ;;twitter ; twitter client https://twitter.com/vnought :config ;;literate (default +bindings +smartparens)) packages.el ;; -*- no-byte-compile: t; -*- ;;; $DOOMDIR/packages.el ;; To install a package with Doom you must declare them here and run \u0026#39;doom sync\u0026#39; ;; on the command line, then restart Emacs for the changes to take effect -- or ;; use \u0026#39;M-x doom/reload\u0026#39;. ;; To install SOME-PACKAGE from MELPA, ELPA or emacsmirror: ;(package! some-package) ;; To install a package directly from a remote git repo, you must specify a ;; `:recipe\u0026#39;. You\u0026#39;ll find documentation on what `:recipe\u0026#39; accepts here: ;; https://github.com/raxod502/straight.el#the-recipe-format ;(package! another-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34;)) ;; If the package you are trying to install does not contain a PACKAGENAME.el ;; file, or is located in a subdirectory of the repo, you\u0026#39;ll need to specify ;; `:files\u0026#39; in the `:recipe\u0026#39;: ;(package! this-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34; ; :files (\u0026#34;some-file.el\u0026#34; \u0026#34;src/lisp/*.el\u0026#34;))) ;; If you\u0026#39;d like to disable a package included with Doom, you can do so here ;; with the `:disable\u0026#39; property: ;(package! builtin-package :disable t) ;; You can override the recipe of a built in package without having to specify ;; all the properties for `:recipe\u0026#39;. These will inherit the rest of its recipe ;; from Doom or MELPA/ELPA/Emacsmirror: ;(package! builtin-package :recipe (:nonrecursive t)) ;(package! builtin-package-2 :recipe (:repo \u0026#34;myfork/package\u0026#34;)) ;; Specify a `:branch\u0026#39; to install a package from a particular branch or tag. ;; This is required for some packages whose default branch isn\u0026#39;t \u0026#39;master\u0026#39; (which ;; our package manager can\u0026#39;t deal with; see raxod502/straight.el#279) ;(package! builtin-package :recipe (:branch \u0026#34;develop\u0026#34;)) ;; Use `:pin\u0026#39; to specify a particular commit to install. ;(package! builtin-package :pin \u0026#34;1a2b3c4d5e\u0026#34;) ;; Doom\u0026#39;s packages are pinned to a specific commit and updated from release to ;; release. The `unpin!\u0026#39; macro allows you to unpin single packages... ;(unpin! pinned-package) ;; ...or multiple packages ;(unpin! pinned-package another-pinned-package) ;; ...Or *all* packages (NOT RECOMMENDED; will likely break things) ;(unpin! t) (package! racket-mode) (package! spacemacs-theme) elfeed.org * root :elfeed: ** Programming :programming: *** https://www.reddit.com/r/functionalprogramming/.rss :Reddit: ** News :news: *** https://news.ycombinator.com/rss :Hack News: ","id":39,"section":"posts","summary":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;;","tags":["emacs"],"title":"æˆ‘çš„Doom Emacsé…ç½®","uri":"https://lvsq.net/2022/02/my-doom-emacs-config/","year":"2022"},{"content":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘äº†ç”¨æˆ·æŠ˜è…¾çš„æ—¶é—´ï¼Œè€Œä¸”å¯åŠ¨å¾ˆå¿«ï¼Œæä¾›è¶…è¿‡60é—¨ç¼–ç¨‹è¯­è¨€çš„å¯é€‰é¡¹ï¼Œå¯è°“ååˆ†å¼ºå¤§ã€‚\nç¬”è€…å¹³æ—¶ä¼šä½¿ç”¨Golangå¼€å‘ï¼Œæ‰€ä»¥ç¬¬ä¸€æ—¶é—´å¼€å¯äº†Golangçš„æ”¯æŒï¼Œç”±äºDoom Emacsçš„èµ„æ–™æ¯”è¾ƒå°‘ï¼Œåœ¨é…ç½®çš„è¿‡ç¨‹ä¸­èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œç»è¿‡ä¸€ç•ªæŠ˜è…¾ä¹‹åç»ˆäºæœ‰ä¸€ä¸ªå¯ç”¨çš„ç‰ˆæœ¬ï¼Œå¯èƒ½è¿˜æœ‰é—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰å‘ç°ï¼Œç°è®°å½•ä¸€ä¸‹ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚\nDoomå®‰è£…å®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ï¼š\nç¬¬ä¸€æ­¥ ä¿®æ”¹ ~/doom.d/init.el, å¯ç”¨ï¼ˆSPC f Pï¼‰æ‰¾åˆ°è¯¥æ–‡ä»¶\nåœ¨ (doom! ä¸‹é¢æ‰¾åˆ°ï¼š\n:lang (go +lsp)\n:tools (lsp)\n:editor (sinppets, evil +everywhere, format +onsave)\nï¼šcompletion (company)\n()ä¸­çš„é¡¹ç›®éƒ½æ‰“å¼€\nç¬¬äºŒæ­¥ æ‰¾åˆ°~/doom.d/config.el,æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\n;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred)) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure t :commands lsp-ui-mode) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ç¬¬ä¸‰æ­¥ å®‰è£…ä¾èµ–åŒ…ï¼š\ngo install github.com/motemen/gore/cmd/gore@latest go install github.com/stamblerre/gocode@latest go install golang.org/x/tools/cmd/godoc@latest go install golang.org/x/tools/cmd/goimports@latest go install golang.org/x/tools/cmd/gorename@latest go install golang.org/x/tools/cmd/guru@latest go install github.com/cweill/gotests/...@latest go install github.com/fatih/gomodifytags@latest # gopls for (+lsp) go install golang.org/x/tools/gopls@latest # golangci go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest è¿™æ˜¯é’ˆå¯¹Go \u0026gt;= v1.16çš„ï¼Œä½äºè¿™ä¸ªç‰ˆæœ¬çš„ç”¨go getï¼Œ æˆ‘æƒ³ç°åœ¨å¤§å®¶ç”¨çš„éƒ½æ˜¯æ–°ç‰ˆæœ¬äº†ã€‚\nç¬¬å››æ­¥ æ‰§è¡Œ~/.emacs.d/bin/doom sync æˆ–è€… (SPC h r r) ä½¿é…ç½®ç”Ÿæ•ˆ\nç¬¬äº”æ­¥ é‡å¯ä¸€ä¸‹Emacså³å¯\n","id":40,"section":"posts","summary":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘","tags":["emacs","golang"],"title":"Doom Emacs Golang ç¯å¢ƒé…ç½®","uri":"https://lvsq.net/2021/12/doom-emacs-golang-env/","year":"2021"},{"content":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œä»£ç å°±å®Œæˆäº†ã€‚\n#lang racket (require racket/cmdline) (define show-bytes (make-parameter #t)) (define show-lines (make-parameter #t)) (define show-words (make-parameter #t)) (define files (make-parameter null)) (define re-chan (make-channel)) (define cmd-line (command-line #:program \u0026#34;r-wc\u0026#34; #:once-any [(\u0026#34;-c\u0026#34; \u0026#34;--bytes\u0026#34; \u0026#34;--chars\u0026#34;) \u0026#34;The number of bytes\u0026#34; (show-bytes #t) (show-lines #f) (show-words #f)] [(\u0026#34;-l\u0026#34; \u0026#34;--lines\u0026#34;) \u0026#34;The number of lines\u0026#34; (show-lines #t) (show-bytes #f) (show-words #f)] [(\u0026#34;-w\u0026#34; \u0026#34;--words\u0026#34;) \u0026#34;The muber of words\u0026#34; (show-words #t) (show-bytes #f) (show-lines #f)] #:args file (files file))) (define (do-work) (if (null? (files)) (displayln \u0026#34;Please enter the file name\u0026#34;) (begin (for-each scan-file (files)) (let loop ([finished 0]) (unless (= finished (length (files))) (let ((re (channel-get re-chan))) (match re ((list l w b f) (displayln (append (for/list ([d (list l w b)] [t (list (show-lines) (show-words) (show-bytes) )] #:when t) d) f))))) (loop (add1 finished))))))) (define (scan-file f) (thread (lambda () (call-with-input-file f (lambda (in) (let loop ([a-line (read-line in)] [bytes 0] [lines 0] [words 0]) (if (eof-object? a-line) (channel-put re-chan (list lines words bytes f)) (let-values (((w b) (parse-line a-line))) (loop (read-line in) (+ bytes b) (add1 lines) (+ words w)))))))))) (define (parse-line a-line) (define s (open-input-string a-line)) (if (null? a-line) (values 0 0) (let loop ([w 0] [b 0] [pre-char #\\a]) (define bl b) (define c (read-char s)) (unless (eof-object? c) (set! bl (+ (char-utf-8-length c) b))) (if (eof-object? c) (values (add1 w) (add1 b)) (case c [(#\\space) (loop (if (char-whitespace? pre-char) w (add1 w)) (add1 b) c)] [else (loop w bl c)]))))) (do-work) ç„¶åç”¨racoç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº, åå­—å°±å«r-wcï¼Œå’Œwcç¨å¾®åŒºåˆ†ä¸€ä¸‹ï¼š\nraco exe -o r-wc r-wc.rkt å°±åƒä½¿ç”¨wcå‘½ä»¤ä¸€æ ·ï¼Œ\nâœ racket ./r-wc -h usage: r-wc [ \u0026lt;option\u0026gt; ... ] [\u0026lt;file\u0026gt;] ... \u0026lt;option\u0026gt; is one of / -c, --bytes, --chars | The number of bytes | -l, --lines | The number of lines | -w, --words \\ The muber of words --help, -h Show this help -- Do not treat any remaining argument as a switch (at this level) /|\\ Brackets indicate mutually exclusive options. Multiple single-letter switches can be combined after one `-`. For example, `-h-` is the same as `-h --`. ä¸Šé¢çš„ç¨‹åºæ‰§è¡Œæ•ˆç‡ä¸æ˜¯å¾ˆå¥½ï¼Œä¸»è¦è¡¨ç°åœ¨è¯»å–æ–‡ä»¶ï¼Œå’Œè§£ææ¯ä¸€è¡Œæ—¶ï¼Œå ç”¨çš„æ—¶é—´å’Œå†…å­˜å¤ªå¤§ã€‚Racketæä¾›äº†ä¸€ä¸ªç‰¹æ€§Sequences ï¼Œå®ƒå¯ä»¥ä¸for å½¢å¼ä¸€æ ·éå†æ•°æ®ç»“æœï¼Œä½†æ˜¯æ•ˆç‡å´é«˜å¾ˆå¤šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨Sequencesæ¥é‡æ„æˆ‘ä»¬çš„ç¨‹åºï¼Œå°†ä¸Šæ–‡çš„ä¸¤ä¸ªå‡½æ•°scan-file å’Œparse-line ä¿®æ”¹ä¸ºï¼š\n(define (scan-file f) (thread (lambda () (define bytes 0) (define lines 0) (define words 0) (call-with-input-file f (lambda (in) (for ([a-line (in-bytes-lines in)]) (let-values (((w b) (parse-line-seq a-line))) (set! bytes (+ bytes b)) (set! lines (add1 lines)) (set! words (+ words w)))) (channel-put re-chan (list lines words bytes f))))))) (define (parse-line a-line) (define pre-char #\\a) (define w 0) (define b 0) (if (null? a-line) (values 0 0) (for ([c (in-bytes a-line)]) (case c [(#\\space) (unless (char-whitespace? pre-char) (set! w (add1 w))) (set! b (add1 b))] [else (set! b (add1 b))]) (set! pre-char c))) (values (add1 w) (add1 b))) ä¸¤ä¸ªç‰ˆæœ¬å¯¹æ¯”ä¸€ä¸‹(æ–‡ä»¶å¤§å°100MB)ï¼š\nOld version Sequences version wc æ—¶é—´ 4.6s 0.8s 0.4s å³°å€¼å†…å­˜ 132M 115M 1M ç»è¿‡Sequencesé‡æ„ä¹‹åï¼Œæ‰§è¡Œæ—¶é—´æœ‰äº†å·¨å¤§çš„æå‡ï¼Œå¹¶ä¸”æœ€å¤§å†…å­˜ä½¿ç”¨é‡ä¹Ÿæœ‰æ‰€å‡å°‘ï¼Œä¸è¿‡ä¸wcè¿˜æ˜¯æœ‰ä¸å°‘å·®è·ã€‚å¸Œæœ›æœ‰ä¸€å¤©èƒ½å¤Ÿæ‰¾åˆ°è¶…è¶Šwcçš„æ–¹æ³•ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":41,"section":"posts","summary":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œ","tags":["racket"],"title":"ä¸åˆ°60è¡Œä»£ç ï¼Œç”¨Racketå®ç°wcå‘½ä»¤","uri":"https://lvsq.net/2021/08/racket-wc/","year":"2021"},{"content":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…çš„å­—èŠ‚æ•°ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™å¯¹äºæˆ‘ä»¬è°ƒè¯•å’Œä¼˜åŒ–ä»£ç å¾ˆæœ‰å¸®åŠ©ï¼Œä¸è¿‡Matthew Flattå¹¶æ²¡æœ‰æ‰“ç®—å°†Racketçš„timeå‡½æ•°æ·»åŠ è¿™ä¸€åŠŸèƒ½ï¼Œå°½ç®¡å¦‚æ­¤ï¼ŒMatthew Flattæä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œåªæ˜¯ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚\nChez Schemeçš„timeå‡½æ•°æ‰“å°çš„æ ¼å¼å¦‚ä¸‹ï¼š\n19 collections\n0.201254290s elapsed cpu time, including 0.183228711s collecting\n0.201678000s elapsed real time, including 0.183665000s collecting\n160012160 bytes allocated, including 113015168 bytes reclaimed\nä¸€ä¸‹æ˜¯æ”¹è¿›çš„timeå‡½æ•°ï¼Œåå­—å«time2:\n(define (time2 proc lst) (let ([mem-before (current-memory-use \u0026#39;cumulative)]) (let-values ([(r cpu-time real-time gc-time) (time-apply proc lst)]) (let ([mem-now (current-memory-use \u0026#39;cumulative)]) (values r (format \u0026#34;~ams elapsed cpu time\u0026#34; cpu-time) (format \u0026#34;~ams elapsed real time\u0026#34; real-time) (format \u0026#34;~ams elapsed gc time\u0026#34; gc-time) (format \u0026#34;~a bytes allocated\u0026#34; (- mem-now mem-before))))))) \u0026gt; (time2 make-list \u0026#39;(10000000 0)) \u0026#34;177ms elapsed cpu time\u0026#34; \u0026#34;178ms elapsed real time\u0026#34; \u0026#34;153ms elapsed gc time\u0026#34; \u0026#34;160100112 bytes allocated\u0026#34; (time2 make-bytes \u0026#39;(10000)) \u0026#34;0ms elapsed cpu time\u0026#34; \u0026#34;0ms elapsed real time\u0026#34; \u0026#34;0ms elapsed gc time\u0026#34; \u0026#34;10544 bytes allocated\u0026#34; åˆ†é…çš„å­—èŠ‚æ•°ä¸ä¼šéå¸¸ç²¾ç¡®ï¼Œæ¯”å¦‚æ²¡æœ‰è€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œä¸è¿‡åœ¨REPLä¸­å€’æ˜¯å¯ä»¥ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šæœ‰å¤ªå¤§çš„åå·®ã€‚\ncurrent-memory-useå’Œcustodian\ncurrent-memory-useå‡½æ•°çš„å‚æ•°æœ‰3ç§æ¨¡å¼ï¼š\n(current-memory-use [mode]) â†’ exact-nonnegative-integer?\nmode : (or/c #f \u0026lsquo;cumulative custodian?) = #f\nç¬¬ä¸‰ç§modeå«åš custodian? ï¼Œ è¿™æ˜¯Racketæä¾›çš„ä¸€ç§ç›‘æŠ¤æœºåˆ¶.\ncustodian å¯ä»¥ç”¨æ¥ç®¡ç†ä¸€ç»„çº¿ç¨‹ã€æ–‡ä»¶æµç«¯å£ã€TCPç«¯å£ã€TCPç›‘å¬å™¨ã€UDP socketsã€å­—èŠ‚è½¬æ¢å™¨ã€placeã€‚å½“çº¿ç¨‹æˆ–è€…ç«¯å£ç­‰ç­‰è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ç½®äº(current-custodian)çš„ç›‘æŠ¤ä¹‹ä¸‹ï¼Œé™¤äº†root custodian, æ¯ä¸€ä¸ªcustodianéƒ½å¤„äºå…¶çˆ¶çº§çš„custodiançš„ç®¡ç†ä¹‹ä¸‹ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå±‚æ¬¡ç»“æ„ã€‚\nå½“ä¸€ä¸ªcustodianè¢«( custodian-shutdown-all )å…³é—­æ—¶ï¼Œå®ƒä¼šç«‹å³ä¸”å¼ºåˆ¶ç»ˆç»“å…¶ä¸‹ç®¡ç†çš„çº¿ç¨‹ã€ç«¯å£ç­‰ç­‰ã€‚\ncustodianåœ¨å¾ˆå¤šåœºæ™¯ä¸­å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç”¨äºé‡Šæ”¾èµ„æºï¼š\n#lang racket (define done-chan (make-channel)) (define (print-hello) (define my-cust (make-custodian)) ;; å®šä¹‰ç›‘æŠ¤äºº,ä¾¿äºæ¸…ç†æ‰€æœ‰ç›¸å…³èµ„æº (parameterize ([current-custodian my-cust]) (thread (lambda () (let loop () (displayln \u0026#34;Hello\u0026#34;) (sleep 3) (loop)))) (thread (lambda () (let loop () (define item (channel-get done-chan)) (custodian-shutdown-all my-cust)))))) (print-hello) ;; (channel-put done-chan #t) è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªcustodianï¼Œ å¹¶å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ç”±è¿™ä¸ªcustodianç®¡ç†ï¼ˆ(parameterize ([current-custodian my-cust]))ï¼‰ã€‚ä¸€ä¸ªçº¿ç¨‹æ¯éš”3ç§’é’Ÿæ‰“å°ä¸€ä¸ªâ€œHelloâ€ï¼Œæ°¸ä¸åœæ­¢ã€‚å¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…done-chan æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ¶ˆæ¯ï¼Œåˆ™å…³é—­custodian, åŒæ—¶å…³é—­è¿™ä¸ªcustodianä¸‹çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±é‡Šæ”¾äº†èµ„æºã€‚\ncustodianè¿˜å¯ä»¥ç”¨æ¥é™åˆ¶å†…å­˜çš„ä½¿ç”¨é‡ï¼š\n(custodian-limit-memory (current-custodian) (* 2 1024)) (define x (make-bytes (* 4 1024))) è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šæç¤ºout of memoryï¼ˆåœ¨REPLæ— æ•ˆï¼‰ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":42,"section":"posts","summary":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…","tags":["racket"],"title":"æ”¹è¿›Racketçš„timeå‡½æ•°","uri":"https://lvsq.net/2021/07/racket-time-improvement/","year":"2021"},{"content":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š\n(thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰:\n(define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©ç”¨therad-waitæ¥ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæˆ.\n(define worker (thread (lambda () (for ([i 100]) (printf \u0026#34;Working hard... ~a~n\u0026#34; i))))) (thread-wait worker) (displayln \u0026#34;Worker finished\u0026#34;) Thread Mailboxes æ¯ä¸ªçº¿ç¨‹å…·å¤‡ä¸€ä¸ªé‚®ç®±æ¥æ¥å—æ¶ˆæ¯ï¼Œthread-sendç”¨äºå¼‚æ­¥åœ°å‘ä¸€ä¸ªçº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œthread-receiveå¯è·å–é‚®ç®±ä¸­æœ€è€çš„æ¶ˆæ¯,å¦‚æœ‰å¿…è¦çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ã€‚ è¿™å°±æ˜¯Actorå¹¶å‘æ¨¡å‹ï¼ŒErlangä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ¨¡å‹ã€‚\n(define worker-thread (thread (lambda () (let loop () (match (thread-receive) [(? number? num) (printf \u0026#34;Processing ~a~n\u0026#34; num) (loop)] [\u0026#39;done (printf \u0026#34;Done~n\u0026#34;)]))))) (for ([i 20]) (thread-send worker-thread i)) (thread-send worker-thread \u0026#39;done) (thread-wait worker-thread) Semaphores ç”¨äºåŒæ­¥ã€‚\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (semaphore-wait output-semaphore) (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i) (semaphore-post output-semaphore))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) æˆ–è€…ä½¿ç”¨call-with-semaphoreï¼Œä¸ç”¨æ˜¾å¼åœ°é‡Šæ”¾ä¿¡å·é‡\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (call-with-semaphore output-semaphore (lambda () (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i))))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) Channels é€šé“ç”¨äºçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®,Golangé‡‡å–çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚\nchannel-putç”¨æ¥å‘é€æ•°æ®åˆ°é€šé“ï¼Œchannel-getå¯ä»¥ä»é€šé“ä¸­è·å–æ•°æ®.\n(define result-channel (make-channel)) (define result-thread (thread (lambda () (let loop () (display (channel-get result-channel)) (loop))))) (define work-channel (make-channel)) (define (make-worker thread-id) (thread (lambda () (let loop () (define item (channel-get work-channel)) (case item [(DONE) (channel-put result-channel (format \u0026#34;Thread ~a done\\n\u0026#34; thread-id))] [else (channel-put result-channel (format \u0026#34;Thread ~a processed ~a\\n\u0026#34; thread-id item)) (loop)]))))) (define work-threads (map make-worker \u0026#39;(1 2))) (for ([item \u0026#39;(A B C D E F G H DONE DONE)]) (channel-put work-channel item)) (for-each thread-wait work-threads) (channel-put result-channel \u0026#34;\u0026#34;) ; waits until result-thread has printed all other output ç¼“å†²å¼‚æ­¥é€šé“Buffered Asynchronous Channels ä¸ä¸Šè¿°çš„channelç±»ä¼¼ï¼Œåªæ˜¯BACä¼šæœ‰ä¸€å®šçš„ç¼“å†²åŒºï¼Œä¸€èˆ¬ä¸ä¼šè¢«é˜»å¡ï¼Œé™¤éç¼“å†²åŒºæ»¡äº†ï¼ˆputæ“ä½œï¼‰æˆ–è€…ç©ºï¼ˆgetæ“ä½œï¼‰.\n(require racket/async-channel) (define print-thread (thread (lambda () (let loop () (displayln (thread-receive)) (loop))))) (define (safer-printf . items) (thread-send print-thread (apply format items))) (define work-channel (make-async-channel 3)) (define (make-worker-thread thread-id) (thread (lambda () (let loop () (define item (async-channel-get work-channel)) (safer-printf \u0026#34;Thread ~a processing item: ~a\u0026#34; thread-id item) (loop))))) (for-each make-worker-thread \u0026#39;(1 2 3)) (for ([item \u0026#39;(a b c d e f g h i j k l m)]) (async-channel-put work-channel item)) åŒæ­¥äº‹ä»¶å’Œsync (define main-thread (current-thread)) (define alarm (alarm-evt (+ 3000 (current-inexact-milliseconds)))) (define channel (make-channel)) (define (make-worker-thread thread-id) (thread (lambda () (define evt (sync channel alarm)) (cond [(equal? evt alarm) (thread-send main-thread \u0026#39;alarm)] [else (thread-send main-thread (format \u0026#34;Thread ~a received ~a\u0026#34; thread-id evt))])))) (make-worker-thread 1) (make-worker-thread 2) (make-worker-thread 3) (channel-put channel \u0026#39;A) (channel-put channel \u0026#39;B) (let loop () (match (thread-receive) [\u0026#39;alarm (displayln \u0026#34;Done\u0026#34;)] [result (displayln result) (loop)])) æ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":43,"section":"posts","summary":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š (thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰: (define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©","tags":["racket","thread"],"title":"Racket å¹¶å‘ä¸åŒæ­¥","uri":"https://lvsq.net/2021/07/racket-concurrency/","year":"2021"},{"content":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set!\né€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ª.rkt æ–‡ä»¶é‡Œçš„å†…å®¹å±äºæŸä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åå°±æ˜¯æ–‡ä»¶åã€‚\nåœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼šmod_demo\nâ”œâ”€â”€ mod_demo\nâ”‚ â”œâ”€â”€ ext\nâ”‚ â”‚ â””â”€â”€ cake.rkt\nâ”‚ â””â”€â”€ main.rkt\nmod_demoç›®å½•ä¸‹æœ‰ä¸€ä¸ªmain.rktæ¨¡å—ï¼Œå’Œä¸€ä¸ªextç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªcake.rktçš„æ¨¡å—ã€‚\ncake.rktçš„å†…å®¹å¦‚ä¸‹ï¼š\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (provide print-cake) æ„å‘³ç€å°†å‡½æ•°print-cakeå¯¼å‡ºï¼Œåœ¨æ¨¡å—å¤–éƒ¨å°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°äº†ï¼›è¿˜æœ‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°show, è¯¥å‡½æ•°æœªå¯¼å‡ºï¼Œæ‰€ä»¥å¤–éƒ¨æ— æ³•è®¿é—®ã€‚ main.rktçš„å†…å®¹ä¸ºï¼š\n#lang racket (require \u0026#34;ext/cake.rkt\u0026#34;) (print-cake (random 30)) (require \u0026ldquo;ext/cake.rkt\u0026rdquo;) å°†cakeæ¨¡å—å¼•å…¥ï¼Œå¼•ç”¨è·¯å¾„ç¬¦åˆUnixé£æ ¼(ä½†æ˜¯ï¼Œä¸èƒ½ä»¥æ–‡ä»¶åˆ†éš”ç¬¦å³\u0026rsquo;/\u0026lsquo;ä½œä¸ºå¼€å§‹æˆ–è€…ç»“æŸ)ï¼Œä¹Ÿæ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œ(require \u0026ldquo;./ext/cake.rkt\u0026rdquo;) ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚\nCollections collectionä¸­çš„æ¨¡å—é€šè¿‡ä¸å¸¦å¼•å·çš„ã€æ— åç¼€çš„è·¯å¾„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼šä»¥ä¸‹æ¨¡å—å¼•ç”¨äº†ä½œä¸ºâ€œracketâ€ collectionä¸€éƒ¨åˆ†çš„â€œdate.rktâ€åº“ï¼š\n#lang racket (require racket/date) (printf \u0026#34;Today is ~s\\n\u0026#34; (date-\u0026gt;string (seconds-\u0026gt;date (current-seconds)))) æ³¨æ„ï¼Œ(require racket/date)æ²¡æœ‰å¸¦åŒå¼•å·ã€‚åƒracket/dateè¿™æ ·çš„æ¨¡å—çœ‹èµ·æ¥åƒä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå½“requireçœ‹åˆ°ä¸€ä¸ªæœªåŠ å¼•å·çš„æ¨¡å—å¼•ç”¨æ—¶ï¼Œå®ƒä¼šå°†å¼•ç”¨è½¬æ¢ä¸ºåŸºäºcollectionçš„æ¨¡å—è·¯å¾„ï¼š\né¦–å…ˆï¼Œå¦‚æœæœªå¼•ç”¨çš„è·¯å¾„ä¸åŒ…å« /ï¼Œç„¶å requireä¼šè‡ªåŠ¨å‘å¼•ç”¨æ·»åŠ ä¸€ä¸ªâ€œ/mainâ€ã€‚ä¾‹å¦‚ï¼Œ( require slideshow )ç­‰æ•ˆäº( require slideshow/main )ã€‚ å…¶æ¬¡ï¼Œrequire å‘è·¯å¾„éšå¼æ·»åŠ äº†â€œ.rktâ€åç¼€ã€‚ æœ€åï¼Œrequireé€šè¿‡åœ¨å·²å®‰è£…çš„collectionä¸­æœç´¢æ¥è§£æè·¯å¾„ï¼Œè€Œä¸æ˜¯å°†è·¯å¾„è§†ä¸ºç›¸å¯¹äºå°é—­æ¨¡å—çš„è·¯å¾„ã€‚ Packages and Collections ä¸€ä¸ªpackageæ˜¯ä¸€ç»„é€šè¿‡RacketåŒ…ç®¡ç†å™¨å®‰è£…çš„åº“çš„é›†åˆã€‚Racket ç¨‹åºä¸ç›´æ¥å¼•ç”¨åŒ…ã€‚ç›¸åï¼Œç¨‹åºé€šè¿‡collectionså¼•ç”¨åº“ï¼Œå¹¶ä¸”æ·»åŠ æˆ–åˆ é™¤åŒ…ä¼šæ›´æ”¹å¯ç”¨çš„åŸºäºé›†åˆçš„åº“é›†ã€‚\næ·»åŠ Collections libraryçš„æ—¨åœ¨è·¨å¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œå› æ­¤å°†åº“çš„æºæ–‡ä»¶ä¿å­˜åœ¨ä¸€ä¸ªç›®å½•ä¸­å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œæ›´ä¸èƒ½å°†åº“å¤åˆ¶åˆ°ä¸åŒçš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯æ–°å¢ä¸€ä¸ªcollectionï¼Œå°†libæ”¾åœ¨collectionä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸å¸¦å¼•å·çš„è·¯å¾„å¼•ç”¨å®ƒï¼Œå°±åƒRacket å‘è¡Œç‰ˆä¸­åŒ…å«çš„åº“ä¸€æ ·ã€‚\nä¸ç”¨æ‹…å¿ƒï¼Œåˆ›å»ºä¸€ä¸ªåŒ…æ— éœ€æäº¤åˆ°å…¬å¼€çš„åŒ…æœåŠ¡å™¨ï¼Œå¯ä»¥å®‰è£…åˆ°æœ¬åœ°æ¥ä½¿ç”¨ã€‚\né‡‡ç”¨raco pkgå‘½ä»¤è¡Œå·¥å…·ï¼š raco pkg install \u0026ndash;link /path/to/mod_demo\nå®‰è£…ä¹‹åï¼Œåœ¨ä»»ä½•æ¨¡å—ä¸­ä½¿ç”¨(require mod_demo/ext/cake)éƒ½ä¼šä»/path/to/mod_demo/ext/cake.rktå¯¼å…¥print-cakeå«å‡½æ•°ã€‚\n\u0026gt; (require mod_demo/ext/cake) \u0026gt; (print-cake 4) ...... .-||||||-. | | ------------ \u0026gt; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å®‰è£…çš„ç›®å½•åç§°æ—¢ç”¨ä½œåŒ…åç§°åˆç”¨ä½œåŒ…æä¾›çš„collection\nå°†libæ”¾å…¥collectionä¹‹åï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨raco makeæ¥ç¼–è¯‘åº“çš„æºæ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨raco setupæ›´åŠ æ–¹ä¾¿ã€‚å°¤å…¶æ˜¯ä¿®æ”¹äº†æ¨¡å—ä»£ç åï¼Œä½¿ç”¨raco setupä¼šé‡æ–°ç¼–è¯‘æ‰€æœ‰åº“æ–‡ä»¶ï¼Œå¹¶é‡æ–°å®‰è£…åŒ…ã€‚ä¸raco makeä¸åŒçš„æ˜¯ï¼Œraco setup åé¢çš„å‚æ•°æ˜¯åŒ…åï¼Œå³raco setup mod_demo, è€Œraco makeåé¢æ˜¯æ¨¡å—åï¼Œå³raco make main.rktã€‚\næ¨¡å—è¯­æ³• æ¨¡å—æ–‡ä»¶å¼€å¤´å¤„çš„#langå…¶å®æ˜¯æ¨¡å—å½¢å¼çš„ç®€å†™ï¼Œä½†ä¸èƒ½ç”¨äºREPLã€‚\næ¨¡å—å½¢å¼ æ™®é€šå½¢å¼çš„æ¨¡å—å£°æ˜ï¼Œå¯ä»¥å·¥ä½œäºREPL\n(module name-id initial-module-path decl \u0026hellip;)\nname-idæ˜¯æ¨¡å—çš„åå­—ï¼Œinitial-module-path ä¸ºåˆå§‹åŒ–å¯¼å…¥ï¼Œæ¯ä¸ªdeclå¯ä»¥æ˜¯å¯¼å…¥ï¼Œæˆ–è€…å¯¼å‡ºï¼Œæˆ–è€…å®šä¹‰ï¼Œæˆ–è€…è¡¨è¾¾å¼ã€‚\ninitial-module-pathæ˜¯å¿…é¡»çš„ï¼Œæ¨¡å—å†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªç¯å¢ƒï¼ˆSICPä¸­çš„ç¯å¢ƒï¼Œå³ä¸Šä¸‹æ–‡ï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨çš„æŒ‡ä»¤æ˜¯éœ€è¦é€šè¿‡initial-module-pathå¼•å¯¼çš„ã€‚å¸¸ç”¨çš„initial-module-pathæ˜¯racket, require/define/provideç­‰ç­‰éƒ½æ¥è‡ªracketã€‚å¦ä¸€ä¸ªå¸¸ç”¨çš„initial-module-pathæ˜¯racket-base,å®ƒæä¾›çš„åŠŸèƒ½è¾ƒå°‘ï¼Œä½†ä»ç„¶æ˜¯å¾ˆå¸¸ç”¨ã€‚\nä¸Šä¸€èŠ‚ä¸­çš„â€œcake.rktâ€ä¹Ÿå¯ä»¥å†™æˆï¼š\n(module cake racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline))) è¿™ç§æ¨¡å—å½¢å¼æ˜¯å¯ä»¥è¢«REPLæ±‚å€¼çš„ï¼ˆæ³¨æ„(require \u0026lsquo;cake)ï¼Œ æ¨¡å—åcakeéœ€è¦è¢«quoteï¼Œå› ä¸ºè¿™æ—¶cakeæ˜¯éæ–‡ä»¶çš„æ¨¡å—å£°æ˜ï¼‰ï¼š\n\u0026gt; (require \u0026#39;cake) \u0026gt; (print-cake 3) ... .-|||-. | | --------- å£°æ˜ä¸€ä¸ªæ¨¡å—ï¼Œå…¶bodyä¸ä¼šè¢«ç«‹åˆ»æ±‚å€¼ï¼Œåªæœ‰åœ¨æ˜¾å¼åœ°è¢«requireä¹‹åæ‰ä¼šæ±‚å€¼ä¸€æ¬¡ã€‚\n\u0026gt; (module hi racket (printf \u0026#34;Hello\\n\u0026#34;)) \u0026gt; (require \u0026#39;hi) Hello \u0026gt; (require \u0026#39;hi) #lang #langå£°æ˜çš„æ¨¡å—çš„bodyæ²¡æœ‰ç‰¹å®šçš„è¯­æ³•ï¼Œå› ä¸ºå…¶è¯­æ³•ç”±#langä¹‹åçš„åç§°æ‰€å†³å®šã€‚\næ¯”å¦‚ï¼Œ#lang racketçš„è¯­æ³•æ˜¯ï¼š\n#lang racket decl ... ç­‰åŒäºï¼š\n(module name racket decl ...) nameæ˜¯åŒ…å«#langå½¢å¼çš„æ–‡ä»¶å\nå­æ¨¡å— ä¸€ä¸ªæ¨¡å—å¯ä»¥åµŒå¥—åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œçˆ¶æ¨¡å—å¯ä»¥ç›´æ¥è®¿é—®å­æ¨¡å—å¯¼å‡ºçš„å‡½æ•°ã€å®šä¹‰ã€è¡¨è¾¾å¼ã€‚\n#lang racket (module zoo racket (provide tiger) (define tiger \u0026#34;Tony\u0026#34;)) (require \u0026#39;zoo) tiger module* module*å½¢å¼ç±»ä¼¼moduleï¼š\n(module* name-id initial-module-path-or-#f decl ...) module*ä¸moduleçš„ä¸åŒä¹‹å¤„åœ¨äºï¼š\nç”±moduleå£°æ˜çš„å­æ¨¡å—ï¼Œå¯ä»¥è¢«å…¶çˆ¶æ¨¡å—require, ä½†æ˜¯å­æ¨¡å—ä¸èƒ½requireçˆ¶æ¨¡å—ï¼› ç”±module*å£°æ˜çš„å­—æ¨¡å—ï¼Œå¯ä»¥requireçˆ¶æ¨¡å—ï¼Œä½†æ˜¯çˆ¶æ¨¡å—ä¸èƒ½requireè¯¥å­æ¨¡å—ï¼› æ­¤å¤–ï¼Œmodule*å½¢å¼å¯ä»¥ç”¨#fä»£æ›¿initial-module-pathï¼Œè¿™æ„å‘³ç€ï¼Œå­æ¨¡å—å¯ä»¥è®¿é—®çˆ¶æ¨¡å—æ‰€ä»¥ç»‘å®šï¼ŒåŒ…æ‹¬æœªé€šè¿‡provideå¯¼å‡ºçš„ç»‘å®šã€‚\nå› æ­¤ï¼Œç”¨module*å’Œ#fæ¥å£°æ˜ä¸€ä¸ªæ¨¡å—çš„ä¸€ä¸ªç”¨é€”æ˜¯ï¼Œå°†æŸä¸ªæ¨¡å—æœªprovideå‡ºå»çš„ç»‘å®šå¯¼å‡ºã€‚\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* extras #f (provide show)) å°½ç®¡showå‡½æ•°æœªå¯¼å‡ºï¼Œä½†æ˜¯å­æ¨¡å—extraså´å°†å…¶å¯¼å‡ºäº†ï¼Œå¤–éƒ¨ç¨‹åºå¯ä»¥ä½¿ç”¨(require (submod \u0026ldquo;caske.rkt\u0026rdquo; extras))æ¥è®¿é—®éšè—çš„showå‡½æ•°ã€‚\nMainå’ŒTestå­æ¨¡å— #lang racket (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* main #f (print-cake 10)) è¿™ä¸ªâ€œcake.rktâ€å˜ä½“ï¼ŒåŒ…å«äº†ä¸€ä¸ªmainå­æ¨¡å—ï¼Œå¹¶è°ƒç”¨äº†print-cakeå‡½æ•°ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œè¿è¡Œä¸€ä¸ªæ¨¡å—æ—¶å¹¶ä¸ä¼šè¿è¡Œå…¶ä¸­ç”±module*å£°æ˜çš„å­æ¨¡å—ï¼Œä½†æ˜¯mainå­æ¨¡å—é™¤å¤–ã€‚\nmainå­æ¨¡å—å¹¶ä¸ä¸€å®šç”±module*å£°æ˜ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨çˆ¶æ¨¡å—çš„ç»‘å®šï¼Œä¹Ÿå¯ä»¥ç”±moduleæ¥å£°æ˜ã€‚ æ›´å¸¸è§çš„åšæ³•æ˜¯ç”±module+æ¥å£°æ˜\n``lisp (module+ name-id decl \u0026hellip;)\nmodule+å£°æ˜çš„æ¨¡å—å°±åƒé‡‡ç”¨module*å£°æ˜ä¸”ä½¿ç”¨#fä½œä¸ºinitial-module-pathçš„æ¨¡å—ã€‚æ­¤å¤–ï¼Œå¤šä¸ªmodule+æ¨¡å—å¯ä»¥åŒåï¼ŒåŒåçš„æ¨¡å—ä¼šç»„åˆæˆä¸€ä¸ªæ¨¡å—ã€‚è¿™ç§ç»„åˆç‰¹æ€§å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªtestæ¨¡å—ï¼Œåœ¨ä½¿ç”¨ raco testå‘½ä»¤æ—¶å°±å¯ä»¥å¤§æ˜¾èº«æ‰‹äº†ã€‚ å‡è®¾\u0026#34;physics.rkt\u0026#34; ä¸ºï¼š ```lisp #lang racket (module+ test (require rackunit) (define Îµ 1e-10)) (provide drop to-energy) (define (drop t) (* 1/2 9.8 t t)) (module+ test (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ)) (define (to-energy m) (* m (expt 299792458.0 2))) (module+ test (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) å¯¼å…¥\u0026quot;physics.rkt\u0026quot; æ—¶ï¼Œå¹¶ä¸ä¼šè¿è¡Œdropå’Œto-energyçš„æµ‹è¯•ï¼Œä¸è¿‡è¿è¡Œraco test physics.rktå°†ä¼šæ‰§è¡Œè¿™äº›æµ‹è¯•ã€‚\nè¿™ç­‰ä»·äºä½¿ç”¨module*:\n#lang racket (provide drop to-energy) (define (drop t) (* 1/2 49/5 t t)) (define (to-energy m) (* m (expt 299792458 2))) (module* test #f (require rackunit) (define Îµ 1e-10) (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ) (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) module+çš„ç»„åˆè¡Œä¸ºå¯¹mainæ¨¡å—ä¹Ÿæœ‰å¸®åŠ©ï¼Œå³ä½¿ä¸éœ€è¦ç»„åˆï¼Œ ( module+ main \u0026hellip;. )ä¹Ÿæ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒæ¯”( module* main #f \u0026hellip;. )æ›´å…·å¯è¯»æ€§ ã€‚\nRequire requireçš„å®šä¹‰ä¸ºï¼š\n(require require-spec \u0026hellip;)\nonly-in ç”¨æ¥é™åˆ¶æ¨¡å—å¯¼å‡ºçš„ç»‘å®šï¼Œä¹Ÿå¯é‡å‘½åç»‘å®š\n\u0026gt; (module m (lib \u0026#34;racket\u0026#34;) (provide tastes-great? less-filling?) (define tastes-great? #t) (define less-filling? #t)) \u0026gt; (require (only-in \u0026#39;m tastes-great?)) \u0026gt; tastes-great? #t \u0026gt; less-filling? less-filling?: undefined; cannot reference an identifier before its definition in module: top-level \u0026gt; (require (only-in \u0026#39;m [less-filling? lite?])) \u0026gt; lite? #t except-in æ˜¯only-inçš„è¡¥å……ï¼Œç”¨æ¥æ’é™¤æŸäº›ç»‘å®š\n(except-in require-spec id \u0026hellip;)\nrename-in ä¸only-inç±»ä¼¼ã€‚\n(rename-in require-spec [orig-id bind-id] \u0026hellip;)\nprefix-in (prefix-in prefix-id require-spec) ç»™æ¯ä¸€ä¸ªrequire-specçš„ç»‘å®šæ·»åŠ å‰ç¼€\nProvide (provide provide-spec \u0026hellip;)\nprovide-specå…è®¸é€’å½’å®šä¹‰ï¼š\nid: æœ€ç®€å•çš„å½¢å¼ï¼Œä¸Šæ–‡ä¸­å¤šæ¬¡å‡ºç°\n(rename-out [orig-id export-id] \u0026hellip;): é‡å‘½åå¯¼å‡ºçš„ç»‘å®š\n(struct-out struct-id): å¯¼å‡ºstruct\n(all-defined-out): å¯¼å‡ºæ‰€æœ‰ç»‘å®šï¼Œä¸æ¨è\n(all-from-out module-path): å¯¼å‡ºæ‰€æœ‰ç”±module-pathæŒ‡å®šçš„ç»‘å®š\n(except-out provide-spec id \u0026hellip;): æ’é™¤idæŒ‡å®šçš„ç»‘å®š\n(prefix-out prefix-id provide-spec)ï¼šç»™æ¯ä¸ªå¯¼å‡ºç»‘å®šæ·»åŠ ä¸€ä¸ªå‰ç¼€\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":44,"section":"posts","summary":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set! é€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥","tags":["racket","module"],"title":"Racket Modules","uri":"https://lvsq.net/2021/07/racket-modules/","year":"2021"},{"content":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜:\nç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ içš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º(i, $a_i$) å’Œ (i, 0) ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\nè¯´æ˜ï¼šä¸èƒ½å€¾æ–œå®¹å™¨\næ›´è¯¦ç»†çš„æè¿°è¯·è®¿é—®ï¼šhttps://leetcode-cn.com/problems/container-with-most-water/\né¦–å…ˆå¯ä»¥æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯æš´åŠ›æ±‚è§£ï¼Œå°†æ‰€æœ‰çš„é¢ç§¯éƒ½è®¡ç®—å‡ºæ¥ï¼Œå–æœ€å¤§å€¼å³å¯ã€‚ä¸‹é¢ç»™å‡º(Racket)[https://racket-lang.org/]çš„ä»£ç ï¼Œå¾—ç›Šäºå‡½æ•°å¼è¯­è¨€å’ŒSè¡¨è¾¾å¼å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œä»£ç å¯ä»¥å¾ˆçŸ­ï¼š\n(define/contract (max-area height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define len (length height)) (cond ((\u0026lt; len 2) 0) ((= len 2) (area (list 1 (car height)) (list 2 (cadr height)))) (else (max (each-area height) (max-area (cdr height)))))) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (define (each-area height) (let ([first (list 1 (car height))]) (foldl max 0 (map (lambda (i h) (area first (list i h))) (range 2 (add1 (length height)) ) (cdr height))))) ä¸Šè¿°è§£æ³•è™½ç„¶æ­£ç¡®ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½, å¦‚æœæœ‰10000ä¸ªæ•´æ•°ï¼Œå³n=10000ï¼Œå…¶æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†2ç§’ï¼š\n(time (max-area (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 2387 real time: 2466 gc time: 137 é‚£ä¹ˆæœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•å—ï¼Ÿ\næ˜¾ç„¶å¯ä»¥è®¤ä¸ºæ‰€æœ‰æ•´æ•°éƒ½ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨æˆ–è€…æ•°ç»„ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå«headï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªæ•´æ•°, è¡¨ç¤ºä¸ºï¼šhead -\u0026gt; (i, $h_i$)ï¼Œiä¸ºåˆ—è¡¨ä¸‹æ ‡ï¼Œ $h_i$ä»£è¡¨ç¬¬iä¸ªæ•´æ•°å€¼ï¼›å¦ä¸€ä¸ªå«tailï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸ºtail -\u0026gt; (j, $h_j$)ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…åˆ©ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨ï¼Œå°±èƒ½è®¡ç®—å‡ºæœ€å¤§çš„é¢ç§¯ï¼Œå…¶è¿‡ç¨‹ä¸ºï¼š\nè®¡ç®—ç”±headå’Œtailå›´æˆçš„çŸ©å½¢çš„é¢ç§¯$S_{ij}$, çŸ©å½¢çš„é•¿åº¦x = j - i, é«˜åº¦y = min ($h_i$, $h_j$); å°†çŸ©å½¢æ”¶çª„ä¸€æ ¼ï¼Œå³xå‡å°‘1ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æ”¶çª„æ–¹å¼ï¼š å°†é«˜åº¦çŸ­çš„ä¸€ä¾§æ”¶çª„ï¼Œé‚£ä¹ˆï¼Œæ”¶çª„åé«˜åº¦å¯èƒ½å˜å¤§ï¼Œåˆ™é¢ç§¯å¯èƒ½å¢å¤§; å°†é«˜åº¦é•¿çš„ä¸€ä¾§æ”¶çª„ï¼Œç”±äºå¦ä¸€ä¾§ä¸å˜,ä½†æ˜¯é•¿åº¦å˜å°äº†ä¸€æ ¼ï¼Œåˆ™é¢ç§¯ä¼šå˜å°; å› æ­¤ï¼Œéœ€è¦ç§»åŠ¨é«˜åº¦çŸ­çš„ä¸€ä¾§ï¼Œæ‰æœ‰å¯èƒ½æ‰¾åˆ°é¢ç§¯æ›´å¤§çš„çŸ©å½¢ å¾ˆæ˜¾ç„¶ï¼Œä½¿ç”¨åŒæŒ‡é’ˆç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†$O(n)$ã€‚\nRacket ç‰ˆæœ¬ ;;better solution (define/contract (max-area-pair-pointer height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (let ([len (length height)]) (if (\u0026lt; len 2) 0 (let loop ([h height] [hindex (range 0 len)] [rheight (reverse height)] [rindex (reverse (range 0 len))] [maxa 0]) (let* ([head (list (car hindex) (car h))] [tail (list (car rindex) (car rheight))] [a (area head tail)]) (if (= (car head) (car tail)) maxa (if (\u0026gt; (cadr head) (cadr tail)) (loop h hindex (cdr rheight) (cdr rindex) (max maxa a)) (loop (cdr h) (cdr hindex) rheight rindex (max maxa a))) )))))) å¦‚æœä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¡ç®—10000ä¸ªæ•´æ•°çš„é¢ç§¯ï¼Œæ‰§è¡Œæ—¶é—´åªéœ€1æ¯«ç§’ï¼Œè€Œä¸”ä¸éœ€è¦GCï¼ˆå¯¹ç…§æš´åŠ›ç ´è§£ç‰ˆæœ¬ï¼Œ2+ç§’ï¼‰\n(time (max-area-pair-pointer (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 1 real time: 1 gc time: 0 Rustç‰ˆæœ¬ åŒæ—¶æä¾›ä¸€ä¸ªRustç‰ˆæœ¬çš„å®ç°ï¼Œ\nuse std::cmp::{max, min}; type HeightType = i64; #[derive(Debug)] struct Solution {} impl Solution { pub fn max_area(height: Vec\u0026lt;HeightType\u0026gt;) -\u0026gt; HeightType { let len = height.len(); return if len \u0026lt; 2 { 0 } else { let mut max_area = 0; let mut hi = 0; let mut ti = len - 1; while ti \u0026gt; hi { let hd = height.get(hi).unwrap(); let td = height.get(ti).unwrap(); let a = ((ti - hi) as HeightType) * min(hd, td); max_area = max(max_area, a); if hd \u0026lt; td { hi += 1; } else { ti -= 1; } } max_area }; } } ä¸¤ä¸ªç‰ˆæœ¬åšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒï¼š\nsize Racket(8.0 CS) Rust(1.50.0) 100000 49ms 60ms 1000000 560ms 550ms 10000000 5s 5.6s ä¸¤ä¸ªç‰ˆæœ¬çš„å®ç°å‡æœªä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–,ä»¤äººæ„å¤–çš„æ˜¯Racketçš„æ‰§è¡Œæ•ˆç‡ä¸Rustå‡ ä¹æ²¡æœ‰å·®åˆ«ï¼Œä½¿ç”¨äº†CSç¼–è¯‘å™¨çš„RacketçœŸæ˜¯çªé£çŒ›è¿›ã€‚ ç”±äºæˆ‘çš„Rustç»éªŒå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæˆ–è®¸æœ‰æ›´å¥½çš„å†™æ³•ã€‚ä»æµ‹è¯•å¯ä»¥çœ‹åˆ°Racketè‡³å°‘åœ¨CPUå¯†é›†å‹åº”ç”¨ä¸­å¯å ªå¤§ç”¨ã€‚\n","id":45,"section":"posts","summary":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜: ç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨","tags":[],"title":"ã€ç››æœ€å¤šæ°´çš„å®¹å™¨ã€‘é—®é¢˜çš„æ±‚è§£","uri":"https://lvsq.net/2021/05/container-with-most-water/","year":"2021"},{"content":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚\nå®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15æ—¥\nåœ¨æŸäº›æ–¹é¢ï¼Œå­¦ä¹ è®¡ç®—æœºç¼–ç¨‹ä¸å­¦ä¹ æ–°è¯­è¨€ç›¸ä¼¼ã€‚å®ƒéœ€è¦å­¦ä¹ æ–°çš„ç¬¦å·å’Œæœ¯è¯­ï¼Œå¿…é¡»æ­£ç¡®ç»„ç»‡è¿™äº›ç¬¦å·å’Œæœ¯è¯­ä»¥æŒ‡å¯¼è®¡ç®—æœºè¯¥æ€ä¹ˆåšã€‚è®¡ç®—æœºä»£ç è¿˜å¿…é¡»è¶³å¤Ÿæ¸…æ™°ï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºå‘˜å¯ä»¥é˜…è¯»å’Œç†è§£ã€‚\nå°½ç®¡å­˜åœ¨è¿™äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œéº»çœç†å·¥å­¦é™¢çš„ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç å¹¶ä¸èƒ½æ¿€æ´»ä¸è¯­è¨€å¤„ç†æœ‰å…³çš„å¤§è„‘åŒºåŸŸã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒæ¿€æ´»äº†ä¸€ä¸ªç§°ä¸ºå¤šéœ€æ±‚ç½‘ç»œçš„åˆ†å¸ƒå¼ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¹Ÿè¢«æ‹›å‹Ÿç”¨äºè§£å†³å¤æ‚çš„è®¤çŸ¥ä»»åŠ¡ï¼Œä¾‹å¦‚è§£å†³æ•°å­¦é—®é¢˜æˆ–å¡«å­—æ¸¸æˆã€‚\nä½†æ˜¯ï¼Œå°½ç®¡é˜…è¯»è®¡ç®—æœºä»£ç ä¼šæ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œï¼Œä½†ä¸æ•°å­¦æˆ–é€»è¾‘é—®é¢˜ç›¸æ¯”ï¼Œå®ƒä¼¼ä¹æ›´å¤šåœ°ä¾èµ–äºç½‘ç»œçš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™è¡¨æ˜ç¼–ç ä¹Ÿä¸èƒ½ç²¾ç¡®åœ°å¤åˆ¶æ•°å­¦çš„è®¤çŸ¥éœ€æ±‚ã€‚\nâ€œç†è§£è®¡ç®—æœºä»£ç ä¼¼ä¹æ˜¯è‡ªå·±çš„äº‹ã€‚å®ƒä¸è¯­è¨€ä¸åŒï¼Œæ•°å­¦ä¸é€»è¾‘ä¹Ÿä¸ç›¸åŒã€‚â€éº»çœç†å·¥å­¦é™¢ç ”ç©¶ç”Ÿï¼Œè¯¥ç ”ç©¶çš„ä¸»è¦ä½œè€…å®‰å¨œÂ·ä¼Šå‡¡è¯ºå¨ƒï¼ˆAnna Ivanovaï¼‰è¯´ã€‚\nEvelina Fedorenkoï¼ŒFrederick A.å’ŒCarole J. MiddletonèŒä¸šå‘å±•ç¥ç»ç§‘å­¦å‰¯æ•™æˆï¼Œéº¦æˆˆæ–‡è„‘ç§‘å­¦ç ”ç©¶æ‰€çš„æˆå‘˜ï¼Œæ˜¯è¯¥è®ºæ–‡çš„é«˜çº§ä½œè€…ï¼Œè¯¥è®ºæ–‡ä»Šå¤©å‘è¡¨åœ¨eLifeä¸Šã€‚éº»çœç†å·¥å­¦é™¢è®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½å®éªŒå®¤å’Œå¡”å¤«èŒ¨å¤§å­¦çš„ç ”ç©¶äººå‘˜ä¹Ÿå‚ä¸äº†è¿™é¡¹ç ”ç©¶ã€‚\nè¯­è¨€ä¸è®¤çŸ¥ Fedorenkoç ”ç©¶çš„ä¸»è¦é‡ç‚¹æ˜¯è¯­è¨€ä¸å…¶ä»–è®¤çŸ¥åŠŸèƒ½ä¹‹é—´çš„å…³ç³»ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¥¹ä¸€ç›´åœ¨ç ”ç©¶å…¶ä»–åŠŸèƒ½æ˜¯å¦ä¾èµ–äºå¤§è„‘çš„è¯­è¨€ç½‘ç»œï¼ˆåŒ…æ‹¬BrocaåŒºåŸŸå’Œå¤§è„‘å·¦åŠçƒçš„å…¶ä»–åŒºåŸŸï¼‰çš„é—®é¢˜ã€‚åœ¨å…ˆå‰çš„å·¥ä½œä¸­ï¼Œå¥¹çš„å®éªŒå®¤è¡¨æ˜ï¼ŒéŸ³ä¹å’Œæ•°å­¦ä¼¼ä¹å¹¶æœªæ¿€æ´»è¯¥è¯­è¨€ç½‘ç»œã€‚\nâ€œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰å…´è¶£æ¢ç´¢è¯­è¨€å’Œè®¡ç®—æœºç¼–ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œéƒ¨åˆ†åŸå› æ˜¯è®¡ç®—æœºç¼–ç¨‹æ˜¯ä¸€ä¸ªæ–°å‘æ˜ï¼Œæˆ‘ä»¬çŸ¥é“ä¸å¯èƒ½æœ‰ä»»ä½•ç¡¬è¿çº¿æœºåˆ¶ä½¿æˆ‘ä»¬æˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œâ€ä¼Šä¸‡è¯ºå¨ƒè¯´ã€‚\nå¥¹è¯´ï¼Œå…³äºå¤§è„‘å¦‚ä½•å­¦ä¹ ç¼–ç ï¼Œå­˜åœ¨ä¸¤ç§æ€æƒ³æµæ´¾ã€‚æœ‰äººè®¤ä¸ºï¼Œè¦ç²¾é€šç¼–ç¨‹ï¼Œå°±å¿…é¡»ç²¾é€šæ•°å­¦ã€‚å¦ä¸€ä¸ªå»ºè®®è®¤ä¸ºï¼Œç”±äºç¼–ç å’Œè¯­è¨€ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè¯­è¨€æŠ€èƒ½å¯èƒ½æ›´ç›¸å…³ã€‚ä¸ºäº†é˜æ˜è¿™ä¸€é—®é¢˜ï¼Œç ”ç©¶äººå‘˜ç€æ‰‹ç ”ç©¶åœ¨é˜…è¯»è®¡ç®—æœºä»£ç æ—¶å¤§è„‘æ´»åŠ¨æ¨¡å¼æ˜¯å¦ä¼šä¸è¯­è¨€ç›¸å…³çš„å¤§è„‘æ´»åŠ¨é‡å ã€‚\nç ”ç©¶äººå‘˜åœ¨æœ¬ç ”ç©¶ä¸­é‡ç‚¹å…³æ³¨ä»¥å¯è¯»æ€§ç€ç§°çš„ä¸¤ç§ç¼–ç¨‹è¯­è¨€â€”â€”Pythonå’ŒScratchJrã€‚ScratchJrè¿™æ˜¯ä¸€ç§ä¸“ä¸º5å²åŠ5å²ä»¥ä¸Šå„¿ç«¥è®¾è®¡çš„å¯è§†åŒ–ç¼–ç¨‹è¯­è¨€ã€‚ç ”ç©¶å¯¹è±¡å‡ä¸ºç²¾é€šæµ‹è¯•è¯­è¨€çš„å¹´è½»äººã€‚å½“ç¨‹åºå‘˜èººåœ¨åŠŸèƒ½ç£å…±æŒ¯ï¼ˆfMRIï¼‰æ‰«æä»ªä¸­æ—¶ï¼Œç ”ç©¶äººå‘˜å‘ä»–ä»¬å±•ç¤ºäº†ä»£ç ç‰‡æ®µï¼Œå¹¶è¦æ±‚ä»–ä»¬é¢„æµ‹ä»£ç å°†äº§ç”Ÿä»€ä¹ˆåŠ¨ä½œã€‚\nç ”ç©¶äººå‘˜å‡ ä¹çœ‹ä¸åˆ°å¤§è„‘è¯­è¨€åŒºåŸŸå¯¹ä»£ç çš„ååº”ã€‚ç›¸åï¼Œä»–ä»¬å‘ç°ç¼–ç ä»»åŠ¡ä¸»è¦æ¿€æ´»äº†æ‰€è°“çš„å¤šéœ€æ±‚ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œçš„æ´»åŠ¨éå¸ƒæ•´ä¸ªå¤§è„‘çš„é¢å¶å’Œé¡¶å¶ï¼Œé€šå¸¸æ˜¯ä¸ºéœ€è¦åŒæ—¶è®°ä½è®¸å¤šä¿¡æ¯çš„ä»»åŠ¡è€Œæ‹›å‹Ÿçš„ï¼Œå®ƒè´Ÿè´£æˆ‘ä»¬æ‰§è¡Œå„ç§å¿ƒç†ä»»åŠ¡çš„èƒ½åŠ›ã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œå®ƒæ‰€åšçš„å‡ ä¹æ‰€æœ‰åœ¨è®¤çŸ¥ä¸Šéƒ½å…·æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ï¼Œä½¿æ‚¨éš¾ä»¥æ€è€ƒã€‚â€\nå…ˆå‰çš„ç ”ç©¶è¡¨æ˜ï¼Œæ•°å­¦å’Œé€»è¾‘é—®é¢˜ä¼¼ä¹ä¸»è¦å–å†³äºå·¦åŠçƒçš„å¤šä¸ªéœ€æ±‚åŒºåŸŸï¼Œè€Œæ¶‰åŠç©ºé—´å¯¼èˆªçš„ä»»åŠ¡æ¯”å³åŠçƒæ›´å¤šåœ°æ¿€æ´»å³åŠçƒã€‚éº»çœç†å·¥å­¦é™¢çš„ç ”ç©¶å°ç»„å‘ç°ï¼Œè¯»å–è®¡ç®—æœºä»£ç ä¼¼ä¹å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œçš„å·¦ä¾§å’Œå³ä¾§ï¼Œè€ŒScratchJræ¿€æ´»å³ä¾§çš„ç¨‹åº¦è¦æ¯”å·¦ä¾§é«˜ä¸€äº›ã€‚è¿™ä¸€å‘ç°è¿èƒŒäº†æ•°å­¦å’Œç¼–ç ä¾èµ–ç›¸åŒå¤§è„‘æœºåˆ¶çš„å‡è®¾ã€‚\nç»éªŒçš„å½±å“ ç ”ç©¶äººå‘˜è¯´ï¼Œå°½ç®¡ä»–ä»¬æ²¡æœ‰å‘ç°ä»»ä½•ä¼¼ä¹ä¸“é—¨ç”¨äºç¼–ç¨‹çš„åŒºåŸŸï¼Œä½†æ˜¯è¿™ç§å…·æœ‰ç‰¹æ®Šè„‘æ´»åŠ¨çš„åŒºåŸŸå¯èƒ½ä¼šåœ¨å…·æœ‰æ›´å¤šç¼–ç ç»éªŒçš„äººä¸­å‘å±•ã€‚\nFedorenkoè¯´ï¼šâ€œå¦‚æœæ‚¨è˜ç”¨äº†ä»¥30å¹´æˆ–40å¹´çš„ç‰¹å®šè¯­è¨€ç¼–å†™ä»£ç çš„ä¸“ä¸šç¨‹åºå‘˜çš„äººï¼Œæ‚¨å¯èƒ½ä¼šå¼€å§‹çœ‹åˆ°æŸäº›ä¸“ä¸šåŒ–çŸ¥è¯†ï¼Œæˆ–è€…æ˜¯å¤šä¸ªéœ€æ±‚ç³»ç»ŸæŸäº›éƒ¨åˆ†çš„ç»“æ™¶â€ï¼ŒFedorenkoè¯´ã€‚â€œå¯¹äºé‚£äº›ç†Ÿæ‚‰ç¼–ç å¹¶ä¸”å¯ä»¥æœ‰æ•ˆåœ°å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œä½†ç»éªŒç›¸å¯¹æœ‰é™çš„äººæ¥è¯´ï¼Œä¼¼ä¹æ‚¨è¿˜çœ‹ä¸åˆ°ä»»ä½•ä¸“ä¸šåŒ–çŸ¥è¯†ã€‚â€\nçº¦ç¿°Â·éœæ™®é‡‘æ–¯å¤§å­¦çš„ä¸€ç»„ç ”ç©¶äººå‘˜åœ¨åŒä¸€æœŸeLifeä¸Šå‘è¡¨çš„ä¸€ç¯‡ä¼´éšè®ºæ–‡ä¸­ä¹ŸæŠ¥å‘Šè¯´ï¼Œè§£å†³ä»£ç é—®é¢˜å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œè€Œä¸æ˜¯è¯­è¨€åŒºåŸŸã€‚\nç ”ç©¶ç»“æœè¡¨æ˜ï¼Œå¯¹äºç¼–ç åº”è¯¥ä»¥åŸºäºæ•°å­¦çš„æŠ€èƒ½è¿˜æ˜¯åŸºäºè¯­è¨€çš„æŠ€èƒ½è¿›è¡Œæ•™æˆï¼Œå°šæ— å®šè®ºã€‚ç ”ç©¶äººå‘˜è¯´ï¼Œéƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå­¦ä¹ ç¼–ç¨‹å¯èƒ½ä¼šåŒæ—¶ä¾èµ–è¯­è¨€å’Œå¤šç§éœ€æ±‚ç³»ç»Ÿï¼Œå³ä½¿â€”ä¸€æ—¦å­¦ä¼šäº†ç¼–ç¨‹ï¼Œå°±ä¸ä¼šä¾èµ–è¯­è¨€åŒºåŸŸã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œä¸¤ä¸ªé˜µè¥éƒ½å®£ç§°ï¼Œå®ƒå¿…é¡»ä¸æ•°å­¦ç»“åˆåœ¨ä¸€èµ·ï¼Œå¿…é¡»ä¸è¯­è¨€ç»“åˆåœ¨ä¸€èµ·ã€‚â€ â€œä½†æ˜¯çœ‹æ¥ï¼Œè®¡ç®—æœºç§‘å­¦æ•™è‚²è€…å°†ä¸å¾—ä¸å¼€å‘è‡ªå·±çš„æ–¹æ³•æ¥æœ€æœ‰æ•ˆåœ°æ•™æˆä»£ç ã€‚â€\nå…¨æ–‡å®Œã€‚\nå¦‚æœæ‚¨æƒ³çœ‹åŸæ–‡ï¼Œå¯ä»¥è®¿é—®ï¼šé“¾æ¥\n","id":46,"section":"posts","summary":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚ å®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15","tags":[],"title":"å¯¹å¤§è„‘è€Œè¨€ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç ä¸é˜…è¯»è¯­è¨€ä¸åŒ","uri":"https://lvsq.net/2020/12/brain-reading-computer-code/","year":"2020"},{"content":"ä½œè€…\nMATTHEW FLATT, University of Utah,\nUSACANER DERICI, Indiana University, USA\nR. KENT DYBVIG, Cisco Systems, Inc., USA\nANDREW W. KEEP, Cisco Systems, Inc., USA\nGUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina\nSARAH SPALL, Indiana University, USA\nSAM TOBIN-HOCHSTADT, Indiana University, USA\nJON ZEPPIERI, independent researcher, USA\næ¦‚è¦\næˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Racketï¼Œå¹¶ä¸”è¿è¡Œè‰¯å¥½â€”â€”åªè¦å¯¹Chez Schemeè¿›è¡Œä¸€äº›ä¿®è¡¥ï¼Œå°±å¯ä»¥è¿è¡ŒDrRacketã€‚ Racketå‘è¡Œç‰ˆå¯ä»¥è‡ªè¡Œæ„å»ºï¼Œå¹¶ä¸”å‡ ä¹æ‰€æœ‰æ ¸å¿ƒâ€‹â€‹çš„Racketæµ‹è¯•å¥—ä»¶éƒ½å¯ä»¥é€šè¿‡ã€‚å°½ç®¡ä»æœ‰ä¸€äº›å·¥ä½œå¯ä»¥æé«˜ç«¯åˆ°ç«¯çš„æ€§èƒ½ï¼Œä½†æœ€ç»ˆçš„å®ç°è¿˜æ˜¯ä¸é”™çš„ã€‚ æˆ‘ä»¬è¯„ä¼°çš„æœ€ä¸å¯é¢„æµ‹çš„éƒ¨åˆ†æ˜¯ï¼ŒRacketå’ŒChez Schemeä¹‹é—´çš„ä¸åŒå°†å˜å¾—å¤šå¤§ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›ä¸åŒã€‚æˆ‘ä»¬å¸Œæœ›Racket CSæˆä¸ºä¸»è¦çš„Racketå®ç°ï¼Œå¹¶ä¸”æˆ‘ä»¬é¼“åŠ±å…¶ä»–è¯­è¨€å®ç°è€…å°†Chez Schemeè§†ä¸ºç›®æ ‡è™šæ‹Ÿæœºã€‚\nè¯¥æ–‡è¯¦ç»†åœ°ä»‹ç»äº†Racket CSæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œä»¥åŠä¸Chez Schemeä¹‹é—´çš„å·®å¼‚ï¼Œ å®Œæ•´å†…å®¹è§(https://dl.acm.org/doi/epdf/10.1145/3341642)\n","id":47,"section":"posts","summary":"ä½œè€… MATTHEW FLATT, University of Utah, USACANER DERICI, Indiana University, USA R. KENT DYBVIG, Cisco Systems, Inc., USA ANDREW W. KEEP, Cisco Systems, Inc., USA GUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina SARAH SPALL, Indiana University, USA SAM TOBIN-HOCHSTADT, Indiana University, USA JON ZEPPIERI, independent researcher, USA æ¦‚è¦ æˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Ra","tags":["pl"],"title":"åŸºäºChez Schemeé‡å»ºRacket","uri":"https://lvsq.net/2020/10/rebuilding-racket/","year":"2020"},{"content":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„è®¡ç®—æœºè¯­è¨€Java, Python, Cç­‰ç­‰å‡ ä¹ä¸€è‡´é‡‡ç”¨Lexical Scoping,ç¨‹åºå‘˜æ²¡æœ‰æœºä¼šå¯Ÿè§‰åˆ°å¼‚æ ·ï¼Œä»è€Œæ©ç›–äº†è¿˜æœ‰å…¶ä»–ä½œç”¨åŸŸçš„äº‹å®ï¼Œè®¸å¤šæ•™ç§‘ä¹¦ä¹Ÿå¾ˆé…åˆåœ°ä¸€ç¬”å¸¦è¿‡ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯æ‚¨å·²ç»æ´å¯Ÿäº†ä¸åŒä½œç”¨åŸŸçš„å·®å¼‚å’Œå†…æ¶µï¼Œè‡ªè§‰åœ°è§„é¿äº†é—®é¢˜ã€‚æˆ‘è¡·å¿ƒçš„å¸Œæœ›æ‰€æœ‰ç¨‹åºå‘˜éƒ½æ˜¯ç¬¬äºŒç§å¯èƒ½ã€‚\næœ¬æ–‡å°†æµ…æ˜¾åœ°æè¿°ä¸¤ç§ä½œç”¨åŸŸçš„ç‰¹ç‚¹åŠå·®å¼‚ï¼Œå¸Œæœ›å¯ä»¥è§£é‡Šåœ°æ¸…æ¥šä¸€ç‚¹ï¼Œå¦‚æœè¯»å®Œä¹‹åæ‚¨æ›´åŠ æ¨¡ç³Šäº†ï¼Œè¯·è®°ä½ï¼Œè¿™å¹¶éæˆ‘çš„æœ¬æ„ã€‚\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œåç§°ç»‘å®šçš„ä½œç”¨åŸŸï¼ˆåç§°ä¸å®ä½“çš„å…³è”ï¼Œæ¯”å¦‚å˜é‡ï¼‰æ˜¯ç¨‹åºä¸­åç§°ç»‘å®šæœ‰æ•ˆçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åç§°å¯ä»¥è¢«å¼•ç”¨åˆ°ä¸€ä¸ªå®ä½“ã€‚ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œåç§°å¯èƒ½æŒ‡å‘ä¸åŒçš„å®ä½“ï¼ˆå®ƒå¯èƒ½å…·æœ‰ä¸åŒçš„ç»‘å®šï¼‰ï¼Œæˆ–è€…æ ¹æœ¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ˆå®ƒå¯èƒ½æ˜¯æœªç»‘å®šçš„ï¼‰ã€‚ä½œç”¨åŸŸä¹Ÿç§°ä¸ºå®ä½“çš„å¯è§æ€§ï¼Œ å°¤å…¶åœ¨è¾ƒæ—©çš„æŠ€æœ¯æ–‡çŒ®ä¸­å¯è§ï¼Œè¿™æ˜¯ä»æ‰€å¼•ç”¨çš„å®ä½“çš„è§’åº¦å‡ºå‘ï¼Œè€Œéå¼•ç”¨çš„åç§°ã€‚\næœ¯è¯­\u0026quot;scope\u0026ldquo;ä¹Ÿç”¨äºæŒ‡ä»£ç¨‹åºä¸­æœ‰æ•ˆçš„åç§°ç»‘å®šçš„é‚£éƒ¨åˆ†é›†åˆï¼Œæ›´åŠ æ­£ç¡®çš„ç§°å‘¼åº”è¯¥æ˜¯ä¸Šä¸‹æ–‡ æˆ–è€… ç¯å¢ƒ\nLexical Scoping è¯æ³•ä½œç”¨åŸŸï¼ŒæŸäº›ä¹¦ä¸­ä¹Ÿå«é™æ€ä½œç”¨åŸŸï¼Œå…¶åœ¨ç¼–å†™ä»£ç æ—¶æˆ–è€…è¯´å®šä¹‰æ—¶å°±ç¡®å®šçš„ï¼Œé€šè¿‡æ–‡æœ¬ï¼ˆæºä»£ç ï¼‰å°±å¯ä»¥è§‚å¯Ÿåˆ°åç§°ä¸å®ä½“çš„å…³è”ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šåœ¨è·ç¦»è¢«è°ƒç”¨ä»£ç æœ€è¿‘çš„ç¯å¢ƒä¸­å»æŸ¥æ‰¾ç»‘å®šï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç¯å¢ƒï¼Œåœ¨ä¼˜å…ˆä»æœ€é‡Œé¢ä¸€å±‚çš„ç¯å¢ƒæŸ¥æ‰¾ã€‚\næ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n(setf x 1) ;; bind x to 1 (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) ;; result is 6 (format t \u0026#34;X = ~d \u0026#34; x) ;; X = 1 å…ˆç»‘å®šxä¸º1ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªå‡½æ•°fï¼Œfä¸­çš„å˜é‡xç»‘å®šä¸º2ï¼Œå®é™…ä¸Šfå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œç”±äºä¸¤ä¸ªxçš„ç¯å¢ƒä¸åŒï¼Œæ‰€ä»¥äº’ä¸å¹²æ‰°ï¼Œç»“æœæ­£æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œè¿™å°±å±äºè¯æ³•ä½œç”¨åŸŸã€‚\nDynamic Scoping åŠ¨æ€ä½œç”¨åŸŸæ›¾ç»è®©å¾ˆå¤šäººæ·±æ¶ç—›ç»ï¼Œä»¥è‡³äºä¸æ„¿æ„å†æèµ·å®ƒã€‚æ—©æœŸçš„Lispæ™®éä½¿ç”¨äº†åŠ¨æ€ä½œç”¨åŸŸï¼Œå¹¶å¸¦æ¥äº†éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯Lisp Machineè¢«Unixæ‰“è´¥çš„é™¤äº†å•†ä¸šå› ç´ ä¹‹å¤–çš„é‡è¦åŸå› ï¼ŒLispè‡³ä»Šæœªæˆä¸ºä¸»æµè¯­è¨€å°±ä¸éš¾ç†è§£äº†ï¼Œå°½ç®¡Lispçš„è¯­æ³•æœ€ç²¾ç‚¼ã€æœ€ä¼˜ç¾ï¼Œè¿˜å…·æœ‰æœ€å¼ºæ‚çš„å®ç³»ç»Ÿï¼Œè¿˜æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªä½¿ç”¨GCçš„è¯­è¨€\u0026hellip;\nåº†å¹¸çš„æ˜¯ï¼ŒScheme, Common Lispç­‰Lispæ–¹è¨€å·²ç»éƒ½æ˜¯ç”¨äº†Lexial Scopingï¼ˆå±€éƒ¨å˜é‡ã€‚æ‰€ä»¥æŸäº›æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠLexical Scopingå’ŒLocal Variableç­‰ä»·ï¼‰, æˆ‘ä»¬æ— éœ€å†ä¸ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜è€Œçƒ¦æ¼ï¼Œçæƒœç”Ÿå‘½ï¼Œä¸æ˜¯å—ï¼Ÿ ä¸è¿‡Scheme, Common Lispè¿˜æ˜¯ä¿ç•™äº†åŠ¨æ€ä½œç”¨åŸŸçš„æ“ä½œï¼ŒSchemeå¯ä»¥å‚è€ƒFluid Binding, Common Lispçš„åŠ¨æ€ä½œç”¨åŸŸå°†åœ¨åæ–‡ä¸¾ä¾‹è¯´æ˜ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬æ— éœ€ä¸ºè¿™ä¸ªä¿ç•™æ‹…å¿§ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæˆ‘ä»¬å¾ˆå°‘éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚\næ‰€è°“dynamic scopingå°±æ˜¯è¯´ï¼Œåœ¨å‡½æ•°å®šä¹‰ä¸­å­˜åœ¨äº†â€œè‡ªç”±å˜é‡â€ï¼ˆfree variableï¼‰, ä¼šåœ¨è¿è¡Œæ—¶éšç€å‡½æ•°çš„â€œè°ƒç”¨ä½ç½®â€ä¸åŒè€Œå‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼Œä½†æ˜¯ç¨ä½œå˜åŒ–ï¼š\n(defvar x 1) ;; bind x to 1, x is a free variable (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) (format t \u0026#34;X = ~d \u0026#34; x) (let ((x 100)) (format t \u0026#34;Inner X is ~d \u0026#34; x)) (defvar x 1)å®šä¹‰äº†xï¼Œå€¼ä¸º1ï¼Œä½†æ˜¯è¿™ä¸ªxå±äºè‡ªç”±å˜é‡ï¼Œå¤„äºåŠ¨æ€ä½œç”¨åŸŸï¼Œå› ä¸ºLispè‡ªåŠ¨å°†å…¨å±€å˜é‡å³ç”±defvarã€defparameterã€specialå®šä¹‰çš„å˜é‡è‡ªåŠ¨å£°æ˜ä¸ºåŠ¨æ€ä½œç”¨åŸŸã€‚ xå¯¹äº(lambda (y) (* x y))æ¥è¯´æ˜¯â€œ è‡ªç”± â€ çš„ï¼Œå®ƒå¯ä¸ä¼šåœ¨æ„xç»‘å®šä¸º2æˆ–è€…ä»»ä½•å…¶ä»–å€¼ï¼Œå› ä¸º(let ((x 2)) \u0026hellip;)ä¸­æŒ‡å®šçš„xå·²ç»ä¸æ˜¯(lambda \u0026hellip;)çš„å‚æ•°äº†ã€‚\næ‰€ä»¥å½“æˆ‘ä»¬æ‰§è¡Œ(funcall f 3) æ—¶ï¼Œå…¶ç»“æœä¸åƒè¯æ³•ä½œç”¨åŸŸé‚£æ ·ç­‰äº6ï¼Œè€Œæ˜¯3\n(format t \u0026ldquo;X = ~d \u0026quot; x) ä¾ç„¶è¾“å‡ºï¼š X = 1\n(let ((x 100)) (format t \u0026ldquo;Inner X is ~d \u0026quot; x)) è¾“å‡ºä¸ºï¼šInner X is 100ã€‚ ç­‰ç­‰ï¼Œè¿™é‡Œçš„xä¸ºä»€ä¹ˆåˆæ˜¯100äº†ï¼Ÿ è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„ç¯å¢ƒ å—ï¼Ÿï¼\nå¦‚æœå°†å‡½æ•°fæ”¾åˆ°ä¸åŒçš„ä½ç½®æ‰§è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ä¸Šé¢(funcall f 3)æ˜¯åœ¨é¡¶å±‚æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬æ¢åˆ°letä¸­æ‰§è¡Œä¼šæ€ä¹ˆæ ·ï¼Ÿ\n(let ((x 2)) (funcall f 3)) è¿™æ¬¡å±…ç„¶è¿”å›6ï¼Œè€Œä¸æ˜¯3äº†ã€‚\nçœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿå‡½æ•°fçš„è¡Œä¸ºï¼Œä¼šéšç€è°ƒç”¨ä½ç½®çš„ä¸€ä¸ªåå«xçš„å˜é‡çš„å€¼çš„ä¸åŒè€Œå˜åŒ–ã€‚è™½ç„¶éƒ½å«xï¼Œä½†å¹¶ä¸æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯åå­—ç›¸åŒè€Œå·²ã€‚é¡ºå¸¦æä¸€å¥ï¼Œç°åœ¨å¯ä»¥ç†è§£Javaä¸­namespaceçš„ç”¨å¤„äº†å§ã€‚\nè¯æ³•ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°è¯æ³•ä¸Šä¸‹æ–‡è§£å†³çš„ï¼Œè€ŒåŠ¨æ€ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå³ä½ç½®ï¼‰è§£å†³çš„ã€‚è¿™æ˜¯ç¼–è¯‘å™¨å¿…é¡»é¢å¯¹å¹¶è§£å†³çš„é—®é¢˜ï¼Œæˆ–è®¸ç¼–å†™ç¨‹åºæ—¶æ— éœ€è¿‡å¤šå…³æ³¨ï¼Œä½†æ˜¯å¤šäº†è§£ä¸€ä¸‹ä¸€å®šå¤§æœ‰è£¨ç›Šã€‚å°½ç®¡åŠ¨æ€ä½œç”¨åŸŸå­˜åœ¨å¾ˆå¤§é—®é¢˜ï¼Œä½†å®ƒå¹¶éæ´ªæ°´çŒ›å…½ï¼Œå®ƒå¯ä»¥ä½¿å…¨å±€å˜é‡æ›´æ˜“äºç®¡ç†ï¼›å‡è®¾æ‚¨å¸Œæœ›ä¸´æ—¶æ”¹å˜è‡ªç”±å˜é‡çš„å€¼æ—¶ï¼Œä¹Ÿå¯ä»¥å£°æ˜ä¸ºdynamic socpingï¼›å¦å¤–åœ¨å¼‚å¸¸å¤„ç†ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ¨æ€ä½œç”¨åŸŸå°†å¤„ç†ç¨‹åºä¸å¼‚å¸¸ç›¸å…³è”ã€‚\n","id":48,"section":"posts","summary":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„","tags":["lexical","scoping"],"title":"Lexical Scoping and Dynamic Scoping","uri":"https://lvsq.net/2020/09/lexical-dynamic-scoping/","year":"2020"},{"content":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š\nè®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼›\néå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°åˆ—è¡¨çš„å·¦ä¾§ï¼Œæ‰€æœ‰å¤§äºæˆ–ç­‰äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°å³ä¾§ï¼›\nåˆ†åˆ«å¯¹å·¦ä¾§å’Œå³ä¾§çš„å…ƒç´ è¿›è¡Œå¿«æ’ï¼›\né‡å¤ä¸Šè¿°çš„æ­¥éª¤ï¼Œæ’åºå®Œæˆï¼›\nåœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åºnä¸ªå…ƒç´ éœ€è¦$O(nlog n)$å¤æ‚åº¦ï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦$O(n^2)$,ä½†ä¸€èˆ¬å¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µã€‚\nä»ç®—æ³•çš„åŸç†å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦å¤šæ¬¡æ‰§è¡Œé‡å¤çš„æ“ä½œï¼Œè‡ªç„¶é‡‡ç”¨é€’å½’å¯ä»¥å‡å°‘å¾ˆå¤šä»£ç ï¼Œè‹¥é—®é€’å½’æŠ€æœ¯å“ªå®¶å¼ºï¼Ÿé¦–å±ˆä¸€æŒ‡Lisp,ä¸‹é¢ç»™å‡ºCLç‰ˆæœ¬çš„å¿«æ’å®ç°ï¼ˆç®€æ˜“ç‰ˆæœ¬ï¼Œåªæ”¯æŒæ•°å­—ç±»å‹çš„åˆ—è¡¨ï¼Œå…¶ä»–ç±»å‹çš„æ’åºåªéœ€å¢åŠ ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å³å¯ï¼Œæœ¬æ–‡ä¸æ‰©å±•ï¼‰ï¼š\n(defun quickSort (lst) (let ( (len (list-length lst)) (st (lambda (l pk) ;; stå‡½æ•°å®ç°ä¸Šè¿°ç¬¬2æ­¥ (let ((left nil) (right nil)) (dolist (each l) (if (\u0026lt; each pk) (push each left) (push each right))) (values left right) ) ) ) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) (quickSort \u0026#39;(1 2 6 3 5 4)) =\u0026gt; (1 2 3 4 5 6) stå‡½æ•°å¯ä»¥ç”¨å®æ¥å®ç°ï¼š\n(defmacro st (lst pk) (let ((gslist (gensym))) `(let ((,gslist ,lst)) (let ((left nil) (right nil)) (dolist (each ,gslist) (if (\u0026lt; each ,pk) (push each left) (push each right))) (values left right) ) ) ) ) (defun quickSort (lst) (let ( (len (list-length lst)) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) ","id":49,"section":"posts","summary":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š è®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼› éå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äº","tags":["lisp"],"title":"å¿«é€Ÿæ’åºï¼ˆLispç‰ˆæœ¬ï¼‰","uri":"https://lvsq.net/2020/07/quick-sort-in-cl/","year":"2020"},{"content":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡ºäº†ä¸€ä¸ªå…³äºå…«çš‡åçš„é¢˜ç›®ï¼Œè¿™æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç»å…¸çš„é—®é¢˜ï¼Œå½“å¹´ä¸Šå­¦æ—¶æ›¾ç»å°½è„‘æ±ä»ç„¶äº‘å±±é›¾ç½©ï¼Œä¸å¾—å…¶è§£ã€‚å¦‚ä»Šå†æ¬¡ç›¸é‡ï¼Œå²‚èƒ½å†åå£ä¸Šè§‚ï¼Ÿï¼æ›´ä½•å†µæ‰‹è¾¹å·²æœ‰è¶æ‰‹çš„å…µå™¨ã€‚è¯•çœ‹Erlangçš„å®ç°ï¼š\n-module(queens). -export([queens/1]). queens(0) -\u0026gt; [[]]; queens(N) -\u0026gt; [[Row | Columns] || Columns \u0026lt;- queens(N - 1), Row \u0026lt;- lists:seq(1, 8) -- Columns, safe(Row, Columns, 1)]. safe(_Row, [], _N) -\u0026gt; true; safe(Row, [Column | Columns], N) -\u0026gt; (Row /= Column + N) andalso (Row /= Column - N) andalso safe(Row, Columns, (N + 1)). ä»å¤´è‡³å°¾10è¡Œä»£ç ï¼Œå¦‚æœä¸æ˜¯ä¸ºäº†ä½¿ä»£ç ç¾è§‚ï¼Œ6è¡Œè¶³çŸ£ï¼ˆè¿™è¿˜åŒ…æ‹¬äº†**-module** å’Œ**-export** ä¸¤è¡Œå£°æ˜è¯­æ³•ï¼Œä¸ç®—æ³•æœ¬èº«æ— å…³çš„ä»£ç ï¼‰ã€‚å¦‚æ­¤ç®€çŸ­å°½ç„¶å¯ä»¥æ¸…æ™°åœ°å®ç°å¤æ‚çš„å…«çš‡å é—®é¢˜ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼ç¨‹åºè¯­è¨€å¾—å†™å¤šå°‘è¡Œï¼Ÿæœ¬æ–‡çš„é‡ç‚¹ä¸åœ¨äºæ¯”è¾ƒè¿™ä¸ªï¼ŒErlangæ˜¯ä¸€é—¨éå¸¸å¼ºå¤§çš„è¯­è¨€ï¼Œå¯¹äºæˆ‘æ¥è¯´Erlangå¥½æ¯”æ¢æ˜¥ï¼Œä½†æ˜¯Schemeæ‰æ˜¯æ—é»›ç‰å‘€ï¼Œæ‰€ä»¥æ¯«ä¸è¿Ÿç–‘ç”¨Schemeæ¥å®ç°ï¼š\n(define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence)))) ) (define (enumerate-interval low high) (if (\u0026gt; low high) \u0026#39;() (cons low (enumerate-interval (+ low 1) high))) ) (define (flatmap proc seq) (accumulate append \u0026#39;() (map proc seq)) ) (define empty-board \u0026#39;()) (define (safe? k position) (let loop ([new-queen (car position)] [rest-queens (cdr position)] [i 1]) (if (null? rest-queens) #t (let ([rest-current-queen (car rest-queens)]) (if (or (= new-queen rest-current-queen) (= new-queen (+ rest-current-queen i)) (= new-queen (- rest-current-queen i)) ) #f (loop new-queen (cdr rest-queens) (+ i 1)) ) ) ) ) ) (define (adjoin-position new-row k rest-of-queens) (cons new-row rest-of-queens) ) (define (queens board-size) (define (queen-cols k) (if (= k 0) (list empty-board) (filter (lambda (position) (safe? k position)) ;è¿‡æ»¤æ— æ•ˆçš„è§£ (flatmap (lambda (rest-of-queens) (map (lambda (new-row) ;æ‰©å……ï¼ˆk-1ï¼‰ä¸ªçš‡åçš„æ¯ä¸€ä¸ªè§£ï¼Œç»™æ¯ä¸ªè§£éƒ½å¢åŠ ç¬¬kä¸ªçš‡å (adjoin-position new-row k rest-of-queens)) (enumerate-interval 1 board-size) ) ) (queen-cols (- k 1)) ;å‰ï¼ˆk-1ï¼‰ä¸ªæœ‰æ•ˆçš„çš‡åï¼Œè™½ç„¶æ˜¯å¤ªè™šå¹»å¢ƒï¼Œä½†å¯ä»¥è®¤ä¸ºæ˜¯äº‹å® ) ) ) ) (queen-cols board-size) ) Schemeç‰ˆæœ¬æ¯”Erlangç‰ˆæœ¬ä»£ç å¢åŠ äº†ä¸å°‘ï¼ŒåŸå› åœ¨äºå…¶æ²¡æœ‰æ¨¡å¼åŒ¹é… å’Œåˆ—è¡¨æ¨å¯¼ è¿™ä¸¤å¤§åˆ©å™¨ï¼Œä¸è¿‡æˆ‘æ›´å–œæ¬¢Schemeå¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ„é€ æˆ‘éœ€è¦çš„ä¸€åˆ‡ï¼Œè€Œä¸”S-è¡¨è¾¾å¼çœ‹èµ·æ¥ååˆ†ä¼˜ç¾è‡ªç„¶ã€‚Schemeç‰ˆæœ¬å®é™…ä¸Šè§£å†³äº†n-çš‡åï¼Œæ›´è¿›ä¸€æ­¥äº†ã€‚\näº‹æƒ…åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸï¼ŒåŸå› åœ¨äºæˆ‘åˆšå¼€å§‹å®ç°Schemeç‰ˆæœ¬çš„å…«çš‡åæ—¶ï¼Œé€‰æ‹©ç¿»è¯‘Erlangä»£ç ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼ä¸€ç•ªæŒ£æ‰ä¹‹åï¼Œæ„è¯†åˆ°è¯¥é—®é¢˜å±äºéç¡®å®šæ€§è®¡ç®—ï¼ŒçŒ›ç„¶æƒ³èµ·ã€ŠSICPã€‹ä¸­æœ‰ä¸€èŠ‚ä¸“é—¨ä»‹ç»äº†æ­¤ç§è®¡ç®—ï¼Œä¹Ÿå³æœ¬æ–‡çš„ä¸»è§’â€”â€”amb\néç¡®å®šæ€§è®¡ç®— ambè¿™ä¸ªåå­—æºäºambiguous ,å…¶å«ä¹‰å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£ã€‚ä¸€ç•ªæŠ«è‚æ²¥èƒ†ä¹‹åï¼Œç»ˆäºçª¥åˆ°äº†ä¸€äº›é—¨å¾„ï¼Œè¶æœºå˜æ¸…å¾ˆå¤šçŸ¥è¯†ç‚¹ã€‚æˆ‘å°†å°½åŠ›å¹³é“ºç›´è¿°ï¼Œç®€è¦çš„ä»‹ç»è¿™ç§å¼ºå¤§ä¸”ååˆ†æœ‰ç”¨çš„æ­¦å™¨ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸ªé—®é¢˜ï¼š\nå‡è®¾æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­éƒ½æ˜¯ä¸€äº›æ­£æ•´æ•°ï¼Œæ¯”å¦‚l1 = [1 2 3 4 5], l2 = [3 4 6 7 8]ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»l1å’Œl2ä¸­å„å–ä¸€ä¸ªæ•°å­—ï¼Œç›¸åŠ ä¹‹åï¼Œå¦‚æœæ˜¯ç´ æ•°ï¼Œåˆ™æ»¡è¶³è¦æ±‚ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå¯¹äºè¿™ä¸ªç®€å•çš„é—®é¢˜ï¼Œç›¸ä¿¡éš¾ä¸å€’å¤§å®¶ï¼Œé‡‡ç”¨å›æº¯ç®—æ³•è½»æ˜“å°±è§£å†³äº†ï¼Œè¿™é‡Œåªæ˜¯æƒ³å¼•å‡ºâ€œéç¡®å®šæ€§è®¡ç®—â€çš„æ¦‚å¿µã€‚éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†ç±»ä¼¼ï¼Œå¯¹äºâ€œç”Ÿæˆå’Œæ£€æµ‹å¼â€çš„åº”ç”¨ç‰¹åˆ«æœ‰ä»·å€¼ï¼Œå®ƒå¾€å¾€åªæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼Œè¿™å¥è¯å¾ˆæœ‰æ„æ€ï¼Œå¦‚æœæš‚æ—¶æ²¡æœ‰ç†è§£ä¸ç”¨ç€æ€¥ï¼Œç»§ç»­å¾€ä¸‹çœ‹ã€‚\nå¯¹äºéç¡®å®šæ€§è®¡ç®—ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè¡¨è¾¾å¼æ˜¯å…è®¸å­˜åœ¨å¤šä¸ªå€¼çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„é—®é¢˜çš„è§£è‡³å°‘æœ‰(1 4),(2 3)ä¸¤ä¸ªè§£å§ã€‚\næœ‰ä¸€ä»¶å¾ˆæœ‰æ•™ç›Šçš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†å¯¹äºæ—¶é—´çš„ä¸åŒçœ‹æ³•ã€‚æµå¤„ç†åˆ©ç”¨äº†æƒ°æ€§æ±‚å€¼ï¼Œè¿™ä¼šç»™æˆ‘ä»¬ä¸€ç§é”™è§‰ï¼Œä»¿ä½›æ‰€æœ‰å¯èƒ½çš„ç»“æœçš„å‡ºç°æ²¡æœ‰æ—¶é—´é¡ºåºï¼›å¯¹äºéç¡®å®šæ€§çš„æ±‚å€¼ï¼Œä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¯¹ä¸€ä¸ªå¯èƒ½çš„ä¸–ç•Œçš„æ¢ç´¢ï¼Œæ¯ä¸€ä¸ªå€¼éƒ½ç”±ä¸€æ¬¡é€‰æ‹©æ‰€ç¡®å®šï¼ŒæŸäº›é€‰æ‹©ä¼šèµ°å…¥æ­»èƒ¡åŒï¼Œè€Œå¦ä¸€äº›ä¼šå¾—åˆ°æœ‰ç”¨çš„å€¼ï¼Œæ‰€ä»¥éç¡®å®šæ€§è®¡ç®—ç»™æˆ‘ä»¬çš„æ„Ÿè§‰æ˜¯ï¼Œæ—¶é—´æ˜¯æœ‰åˆ†æ”¯çš„ã€‚ç¨‹åºå½“ä¸­ä¼šä¿å­˜æ‰€æœ‰å¯èƒ½çš„ä¸åŒæ‰§è¡Œå†å²ï¼Œåœ¨é‡åˆ°ä¸€ä¸ªæ­»èƒ¡åŒæ—¶ï¼Œæ€»æ˜¯å¯ä»¥å›åˆ°ä»¥å‰çš„é€‰æ‹©ç‚¹ï¼Œå¹¶æ²¿ç€å¦ä¸€ä¸ªåˆ†æ”¯ç»§ç»­ä¸‹å»ã€‚\nä¸‹é¢å°†è¦å®ç°çš„éç¡®å®šæ€§æ±‚å€¼å™¨ç§°ä¸ºâ€”â€”ambæ±‚å€¼å™¨\nambæ±‚å€¼å™¨ å‡è®¾ç›®å‰å·²ç»æ‰©å……äº†Schemeä»¥æ”¯æŒéç¡®å®šæ€§è®¡ç®—ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„ç§°ä¸ºambçš„æ–°å½¢å¼ï¼Œè¡¨è¾¾å¼ $(amb \u0026lt;e_1\u0026gt; \u0026lt;e_2\u0026gt; \u0026hellip; \u0026lt;e_n\u0026gt;)$ ä¼šâ€œæœ‰æ­§ä¹‰åœ°â€è¿”å›nä¸ªè¡¨è¾¾å¼ä¹‹ä¸€çš„å€¼ï¼Œæ¯”å¦‚ï¼š\n(list (amb 1 2 3) (amb \u0026#39;a \u0026#39;b)) å¯ä»¥æœ‰å¦‚ä¸‹6ä¸ªå¯èƒ½çš„å€¼ï¼š (1 a) (1 b) (2 a) (2 b) (3 a) (3 b)\nå¯¹äºæ²¡æœ‰é€‰é¡¹çš„ambï¼Œå³(amb) â€”â€”è§†ä¸ºæ²¡æœ‰å¯æ¥æ”¶å€¼çš„è¡¨è¾¾å¼ï¼Œè¿™å°†å¯¼è‡´æ±‚å€¼â€œfailâ€ã€‚\nambæ±‚å€¼å™¨åœ¨æ¯ä¸ªé€‰æ‹©ç‚¹ï¼Œæ€»æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªå¯èƒ½æ€§ï¼Œå¦‚æœé€‰æ‹©çš„ç»“æœå¤±è´¥ï¼Œé‚£ä¹ˆæ±‚å€¼å™¨è‡ªåŠ¨åœ°å›æº¯åˆ°æœ€è¿‘çš„é€‰æ‹©ç‚¹ï¼Œå»å°è¯•ä¸‹ä¸€ä¸ªå¯èƒ½æ€§ã€‚å¦‚æœå®ƒç”¨å®Œäº†æ‰€ä»¥çš„å¯èƒ½æ€§ï¼Œåˆ™è‡ªåŠ¨é€€å›åˆ°ä¸Šä¸€ä¸ªé€‰æ‹©ç‚¹ï¼Œå¹¶ä»é‚£é‡Œç»§ç»­ï¼ˆè¿™ä¸ªâ€œç»§ç»­â€å¾ˆæœ‰æ„æ€ï¼Œåæ–‡ä¼šçœ‹åˆ°ï¼Œâ€œç»§ç»­â€ä¸ä½†æ˜¯ç»“è®ºï¼Œè¿˜æ˜¯å…¶å®ç°çš„æ–¹å¼ï¼Œä¸€è¯­åŒå…³ï¼‰ä¸‹å»ã€‚ä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆ ç®—æ³•ã€‚\né€»è¾‘è°œé¢˜ åœ¨è®¨è®ºambæ±‚å€¼å™¨çš„å®ç°ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€é“é€»è¾‘è°œé¢˜ï¼š\næ›¹æ“ã€å­™æƒã€åˆ˜å¤‡ã€è¢ç»ã€é©¬è¶…5äººä½åœ¨ä¸€æ ‹5å±‚çš„æ¥¼æˆ¿é‡Œé¢ï¼Œæ¯äººä½ä¸€å±‚ã€‚æ›¹æ“ä¸ä½é¡¶å±‚ï¼Œå­™æƒä¸ä½åº•å±‚ï¼Œåˆ˜å¤‡ä¸ä½é¡¶å±‚ä¹Ÿä¸ä½åº•å±‚ï¼Œè¢ç»æ¯”åˆ˜å¤‡é«˜ä¸€å±‚ï¼Œé©¬è¶…ä¸åˆ˜å¤‡ä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œåˆ˜å¤‡ä¸å­™æƒä¹Ÿä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œè¯·é—®ä»–ä»¬å„ä½åœ¨å“ªä¸€å±‚ï¼Ÿ\nåœ¨æ²¡æœ‰ambæ—¶ï¼Œä»£ç æ€ä¹ˆå†™å‘¢ï¼Ÿææ€•ä¸å®¹æ˜“å§ã€‚ä½†æ˜¯ç°åœ¨æœ‰äº†ambæ±‚å€¼å™¨ï¼Œç¬é—´ç¾å¥½äº†ï¼š\n(define (multiple-dwelling) (let ( [caocao (amb 1 2 3 4 5)] [sunquan (amb 1 2 3 4 5)] [liubei (amb 1 2 3 4 5)] [yuanshao (amb 1 2 3 4 5)] [machao (amb 1 2 3 4 5)] ) (require (distinct? (list caocao sunquan liubei yuanshao machao))) (require (not (= caocao 5))) (require (not (= sunquan 1))) (require (not (= liubei 5))) (require (not (= liubei 1))) (require (\u0026gt; yuanshao liubei)) (require (not (= (abs (- machao liubei)) 1)) (require (not (= (abs (- sunquan liubei)) 1)) (list (list \u0026#39;caocao caocao) (list \u0026#39;sunquan sunquan) (list \u0026#39;liubei liubei) (list \u0026#39;yuanshao yuanshao) (list \u0026#39;machao machao)) ) ) ä¸Šè¿°ä»£ç åªæ˜¯æè¿°é—®é¢˜çš„å…³ç³»ï¼Œå³å„ä¸ªrequireéƒ¨åˆ†ï¼ˆå…ˆä¸è€ƒè™‘æ€§èƒ½é—®é¢˜ã€‚è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„â€œæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•â€å—ï¼Ÿï¼‰ï¼Œå¹¶æ²¡æœ‰æ·»åŠ ä»€ä¹ˆâ€œå¤„ç†é€»è¾‘â€ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿä¸‹é¢ç»“æœï¼š\n((caocao 3) (sunquan 2) (liubei 4) (yuanshao 5) (machao 1))\nå±…ç„¶å¾—åˆ°äº†è°œé¢˜çš„è§£ï¼Œè¿™æ˜¯ä»€ä¹ˆé­”æ³•ï¼Ÿï¼Ÿï¼Ÿ\nambè½»è€Œæ˜“ä¸¾åœ°è§£å†³äº†è¿™ç§éœ€è¦å¤§é‡å›æº¯çš„é—®é¢˜ã€‚\nå®ç° ç°åœ¨è¯¥è°ˆä¸€è°ˆç¥å¥‡çš„ambå¦‚ä½•å®ç°äº†å§ã€‚å‰æ–‡å·²ç»å¤šæ¬¡æåˆ°è¿‡ï¼Œambæ±‚å€¼çš„è¿‡ç¨‹å¯èƒ½ä¼šä¸æ–­çš„å›æº¯ï¼Œè¿™åŠ¿å¿…å¯¼è‡´ç¨‹åºæµç¨‹çš„è·³è½¬ï¼Œç¨‹åºè·³è½¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€å¯æ²¡æœ‰break,continueä¹‹ç±»çš„è¯­æ³•ï¼Œå› ä¸ºæ ¹æœ¬ä¸éœ€è¦ï¼Œé‚£ä¹ˆå‡½æ•°å¼è¯­è¨€æœ‰å•¥ï¼Ÿç­”æ¡ˆæ˜¯continuation(ç¿»è¯‘æˆç»§ç»­ï¼Œæˆ–è€…å»¶ç»­éƒ½å¯ä»¥ã€‚è¿˜è®°å¾—â€œä¸€è¯­åŒå…³â€å—ï¼Ÿ)\nSchemeå†…ç½®äº†è¿™ä¸ªå¼ºå¤§çš„æ§åˆ¶æŠ½è±¡ï¼Œè¿‡ç¨‹åä¸ºï¼šcall-with-current-continuationï¼Œ åå­—ç•¥é•¿ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯ç”¨å…¶ç¼©å†™ï¼šcall/ccã€‚å›¿äºç¯‡å¹…ï¼Œæœ¬æ–‡ä¸æ‰“ç®—ä»‹ç»continuationï¼Œå¦‚æœæƒ³è¯¦ç»†äº†è§£å®ƒï¼Œè¯·è‡ªè¡Œæœç´¢ã€‚\nå¸¸è§„æ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸€ä¸ªå‚æ•°ï¼šæ‰§è¡Œç¯å¢ƒenvã€‚ambæ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé™¤äº†æ‰§è¡Œç¯å¢ƒenvä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªcontinuationè¿‡ç¨‹ï¼ˆä¸€ä¸ªæˆåŠŸå»¶ç»­ã€ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼‰ã€‚å¯¹ä¸€ä¸ªè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œç»“æŸåä¼šè°ƒç”¨è¿™ä¸¤ä¸ªcontinuationè¿‡ç¨‹ä¹‹ä¸€ï¼šå¦‚æœæ­¤æ¬¡æ±‚å€¼å¾—åˆ°äº†ä¸€ä¸ªç»“æœï¼Œåˆ™è°ƒç”¨æˆåŠŸå»¶ç»­ï¼›å¦‚æœç»“æœæ˜¯é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™è°ƒç”¨å¤±è´¥å»¶ç»­ã€‚\næˆåŠŸå»¶ç»­çš„å·¥ä½œæ˜¯ï¼šæ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶å°†è®¡ç®—è¿›è¡Œå»ä¸‹ï¼Œä¸è¿™ä¸ªå€¼ä¸€èµ·ï¼ŒæˆåŠŸå»¶ç»­è¿‡ç¨‹è¿˜å°†å¾—åˆ°ä¸€ä¸ªå¦ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼Œå¦‚æœä½¿ç”¨è¯¥å€¼æ—¶é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™éœ€è¦è°ƒç”¨è¿™ä¸ªå¤±è´¥å»¶ç»­ã€‚\nå¤±è´¥å»¶ç»­çš„å·¥ä½œæ˜¯ï¼šè¯•æ¢éç¡®å®šæ€§è¿‡ç¨‹çš„å¦ä¸€ä¸ªåˆ†æ”¯ã€‚éç¡®å®šæ€§è®¡ç®—çš„æœ€å…³é”®çš„ç‰¹å¾ï¼Œåœ¨äºè¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºäºä¸åŒå¯èƒ½æ€§ä¹‹é—´çš„é€‰æ‹©ã€‚\næˆ‘æ‰¿è®¤æœ‰ç‚¹çƒ§è„‘ï¼Œä½†è¿˜ç®—æ¸…æ™°ï¼Œè®©é€’å½’åœ¨è„‘æµ·ä¸­å¥”æ¶Œå§ã€‚\nåˆ©ç”¨å®æ¥ç®€åŒ–ambçš„æ„é€ ï¼Œä»£ç å‚è€ƒè¿™é‡Œï¼š\n(define amb-fail \u0026#39;*) (define initialize-amb-fail (lambda () (set! amb-fail (lambda () (error \u0026#34;amb tree exhausted\u0026#34;))))) (initialize-amb-fail) (define-syntax amb (syntax-rules () ((amb alt ...) (let ((prev-amb-fail amb-fail)) ;ä¿å­˜å‰ä¸€ä¸ªé€‰æ‹©ç‚¹ (call/cc (lambda (sk) ;å¯¹äºæ•´ä¸ªambè¡¨è¾¾å¼æ„é€ ä¸€ä¸ªskçš„contnuation (call/cc (lambda (fk) ;å¯¹äºæ¯ä¸€ä¸ªambçš„é€‰é¡¹æ„é€ ä¸€ä¸ªfkçš„continuation (set! amb-fail ;å…ˆæŠŠamb-failè®¾ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯å°†amb-failæ¢å¤åˆ°è¿›å…¥ambå‰çš„å€¼ (lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) ) (sk alt) ;ç«‹å³è¿”å›è‡ªå·±çš„åˆ†æ”¯çš„å€¼,ä»è€Œå¼•èµ·ambè¡¨è¾¾å¼ä¸­é€”è¿”å›ã€‚æ³¨æ„ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œæ—¶éƒ½ä¼šå¼•èµ· amb ç«‹å³è¿”å›ã€‚åé¢çš„åˆ†æ”¯éƒ½è¿˜æ²¡æœ‰æ‰§è¡Œï¼ ) ) ... (prev-amb-fail) ) ) ) ) ) ) ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼ˆä¹Ÿå¯ä»¥å«åˆ†æ”¯ï¼‰ä¼šè¢«ç«‹å³è¿”å›ï¼Œåé¢çš„æš‚æ—¶ä¸æ‰§è¡Œã€‚å‡è®¾è¯¥å€¼è¢«è®¤ä¸ºæ˜¯â€œæ— æ•ˆçš„ï¼ˆæ¯”å¦‚åº”ç”¨è¯¥å€¼åï¼Œæ‰§è¡Œåˆ°(amb)äº†ï¼‰â€ï¼Œåˆ™æ‰§è¡Œ(prev-amb-fail)ï¼Œè€Œprev-amb-failåœ¨è¿›å…¥ambçš„æ—¶å€™è¢«ç»‘å®šåˆ°äº†amb-failï¼Œ ä¸è¿‡amb-failå·²è¢«è®¾ç½®æˆäº†ä¸€ä¸ªå‡½æ•°ï¼š\n(lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) å®ƒå…ˆæŠŠamb-failè®¾ç½®æˆprev-amb-fail,ä¹Ÿå°±æ˜¯è¿›å…¥ï¼ˆamb alt \u0026hellip;ï¼‰ä¹‹å‰çš„å€¼ï¼Œ ç„¶åç”¨(fk \u0026lsquo;fail)è¿”å›\u0026rsquo;failåˆ°åˆ†æ”¯çš„continuationï¼Œå³å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯ï¼ˆä¸‹ä¸€ä¸ªé€‰é¡¹ï¼‰äº†ã€‚\nååˆ†ç²¾å·§çš„ç¨‹åºï¼ï¼ï¼\nä¸Šè¿°çš„ambæ¯æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå¦‚æœéœ€è¦è¿”å›æ‰€æœ‰æœ‰æ•ˆçš„ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢å®šä¹‰çš„å®ï¼š\n(define-syntax bag-of (syntax-rules () ((bag-of e) (let ((prev-amb-fail amb-fail) (results \u0026#39;())) (if (call/cc (lambda (k) (set! amb-fail (lambda () (k #f))) ;\u0026lt;-----+ (let ((v e)) ;amb-fail will be modified by e | (set! results (cons v results)) ;| (k #t)))) ;| (amb-fail)) ;so this amb-fail may not be ---+ (set! amb-fail prev-amb-fail) (reverse! results))))) (bag-of (let ([a (amb 1 2 3)] [b (amb 0 -1 2)]) (if (= (+ a b) 1) (list a b) (amb)) )) ;ç»“æœä¸ºï¼š((1 0) (2 -1)) å›åˆ°n-çš‡åé—®é¢˜ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å·²æ‰‹æ¡ambè¿™æŠŠåˆ©å™¨ï¼Œæ˜¯æ—¶å€™é‡æ„ä¸€ä¸‹n-çš‡åé—®é¢˜äº†ã€‚\n(define number-between (lambda (lo hi) (let loop ((i lo)) (if (\u0026gt; i hi) (amb) (amb i (loop (+ i 1))))))) ; (amb 1 (amb 2 (amb 3 ... ))) (define (n-queens n) (call/cc (lambda (return) (let add-queen ([i 0] [result \u0026#39;()]) (when (\u0026lt; i n) ;æœ€å¤šæ‘†å‡ ä¸ªçš‡å (let ([new-queen (number-between 1 n)]) (if (safe? n (append (list new-queen) result)) ;æ–°åŠ å…¥çš„çš‡åå¿…é¡»æ˜¯æœ‰æ•ˆçš„ (add-queen (+ i 1) (append (list new-queen) result)) (amb)) ) ) (return result) ) ) ) ) (bag-of (n-queens 8)) ;8ä¸ªçš‡åçš„æ‰€æœ‰è§£ è¯¥ç‰ˆæœ¬æ¯”ä¹‹å‰çš„Schemeç‰ˆæœ¬çš„å®ç°æ”¹è¿›äº†å¾ˆå¤šï¼Œç°åœ¨åªéœ€è¦æè¿°ä¸€ä¸‹æˆ‘çš„é—®é¢˜çš„å…³ç³»å³å¯ï¼Œç¨‹åºä¼šè‡ªåŠ¨é€‰æ‹©æ‰€æœ‰æ­£ç¡®çš„å€¼ï¼Œæ— éœ€å…³å¿ƒè®¡ç®—æœºå†…éƒ¨åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨é¢å¯¹å¾ˆå¤šé€»è¾‘é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°è§£å†³äº†ã€‚\nä¹Ÿè®¸æœ‰äººä¼šé—®ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼è¯­è¨€æ¥å¤„ç†çš„è¯ï¼Œå¯èƒ½å‡ ä¸ªåµŒå¥—çš„å¾ªç¯ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœï¼Œå¦‚æ­¤å¤§è´¹å‘¨ç« çš„ä»‹ç»è¿™ä¸ªå«ambçš„æŠ€æœ¯ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆä»·å€¼å‘¢ï¼Ÿ é‚£å°±æ¥èŠä¸€èŠã€‚\næœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ åœ¨è°ˆè®ºæ„ä¹‰ä¹‹å‰ï¼Œå®¹è®¸æˆ‘æä¸€ä¸ªé—®é¢˜\nä¸ºä»€ä¹ˆSQLè¯­è¨€è¦è®¾è®¡æˆè¿™æ ·ï¼Ÿä¸å‘½ä»¤å¼è¯­è¨€å¦‚æ­¤çš„ä¸åŒï¼Ÿ\né¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè®¡ç®—æœºç§‘å­¦å¤„ç†çš„æ˜¯å‘½ä»¤å¼ï¼ˆæ€æ ·åšï¼‰çš„çŸ¥è¯†ï¼Œè€Œæ•°å­¦å¤„ç†çš„æ˜¯è¯´æ˜å¼ï¼ˆæ˜¯ä»€ä¹ˆï¼‰çš„çŸ¥è¯†ã€‚ äº‹å®ä¸Šï¼Œäººç±»ä¸å¯èƒ½åªé¢ä¸´å…¶ä¸­ä¸€ç§é—®é¢˜ï¼Œç¨‹åºè®¾è®¡ä¸­ä¸€ä¸ªé‡è¦çš„åˆ†æ”¯å°±æ˜¯é€»è¾‘ç¨‹åºè®¾è®¡ï¼Œæœ‰å¾ˆå¤šé—®é¢˜æˆ–è€…æ•°æ®ä¹‹é—´å­˜åœ¨ç€å…³è”å…³ç³»ï¼Œéš¾ä»¥è§‚æµ‹åˆ°ç»“è®ºï¼Œæè¿°å®ƒä»¬çš„å…³ç³»å¾ˆç®€å•ï¼Œä½†æ˜¯ç›´æ¥å‘Šè¯‰è®¡ç®—æœºå¦‚ä½•å»åšå´ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥ä¸ºè‹¥å¹²æ­¤ç±»é—®é¢˜ç¼–å†™å‘½ä»¤å¼ä»£ç ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ‰€æœ‰è¿™æ ·çš„é—®é¢˜éƒ½ç¼–å†™ä»£ç ï¼Œæ˜¾ç„¶ä¿¡æ¯ä¹‹é—´çš„å…³ç³»æ˜¯å¤šç§å¤šæ ·çš„ï¼Œé‚£ä¹ˆä»£ç å°±éœ€è¦ç›¸åº”çš„å˜åŒ–ï¼Œå¾€å¾€ä¿®æ”¹è¿™æ ·çš„ä»£ç æ˜¯å¾ˆå›°éš¾çš„ï¼Œ ç”šè‡³éœ€è¦é‡æ–°è®¾è®¡å¹¶ç¼–ç ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç¨‹åºè®¾è®¡å¯ä»¥å¤„ç†è¯´æ˜å¼çš„çŸ¥è¯†ï¼Œå²‚ä¸æ˜¯å¤§å¤§å‡è½»äº†ç¨‹åºå‘˜çš„å·¥ä½œäº†å‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€çš„è®¾è®¡æ˜¯åŸºäºlambdaç†è®ºï¼Œå›´ç»•ç€æ•°å­¦å‡½æ•°å€¼çš„è®¡ç®—ç»„ç»‡èµ·æ¥çš„ï¼Œä¾é å…¶å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œåœ¨å¤„ç†é€»è¾‘é—®é¢˜ä¸Šæ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼Œå¯ä»¥åŒ–ç¹ä¸ºç®€ã€‚\nè¯´åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ï¼Œä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ä¹‹é—´å­˜åœ¨ç€ç§ç§è”ç³»å‘¢ï¼ŸSQLæ­£æ˜¯æè¿°äº†è¿™ç§å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰æ•°æ®åº“æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ•°æ®ï¼ˆselectï¼‰, æ•°æ®åœ¨ä»€ä¹ˆä½ç½®ï¼ˆfromï¼‰, å“ªäº›æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆwhereï¼‰å°±è¡Œäº†ï¼Œå¹¶ä¸éœ€è¦å‘Šè¯‰æ•°æ®åº“è¯¥å¦‚ä½•å…·ä½“æ“ä½œï¼Œæ•°æ®åº“å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„æè¿°ï¼ˆSQLï¼‰å°±èƒ½å¤Ÿå‡†ç¡®çš„è¿”å›ç»“æœï¼Œè¿™çœŸæ˜¯å…³äºéç¡®å®šæ€§è®¡ç®—çš„ä¸€ä¸ªæå¥½çš„ä¾‹å­ï¼Œæ­¤æ—¶æˆ‘ä»¬æ€»è¯¥æ˜ç™½ä¸ºä»€ä¹ˆæ•°æ®åº“å«åšå…³ç³»å‹æ•°æ®åº“ äº†å§ã€‚æˆ‘ä»¬ä¸å¦¨è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸é‡‡ç”¨æè¿°çš„æ–¹å¼æ¥æŸ¥è¯¢æ•°æ®ï¼Œç¨‹åºå‘˜ä»¬è¯¥æ€ä¹ˆåšï¼Ÿè¿˜èƒ½å¤Ÿè½»æ˜“çš„æŸ¥æ‰¾åˆ°éœ€è¦çš„æ•°æ®å—ï¼Ÿ\nåˆšæ‰æˆ‘æå‡ºçš„é—®é¢˜ï¼Œæƒ³å¿…æ­¤åˆ»åº”è¯¥æœ‰ç­”æ¡ˆäº†ã€‚\n","id":50,"section":"posts","summary":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡º","tags":["scheme"],"title":"ä»â€œå…«çš‡åâ€åˆ°amb","uri":"https://lvsq.net/2020/05/n-queens/","year":"2020"},{"content":" ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah\nä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°å…¶ä»–è¯­è¨€ 2ï¼‰ç”¨äºæ„å»ºå¯ä¼¸ç¼©å’Œå¼¹æ€§å¹¶å‘ç³»ç»Ÿçš„OTPåº“å’Œä¸­é—´ä»¶ï¼Œä»¥åŠ 3ï¼‰ä¸è¯­è¨€è¯­ä¹‰ç´§å¯†è€¦åˆçš„BEAMè™šæ‹Ÿæœºå’ŒOTPã€‚\nå•ç‹¬ä½¿ç”¨è¿™äº›ç»„ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨å°†è·å¾—äºšå†›ã€‚ä½†æ˜¯ï¼Œå°†è¿™ä¸‰ä¸ªå› ç´ æ”¾åœ¨ä¸€èµ·ï¼Œæ‚¨å°†è·å¾—å¯ä¼¸ç¼©ï¼Œçµæ´»çš„è½¯å®æ—¶ç³»ç»Ÿçš„æ— å¯äº‰è®®çš„èµ¢å®¶ã€‚å¼•ç”¨Joe Armstrongçš„è¯ï¼šâ€œæ‚¨å¯ä»¥å¤åˆ¶Erlangåº“ï¼Œä½†æ˜¯å¦‚æœå®ƒä¸èƒ½åœ¨BEAMä¸Šè¿è¡Œï¼Œåˆ™æ— æ³•æ¨¡æ‹Ÿè¯­ä¹‰â€ã€‚è¿™æ˜¯ç”±ç½—ä¼¯ç‰¹Â·ç»´å°”ä¸ï¼ˆRobert Virdingï¼‰çš„ã€Šç¬¬ä¸€æ¡ç¼–ç¨‹è§„åˆ™ã€‹å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œè¯¥æ¡è§„å®šï¼šâ€œä»»ä½•å¦ä¸€ç§è¶³å¤Ÿå¤æ‚çš„å¹¶å‘ç¨‹åºéƒ½ä½¿ç”¨å¦ä¸€ç§è¯­è¨€ï¼ŒåŒ…å«éæ­£å¼çš„ï¼Œä¸´æ—¶æŒ‡å®šçš„ï¼Œbugç¼ èº«çš„ç¼“æ…¢çš„Erlangä¸€åŠå®ç°ã€‚â€\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æƒ³æ¢ç´¢BEAM VMå†…éƒ¨ã€‚æˆ‘ä»¬å°†åœ¨é€‚ç”¨çš„æƒ…å†µä¸‹å°†å®ƒä»¬ä¸JVMè¿›è¡Œæ¯”è¾ƒå’Œå¯¹æ¯”ï¼Œå¼ºè°ƒæ‚¨ä¸ºä»€ä¹ˆè¦æ³¨æ„å®ƒä»¬å¹¶åŠ ä»¥æ³¨æ„ã€‚é•¿æœŸä»¥æ¥ï¼Œæ­¤ç»„ä»¶ä¸€ç›´è¢«è§†ä¸ºé»‘åŒ£å­ï¼Œå¹¶ä¸”åœ¨ä¸äº†è§£åŸå› æˆ–å«ä¹‰çš„æƒ…å†µä¸‹è¢«è§†ä¸ºç†æ‰€å½“ç„¶ã€‚ç°åœ¨è¯¥æ”¹å˜è¿™ç§æƒ…å†µäº†ï¼\nBEAMçš„äº®ç‚¹ å‘æ˜Erlangå’ŒBEAM VMæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„æ­£ç¡®å·¥å…·ã€‚å®ƒä»¬æ˜¯ç”±çˆ±ç«‹ä¿¡å¼€å‘çš„ï¼Œæ—¨åœ¨å¸®åŠ©å®ç°å¤„ç†ç§»åŠ¨å’Œå›ºå®šç½‘ç»œçš„ç”µä¿¡åŸºç¡€è®¾æ–½ã€‚è¯¥åŸºç¡€æ¶æ„æœ¬è´¨ä¸Šæ˜¯é«˜åº¦å¹¶å‘å’Œå¯ä¼¸ç¼©çš„ã€‚å®ƒå¿…é¡»æ˜¾ç¤ºè½¯å®æ—¶å±æ€§ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ã€‚æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ‰‹æœºä¸Šä¸ç¥–æ¯è¿›è¡Œç¯èŠé€šè¯æ—¶æ‰çº¿æˆ–Fortniteçš„åœ¨çº¿æ¸¸æˆä½“éªŒä¸ä¼šå—åˆ°ç³»ç»Ÿå‡çº§ï¼Œé«˜ç”¨æˆ·è´Ÿè½½æˆ–è½¯ä»¶ï¼Œç¡¬ä»¶å’Œç½‘ç»œä¸­æ–­çš„å½±å“ã€‚BEAM VMé€šè¿‡æä¾›å¯åœ¨å¯é¢„æµ‹çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¹‹ä¸Šè¿è¡Œçš„å¾®è°ƒåŠŸèƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥è§£å†³è®¸å¤šæŒ‘æˆ˜ã€‚\nå®ƒçš„ç§˜è¯€æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œå®ƒä»¬ä¸å…±äº«å†…å­˜ï¼Œç”±è°ƒåº¦ç¨‹åºç®¡ç†ï¼Œè¯¥è°ƒåº¦ç¨‹åºå¯ä»¥è·¨å¤šä¸ªå†…æ ¸ç®¡ç†æ•°ç™¾ä¸‡ä¸ªè¿›ç¨‹ã€‚å®ƒä½¿ç”¨åŸºäºæ¯ä¸ªè¿›ç¨‹è¿è¡Œçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ä»¥å‡å°‘å¯¹å…¶ä»–è¿›ç¨‹çš„å½±å“ã€‚ç»“æœï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“è½¯å®æ—¶å±æ€§ã€‚BEAMä¹Ÿæ˜¯å”¯ä¸€ä½¿ç”¨è§„æ¨¡å¹¿æ³›ä¸”å…·æœ‰å†…ç½®åˆ†å‘æ¨¡å‹çš„VMï¼Œå®ƒå…·æœ‰å†…ç½®çš„åˆ†å‘æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…è®¸ç¨‹åºé€æ˜åœ°åœ¨å¤šå°è®¡ç®—æœºä¸Šè¿è¡Œã€‚\nJVMçš„äº®ç‚¹ Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æ˜¯â€‹â€‹ç”±Sun Microsystemå¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¯åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„â€œä¸€æ¬¡å†™å…¥â€ä»£ç çš„å¹³å°ã€‚ä»–ä»¬åˆ›å»ºäº†ä¸€ç§ç±»ä¼¼äºC++çš„é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æ˜¯å†…å­˜å®‰å…¨ï¼Œå› ä¸ºå…¶è¿è¡Œæ—¶é”™è¯¯æ£€æµ‹ä¼šæ£€æŸ¥æ•°ç»„èŒƒå›´å’ŒæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚åœ¨Internetæ—¶ä»£ï¼ŒJVMç”Ÿæ€ç³»ç»Ÿå˜å¾—éå¸¸æµè¡Œï¼Œä½¿å…¶æˆä¸ºä¼ä¸šæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®é™…æ ‡å‡†ã€‚æ»¡è¶³å¹¿æ³›ç”¨ä¾‹çš„è™šæ‹Ÿæœºå’Œå¯æ»¡è¶³ä¼ä¸šå‘å±•éœ€æ±‚çš„ä»¤äººå°è±¡æ·±åˆ»çš„åº“é›†ä½¿å¹¿æ³›çš„é€‚ç”¨æ€§æˆä¸ºå¯èƒ½ã€‚\nJVMè®¾è®¡æ—¶è€ƒè™‘äº†æ•ˆç‡ã€‚å®ƒçš„å¤§å¤šæ•°æ¦‚å¿µæ˜¯æµè¡Œæ“ä½œç³»ç»Ÿä¸­åŠŸèƒ½çš„æŠ½è±¡ï¼Œä¾‹å¦‚æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„çº¿ç¨‹æ¨¡å‹ã€‚JVMæ˜¯é«˜åº¦å¯å®šåˆ¶çš„ï¼ŒåŒ…æ‹¬åƒåœ¾æ”¶é›†å™¨ï¼ˆGCï¼‰å’Œç±»åŠ è½½å™¨ã€‚ä¸€äº›æœ€å…ˆè¿›çš„GCå®ç°æä¾›é«˜åº¦å¯è°ƒæ•´çš„åŠŸèƒ½ï¼Œä»¥é€‚åº”åŸºäºå…±äº«å†…å­˜çš„ç¼–ç¨‹æ¨¡å‹ã€‚JVMå…è®¸æ‚¨åœ¨ç¨‹åºè¿è¡Œæ—¶æ›´æ”¹ä»£ç ã€‚è€Œä¸”ï¼ŒJITç¼–è¯‘å™¨å…è®¸å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬æœºä»£ç ï¼Œç›®çš„æ˜¯åŠ å¿«åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†ã€‚\nJavaä¸–ç•Œä¸­çš„å¹¶å‘æ€§ä¸»è¦ä¸åœ¨å¹¶è¡Œçº¿ç¨‹ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæœ‰å…³ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ˜¯å¿«é€Ÿçš„ã€‚ç”±äºå¹¶å‘åŸè¯­çš„å…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå› æ­¤ä½¿ç”¨å¹¶å‘åŸè¯­è¿›è¡Œç¼–ç¨‹æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ï¼Œäººä»¬å°è¯•ç®€åŒ–å’Œç»Ÿä¸€å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œæœ€æˆåŠŸçš„å°è¯•æ˜¯Akkaæ¡†æ¶ã€‚\nå¹¶å‘ä¸å¹¶è¡Œ å¦‚æœéƒ¨åˆ†ä»£ç åœ¨å¤šä¸ªå†…æ ¸ï¼Œå¤„ç†å™¨æˆ–è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œï¼Œåˆ™æˆ‘ä»¬è°ˆè®ºå¹¶è¡Œä»£ç æ‰§è¡Œï¼Œè€Œå¹¶å‘ç¼–ç¨‹æ˜¯æŒ‡ç‹¬ç«‹å¤„ç†åˆ°è¾¾ç³»ç»Ÿçš„äº‹ä»¶ã€‚å¯ä»¥åœ¨å•çº¿ç¨‹ç¡¬ä»¶ä¸Šæ¨¡æ‹Ÿå¹¶å‘æ‰§è¡Œï¼Œè€Œå¹¶è¡Œæ‰§è¡Œåˆ™ä¸èƒ½ã€‚å°½ç®¡è¿™ç§åŒºåˆ«ä¼¼ä¹å¾ˆå¤æ€ªï¼Œä½†è¿™ç§å·®å¼‚å¯¼è‡´éœ€è¦è§£å†³çš„é—®é¢˜éå¸¸ä¸åŒã€‚æƒ³æƒ³å¾ˆå¤šå¨å¸ˆåœ¨åšä¸€ç›˜Carbonaraæ„å¤§åˆ©é¢ã€‚åœ¨å¹¶è¡Œæ–¹æ³•ä¸­ï¼Œå°†ä»»åŠ¡åˆ†é…ç»™å¯ç”¨å¨å¸ˆçš„æ•°é‡ï¼Œå¹¶ä¸”åªè¦å®Œæˆè¿™äº›å¨å¸ˆå®Œæˆå…¶ç‰¹å®šä»»åŠ¡çš„é€Ÿåº¦ï¼Œå°±å¯ä»¥å®Œæˆå•ä¸ªéƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ªå¹¶å‘çš„ä¸–ç•Œä¸­ï¼Œæ¯ä½å¨å¸ˆå°†è·å¾—ä¸€éƒ¨åˆ†ï¼Œæ¯ä½å¨å¸ˆå°†å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚æ‚¨å°†å¹¶è¡Œæ€§ç”¨äºé€Ÿåº¦ï¼Œå¹¶å‘æ€§ç”¨äºè§„æ¨¡ã€‚\nå¹¶è¡Œæ‰§è¡Œè¯•å›¾å°†é—®é¢˜çš„æœ€ä½³åˆ†è§£è§£å†³ä¸ºå½¼æ­¤ç‹¬ç«‹çš„éƒ¨åˆ†ã€‚å°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ï¼Œç‚¸ç“œé‡Œé˜¿å¡ç«è…¿ï¼Œå°†ä½©å…‹ç«‹è¯ºå¥¶é…ªç£¨ç¢1ã€‚å…±äº«æ•°æ®ï¼ˆæˆ–åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºé¤ç›˜ï¼‰ç”±é”ï¼Œäº’æ–¥é”å’Œå„ç§å…¶ä»–æŠ€æœ¯å¤„ç†ï¼Œä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å¦ä¸€ç§çœ‹å¾…è¿™ç§æƒ…å†µçš„æ–¹å¼æ˜¯å­˜åœ¨æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åˆ©ç”¨å°½å¯èƒ½å¤šçš„å¹¶è¡ŒCPUèµ„æºæ¥å°½å¿«å®Œæˆå·¥ä½œã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¹¶â€‹â€‹å‘ç¼–ç¨‹å¤„ç†è®¸å¤šäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶åœ¨ä¸åŒçš„æ—¶é—´åˆ°è¾¾ç³»ç»Ÿï¼Œå¹¶å°è¯•åœ¨åˆç†çš„æ—¶é—´å†…å¤„ç†æ‰€æœ‰äº‹ä»¶ã€‚åœ¨å¤šæ ¸æˆ–åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸Šï¼ŒæŸäº›æ‰§è¡Œæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚å¦ä¸€ç§çœ‹å¾…å®ƒçš„æ–¹æ³•æ˜¯ï¼ŒåŒä¸€ä½å¨å¸ˆæŒ‰ç…§å§‹ç»ˆç›¸åŒçš„é¡ºåºç®—æ³•ï¼Œå°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ç­‰ã€‚è·¨è¿‡ç¨‹ï¼ˆæˆ–åšé¥­ï¼‰çš„å˜åŒ–æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œè¿™äº›æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰å­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸­ã€‚\nJVMæ˜¯ä¸ºå¹¶è¡Œè€Œæ„å»ºçš„ï¼Œè€ŒBEAMæ˜¯ä¸ºå¹¶å‘æ„å»ºçš„ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªæœ¬è´¨ä¸Šä¸åŒçš„é—®é¢˜ï¼Œéœ€è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚\nBEAMå’Œå¹¶å‘ BEAMæä¾›è½»é‡çº§æµç¨‹ä¸ºæ­£åœ¨è¿è¡Œçš„ä»£ç æä¾›ä¸Šä¸‹æ–‡ã€‚è¿™äº›è¿›ç¨‹ä¹Ÿç§°ä¸ºactorï¼Œä¸å…±äº«å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œå°†æ•°æ®ä»ä¸€ä¸ªè¿›ç¨‹å¤åˆ¶åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯è™šæ‹Ÿæœºé€šè¿‡å„ä¸ªè¿›ç¨‹æ‹¥æœ‰çš„é‚®ç®±å®ç°çš„åŠŸèƒ½ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯ä¸€ç§éé˜»å¡æ“ä½œï¼Œè¿™æ„å‘³ç€å°†æ¶ˆæ¯å‘é€åˆ°å¦ä¸€ä¸ªè¿›ç¨‹å‡ ä¹æ˜¯å³æ—¶çš„ï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡å‘é€è€…çš„æ‰§è¡Œã€‚å‘é€çš„æ¶ˆæ¯é‡‡ç”¨ä¸å¯å˜æ•°æ®çš„å½¢å¼ï¼Œä»å‘é€è¿‡ç¨‹çš„å †æ ˆå¤åˆ¶åˆ°æ¥æ”¶è€…çš„é‚®ç®±ã€‚æ— éœ€åœ¨è¿›ç¨‹ä¹‹é—´ä½¿ç”¨é”å’Œäº’æ–¥é”å³å¯å®ç°æ­¤ç›®çš„ï¼Œè€Œåœ¨å¤šä¸ªè¿›ç¨‹å¹¶è¡Œå°†æ¶ˆæ¯å‘é€åˆ°åŒä¸€æ”¶ä»¶äººçš„æƒ…å†µä¸‹ï¼Œåªéœ€å¯¹é‚®ç®±è¿›è¡Œé”å®šå³å¯ã€‚\nä¸å˜çš„æ•°æ®å’Œæ¶ˆæ¯ä¼ é€’ä½¿ç¨‹åºå‘˜èƒ½å¤Ÿç¼–å†™å½¼æ­¤ç‹¬ç«‹å·¥ä½œçš„æµç¨‹ï¼Œå¹¶ä¸“æ³¨äºåŠŸèƒ½è€Œä¸æ˜¯å†…å­˜çš„ä½çº§ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ã€‚äº‹å®è¯æ˜ï¼Œè¿™ç§ç®€å•çš„è®¾è®¡ä¸ä»…é€‚ç”¨äºå•ä¸ªçº¿ç¨‹ï¼Œè€Œä¸”é€‚ç”¨äºåœ¨åŒä¸€VMä¸­è¿è¡Œçš„æœ¬åœ°è®¡ç®—æœºä¸Šçš„å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„åˆ†å‘ï¼Œåœ¨æ•´ä¸ªç½‘ç»œä¸Šé€šè¿‡VMå’Œè®¡ç®—æœºé›†ç¾¤è¿è¡Œã€‚å¦‚æœæ¶ˆæ¯åœ¨è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å¯å˜çš„ï¼Œåˆ™å¯ä»¥ä¸åŠ é”åœ°å°†å®ƒä»¬å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–è®¡ç®—æœºï¼‰ï¼Œä»è€Œåœ¨åˆ†å¸ƒå¼å¤šæ ¸ä½“ç³»ç»“æ„ä¸Šå‡ ä¹çº¿æ€§åœ°æ‰©å±•ã€‚è¿›ç¨‹åœ¨æœ¬åœ°VMä¸Šçš„å¯»å€æ–¹å¼ä¸VMç¾¤é›†ä¸­çš„å¯»å€æ–¹å¼ç›¸åŒï¼Œæ— è®ºæ¥æ”¶è¿›ç¨‹çš„ä½ç½®å¦‚ä½•ï¼Œæ¶ˆæ¯å‘é€éƒ½æ˜¯é€æ˜çš„ã€‚\nè¿›ç¨‹ä¸å…±äº«å†…å­˜ï¼Œå› æ­¤æ‚¨å¯ä»¥å¤åˆ¶æ•°æ®ä»¥æ¢å¤å¼¹æ€§å¹¶åˆ†å‘æ•°æ®ä»¥å®ç°è§„æ¨¡æ‰©å±•ã€‚è¿™æ„å‘³ç€åœ¨ä¸¤ä¸ªä¸åŒçš„æœºå™¨ä¸Šå…·æœ‰ç›¸åŒè¿›ç¨‹çš„ä¸¤ä¸ªå®ä¾‹ï¼Œå½¼æ­¤ä¹‹é—´å…±äº«çŠ¶æ€æ›´æ–°ã€‚å¦‚æœä¸€å°è®¡ç®—æœºå‘ç”Ÿæ•…éšœï¼Œåˆ™å¦ä¸€å°è®¡ç®—æœºå…·æœ‰æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç»§ç»­å¤„ç†è¯¥è¯·æ±‚ï¼Œä»è€Œä½¿ç³»ç»Ÿå…·æœ‰å®¹é”™èƒ½åŠ›ã€‚å¦‚æœä¸¤å°è®¡ç®—æœºéƒ½å¯è¿è¡Œï¼Œåˆ™ä¸¤ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä»è€Œä¸ºæ‚¨æä¾›å¯ä¼¸ç¼©æ€§ã€‚BEAMä¸ºæ‰€æœ‰è¿™äº›æ— ç¼é›†æˆæä¾›äº†é«˜åº¦ä¼˜åŒ–çš„åŸè¯­ï¼Œè€ŒOTPï¼ˆâ€œæ ‡å‡†åº“â€ï¼‰åˆ™æä¾›äº†æ›´é«˜çº§åˆ«çš„ç»“æ„ä»¥ç®€åŒ–ç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚\nAkkaåœ¨å¤åˆ¶æ›´é«˜çº§åˆ«çš„ç»“æ„æ–¹é¢åšå¾—å¾ˆå¥½ï¼Œä½†æ˜¯ç”±äºç¼ºå°‘JVMæä¾›çš„åŸè¯­è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå—åˆ°äº†é™åˆ¶ï¼Œä»è€Œä½¿å…¶å¯ä»¥é«˜åº¦ä¼˜åŒ–å¹¶å‘æ€§ã€‚å°½ç®¡JVMçš„åŸè¯­æ”¯æŒæ›´å¹¿æ³›çš„ç”¨ä¾‹ï¼Œä½†ç”±äºå®ƒä»¬æ²¡æœ‰ç”¨äºé€šä¿¡çš„å†…ç½®åŸè¯­ä¸”é€šå¸¸åŸºäºå…±äº«å†…å­˜æ¨¡å‹ï¼Œå› æ­¤å®ƒä»¬ä½¿å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¼–ç¨‹å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¾‹å¦‚ï¼Œæ‚¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä½•å¤„æ”¾ç½®å…±äº«å†…å­˜ï¼Ÿä»¥åŠè®¿é—®å®ƒçš„æˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ\nè°ƒåº¦å™¨ æˆ‘ä»¬æåˆ°è¿‡ï¼ŒBEAMçš„æœ€å¼ºåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿå°†ç¨‹åºåˆ†è§£ä¸ºå°çš„ï¼Œè½»é‡çº§çš„è¿‡ç¨‹ã€‚ç®¡ç†è¿™äº›è¿‡ç¨‹æ˜¯è°ƒåº¦ç¨‹åºçš„ä»»åŠ¡ã€‚ä¸JVMå°†å…¶çº¿ç¨‹æ˜ å°„åˆ°OSçº¿ç¨‹å¹¶è®©æ“ä½œç³»ç»Ÿè°ƒåº¦å®ƒä»¬ä¸åŒï¼ŒBEAMå¸¦æœ‰è‡ªå·±çš„è°ƒåº¦ç¨‹åºã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç¨‹åºä¸ºæ¯ä¸ªå†…æ ¸å¯åŠ¨ä¸€ä¸ªOSçº¿ç¨‹ï¼Œå¹¶ä¼˜åŒ–å®ƒä»¬ä¹‹é—´çš„å·¥ä½œè´Ÿè½½ã€‚æ¯ä¸ªè¿‡ç¨‹éƒ½åŒ…å«è¦æ‰§è¡Œçš„ä»£ç å’Œéšæ—¶é—´å˜åŒ–çš„çŠ¶æ€ã€‚è°ƒåº¦ç¨‹åºä¼šé€‰æ‹©è¿è¡Œé˜Ÿåˆ—ä¸­å‡†å¤‡è¿è¡Œçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºå…¶èµ‹äºˆå®šé‡çš„reductionsï¼ˆè¯‘è€…æ³¨ï¼š2000ä¸ªï¼‰ï¼Œå…¶ä¸­æ¯æ¬¡reductionéƒ½å¤§è‡´ç­‰åŒäºä¸€æ¡æŒ‡ä»¤ã€‚ä¸€æ—¦è¿›ç¨‹ç”¨å°½äº†reductionsï¼Œä¼šè¢«I/Oé˜»å¡ï¼Œç­‰å¾…æ¶ˆæ¯æˆ–ä»£ç å®Œæˆï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šåœ¨è¿è¡Œé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹å¹¶å°†å…¶åˆ†æ´¾ï¼ˆæ­¤å¥ç¿»è¯‘æœ‰é—®é¢˜ï¼šåŸæ–‡æ˜¯Once the process has either run out of reductions, is blocked by I/O, is waiting for a message or completes executing its code, the scheduler picks the next process in the run queue and dispatches it. å¦‚æœæ‚¨æœ‰æ›´å¥½çš„ç¿»è¯‘è¯·ä¸åæŒ‡æ•™ï¼‰ã€‚è¿™ç§è°ƒåº¦æŠ€æœ¯ç§°ä¸ºæŠ¢å…ˆå¼ã€‚\næˆ‘ä»¬å¤šæ¬¡æåˆ°Akkaæ¡†æ¶ï¼Œå› ä¸ºå®ƒçš„æœ€å¤§ç¼ºç‚¹æ˜¯éœ€è¦åœ¨è°ƒåº¦å¤„æ·»åŠ æ³¨è§£ï¼Œå› ä¸ºè°ƒåº¦ä¸æ˜¯åœ¨JVMçº§åˆ«è¿›è¡Œçš„ã€‚é€šè¿‡è§£é™¤ç¨‹åºå‘˜çš„æ§åˆ¶ï¼Œå¯ä»¥ä¿ç•™å’Œä¿è¯è½¯å®æ—¶å±æ€§ï¼Œä»è€Œå‡ä½äº†å¯¼è‡´è¿›ç¨‹é¥¿æ­»çš„é£é™©ã€‚\nè¿›ç¨‹å›´ç»•ç€è°ƒåº¦ç¨‹åºçº¿ç¨‹ï¼Œå¹¶æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨CPUã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è°ƒæ•´è°ƒåº¦ç¨‹åºï¼Œä½†æ˜¯å®ƒå¾ˆå°‘è§ï¼Œä»…åœ¨è¾¹ç¼˜å’Œè¾¹ç•Œæƒ…å†µä¸‹æ‰éœ€è¦ï¼Œå› ä¸ºé»˜è®¤é€‰é¡¹æ¶µç›–äº†å¤§å¤šæ•°ä½¿ç”¨æ¨¡å¼ã€‚\nå…³äºè°ƒåº¦ç¨‹åºï¼Œç»å¸¸å‡ºç°ä¸€ä¸ªæ•æ„Ÿçš„è¯é¢˜ï¼šå¦‚ä½•å¤„ç†æœ¬æœºå®ç°çš„å‡½æ•°ï¼ˆNIFï¼‰ã€‚NIFæ˜¯ç”¨Cç¼–å†™çš„ä»£ç ç‰‡æ®µï¼Œè¢«ç¼–è¯‘ä¸ºåº“å¹¶åœ¨ä¸BEAMç›¸åŒçš„å†…å­˜ç©ºé—´ä¸­è¿è¡Œä»¥æé«˜é€Ÿåº¦ã€‚NIFçš„é—®é¢˜åœ¨äºå®ƒä»¬ä¸æ˜¯æŠ¢å å¼çš„ï¼Œå¹¶ä¸”ä¼šå½±å“è°ƒåº¦ç¨‹åºã€‚åœ¨æœ€æ–°çš„BEAMç‰ˆæœ¬ä¸­ï¼Œæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå³è„è°ƒåº¦ç¨‹åºï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶NIFã€‚è‚®è„çš„è°ƒåº¦ç¨‹åºæ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œçš„å•ç‹¬çš„è°ƒåº¦ç¨‹åºï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘NIFå¯¹ç³»ç»Ÿé€ æˆçš„ä¸­æ–­ã€‚è„è¿™ä¸ªè¯æ˜¯æŒ‡è¿™äº›è°ƒåº¦ç¨‹åºè¿è¡Œçš„ä»£ç çš„æ€§è´¨ã€‚\nåƒåœ¾æ”¶é›†å™¨ å½“ä»Šï¼Œç°ä»£çš„é«˜çº§ç¼–ç¨‹è¯­è¨€å¤§å¤šä½¿ç”¨åƒåœ¾å›æ”¶å™¨è¿›è¡Œå†…å­˜ç®¡ç†ã€‚BEAMè¯­è¨€ä¹Ÿä¸ä¾‹å¤–ã€‚å½“æ‚¨è¦ç¼–å†™é«˜çº§å¹¶å‘ä»£ç æ—¶ï¼Œä¿¡ä»»è™šæ‹Ÿæœºæ¥å¤„ç†èµ„æºå’Œç®¡ç†å†…å­˜éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºè¿™å¯ä»¥ç®€åŒ–ä»»åŠ¡ã€‚å½’åŠŸäºåŸºäºä¸å¯å˜çŠ¶æ€çš„å†…å­˜æ¨¡å‹ï¼Œåƒåœ¾æ”¶é›†å™¨çš„åŸºç¡€å®ç°éå¸¸ç®€å•æœ‰æ•ˆã€‚æ•°æ®è¢«å¤åˆ¶è€Œä¸æ˜¯çªå˜ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸å…±äº«å†…å­˜è¿™ä¸€äº‹å®æ¶ˆé™¤äº†ä»»ä½•è¿›ç¨‹çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå› æ­¤ä¸éœ€è¦ç®¡ç†å®ƒä»¬ã€‚\nBEAMçš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰åœ¨æ¯ä¸ªè¿›ç¨‹çš„åŸºç¡€ä¸Šè¿è¡Œåƒåœ¾å›æ”¶ï¼Œè€Œä¸ä¼šå½±å“åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„å…¶ä»–è¿›ç¨‹ã€‚ç»“æœï¼ŒErlangä¸­çš„åƒåœ¾æ”¶é›†ä¸ä¼šâ€œstop-the-worldâ€ã€‚å®ƒå¯ä»¥é˜²æ­¢å¤„ç†å»¶è¿Ÿé«˜å³°ï¼Œå› ä¸ºVMä¸ä¼šä»æ•´ä½“ä¸Šåœæ­¢â€”â€”ä»…ç‰¹å®šè¿›ç¨‹åœæ­¢ï¼Œå¹¶ä¸”ç»ä¸ä¼šåŒæ—¶åœæ­¢æ‰€æœ‰è¿›ç¨‹ã€‚å®é™…ä¸Šï¼Œè¿™åªæ˜¯æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”è¢«è§†ä¸ºå¦ä¸€ç§reductionã€‚åƒåœ¾æ”¶é›†å™¨æ”¶é›†è¿‡ç¨‹å°†è¿‡ç¨‹æš‚åœå¾ˆçŸ­çš„æ—¶é—´é—´éš”ï¼Œé€šå¸¸æ˜¯å¾®ç§’ã€‚ä»£ä»·æ˜¯ï¼Œå°†æœ‰è®¸å¤šå°çš„çˆ†å‘ï¼ˆburstsï¼‰ï¼Œä»…åœ¨è¿›ç¨‹éœ€è¦æ›´å¤šå†…å­˜æ—¶æ‰è§¦å‘ã€‚å•ä¸ªè¿›ç¨‹é€šå¸¸ä¸ä¼šåˆ†é…å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œé€šè¿‡åœ¨ç»ˆæ­¢æ—¶ç«‹å³é‡Šæ”¾æ‰€æœ‰åˆ†é…çš„å†…å­˜ï¼Œè¿›ä¸€æ­¥é™ä½äº†å½±å“ã€‚JVMçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å…·å¤‡åˆ‡æ¢åƒåœ¾æ”¶é›†å™¨çš„èƒ½åŠ›ï¼Œå› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨å•†ç”¨GCï¼Œè¿˜å¯ä»¥åœ¨JVMä¸­å®ç°ä¸é—´æ–­çš„GCã€‚\nLukas Larssonåœ¨ä¸€ç¯‡å‡ºè‰²çš„åšå®¢æ–‡ç« ä¸­è®¨è®ºäº†åƒåœ¾æ”¶é›†å™¨çš„åŠŸèƒ½ã€‚æœ‰è®¸å¤šå¤æ‚çš„ç»†èŠ‚ï¼Œä½†å·²å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ä»¥æœ‰æ•ˆåœ°å¤„ç†ä¸å¯å˜æ•°æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿›ç¨‹åœ¨å †æ ˆå’Œå †ä¹‹é—´åˆ†é…äº†æ•°æ®ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨çŸ­æš‚çš„è¿‡ç¨‹ä¸­å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œã€‚\nè¿™ä¸ªä¸»é¢˜ä¸Šç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜æ˜¯BEAMä½¿ç”¨å¤šå°‘å†…å­˜ã€‚è™šæ‹Ÿæœºåœ¨åå°åˆ†é…äº†å¤§å—å†…å­˜ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰åˆ†é…å™¨æ¥æœ‰æ•ˆåœ°å­˜å‚¨æ•°æ®å¹¶æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚è¿™æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„æ•ˆæœï¼š 1ï¼‰åœ¨ä¸éœ€è¦ç©ºé—´ä¹‹åï¼Œå·²ç”¨å†…å­˜é€æ¸å‡å°‘ 2ï¼‰é‡æ–°åˆ†é…å¤§é‡æ•°æ®å¯èƒ½æ„å‘³ç€å°†å½“å‰å·¥ä½œå†…å­˜åŠ å€ã€‚\nå¦‚æœç¡®å®éœ€è¦ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´åˆ†é…å™¨ç­–ç•¥æ¥å‡è½»ç¬¬ä¸€ä¸ªå½±å“ã€‚å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°ä¸åŒç±»å‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåˆ™ç¬¬äºŒä¸ªæ˜“äºç›‘è§†å’Œè®¡åˆ’ã€‚ï¼ˆWombatOAMå°±æ˜¯è¿™æ ·ä¸€ç§æä¾›å¼€ç®±å³ç”¨çš„ç³»ç»ŸæŒ‡æ ‡çš„ç›‘è§†å·¥å…·ã€‚ï¼‰\nçƒ­ä»£ç åŠ è½½ çƒ­ä»£ç åŠ è½½å¯èƒ½æ˜¯BEAMå¼•ç”¨æœ€å¤šçš„ç‹¬ç‰¹åŠŸèƒ½ã€‚çƒ­ä»£ç åŠ è½½æ„å‘³ç€å¯ä»¥é€šè¿‡æ›´æ”¹ç³»ç»Ÿä¸­çš„å¯è¿è¡Œä»£ç æ¥æ›´æ–°åº”ç”¨ç¨‹åºé€»è¾‘ï¼ŒåŒæ—¶ä¿ç•™å†…éƒ¨æµç¨‹çŠ¶æ€ã€‚è¿™æ˜¯é€šè¿‡æ›¿æ¢å·²åŠ è½½çš„BEAMæ–‡ä»¶å¹¶æŒ‡ç¤ºVMæ›¿æ¢æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­çš„ä»£ç å¼•ç”¨æ¥å®ç°çš„ã€‚\nå¯¹äºç”µä¿¡åŸºç¡€æ¶æ„æ— éœ€åœæœºä»£ç å‡çº§è€Œè¨€ï¼Œè¿™æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„åŠŸèƒ½ï¼Œè¢«è£å‡çš„ç¡¬ä»¶å¯ç”¨äºå¤„ç†é«˜å³°ã€‚å¦‚ä»Šï¼Œåœ¨å®¹å™¨åŒ–æ—¶ä»£ï¼Œå…¶ä»–æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°äº§çº¿çš„æ›´æ–°ã€‚ä»æœªä½¿ç”¨è¿‡å®ƒçš„äººä¼šè®¤ä¸ºå®ƒæ˜¯ä¸é‡è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨å¼€å‘å·¥ä½œæµç¨‹ä¸­ä»ç„¶æœ‰ç”¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ›¿æ¢éƒ¨åˆ†ä»£ç æ¥åŠ å¿«è¿­ä»£é€Ÿåº¦ï¼Œè€Œä¸å¿…é‡æ–°å¯åŠ¨ç³»ç»Ÿæ¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚å³ä½¿è¯¥åº”ç”¨ç¨‹åºå¹¶éè®¾è®¡ä¸ºå¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå‡çº§ï¼Œä¹Ÿå¯ä»¥å‡å°‘é‡æ–°ç¼–è¯‘å’Œé‡æ–°éƒ¨ç½²æ‰€éœ€çš„æ—¶é—´ã€‚\nä½•æ—¶ä¸ä½¿ç”¨BEAM æ­£ç¡®çš„å·¥å…·éå¸¸é‡è¦ã€‚æ‚¨éœ€è¦ä¸€ä¸ªé€Ÿåº¦æå¿«çš„ç³»ç»Ÿï¼Œä½†ä¸å…³å¿ƒå¹¶å‘æ€§å—ï¼Ÿå¹¶è¡Œå¤„ç†ä¸€äº›äº‹ä»¶ï¼Œå¹¶ä¸”å¿…é¡»å¿«é€Ÿå¤„ç†å®ƒä»¬ï¼Ÿæ˜¯å¦éœ€è¦è®¡ç®—å›¾å½¢ï¼Œäººå·¥æ™ºèƒ½æˆ–åˆ†ææ•°æ®ï¼Ÿæ²¿C ++ï¼ŒPythonæˆ–Javaè·¯çº¿èµ°ã€‚ç”µä¿¡åŸºç¡€è®¾æ–½ä¸éœ€è¦å¿«é€Ÿè¿è¡Œï¼Œå› æ­¤é€Ÿåº¦ä»æ¥éƒ½ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹ã€‚åœ¨åŠ¨æ€ç±»å‹çš„è¾…åŠ©ä¸‹ï¼Œå®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œæ‰€æœ‰ç±»å‹æ£€æŸ¥ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘å™¨æ—¶é—´ä¼˜åŒ–å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚å› æ­¤ï¼Œæ•°å­—è¿ç®—æœ€å¥½ç•™ç»™JVMï¼ŒGoæˆ–å…¶ä»–ç¼–è¯‘æˆæœ¬åœ°è¯­è¨€çš„è¯­è¨€ä½¿ç”¨ã€‚æ¯«ä¸å¥‡æ€ªï¼Œåœ¨JVMä¸Šè¿è¡Œçš„Erlangç‰ˆæœ¬Erjangä¸Šçš„æµ®ç‚¹è¿ç®—æ¯”BEAMå¿«5000ï¼…ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°BEAMå¤§æ”¾å¼‚å½©çš„åœ°æ–¹æ˜¯åˆ©ç”¨å®ƒçš„å¹¶å‘æ¥å®‰æ’æ•°å­—è¿ç®—ï¼Œå°†åˆ†æå¤–åŒ…ç»™Cï¼ŒJuliaï¼ŒPythonæˆ–Rustã€‚æ‚¨å¯ä»¥åœ¨BEAMå¤–éƒ¨åšmapï¼Œè€Œåœ¨BEAMå†…éƒ¨åšreduce(è¯‘è€…æ³¨ï¼šmap-reduceæ€æƒ³)ã€‚\nå£å¤´ç¦…æ€»æ˜¯å¾ˆå¿«ã€‚äººç±»æ„ŸçŸ¥åˆºæ¿€ï¼ˆäº‹ä»¶ï¼‰å¹¶åœ¨å¤§è„‘ä¸­è¿›è¡Œå¤„ç†éœ€è¦å‡ ç™¾æ¯«ç§’ï¼Œè¿™æ„å‘³ç€å¯¹äºè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œå¾®ç§’æˆ–çº³ç§’çš„å“åº”æ—¶é—´å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨ä¹Ÿä¸ä¼šå°†BEAMç”¨äºå¾®æ§åˆ¶å™¨ï¼Œè¿™å¤ªæµªè´¹èµ„æºäº†ã€‚ä½†æ˜¯å¯¹äºå…·æœ‰æ›´å¤šå¤„ç†èƒ½åŠ›çš„åµŒå…¥å¼ç³»ç»Ÿï¼ˆå¤šæ ¸å·²æˆä¸ºå¸¸æ€ï¼‰ï¼Œæ‚¨éœ€è¦å¹¶å‘æ€§ï¼Œè€ŒBEAMä»¤äººçœ¼å‰ä¸€äº®ã€‚ä¸Šä¸–çºª90å¹´ä»£ï¼Œæˆ‘ä»¬å®ç°äº†ç”µè¯äº¤æ¢æœºï¼Œä»¥å¤„ç†è¿è¡Œåœ¨å…·æœ‰16MBå†…å­˜çš„åµŒå…¥å¼æ¿ä¸Šçš„æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚RaspberryPiéƒ½æœ‰å¤šå°‘å†…å­˜äº†ï¼Ÿè¿˜æœ‰ï¼Œç¡¬å®æ—¶ç³»ç»Ÿï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›BEAMç®¡ç†æ‚¨çš„å®‰å…¨æ°”å›Šæ§åˆ¶ç³»ç»Ÿã€‚ä½ éœ€è¦ç¡¬ä¿è¯ ä»…ä»…æ˜¯ç¡¬å®æ—¶æ“ä½œç³»ç»Ÿï¼Œæ²¡æœ‰åƒåœ¾æ”¶é›†æˆ–å¼‚å¸¸çš„è¯­è¨€ã€‚åœ¨è¯¸å¦‚GRiSPä¹‹ç±»çš„è£¸æœºä¸Šè¿è¡Œçš„Erlang VMçš„å®ç°å°†ä¸ºæ‚¨æä¾›ç±»ä¼¼çš„ä¿è¯ã€‚\nç»“è®º ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å®Œæˆå·¥ä½œã€‚å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªè½¯å®æ—¶ç³»ç»Ÿï¼Œè€Œè¯¥ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿç«‹å³æ‰©å±•å¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ï¼Œå¹¶ä¸”æ— éœ€é‡æ–°å‘æ˜è½®å­å°±å¯ä»¥åšåˆ°ï¼Œé‚£ä¹ˆBEAMæ˜¯æ‚¨æ­£åœ¨å¯»æ‰¾çš„ç»è¿‡éªŒè¯çš„æŠ€æœ¯ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªé»‘åŒ£å­ã€‚ä¸çŸ¥é“å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºé©¾é©¶æ³•æ‹‰åˆ©ï¼Œæ— æ³•è·å¾—æœ€ä½³æ€§èƒ½æˆ–æ— æ³•ç†è§£å¥‡æ€ªå£°éŸ³æ¥è‡ªé©¬è¾¾çš„å“ªä¸ªéƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åº”è¯¥æ›´å¤šåœ°äº†è§£BEAMï¼Œäº†è§£å…¶å†…éƒ¨ç»“æ„å¹¶å‡†å¤‡å¯¹å…¶è¿›è¡Œå¾®è°ƒå’Œä¿®å¤çš„åŸå› ã€‚å¯¹äºåœ¨å®é™…ä»»åŠ¡ä¸­ä½¿ç”¨Erlangå’ŒElixirçš„äººï¼ˆè¯‘è€…æ³¨ï¼šin anger çš„æ„æ€æ˜¯to do or use something in a real situationï¼‰ï¼Œæˆ‘ä»¬å¼€è®¾äº†ä¸€å¤©çš„è®²å¸ˆæŒ‡å¯¼è¯¾ç¨‹ï¼Œè¯¥è¯¾ç¨‹é€šä¿—æ˜“æ‡‚å¹¶è§£é‡Šæ‚¨æ‰€çœ‹åˆ°çš„å¾ˆå¤šå†…å®¹ï¼ŒåŒæ—¶ä¸ºæ‚¨å‡†å¤‡å¤§è§„æ¨¡å¤„ç†å¤§è§„æ¨¡å¹¶å‘åšå¥½å‡†å¤‡ã€‚åœ¨è¿™é‡Œäº†è§£æ›´å¤šã€‚æˆ‘ä»¬ä¹Ÿæ¨èErik Stenmanæ’°å†™çš„å…³äºBEAMçš„ä¹¦å’ŒDmytro Lytovchenkoçš„æ–‡ç« é›†â€”â€”BEAM Wisdomsã€‚\n","id":51,"section":"posts","summary":"ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah ä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°","tags":["erlang"],"title":"[è¯‘]BEAM vs JVM","uri":"https://lvsq.net/2020/05/beam-vs-jvm/","year":"2020"},{"content":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º\u0026quot;abcx\u0026quot;ï¼Œé•¿åº¦4ï¼Œè¯¦ç»†æè¿°å¯è®¿é—®https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/\n(let* ( [s \u0026#34;abbabcx\u0026#34;] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) å®ç°çš„æ€è·¯ä¸ºï¼š\nç”±äºå­—ç¬¦å¯ä»¥æœ‰ASCIIç è¡¨ç¤ºï¼Œæ•…å¯ä»¥ç”¨ä¸€ä¸ªé•¿åº¦ä¸º128çš„å‘é‡vecæ¥ä¿å­˜æ¯ä¸ªå­—ç¬¦åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æœ€åä¸€æ¬¡çš„ä½ç½®ã€‚ç»´æŠ¤ä¸€ä¸ªå˜é‡dæ¥è®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦çš„èµ·å§‹ä½ç½®ã€‚ å¦‚æœï¼š\nåˆ¤æ–­æŸå­—ç¬¦æ˜¯å¦é‡å¤ï¼š 1.1 æŸå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œæ‰§è¡Œç¬¬2æ­¥ 1.2 æŸå­—ç¬¦éç¬¬ä¸€æ¬¡å‡ºç°ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼Œåœ¨dä¹‹åï¼Œåˆ™å°†dè®¾ç½®ä¸ºè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ã€‚ç”±äºä¹‹å‰çš„æœ€å¤§é•¿åº¦å·²ç»ç”±ansä¿å­˜ï¼Œæ‰€ä»¥åªéœ€è¦è®¡ç®—å‰©ä¸‹çš„å­ä¸²çš„é•¿åº¦èƒ½ä¸èƒ½å¤§äºansï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆdè®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å°±å¥½äº† è®¡ç®—å½“å‰ä½ç½®å’Œdçš„é•¿åº¦len ä¿å­˜å…¶ä½ç½®åˆ°vec å¦‚æœlenå¤§äºansï¼Œæ”¹å˜ansä¸ºlen è¿™ç§å®ç°åªéœ€éå†ä¸€éå°±å¯ä»¥è®¡ç®—å‡ºç»“æœï¼Œæ€§èƒ½éå¸¸æ£’ã€‚å½“ç„¶æš´åŠ›è®¡ç®—æˆ–è€…æ»‘åŠ¨çª—å£ä¹Ÿå¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼Œåªæ˜¯éœ€è¦å¤šæ¬¡éå†ï¼Œæ€§èƒ½æ¯”ä¸ä¸Šã€‚\næ¦‚è¦åˆ†æ ä¸Šæ–‡è¯´åˆ°æ€§èƒ½é—®é¢˜ï¼Œæ‹¿ç‚¹æ•°æ®å‡ºæ¥è¯æ˜ä¸€ä¸‹å§ã€‚\nå°†ä¸Šé¢çš„ä»£ç ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œä½œä¸ºä¸€ä¸ªdefinitionï¼Œå¹¶ä¿å­˜åœ¨longest_substr.ssæ–‡ä»¶ä¸­ï¼Œ\n(define longest-substr (lambda (str) (let* ( [s str] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) ) ) Chez Schemeæä¾›äº†ä¸€ä¸ªæ¦‚è¦åˆ†æå·¥å…·ï¼Œéå¸¸å¥½ç”¨ï¼Œæ¥è¯•ç”¨ä¸€ä¸‹ï¼š ç”Ÿæˆçš„htmlå¯ä»¥éå¸¸ç›´è§‚çš„çœ‹åˆ°è¯¥å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ å­—ç¬¦ä¸²è¶Šé•¿ï¼Œæ‰§è¡Œæ¬¡æ•°è¶Šå¤šï¼Œæ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘å‘¢ï¼Ÿé€‰ä¸€ä¸ªä¸Šé¢ä¾‹å­ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²æ¥çœ‹çœ‹ï¼š\n\u0026gt; (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) no collections 0.000003672s elapsed cpu time 0.000002000s elapsed real time 1792 bytes allocated 12 \u0026gt; æ¶ˆè€—çš„CPUæ—¶é—´0.000003672sï¼Œå¯ä»¥è¯´éå¸¸çŸ­äº†ï¼Œä¸”åˆ†é…çš„å†…å­˜ä»…ä»…1792ä¸ªå­—èŠ‚ã€‚è¶…ä¹å¯»å¸¸çš„æ€§èƒ½ï¼Œæˆ‘æƒ³åº”è¯¥æœ‰ä¸¤ä¸ªæ–¹é¢åŸå› ï¼š\nç®—æ³• Scheme å’Œ Chez Scheme ","id":52,"section":"posts","summary":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º","tags":["scheme"],"title":"æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²-Schemeå®ç°","uri":"https://lvsq.net/2020/03/longest-substr/","year":"2020"},{"content":"\nä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿åå‡½æ•°å¼ç¼–ç¨‹è§„åˆ™ï¼Œå°±å¯ä»¥å¿«é€Ÿè°ƒè¯•åº”ç”¨ç¨‹åºã€‚å½“å‡½æ•°è¢«éš”ç¦»æ—¶ï¼Œæ‚¨ä¸å¿…å¤„ç†å½±å“è¾“å‡ºçš„éšè—çŠ¶æ€çš„æ›´æ”¹ã€‚\nè½¯ä»¶å·¥ç¨‹å¸ˆå…¼ä½œè€…Eric Elliotå®šä¹‰äº†ä»¥ä¸‹å‡½æ•°ç¼–ç¨‹ã€‚\nå‡½æ•°å¼ç¼–ç¨‹æ˜¯é€šè¿‡ç»„åˆçº¯å‡½æ•°ï¼Œé¿å…å…±äº«çŠ¶æ€ï¼Œå¯å˜æ•°æ®å’Œå‰¯ä½œç”¨æ¥æ„å»ºè½¯ä»¶çš„è¿‡ç¨‹ã€‚å‡½æ•°å¼ç¼–ç¨‹æ˜¯å£°æ˜æ€§çš„ï¼Œè€Œä¸æ˜¯å‘½ä»¤æ€§çš„ï¼Œåº”ç”¨ç¨‹åºçŠ¶æ€é€šè¿‡çº¯å‡½æ•°æµåŠ¨ã€‚ä¸é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ç›¸åï¼Œåè€…é€šå¸¸å°†åº”ç”¨ç¨‹åºçŠ¶æ€ä¸å¯¹è±¡ä¸­çš„æ–¹æ³•å…±äº«å¹¶æ”¾ç½®åœ¨å¯¹è±¡ä¸­ã€‚\næˆ‘å°†æ›´è¿›ä¸€æ­¥ï¼šå‡½æ•°å¼ç¼–ç¨‹ï¼ˆå¦‚é¢å‘å¯¹è±¡å’Œè¿‡ç¨‹å¼ç¼–ç¨‹ï¼‰ä»£è¡¨ç€èŒƒå¼çš„è½¬å˜ã€‚å®ƒåœ¨ç¼–å†™ä»£ç æ—¶é‡‡ç”¨äº†ç‹¬ç‰¹çš„æ€ç»´æ–¹å¼ï¼Œå¹¶å¼•å…¥äº†ä¸€å¥—å…¨æ–°çš„è§„åˆ™ã€‚\n4ä¸ªé‡è¦æ¦‚å¿µ è¦å®Œå…¨æŒæ¡å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¿…é¡»é¦–å…ˆäº†è§£ä»¥ä¸‹ç›¸å…³æ¦‚å¿µã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å‰¯ä½œç”¨ å‡½æ•°æ„æˆ å…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å¦‚æœç»™çº¯å‡½æ•°æä¾›ç›¸åŒçš„è¾“å…¥ï¼Œåˆ™å®ƒæ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„è¾“å‡ºã€‚æ­¤å±æ€§ä¹Ÿç§°ä¸ºå¹‚ç­‰ã€‚å¹‚ç­‰æ„å‘³ç€å‡½æ•°åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸è°ƒç”¨æ¬¡æ•°æ— å…³ã€‚\nå‰¯ä½œç”¨ çº¯å‡½æ•°ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„å‡½æ•°æ— æ³•ä¸å¤–éƒ¨ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚\nä¾‹å¦‚ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°†APIè°ƒç”¨è§†ä¸ºå‰¯ä½œç”¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºAPIè°ƒç”¨è¢«è®¤ä¸ºæ˜¯ä¸å—æ‚¨ç›´æ¥æ§åˆ¶çš„å¤–éƒ¨ç¯å¢ƒã€‚ä¸€ä¸ªAPIå¯èƒ½æœ‰å‡ ä¸ªä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œä¾‹å¦‚è¶…æ—¶æˆ–å¤±è´¥ï¼Œæˆ–è€…ç”šè‡³å¯èƒ½è¿”å›æ„å¤–çš„å€¼ã€‚å®ƒä¸é€‚åˆçº¯å‡½æ•°çš„å®šä¹‰ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨APIæ—¶éƒ½éœ€è¦ä¸€è‡´çš„ç»“æœã€‚\nå…¶ä»–å¸¸è§çš„å‰¯ä½œç”¨åŒ…æ‹¬ï¼š\næ•°æ®å˜åŒ– DOMæ“ä½œ è¯·æ±‚æœ‰å†²çªçš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰æ—¶é—´time.Now() å‡½æ•°æ„æˆ å‡½æ•°æ„æˆçš„åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šå°†ä¸¤ä¸ªçº¯å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ä»¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚è¿™æ„å‘³ç€ä¸ºç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡ºçš„æ¦‚å¿µåœ¨è¿™é‡Œä»ç„¶é€‚ç”¨ã€‚å› æ­¤ï¼Œä»ç®€å•çš„çº¯å‡½æ•°å¼€å§‹åˆ›å»ºæ›´é«˜çº§çš„å‡½æ•°å¾ˆé‡è¦ã€‚\nå…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯åˆ›å»ºä¸ä¿æŒçŠ¶æ€çš„å‡½æ•°ã€‚å…±äº«çŠ¶æ€å°¤å…¶ä¼šåœ¨çº¯å‡½æ•°ä¸­å¼•å…¥å‰¯ä½œç”¨æˆ–å¯å˜æ€§é—®é¢˜ï¼Œä½¿å®ƒä»¬å˜å¾—ä¸çº¯ç²¹ã€‚\nä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰çŠ¶æ€éƒ½ä¸å¥½ã€‚æœ‰æ—¶ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªçŠ¶æ€æ‰èƒ½è§£å†³ç‰¹å®šçš„è½¯ä»¶é—®é¢˜ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿çŠ¶æ€å¯è§å’Œæ˜¾å¼ï¼Œä»¥æ¶ˆé™¤ä»»ä½•å‰¯ä½œç”¨ã€‚ç¨‹åºä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ä»çº¯å‡½æ•°ä¸­æ´¾ç”Ÿæ–°æ•°æ®ã€‚è¿™æ ·ï¼Œå°±ä¸éœ€è¦å¯èƒ½å¼•èµ·å‰¯ä½œç”¨çš„å¯å˜æ•°æ®ã€‚\nç°åœ¨æˆ‘ä»¬å·²ç»æ¶µç›–äº†åŸºç¡€ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€äº›åœ¨Goä¸­ç¼–å†™åŠŸèƒ½ä»£ç æ—¶è¦éµå¾ªçš„è§„åˆ™ã€‚\nåŠŸèƒ½ç¼–ç¨‹è§„åˆ™ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§èŒƒä¾‹ã€‚å› æ­¤ï¼Œå¾ˆéš¾ä¸ºè¿™ç§ç¼–ç¨‹é£æ ¼å®šä¹‰ç¡®åˆ‡çš„è§„åˆ™ã€‚ä¹Ÿä¸ä¸€å®šæ€»æ˜¯éµå¾ªè¿™äº›è§„åˆ™ã€‚æœ‰æ—¶ï¼Œæ‚¨ç¡®å®éœ€è¦ä¾èµ–æ‹¥æœ‰çŠ¶æ€çš„åŠŸèƒ½ã€‚\nä½†æ˜¯ï¼Œä¸ºäº†å°½å¯èƒ½ä¸¥æ ¼åœ°éµå¾ªå‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ï¼Œæˆ‘å»ºè®®åšæŒä»¥ä¸‹å‡†åˆ™ã€‚\næ²¡æœ‰å¯å˜æ•°æ®ä»¥é¿å…å‰¯ä½œç”¨ æ— çŠ¶æ€ï¼ˆæˆ–è€…éšå¼çŠ¶æ€ï¼Œä¾‹å¦‚å¾ªç¯è®¡æ•°å™¨ï¼‰ ç»™å˜é‡èµ‹å€¼åè¯·å‹¿ä¿®æ”¹ é¿å…å‰¯ä½œç”¨ï¼Œä¾‹å¦‚APIè°ƒç”¨ æˆ‘ä»¬åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªå¥½çš„â€œå‰¯ä½œç”¨â€æ˜¯å¼ºå¤§çš„æ¨¡å—åŒ–ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸æ˜¯è‡ªä¸Šè€Œä¸‹åœ°è¿›è¡Œè½¯ä»¶å·¥ç¨‹ï¼Œè€Œæ˜¯é¼“åŠ±è‡ªä¸‹è€Œä¸Šçš„ç¼–ç¨‹é£æ ¼ã€‚é¦–å…ˆå®šä¹‰æ¨¡å—ï¼ŒæŠŠå°†æ¥å¯èƒ½ä½¿ç”¨çš„åŒç±»çº¯å‡½æ•°ç»„åˆèµ·æ¥ã€‚æ¥ä¸‹æ¥ï¼Œå¼€å§‹ç¼–å†™é‚£äº›å°çš„ï¼Œæ— çŠ¶æ€çš„ç‹¬ç«‹å‡½æ•°ï¼Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚\nå®è´¨ä¸Šæˆ‘ä»¬æ˜¯åœ¨åˆ›å»ºé»‘åŒ£å­ã€‚ç¨åï¼Œæˆ‘ä»¬å°†æŒ‰ç…§è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼å°†å„ä¸ªå—æ†ç»‘åœ¨ä¸€èµ·ã€‚è¿™ä½¿æ‚¨å¯ä»¥å»ºç«‹å¼ºå¤§çš„æµ‹è¯•åŸºç¡€ï¼Œå°¤å…¶æ˜¯å¯ä»¥éªŒè¯çº¯å‡½æ•°æ­£ç¡®æ€§çš„å•å…ƒæµ‹è¯•ã€‚\nä¸€æ—¦æ‚¨å¯ä»¥ä¿¡ä»»æ‚¨çš„æ¨¡å—ï¼Œå°±å¯ä»¥å°†æ¨¡å—æ†ç»‘åœ¨ä¸€èµ·äº†ã€‚å¼€å‘è¿‡ç¨‹ä¸­çš„è¿™ä¸€æ­¥è¿˜æ¶‰åŠç¼–å†™é›†æˆæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä¸¤ä¸ªç»„ä»¶çš„æ­£ç¡®é›†æˆã€‚\n5ä¸ªç¤ºä¾‹ ä¸ºäº†æ›´å…¨é¢åœ°æè¿°Goå‡½æ•°ç¼–ç¨‹çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬æ¢ç´¢äº”ä¸ªåŸºæœ¬ç¤ºä¾‹ã€‚\næ›´æ–°å­—ç¬¦ä¸² è¿™æ˜¯çº¯å‡½æ•°çš„æœ€ç®€å•ç¤ºä¾‹ã€‚é€šå¸¸ï¼Œå½“æ‚¨è¦æ›´æ–°å­—ç¬¦ä¸²æ—¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\nnameï¼š= \u0026#34;first name\u0026#34; nameï¼š= name + \u0026#34;last name\u0026#34; ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„è§„åˆ™ï¼Œå› ä¸ºä¸èƒ½åœ¨å‡½æ•°å†…ä¿®æ”¹å˜é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥é‡å†™ä»£ç æ®µï¼Œä»¥ä¾¿æ¯ä¸ªå€¼éƒ½å…·æœ‰è‡ªå·±çš„å˜é‡ã€‚\nä¸‹é¢çš„ä»£ç æ®µä¸­çš„ä»£ç æ›´å…·å¯è¯»æ€§ã€‚\nfirstname := \u0026#34;first\u0026#34; lastname := \u0026#34;last\u0026#34; fullname := firstname + \u0026#34; \u0026#34; + lastname åœ¨æŸ¥çœ‹éå‡½æ•°å¼ä»£ç æ®µæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æµè§ˆç¨‹åºä»¥ç¡®å®šæœ€æ–°çŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰¾åˆ°nameå˜é‡çš„ç»“æœå€¼ã€‚è¿™éœ€è¦æ›´å¤šçš„ç²¾åŠ›å’Œæ—¶é—´æ¥äº†è§£è¯¥åŠŸèƒ½çš„ä½œç”¨ã€‚\né¿å…æ›´æ–°æ•°ç»„ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿ç”¨ä¸å˜æ•°æ®é€šè¿‡çº¯å‡½æ•°å¾—å‡ºæ–°çš„ä¸å˜æ•°æ®çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡éœ€è¦æ›´æ–°æ•°ç»„æ—¶åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„æ¥å®ç°\nåœ¨éå‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæ›´æ–°æ•°ç»„å¦‚ä¸‹ï¼š\nnames := [3]string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} // Add Lucas to the array names[2] = \u0026#34;Lucas\u0026#34; è®©æˆ‘ä»¬æ ¹æ®åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹è¿›è¡Œå°è¯•ã€‚\nnames := []string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} allNames := append(names, \u0026#34;Lucas\u0026#34;) é¿å…æ›´æ–°map è¿™æ˜¯å‡½æ•°ç¼–ç¨‹çš„æç«¯ç¤ºä¾‹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰å­—ç¬¦ä¸²ç±»å‹çš„é”®å’Œæ•´æ•°ç±»å‹çš„å€¼çš„mapã€‚è¯¥mapåŒ…å«æˆ‘ä»¬ä»ç„¶ç•™åœ¨å®¶ä¸­çš„æ°´æœæ•°é‡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆšè´­ä¹°äº†è‹¹æœï¼Œå¹¶å¸Œæœ›å°†å…¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} // Buy five apples fruits[\u0026#34;apples\u0026#34;] = 5 æˆ‘ä»¬å¯ä»¥åœ¨åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹ä¸‹å®Œæˆç›¸åŒçš„åŠŸèƒ½ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} newFruits := map[string]int{\u0026#34;apples\u0026#34;: 5} allFruits := make(map[string]int, len(fruits) + len(newFruits)) for k, v := range fruits { allFruits[k] = v } for k, v := range newFruits { allFruits[k] = v } ç”±äºæˆ‘ä»¬ä¸æƒ³ä¿®æ”¹åŸå§‹mapï¼Œå› æ­¤ä»£ç ä¼šéå†ä¸¤ä¸ªmapï¼Œå¹¶å°†å€¼æ·»åŠ åˆ°æ–°mapã€‚è¿™æ ·ï¼Œæ•°æ®ä¿æŒä¸å˜ã€‚\næ­£å¦‚æ‚¨å¯èƒ½é€šè¿‡ä»£ç çš„é•¿åº¦å¯ä»¥çœ‹å‡ºçš„é‚£æ ·ï¼Œæ­¤ä»£ç æ®µçš„æ€§èƒ½æ¯”å¯¹mapè¿›è¡Œç®€å•çš„å¯å˜æ›´æ–°è¦å·®å¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬è¦éå†ä¸¤ä¸ªmapã€‚è¿™æ˜¯æ‚¨ä¸ºä»£ç æ€§èƒ½äº¤æ¢æ›´å¥½çš„ä»£ç è´¨é‡çš„æ—¶é—´ã€‚\né«˜é˜¶å‡½æ•°å’ŒæŸ¯é‡ŒåŒ– å¤§å¤šæ•°ç¨‹åºå‘˜åœ¨ä»–ä»¬çš„ä»£ç ä¸­é€šå¸¸ä¸ä¼šä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼Œä½†æ˜¯åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æŸ¯é‡ŒåŒ–å¾ˆæ–¹ä¾¿ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå°†ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ã€‚å°½ç®¡è¿™å·²ç»æ˜¯ä¸€ä¸ªçº¯ç²¹çš„åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¯¦ç»†è¯´æ˜è¯¥ç¤ºä¾‹ï¼Œä»¥å±•ç¤ºå¦‚ä½•é€šè¿‡curringåˆ›å»ºæ›´é«˜çº§çš„åŠŸèƒ½ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ã€‚æ¥ä¸‹æ¥ï¼Œè¯¥å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºé—­åŒ…ã€‚å› ä¸ºè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥å®ƒå°†è®°ä½å¤–éƒ¨èŒƒå›´ï¼Œè¯¥èŒƒå›´åŒ…å«åˆå§‹è¾“å…¥å‚æ•°ã€‚\nfunc add ï¼ˆx intï¼‰func ï¼ˆy intï¼‰int { return funcï¼ˆy intï¼‰int { return x + y } } ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•curryingå¹¶åˆ›å»ºæ›´å¤šé«˜çº§çº¯å‡½æ•°ã€‚\nfunc main() { // Create more variations add10 := add(10) add20 := add(20) // Currying fmt.Println(add10(1)) // 11 fmt.Println(add20(1)) // 21 } è¿™ç§æ–¹æ³•åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¾ˆå¸¸è§ï¼Œå°½ç®¡æ‚¨é€šå¸¸ä¸ä¼šåœ¨èŒƒå¼ä¹‹å¤–çœ‹åˆ°å®ƒã€‚\né€’å½’ é€’å½’æ˜¯ä¸€ç§é€šå¸¸ç”¨äºè§„é¿å¾ªç¯ä½¿ç”¨çš„è½¯ä»¶æ¨¡å¼ã€‚å› ä¸ºå¾ªç¯å§‹ç»ˆä¿æŒå†…éƒ¨çŠ¶æ€ä»¥æ˜ç¡®å¾ªç¯åœ¨å“ªä¸€è½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ä¸‹ä½¿ç”¨å¾ªç¯ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µå°è¯•è®¡ç®—æ•°å­—çš„é˜¶ä¹˜ã€‚é˜¶ä¹˜æ˜¯ä¸€ä¸ªæ•´æ•°ä¸å…¶ä¸‹æ‰€æœ‰æ•´æ•°çš„ä¹˜ç§¯ã€‚å› æ­¤ï¼Œé˜¶ä¹˜4ç­‰äº24ï¼ˆ= 4 * 3 * 2 * 1ï¼‰ã€‚\né€šå¸¸ï¼Œæ‚¨å°†ä¸ºæ­¤ä½¿ç”¨å¾ªç¯ã€‚\nfunc factorial(fac int) int { result := 1 for ; fac \u0026gt; 0; fac-- { result *= fac } return result } ä¸ºäº†åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ä¸­å®Œæˆæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é€’å½’ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å°†ä¸€éåˆä¸€éåœ°è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œç›´åˆ°è¾¾åˆ°é˜¶ä¹˜çš„æœ€ä½æ•´æ•°ä¸ºæ­¢ã€‚\nfunc calculateFactorial(fac int) int { if fac == 0 { return 1 } return fac * calculateFactorial(fac - 1) } ç»“è®º è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä»å‡½æ•°å¼ç¼–ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼š\nå°½ç®¡Golangæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†å®ƒå¹¶éä¸ºæ­¤ç›®çš„è€Œè®¾è®¡çš„ï¼Œå¦‚ç¼ºå°‘Mapï¼ŒFilterå’ŒReduceå‡½æ•°ã€‚ å‡½æ•°å¼ç¼–ç¨‹æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºå‡½æ•°æ˜¯çº¯ç²¹çš„ï¼Œå› æ­¤æ˜“äºç†è§£ çº¯å‡½æ•°æ›´æ˜“äºæµ‹è¯•ï¼Œå› ä¸ºæ²¡æœ‰å†…éƒ¨çŠ¶æ€ä¼šæ”¹å˜è¾“å‡º åŸæ–‡åœ¨æ­¤: https://blog.logrocket.com/functional-programming-in-go/\n","id":53,"section":"posts","summary":"ä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿","tags":["functional"],"title":"ä½¿ç”¨Golangè¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹","uri":"https://lvsq.net/2020/03/fp-in-go/","year":"2020"},{"content":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚\né˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š\næ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ªç©ºé˜Ÿåˆ—\né€‰æ‹©å‡½æ•° (empty-queue? \u0026lt;queue\u0026gt; ) æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º (front-queue \u0026lt;queue\u0026gt; ) è¿”å›æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„æ•°æ®ï¼Œå…¶ä¸ä¼šä¿®æ”¹é˜Ÿåˆ— (length-queue \u0026lt;queue\u0026gt; ) è¿”å›é˜Ÿåˆ—é•¿åº¦\næ”¹å˜å‡½æ•° (insert-queue! \u0026lt;queue\u0026gt; \u0026lt;item\u0026gt; ) å°†æ•°æ®æ’å…¥æœ«ç«¯ (delete-queue! \u0026lt;queue\u0026gt; ) åˆ é™¤åˆ—å¤´çš„æ•°æ®\næ‰“å°å‡½æ•° (print-queue \u0026lt;queue\u0026gt;)\n(module FIFO-QUEUE (make-queue empty-queue? front-queue insert-queue! delete-queue! length-queue print-queue) (define front-ptr (lambda (q) (caar q))) (define set-front-ptr! (lambda (q item) (set-car! (car q) item))) (define rear-ptr (lambda (q) (cdar q))) (define set-rear-ptr! (lambda (q item) (set-cdr! (car q) item))) (define make-queue (lambda () (cons (cons \u0026#39;() \u0026#39;()) 0))) (define empty-queue? (lambda (q) (null? (front-ptr q)))) (define front-queue (lambda (q) (if (empty-queue? q) (error \u0026#34;FRONT called with an empty queue\u0026#34; q) (car (front-ptr q))))) (define (insert-queue! q item) (let ((new-pair (cons item \u0026#39;()))) (if (empty-queue? q) (begin (set-front-ptr! q new-pair) (set-rear-ptr! q new-pair) (set-cdr! q (+ 1 (cdr q))) q) (begin (set-cdr! (rear-ptr q) new-pair) (set-rear-ptr! q new-pair) (set-cdr! q ( + 1 (cdr q))) q) ) ) ) (define delete-queue! (lambda (q) (if (empty-queue? q) (error \u0026#34;DELETE! called with an empty queue\u0026#34; q) (begin (set-front-ptr! q (cdr (front-ptr q))) (set-cdr! q (- (cdr q) 1)) q) ) ) ) (define length-queue (lambda (q) (cdr q))) (define print-queue (lambda (q) (if (empty-queue? q) \u0026#39;() (front-ptr q)) )) ) å‰4ä¸ªè¿‡ç¨‹æ˜¯ç”¨äºå†…éƒ¨çš„å¸®åŠ©å‡½æ•°ï¼Œé˜Ÿåˆ—ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åˆ—å¤´ï¼ˆfront-ptrï¼‰,ä¸€ä¸ªæŒ‡å‘åˆ—å°¾ï¼ˆrear-ptrï¼‰ï¼Œè¿™æ ·å¯ä»¥å¼¥è¡¥åŸç”Ÿçš„set-car!å’Œset-cdr!çš„ä¸è¶³ã€‚\n\u0026gt; (load \u0026#34;/path/to/FIFO-QUEUE.scm\u0026#34;) ;;åŠ è½½FIFO-QUEUEæ¨¡å— \u0026gt; (import FIFO-QUEUE) \u0026gt; (define q (make-queue)) \u0026gt; (insert-queue! q 1) ;; (((1) 1) . 1), æœ€åä¸€ä¸ªæ•°å­—1è¡¨ç¤ºé˜Ÿåˆ—é•¿åº¦, åœ¨é˜Ÿåˆ—æœ‰åˆ é™¤æˆ–è€…æ’å…¥æ—¶ï¼ŒåŠæ—¶ä¿®æ”¹è¯¥å€¼ï¼Œä¸ºäº†åœ¨å–é˜Ÿåˆ—é•¿åº¦æ—¶å‡å°å¼€é”€ï¼Œå¦åˆ™è¦éå†ä¸€æ¬¡æ‰è¡Œ \u0026gt; (insert-queue! q 2) ;; (((1 2) 2) . 2) \u0026gt; (insert-queue! q 3) ;; (((1 2 3) 3) . 3) \u0026gt; (insert-queue! q 4) ;; (((1 2 3 4) 4) . 4) \u0026gt; (delete-queue! q) ;; (((2 3 4) 4) . 3) \u0026gt; (delete-queue! q) ;; (((3 4) 4) . 2) \u0026gt; (front-queue q) ;; 3 \u0026gt; (length-queue q) ;; 2 ","id":54,"section":"posts","summary":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚ é˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š æ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ª","tags":["scheme"],"title":"Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—","uri":"https://lvsq.net/2020/03/fifo-queue/","year":"2020"},{"content":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯èƒ½ä½¿ç”¨Schemeæ ‡å‡†æœºåˆ¶ã€‚\nHash Tables ç•¥è¿‡ã€‚åº”ä½¿ç”¨æ ‡å‡†hash table.\nExtend-Syntax Macros æœ¬èŠ‚ä»‹ç»äº†extend-syntaxï¼Œå®ƒæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ä½†æ˜“äºä½¿ç”¨çš„åŸºäºæ¨¡å¼åŒ¹é…çš„è¯­æ³•æ‰©å±•å·¥å…·ã€‚ ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•è½¬æ¢ä¸ä½¿ç”¨define-syntaxå’Œsyntax-caseç¼–å†™çš„è¯­æ³•è½¬æ¢ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºextend-syntaxäº§ç”Ÿçš„è½¬æ¢ä¸ä¼šè‡ªåŠ¨éµå¾ªè¯æ³•ä½œç”¨åŸŸã€‚\né€šå¸¸ä¸å¯èƒ½å°†ä½¿ç”¨syntax-caseç¼–å†™çš„è¯­æ³•æŠ½è±¡ä¸ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•æŠ½è±¡æ— ç¼åœ°æ··åˆåœ¨ä¸€èµ·ã€‚ é€šå¸¸å°½å¯èƒ½åªä½¿ç”¨å…¶ä¸­ä¸€ç§ã€‚ ä»…åœ¨è¿ç§»åˆ°syntax-caseæ—¶æä¾›äº†å¯¹syntax-caseæ‰©å±•å™¨ä¸­extend-syntaxçš„æ”¯æŒã€‚\n(extend-syntax (name key \u0026hellip;) (pat fender template) \u0026hellip;)\næ ‡è¯†ç¬¦name æ˜¯è¦å®šä¹‰çš„å¥æ³•æ‰©å±•åæˆ–è¯­æ³•å…³é”®å­—ã€‚ å½“ç³»ç»Ÿæ‰©å±•å™¨å¤„ç†carä¸ºname çš„ä»»ä½•listè¡¨è¾¾å¼æ—¶ï¼Œå°†åœ¨è¯¥è¡¨è¾¾å¼ä¸Šè°ƒç”¨extend-syntaxç”Ÿæˆçš„è¯­æ³•è½¬æ¢è¿‡ç¨‹ã€‚ å…¶ä½™çš„æ ‡è¯†ç¬¦key \u0026hellip; æ˜¯åœ¨æ‰©å±•è¿‡ç¨‹ä¸­è¦åœ¨è¾“å…¥è¡¨è¾¾å¼ä¸­è¯†åˆ«çš„å…¶ä»–å…³é”®å­—ï¼ˆä¾‹å¦‚condä¸­çš„elseæˆ–caseï¼‰ã€‚\nkeyåˆ—è¡¨ä¹‹åçš„æ¯ä¸ªå­å¥éƒ½åŒ…å«ä¸€ä¸ªæ¨¡å¼pat ï¼Œä¸€ä¸ªå¯é€‰çš„fender å’Œä¸€ä¸ªtemplate ã€‚ å¯é€‰çš„fender ç»å¸¸è¢«çœç•¥ã€‚pat æŒ‡å®šäº†è¯­æ³•ï¼Œç”¨äºåŒ¹é…å­å¥ã€‚æ¨¡å¼ä¸­ä¸æ˜¯å…³é”®å­—ï¼ˆæ¨¡å¼å˜é‡ï¼‰çš„æ ‡è¯†ç¬¦ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ã€‚fender å¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯Schemeè¡¨è¾¾å¼ï¼Œå®ƒæŒ‡å®šè¾“å…¥è¡¨è¾¾å¼ï¼ˆé€šè¿‡æ¨¡å¼å˜é‡è®¿é—®ï¼‰ä¸Šçš„é™„åŠ çº¦æŸï¼Œå¿…é¡»é€‰æ‹©è¿™äº›çº¦æŸæ‰èƒ½é€‰æ‹©å­å¥ã€‚template é€šå¸¸æ ¹æ®æ¨¡å¼å˜é‡æ¥æŒ‡å®šè¾“å‡ºé‡‡ç”¨ä»€ä¹ˆå½¢å¼ã€‚\nåœ¨æ‰©å±•è¿‡ç¨‹ä¸­ï¼Œè½¬æ¢è¿‡ç¨‹extend-syntaxä¼šå°è¯•ä»¥ç»™å®šçš„å­å¥çš„é¡ºåºå°†è¾“å…¥è¡¨è¾¾å¼ä¸æ¯ä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¾“å…¥è¡¨è¾¾å¼åŒ¹é…äº†æŸä¸ªæ¨¡å¼ï¼Œåˆ™å°†æ¨¡å¼å˜é‡ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ï¼Œå¹¶å¯¹å­å¥çš„fender ï¼ˆå¦‚æœæœ‰ï¼‰è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœfender è¿”å›ä¸€ä¸ªçœŸå€¼ï¼Œåˆ™æ‰§è¡Œç»™å®šçš„æ‰©å±•ã€‚ å¦‚æœè¾“å…¥ä¸æ¨¡å¼ä¸åŒ¹é…ï¼Œæˆ–è€…fender è¿”å›é”™è¯¯å€¼ï¼Œåˆ™è½¬æ¢è¿‡ç¨‹å°†å°è¯•ä¸‹ä¸€ä¸ªå­å¥ã€‚å¦‚æœæ— æ³•é€‰æ‹©ä»»ä½•å­å¥ï¼Œåˆ™ä¼šå¼•å‘æ¡ä»¶ç±»å‹**ï¼†assertion**çš„å¼‚å¸¸ã€‚\nåœ¨æ¨¡å¼å†…ï¼Œçœç•¥å·ï¼ˆ\u0026hellip;ï¼‰å¯ç”¨äºæŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªå‡ºç°çš„å‰é¢çš„æ¨¡å¼ç‰‡æ®µæˆ–åŸå‹ã€‚ç±»ä¼¼åœ°ï¼Œå¯ä»¥åœ¨è¾“å‡ºä¸­ä½¿ç”¨çœç•¥å·æ¥æŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªæ‰©å±•åŸå‹çš„ç»“æ„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å±•åŸå‹å¿…é¡»åŒ…å«è¾“å…¥æ¨¡å¼åŸå‹çš„ä¸€éƒ¨åˆ†ã€‚\nç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå®šä¹‰äº†rec, ä½¿ç”¨å•ä¸ªå…³é”®å­—ï¼Œä¸€ä¸ªå­å¥ï¼Œä¸”æ²¡æœ‰fenderå’Œçœç•¥å·\n(extend-syntax (rec) [(rec id val) (let ([id #f]) (set! id val) id)]) ç¬¬äºŒä¸ªä¾‹å­ï¼Œå®šä¹‰äº†whenï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨çœç•¥å·\n(extend-syntax (when) [(when test exp1 exp2 ...) (if test (begin exp1 exp2 ...) #f)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºletçš„å®šä¹‰ã€‚ letçš„å®šä¹‰æ˜¾ç¤ºäº†å¤šä¸ªçœç•¥å·çš„ä½¿ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨äºæ ‡è¯†ç¬¦/å€¼åºå¯¹ï¼Œå¦ä¸€ä¸ªç”¨äºbodyä¸­çš„è¡¨è¾¾å¼ã€‚å®ƒè¿˜è¡¨æ˜åŸå‹ä¸å¿…æ˜¯å•ä¸ªæ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”åœ¨templateä¸­å¯ä»¥å°†åŸå‹çš„å„ä¸ªéƒ¨åˆ†å½¼æ­¤åˆ†å¼€ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) ((lambda (x ...) b1 b2 ...) e ...)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºlet*ï¼Œå…¶è¯­æ³•ä¸letç›¸åŒï¼Œä½†æ˜¯æ ¹æ®letä»¥ä¸¤ä¸ªå­å¥ï¼ˆä¸€ä¸ªç”¨äºåŸºæœ¬æƒ…å†µï¼Œä¸€ä¸ªç”¨äºé€’å½’æ­¥éª¤ï¼‰é€’å½’å®šä¹‰ï¼Œå› ä¸ºå®ƒå¿…é¡»äº§ç”Ÿä¸€ä¸ªåµŒå¥—ç»“æ„ã€‚\n(extend-syntax (let*) [(let* () b1 b2 ...) (let () b1 b2 ...)] [(let* ([x e] more ...) b1 b2 ...) (let ([x e]) (let* (more ...) b1 b2 ...))]) å®šä¹‰å¼andéœ€è¦3ä¸ªå­å¥ã€‚ç¬¬ä¸€ä¸ªå­å¥å¯¹äºè¯†åˆ«**(and)æ˜¯å¿…è¦çš„ï¼Œåä¸¤ä¸ªä»¥é€’å½’æ–¹å¼å®šä¹‰æ‰€æœ‰å…¶ä»–and**å½¢å¼ã€‚\n(extend-syntax (and) [(and) #t] [(and x) x] [(and x y ...) (if x (and y ...) #f)]) condçš„å®šä¹‰éœ€è¦å››ä¸ªå­å¥ã€‚ ä¸let*ä¸€æ ·ï¼Œå¿…é¡»å¯¹condè¿›è¡Œé€’å½’æè¿°ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒä¼šäº§ç”ŸåµŒå¥—çš„ifè¡¨è¾¾å¼ï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸€ä¸ªçœç•¥å·åŸå‹ä¸è¶³ä»¥æè¿°æ‰€æœ‰å¯èƒ½çš„condå­å¥ã€‚ condçš„å®šä¹‰è¿˜è¦æ±‚é™¤condä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šelseä½œä¸ºå…³é”®å­—ã€‚ è¿™æ˜¯å®šä¹‰ï¼š\n(extend-syntax (cond else) [(cond) #f] [(cond (else e1 e2 ...)) (begin e1 e2 ...)] [(cond (test) more ...) (or test (cond more ...))] [(cond (test e1 e2 ...) more ...) (if test (begin e1 e2 ...) (cond more ...))]) ä¸ºäº†ä½¿letçš„è¯­æ³•ç»å¯¹æ­£ç¡®ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¿…é¡»è¦æ±‚è¾“å…¥ä¸­çš„ç»‘å®šæ ‡è¯†ç¬¦æ˜¯ç¬¦å·ã€‚ å¦‚æœæˆ‘ä»¬è¾“å…¥ç±»ä¼¼**ï¼ˆletï¼ˆ[3 x]ï¼‰xï¼‰çš„å†…å®¹ï¼Œåˆ™ä¸ä¼šä»let**ä¸­å¾—åˆ°é”™è¯¯ï¼Œå› ä¸ºå®ƒä¸ä¼šæ£€æŸ¥éªŒè¯æ ‡è¯†ç¬¦ä½ç½®ä¸­çš„å¯¹è±¡æ˜¯å¦ä¸ºç¬¦å·ã€‚ ç›¸åï¼Œlambdaå¯èƒ½ä¼šæŠ±æ€¨ï¼Œæˆ–è€…å¯èƒ½æ˜¯æ‰©å±•å®Œæˆå¾ˆä¹…ä¹‹åçš„æ±‚å€¼ç¨‹åºã€‚ è¿™æ˜¯fenders èµ·ä½œç”¨çš„åœ°æ–¹ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) (andmap symbol? \u0026#39;(x ...)) ((lambda (x ...) b1 b2 ...) e ...)]) \u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰ä¸Šçš„symbol?çš„andmapç¡®ä¿æ¯ä¸ªç»‘å®šæ ‡è¯†ç¬¦éƒ½æ˜¯ä¸€ä¸ªç¬¦å·ã€‚ fender ä»…ä»…æ˜¯Schemeè¡¨è¾¾å¼ã€‚ åœ¨è¯¥è¡¨è¾¾å¼ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ä¸å­å¥çš„template éƒ¨åˆ†ç›¸åŒçš„è§„åˆ™æ¥æ‰©å±•å¼•ç”¨çš„å¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†**\u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰**æ‰©å±•åˆ°æ ‡è¯†ç¬¦/å€¼å¯¹ä¸­çš„æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚\nextend-syntaxé€šå¸¸å¯ä»¥å¤„ç†æ‚¨çš„ä¸€åˆ‡éœ€æ±‚ï¼Œä½†æ˜¯æŸäº›è¯­æ³•æ‰©å±•å®šä¹‰è¦æ±‚èƒ½å¤ŸåŒ…å«å¯¹ä»»æ„Schemeè¡¨è¾¾å¼æ±‚å€¼çš„ç»“æœã€‚ è¯¥åŠŸèƒ½ç”±withæä¾›ã€‚\n(with ((pat expr) \u0026hellip;) template)\nwithä»…åœ¨extend-syntaxå†…éƒ¨çš„template å†…æœ‰æ•ˆã€‚ withæ¨¡å¼ä¸extend-syntaxæ¨¡å¼ç›¸åŒï¼Œwithè¡¨è¾¾å¼ä¸extend-syntaxçš„fenders ç›¸åŒï¼Œwithæ¨¡æ¿ä¸extend-syntaxæ¨¡æ¿ç›¸åŒã€‚\nwithå¯ç”¨äºå¼•å…¥æ–°çš„æ¨¡å¼æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦ç»‘å®šåˆ°extend-syntaxæ¨¡æ¿ä¸­çš„ä»»æ„Schemeè¡¨è¾¾å¼æ‰€ç”Ÿæˆçš„è¡¨è¾¾å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œwithå…è®¸ä»extend-syntaxçš„å£°æ˜å¼æ ·å¼è½¬ä¸ºfull Schemeçš„è¿‡ç¨‹å¼æ ·å¼ã€‚\nwithçš„ä¸€ç§å¸¸è§ç”¨æ³•æ˜¯åœ¨æ¨¡æ¿ä¸­å¼•å…¥ä¸´æ—¶æ ‡è¯†ç¬¦æˆ–ä¸´æ—¶æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚ å¦‚æœåœ¨extend-syntaxæ¡†æ¶å†…æ‰§è¡Œï¼Œwithä¹Ÿå¯ç”¨äºæ‰§è¡Œå¯èƒ½ç¬¨æ‹™æˆ–æ•ˆç‡ä½ä¸‹çš„å¤æ‚è½¬æ¢ã€‚\nä¾‹å¦‚ï¼Œoréœ€è¦ä½¿ç”¨ä¸´æ—¶æ ‡è¯†ç¬¦ã€‚ æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®šä¹‰orï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (let ([temp x]) (if temp temp (or y ...)))]) è¿™ä¼šä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°å°†orè¡¨è¾¾å¼æ”¾ç½®åœ¨tempå‘ç”Ÿçš„èŒƒå›´å†…ä¸ºæ­¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…ï¼Œå› ä¸ºextend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸã€‚ ï¼ˆè¿™æ˜¯define-syntaxä¼˜äºextend-syntaxçš„åŸå› ä¹‹ä¸€ã€‚ï¼‰\n(let ([temp #t]) (or #f temp)) â‡’ #f å¦‚æœå°†æ ‡è¯†ç¬¦tempæ¢ä¸ªåå­—ï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚å°±å¯ä»¥ç†è§£\u0026quot;extend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸ\u0026quot;è¿™å¥è¯äº†ã€‚ å®é™…ä¸Šï¼Œä¸Šè¿°çš„(let \u0026hellip;)è¡¨è¾¾å¼ï¼Œå±•å¼€ä¹‹åå°±å˜æˆäº†ï¼š\n(let ([temp #t]) (let ([temp #f]) (if temp temp (or temp)) ) ) ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨gensymå’Œwithæ¥åˆ›å»ºä¸´æ—¶æ ‡è¯†ç¬¦ï¼Œå¦‚ä¸‹ï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (with ([temp (gensym)]) (let ([temp x]) (if temp temp (or y ...))))]) è€Œä¸”ï¼Œwithå¯ä»¥ä»¥extend-syntaxæ— æ³•ç›´æ¥ä½¿ç”¨çš„æ–¹å¼æ¥ç»„åˆè¾“å…¥æ¨¡å¼çš„å…ƒç´ ï¼Œä¾‹å¦‚ä»¥ä¸‹folding-plusç¤ºä¾‹:\n(extend-syntax (folding-plus) [(folding-plus x y) (and (number? \u0026#39;x) (number? \u0026#39;y)) (with ([val (+ \u0026#39;x \u0026#39;y)]) val)] [(folding-plus x y) (+ x y)]) å¦‚æœxå’Œyå‡ä¸ºæ•°å­—å¸¸æ•°ï¼Œåˆ™folding-plusæŠ˜å ä¸ºï¼ˆ+ x yï¼‰çš„å€¼ã€‚ å¦åˆ™ï¼Œfolding-plusè½¬æ¢ä¸ºï¼ˆ+ x yï¼‰ä»¥ä¾›ä»¥åè¯„ä¼°ã€‚ fenderåœ¨æ‰©å±•æ—¶æ£€æŸ¥æ“ä½œæ•°æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¹¶ä½¿ç”¨withè¿›è¡Œæ±‚å€¼ã€‚ ä¸fenderä¸€æ ·ï¼Œæ‰©å±•ä»…åœ¨å¸¦å¼•å·çš„è¡¨è¾¾å¼å†…æ‰§è¡Œï¼Œå› ä¸ºquoteå°†æ•°æ®ä¸Schemeè¡¨è¾¾å¼çš„å…¶ä½™éƒ¨åˆ†åŒºåˆ†å¼€ã€‚\nä¸‹é¢çš„ç¤ºä¾‹åˆ©ç”¨withå…è®¸æˆ‘ä»¬å°†æ¨¡å¼ç»‘å®šåˆ°è¡¨è¾¾å¼è¿™ä¸€äº‹å®ï¼Œå°†æ¨¡å¼å˜é‡åˆ—è¡¨ç»‘å®šåˆ°ä¸´æ—¶ç¬¦å·åˆ—è¡¨ã€‚ æ­¤ä¸´æ—¶åˆ—è¡¨å¸®åŠ©æˆ‘ä»¬å®ç°sigmaè¯­æ³•æ‰©å±•ã€‚ sigmaä¸lambdaç›¸ä¼¼ï¼Œé™¤äº†å®ƒåœ¨æ ‡è¯†ç¬¦åˆ—è¡¨ä¸­åˆ†é…æ ‡è¯†ç¬¦è€Œä¸æ˜¯åˆ›å»ºæ–°ç»‘å®šä¹‹å¤–ã€‚ å®ƒå¯ç”¨äºå¹¶è¡Œæ‰§è¡Œä¸€ç³»åˆ—åˆ†é…ã€‚\n(extend-syntax (sigma) [(sigma (x ...) e1 e2 ...) (with ([(t ...) (map (lambda (x) (gensym)) \u0026#39;(x ...))]) (lambda (t ...) (set! x t) ... e1 e2 ...))]) (let ([x \u0026#39;a] [y \u0026#39;b]) ((sigma (x y) (list x y)) y x)) â‡’ (b a) ç»“æ„ä½“ æœ¬èŠ‚ä»‹ç»ä¸€ç§æœºåˆ¶ï¼Œç±»ä¼¼äºç¬¬7.15èŠ‚çš„recordå®šä¹‰æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ä½¿ç”¨å›ºå®šçš„å‘½åå­—æ®µé›†åˆ›å»ºæ•°æ®ç»“æ„ã€‚ ä¸recordç±»å‹ä¸åŒï¼Œç»“æ„ä½“ç±»å‹ä¸æ˜¯å”¯ä¸€ç±»å‹ï¼Œè€Œæ˜¯å®ç°ä¸ºå‘é‡ã€‚ å…·ä½“è€Œè¨€ï¼Œå°†ç»“æ„ä½“å®ç°ä¸ºå‘é‡ï¼Œå…¶é•¿åº¦æ¯”å­—æ®µæ•°å¤§ä¸€å€ï¼Œå¹¶ä¸”å…¶ç¬¬ä¸€ä¸ªå…ƒç´ åŒ…å«è¯¥ç»“æ„ä½“çš„ç¬¦å·åç§°ã€‚\nå°†ç»“æ„ä½“è¡¨ç¤ºä¸ºå‘é‡å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šç®€åŒ–ç»“æ„ä½“çš„è¯»å–å’Œæ‰“å°ä»¥åŠç»“æ„ä½“å®šä¹‰å·¥å…·çš„æ‰©å±•ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®æœ‰ä¸€äº›ç¼ºç‚¹ã€‚ ä¸€ä¸ªæ˜¯åœ¨ä¸é€‚å½“çš„æƒ…å†µä¸‹ï¼Œç»“æ„ä½“å¯èƒ½ä¼šè¢«é”™è¯¯åœ°è§†ä¸ºæ™®é€šå‘é‡ã€‚å½“åœ¨ç¨‹åºä¸­å¤„ç†ç»“æ„ä½“å’Œå‘é‡æ—¶ï¼Œåœ¨æ£€æŸ¥æ›´é€šç”¨çš„å‘é‡ç±»å‹ä¹‹å‰ï¼Œå¿…é¡»æ³¨æ„å…ˆå¯»æ‰¾æ›´å…·ä½“çš„ç»“æ„ä½“ç±»å‹ï¼Œä¾‹å¦‚åœ¨ä¸€ç³»åˆ—condå­å¥ä¸­ã€‚ä¸€ä¸ªç±»ä¼¼çš„ç¼ºç‚¹æ˜¯ï¼Œç»“æ„ä½“å®ä¾‹å®¹æ˜“è¢«æœ‰æ„æˆ–æ— æ„åœ°â€œä¼ªé€ â€ã€‚ ä¹Ÿä¸å¯èƒ½æ§åˆ¶å¦‚ä½•æ‰“å°å’Œè¯»å–ç»“æ„ä½“ã€‚\né€šè¿‡define-structureåˆ›å»ºç»“æ„ä½“ã€‚ æ¯ä¸ªç»“æ„ä½“å®šä¹‰å¼éƒ½å®šä¹‰ä¸€ä¸ªæ„é€ è¿‡ç¨‹ï¼Œä¸€ä¸ªç±»å‹è°“è¯ï¼Œæ¯ä¸ªå­—æ®µçš„è®¿é—®è¿‡ç¨‹ä»¥åŠæ¯ä¸ªå­—æ®µçš„åˆ†é…è¿‡ç¨‹ã€‚define-structureå…è®¸ç¨‹åºå‘˜æ§åˆ¶å“ªäº›å­—æ®µæ˜¯æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°ï¼Œä»¥åŠå“ªäº›å­—æ®µç”±æ„é€ å‡½æ•°è¿‡ç¨‹æ˜¾å¼åˆå§‹åŒ–ã€‚define-structureéå¸¸ç®€å•ï¼Œä½†å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´è¶³å¤Ÿå¼ºå¤§ï¼Œå¦‚æœè¿˜ä¸è¶³ä»¥åº”ä»˜åº”ç”¨ç¨‹åºçš„éœ€æ±‚è¿˜å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰©å±•ä»¥æ»¡è¶³ä¹‹ã€‚ æœ¬èŠ‚æœ«å°¾ç»™å‡ºçš„define-structureå®šä¹‰å¯ä»¥ä½œä¸ºæ›´å¤æ‚å˜ä½“çš„èµ·ç‚¹ã€‚\n(define-structure (name id1 \u0026hellip;) ((id2 expr) \u0026hellip;))\ndefine-structureå½¢å¼å¯ä»¥å‡ºç°åœ¨ä»»æ„ä½ç½®ã€‚\ndefine-structureå®šä¹‰ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„name ï¼Œå¹¶åˆ›å»ºä¸€ç»„ç”¨äºæ„é€ å’Œæ“ä½œè¯¥ç»“æ„å®ä¾‹çš„è¿‡ç¨‹ã€‚ æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; å‘½åæ•°æ®ç»“æ„çš„å­—æ®µã€‚\nä¸‹é¢çš„è¿‡ç¨‹éƒ½æœ‰define-structureå®šä¹‰ï¼š\nåä¸º**make-**name çš„æ„é€ è¿‡ç¨‹ åä¸ºname? çš„ç±»å‹è°“è¯ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸ºname-field çš„è®¿é—®è¿‡ç¨‹ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸º**set-**name-field! çš„åˆ†é…è¿‡ç¨‹ æ ‡è¯†ç¬¦id1 \u0026hellip; å‘½åçš„å­—æ®µç”±æ„é€ å‡½æ•°çš„å‚æ•°åˆå§‹åŒ–ã€‚ ç”±æ ‡è¯†ç¬¦id2 \u0026hellip; å‘½åçš„å­—æ®µè¢«æ˜¾å¼åˆå§‹åŒ–ä¸ºè¡¨è¾¾å¼expr \u0026hellip; çš„å€¼ã€‚æ¯ä¸ªè¡¨è¾¾å¼éƒ½åœ¨æ ‡è¯†ç¬¦id1 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…è¿›è¡Œæ±‚å€¼ï¼Œå¹¶ä¸”åœ¨æ ‡è¯†ç¬¦id2 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…å‡ºç°ï¼ˆç±»ä¼¼let*ï¼‰ ã€‚\nä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæ„é€ å‡½æ•°çš„è¡Œä¸ºå°±åƒå®šä¹‰ä¸ºï¼š\n(define make-name (lambda (id1 ...) (let* ([id2 expr ] ...) body ))) å…¶ä¸­body æ ¹æ®æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; çš„å€¼æ„å»ºç»“æ„ä½“ã€‚\nå¦‚æœä¸éœ€è¦é™¤æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–çš„å­—æ®µä»¥å¤–çš„å…¶ä»–å­—æ®µï¼Œåˆ™å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå­è¡¨è¾¾å¼*( (id2 expr) \u0026hellip;)* ã€‚\nä»¥ä¸‹ç®€å•ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨Schemeä¸­å®šä¹‰pairï¼ˆå¦‚æœå®ƒä»¬ä¸å­˜åœ¨çš„è¯ï¼‰ã€‚ è¿™ä¸¤ä¸ªå­—æ®µéƒ½ç”±æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–ã€‚\n(define-structure (pare car cdr)) (define p (make-pare â€™a â€™b)) (pare? p) â‡’ #t (pair? p) â‡’ #f (pare? â€™(a . b)) â‡’ #f (pare-car p) â‡’ a (pare-cdr p) â‡’ b (set-pare-cdr! p (make-pare \u0026#39;b \u0026#39;c)) (pare-car (pare-cdr p)) â‡’ b (pare-cdr (pare-cdr p)) â‡’ c ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªæ–¹ä¾¿çš„å­—ç¬¦ä¸²æ•°æ®ç»“æ„ï¼Œç§°ä¸ºstrext-string ï¼Œè¯¥ç»“æ„ä¼šæ ¹æ®éœ€è¦å¢é•¿ã€‚æœ¬ä¾‹å­ä¸­ï¼Œä¼šæ˜¾å¼åœ°åˆå§‹åŒ–ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œè¯¥å­—æ®µåœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ã€‚\n(define-structure (stretch-string length fill) ([string (make-string length fill)])) (define stretch-string-ref (lambda (s i) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-ref (stretch-string-string s) i)))) (define stretch-string-set! (lambda (s i c) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-set! (stretch-string-string s) i c)))) (define stretch-string-fill! (lambda (s c) (string-fill! (stretch-string-string s) c) (set-stretch-string-fill! s c))) (define stretch-stretch-string! (lambda (s i n) (set-stretch-string-length! s i) (let ([str (stretch-string-string s)] [fill (stretch-string-fill s)]) (let ([xtra (make-string (- i n) fill)]) (set-stretch-string-string! s (string-append str xtra)))))) é€šå¸¸ï¼Œå¤§å¤šæ•°è‡ªåŠ¨å®šä¹‰çš„è¿‡ç¨‹éƒ½ç”¨äºå®šä¹‰æ›´ç‰¹æ®Šçš„è¿‡ç¨‹ï¼Œ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯´çš„å°±æ˜¯stretch-string-ref ** å’Œstretch-string-set!ã€‚è€Œstretch-string-length** å’Œ stretch-string-stringæ˜¯æƒŸä¸€ç›´æ¥ä½¿ç”¨çš„è‡ªåŠ¨ç”Ÿæˆçš„è¿‡ç¨‹ã€‚\n(define ss (make-stretch-string 2 #\\X)) (stretch-string-string ss) â‡’ \u0026#34;XX\u0026#34; (stretch-string-ref ss 3) â‡’ #\\X (stretch-string-length ss) â‡’ 4 (stretch-string-string ss) â‡’ \u0026#34;XXXX\u0026#34; (stretch-string-fill! ss #\\@) (stretch-string-string ss) â‡’ \u0026#34;@@@@\u0026#34; (stretch-string-ref ss 5) â‡’ #\\@ (stretch-string-string ss) â‡’ \u0026#34;@@@@@@\u0026#34; (stretch-string-set! ss 7 #\\=) (stretch-string-length ss) â‡’ 8 (stretch-string-string ss) â‡’ \u0026#34;@@@@@@@=\u0026#34; ã€ŠThe Scheme Programming Languageã€‹ï¼ˆç¬¬4ç‰ˆï¼‰çš„8.4èŠ‚å®šä¹‰äº†define-structureçš„ç®€åŒ–å˜ä½“ï¼Œä½œä¸ºä½¿ç”¨syntax-caseçš„ç¤ºä¾‹ã€‚ ä¸‹é¢ç»™å‡ºçš„å®šä¹‰å®ç°äº†å®Œæ•´ç‰ˆæœ¬ã€‚\n(define-syntax define-structure (lambda (x) (define gen-id (lambda (template-id . args) (datum-\u0026gt;syntax template-id (string-\u0026gt;symbol (apply string-append (map (lambda (x) (if (string? x) x (symbol-\u0026gt;string (syntax-\u0026gt;datum x)))) args)))))) (syntax-case x () ((_ (name field1 ...)) (andmap identifier? #\u0026#39;(name field1 ...)) #\u0026#39;(define-structure (name field1 ...) ())) ((_ (name field1 ...) ((field2 init) ...)) (andmap identifier? #\u0026#39;(name field1 ... field2 ...)) (with-syntax ((constructor (gen-id #\u0026#39;name \u0026#34;make-\u0026#34; #\u0026#39;name)) (predicate (gen-id #\u0026#39;name #\u0026#39;name \u0026#34;?\u0026#34;)) ((access ...) (map (lambda (x) (gen-id x #\u0026#39;name \u0026#34;-\u0026#34; x)) #\u0026#39;(field1 ... field2 ...))) ((assign ...) (map (lambda (x) (gen-id x \u0026#34;set-\u0026#34; #\u0026#39;name \u0026#34;-\u0026#34; x \u0026#34;!\u0026#34;)) #\u0026#39;(field1 ... field2 ...))) (structure-length (+ (length #\u0026#39;(field1 ... field2 ...)) 1)) ((index ...) (let f ([i 1] [ids #\u0026#39;(field1 ... field2 ...)]) (if (null? ids) \u0026#39;() (cons i (f (+ i 1) (cdr ids))))))) #\u0026#39;(begin (define constructor (lambda (field1 ...) (let* ([field2 init] ...) (vector \u0026#39;name field1 ... field2 ...)))) (define predicate (lambda (x) (and (vector? x) (#3%fx= (vector-length x) structure-length) (eq? (vector-ref x 0) \u0026#39;name)))) (define access (lambda (x) (vector-ref x index))) ... (define assign (lambda (x update) (vector-set! x index update))) ...)))))) ","id":55,"section":"posts","summary":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯","tags":["scheme"],"title":"å…¼å®¹æ€§ï¼ˆCompatibility Features in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/compatibility/","year":"2020"},{"content":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹ç³»ç»Ÿï¼ˆpthreadsï¼‰ä¹‹ä¸Šå®ç°ï¼Œå¹¶åœ¨åŸºäºWindowsçš„ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨Windows APIã€‚ æœ‰å…³çº¿ç¨‹åˆ›å»ºå’Œäº¤äº’çš„åŸºæœ¬è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…ç³»ç»Ÿä¸Šçš„ç›¸åº”æ–‡æ¡£ã€‚\nå¤§å¤šæ•°åŸç”Ÿçš„Schemeè¿‡ç¨‹éƒ½æ˜¯çº¿ç¨‹å®‰å…¨ çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶è°ƒç”¨å®ƒä»¬ã€‚ è¿™åŒ…æ‹¬è¯¸å¦‚conså’Œmake-stringä¹‹ç±»çš„åˆ†é…æ“ä½œï¼Œè¯¸å¦‚carå’Œvector-refä¹‹ç±»çš„è®¿é—®å™¨ï¼Œè¯¸å¦‚**+å’Œsqrtä¹‹ç±»çš„æ•°å­—è¿ç®—ç¬¦ä»¥åŠè¯¸å¦‚appendå’Œmap**ä¹‹ç±»çš„éç ´åæ€§çš„é«˜çº§åŸç”Ÿæ“ä½œã€‚\nç®€å•çš„å˜åŠ¨è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚set-carï¼ï¼Œvector-setï¼å’Œrecordå­—æ®µå˜åŠ¨å™¨ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åŒæ ·ï¼Œå¯¹å±€éƒ¨å˜é‡çš„åˆ†é…ï¼ŒåŒ…æ‹¬ï¼ˆæœªå¯¼å‡ºçš„ï¼‰åº“å’Œé¡¶çº§ç¨‹åºå˜é‡çš„åˆ†é…ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nå¤§å¤šæ•°I/Oæ“ä½œåº”è¢«è§†ä¸ºå…·æœ‰ç ´åæ€§ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šä¿®æ”¹ç«¯å£çš„å†…éƒ¨ç»“æ„ã€‚\nä½¿ç”¨æ²¡æœ‰è¿›è¡Œåˆé€‚çš„åŒæ­¥ç­–ç•¥çš„éçº¿ç¨‹å®‰å…¨çš„è¿ç®—ç¬¦å¯èƒ½ä¼šç ´åå®ƒä»¬æ‰€æ“ä½œçš„å¯¹è±¡ã€‚ è¿™ç§æŸåå¯èƒ½å¯¼è‡´é”™è¯¯çš„è¡Œä¸ºï¼Œå†…å­˜æ•…éšœï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿä¸­æ­¢çš„ä¸å¯æ¢å¤çš„é”™è¯¯ã€‚\nçº¿ç¨‹åˆ›å»º (fork-thread thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—0ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚\nfork-threadåœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è°ƒç”¨thunk ï¼Œå¹¶è¿”å›ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚\né™¤äº†æ‰“å°å®ƒå¤–ï¼Œfork-threadè¿”å›çš„çº¿ç¨‹å¯¹è±¡æ— æ³•æ‰§è¡Œä»»ä½•æ“ä½œã€‚\né™¤äº†ä½¿ç”¨fork-threadä»¥å¤–ï¼Œå¯é€šè¿‡å¤–éƒ¨ä»£ç æ¥åˆ›å»ºçš„çº¿ç¨‹å¿…é¡»åœ¨è§¦åŠä»»ä½•Schemeæ•°æ®æˆ–è°ƒç”¨ä»»ä½•Schemeè¿‡ç¨‹ä¹‹å‰è°ƒç”¨Sactivate_thread\n(thread? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè¿”å›#t,å¦åˆ™è¿”å›#f\n(get-thread-id)\nè¿”å›ï¼šå½“å‰çº¿ç¨‹çš„id\nçº¿ç¨‹idæ˜¯ç”±çº¿ç¨‹åˆ†é…çš„çº¿ç¨‹å·ï¼Œå¹¶ä¸”ä¸get-process-idè¿”å›çš„è¿›ç¨‹idæ²¡æœ‰å…³ç³»ï¼Œè¿›ç¨‹idåœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚\näº’æ–¥é” (make-mutex)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„äº’æ–¥é”å¯¹è±¡\n(mutex? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯äº’æ–¥é”ï¼Œè¿”å›#t\n(mutex-acquire mutex) | (mutex-acquire mutex block?)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-acquireè·å–ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚å¯é€‰çš„boolå‚æ•°blockï¼Ÿ é»˜è®¤ä¸º#tï¼ŒæŒ‡å®šçº¿ç¨‹æ˜¯å¦åº”é˜»å¡ç­‰å¾…äº’æ–¥é”ã€‚blockï¼Ÿ å¦‚æœçœç•¥æˆ–ä¸ºtrueï¼Œåˆ™çº¿ç¨‹å°†é˜»å¡ï¼Œç›´åˆ°è·å–äº†äº’æ–¥é”ä¸ºæ­¢ï¼Œå¹¶è¿”å›æœªæŒ‡å®šçš„å€¼ã€‚\nå¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”äº’æ–¥é”å½“å‰å·²å±äºå…¶ä»–çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ï¼Œmutex-acquireç«‹å³è¿”å›å€¼**#f**ï¼Œä»¥æŒ‡ç¤ºäº’æ–¥é”ä¸å¯ç”¨ã€‚ å¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”æˆåŠŸè·å–äº†äº’æ–¥é”ï¼Œmutex-acquireè¿”å›#tã€‚\näº’æ–¥é”åœ¨Posixçº¿ç¨‹æœ¯è¯­ä¸­æ˜¯é€’å½’çš„ï¼Œè¿™æ„å‘³ç€è°ƒç”¨çº¿ç¨‹å¯ä»¥ä½¿ç”¨äº’æ–¥é”è·å–ï¼ˆé‡æ–°ï¼‰è·å–å®ƒå·²ç»æ‹¥æœ‰çš„äº’æ–¥é”ï¼ˆæ³¨ï¼šé”æ˜¯å¯ä»¥é‡å…¥çš„ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡Šæ”¾äº’æ–¥é”éœ€è¦æ‰§è¡Œç›¸ç­‰æ•°é‡çš„mutex-releaseã€‚\n(mutex-release mutex)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-releaseé‡Šæ”¾ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚ å¦‚æœmutex ä¸å±äºè°ƒç”¨çº¿ç¨‹ï¼ˆå³é‡Šæ”¾åˆ«äººçš„äº’æ–¥é”ï¼‰ï¼Œåˆ™ä¼šå¯¼è‡´æ— æ³•é¢„æ–™çš„è¡Œä¸ºã€‚\n(with-mutex mutex body1 body2 \u0026hellip;)\nwith-mutexè®¡ç®—è¡¨è¾¾å¼mutex ï¼Œå…¶å¿…é¡»å¯ä»¥è®¡ç®—ä¸ºä¸€ä¸ªäº’æ–¥é”ï¼Œè·å–é”ï¼Œå¹¶è®¡ç®—body1 body2 \u0026hellip; ,ç„¶åé‡Šæ”¾é”ã€‚æ— è®ºbodyæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯é€šè¿‡æ§åˆ¶æ“ä½œï¼ˆå³å¯èƒ½ç”±äºé”™è¯¯è€ŒæŠ›åˆ°continuationï¼‰é‡Šæ”¾äº’æ–¥é‡ï¼Œè¿™éƒ½ä¼šå¯¼è‡´with-mutexå½¢å¼çš„éæœ¬åœ°é€€å‡ºã€‚å¦‚æœæ§åˆ¶éšåé€šè¿‡continuationè°ƒç”¨è¿”å›åˆ°bodyï¼Œåˆ™å°†é‡æ–°è·å–äº’æ–¥é”ã€‚\nä¸ç›´æ¥ä½¿ç”¨mutex-acquireå’Œmutex-releaseç›¸æ¯”ï¼Œä½¿ç”¨with-mutexé€šå¸¸æ›´æ–¹ä¾¿ï¼Œæ›´å®‰å…¨ã€‚\næ¡ä»¶ (make-condition)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„æ¡ä»¶å¯¹è±¡\n(thread-condition? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œè¿”å›#t\n(condition-wait cond mutex) | (condition-wait cond mutex timeout)\nè¿”å›ï¼šå¦‚æœè°ƒç”¨çº¿ç¨‹è¢«æ¡ä»¶å”¤é†’è¿”å›#tï¼Œå¦‚æœè°ƒç”¨çº¿ç¨‹è¶…æ—¶ç­‰å¾…è¿”å›#f\ncond å¿…é¡»æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”mutex å¿…é¡»æ˜¯äº’æ–¥é”ã€‚ å¯é€‰å‚æ•°timeout æ˜¯ç±»å‹ä¸ºtime-durationæˆ–time-utcæˆ–**#fçš„æ—¶é—´è®°å½•ï¼Œè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶ã€‚ é»˜è®¤ä¸º#f**ã€‚\ncondition-waitç­‰å¾…ç”±cond æ ‡è¯†çš„æ¡ä»¶ï¼Œä¸”ç­‰å¾…æŒ‡å®šçš„timeoutæ—¶é•¿ã€‚åœ¨è°ƒç”¨condition-waitæ—¶ï¼Œè°ƒç”¨çº¿ç¨‹å¿…é¡»å·²è·å–äº’æ–¥é”mutex ã€‚ç”±äºè°ƒç”¨condition-waitçš„å‰¯ä½œç”¨è€Œé‡Šæ”¾äº†mutex ã€‚å½“ç¨åé€šè¿‡ä¸‹è¿°çš„è¿‡ç¨‹ä¹‹ä¸€ä»æ¡ä»¶å˜é‡é‡Šæ”¾çº¿ç¨‹æˆ–è¶…æ—¶åˆ°æœŸæ—¶ï¼Œå°†é‡æ–°è·å–mutex ï¼Œå¹¶è¿”å›condition-waitã€‚\n(condition-signal cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-signalé‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªã€‚\n(condition-broadcast cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-broadcasté‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹\né” é”æ¯”äº’æ–¥é”æ›´åŸç”Ÿï¼Œä½†æ˜¯æ›´åŠ çµæ´»å’Œæœ‰æ•ˆã€‚\nåªè¦é”åœ¨è¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­åˆ†é…ï¼Œå®ƒä»¬è¿˜å¯ä»¥ç‹¬ç«‹äºçº¿ç¨‹ç³»ç»Ÿä½¿ç”¨ï¼ˆåŒ…æ‹¬åœ¨Chez Schemeçš„éçº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼‰ä»¥åœ¨åˆ†ç¦»çš„Schemeè¿›ç¨‹ä¸­æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ é”åªæ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³iptræˆ–uptrå¤–éƒ¨ç±»å‹ï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡è®¡ç®—æœºçš„æœ¬æœºå­—èŠ‚åºï¼Œå¯èƒ½æ˜¯ä½¿ç”¨define-ftypeå®šä¹‰çš„å¤§ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚å¿…é¡»åœ¨é©»ç•™äºSchemeå †å¤–éƒ¨çš„å†…å­˜ä¸­æ˜¾å¼åˆ†é…å®ƒï¼Œå¹¶åœ¨é€‚å½“æ—¶æ˜¾å¼é‡Šæ”¾ã€‚å½“ä»…æ¶‰åŠçº¿ç¨‹æ—¶ï¼ˆå³ï¼Œå½“ä¸æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡foreign-allocåˆ†é…å†…å­˜ã€‚ å½“æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼Œåº”åœ¨è¿›ç¨‹å…±äº«çš„æŸä¸ªåŒºåŸŸä¸­åˆ†é…è¯¥é”ã€‚\nä½¿ç”¨ftype-init-lock! åˆå§‹åŒ–åï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥å°è¯•é€šè¿‡**ftype-lock!æˆ–ftype-spin-lock!é”å®šlock ã€‚ä¸€æ—¦é”å·²è¢«é”å®šå¹¶ä¸”åœ¨è§£é”ä¹‹å‰ï¼Œå³ä½¿é€šè¿‡æœ€è¿‘é”å®šå®ƒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œå†ä¸€æ¬¡å°è¯•é”å®šè¯¥é”ä¹Ÿä¼šå¤±è´¥ã€‚ ä»»ä½•è¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥ä½¿ç”¨ftype-unlock!**æ¥è§£é”lockï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡æœ€è¿‘é”å®šé”çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ¥è§£é”ã€‚\né”æœºåˆ¶æä¾›çš„ç»“æ„å¾ˆå°‘ï¼Œå¹¶ä¸”åˆ†é…å’Œä½¿ç”¨ä¸­çš„é”™è¯¯å¯èƒ½å¯¼è‡´å†…å­˜é”™è¯¯ï¼Œæ­»é”å’Œå…¶ä»–é—®é¢˜ã€‚ å› æ­¤ï¼Œé€šå¸¸å»ºè®®ä»…å°†é”ç”¨ä½œæ›´é«˜çº§åˆ«æŠ½è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æŒ‰è§„èŒƒæ–¹å¼ä½¿ç”¨é”ã€‚\n(define lock (make-ftype-pointer uptr (foreign-alloc (ftype-sizeof uptr)))) (ftype-init-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #t (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-spin-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr index)\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\n**ftype-init-lock!**åº”è¯¥åœ¨ä½¿ç”¨ä»»ä½•å…¶ä»–è¿ç®—ç¬¦ä¹‹å‰ç”¨äºåˆå§‹åŒ–é”ï¼› å¦‚æœä¸è¿™æ ·åšï¼Œåˆ™å…¶ä»–æ“ä½œç¬¦çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚\nftype-lock! å¯ç”¨äºåŠ é”ã€‚å¦‚æœå‘ç°åœ¨æ“ä½œæ—¶é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›#tï¼›å¦‚æœå‘ç°è¯¥é”å·²åŠ é”ï¼Œåˆ™è¿”å›#fä¸”ä¸æ›´æ”¹è¯¥é”ã€‚\nftype-spin-lock! ä¹Ÿå¯ä»¥ç”¨æ¥åŠ é”ã€‚ å¦‚æœåœ¨æ“ä½œæ—¶å‘ç°è¯¥é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›ï¼› å¦‚æœå‘ç°è¯¥é”å·²é”å®šï¼Œå®ƒå°†ä¸€ç›´ç­‰å¾…ç›´åˆ°é”è¢«è§£é”ï¼Œç„¶åå†é”å®šå¹¶è¿”å›ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–è¿›ç¨‹æˆ–è€…çº¿ç¨‹æ¥é‡Šæ”¾è¯¥é”ï¼Œè¯¥æ“ä½œä¸ä¼šè¿”å›ä¸”ä¸èƒ½ä»¥æ­£å¸¸çš„æ–¹å¼ï¼ˆåŒ…æ‹¬GCï¼‰ä¸­æ–­ã€‚ä¹Ÿä¸ä¿è¯å…¬å¹³ï¼Œå› æ­¤å³ä½¿å…¶ä»–è¿›ç¨‹æ­£åœ¨ä¸»åŠ¨é”å®šå’Œé‡Šæ”¾è¯¥é”ï¼Œè¿›ç¨‹ä¹Ÿå¯èƒ½æ— é™æœŸæŒ‚èµ·ã€‚\nftype-unlock! ç”¨äºè§£é”ã€‚å¦‚æœå‘ç°é”å·²è¢«é”å®šï¼Œåˆ™å°†å…¶è§£é”å¹¶è¿”å›ã€‚ å¦åˆ™ï¼Œå®ƒå°†è¿”å›è€Œä¸æ›´æ”¹é”ã€‚\nåŸå­æ“ä½œLocked increment and decrement å½“éœ€è¦åŸå­é€’å¢æˆ–é€’å‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¤„æè¿°çš„é”å®šæ“ä½œã€‚\n(ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\n(ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\nftype-locked-incr! è‡ªåŠ¨è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œå°†å€¼åŠ 1ï¼Œç„¶åå°†æ–°å€¼å†™å›è¯¥å­—æ®µã€‚ åŒæ ·ï¼Œftype-locked-decr! åŸå­è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œä»è¯¥å€¼ä¸­å‡å»1ï¼Œç„¶åå°†æ–°å€¼å†™å›åˆ°è¯¥å­—æ®µä¸­ã€‚ å¦‚æœæ–°å€¼ä¸º0ï¼Œåˆ™ä¸¤è€…éƒ½è¿”å›#tï¼Œå¦åˆ™è¿”å›#fã€‚\nå¼•ç”¨è®¡æ•° åœ¨Schemeå †ä¹‹å¤–ç®¡ç†å†…å­˜çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨Schemeå­˜å‚¨ç®¡ç†ç³»ç»Ÿé€šè¿‡ftype guardians æ‰§è¡Œå¼•ç”¨è®¡æ•°ã€‚ åœ¨å¼•ç”¨è®¡æ•°çš„å†…å­˜ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¿å­˜ç€æŒ‡å‘å®ƒçš„æŒ‡é’ˆè®¡æ•°ã€‚ å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å¢åŠ ï¼›è€Œåœ¨åˆ é™¤æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å‡å°ã€‚ å½“è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œä¸å†éœ€è¦è¯¥å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç”¨äºå…¶ä»–ç›®çš„ã€‚\n(ftype-guardian ftype-name)\nftype-name å¿…é¡»å‘½åä¸€ä¸ªftypeã€‚ ftypeçš„ç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼ˆæˆ–åœ¨unionsçš„æƒ…å†µä¸‹ä¸ºç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼‰å¿…é¡»æ˜¯å…·æœ‰æœ¬åœ°å°¾æ•°çš„å­—é•¿æ•´æ•°ï¼ˆiptræˆ–uptrï¼‰ã€‚ å‡å®šæ­¤å­—æ®µä¿å­˜å¼•ç”¨è®¡æ•°ã€‚\nè¿”å›æ–°çš„ftype guardian g ï¼Œå¯ä»¥ä½¿ç”¨å…¶æ³¨å†Œftype-name ç±»å‹ï¼ˆæˆ–ftype-nam eçš„æŸäº›å­ç±»å‹ï¼‰çš„ftype-pointerã€‚ é€šè¿‡ä½¿ç”¨ftypeæŒ‡é’ˆä½œä¸ºå‚æ•°è°ƒç”¨g ï¼Œå¯ä»¥å‘g æ³¨å†ŒftypeæŒ‡é’ˆã€‚\nftype guardianä¸ä¼šåƒæ™®é€šçš„guardiané‚£æ ·è‡ªåŠ¨ä¿æŠ¤å…¶æ³¨å†Œçš„ftypeæŒ‡é’ˆå…é­å›æ”¶ã€‚è€Œæ˜¯ï¼Œå¯¹äºæ¯ä¸ªé€šè¿‡æ™®é€šï¼ˆéå¼±ï¼Œéç›‘æŠ¤äººæŒ‡é’ˆï¼‰å˜å¾—ä¸å¯è®¿é—®çš„å·²æ³¨å†Œçš„ftypeæŒ‡é’ˆï¼Œguardianä¼šå‡å°‘ftypeæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å€¼ä¸º0ï¼Œåˆ™ftypeæŒ‡é’ˆå°†ä¿ç•™å¹¶å¯ä»¥ä»guardianä¸­æ£€ç´¢ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆçš„å¼•ç”¨è®¡æ•°å€¼éé›¶ï¼Œåˆ™ä¸ä¼šä¿ç•™ftypeæŒ‡é’ˆã€‚å‡è®¾å›æ”¶å™¨å¤–éƒ¨çš„ä»£ç æ­£ç¡®ç»´æŠ¤äº†å¼•ç”¨è®¡æ•°ï¼Œåˆ™ä»ftype guardianæ£€ç´¢çš„å¯¹è±¡ï¼ˆé€šè¿‡ä¸å¸¦å‚æ•°çš„è°ƒç”¨ï¼‰å°†ç¡®ä¿å…·æœ‰0å¼•ç”¨è®¡æ•°ã€‚å›æ”¶å™¨ä½¿ç”¨ç­‰æ•ˆçš„ftype-locked-decr!æ¥å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œä»¥æ”¯æŒç”±å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­çš„éSchemeå¯¹è±¡ã€‚åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œç¨‹åºæœ¬èº«åº”ä½¿ç”¨ftype-locked-incr! å’Œftype-locked-decr! æˆ–éSchemeç­‰æ•ˆé¡¹ï¼ˆä¾‹å¦‚ï¼Œç¬¬4.8èŠ‚ä¸­æ‰€è¿°Cè¯­è¨€çš„scheme.hä¸­çš„ LOCKED_INCRå’ŒLOCKED_DECRå®ï¼‰æ¥ç»´æŠ¤å¼•ç”¨è®¡æ•°ã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä¸ºftypeå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ftypeå’Œä¸€ä¸ªåˆ†é…å™¨ï¼Œè¯¥å¯¹è±¡é‡Šæ”¾ä»¥å‰åˆ†é…çš„ä¸”ä¸å†å¯è®¿é—®çš„ftypeå¯¹è±¡ã€‚\nmodule (A make-A free-dropped-As) (define-ftype A (struct [refcount uptr] [data int])) (define g (ftype-guardian A)) (define free-dropped-As (lambda () (let ([a (g)]) (when a (printf \u0026#34;freeing ~s\\n\u0026#34; (ftype-ref A (data) a)) (foreign-free (ftype-pointer-address a)) (free-dropped-As))))) (define make-A (lambda (n) (free-dropped-As) (let ([a (make-ftype-pointer A (foreign-alloc (ftype-sizeof A)))]) (ftype-set! A (refcount) a 1) (ftype-set! A (data) a n) (g a) a)))) æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…ï¼Œä¸¢å¼ƒå¹¶ç«‹å³å›æ”¶æŒ‡å‘Açš„ftypeæŒ‡é’ˆè¿›è¡Œæµ‹è¯•ã€‚\n\u0026gt; (do ([i 10 (fx- i 1)]) ((fx= i 0)) (make-A i) (collect)) freeing 10 freeing 9 freeing 8 freeing 7 freeing 6 freeing 5 freeing 4 freeing 3 freeing 2 \u0026gt; (free-dropped-As) freeing 1 ç”±ftype guardianä¿æŠ¤çš„å¯¹è±¡å¯èƒ½åŒ…å«æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¿™äº›å…¶ä»–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¹Ÿåº”åœ¨åˆ†é…åŒ…å«å¯¹è±¡æ—¶å¢åŠ ï¼Œå¹¶åœ¨é‡Šæ”¾åŒ…å«å¯¹è±¡æ—¶å‡å°‘ã€‚\nçº¿ç¨‹å‚æ•° (make-thread-parameter object) | (make-thread-parameter object procedure)\nåˆ›å»ºçº¿ç¨‹å‚æ•°åï¼Œå°†åœ¨æ¯ä¸ªå½“å‰çº¿ç¨‹å’Œå°†æ¥çš„çº¿ç¨‹ä¸­æ”¾ç½®ä¸€ä¸ªå•ç‹¬çš„ä½ç½®ï¼Œä»¥ä¿å­˜å‚æ•°çš„å†…éƒ¨çŠ¶æ€å˜é‡çš„å€¼ã€‚ ï¼ˆå½“è¯¥å‚æ•°å˜å¾—ä¸å¯è®¿é—®æ—¶ï¼Œå­˜å‚¨ç®¡ç†å™¨å¯ä»¥æ¶ˆé™¤è¯¥ä½ç½®ã€‚ï¼‰ä¸€ä¸ªçº¿ç¨‹ä¸­å¯¹çº¿ç¨‹å‚æ•°çš„æ›´æ”¹ä¸ä¼šè¢«å…¶ä»–ä»»ä½•çº¿ç¨‹çœ‹åˆ°ã€‚\nåˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼ˆè¯·å‚é˜…fork-threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»æ´¾ç”Ÿçº¿ç¨‹ç»§æ‰¿ã€‚ ç±»ä¼¼åœ°ï¼Œå½“ç¬¬ä¸€æ¬¡æ¿€æ´»é€šè¿‡å…¶ä»–æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ—¶ï¼ˆè¯·å‚è§4.8èŠ‚ä¸­çš„Sactivate_threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»ä¸»ï¼ˆåŸå§‹ï¼‰çº¿ç¨‹ç»§æ‰¿ã€‚\nå¤§å¤šæ•°å†…ç½®å‚æ•°æ˜¯çº¿ç¨‹å‚æ•°ï¼Œä½†æœ‰äº›æ˜¯å…¨å±€çš„ã€‚ åœ¨ä»–ä»¬å®šä¹‰çš„åœ°æ–¹å·²ç»æ ‡æ³¨äº†æ˜¯çº¿ç¨‹çš„è¿˜æ˜¯å…¨å±€çš„ã€‚ åœ¨éçº¿ç¨‹ç‰ˆæœ¬çš„Chez Schemeä¸­ï¼Œå†…ç½®å…¨å±€å‚æ•°å’Œçº¿ç¨‹å‚æ•°ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚\nI/O ç¼“å†²åŒº Chez Schemeä¸ºæé«˜æ•ˆç‡è€Œç¼“å†²æ–‡ä»¶I/Oæ“ä½œï¼Œä½†æ˜¯ç¼“å†²çš„I/Oä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç¼“å†²ç«¯å£å¯èƒ½ä¼šç ´åè¯¥ç«¯å£ï¼Œä»è€Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶æœ€ç»ˆå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ã€‚\nå½“ä»¥ç¼“å†²æ¨¡å¼noneæ‰“å¼€æ—¶ï¼Œå¯ä»¥ç¦ç”¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ä¸Šçš„ç¼“å†²ã€‚ ä½†æ˜¯ï¼Œç”±äºéœ€è¦æ”¯æŒå…ˆè¡Œï¼ˆlookaheadï¼‰ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨è¾“å…¥ç«¯å£ä¸Šçš„ç¼“å†²ï¼Œå¹¶ä¸”ç”±äºè¦åœ¨å­—ç¬¦å’Œå­—èŠ‚ä¹‹é—´è¿›è¡Œè½¬æ¢çš„ä»£ç è½¬æ¢å™¨æœ‰æ—¶éœ€è¦å…ˆè¡Œè¾“å…¥ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨æ–‡æœ¬ç«¯å£ï¼ˆç”šè‡³æ˜¯æ–‡æœ¬è¾“å‡ºç«¯å£ï¼‰ä¸Šçš„ç¼“å†²ã€‚\nå› æ­¤ï¼Œé™¤éåœ¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£å¼€å¯ç¼“å†²æ¨¡å¼ä¸ºnoneçš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦åˆ™ä¸¤ä¸ªçº¿ç¨‹ç»ä¸åº”è¯¥å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç«¯å£ã€‚æ›¿ä»£æ–¹æ³•åŒ…æ‹¬æŒ‡å®šä¸€ä¸ªçº¿ç¨‹ä¸ºç»™å®šç«¯å£æ‰§è¡Œæ‰€æœ‰I / Oï¼Œå’Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›é€šç”¨ç«¯å£åŒ…è£…ç¨‹åºï¼Œä»…åœ¨è·å–äº’æ–¥é‡åæ‰å°†è¯·æ±‚è½¬å‘åˆ°ç«¯å£ã€‚\nåˆå§‹çš„æ§åˆ¶å°ä»¥åŠå½“å‰çš„è¾“å…¥å’Œè¾“å‡ºç«¯å£ä»¥åŠtranscriptç«¯å£éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¤šä¸ªçº¿ç¨‹å‘æ§åˆ¶å°æ‰“å°é”™è¯¯å’Œ/æˆ–è°ƒè¯•æ¶ˆæ¯æ˜¯å®‰å…¨çš„ã€‚å³ä½¿åœ¨åŒä¸€è¡Œå†…ï¼Œè¾“å‡ºä¹Ÿå¯èƒ½æ˜¯äº¤é”™çš„ï¼Œä½†æ˜¯ç«¯å£ä¸ä¼šæŸåã€‚ è¿™äº›ç«¯å£çš„çº¿ç¨‹å®‰å…¨æ€§æ˜¯é€šè¿‡ä¸ºæ¯ä¸ªI/Oæ“ä½œè·å–ä¸€ä¸ªäº’æ–¥é”çš„é«˜æˆæœ¬æ¥å®ç°çš„ã€‚\nå®ä¾‹ï¼šæœ‰ç•Œé˜Ÿåˆ— ä»¥ä¸‹ä»£ç æ‘˜è‡ªæ–‡ç« â€œA Scheme for native threads1â€ï¼Œå®ƒä½¿ç”¨è®¸å¤šçº¿ç¨‹ç³»ç»ŸåŠŸèƒ½å®ç°äº†æœ‰ç•Œé˜Ÿåˆ—ã€‚ æœ‰ç•Œé˜Ÿåˆ—å…·æœ‰å›ºå®šæ•°é‡çš„å¯ç”¨æ’æ§½ã€‚ å½“é˜Ÿåˆ—å·²æ»¡æ—¶å°è¯•å…¥é˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚ å°è¯•ä»ç©ºé˜Ÿåˆ—ä¸­å‡ºé˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚\n(define-record-type bq (fields (immutable data) (mutable head) (mutable tail) (immutable mutex) (immutable ready) (immutable room)) (protocol (lambda (new) (lambda (bound) (new (make-vector bound) 0 0 (make-mutex) (make-condition) (make-condition)))))) (define dequeue! (lambda (q) (with-mutex (bq-mutex q) (let loop () (let ([head (bq-head q)]) (cond [(= head (bq-tail q)) (condition-wait (bq-ready q) (bq-mutex q)) (loop)] [else (bq-head-set! q (incr q head)) (condition-signal (bq-room q)) (vector-ref (bq-data q) head)])))))) (define enqueue! (lambda (item q) (with-mutex (bq-mutex q) (let loop () (let* ([tail (bq-tail q)] [tail^ (incr q tail)]) (cond [(= tail^ (bq-head q)) (condition-wait (bq-room q) (bq-mutex q)) (loop)] [else (vector-set! (bq-data q) tail item) (bq-tail-set! q tail^) (condition-signal (bq-ready q))])))))) (define incr (lambda (q i) (modulo (+ i 1) (vector-length (bq-data q))))) ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æœ‰ç•Œé˜Ÿåˆ—åœ¨ä¸€ç»„çº¿ç¨‹ä¸­çš„åº”ç”¨ï¼Œè¿™äº›çº¿ç¨‹åˆ†åˆ«æ‰®æ¼”æ•°æ®çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ã€‚\n(define job-queue) (define die? #f) (define make-job (let ([count 0]) (define fib (lambda (n) (if (\u0026lt; n 2) n (+ (fib (- n 2)) (fib (- n 1)))))) (lambda (n) (set! count (+ count 1)) (printf \u0026#34;Adding job #~s = (lambda () (fib ~s))\\n\u0026#34; count n) (cons count (lambda () (fib n)))))) (define make-producer (lambda (n) (rec producer (lambda () (printf \u0026#34;producer ~s posting a job\\n\u0026#34; n) (enqueue! (make-job (+ 20 (random 10))) job-queue) (if die? (printf \u0026#34;producer ~s dying\\n\u0026#34; n) (producer)))))) (define make-consumer (lambda (n) (rec consumer (lambda () (printf \u0026#34;consumer ~s looking for a job~%\u0026#34; n) (let ([job (dequeue! job-queue)]) (if die? (printf \u0026#34;consumer ~s dying\\n\u0026#34; n) (begin (printf \u0026#34;consumer ~s executing job #~s~%\u0026#34; n (car job)) (printf \u0026#34;consumer ~s computed: ~s~%\u0026#34; n ((cdr job))) (consumer)))))))) (define (bq-test np nc) (set! job-queue (make-bq (max nc np))) (do ([np np (- np 1)]) ((\u0026lt;= np 0)) (fork-thread (make-producer np))) (do ([nc nc (- nc 1)]) ((\u0026lt;= nc 0)) (fork-thread (make-consumer nc)))) è¿™æ˜¯ç¤ºä¾‹ç¨‹åºè¿è¡Œåçš„å¯èƒ½çš„å‰å‡ è¡Œè¾“å‡ºï¼š\n\u0026gt; (begin (bq-test 3 4) (system \u0026#34;sleep 3\u0026#34;) (set! die? #t)) producer 3 posting a job Adding job #1 = (lambda () (fib 29)) producer 3 posting a job Adding job #2 = (lambda () (fib 26)) producer 3 posting a job Adding job #3 = (lambda () (fib 22)) producer 3 posting a job Adding job #4 = (lambda () (fib 21)) producer 2 posting a job Adding job #5 = (lambda () (fib 29)) producer 1 posting a job Adding job #6 = (lambda () (fib 29)) consumer 4 looking for a job producer 3 posting a job Adding job #7 = (lambda () (fib 24)) consumer 4 executing job #1 consumer 3 looking for a job producer 2 posting a job Adding job #8 = (lambda () (fib 26)) consumer 3 executing job #2 consumer 3 computed: 121393 consumer 3 looking for a job producer 1 posting a job Adding job #9 = (lambda () (fib 26)) ... åœ¨â€œA Scheme for native threads1â€ä¸­ç»™å‡ºäº†å…¶ä»–ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¯æ‚¬æŒ‚çº¿ç¨‹çš„å®šä¹‰å’Œåœ¨æ— æ³•è®¿é—®æ—¶è‡ªåŠ¨ç»ˆæ­¢çš„çº¿ç¨‹ã€‚\nR. Kent Dybvig. A Scheme for native threads. In Symposium in Honor of Mitchell Wand, August 2009. http://www.ccs.neu.edu/events/wand-symposium/.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":56,"section":"posts","summary":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹","tags":["thread","scheme"],"title":"çº¿ç¨‹ï¼ˆThread System in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/thread/","year":"2020"},{"content":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å›æ”¶ä¸è¯¥å¯¹è±¡å…³è”çš„å­˜å‚¨ã€‚ ä¸ºäº†å›æ”¶æ­¤å­˜å‚¨ï¼ŒChez Schemeä½¿ç”¨äº†ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¯¥åƒåœ¾æ”¶é›†å™¨åœ¨ç¨‹åºè¿è¡Œæ—¶å®šæœŸè¿è¡Œã€‚ åƒåœ¾æ”¶é›†å™¨ä»ä¸€ç»„å·²çŸ¥çš„æ ¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœºå™¨æ³¨å†Œï¼‰ï¼ŒæŸ¥æ‰¾æ‰€æœ‰å¯è®¿é—®å¯¹è±¡ï¼Œå¹¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¤åˆ¶å®ƒä»¬ï¼Œä»¥æ¶ˆé™¤å¯è®¿é—®å¯¹è±¡ä¹‹é—´çš„ç¢ç‰‡ï¼Œå¹¶å›æ”¶ä¸å¯è®¿é—®å¯¹è±¡æ‰€å ç”¨çš„å­˜å‚¨ã€‚\nå›æ”¶ç”±é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºè‡ªåŠ¨è§¦å‘ï¼Œè¯¥å¤„ç†ç¨‹åºé€šè¿‡collect-requestä¸­æ–­è°ƒç”¨ï¼Œè¯¥ä¸­æ–­åœ¨åˆ†é…äº†å¤§çº¦nä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´åå‘ç”Ÿï¼Œå…¶ä¸­næ˜¯å‚æ•°collect-trip-bytes çš„å€¼ã€‚ é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºé€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectç¨‹åºæ¥è¿›è¡Œä¼šç¡ã€‚ å¯ä»¥é€šè¿‡æ›´æ”¹å‚æ•°collect-request-handler çš„å€¼æ¥é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºã€‚ ç¨‹åºè¿˜å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨collectæ¥å¯¼è‡´åœ¨collect-requestä¸­æ–­ä¹‹é—´å‘ç”Ÿå›æ”¶ã€‚\nChez Schemeçš„å›æ”¶å™¨æ˜¯åŸºäºåˆ†ä»£ çš„ã€‚å®ƒæ ¹æ®å¯¹è±¡çš„å¹´é¾„ï¼ˆå¤§è‡´æ¥è¯´ï¼Œå›æ”¶å¹¸å­˜æ•°ï¼‰æ¥å¯¹å¯¹è±¡è¿›è¡Œåˆ†ç±»ï¼Œä¸”è€å¯¹è±¡æ¯”å¹´è½»å¯¹è±¡å›æ”¶çš„é¢‘ç‡è¦ä½ã€‚ç”±äºå¹´è½»å¯¹è±¡æ¯”è€å¯¹è±¡æ›´å¿«åœ°å˜ä¸ºä¸å¯è®¿é—®ï¼Œå› æ­¤ç»“æœæ˜¯å¤§å¤šæ•°çš„å›æ”¶èŠ±è´¹çš„æ—¶é—´æ›´å°‘ã€‚ç³»ç»Ÿè¿˜ç»´æŠ¤ä¸€ä¸ªé™æ€ä»£ï¼ˆstatic generation, ç±»ä¼¼Javaçš„æ°¸ä¹…ä»£ï¼‰ï¼Œä¸ä¼šå¯¹æ­¤å­˜å‚¨è¿›è¡Œå›æ”¶ã€‚ä»…å½“å‹ç¼©å †ï¼ˆScompact_heapï¼‰æˆ–è¦collectçš„target-generation å‚æ•°ä¸ºstaticç¬¦å·æ—¶ï¼Œæ‰å°†å¯¹è±¡æ”¾å…¥é™æ€ä»£ä¸­ã€‚\néé™æ€ä»£çš„ç¼–å·ä»æœ€å¹´è½»çš„ä¸–ä»£ï¼ˆå¼€å§‹äº0ï¼‰åˆ°collect-maximum-generationçš„å½“å‰å€¼ã€‚å­˜å‚¨ç®¡ç†å™¨å°†æ–°åˆ†é…çš„å¯¹è±¡æ”¾å…¥ç¬¬0ä»£ã€‚åœ¨ç¬¬0ä»£çš„å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ç¬¬0ä»£çš„å¯¹è±¡æŒªåˆ°ç¬¬1ä»£ï¼Œç±»ä¼¼åœ°ï¼Œåœ¨ç¬¬1ä»£å›æ”¶æœŸé—´ï¼Œå­˜æ´»çš„ç¬¬0ä»£å’Œç¬¬1ä»£å¯¹è±¡ç§»åŠ¨åˆ°ç¬¬2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨æœ€å¤§éé™æ€å¯¹è±¡å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å¹¸å­˜çš„éé™æ€å¯¹è±¡éƒ½å°†ç§»åŠ¨ï¼ˆå¯èƒ½è¿”å›ï¼‰åˆ°æœ€å¤§éé™æ€ä»£ä¸­ã€‚ é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡æœ‰å¯èƒ½è·³è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ï¼Œä½†è¿™åœ¨è®¸å¤šå¯¹è±¡ä¸Šä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œå¹¶ä¸”å¦‚æœè¿™äº›å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œåˆ™æœ€ç»ˆå°†å›æ”¶å®ƒä»¬çš„å­˜å‚¨ã€‚\nç»´æŠ¤å†…éƒ¨è®¡æ•°å™¨gc-tripæ¥æ§åˆ¶ä½•æ—¶å›æ”¶æ¯ä¸€ä»£ã€‚ æ¯æ¬¡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collect æ—¶ï¼ˆä»é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºå¼€å§‹ï¼‰ï¼Œgc-tripéƒ½ä¼šåŠ 1ã€‚åœ¨collect-generationåŸºæ•°ä¸ºr çš„æƒ…å†µä¸‹ï¼Œå›æ”¶çš„ä¸–ä»£ç¼–å·ä¸ºg ï¼Œå…¶gc-tripæ˜¯$r^g$çš„å€æ•°ã€‚ å¦‚æœå°†collect-generation-radixè®¾ç½®ä¸º4ï¼Œåˆ™ç³»ç»Ÿå°†æ¯æ¬¡æ”¶é›†0ä»£ï¼Œæ¯4æ¬¡æ”¶é›†1ä»£ï¼Œæ¯16æ¬¡æ”¶é›†2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚\næ¯æ¬¡æŸä¸ªä¸–ä»£g è°ƒç”¨collectæ—¶ï¼Œè¯¥ä¸–ä»£g è¢«å›æ”¶ä¸”gc-tripå‰è¿›åˆ°ä¸‹ä¸ª$r^g$çš„è¾¹ç•Œï¼Œä½†æ˜¯ä¸ä¼šè¶…è¿‡$r^{g+1}$çš„è¾¹ç•Œï¼Œr ä¸å˜è¿˜æ˜¯collect-generation-radixçš„å€¼ã€‚\nå¦‚æœä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°tg è°ƒç”¨collectï¼Œåˆ™tg ç¡®å®šç›®æ ‡ä»£ã€‚ å½“g æ˜¯æœ€å¤§çš„éé™æ€ä»£æ—¶ï¼Œtg å¿…é¡»ä¸ºg æˆ–ä¸ºstaticã€‚ å¦åˆ™ï¼Œtg å¿…é¡»ä¸ºg æˆ–g + 1 ã€‚ å½“ç›®æ ‡ä»£æ˜¯staticç¬¦å·æ—¶ï¼Œéé™æ€ä»£ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å°†ç§»åŠ¨åˆ°é™æ€ä»£ä¸­ã€‚é™æ€ä»£ä¸­çš„å¯¹è±¡ä»ä¸ä¼šè¢«å›æ”¶ã€‚ è¿™åœ¨åŠ è½½å’Œåˆå§‹åŒ–åº”ç”¨ç¨‹åºçš„æ°¸ä¹…ä»£ç å’Œæ•°æ®ç»“æ„ä¹‹åéå¸¸æœ‰ç”¨ï¼Œä»¥å‡å°‘åç»­å›æ”¶çš„å¼€é”€ã€‚\né€šè¿‡è®¾ç½®æœ¬èŠ‚ä¸­æè¿°çš„å‚æ•°ï¼Œå¯ä»¥å¯¹å›æ”¶å™¨çš„è¡Œä¸ºè¿›è¡Œå®è´¨æ€§çš„è°ƒæ•´ã€‚é€šè¿‡é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºä¸”ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectï¼Œç”šè‡³æœ‰å¯èƒ½å®Œå…¨è¦†ç›–æ”¶é›†å™¨çš„é»˜è®¤ç­–ç•¥æ¥ç¡®å®šä½•æ—¶å›æ”¶æ¯ä¸ªä¸–ä»£ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectæ¥é‡æ–°å®šä¹‰å¤„ç†ç¨‹åºï¼Œä»¥åœ¨é•¿æ—¶é—´å†…å°†æœ€å¤§çš„éé™æ€ä»£è§†ä¸ºé™æ€ä»£ï¼Œè¯¥å‚æ•°åœ¨è¯¥æ—¶é—´æ®µå†…ç»ä¸ç­‰äºæœ€å¤§çš„éé™æ€ä»£ã€‚\n(collect) | (collect g) | (collect g tg)\ng å¿…é¡»æ˜¯ä¸å¤§äºæœ€å¤§éé™æ€ä»£ï¼ˆcollect-maximum-generationè¿”å›çš„å€¼ï¼‰çš„éè´Ÿç¡®å®šç¼–å·ã€‚ å¦‚æœg å·²ç»æ˜¯æœ€å¤§çš„éé™æ€ä»£ç¼–å·ï¼Œåˆ™tg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg çš„fixnumæˆ–staticç¬¦å·ã€‚ å¦åˆ™ï¼Œtg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg æˆ–å¤§äºg çš„fixnumã€‚\næ­¤è¿‡ç¨‹ä½¿å­˜å‚¨ç®¡ç†å™¨æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚ collectæ˜¯é€šè¿‡collect-requestå¤„ç†ç¨‹åºå®šæœŸè°ƒç”¨çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¾å¼è°ƒç”¨å®ƒï¼Œä»¥åœ¨ç‰¹å®šæ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨è®¡æ—¶è®¡ç®—ä¹‹å‰ï¼‰å¼ºåˆ¶è¿›è¡Œå›æ”¶ã€‚ åœ¨Chez Schemeçš„çº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼Œè°ƒç”¨collectçš„çº¿ç¨‹å¿…é¡»æ˜¯å”¯ä¸€çš„æ´»åŠ¨çº¿ç¨‹ã€‚\nç³»ç»Ÿå°†æ ¹æ®g å’Œtg ï¼ˆå¦‚æœæä¾›ï¼‰ç¡®å®šå›æ”¶å“ªäº›ä¸–ä»£ï¼Œå¦‚æœ¬èŠ‚çš„ä»‹ç»ä¸­æ‰€è¿°ã€‚\n(collect-rendezvous)\nè¯·æ±‚åƒåœ¾å›æ”¶çš„æ–¹å¼åº”è¯¥ä¸ç”±ç³»ç»Ÿè‡ªåŠ¨å‘èµ·çš„GCçš„æ–¹å¼ç›¸ä¸€è‡´ã€‚æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ç»è¿‡åè°ƒï¼Œä»¥ä¾¿å…¶ä¸­ä¸€ä¸ªè°ƒç”¨collect-requestå¤„ç†ç¨‹åºï¼Œè€Œå…¶ä»–çº¿ç¨‹æš‚åœç›´åˆ°å¤„ç†ç¨‹åºè¿”å›ã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœcollect-requestå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…collect-request-handlerï¼‰æ²¡æœ‰è°ƒç”¨collectï¼Œé‚£ä¹ˆcollect-rendezvouså®é™…ä¸Šä¸ä¼šæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚\ncollect-notify\nå¦‚æœå°†collect-notifyè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¯å½“è¿è¡ŒGCæ—¶ï¼Œå›æ”¶å™¨éƒ½ä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-notifyè®¾ç½®ä¸º#fã€‚\ncollect-trip-bytes\nChez Schemeåœ¨å†…éƒ¨ä»¥å¤§å—åˆ†é…å†…å­˜ï¼Œå¹¶é€šè¿‡å†…è”æ“ä½œå°†è¿™äº›å—ç»†åˆ†ä»¥æé«˜æ•ˆç‡ã€‚å­˜å‚¨ç®¡ç†å™¨ç¡®å®šæ˜¯å¦ä¸ºæ¯ä¸ªåˆ†é…çš„å¤§å—ä»…è¯·æ±‚ä¸€æ¬¡å›æ”¶ã€‚æ­¤å¤–ï¼Œåœ¨å­˜å‚¨ç®¡ç†å™¨è¯·æ±‚å›æ”¶å’Œå…‘ç°å›æ”¶è¯·æ±‚ä¹‹é—´å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå°¤å…¶æ˜¯å¦‚æœé€šè¿‡with-interrupts-disabledæˆ–disable-interruptsä¸´æ—¶ç¦ç”¨äº†ä¸­æ–­æ—¶ã€‚å› æ­¤ï¼Œcollect-trip-bytesä»…æ˜¯ä¸€ç§è¿‘ä¼¼åº¦é‡ã€‚\ncollect-generation-radix\næ­¤å‚æ•°ç¡®å®šé»˜è®¤æƒ…å†µä¸‹çš„collect-requestå¤„ç†ç¨‹åºè°ƒç”¨ä¸å¸¦å‚æ•°çš„collectæ—¶å›æ”¶æ¯ä¸€ä»£çš„é¢‘ç‡ã€‚æ¯$r^g$æ¬¡å‘ç”Ÿä¸€æ¬¡å¯¹åº”ä¸–ä»£çš„å›æ”¶ï¼Œå…¶ä¸­r æ˜¯collect-generation-radixçš„å€¼ï¼Œg æ˜¯ä¸–ä»£æ•°ã€‚\nå°†collect-generation-radixè®¾ç½®ä¸º1ä¼šå¼ºåˆ¶æ‰€æœ‰ä¸–ä»£æ¯æ¬¡éƒ½è¢«å›æ”¶ï¼Œ å°†collect-generation-radixè®¾ç½®ä¸ºéå¸¸å¤§çš„æ•°ç›®å°†æ— é™æœŸæœ‰æ•ˆåœ°å»¶è¿Ÿè¾ƒæ—©çš„ä¸€ä»£çš„å›æ”¶ã€‚\ncollect-maximum-generation\næ­¤å‚æ•°ç¡®å®šå½“å‰å¯ä»¥ä½¿ç”¨çš„æœ€å¤§éé™æ€ä¸–ä»£æ•°,å®ƒçš„å€¼æ˜¯1åˆ°254èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œä»…ä½¿ç”¨ä¸¤ä¸ªéé™æ€ç”Ÿæˆã€‚ è®¾ç½®ä¸º2æ—¶ï¼Œå°†ä½¿ç”¨ä¸‰ä¸ªéé™æ€ä¸–ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚ å½“è®¾ç½®ä¸º254æ—¶ï¼Œå°†ä½¿ç”¨255ä¸ªéé™æ€ä»£ï¼Œå†åŠ ä¸Šä¸€ä¸ªé™æ€ä»£ï¼Œæ€»å…±256ä¸ªä¸–ä»£ã€‚å¢åŠ ä¸–ä»£æ•°å¯ä»¥å‡å°‘äº†æ”¶é›†æ—§å¯¹è±¡çš„é¢‘ç‡ï¼Œæ½œåœ¨åœ°å‡å°‘äº†æ”¶é›†å¼€é”€ï¼Œä½†åŒæ—¶ä¹Ÿæ½œåœ¨åœ°å¢åŠ äº†ç³»ç»Ÿä¸­ä¿ç•™çš„ä¸å¯è®¿é—®å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œå¢åŠ äº†æ‰€éœ€çš„å†…å­˜æ€»é‡ã€‚\ncollect-request-handler\ncollect-request-handlerçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“ç³»ç»Ÿè®¤ä¸ºåº”è¯¥è¦è¿›è¡ŒGCæ—¶ï¼ˆå³ï¼Œè‡ªä¸Šæ¬¡GCä»¥æ¥ï¼Œç³»ç»Ÿåˆ†é…äº†ç”±å‚æ•°collect-trip-bytesè§„å®šçš„å­˜å‚¨é‡ä¹‹åï¼‰ï¼Œè¯¥è¿‡ç¨‹åœ¨ä¸å¸¦å‚æ•°çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-request-handlerä»…è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectã€‚ å¯ä»¥é€šè¿‡å°†collect-request-handlerè®¾ç½®ä¸ºä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„è¿‡ç¨‹æ¥ç¦ç”¨è‡ªåŠ¨æ”¶é›†ï¼Œä¾‹å¦‚ï¼š\n(collect-request-handler void) ä¹Ÿå¯ä»¥åˆ©ç”¨é˜²æ­¢ä»»ä½•ä¸­æ–­çš„critical-sectionæ¥ä¸´æ—¶ç¦ç”¨GC\nrelease-minimum-generation\næ­¤å‚æ•°çš„å€¼å¿…é¡»ä»‹äº0åˆ°collect-maximum-generationçš„å€¼ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹é—´ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºcollect-maximum-generationçš„å€¼ã€‚\nå½“åˆ†é…æ–°æ•°æ®ä¸”è¿›è¡ŒGCæ—¶ï¼Œstorage-managementä¼šè‡ªåŠ¨åœ°ä»æ“ä½œç³»ç»Ÿä¸­è¯·æ±‚é¢å¤–çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ç›¸åº”åœ°ï¼Œåœ¨å †æ˜¾è‘—å‡å°çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå°è¯•å°†å…ˆå‰ä»æ“ä½œç³»ç»Ÿè·å¾—çš„æŸäº›è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä»…åœ¨é’ˆå¯¹æœ€å¤§éé™æ€æ—¶ä»£çš„GCä¹‹åæ‰è¿™æ ·åšã€‚ä¹Ÿå¯ä»¥è®©ç³»ç»Ÿåœ¨å¯¹æ›´å¹´è½»çš„ä¸–ä»£å›æ”¶ä¹‹åå°±æ‰§è¡Œæ­¤æ“ä½œï¼Œæ–¹æ³•æ˜¯å°†release-minimum-generationçš„å€¼æ›´æ”¹ä¸ºå°äºcollect-maximum-generationçš„å€¼ã€‚ç”±å‚æ•°æŒ‡å®šçš„ä¸–ä»£ï¼Œæˆ–è€…ä»»ä½•è¾ƒè€çš„ä¸–ä»£æ˜¯GCçš„ç›®æ ‡ä¸–ä»£æ—¶ï¼Œå­˜å‚¨ç®¡ç†ç³»ç»Ÿå°†åœ¨GCä¹‹åå°è¯•å°†ä¸éœ€è¦çš„è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\nå½“collect-maximum-generationè®¾ç½®ä¸ºä¸€ä¸ªæ–°å€¼g æ—¶ï¼Œrelease-minimum-generationä¹ŸåŒæ—¶éšå¼åœ°æ›´æ”¹ä¸ºg ï¼Œæœ‰ä¸¤ä¸ªå‰æï¼šï¼ˆaï¼‰ä¿®æ”¹å‰è¿™ä¸¤ä¸ªå‚æ•°å…·æœ‰ç›¸åŒçš„å€¼ï¼›ï¼ˆbï¼‰release-minimum-generationçš„å€¼å¤§äºg\nheap-reserve-ratio\næ­¤å‚æ•°ç¡®å®šäº†ä¿ç•™çš„å†…å­˜çš„å¤§æ¦‚æ•°é‡ï¼ˆæ²¡æœ‰è¿”å›ç»™OSï¼Œå¦‚release-minimum-generationæ‰€æè¿°çš„ï¼‰ä¸å½“å‰å·²å ç”¨çš„å†…å­˜é‡ï¼ˆä¸åŒ…å«å·²å˜ä¸ºé™æ€çš„å†…å­˜åŒºåŸŸï¼‰çš„æ¯”ä¾‹ï¼Œå®ƒçš„å€¼å¿…é¡»æ˜¯ä¸ç²¾ç¡®çš„éè´Ÿæ•´æ•°å€¼ï¼› å¦‚æœè®¾ç½®ä¸ºç²¾ç¡®çš„å®æ•°å€¼ï¼Œåˆ™ç²¾ç¡®çš„å€¼å°†è½¬æ¢ä¸ºä¸ç²¾ç¡®çš„å€¼ã€‚é»˜è®¤å€¼1.0ï¼Œä¸ºæ¯ä¸ªå½“å‰å ç”¨çš„éé™æ€é¡µé¢ä¿ç•™ä¸€é¡µå†…å­˜ã€‚ å°†å…¶è®¾ç½®ä¸ºè¾ƒå°çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°çš„å¹³å‡è™šæ‹Ÿå†…å­˜å ç”¨é‡ï¼Œè€Œå°†å…¶è®¾ç½®ä¸ºè¾ƒå¤§çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°‘çš„æ“ä½œç³»ç»Ÿè°ƒç”¨ä»¥è¯·æ±‚å’Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚\nå¼±åºå¯¹ï¼Œæš‚æ—¶åºå¯¹å’Œå®ˆæŠ¤è€…Weak Pairs, Ephemeron Pairs, and Guardians weak pairså…è®¸ç¨‹åºç»´æŠ¤æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆã€‚ æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆä¸ä¼šé˜»æ­¢å­˜å‚¨ç®¡ç†ç³»ç»Ÿå›æ”¶è¯¥å¯¹è±¡ï¼Œä½†æ˜¯åªè¦è¯¥å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æ˜¯å¯è®¿é—®çš„ï¼Œå®ƒä»ç„¶æœ‰æ•ˆã€‚\nephemeron pairsä¸weak pairsç±»ä¼¼ï¼Œä½†æ˜¯ephemeron pairsæ‹¥æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œå…¶ä¸­ä»…ä»…åœ¨ç¬¬ä¸€ä¸ªæŒ‡é’ˆå­˜åœ¨çš„æƒ…å†µç¬¬äºŒä¸ªæŒ‡é’ˆæ‰èƒ½å­˜åœ¨\nguardianså…è®¸ç¨‹åºä¿æŠ¤å¯¹è±¡å…é­åƒåœ¾å›æ”¶å™¨çš„é‡åˆ†é…ï¼Œå¹¶ç¡®å®šè¯¥å¯¹è±¡ä½•æ—¶è¢«é‡æ–°åˆ†é…ã€‚\nweak paris, ephemeron pairs å’Œguardianså…è®¸ç¨‹åºå°†æœ‰å…³å¯¹è±¡çš„ä¿¡æ¯ä¿ç•™åœ¨å•ç‹¬çš„æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚å“ˆå¸Œè¡¨ï¼‰ä¸­ï¼Œè€Œæ— éœ€æ‹…å¿ƒç»´æŠ¤æ­¤ä¿¡æ¯å°†å¯¼è‡´å¯¹è±¡æ— é™æœŸåœ°ä¿ç•™åœ¨ç³»ç»Ÿä¸­ã€‚\nå¦å¤–ï¼Œguardianså…è®¸æ— é™æœŸåœ°ä»é‡Šæ”¾å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥é‡ç”¨å®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨å¯¹è±¡ä¸­çš„æ•°æ®æ‰§è¡Œæ¸…ç†æˆ–å…¶ä»–æ“ä½œã€‚\n(weak-cons obj1 obj2)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„å¼±åºå¯¹\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚å¼±åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\nå¼±åºå¯¹å¯ä»¥ä½¿ç”¨**weak-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ å¼±åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆ å¼±åºå¯¹çš„carä¸­çš„å¼±æŒ‡é’ˆå°±åƒæ™®é€šæŒ‡é’ˆä¸€æ ·ï¼Œåªè¦å®ƒæŒ‡å‘çš„å¯¹è±¡å¯ä»¥é€šè¿‡ç³»ç»Ÿä¸­æŸä¸ªåœ°æ–¹çš„æ™®é€šï¼ˆéå¼±ï¼‰æŒ‡é’ˆè®¿é—®å³å¯ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåƒåœ¾æ”¶é›†å™¨åœ¨æŸä¸ªæ—¶å€™è¯†åˆ«å‡ºä¸å­˜åœ¨æŒ‡å‘è¯¥å¯¹è±¡çš„éå¼±æŒ‡é’ˆï¼Œåˆ™å®ƒå°†æ¯ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„å¼±æŒ‡é’ˆæ›¿æ¢ä¸ºâ€œ broken weak-pointerâ€å¯¹è±¡**#!bwp**ï¼Œå¹¶ä¸¢å¼ƒè¯¥å¯¹è±¡ã€‚\nå¼±åºå¯¹çš„cdrå­—æ®µä¸æ˜¯å¼±æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¼±åºå¯¹æ¥æ„é€ å¼±ä¿æŒå¯¹è±¡çš„åˆ—è¡¨ã€‚å¯ä»¥åƒä½¿ç”¨æ™®é€šçš„åˆ—è¡¨çš„å¤„ç†æ“ä½œï¼ˆä¾‹å¦‚lengthï¼Œmapå’Œassvï¼‰æ¥æ“ä½œè¿™äº›listã€‚å¼±åºå¯¹å¯ä»¥ä½¿ç”¨set-car!å’Œset-cdr!æ¥ä¿®æ”¹ï¼› åœ¨set-car!ä¹‹åï¼Œcarå­—æ®µåŒ…å«æŒ‡å‘æ–°å¯¹è±¡çš„å¼±æŒ‡é’ˆï¼Œä»£æ›¿äº†æ—§å¯¹è±¡ã€‚å¼±åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ç›¸åŒã€‚ å¼±åºå¯¹æ²¡æœ‰readerè¯­æ³•ã€‚å¼±åºå¯¹åœ¨è¢«å†™å…¥ç„¶åè¢«è¯»å–æ—¶æˆä¸ºæ™®é€šå¯¹ã€‚\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (car p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (weak-pair? obj)\n(weak-pair? (weak-cons â€™a â€™b)) â‡’ #t (weak-pair? (cons â€™a â€™b)) â‡’ #f (weak-pair? \u0026#34;oops\u0026#34;) â‡’ #f (ephemeron-cons obj1 obj2)\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚æš‚æ—¶åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\næš‚æ—¶åºå¯¹å¯ä»¥ä½¿ç”¨**ephemeron-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ æš‚æ—¶åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆï¼Œå¹¶ä¸”ä»…ä»…åœ¨pairçš„carå­˜åœ¨æ—¶cdræ‰èƒ½ä¿ç•™ æš‚æ—¶åºå¯¹çš„è¡Œä¸ºä¸å¼±åºå¯¹ç±»ä¼¼ï¼Œä¸è¿‡cdræœ‰ç‰¹æ®Šçš„å¤„ç†ï¼šå¦‚æœcarè¢«è®¾ç½®ä¸º**#!bwpçš„åŒæ—¶ä¹Ÿä¼šå°†cdrè®¾ç½®ä¸º#!bwp**ã€‚ç”±äºåŒæ—¶å°†carå’Œcdrå­—æ®µè®¾ç½®ä¸ºä¸º**#!bwp**ï¼Œå› æ­¤å¯ä»¥é€šè¿‡cdrå¯¹è±¡å¼•ç”¨carå¯¹è±¡è¿™ä¸€äº‹å®æœ¬èº«å¹¶ä¸æ„å‘³ç€å¿…é¡»ä¿ç•™carï¼ˆä¸å¼±åºå¯¹ä¸åŒï¼‰ã€‚ ç›¸åï¼Œå‡ºäºæŸç§åŸå› ï¼Œcarå¿…é¡»ç‹¬ç«‹äºcdrå¯¹è±¡ä¿å­˜ã€‚\nä¸å¼±åºå¯¹å’Œå…¶ä»–å¯¹ä¸€æ ·ï¼Œæš‚æ—¶åºå¯¹ä½¿ç”¨**set-car!å’Œset-cdr!**æ¥ä¿®æ”¹æ•°æ®ï¼Œæš‚æ—¶åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ä¸€æ ·ï¼Œä½†æ²¡æœ‰readerè¯­æ³•\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (cdr p) â‡’ #!bwp (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x x)) ; not an ephemeron pair (set! x \u0026#39;*) (collect) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) ä¸å¼±åºå¯¹ä¸€æ ·ï¼Œå¦‚æœåœ¨å°†xè®¾ç½®ä¸º*ä¹‹å‰è¿›è¡Œäº†åƒåœ¾å›æ”¶å°†è¯¥pairæå‡ä¸ºè¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™ä¸Šé¢ä¸­é—´ç¤ºä¾‹çš„æœ€åä¸¤ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šå¯èƒ½è¿”å›ï¼ˆa . bï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸Šé¢çš„æœ€åä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæœ€åä¸¤ä¸ªè¡¨è¾¾å¼çš„ç»“æœå°†å§‹ç»ˆä¸ºï¼ˆa . bï¼‰ï¼Œå› ä¸ºå¼±åºå¯¹çš„cdræŒæœ‰éå¼±å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥éå¼±å¼•ç”¨é˜»æ­¢carå­—æ®µå˜** #!bwp**ã€‚\n(ephemeron-pair? obj)\n(ephemeron-pair? (ephemeron-cons \u0026#39;a \u0026#39;b)) â‡’ #t (ephemeron-pair? (cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? (weak-cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? \u0026#34;oops\u0026#34;) â‡’ #f (bwp-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯æ–­å¼€çš„broken weak-pairå¯¹è±¡ï¼Œåˆ™è¿”å›#tï¼Œå¦åˆ™è¿”å›#f\n(bwp-object? #!bwp) â‡’ #t (bwp-object? \u0026#39;bwp) â‡’ #f (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect (collect-maximum-generation)) (car p) â‡’ #!bwp (bwp-object? (car p)) â‡’ #t (make-guardian)\nGuardiansç”±è¦ä¿æŠ¤çš„å¯¹è±¡ç»„çš„è¿‡ç¨‹è¡¨ç¤ºã€‚åˆ›å»ºguardianåï¼Œæ³¨å†Œå¯¹è±¡ç»„ä¸ºç©ºã€‚ é€šè¿‡å°†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ˆæŠ¤è€…ï¼Œå¯ä»¥å‘guardianæ³¨å†Œå¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) x â‡’ (aaa . bbb) (G x) æ³¨å†Œå¯¹è±¡æ—¶ä¹Ÿå¯ä»¥æŒ‡å®šâ€œrepresentativeâ€ï¼ˆå³ï¼Œyï¼‰å¯¹è±¡ã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(define y (cons \u0026#39;ccc \u0026#39;ddd)) y â‡’ (ccc . ddd) (G y \u0026#39;rep) ä¸å®ˆæŠ¤è€…å…³è”çš„ä¸€ç»„æ³¨å†Œå¯¹è±¡åœ¨é€»è¾‘ä¸Šç»†åˆ†ä¸ºä¸¤ä¸ªä¸ç›¸äº¤çš„å­ç»„ï¼šä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œå¯è®¿é—®â€å¯¹è±¡ï¼Œä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œä¸å¯è®¿é—®â€å¯¹è±¡ã€‚ä¸å¯è®¿é—®çš„å¯¹è±¡æ˜¯å·²è¢«è¯æ˜æ— æ³•è®¿é—®çš„å¯¹è±¡ï¼ˆé€šè¿‡guardianæœºåˆ¶æœ¬èº«æˆ–é€šè¿‡å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µé™¤å¤–ï¼‰ï¼Œå¯è®¿é—®çš„å¯¹è±¡æ˜¯æœªç»è¯æ˜çš„å¯¹è±¡ã€‚â€œå·²è¯æ˜â€ä¸€è¯åœ¨è¿™é‡Œå¾ˆé‡è¦ï¼šå¯èƒ½æ˜¯å¯è®¿é—®ç»„ä¸­çš„æŸäº›å¯¹è±¡ç¡®å®æ˜¯ä¸å¯è®¿é—®çš„ï¼Œä½†è¿™å°šæœªå¾—åˆ°è¯æ˜ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç›´åˆ°å¯¹è±¡å®é™…ä¸Šå˜å¾—ä¸å¯è®¿é—®å¾ˆä¹…ä¹‹åï¼ˆåœ¨å½“å‰å®ç°ä¸­ï¼Œç›´åˆ°å‘ç”ŸåŒ…å«å¯¹è±¡çš„ä¸–ä»£çš„åƒåœ¾å›æ”¶ï¼‰ï¼Œæ‰å¯èƒ½åšå‡ºè¿™ç§è¯æ˜ã€‚\nå‘guardianæ³¨å†Œçš„å¯¹è±¡æœ€åˆè¢«æ”¾ç½®åœ¨å¯è®¿é—®ç»„ä¸­ï¼Œå¹¶åœ¨å®ƒä»¬å˜å¾—ä¸å¯è®¿é—®åçš„æŸä¸ªæ—¶åˆ»ç§»å…¥ä¸å¯è®¿é—®ç»„ã€‚ ä¸å¯è®¿é—®ç»„ä¸­çš„å¯¹è±¡æ˜¯é€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„guardianæ¥æ£€ç´¢çš„ã€‚ å¦‚æœä¸å¯è®¿é—®ç»„ä¸­æ²¡æœ‰å¯¹è±¡ï¼Œåˆ™guardianè¿”å›#fã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(G) â‡’ #f (set! x #f) (set! y #f) (collect) (G) â‡’ (aaa . bbb) ; ä¹Ÿæœ‰å¯èƒ½è¿™ä¸ªåæ‰“å°å‡ºæ¥ (G) â‡’ rep ; è¿™ä¸ªå…ˆæ‰“å°å‡ºæ¥ (G) â‡’ #f å¯¹Gçš„åˆå§‹è°ƒç”¨è¿”å›#fï¼Œå› ä¸ºç»‘å®šåˆ°xå’Œyçš„å¯¹æ˜¯å‘Gæ³¨å†Œçš„å”¯ä¸€å¯¹è±¡ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥é€šè¿‡è¿™äº›ç»‘å®šè®¿é—®è¿™äº›åºå¯¹ã€‚è°ƒç”¨collectæ—¶ï¼Œå¯¹è±¡å°†ç§»å…¥ä¸å¯è®¿é—®çš„ç»„ã€‚ å› æ­¤ï¼Œå¯¹Gçš„ä¸¤ä¸ªè°ƒç”¨è¿”å›å…ˆå‰ç»‘å®šåˆ°xçš„åºå¯¹å’Œå…ˆå‰ç»‘å®šåˆ°yçš„åºå¯¹çš„representativeï¼Œå°½ç®¡å¯èƒ½ä¸æ‰€ç¤ºé¡ºåºç›¸åã€‚ ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºå¼±åºå¯¹ï¼Œå¦‚æœå¯¹è±¡å·²è¿ç§»åˆ°è¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™è°ƒç”¨collectå®é™…ä¸Šå¯èƒ½ä¸è¶³ä»¥è¯æ˜è¯¥å¯¹è±¡ä¸å¯è®¿é—®ã€‚ï¼‰\nå®é™…ä¸Šï¼Œä»guardiané‚£é‡Œè·å–çš„å¯¹è±¡åœ¨ä»»ä½•æ–¹é¢éƒ½æ²¡æœ‰ç‰¹æ®Šçš„åœ°ä½ã€‚ æ­¤åŠŸèƒ½é¿å…äº†å…±äº«æˆ–å¾ªç¯ç»“æ„å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ã€‚ ç”±ä¸å¯è®¿é—®å¯¹è±¡ç»„æˆçš„å…±äº«æˆ–å¾ªç¯ç»“æ„å°†è¢«å®Œæ•´ä¿ç•™ï¼Œå°†æ³¨å†Œç”±guardianä¿æŠ¤çš„éƒ¨åˆ†éƒ½æ”¾ç½®åœ¨è¯¥guardianä¸å¯è®¿é—®çš„é›†åˆä¸­ã€‚ ç„¶åï¼Œç¨‹åºå‘˜å¯ä»¥å®Œå…¨æ§åˆ¶ç»“æ„çš„å¤„ç†é¡ºåºã€‚\nä¸€ä¸ªå¯¹è±¡å¯ä»¥åœ¨guardianå¤„å¤šæ¬¡æ³¨å†Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤šæ¬¡æ£€ç´¢è¯¥å¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (G x) (G x) (set! x #f) (collect) (G) â‡’ (aaa . bbb) (G) â‡’ (aaa . bbb) å®ƒä¹Ÿå¯ä»¥å‘ä¸æ­¢ä¸€ä¸ªguardianæ³¨å†Œï¼Œå¹¶ä¸”guardianæœ¬èº«ä¹Ÿå¯ä»¥å‘å…¶ä»–guardianæ³¨å†Œã€‚ åœ¨æ²¡æœ‰â€œrepresentativeâ€çš„æƒ…å†µä¸‹å‘guardianæ³¨å†Œçš„å¯¹è±¡ï¼Œå¹¶æ”¾ç½®åœ¨ä¸€ä¸ªå¼±åºå¯¹æˆ–æš‚æ—¶å¯¹çš„carå­—æ®µä¸­ï¼Œå…¶ç›´åˆ°ä»guardianå¤„å°†è¿”å›å¹¶ç”±ç¨‹åºä¸¢å¼ƒï¼Œæˆ–è€…ç›´åˆ°guardianæœ¬èº«è¢«ä¸¢å¼ƒä¸ºæ­¢ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (collect) (set! y (G)) y â‡’ (aaa . bbb) (car p) â‡’ (aaa . bbb) (set! y #f) (collect 1) (car p) â‡’ #!bwp å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæŒ‡å®šäº†representativeï¼ˆå¯¹è±¡æœ¬èº«é™¤å¤–ï¼‰ï¼Œåˆ™åœ¨ä»guardianå¤„è·å¾—representativeçš„åŒæ—¶ï¼Œä¹Ÿä¼šä»å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µä¸­ä¸¢å¼ƒå—ä¿æŠ¤çš„å¯¹è±¡ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x \u0026#39;rep) (set! x #f) (collect) (G) â‡’ rep ; è·å¾—representativeçš„å€¼ (car p) â‡’ #!bwp ; è‡ªåŠ¨ä¸¢å¼ƒ ä¸‹é¢çš„ç¤ºä¾‹è¯´æ˜äº†å½“guardianæœ¬èº«ä¸¢å¼ƒæ—¶ï¼Œè¯¥å¯¹è±¡å·²è¢«é‡Šæ”¾å¹¶ä¸”å¼±åºå¯¹çš„carå­—æ®µè®¾ç½®ä¸º#!bwpï¼š\n(define G (make-guardian)) (define x (cons aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (set! G #f) (collect) (car p) â‡’ #!bwp ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨guardianæ¥é‡Šæ”¾å¤–éƒ¨å­˜å‚¨ï¼Œå°±åƒç”±Cåº“â€œmallocâ€å’Œâ€œfreeâ€æ“ä½œç®¡ç†å­˜å‚¨ã€‚\n(define malloc (let ([malloc-guardian (make-guardian)]) (lambda (size) ; first free any storage that has been dropped. to avoid long ; delays, it might be better to deallocate no more than, say, ; ten objects for each one allocated (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f)))) ; then allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x)))) do-mallocå¿…é¡»è¿”å›ä¸€ä¸ªSchemeå¯¹è±¡â€œheaderâ€ï¼Œè¯¥headerå°è£…ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆï¼ˆå¯èƒ½æ˜¯æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡æ­¤headerå¯¹å¤–éƒ¨å­˜å‚¨è¿›è¡Œæ‰€æœ‰è®¿é—®ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¿…é¡»æ³¨æ„åœ¨åˆ é™¤ç›¸åº”çš„headerä¹‹åï¼Œåœ¨Schemeä¹‹å¤–ä¸å­˜åœ¨æŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆã€‚ do-freeå¿…é¡»ä½¿ç”¨å°è£…çš„æŒ‡é’ˆé‡Šæ”¾å¤–éƒ¨å­˜å‚¨ã€‚è¿™ä¸¤ä¸ªåŸè¯­éƒ½å¯ä»¥ä½¿ç”¨å¤–éƒ¨åˆ†é…å’Œå¤–éƒ¨æ— å…³çš„å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¤–éƒ¨è¿‡ç¨‹å¯¼å…¥çš„Cåº“â€œmallocâ€å’Œâ€œfreeâ€è¿ç®—ç¬¦è¿›è¡Œå®šä¹‰ã€‚\nå¦‚æœä¸å¸Œæœ›è°ƒç”¨mallocæ¥é‡Šæ”¾å­˜å‚¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨collect-requestå¤„ç†å™¨æ¥æ£€æŸ¥å¹¶é‡Šæ”¾å·²ä¸¢å¼ƒçš„å­˜å‚¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define malloc) (let ([malloc-guardian (make-guardian)]) (set! malloc (lambda (size) ; allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x))) (collect-request-handler (lambda () ; first, invoke the collector (collect) ; then free any storage that has been dropped (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f))))))) é€šè¿‡ä¸€ç‚¹é‡æ„ï¼Œå°±æœ‰å¯èƒ½å°†å°è£…çš„å¤–éƒ¨åœ°å€æ³¨å†Œä¸ºå¸¦headerçš„representativeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdo-freeå°†ä»…å°†å¤–éƒ¨åœ°å€ä½œä¸ºå‚æ•°ã€‚ è¿™å°†ä½¿æ ‡å¤´ä¸€æ—¦å˜å¾—ä¸å¯è®¿é—®ï¼Œä¾¿å¯ä»¥å°†å…¶ä»Schemeå †ä¸­åˆ é™¤ã€‚\né”å¯¹è±¡Locking Objects æ¥è‡ªCè¯­è¨€çš„å˜é‡æˆ–æ•°æ®ç»“æ„åˆ°Schemeå¯¹è±¡çš„æ‰€æœ‰æŒ‡é’ˆï¼Œé€šå¸¸åº”åœ¨è¾“å…¥ï¼ˆæˆ–é‡æ–°è¾“å…¥ï¼‰Schemeä¹‹å‰ä¸¢å¼ƒã€‚ å½“æ— æ³•éµå¾ªè¯¥å‡†åˆ™æ—¶ï¼Œå¯ä»¥é€šè¿‡é”å®šå¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Slock_objecté”å®šè¯¥å¯¹è±¡ã€‚\n(lock-object obj)\né”å®šå¯¹è±¡å¯é˜²æ­¢å­˜å‚¨ç®¡ç†å™¨æ”¶å›æˆ–é‡å®šä½è¯¥å¯¹è±¡ã€‚ åº”è°¨æ…ä½¿ç”¨é”å®šï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡å¹¶å¢åŠ å­˜å‚¨ç®¡ç†å¼€é”€ã€‚\nå¦‚æœæœªè§£é”å¯¹è±¡ï¼Œé”å®šä¹Ÿä¼šå¯¼è‡´æ„å¤–ä¿ç•™å­˜å‚¨ç©ºé—´ã€‚ å¯ä»¥é€šè¿‡è§£é”å¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Sunlock_objectæ¥è§£é”å¯¹è±¡ã€‚\né”å®šç«‹å³æ•°ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è¢«é™æ€åŒ–çš„å¯¹è±¡æ˜¯ä¸å¿…è¦ä½†æ— å®³çš„ã€‚\n(unlock-object obj)\né€šè¿‡è¿ç»­è°ƒç”¨lock-objectï¼ŒSlock_objectæˆ–åŒæ—¶è°ƒç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¤šæ¬¡é”å®šå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å…ˆé€šè¿‡ç›¸ç­‰æ¬¡æ•°çš„å¯¹unlock-objectæˆ–Sunlock_objectçš„è°ƒç”¨æ¥å°†å…¶è§£é”ã€‚\né™¤éå­˜åœ¨æŒ‡å‘å¯¹è±¡çš„å•ç‹¬çš„CæŒ‡é’ˆï¼Œå¦åˆ™ä¹Ÿæ— éœ€é”å®šåŒ…å«åœ¨é”å®šå¯¹è±¡ä¸­çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œé”å®šåºå¯¹çš„carä¸­çš„å¯¹è±¡ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»…å…è®¸é€šè¿‡å¤–éƒ¨å¯¹è±¡æ¥é—´æ¥è®¿é—®çš„å†…éƒ¨å¯¹è±¡ï¼Œåˆ™åº”å°†å…¶è§£é”ï¼Œä»¥ä¾¿å›æ”¶å™¨åœ¨å›æ”¶æœŸé—´å¯ä»¥è‡ªç”±åœ°é‡åˆ†é…å®ƒã€‚\nè§£é”ç«‹å³å€¼ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è®¾ä¸ºé™æ€çš„å¯¹è±¡æ˜¯ä¸å¿…è¦çš„ï¼Œæ— æ•ˆçš„ï¼Œä½†æ— å®³ã€‚\n(locked-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯é”å®šçš„ï¼Œç«‹å³çš„æˆ–é™æ€çš„ï¼Œè¿”å›#t\nå¦‚æœå›æ”¶å™¨æ— æ³•é‡åˆ†é…æˆ–å›æ”¶objï¼Œåˆ™è¯¥è°“è¯å°†è¿”å›trueï¼ŒåŒ…æ‹¬ç«‹å³å€¼ï¼Œä¾‹å¦‚fixnumsï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ä»¥åŠå·²è®¾ä¸ºé™æ€çš„å¯¹è±¡ã€‚\n","id":57,"section":"posts","summary":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨","tags":["scheme"],"title":"å­˜å‚¨ç®¡ç†(Storage Management in Chez Scheme)","uri":"https://lvsq.net/2020/02/storage-management/","year":"2020"},{"content":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;)\nè¿”å›ï¼šæœªæŒ‡å®š\nè­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢ç¨‹åºç»§ç»­è¿è¡Œä½†å¯èƒ½åœ¨ä»¥åå¯¼è‡´æ›´ä¸¥é‡é—®é¢˜çš„æƒ…å†µã€‚ é€šå¸¸æœ€å¥½æ˜¯è¯†åˆ«ç¨‹åºå‘˜å·²è°ƒç”¨çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜å¯èƒ½ä¸çŸ¥é“çš„å…¶ä»–è¿‡ç¨‹ã€‚ msgå¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶åº”æè¿°å¼‚å¸¸æƒ…å†µã€‚irritantå¯ä»¥æ˜¯ä»»ä½•Schemeå¯¹è±¡ï¼Œå¹¶ä¸”åº”åŒ…å«å¯èƒ½å¯¼è‡´æˆ–ä¸¥é‡æ¶‰åŠå¼‚å¸¸æƒ…å†µçš„å€¼ã€‚\n(assertion-violationf who msg irritant \u0026hellip;) | (errorf who msg irritant \u0026hellip;) | (warningf who msg irritant \u0026hellip;)\nè¿™äº›è¿‡ç¨‹ç±»ä¼¼äºassertion-violation, error, warning, æ‰€ä¸åŒçš„åœ¨äº msg è®¾å®šä¸ºä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²\nä¸­æ–­ Chez Schemeå…è®¸ç¨‹åºåœ¨å‘ç”Ÿå„ç§äº‹ä»¶æ—¶æ§åˆ¶Schemeç³»ç»Ÿçš„æ“ä½œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬é”®ç›˜ä¸­æ–­ï¼Œç”±set-timerè®¾ç½®çš„å†…éƒ¨è®¡æ—¶å™¨åˆ°æœŸï¼Œç”±ä¸­æ–­è°ƒç”¨å¼•å‘çš„æ–­ç‚¹æˆ–è€…æ¥è‡ªå­˜å‚¨ç®¡ç†å™¨çš„è¯·æ±‚å¯åŠ¨GCã€‚\næ— è®ºä½•æ—¶breakè¢«è°ƒç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šç«‹å³å¯ç”¨ä¸­æ–­å¤„ç†ç¨‹åº\n(break who msg irritant \u0026hellip;) | (break who) | (break)\nbreakå‚æ•°éµå¾ªä¸Šè¿°errorfçš„åè®®ã€‚é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆè¯·å‚è§break-handlerï¼‰æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯å¹¶è°ƒç”¨è°ƒè¯•å™¨ã€‚å¯ä»¥çœç•¥æ ¼å¼å­—ç¬¦ä¸²å’Œå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºå‘å‡ºçš„æ¶ˆæ¯ä½¿ç”¨whoå‚æ•°æ ‡è¯†ä¸­æ–­ï¼Œä½†ä¸æä¾›æœ‰å…³ä¸­æ–­çš„æ›´å¤šä¿¡æ¯ã€‚å¦‚æœä¹Ÿçœç•¥äº†whoå‚æ•°ï¼Œåˆ™ä¸ä¼šç”Ÿæˆä»»ä½•æ¶ˆæ¯ã€‚å¦‚æœè°ƒè¯•å™¨æ­£å¸¸é€€å‡ºï¼Œåˆ™é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºå°†æ­£å¸¸è¿”å›ã€‚\nbreak-handler\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“å‰çš„ä¸­æ–­å¤„ç†ç¨‹åºç”±breakè°ƒç”¨ï¼Œå®ƒä¼ é€’å…¶å‚æ•°ã€‚æœ‰å…³é»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºçš„æè¿°ï¼Œè¯·å‚è§breakã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ç¦ç”¨breaksã€‚\n(break-handler (lambda args (void))) (set-timer n)\nn å¿…é¡»ä¸ºéè´Ÿæ•´æ•°ã€‚å½“n ä¸ºéé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å¯åŠ¨ä¸€ä¸ªå†…éƒ¨è®¡æ—¶å™¨ï¼Œå…¶åˆå§‹å€¼ä¸ºnã€‚ç»è¿‡nä¸ªtickåï¼Œå°†å‘ç”Ÿè®¡æ—¶å™¨ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´è®¡æ—¶å™¨ä¸­æ–­å¤„ç†ç¨‹åºè¢«è°ƒç”¨ã€‚tickä¸æ˜¯ç»Ÿä¸€çš„æ—¶é—´å•ä½ï¼Œè€Œæ˜¯åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ¯ä¸ªè¿‡ç¨‹è°ƒç”¨è¦å®Œæˆå¤šå°‘å·¥ä½œã€‚\nå½“nä¸ºé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å…³é—­è®¡æ—¶å™¨ã€‚\nengineæœºåˆ¶å»ºç«‹åœ¨è®¡æ—¶å™¨ä¸­æ–­ä¹‹ä¸Šï¼Œå› æ­¤ä¸åº”ä¸engineå…±åŒä½¿ç”¨ã€‚\n(register-signal-handler sig procedure)\nregister-signal-handlerç”¨äºä¸ºç»™å®šçš„åº•å±‚ä¿¡å·å»ºç«‹ä¿¡å·å¤„ç†ç¨‹åºã€‚ sigå¿…é¡»æ˜¯æ ‡è¯†æœ‰æ•ˆä¿¡å·çš„ç²¾ç¡®æ•´æ•°ï¼Œè¿‡ç¨‹åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚åœ¨æ³¨å†Œäº†ç»™å®šsignalçš„å¤„ç†ç¨‹åºä¹‹åï¼Œæ”¶åˆ°äº†ç»™å®šçš„signalä¼šè°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚signalç¼–å·ä¼šä¼ é€’ç»™è¯¥å¤„ç†ç¨‹åºï¼Œä»è€Œå…è®¸åŒä¸€å¤„ç†ç¨‹åºç”¨äºä¸åŒçš„ä¿¡å·ï¼ŒåŒæ—¶åŒºåˆ†å®ƒä»¬ã€‚\nä»¥è¿™ç§æ–¹å¼å¤„ç†çš„ä¿¡å·ç±»ä¼¼äºé”®ç›˜ä¸­æ–­ï¼Œå› ä¸ºåœ¨å°†ä¿¡å·ä¼ é€’åˆ°è¿›ç¨‹æ—¶ä¸ä¼šç«‹å³è°ƒç”¨å¤„ç†ç¨‹åºï¼Œè€Œæ˜¯åœ¨ä¿¡å·ä¼ é€’ååœ¨æŸä¸ªè¿‡ç¨‹è°ƒç”¨è¾¹ç•Œå¤„è°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚å› æ­¤ï¼Œä¸ºå†…å­˜æ•…éšœï¼Œéæ³•æŒ‡ä»¤ç­‰å»ºç«‹å¤„ç†ç¨‹åºé€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå¯¼è‡´æ•…éšœæˆ–éæ³•æŒ‡ä»¤çš„ä»£ç å°†åœ¨è°ƒç”¨å¤„ç†ç¨‹åºä¹‹å‰ç»§ç»­æ‰§è¡Œï¼ˆå¯èƒ½æ˜¯é”™è¯¯çš„ï¼‰ä¸€æ®µæ—¶é—´ã€‚\nå¦å¤–ï¼Œä»…åœ¨åŸºäºUnixçš„ç³»ç»Ÿä¸Šæ‰æ”¯æŒregister-signal-handlerã€‚\nç¯å¢ƒ ç¯å¢ƒæ˜¯åŒ…å«æ ‡è¯†ç¬¦ç»‘å®šçš„é¡¶çº§ï¼ˆfirst-classï¼‰å¯¹è±¡ã€‚å®ƒä»¬ç±»ä¼¼äºæ¨¡å—ï¼Œä½†æ˜¯ä¸æ¨¡å—ä¸åŒï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ“ä½œã€‚ç¯å¢ƒå¯ä»¥ä½œä¸ºevalï¼Œexpandä»¥åŠè¿‡ç¨‹çš„å®šä¹‰ï¼Œåˆ†é…æˆ–å¼•ç”¨é¡¶çº§å€¼çš„å¯é€‰å‚æ•°ã€‚\næœ‰å‡ ç§å†…ç½®ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤åˆ¶ç°æœ‰ç¯å¢ƒæˆ–ä»ç°æœ‰ç¯å¢ƒä¸­é€‰æ‹©çš„ç»‘å®šæ¥åˆ›å»ºæ–°ç¯å¢ƒã€‚\nç¯å¢ƒå¯ä»¥æ˜¯å¯å˜çš„æˆ–ä¸å˜çš„ã€‚å¯å˜çš„ç¯å¢ƒå¯ä»¥ä½¿ç”¨æ–°çš„ç»‘å®šè¿›è¡Œæ‰©å±•ï¼Œå¯ä»¥ä¿®æ”¹å…¶ç°æœ‰ç»‘å®šï¼Œè¿˜å¯ä»¥åˆ†é…å…¶å˜é‡ã€‚ä¸å˜çš„ç¯å¢ƒä¸èƒ½ä»¥ä»»ä½•è¿™äº›æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚\nè”æƒ³ä¸€ä¸‹SICPä¸­å…³äºç¯å¢ƒçš„å†…å®¹ (environment? obj)\n(environment? (interaction-environment)) â‡’ #t (environment? \u0026#39;interaction-environment) â‡’ #f (environment? (copy-environment (scheme-environment))) â‡’ #t (environment? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #t (environment-mutable? env)\n(environment-mutable? (interaction-environment)) â‡’ #t (environment-mutable? (scheme-environment)) â‡’ #f (environment-mutable? (copy-environment (scheme-environment))) â‡’ #t (environment-mutable? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #f (scheme-environment)\nscheme-environmentè¿”å›ä¸€ä¸ªåŒ…å«åˆå§‹é¡¶çº§ç»‘å®šçš„ç¯å¢ƒã€‚è¯¥ç¯å¢ƒå¯¹åº”äºSchemeæ¨¡å—ã€‚æ­¤è¿‡ç¨‹è¿”å›çš„ç¯å¢ƒæ˜¯ä¸å¯å˜çš„ã€‚\n(define cons 3) (top-level-value \u0026#39;cons (scheme-environment)) â‡’ #\u0026lt;procedure cons\u0026gt; (set-top-level-value! \u0026#39;cons 3 (scheme-environment)) â‡’ exception (copy-environment env) | (copy-environment env mutable?) | (copy-environment env mutable? syms)\ncopy-environmentè¿”å›envçš„å‰¯æœ¬ï¼Œå³åŒ…å«ä¸env ç›¸åŒç»‘å®šçš„æ–°ç¯å¢ƒã€‚mutable? å¦‚æœä¸ºtrueï¼Œåˆ™è¯¥environmentæ˜¯å¯å˜çš„ï¼Œåä¹‹åˆ™ä¸å¯å˜ï¼›\nä»env å¤åˆ¶åˆ°æ–°ç¯å¢ƒçš„ç»‘å®šé›†ç”±syms ç¡®å®šï¼Œå…¶é»˜è®¤å€¼ä¸ºï¼ˆenvironment-symbols envï¼‰ã€‚æ¯ä¸ªsyms å…ƒç´ çš„ç»‘å®šï¼ˆå¦‚æœæœ‰ï¼‰éƒ½è¢«å¤åˆ¶åˆ°æ–°ç¯å¢ƒä¸­ï¼Œå¹¶ä¸”æ–°ç¯å¢ƒä¸­ä¸å­˜åœ¨å…¶ä»–ç»‘å®šã€‚\nåœ¨å½“å‰çš„å®ç°ä¸­ï¼Œæ°¸è¿œä¸ä¼šæ”¶é›†ç¯å¢ƒä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤é‡å¤ä½¿ç”¨å¤åˆ¶ç¯å¢ƒæœ€ç»ˆå°†å¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚\n(define e (copy-environment (scheme-environment))) (eval \u0026#39;(define cons +) e) (eval \u0026#39;(cons 3 4) e) â‡’ 7 (eval \u0026#39;(cons 3 4) (scheme-environment)) â‡’ (3 . 4) (environment-symbols env)\næ­¤è¿‡ç¨‹è¿”å›ä»£è¡¨ç¯å¢ƒenvä¸­ç»‘å®šçš„æ ‡è¯†ç¬¦çš„ç¬¦å·åˆ—è¡¨ã€‚å®ƒä¸»è¦ç”¨äºæ„å»ºè¦ä»ä¸€ç§ç¯å¢ƒå¤åˆ¶åˆ°å¦ä¸€ç§ç¯å¢ƒçš„ç¬¦å·åˆ—è¡¨ã€‚\n(define listless-environment (copy-environment (scheme-environment) #t (remq \u0026#39;list (environment-symbols (scheme-environment))))) (eval \u0026#39;(let ([x (cons 3 4)]) x) listless-environment) â‡’ (3 . 4) (eval \u0026#39;(list 3 4) listless-environment) â‡’ exception ç¼–è¯‘ã€æ±‚å€¼å’ŒåŠ è½½ (eval obj) | (eval obj env)\nevalå°†obj è§†ä¸ºè¡¨è¾¾å¼çš„è¡¨ç¤ºå½¢å¼ã€‚å®ƒåœ¨ç¯å¢ƒenvä¸­è®¡ç®—è¡¨è¾¾å¼å¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœæœªæä¾›ä»»ä½•ç¯å¢ƒï¼Œåˆ™é»˜è®¤ä¸ºç”±äº¤äº’ç¯å¢ƒè¿”å›çš„ç¯å¢ƒã€‚ å•å‚æ•°æ±‚å€¼æ˜¯Chez Schemeçš„æ‰©å±•ã€‚å½“ç¯å¢ƒå¯å˜æ—¶ï¼ŒChez Schemeè¿˜å…è®¸objè¡¨ç¤ºéè¡¨è¾¾å½¢å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªdefinitionã€‚ Chez Schemeè¿˜å…è®¸objä½œä¸ºä¸€ä¸ªannotationï¼Œé»˜è®¤æ±‚å€¼ç¨‹åºåˆ©ç”¨æ³¨é‡Šå°†æºæ–‡ä»¶ä¿¡æ¯åˆå¹¶åˆ°é”™è¯¯æ¶ˆæ¯ä¸­ï¼Œå¹¶å°†æºæ–‡ä»¶ä¿¡æ¯ä¸ç¼–è¯‘åçš„ä»£ç ç›¸å…³è”ã€‚\nåœ¨Chez Schemeä¸­ï¼Œevalå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œä»…å°†å…¶å‚æ•°ä¼ é€’ç»™å½“å‰æ±‚å€¼å™¨ï¼ˆè¯·å‚é˜…current-evalï¼‰ã€‚é»˜è®¤çš„è¯„ä¼°å™¨æ˜¯compileï¼Œå®ƒé€šè¿‡å½“å‰çš„æ‰©å±•å™¨ï¼ˆå‚é˜…current-expandï¼‰æ‰©å±•è¡¨è¾¾å¼ï¼Œå¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰§è¡Œç”Ÿæˆçš„ä»£ç ï¼Œå¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœå­˜åœ¨ç¯å¢ƒå‚æ•°env ï¼Œåˆ™compileå°†å…¶ä¼ é€’ç»™å½“å‰çš„æ‰©å±•å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºsc-expandã€‚\n(compile obj) | (compile obj env)\nobj å¯ä»¥ä¸ºSchemeè¡¨è¾¾å¼ï¼Œåœ¨æŒ‡å®šçš„ç¯å¢ƒï¼ˆæˆ–äº¤äº’ç¯å¢ƒï¼Œå¦‚æœæœªæä¾›ç¯å¢ƒï¼‰ä¸­ä½¿ç”¨å½“å‰æ‰©å±•å™¨ï¼ˆcurrent-expandçš„å€¼ï¼‰è¿›è¡Œæ‰©å±•ï¼‰ï¼Œç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œç„¶åæ‰§è¡Œã€‚ compileæ˜¯current-evalå‚æ•°çš„é»˜è®¤å€¼ã€‚\n(compile \u0026#39;(cons 1 2)) =\u0026gt; (1 . 2) (interpret obj) | (interpret obj env)\nè§£é‡Šç±»ä¼¼äºç¼–è¯‘ï¼Œåªæ˜¯è¡¨è¾¾å¼æ˜¯è§£é‡Šçš„è€Œä¸æ˜¯ç¼–è¯‘çš„ï¼ˆthe expression is interpreted rather than compiledï¼‰ã€‚è§£é‡Šå¯ä»¥ç”¨ä½œç¼–è¯‘çš„æ›¿ä»£å“ï¼Œä½†æœ‰ä»¥ä¸‹è­¦å‘Šï¼š\nè§£é‡Šåçš„ä»£ç è¿è¡Œé€Ÿåº¦å¤§å¤§é™ä½ è§£é‡Šåçš„ä»£ç ä¸ä¼šç”Ÿæˆæ£€æŸ¥å™¨ä¿¡æ¯ï¼Œå› æ­¤æ£€æŸ¥å™¨å¯¹äºè§£é‡Šçš„ä»£ç ä¸å¦‚åœ¨ç¼–è¯‘çš„ä»£ç ä¸­æœ‰ç”¨ã€ æ— æ³•è§£é‡Šå¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼ï¼Œå› æ­¤è§£é‡Šå™¨éœ€è¦ä¸ºæ‰€æœ‰å¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼è°ƒç”¨ç¼–è¯‘å™¨ï¼ˆè¿™æ˜¯é€æ˜å®Œæˆçš„ï¼‰ å½“æ±‚å€¼å½¢å¼è¿è¡Œæ—¶é—´è¾ƒçŸ­æ—¶ï¼Œè§£é‡Šæœ‰æ—¶æ¯”ç¼–è¯‘æ›´å¿«ï¼Œå› ä¸ºå®ƒé¿å…äº†åœ¨æ±‚å€¼ä¹‹å‰é€šè¿‡ç¼–è¯‘å®Œæˆçš„æŸäº›å·¥ä½œã€‚\n(load path) | (load path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚ loadè¯»å–å¹¶æ±‚å€¼path æŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œloadä½¿ç”¨evalæ±‚å€¼æºæ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-proc ï¼Œåˆ™loadå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-proc å¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\neval-procå‚æ•°æœ‰åŠ©äºå®ç°åµŒå…¥çš„ç±»ä¼¼äºSchemeçš„è¯­è¨€ï¼Œå¹¶æœ‰åŠ©äºä½¿ç”¨ç”¨äºSchemeç¨‹åºçš„æ›¿ä»£è¯„ä¼°æœºåˆ¶ã€‚ eval-procä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–ç”¨é€”ã€‚ä¾‹å¦‚ï¼Œ\n(load \u0026#34;myfile.ss\u0026#34; (lambda (x) (pretty-print (if (annotation? x) (annotation-stripped x) x)) (newline) (eval x))) å¯¹æ¯ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼ä¹‹å‰ä½¿ç”¨pretty-printæ‰“å°ã€‚\nå‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-library path) | (load-library path eval-proc)\nload-libraryä¸loadç›¸åŒï¼Œé™¤äº†å®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rsä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒï¼chezscheme**è¦†ç›–\n(load-program path) | (load-program path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚åŠ è½½ç¨‹åºè¯»å–å¹¶æ±‚å€¼pathæŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚ è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚å¦‚æœåŒ…å«æºä»£ç ï¼Œåˆ™åŠ è½½ç¨‹åºä¼šå°†ä»£ç ä»¥é¡¶çº§ç¨‹åºå½¢å¼åŒ…è£…èµ·æ¥ï¼Œä»¥ä¾¿å°†æ–‡ä»¶çš„å†…å®¹è§†ä¸ºRNRSé¡¶çº§ç¨‹åºï¼ˆSchemeç¼–ç¨‹è¯­è¨€ï¼Œç¬¬4ç‰ˆçš„10.3èŠ‚ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½ç¨‹åºä½¿ç”¨evalæ±‚å€¼æ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-procï¼Œåˆ™è£…å…¥ç¨‹åºå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¯„ä¼°çš„è¡¨è¾¾å¼ã€‚ä¼ é€’ç»™eval-procçš„è¡¨è¾¾å¼å¯èƒ½æ˜¯æ³¨é‡Šæˆ–æœªæ³¨é‡Šçš„å€¼ã€‚ å‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-compiled-from-port input-port)\nload-compiled-from-portè¯»å–å¹¶æ±‚å€¼æ¥è‡ªinput-portçš„å¯¹è±¡ä»£ç çš„å†…å®¹ï¼Œè¿™äº›input-portæ˜¯äº‹å…ˆç”±è¯¸å¦‚compile-file, compile-script, compile-library, compile-to-portåˆ›å»ºçš„ è¿”å›å€¼æ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè¯¥è¡¨è¾¾å¼çš„ç¼–è¯‘å½¢å¼ä¸ºinput-portã€‚å¦‚æœinput-portä¸ºç©ºï¼Œåˆ™ç»“æœå€¼æœªæŒ‡å®šã€‚\n(compile-file input-filename) | (compile-file input-filename output-filename)\ninput-filename å’Œoutput-filename å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚input-filename å¿…é¡»æ˜¯å·²å­˜åœ¨çš„å¯è¯»æ–‡ä»¶ã€‚å®ƒå¿…é¡»åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªæºè¡¨è¾¾å¼çš„åºåˆ—ï¼›å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™ç¼–è¯‘æ–‡ä»¶ä¼šå¼•å‘æ¡ä»¶ç±»å‹ä¸ºï¼†syntaxçš„å¼‚å¸¸ã€‚\næ­£å¸¸æ±‚å€¼è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚ compile-fileå¯¹æ•´ä¸ªæºæ–‡ä»¶æ‰§è¡Œç¼–è¯‘è¿‡ç¨‹ï¼Œä»è€Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚éšååŠ è½½ç›®æ ‡æ–‡ä»¶ï¼ˆè¯·å‚è§loadï¼‰æ—¶ï¼Œä¸éœ€è¦ç¼–è¯‘è¿‡ç¨‹ï¼Œå¹¶ä¸”æ–‡ä»¶åŠ è½½é€šå¸¸å¿«å‡ å€ã€‚\n(compile-script input-filename) | (compile-script input-filename output-filename)\ncompile-scriptä¸compile-fileç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºï¼Œå®ƒä¼šä»æºæ–‡ä»¶å¤åˆ¶å¼€å¤´çš„**#!è¡Œåˆ°ç›®æ ‡æ–‡ä»¶ï¼ŒåŒæ—¶è¯¥è¡Œä¸ä¼šè¢«å‹ç¼©ï¼Œå°½ç®¡å‚æ•°compile-compressed**è¢«è®¾ç½®ä¸º#tï¼Œå…¶ä»–ä»£ç ä¼šè¢«å‹ç¼©ï¼Œè¿™æ ·ä¼šä¿è¯æ“ä½œç³»ç»Ÿå¯ä»¥æ­£ç¡®åœ°è§£é‡Šã€‚\ncompile-scriptå…è®¸ä»æºè„šæœ¬åˆ›å»ºå·²ç¼–è¯‘çš„è„šæœ¬æ–‡ä»¶ï¼Œä»¥å‡å°‘è„šæœ¬åŠ è½½æ—¶é—´ã€‚ä¸æºä»£ç è„šæœ¬ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨**\u0026ndash;script**å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œå·²ç¼–è¯‘çš„è„šæœ¬ã€‚\n(compile-library input-filename) | (compile-library input-filename oiutput-filename)\ncompile-libraryä¸compile-fileç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rs**ä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒ!chezschemeè¦†ç›–ã€‚\n(compile-program input-filename) | (compile-program input-filename output-filename)\ncompile-programç±»ä¼¼äºcompile-scriptï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå®ç°äº†RNRSé¡¶çº§ç¨‹åºçš„è¯­ä¹‰ï¼Œè€Œcompile-scriptåˆ™å®ç°äº†äº¤äº’å¼é¡¶çº§ç¨‹åºçš„è¯­ä¹‰ã€‚ä¸é€šè¿‡compile-fileæˆ–compile-scriptè¿›è¡Œç¼–è¯‘ç›¸æ¯”ï¼Œç”Ÿæˆçš„å·²ç¼–è¯‘ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚\ncompile-programè¿”å›ç”±ç¼–è¯‘çš„é¡¶å±‚ç¨‹åºç›´æ¥è°ƒç”¨çš„åº“çš„åˆ—è¡¨ï¼Œä¸åŒ…æ‹¬ï¼ˆrnrsï¼‰å’Œï¼ˆchezschemeï¼‰ä¹‹ç±»çš„å†…ç½®åº“\n(compile-whole-program input-filename output-filename) | (compile-whole-program input-filename output-filename libs-visible?)\ncompile-whole-programæ¥å—ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºåç§°è¾“å…¥ï¼Œè¯¥æ–‡ä»¶åä¸ºé¡¶çº§ç¨‹åºå‘½åä¸ºâ€œ whole program optimizationâ€ï¼ˆwpoï¼‰æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒ…å«è¯¥ç¨‹åºåŠå…¶æ‰€ä¾èµ–çš„æ¯ä¸ªåº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œå‰ææ˜¯éœ€è¦ä¸€ä¸ªå¯ä»¥æ‰¾åˆ°åº“çš„wpoæ–‡ä»¶ã€‚\nå¦‚æœwpoæ–‡ä»¶æ‰¾ä¸åˆ°æ‰€éœ€åº“ï¼Œä½†å¯ä»¥æ‰¾åˆ°è¯¥åº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™è¯¥åº“ä¸ä¼šåˆå¹¶åˆ°ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚è¿™äº›åº“å°†åœ¨è¿è¡Œæ—¶åŠ è½½ã€‚ compile-whole-programè¿”å›è¿™äº›åº“çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„åº“ï¼Œåˆ™ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶æ˜¯è‡ªåŒ…å«çš„ï¼Œå¹¶ä¸”compile-whole-programè¿”å›ç©ºåˆ—è¡¨ã€‚\nå¦‚æœlibs-visible? è®¾ç½®ä¸ºéfalseï¼Œåˆ™åº“åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶æ˜¯å¯è§çš„ï¼ˆä¾›environmentå’Œevalä½¿ç”¨ï¼‰ï¼Œä»»ä½•åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­å¹¶åœ¨è¿è¡Œæ—¶ä¿ç•™ä¸‹æ¥çš„ç›®æ ‡æ–‡ä»¶æ‰€è¦æ±‚çš„åº“éƒ½æ˜¯å¯è§çš„ã€‚\nå½“generate-wpo-fileså‚æ•°è®¾ç½®ä¸º#tæ—¶ï¼Œè¿‡ç¨‹compile-fileï¼Œcompile-programï¼Œcompile-libraryï¼Œcompile-scriptå’Œcompile-whole-libraryä¼šç”Ÿæˆwpoæ–‡ä»¶ä»¥åŠæ™®é€šç›®æ ‡æ–‡ä»¶ã€‚ ï¼ˆé»˜è®¤å€¼ä¸º#fï¼‰ã€‚å¦å¤–å¦‚æœä¼ é€’å¯é€‰çš„wpoç«¯å£æ—¶ï¼Œcompile-portå’Œcompile-to-portä¹Ÿä¼šè¿™æ ·åšã€‚\n(compile-whole-library input-filename output-filename)\ncompile-whole-libraryç±»ä¼¼äºcompile-whole-programï¼Œä¸åŒä¹‹å¤„åœ¨äºinput-filenameå¿…é¡»ä¸ºåº“æŒ‡å®šä¸€ä¸ªwpoæ–‡ä»¶ï¼Œæ‰€æœ‰åº“è‡ªåŠ¨æ˜¾ç¤ºï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„wpoæ–‡ä»¶ï¼ˆå½“generate-wpo-filesä¸º#tæ—¶ï¼‰ä»¥åŠç”¨äºç”Ÿæˆçš„åº“ç»„åˆçš„ç›®æ ‡æ–‡ä»¶ã€‚\n(compile-port input-port output-port) | (compile-port input-port output-port sfd) | (compile-port input-port output-port sfd wpo-port)\ninput-port å¿…é¡»æ˜¯æ–‡æœ¬è¾“å…¥ç«¯å£ã€‚out-port å’Œwpo-portï¼ˆå¦‚æœå­˜åœ¨ï¼‰å¿…é¡»æ˜¯äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ã€‚å¦‚æœå­˜åœ¨sfd ,å¿…é¡»æ˜¯æºæ–‡ä»¶æè¿°ç¬¦ã€‚\n(make-boot-file output-filename base-boot-list input-filename \u0026hellip;)\næ‰€æœ‰å‚æ•°éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚\nmake-boot-fileå°†å¼•å¯¼æ ‡å¤´ï¼ˆboot headerï¼‰å†™å…¥ä»¥output-filename å‘½åçš„æ–‡ä»¶ï¼Œç„¶åä¾æ¬¡å†™å…¥æ¯ä¸ªinput-filename çš„ç›®æ ‡ä»£ç ã€‚å¦‚æœå°šæœªç¼–è¯‘è¾“å…¥æ–‡ä»¶ï¼Œmake-boot-fileå°†åœ¨å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚\nå¼•å¯¼æ–‡ä»¶é€šè¿‡\u0026ndash;bootæˆ–-bå‘½ä»¤è¡Œé€‰é¡¹æ˜¾å¼åŠ è½½ï¼Œæˆ–åŸºäºå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°éšå¼åŠ è½½ã€‚\n(make-boot-header output-filename base-boot1 base-boot2\u0026hellip;)\nè¯¥è¿‡ç¨‹å·²åŒ…å«åœ¨make-boot-fileä¸­ï¼Œå¹¶æä¾›äº†å‘åå…¼å®¹æ€§ã€‚\n(make-boot-header output-filename base-boot1 base-boot2 \u0026hellip;) ç­‰ä»·äºï¼š (make-boot-file output-filename â€™(base-boot1 base-boot2 \u0026hellip;))\næºç›®å½•å’Œæ–‡ä»¶ source-directories\nsource-directoriesçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²éƒ½å‘½åä¸€ä¸ªç›®å½•è·¯å¾„ã€‚å½“é€šè¿‡load, load-library, load-program, include, visit, or revisitåœ¨äº¤äº’å¼æ£€æŸ¥å™¨ä¸­å‘ç”Ÿè¯­æ³•é”™è¯¯æˆ–æ‰“å¼€æºæ–‡ä»¶æ—¶ï¼Œsource-directoryç¡®å®šç”¨äºæœç´¢æºæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶çš„ç›®å½•é›†ã€‚\né»˜è®¤å€¼ä¸ºåˆ—è¡¨ï¼ˆâ€œ.â€ï¼‰ï¼Œè¿™æ„å‘³ç€ä»…åœ¨å½“å‰ç›®å½•ä¸­æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•æ‰èƒ½æ‰¾åˆ°æºæ–‡ä»¶ï¼Œé™¤éä½¿ç”¨ç»å¯¹è·¯å¾„å‘½åã€‚\n(with-source-path who name procedure)\nè¿‡ç¨‹with-source-pathä¾æ¬¡æœç´¢å½“å‰æºç›®å½•è·¯å¾„ï¼Œä»¥æŸ¥æ‰¾å…·æœ‰æŒ‡å®šåç§°çš„æ–‡ä»¶ï¼Œå¹¶åœ¨ç»“æœä¸Šè°ƒç”¨è¿‡ç¨‹ã€‚å¦‚æœæœªæ‰¾åˆ°è¿™æ ·çš„æ–‡ä»¶ï¼Œåˆ™å¼•å‘**\u0026amp;assertionå’Œ\u0026amp;whoå¼‚å¸¸ï¼Œ\u0026amp;who**çš„å€¼ä¸ºwho çš„å€¼\nå¦‚æœname æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ä»¥./ï¼ˆWindowsä¸‹æ˜¯./ï¼‰ï¼Œæˆ–è€…../ï¼ˆWindowsä¸‹æ˜¯..\\ï¼‰ï¼Œæˆ–è€…æºç›®å½•åˆ—è¡¨ä¸­åªåŒ…å«â€œ.â€ï¼Œæˆ–è€…é»˜è®¤å€¼ \u0026ldquo;\u0026quot;ï¼Œç›¸å½“äº \u0026ldquo;.\u0026quot;ï¼Œä¸æ‰§è¡Œæœç´¢å¹¶è¿”å›nameã€‚\nwho å¿…é¡»æ˜¯ç¬¦å·ï¼Œname å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œprocedure åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚\nä»¥ä¸‹ç¤ºä¾‹å‡å®šæ–‡ä»¶â€œ pieâ€å­˜åœ¨äºç›®å½•â€œ ../spamâ€ä¸­ï¼Œä½†ä¸åœ¨â€œ ../hamâ€æˆ–å½“å‰ç›®å½•ä¸­ã€‚\n(define find-file (lambda (fn) (with-source-path \u0026#39;find-file fn values))) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ exception in find-file: pie not found (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;../spam/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;/pie\u0026#34;) â‡’ \u0026#34;/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;./pie\u0026#34;) â‡’ \u0026#34;./pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;../pie\u0026#34;) â‡’ \u0026#34;../ham/pie\u0026#34; ç¼–è¯‘å™¨ç®¡ç† optimize-level\nè¯¥å‚æ•°å¯ä»¥æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3è¿™4ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚\nç†è®ºä¸Šï¼Œæ­¤å‚æ•°æ§åˆ¶ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¼˜åŒ–é‡ã€‚ å®é™…ä¸Šï¼Œå®ƒåªæ˜¯é—´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºä¼˜åŒ–çº§åˆ«3ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œä¸å®‰å…¨â€ä»£ç ï¼‰ä¸ä¼˜åŒ–çº§åˆ«0-2ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œå®‰å…¨â€ä»£ç ï¼‰ä¹‹é—´ã€‚ å®‰å…¨ä»£ç ä¼šæ‰§è¡Œå®Œæ•´ç±»å‹å’ŒèŒƒå›´æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼Œå°è¯•åº”ç”¨éè¿‡ç¨‹ï¼Œå°è¯•å¯¹non-pairçš„caræ“ä½œæˆ–å°è¯•å¼•ç”¨å‘é‡çš„æœ«å°¾ï¼Œå‡ä¼šå¯¼è‡´ å¼•å‘å¼‚å¸¸ã€‚ å¯¹äºä¸å®‰å…¨çš„ä»£ç ï¼Œç›¸åŒçš„æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ï¼ŒSchemeå †æŸåï¼ˆè¿™å¯èƒ½åœ¨ä»¥åå¼•èµ·çœ‹ä¼¼æ— å…³çš„é—®é¢˜ï¼‰ï¼Œç³»ç»Ÿå´©æºƒæˆ–å…¶ä»–ä¸è‰¯è¡Œä¸ºã€‚ä¸å®‰å…¨çš„ä»£ç é€šå¸¸ä¼šæ›´å¿«ï¼Œä½†æ˜¯åº”è¯¥è°¨æ…ä½¿ç”¨ä¼˜åŒ–çº§åˆ«3ï¼Œå¹¶ä¸”ä»…è¿ç”¨åœ¨å¿…é¡»å°½å¿«è¿è¡Œä¸”ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ä»£ç ä¸­ã€‚\nå°½ç®¡ç¼–è¯‘å™¨ä¸ºä¼˜åŒ–0è‡³2çº§ç”Ÿæˆäº†ç›¸åŒçš„ä»£ç ï¼Œä½†å¦‚æœéœ€è¦ï¼Œç”¨æˆ·å®šä¹‰çš„å®è½¬æ¢å™¨å¯ä»¥åŒºåˆ†ä¸åŒçš„çº§åˆ«ã€‚\nä¸€ç§ä½¿ç”¨ä¼˜åŒ–çº§åˆ«çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ–‡ä»¶ä¸Šï¼Œå¼ºåˆ¶ä½¿ç”¨eval-whenã€‚ ä¾‹å¦‚:\n(eval-when (compile) (optimize-level 3)) ä¹Ÿå¯ä»¥é€šè¿‡\u0026ndash;optimize-levelå‘½ä»¤è¡Œé€‰é¡¹è®¾ç½®ä¼˜åŒ–çº§åˆ«ã€‚æ­¤é€‰é¡¹å¯¹äºé€šè¿‡\u0026ndash;programå‘½ä»¤è¡Œé€‰é¡¹åœ¨ä¼˜åŒ–çº§åˆ«3è¿è¡ŒRNRSé¡¶å±‚ç¨‹åºç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºeval-whenå¯¹RNRSé¡¶å±‚ç¨‹åºæ— æ•ˆã€‚\n($primitive variable) | ($primitive 2 variable) | ($primitive 3 variable)\nvariable å¿…é¡»æ˜¯ä¸€ä¸ªåŸå§‹procedureçš„åå­—ã€‚** $primitive**è¯­æ³•å½¢å¼å…è®¸ä»¥å•ä¸ªåŸå§‹å¼•ç”¨çš„ç²’åº¦æ§åˆ¶ä¼˜åŒ–çº§åˆ«ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ç”¨äºè®¿é—®åŸå§‹å€¼ã€‚\nè¡¨è¾¾å¼ï¼ˆ$primitive variableï¼‰å¯ä»¥ç¼©å†™ä¸º**#%variable**ã€‚\n(#%car â€™(a b c)) â‡’ a (let ([car cdr]) (car \u0026#39;(a b c))) â‡’ (b c) (let ([car cdr]) (#%car \u0026#39;(a b c))) â‡’ a (begin (set! car cdr) (#%car \u0026#39;(a b c))) â‡’ a debug-level\nè¯¥å‚æ•°å¯ä»¥é‡‡ç”¨0ã€1ã€2å’Œ3è¿™å››ä¸ªå€¼ä¹‹ä¸€ã€‚å®ƒç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ä¿ç•™è°ƒè¯•ä¿¡æ¯çš„é‡è¦æ€§ï¼Œå…¶ä¸­0çš„é‡è¦æ€§æœ€ä½ï¼Œè€Œ3çš„é‡è¦æ€§æœ€é«˜ã€‚ é»˜è®¤å€¼æ˜¯1ã€‚ä»9.0ç‰ˆå¼€å§‹ï¼Œå®ƒä»…ç”¨äºç¡®å®šåœ¨éå°¾éƒ¨ä½ç½®é‡åˆ°çš„å¼•èµ·é”™è¯¯çš„è°ƒç”¨æ˜¯å¦è¢«è§†ä¸ºåœ¨å°¾éƒ¨ä½ç½®ï¼ˆå› æ­¤ï¼Œå¯¼è‡´è°ƒç”¨è€…çš„å¸§ä¸å‡ºç°åœ¨å †æ ˆå›æº¯ä¸­ï¼‰ã€‚ è¿™å‘ç”Ÿåœ¨ä½äº2çš„è°ƒè¯•çº§åˆ«ã€‚\næ¦‚è¦åˆ†æProfiling ChezSchemeæ”¯æŒä¸¤ç§ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼šæºä»£ç æ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æã€‚\nå¯ç”¨æºæ¦‚è¦åˆ†æåï¼Œç¼–è¯‘å™¨ä¼šå¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œä»¥è®¡ç®—æ¯ä¸ªæºä»£ç è¡¨è¾¾å¼çš„æ‰§è¡Œæ¬¡æ•°ã€‚ è¯¥ä¿¡æ¯å¯ä»¥HTMLæ ¼å¼æ˜¾ç¤ºæˆ–æ‰“åŒ…åœ¨åˆ—è¡¨ä¸­ï¼Œä»¥è¿›è¡Œä»»æ„ç”¨æˆ·å®šä¹‰çš„å¤„ç†ã€‚ ä¹Ÿå¯ä»¥å°†å…¶è½¬å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†åŠ è½½åˆ°ç¼–è¯‘å™¨çš„æ¦‚è¦åˆ†æä¿¡æ¯æ•°æ®åº“ä¸­ï¼Œä»¥ç”¨äºæºä»£ç çº§ä¼˜åŒ–ã€‚\næºä»£ç æ¦‚è¦åˆ†æè‡³å°‘åŒ…å«ä¸‹é¢ä¸€äº›æ­¥éª¤ï¼š\nç¼–è¯‘ä»£ç ä¸”å¼€å¯source profiling è¿è¡Œç¼–è¯‘åçš„ä»£ç ç”Ÿæˆæºä»£ç æ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä¸” è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·æºæˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨æºæ¦‚è¦åˆ†æã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ï¼š\nprofile-dump-html ä»¥HTMLæ ¼å¼æ˜¾ç¤ºï¼Œä»¥ä¾¿ç¨‹åºå‘˜å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ä½¿ç”¨å½©è‰²ç¼–ç ç³»ç»Ÿæ‰§è¡Œæ¯ä¸ªè¡¨è¾¾å¼çš„é¢‘ç‡ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥è½»æ¾å‘ç°â€œçƒ­ç‚¹â€ profile-dump-list ä»¥é€‚åˆç”¨æˆ·å®šä¹‰çš„åå¤„ç†çš„å½¢å¼; profile-dump ä»¥é€‚åˆäºé€šè¿‡ä¸Šè¿°æ–¹æ³•ä¹‹ä¸€æˆ–æŸäº›è‡ªå®šä¹‰æ–¹å¼è¿›è¡Œç¦»çº¿å¤„ç†çš„å½¢å¼ï¼Œæˆ– profile-dump-data ä»¥é€‚åˆåŠ è½½åˆ°ç¼–è¯‘å™¨æ•°æ®åº“ä¸­çš„å½¢å¼ã€‚\nç”±profile-dump-dataè½¬å‚¨çš„æ¦‚è¦åˆ†æä¿¡æ¯é€šè¿‡profile-load-dataåŠ è½½åˆ°ç¼–è¯‘å™¨çš„profilingæ•°æ®åº“ä¸­ã€‚ é™¤éé€šè¿‡profile-dump-dataæ˜¾å¼è½¬å‚¨å¹¶é€šè¿‡profile-load-dataåŠ è½½ï¼Œå¦åˆ™åˆ†æä¿¡æ¯å¯¹ç¼–è¯‘å™¨ä¸å¯ç”¨ã€‚\nå½“ä½¿ç”¨å—æ¦‚è¦æ–‡ä»¶ä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œæ­¥éª¤æ˜¯ç›¸ä¼¼çš„ï¼š\nç¼–è¯‘ä»£ç å¹¶å¼€å¯block profiling è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ åŠ è½½æ¦‚è¦ä¿¡æ¯ï¼Œä¸” é‡æ–°ç¼–è¯‘ä»£ç  é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·å—æˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨å—åˆ†æã€‚ æ¦‚è¦æ–‡ä»¶ä¿¡æ¯å¿…é¡»é€šè¿‡profile-dump-dataè½¬å‚¨ï¼Œå¹¶é€šè¿‡profile-load-dataåŠ è½½ã€‚ ä¸æºé…ç½®æ–‡ä»¶ä¿¡æ¯ä¸€æ ·ï¼Œå—é…ç½®æ–‡ä»¶ä¿¡æ¯å¯ä»¥ä¸è½¬å‚¨ä¿¡æ¯çš„åŠ è½½è¿‡ç¨‹ç›¸åŒæˆ–ä¸åŒã€‚\nå¯¹äºå—ä¼˜åŒ–ï¼Œè¦é‡æ–°ç¼–è¯‘çš„ä»£ç å¿…é¡»ç›¸åŒã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€æ‰€æ¶‰åŠçš„æ–‡ä»¶å¿…é¡»æœªç»ä¿®æ”¹ï¼Œå¹¶ä¸”å…¶ä»–ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šé—´æ¥å½±å“ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ã€‚\nå‡ºäºåŒæ ·çš„åŸå› ï¼Œå½“è¦åŒæ—¶ä½¿ç”¨æºæ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œå¿…é¡»å…ˆæ”¶é›†å¹¶åŠ è½½æºä¿¡æ¯ï¼Œç„¶åå†è¿è¡Œæ¶‰åŠå—æ¦‚è¦åˆ†æçš„ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ç¼–è¯‘ã€‚ å³ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š\n1. ç¼–è¯‘ä»£ç å¹¶èµ·å¼€æºä»£ç æ¦‚è¦åˆ†æ 2. è¿è¡Œä»£ç ç”Ÿæˆsource-profilingä¿¡æ¯ 2. è½¬å‚¨source-profiling 3. åŠ è½½source-profiling 3. é‡æ–°ç¼–è¯‘ä»£ç ï¼Œå¹¶å¼€å¯å—æ¦‚è¦åˆ†æ 4. è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ 4. è½¬å‚¨block-profiling 5. åŠ è½½source-å’Œblock-profiling 5. é‡æ–°ç¼–è¯‘ä»£ç  æ ‡è®°æ¯ä¸ªæ­¥éª¤çš„æ•°å­—æ—¢æŒ‡ç¤ºæ­¥éª¤çš„é¡ºåºï¼ŒåˆæŒ‡ç¤ºå¿…é¡»åœ¨åŒä¸€è®¡åˆ’è¿‡ç¨‹ä¸­æ‰§è¡Œçš„é¡ºåºã€‚ ï¼ˆå¦‚æœéœ€è¦ï¼Œæ‰€æœ‰æ­¥éª¤éƒ½å¯ä»¥åœ¨åŒä¸€Schemeæµç¨‹ä¸­æ‰§è¡Œã€‚ï¼‰ å½“compile-profileè®¾ç½®ä¸ºé»˜è®¤å€¼#fæ—¶ï¼Œå°†ç¦ç”¨æºå’Œå—åˆ†æã€‚\nå‡è®¾æ–‡ä»¶/tmp/fatfib/fatfib.ssåŒ…å«ä»¥ä¸‹ä»£ç ï¼š\n(define fat+ (lambda (x y) (if (zero? y) x (fat+ (1+ x) (1- y))))) (define fatfib (lambda (x) (if (\u0026lt; x 2) 1 (fat+ (fatfib (1- x)) (fatfib (1- (1- x))))))) æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·åŠ è½½fatfib.sså¹¶ä¸”å¼€å¯æ¦‚è¦åˆ†æï¼š\n(parameterize ([compile-profile \u0026#39;source]) (load \u0026#34;/tmp/fatfib/fatfib.ss\u0026#34;)) ç„¶åè¿è¡Œä»£ç ï¼š\n(fatfib 20) â‡’ 10946 è¿è¡Œï¼ˆæˆ–å¤šæ¬¡è¿è¡Œï¼‰ä¹‹åï¼Œè½¬å‚¨æ¦‚è¦æ–‡ä»¶ä¸ºä¸€äº›htmlæ–‡ä»¶é›†åˆï¼š ä½¿ç”¨profile-dump-html\n(profile-dump-html) è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºprofile.htmlçš„æ–‡ä»¶\nåœ¨å›¾ä¸­ï¼Œæ‰§è¡Œæœ€é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘çº¢è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºï¼Œè€Œæ‰§è¡Œæœ€ä¸é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘ç´«è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºã€‚\ncompile-profile\nå½“å°†æ­¤å‚æ•°è®¾ç½®ä¸ºç¬¦å·sourceæˆ–å¸ƒå°”å€¼**#tæ—¶ï¼Œç¼–è¯‘å™¨å°†ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¿™äº›æŒ‡ä»¤å¯¹æºä»£ç çš„æ¯ä¸ªéƒ¨åˆ†æ‰§è¡Œçš„æ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸ºç¬¦å·blockæ—¶ï¼Œç¼–è¯‘å™¨ç±»ä¼¼åœ°ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¯¥æŒ‡ä»¤å¯¹æ¯ä¸ªä»£ç å—çš„æ‰§è¡Œæ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸º#f**ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ’å…¥è¿™äº›æŒ‡ä»¤ã€‚\nå½“compile-profileä¸ºéfalseæ—¶ç”Ÿæˆçš„ä»£ç è¾ƒå¤§ä¸”æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤ä»…åœ¨éœ€è¦æ¦‚è¦åˆ†æä¿¡æ¯æ—¶æ‰åº”è®¾ç½®æ­¤å‚æ•°ã€‚å¯ç”¨æ¦‚è¦åˆ†ææ£€æµ‹åç¼–è¯‘çš„ä»£ç çš„æ¦‚è¦æ–‡ä»¶è®¡æ•°å™¨å°†æ— é™æœŸä¿ç•™ï¼Œå³ä½¿ä¸å®ƒä»¬å…³è”çš„ä»£ç å·²è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ è¿™æ ·å¯ä»¥å¾—åˆ°æ›´å®Œæ•´å’Œå‡†ç¡®çš„æ¦‚è¦åˆ†ææ•°æ®ï¼Œä½†ä¼šå¯¼è‡´åŠ¨æ€ç”Ÿæˆæˆ–åŠ è½½ä»£ç çš„ç¨‹åºå‡ºç°ç©ºé—´æ³„æ¼ï¼Œç¨‹åºå¯ä»¥é€šè¿‡profile-release-countersè¿‡ç¨‹æ˜¾å¼åœ°é‡Šæ”¾è®¡æ•°å™¨ï¼Œä»è€Œé¿å…æ½œåœ¨çš„ç©ºé—´æ³„æ¼ã€‚\n(profile-clear)\nè°ƒç”¨æ­¤è¿‡ç¨‹ä¼šæ¸…ç©ºæ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä»£ç æ¯ä¸ªéƒ¨åˆ†å…³è”çš„è®¡æ•°éƒ½è¢«ç½®ä¸º0\n(profile-release-counters)\nè°ƒç”¨æ­¤è¿‡ç¨‹å°†ä¸¢å¼ƒæ¦‚è¦åˆ†æ\n(profile-dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆè‡ªå¯åŠ¨æˆ–ä¸Šæ¬¡è°ƒç”¨profile-clearä»¥æ¥æ”¶é›†çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ä¿¡æ¯çš„è½¬å‚¨ã€‚ å®ƒè¿”å›ä¸€ä¸ªpairçš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªpairçš„caræ˜¯ä¸€ä¸ªsource-objectï¼Œè€Œcdræ˜¯ä¸€ä¸ªç²¾ç¡®çš„éè´Ÿæ•´æ•°è®¡æ•°ã€‚\nprofile-dumpä¼˜äºprofile-dump-listçš„ä¼˜ç‚¹åœ¨äºï¼Œprofile-dumpä»…æ‰§è¡Œæœ€å°‘çš„å¤„ç†ï¼Œå¹¶ä¿ç•™å®Œæ•´çš„æºå¯¹è±¡ï¼ŒåŒ…æ‹¬å…¶åµŒå…¥å¼æºæ–‡ä»¶æè¿°ç¬¦ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºå°†æ¦‚è¦åˆ†æä¿¡æ¯è½¬å‚¨åˆ°ä¸€å°è®¡ç®—æœºä¸Šçš„faslæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šè¿›è¡Œåç»­å¤„ç†ã€‚\n(profile-dump-html) | (profile-dump-html prefix) | (profile-dump-html prefix dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªHTMLæ–‡ä»¶ï¼ŒåŒ…æ‹¬profile.htmlï¼ˆå…¶ä¸­åŒ…å«ç”¨é¢œè‰²ç¼–ç çš„æ‘˜è¦ä¿¡æ¯ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ–‡ä»¶source.htmlï¼Œå…¶ä¸­æ¯ä¸ªæºæ–‡ä»¶æºéƒ½åŒ…å«ç”¨æºä»£ç è¿›è¡Œé¢œè‰²ç¼–ç çš„å‰¯æœ¬ï¼Œå¦‚å‰å¯¼ä¸­æ‰€è¿°ï¼š åœ¨æœ¬èŠ‚ä¸­ã€‚ å¦‚æœæŒ‡å®šäº†prefix ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆçš„HTMLæ–‡ä»¶çš„åç§°ä¹‹å‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå‰ç¼€ä¸º**â€œ /tmp/â€ï¼Œåˆ™ç”Ÿæˆçš„æ–‡ä»¶å°†æ”¾ç½®åœ¨ç›®å½•/tmpä¸­ã€‚ åŸå§‹æ¦‚è¦åˆ†æä¿¡æ¯æ˜¯ä»è½¬å‚¨è·å–çš„ï¼Œé»˜è®¤ä¸ºprofile-dump**è¿”å›çš„å€¼\n(profile-palette)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯è‡³å°‘ä¸‰å¯¹çš„éç©ºå‘é‡ã€‚ æ¯ä¸ªpairçš„caræ˜¯èƒŒæ™¯è‰²ï¼Œè€Œcdræ˜¯å‰æ™¯ï¼ˆæ–‡æœ¬ï¼‰è‰²ã€‚ æ¯ç§é¢œè‰²éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ¯ä¸ªå­—ç¬¦ä¸²éƒ½åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ ç¬¬ä¸€ç»„ç”¨äºæœªé…ç½®çš„ä»£ç ï¼Œç¬¬äºŒå¯¹ç”¨äºæœªæ‰§è¡Œçš„é…ç½®çš„ä»£ç ã€‚ ç¬¬ä¸‰ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€ä½çš„ä»£ç ï¼Œç¬¬å››ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡å€’æ•°ç¬¬äºŒä½çš„ä»£ç ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„ä»£ç ã€‚ ç¨‹åºå‘˜å¯èƒ½å¸Œæœ›æä¾›è‡ªå·±çš„è°ƒè‰²æ¿ä»¥å¢å¼ºå¯è§æ€§æˆ–æ›´æ”¹æ‰€ç”¨é¢œè‰²çš„æ•°é‡ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œé»‘è‰²èƒŒæ™¯ç”¨äºæœªé…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œç°è‰²èƒŒæ™¯ç”¨äºæœªæ‰§è¡Œçš„é…ç½®æ–‡ä»¶çš„ä»£ç ã€‚ æ ¹æ®æ‰§è¡Œé¢‘ç‡ï¼Œç´«è‰²åˆ°çº¢è‰²çš„èƒŒæ™¯é¢œè‰²ç”¨äºæ‰§è¡Œçš„æ¦‚è¦åˆ†æä»£ç ï¼Œè€Œæœ€é¢‘ç¹æ‰§è¡Œçš„ä»£ç ä½¿ç”¨çº¢è‰²ã€‚\n(profile-palette) â‡’ #((\u0026#34;#111111\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#607D8B\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#9C27B0\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#673AB7\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#3F51B5\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#2196F3\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00BCD4\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#4CAF50\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#CDDC39\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFEB3B\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFC107\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF9800\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#F44336\u0026#34; . \u0026#34;white\u0026#34;)) (profile-palette ; set palette with rainbow colors and black text ; for all but unprofiled or unexecuted code \u0026#39;#((\u0026#34;#000000\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#666666\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#8B00FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#6600FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#0000FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00FF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFFF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF7F00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF0000\u0026#34; . \u0026#34;black\u0026#34;))) ; red (profile-line-number-color)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–#fã€‚ å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™profile-dump-htmlä½¿ç”¨æŒ‡å®šçš„é¢œè‰²åœ¨æ¯ä¸ªæºæ–‡ä»¶çš„htmlå‘ˆç°ä¸­åŒ…æ‹¬è¡Œå·ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸º#fï¼Œåˆ™ä¸åŒ…å«è¡Œå·ã€‚\nä¸ªæ€§åŒ–ï¼ˆWaiter Customizationï¼‰ (new-cafe) | (new-cafe eval-proc)\nChez Schemeé€šè¿‡waiter æˆ–read-eval-printå¾ªç¯ï¼ˆREPLï¼‰ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚ waiteråœ¨ç§°ä¸ºcafÌeçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå°†ç”¨æˆ·ç½®äºcafÌeä¸­å¹¶åˆ†é…waiter ã€‚ new-cafeåœ¨æ—§çš„cafÌeä¹‹ä¸Šå¼€å¯äº†ä¸€ä¸ªæ–°çš„Scheme cafÌeã€‚ é™¤äº†å¯åŠ¨waiter ä¹‹å¤–ï¼Œnew-cafeè¿˜è®¾ç½®äº†cafÌeçš„é‡ç½®å’Œé€€å‡ºå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…reset-handlerå’Œexit-handlerï¼‰ã€‚ é€€å‡ºcafÌeä¼šè¿”å›åˆ°åˆ›å»ºè¯¥cafÌeçš„cafÌeã€‚ä»æœ€åˆçš„cafÌeé€€å‡ºåä¼šå®Œå…¨é€€å‡ºäº†Schemeã€‚ cafÌeå¯ä»¥é€šè¿‡æ˜¾å¼è°ƒç”¨exitæˆ–é€šè¿‡æ¥æ”¶end-of-fileï¼ˆUnixç³»ç»Ÿä¸Šä¸ºâ€œ control-Dâ€ï¼‰æ¥é€€å‡ºã€‚åœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™exitçš„ä»»ä½•å€¼éƒ½æ˜¯ä»new-cafeè¿”å›çš„ã€‚\n\u0026gt; (define x 1) \u0026gt; x 1 \u0026gt; (new-cafe) \u0026gt;\u0026gt; x 1 \u0026gt;\u0026gt; (define y 2) \u0026gt;\u0026gt; y 2 \u0026gt;\u0026gt; (exit 1) 1 å¦‚æœæŒ‡å®šäº†å¯é€‰çš„eval-proc å‚æ•°ï¼Œåˆ™ä½¿ç”¨eval-proc æ±‚å€¼ä»æ§åˆ¶å°è¾“å…¥çš„ç¨‹åºã€‚ å¦åˆ™ï¼Œå°†ä½¿ç”¨å‚æ•°current-eval çš„å€¼ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\n\u0026gt; (new-cafe (lambda (x) x)) \u0026gt;\u0026gt; 3 3 \u0026gt;\u0026gt; (a . (b . (c . ()))) (a b c) \u0026gt; (define sum (lambda (ls) (if (null? ls) 0 (+ (car ls) (sum (cdr ls)))))) \u0026gt; (new-cafe sum) \u0026gt;\u0026gt; (1 2 3) 6 æ—¶é—´å’Œæ—¥æœŸ æ—¶é—´ç”±æ—¶é—´å¯¹è±¡è¡¨ç¤ºã€‚ æ—¶é—´å¯¹è±¡è®°å½•ç‰¹å®šæ—¶é—´æˆ–æŒç»­æ—¶é—´çš„çº³ç§’å’Œç§’ï¼Œä»¥åŠæ ‡è¯†æ—¶é—´å¯¹è±¡æ€§è´¨çš„time type ã€‚ æ—¶é—´ç±»å‹æ˜¯ä»¥ä¸‹ç¬¦å·ä¹‹ä¸€ï¼š time-utc: ä»â€œçºªå…ƒâ€1970å¹´1æœˆ1æ—¥0ç‚¹0åˆ†0ç§’ä»¥æ¥çš„æ—¶é—´ time-monotonic: ä»è¿‡å»æŸä¸ªä»»æ„æ—¶é—´ç‚¹å¼€å§‹ç»è¿‡çš„æ—¶é—´ï¼Œç†æƒ³æƒ…å†µä¸‹æ— éœ€è¿›è¡Œè°ƒæ•´ã€‚ time-duration: ä¸¤ä¸ªæ—¶é—´çš„é—´éš”ã€‚å½“ä½œä¸ºcurrent-timeçš„å‚æ•°æ—¶ï¼Œå…¶è¡Œä¸ºä¸time-monotonicç±»ä¼¼ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ—¶é—´å¯¹è±¡ç›¸å‡çš„ç»“æœ time-process: å½“å‰è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ time-thread: å½“å‰çº¿ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ å¦‚æœæœªè¿è¡Œçº¿ç¨‹ï¼Œæˆ–è€…ç³»ç»Ÿä¸å…è®¸ç¡®å®šå•ä¸ªçº¿ç¨‹æ—¶é—´ï¼Œåˆ™è¯¥æ—¶é—´ä¸time-processç›¸åŒã€‚ time-collector-cpu: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†CPUæ¶ˆè€—çš„æ—¶é—´ã€‚ time-collector-real: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†å®æ—¶æ¶ˆè€—çš„æ—¶é—´\næ—¥æœŸç”±æ—¥æœŸå¯¹è±¡è¡¨ç¤ºã€‚ æ—¥æœŸå¯¹è±¡è®°å½•ç‰¹å®šæ—¥æœŸçš„çº³ç§’ï¼Œç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œæ—¥ï¼Œæœˆå’Œå¹´ï¼Œä»¥åŠæ ‡è¯†æ—¶åŒºçš„åç§»é‡ã€‚\n(current-time) | (current-time time-type)\ntime-type å¿…é¡»æ˜¯ä¸Šè¿°çš„æ—¶é—´å¯¹è±¡ä¹‹ä¸€ï¼Œé»˜è®¤ä¸ºtime-utc\n(current-time) â‡’ #\u0026lt;time-utc 1198815722.473668000\u0026gt; (current-time â€™time-process) â‡’ #\u0026lt;time-process 0.120534264\u0026gt; (make-time type nsec sec)\ntype å¿…é¡»æ˜¯ä¸Šé¢åˆ—å‡ºçš„æ—¶é—´ç±»å‹ç¬¦å·ä¹‹ä¸€ã€‚ nsec è¡¨ç¤ºçº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚sec è¡¨ç¤ºç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç²¾ç¡®çš„æ•´æ•°ã€‚\n(make-time \u0026#39;time-utc 787511000 1198783214) (make-time \u0026#39;time-duration 10 5) (make-time \u0026#39;time-duration 10 -5) (time? obj)\n(time? (current-time)) â‡’ #t (time? (make-time â€™time-utc 0 0)) â‡’ #t (time? \u0026#34;1400 hours\u0026#34;) â‡’ #f (time-type time)\nè¿”å›time çš„æ—¶é—´ç±»å‹\n(time-nanosecond time)\nè¿”å›time çš„çº³ç§’\n(time-second time)\nè¿”å›time çš„ç§’\n(set-time-type! time type) | (set-time-nanosecond! time nsec) | (set-time-second! time sec)\næ¯ä¸€ä¸ªè¿‡ç¨‹éƒ½ä¼šä¿®æ”¹æ—¶é—´å¯¹è±¡ï¼Œåªæ”¹å˜å±€éƒ¨ï¼Œè€Œå…¶ä»–å€¼åˆ™ä¸å—å½±å“ã€‚ ä¾‹å¦‚ï¼Œset-time-nanosecond! åªæ›´æ”¹çº³ç§’æ—¶é—´ï¼Œè€Œä¸æ›´æ”¹ç§’æˆ–ç±»å‹ã€‚ ç‰¹åˆ«åœ°ï¼Œå½“æ—¶é—´å¯¹è±¡çš„ç±»å‹æ”¹å˜æ—¶ï¼Œå€¼å¹¶ä¸ä¼šæ›´æ”¹ã€‚\n(time=? time1 time2) | (time\u0026lt;? time1 time2) | (time\u0026gt;? time1 time2) | (time\u0026lt;=? time1 time2) | (time\u0026gt;=? time1 time2)\næ—¶é—´æ¯”è¾ƒã€‚\n(copy-time time)\nå¤åˆ¶æ—¶é—´ã€‚\n(define t1 (current-time)) (define t2 (copy-time t1)) (eq? t2 t1) â‡’ #f (eqv? (time-second t2) (time-second t1)) â‡’ #t (eqv? (time-nanosecond t2) (time-nanosecond t1)) â‡’ #t (time-difference time1 time2 ) | (time-difference! time1 time2 ) | (add-duration time timed) | (add-duration! time timed) | (subtract-duration time timed) | (subtract-duration! time timed)\nå¯¹äºtime-differenceï¼Œtime1å’Œtime2å¿…é¡»å…·æœ‰ç›¸åŒçš„æ—¶é—´ç±»å‹ï¼Œç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ å¯¹äºadd-durationï¼Œadd-durationï¼ï¼Œsubtract-durationå’Œsubtract-durationï¼ï¼Œtimedå¿…é¡»å…·æœ‰æ—¶é—´ç±»å‹time-durationï¼Œå¹¶ä¸”ç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸æ—¶é—´ç›¸åŒçš„æ—¶é—´å¯¹è±¡ã€‚ time-differenceï¼ï¼Œadd-durationï¼å’Œsubtract-durationï¼ å¯èƒ½å…·æœ‰ç ´åæ€§ï¼Œå³æ¯ä¸ªå¯¹è±¡éƒ½å¯èƒ½ä¿®æ”¹å¹¶è¿”å›å…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ–è€…å¯èƒ½åˆ†é…äº†æ–°çš„æ—¶é—´å¯¹è±¡\n(let ([delay (make-time \u0026#39;time-duration 0 1)]) (let ([t1 (current-time \u0026#39;time-monotonic)]) (sleep delay) (let ([t2 (current-time \u0026#39;time-monotonic)]) (let ([t3 (time-difference t2 t1)]) (and (eq? (time-type t3) \u0026#39;time-duration) (time\u0026gt;=? t3 delay) (time=? (add-duration t1 t3) t2) (time=? (subtract-duration t2 t3) t1)))))) â‡’ #t (current-date) | (current-date offset)\nå¦‚ä¸Šæ‰€è¿°ï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»é‡ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥è·å¾—UTC.offsetè¡¨ç¤ºUTCä»¥ä¸œä»¥ç§’ä¸ºå•ä½çš„æ—¶åŒºåç§»é‡ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\nå¦‚æœæœªæä¾›offset ï¼Œåˆ™ä½¿ç”¨å½“å‰æ—¶åŒºçš„offsetï¼Œä»¥åŠdate-dstï¼Ÿ å’Œdate-zone-nameæŠ¥å‘Šæœ‰å…³æ—¶åŒºçš„ä¿¡æ¯ã€‚ å¦‚æœæä¾›äº†åç§»é‡ï¼Œé‚£ä¹ˆdate-dstï¼Ÿ å’Œç»“æœæ—¥æœŸå¯¹è±¡ä¸Šçš„date-zone-nameéƒ½æ˜¯**#f**ã€‚\n(current-date) â‡’ #\u0026lt;date Thu Dec 27 23:23:20 2007\u0026gt; (current-date 0) â‡’ #\u0026lt;date Fri Dec 28 04:23:20 2007\u0026gt; (date-zone-name (current-date)) â‡’ \u0026#34;EST\u0026#34; or other system-provided string (date-zone-name (current-date 0)) â‡’ #f (make-date nsec sec min hour day mon year) | (make-date nsec sec min hour day mon year offset)\nnsecä»£è¡¨çº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚secä»£è¡¨ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº62çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚minä»£è¡¨åˆ†é’Ÿï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº60çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚hourå¿…é¡»æ˜¯ç²¾ç¡®çš„éè´Ÿæ•´æ•° å°äº24ã€‚dayå¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤dayâ‰¤31ã€‚ï¼ˆå®é™…ä¸Šé™å¯èƒ½å–å†³äºæœˆä»½å’Œå¹´ä»½ã€‚ï¼‰monè¡¨ç¤ºæœˆä»½å¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤monâ‰¤12ã€‚å¹´å¿…é¡» æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå®ƒåº”è‡³å°‘ä¸º1970ã€‚offsetè¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯-86400åˆ°+86400ï¼ˆå«ï¼‰èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥æŒ‡å®šUTCã€‚\n(make-date 0 0 0 0 1 1 1970 0) â‡’ #\u0026lt;date Thu Jan 1 00:00:00 1970\u0026gt; (make-date 0 30 7 9 23 9 2007 -14400) â‡’ #\u0026lt;date Sun Sep 23 09:07:30 2007\u0026gt; (date-zone-name (make-date 0 30 7 9 23 9 2007 -14400)) â‡’ #f (string? (date-zone-name (make-date 0 30 7 9 23 9 2007))) â‡’ #t (date-nanosecond date) | (date-second date) | (date-minute date) | (date-hour date) | (date-day date) | (date-month date) | (date-year date) | (date-zone-offset date)\nå¦‚å­—é¢çš„æ„æ€ï¼Œ è¿”å›æ—¥æœŸçš„å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(date-week-day date) | (date-year-day date)\né€šè¿‡è¿™äº›è¿‡ç¨‹ï¼Œå¯ä»¥ç¡®å®šä»¥date è¡¨ç¤ºçš„æ—¥æœŸæ˜¯æ˜ŸæœŸå‡ è¿˜æ˜¯æ¯å¹´çš„æŸå¤©ã€‚ week-dayæ˜¯å°äº7çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0è¡¨ç¤ºæ˜ŸæœŸæ—¥ï¼Œ1è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œä¾æ­¤ç±»æ¨ã€‚ year-dayæ˜¯å°äº367çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0ä»£è¡¨ä¸€å¹´çš„ç¬¬ä¸€å¤©ï¼ˆ1æœˆ1æ—¥ï¼‰ï¼Œ1ä»£è¡¨ç¬¬äºŒå¤©ï¼Œ2ä»£è¡¨ç¬¬ä¸‰å¤©ï¼Œä¾æ­¤ç±»æ¨ã€‚\n(time-utc-\u0026gt;date time) | (time-utc-\u0026gt;date time offset) | (date-\u0026gt;time-utc date)\nè¿™äº›è¿‡ç¨‹ç”¨äºåœ¨æ—¶é—´å’Œæ—¥æœŸå¯¹è±¡ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ time-utc-\u0026gt;dateçš„æ—¶é—´å‚æ•°å¿…é¡»å…·æœ‰time-type utcï¼Œdate-\u0026gt;time-utcå§‹ç»ˆè¿”å›å¸¦æœ‰time-type utcçš„æ—¶é—´å¯¹è±¡ã€‚\nå¯¹äºtime-utc-\u0026gt;dateï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„ç§’æ•°ä¸­çš„æ—¶åŒºåç§»ï¼Œå¦‚æœ¬èŠ‚å¼€å¤´æ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\n(date-and-time) | (date-and-time date)\nå­—ç¬¦ä¸²å§‹ç»ˆé‡‡ç”¨ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºçš„æ ¼å¼ï¼Œé•¿åº¦å§‹ç»ˆä¸º24ã€‚\n(date-and-time) â‡’ \u0026#34;Fri Jul 13 13:13:13 2001\u0026#34; (defined (make-date 0 0 0 0 1 1 2007 0)) (date-and-time d) â‡’ \u0026#34;Mon Jan 01 00:00:00 2007\u0026#34; (sleep time)\ntime å¿…é¡»æ˜¯ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ sleep å¯¼è‡´è°ƒç”¨çº¿ç¨‹åœ¨å¤§çº¦ç”±æ—¶é—´å¯¹è±¡æŒ‡ç¤ºçš„æ—¶é—´é‡å†…æš‚åœæ“ä½œï¼Œé™¤éè¯¥è¿›ç¨‹æ”¶åˆ°ä¸­æ–­ç¡çœ æ“ä½œçš„ä¿¡å·ã€‚ å®é™…ç¡çœ æ—¶é—´å–å†³äºç³»ç»Ÿæ—¶é’Ÿçš„ç²’åº¦ä»¥åŠç³»ç»Ÿè¿è¡Œå…¶ä»–çº¿ç¨‹å’Œè¿›ç¨‹çš„ç¹å¿™ç¨‹åº¦ã€‚\næ—¶é—´å’Œç»Ÿè®¡ (time expr) timeæ±‚å€¼expr ï¼Œå¹¶ä¸”ä½œä¸ºå‰¯ä½œç”¨ï¼Œæ‰“å°ï¼ˆåˆ°console-outputç«¯å£ï¼‰cpuæ—¶é—´é‡ï¼Œå®æ—¶æ—¶é—´é‡ï¼Œåˆ†é…çš„å­—èŠ‚æ•°ä»¥åŠä¸æ±‚å€¼expr ç›¸å…³çš„æ”¶é›†å¼€é”€ã€‚\n\u0026gt; (time (collect)) (time (collect)) 1 collection 1 ms elapsed cpu time, including 1 ms collecting 1 ms elapsed real time, including 1 ms collecting 160 bytes allocated, including 8184 bytes reclaimed (cpu-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥æ¶ˆè€—çš„cpuæ—¶é—´é‡ã€‚\nè¯¥é‡ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ è¯¥æ•°é‡åŒ…æ‹¬â€œsystemâ€æ—¶é—´å’Œâ€œuserâ€æ—¶é—´ï¼Œå³ä»£è¡¨è¿›ç¨‹åœ¨å†…æ ¸ä¸­èŠ±è´¹çš„æ—¶é—´ä»¥åŠåœ¨è¿›ç¨‹æœ¬èº«ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚\n(real-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥ç»è¿‡çš„å®æ—¶æ—¶é—´\nä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´æ€»é‡\n(bytes-allocated) | (bytes-allocated g)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ•°\nå¦‚æœæä¾›äº†g ï¼Œåˆ™bytes-allocatedè¿”å›æŒ‡å®šgenerationä¸­å½“å‰ä¸ºSchemeå¯¹è±¡åˆ†é…çš„å­—èŠ‚æ•°ã€‚ g å¿…é¡»ä¸ºéè´Ÿç²¾ç¡®æ•´æ•°ï¼Œä¸”ä¸å¾—å¤§äºæœ€å¤§éé™æ€generationï¼Œå³ï¼Œcollect-maximum-generationè¿”å›çš„å€¼æˆ–ç¬¦å·ä¸ºstaticã€‚ å¦‚æœæœªæä¾›g ï¼Œåˆ™bytes-allocatedè¿”å›æ‰€æœ‰generationä¸­åˆ†é…çš„å­—èŠ‚æ€»æ•°ã€‚\n(initial-bytes-allocated)\nè¿”å›ï¼šåŠ è½½å¯åŠ¨æ–‡ä»¶ååˆ†é…çš„æ€»å­—èŠ‚æ•°\n(bytes-deallocated)\nè¿”å›ï¼šåƒåœ¾å›æ”¶å™¨é‡Šæ”¾çš„æ€»å­—èŠ‚æ•°\né€šè¿‡å°†ï¼ˆbytes-deallocatedï¼‰å’Œï¼ˆbytes-allocatedï¼‰ç›¸åŠ å¹¶å‡å»ï¼ˆinitial-bytes-allocatedï¼‰ï¼Œå¯ä»¥è·å¾—å½“å‰è¿›ç¨‹åˆ†é…çš„æ€»å­—èŠ‚æ•°ï¼ˆæ— è®ºæ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ï¼‰ã€‚\n(current-memory-bytes)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ€»æ•°ï¼ŒåŒ…æ‹¬å¼€é”€.\ncurrent-memory-bytesè¿”å›å †çš„æ€»å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä¸ä»…åŒ…æ‹¬Schemeå¯¹è±¡å ç”¨çš„å­—èŠ‚ï¼Œè¿˜åŒ…æ‹¬å„ç§å½¢å¼çš„å¼€é”€ï¼ˆåŒ…æ‹¬ç¢ç‰‡å’Œä¿ç•™ä½†å½“å‰ä¸å ç”¨çš„å†…å­˜ï¼‰ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿä¸­å½“å‰è¿›ç¨‹çš„å †å†…å­˜é‡çš„å‡†ç¡®åº¦é‡å€¼\n(maximum-memory-bytes)\nè¿”å›ï¼šåˆ†é…è¿‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å¼€é”€\n(reset-maximum-memory-bytes!)\nå°†å †å†…å­˜çš„æœ€å¤§è®°å½•å€¼é‡ç½®ä¸ºå½“å‰å †å¤§å°\n(collections)\nè¿”å›ï¼šåˆ°ç›®å‰ä¸ºæ­¢çš„åƒåœ¾å›æ”¶æ¬¡æ•°\n(statistics)\nè¿”å›ï¼šåŒ…å«å½“å‰ç»Ÿè®¡ä¿¡æ¯çš„sstatsè®°å½•\nstatisticså°†å„ç§æ—¶é—´å’Œåˆ†é…ç»Ÿè®¡ä¿¡æ¯æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªsstatsè®°å½•ã€‚ sstatsè®°å½•å…·æœ‰ä»¥ä¸‹å­—æ®µï¼š\ncpu, æ¶ˆè€—çš„cpuæ—¶é—´ real, ç»è¿‡çš„æ—¶é—´ bytes, åˆ†é…çš„å­—èŠ‚æ•° gc-count, gcæ¬¡æ•° gc-real, gcç»å†çš„æ—¶é—´ gc-bytes, gcå›æ”¶çš„å­—èŠ‚æ•° æ‰€æœ‰å€¼éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç®—\nstatisticså¯ä»¥åƒå¦‚ä¸‹å®šä¹‰ï¼š\n(define statistics (lambda () (make-sstats (current-time â€™time-thread) (current-time â€™time-monotonic) (- (+ (bytes-allocated) (bytes-deallocated)) (initial-bytes-allocated)) (collections) (current-time â€™time-collector-cpu) (current-time â€™time-collector-real) (bytes-deallocated)))) (make-sstats cpu real bytes gc-count gc-cpu gc-real gc-bytes) è¿”å›ï¼šsstatsè®°å½•\n(sstats-cpu s) | (sstats-real s) | (sstats-bytes s) | (sstats-gc-count s) | (sstats-gc-cpu s) | (sstats-gc-real s) | (sstats-gc-bytes s)\nè¿”å›ï¼šs å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(set-sstats-cpu! s new-value) | (set-sstats-real! s new-value) | (set-sstats-bytes! s new-value) | (set-sstats-gc-count! s new-value) | (set-sstats-gc-cpu! s new-value) | (set-sstats-gc-real! s new-value) | (set-sstats-gc-bytes! s new-value)\nè®¾ç½®å¯¹åº”éƒ¨åˆ†çš„å€¼\n(sstats-difference s1 s2)\næ¯”è¾ƒä¸¤ä¸ªsstats\nenable-object-counts\nenable-object-countsçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒç¡®å®šæ”¶é›†å™¨åœ¨è¿è¡Œæ—¶æ˜¯å¦è®°å½•å¯¹è±¡è®¡æ•°ï¼Œä»è€Œç¡®å®šè¿‡ç¨‹å¯¹è±¡è®¡æ•°è¿”å›çš„object-countsæ˜¯å¦å‡†ç¡®ã€‚ ç”±äºå¯ç”¨å¯¹è±¡è®¡æ•°ä¼šå¢åŠ æ”¶é›†çš„å¼€é”€ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹è¯¥å‚æ•°è®¾ç½®ä¸º#fã€‚\n(object-counts)\nè¿‡ç¨‹object-countsxè¿”å›ä¸€ä¸ªåµŒå¥—çš„å…³è”åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨è¡¨ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨å®ä¾‹çš„æ¯ä¸ªå †åˆ†é…çš„åŸå§‹ç±»å‹å’Œè®°å½•ç±»å‹åˆ†é…çš„å¯¹è±¡è®¡æ•°å’Œå­—èŠ‚ã€‚ ï¼ˆå †åˆ†é…çš„åŸºæœ¬ç±»å‹åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œpairå’Œå‘é‡ï¼Œä½†ä¸åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œfixnumæˆ–å­—ç¬¦ã€‚ï¼‰ä»…å½“enable-object-countsxxä¸º#tæ—¶ï¼Œæ”¶é›†å™¨æ‰ä¼šæ”¶é›†å¯¹è±¡è®¡æ•°ã€‚\nobject-countsxè¿”å›çš„å…³è”åˆ—è¡¨å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š ((type (generation count . bytes) \u0026hellip;) \u0026hellip;)\ntypeæ˜¯åŸå§‹ç±»å‹çš„åç§°ï¼Œä»¥ç¬¦å·ï¼ˆä¾‹å¦‚ï¼Œå¯¹ï¼‰è¡¨ç¤ºï¼Œæˆ–è€…æ˜¯record-typeæè¿°ç¬¦ï¼ˆrtdï¼‰ã€‚ generationæ˜¯ä»‹äº0å’Œï¼ˆcollect-maximum-generationï¼‰çš„å€¼ï¼ˆåŒ…å«åœ¨å†…ï¼‰æˆ–è¡¨ç¤ºé™æ€ç”Ÿæˆçš„ç¬¦å·staticä¹‹é—´çš„éè´Ÿå›ºå®šç¼–å·ã€‚ countå’Œå­—èŠ‚æ˜¯éè´Ÿçš„fixnumã€‚\n(collect-request-handler void) (enable-object-counts #t) (define-record-type frob (fields x)) (define x (make-frob (make-frob #f))) (collect 3 3) (cdr (assoc 3 (cdr (assoc (record-type-descriptor frob) (object-counts))))) =\u0026gt; (2. 16) æˆæœ¬ä¸­å¿ƒ Cost Centers æˆæœ¬ä¸­å¿ƒç”¨äºåœ¨æ±‚å€¼é€‰å®šçš„ä»£ç æ®µæ—¶è·Ÿè¸ªåˆ†é…çš„å­—èŠ‚ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤å’Œ/æˆ–ç»è¿‡çš„CPUæ—¶é—´ã€‚ æˆæœ¬ä¸­å¿ƒæ˜¯é€šè¿‡è¿‡ç¨‹make-cost-centeråˆ›å»ºçš„ï¼Œè€Œæˆæœ¬æ˜¯é€šè¿‡with-cost-centerè¿‡ç¨‹è¿›è¡Œè·Ÿè¸ªçš„ã€‚\nä»…ä¸ºæ­¤ç›®çš„ä»£ç è·Ÿè¸ªåˆ†é…å’ŒæŒ‡ä»¤è®¡æ•°ã€‚ è¯¥å·¥å…·ç”±ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼šgenerate-allocation-countså’Œgenerate-instruction-countsã€‚ é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ£€æµ‹ã€‚ å†…ç½®ç¨‹åºæ²¡æœ‰æ£€æµ‹ï¼Œè§£é‡Šä»£ç æˆ–éSchemeä»£ç ä¹Ÿæ²¡æœ‰ã€‚ ä»…å½“è¿‡ç¨‹with-cost-centerçš„å¯é€‰å‚æ•°*timed?*æœ‰å€¼ä¸”ä¸ä¸ºfalseæ—¶æ‰ä¼šè·Ÿè¸ªç»å†çš„æ—¶é—´\nwith-cost-centerè¿‡ç¨‹å³ä½¿åœ¨ä½¿ç”¨åŒä¸€æˆæœ¬ä¸­å¿ƒé‡æ–°è¾“å…¥ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä½¿ç”¨å¹¶é€šè¿‡ç»§ç»­è°ƒç”¨é€€å‡ºæˆ–é‡æ–°è¾“å…¥ä¸€æ¬¡æˆ–å¤šæ¬¡åï¼Œä¹Ÿè¦éµå¾ªä¸Šè¿°æ³¨æ„äº‹é¡¹æ¥å‡†ç¡®è·Ÿè¸ªæˆæœ¬ã€‚\ngenerate-allocation-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªåˆ†é…ç‚¹æ’å…¥ä¸€å°æ®µæŒ‡ä»¤ï¼Œä»¥è·Ÿè¸ªå‘ç”Ÿçš„åˆ†é…é‡ã€‚æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\ngenerate-instruction-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨å°†åœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªå—ä¸­æ’å…¥ç®€çŸ­çš„æŒ‡ä»¤åºåˆ—ï¼Œä»¥è·Ÿè¸ªè¯¥å—æ‰§è¡Œçš„æŒ‡ä»¤æ•°ã€‚ æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\n(make-cost-center)\nè¿”å›: æ–°çš„æˆæœ¬ä¸­å¿ƒ\n(with-cost-center cost-center thunk) | (with-cost-center timed? cost-center thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—é›¶å‚æ•°çš„è¿‡ç¨‹ã€‚ with-cost-centerè°ƒç”¨ä¸å¸¦å‚æ•°çš„thunk å¹¶è¿”å›å…¶å€¼ã€‚ å®ƒè¿˜å¯ä»¥åŠ¨æ€è®¡ç®—åˆ†é…çš„å­—èŠ‚æ•°ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤ä»¥åŠåœ¨è®¡ç®—thunk è°ƒç”¨æ—¶æ‰€ç»è¿‡çš„cpuæ—¶é—´ï¼Œå¹¶å°†è·Ÿè¸ªçš„æˆæœ¬æ·»åŠ åˆ°æˆæœ¬ä¸­å¿ƒè®°å½•ä¸­ã€‚\nå¦‚ä¸Šæ‰€è¿°ï¼Œä»…å¯¹äºå°†å‚æ•°generate-allocation-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªåˆ†é…è®¡æ•°ï¼Œå¹¶ä¸”ä»…å¯¹å°†generate-instruction-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªæŒ‡ä»¤è®¡æ•°ã€‚ ä»…åœ¨æä¾›timed? ä¸”ä¸ä¸ºfalseçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè·Ÿè¸ªcpuæ—¶é—´ï¼Œå…¶ä¸­åŒ…æ‹¬åœ¨å·²æµ‹é‡çš„ä»£ç ï¼Œæœªæµ‹é‡ä»£ç å’ŒéSchemeä»£ç ä¸­èŠ±è´¹çš„cpuæ—¶é—´ã€‚\n(cost-center-instruction-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„æŒ‡ä»¤æ•°\n(cost-center-allocation-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„å·²åˆ†é…å­—èŠ‚æ•°\n(cost-center-time cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„CPUæ—¶é—´\n(reset-cost-center! cost-center)\næ­¤è¿‡ç¨‹å°†æˆæœ¬ä¸­å¿ƒè®°å½•çš„æˆæœ¬é‡ç½®ä¸ºé›¶ã€‚\nå‚æ•° æœ¬èŠ‚ä»‹ç»äº†ç”¨äºåˆ›å»ºå’Œæ“ä½œå‚æ•°çš„æœºåˆ¶ã€‚ å¯ä»¥ä½¿ç”¨make-parameteræ–¹ä¾¿åœ°åˆ›å»ºæ–°å‚æ•°ã€‚ ä½†æ˜¯ï¼Œé™¤äº†å®ƒä»¬çš„è¡Œä¸ºå¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½å°†å‚æ•°ä¸å…¶ä»–è¿‡ç¨‹åŒºåˆ†å¼€ã€‚ å¦‚æœè°ƒç”¨å‚æ•°æ—¶å¿…é¡»é‡‡å–æ¯”é€šè¿‡make-parameteræœºåˆ¶å®¹æ˜“å®¹çº³çš„æ›´ä¸ºå¤æ‚çš„åŠ¨ä½œï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨case-lambdaå®šä¹‰è¯¥å‚æ•°\n(make-parameter object) | (make-parameter object procudure)\nmake-parameteræ¥å—ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å†…éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯åº”ç”¨äºåˆå§‹å€¼å’Œæ‰€æœ‰åç»­å€¼çš„è¿‡æ»¤å™¨ã€‚ è¿‡æ»¤å™¨åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœè¯¥å€¼ä¸åˆé€‚ï¼Œåˆ™è¿‡æ»¤å™¨åº”å¼•å‘å¼‚å¸¸æˆ–å°†å€¼è½¬æ¢ä¸ºæ›´åˆé€‚çš„å½¢å¼ã€‚\nä¾‹å¦‚ï¼Œprint-lengthçš„é»˜è®¤å®šä¹‰å¦‚ä¸‹ï¼š\n(define print-length (make-parameter #f (lambda (x) (unless (or (not x) (and (fixnum? x) (fx\u0026gt;= x 0))) (assertion-violationf â€™print-length \u0026#34;~s is not a positive fixnum or #f\u0026#34; x)) x))) (print-length) â‡’ #f (print-length 3) (print-length) â‡’ 3 (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123...)\u0026#34; (print-length #f) (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123456)\u0026#34; make-parameterçš„å®šä¹‰ä½¿ç”¨case-lambdaå¾ˆç®€å•ï¼š\n(define make-parameter (case-lambda [(init guard) (let ([v (guard init)]) (case-lambda [() v] [(u) (set! v (guard u))]))] [(init) (make-parameter init (lambda (x) x))])) (parameterize ((param expr) \u0026hellip;) body1 body2 \u0026hellip;)\nä½¿ç”¨è¯­æ³•å½¢å¼parameterizeï¼Œå¯ä»¥ä»¥ç±»ä¼¼äºæ™®é€šå˜é‡çš„fluid-letçš„æ–¹å¼æ›´æ”¹å‚æ•°çš„å€¼ã€‚ åœ¨è®¡ç®—bodyæ—¶ï¼Œå°†æ¯ä¸ªparam è®¾ç½®ä¸ºç›¸åº”çš„expr çš„å€¼ã€‚\n(define test (make-parameter 0)) (test) â‡’ 0 (test 1) (test) â‡’ 1 (parameterize ([test 2]) (test)) â‡’ 2 (test) â‡’ 1 (parameterize ([test 2]) (test 3) (test)) â‡’ 3 (test) â‡’ 1 (define k (lambda (x) x)) (begin (set! k (call/cc k)) â€™k) â‡’ k (parameterize ([test 2]) (test (call/cc k)) (test)) â‡’ k (test) â‡’ 1 (k3) â‡’3 (test) â‡’ 1 è™šæ‹Ÿå¯„å­˜å™¨Virtual registers ç¼–è¯‘å™¨æ”¯æŒä¸€ç»„æœ‰é™çš„è™šæ‹Ÿå¯„å­˜å™¨ ï¼Œä»¥ä¾›éœ€è¦é«˜é€Ÿï¼Œå…¨å±€å’Œå¯å˜å­˜å‚¨ä½ç½®çš„ç¨‹åºä½¿ç”¨ã€‚ å¼•ç”¨æˆ–åˆ†é…è™šæ‹Ÿå¯„å­˜å™¨å¯èƒ½æ¯”è®¿é—®å¯åˆ†é…çš„å±€éƒ¨å˜é‡æˆ–å…¨å±€å˜é‡æ›´å¿«ï¼Œå¹¶ä¸”è®¿é—®æ—¶æ°¸è¿œä¸ä¼šæ¯”å®ƒä»¬æ›´æ…¢ï¼Œè€Œä¸”è¿™æ ·åšçš„ä»£ç åºåˆ—é€šå¸¸æ›´å°ã€‚ åˆ†é…å¯èƒ½ä¼šæ˜¾è‘—åŠ å¿«ï¼Œå› ä¸ºä¸éœ€è¦è·Ÿè¸ªä»è™šæ‹Ÿå¯„å­˜å™¨åˆ°å¹´è½»å¯¹è±¡çš„æŒ‡é’ˆï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨äºè¾ƒæ—©ä¸€ä¸–ä»£ä¸­çš„å¯å˜ä½ç½®ã€‚ åœ¨ç³»ç»Ÿçš„çº¿ç¨‹ç‰ˆæœ¬ä¸Šï¼Œè™šæ‹Ÿå¯„å­˜å™¨æ˜¯â€œæ¯ä¸ªçº¿ç¨‹â€çš„ï¼Œå› æ­¤å¯ä»¥ä»¥æ¯”çº¿ç¨‹å‚æ•°ä½å»‰çš„æ–¹å¼ç”¨ä½œthread-localå­˜å‚¨ã€‚\nè¯¥æ¥å£åŒ…å«ä¸‰ä¸ªè¿‡ç¨‹ï¼švirtual-register-countï¼ˆè¿”å›è™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡ï¼‰ï¼Œset-virtual-register!ï¼ˆè®¾ç½®æŒ‡å®šçš„è™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰å’Œvirtual-registerï¼ˆè·å–æŒ‡å®šè™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰ã€‚\nè™šæ‹Ÿå¯„å­˜å™¨ç”±å°äºè™šæ‹Ÿå¯„å­˜å™¨æ•°é‡çš„éè´Ÿfixnumç´¢å¼•æŒ‡å®šã€‚ ä¸ºäº†è·å¾—set-virtual-register!å’Œvirtual-registerçš„æœ€ä½³æ€§èƒ½ï¼Œç´¢å¼•åº”è¯¥æ˜¯ç›´æ¥åµŒå…¥åœ¨è°ƒç”¨ä¸­çš„å¸¸é‡ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡å¯¹è°ƒç”¨çš„ä¼˜åŒ–æ¥ä¼ æ’­ï¼‰ã€‚ ä¸ºäº†é¿å…å°†è¿™äº›å¸¸é‡æ”¾åœ¨æºä»£ç ä¸­ï¼Œç¨‹åºå‘˜åº”è€ƒè™‘ä½¿ç”¨æ ‡è¯†ç¬¦å®ä¸ºè™šæ‹Ÿå¯„å­˜å™¨å‘½åï¼Œä¾‹å¦‚ï¼š\n(define-syntax current-state (identifier-syntax [id (virtual-register 0)] [(set! id e) (set-virtual-register! 0 e)])) (set! current-state \u0026#39;start) current-state â‡’ start è™šæ‹Ÿå¯„å­˜å™¨å¿…é¡»è¢«è§†ä¸ºåº”ç”¨ç¨‹åºçº§èµ„æºï¼Œå³ï¼Œæ‰“ç®—ç”±å¤šä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨çš„åº“é€šå¸¸ä¸åº”ä½¿ç”¨è™šæ‹Ÿå¯„å­˜å™¨ï¼Œä»¥é¿å…ä¸åº”ç”¨ç¨‹åºä½¿ç”¨å¯„å­˜å™¨å†²çªã€‚\n(virtual-register-count)\nä»9.0ç‰ˆå¼€å§‹ï¼Œè™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡è®¾ç½®ä¸º16ã€‚é™¤éé€šè¿‡æºé‡æ–°ç¼–è¯‘Chez Schemeï¼Œå¦åˆ™æ— æ³•æ›´æ”¹ã€‚\n(set-virtual-register! k x)\n**set-virtual-register!**å°†x å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­ã€‚ k å¿…é¡»æ˜¯å°äºï¼ˆvirtual-register-countï¼‰çš„å€¼çš„éè´Ÿfixnumã€‚\n(virtual-register k)\nvirtual-registerè¿”å›æœ€åä¸€æ¬¡å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­çš„å€¼ï¼ˆåœ¨å½“å‰çº¿ç¨‹ä¸Šï¼‰ã€‚\nç¯å¢ƒæŸ¥è¯¢å’Œè®¾ç½®Environmental Queries and Settings (scheme-version)\nChez Schemeçš„ç‰ˆæœ¬\n(threaded?)\nè¿”å›ï¼š#tï¼ˆå¦‚æœåœ¨ç³»ç»Ÿä¸ºçº¿ç¨‹ç‰ˆæœ¬ï¼‰ï¼Œå¦åˆ™è¿”å›#f\n(get-process-id)\nè¿”å›ï¼šå½“å‰è¿›ç¨‹çš„PID\n(getenv key)\nè¿”å›ï¼šç¯å¢ƒä¸­key çš„å€¼ï¼Œæˆ– #f\n(getenv \u0026#34;HOME\u0026#34;) â‡’ \u0026#34;/u/freddy\u0026#34; (putenv key value)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n(putenv \u0026#34;SCHEME\u0026#34; \u0026#34;rocks!\u0026#34;) (getenv \u0026#34;SCHEME\u0026#34;) â‡’ \u0026#34;rocks!\u0026#34; (get-registry key)\nè¿”å›ï¼škey çš„æ³¨å†Œè¡¨å€¼ï¼Œæˆ–è€…**#f**\n(put-registry! key val) | (remove-registry! key)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n","id":58,"section":"posts","summary":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;) è¿”å›ï¼šæœªæŒ‡å®š è­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢","tags":["scheme"],"title":"ç³»ç»Ÿæ“ä½œ(System Operations in Chez Scheme)","uri":"https://lvsq.net/2020/02/system-operations/","year":"2020"},{"content":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›trueçš„è°“è¯ã€ä»¥åŠæ¯ä¸ªå­—æ®µçš„è®¿é—®procedureå’Œé’ˆå¯¹å¯å˜å­—æ®µçš„èµ‹å€¼procedureã€‚æ€»çš„æ¥è¯´ï¼Œä¸Javaä¸­çš„POJOç±»æ¯”è¾ƒç›¸ä¼¼ï¼Œä¸è¿‡ä¸ç”¨è‡ªå®šä¹‰getterå’Œsetteræ–¹æ³•ï¼Œè¿™ä¸Kotlinå€’ä¸ºç±»ä¼¼ï¼Œä¾‹å¦‚ï¼š\n(define-record-type point (fields x y)) åˆ›å»ºäº†ä¸€ä¸ªåä¸ºpointçš„recordç±»å‹ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå­—æ®µxå’Œyï¼Œå’Œå¦‚ä¸‹å‡ ä¸ªå®šä¹‰å¼ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š\n(make-point x y) æ„é€ å‡½æ•° (point? obj) è°“è¯ (point-x p) å­—æ®µxçš„è®¿é—®å™¨ (point-y p) å­—æ®µyçš„è®¿é—®å™¨ é»˜è®¤ä¸‹ï¼Œå­—æ®µæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å¯ä»¥å£°æ˜ä¸ºå¯å˜çš„ï¼ˆmutableï¼‰ã€‚å¦‚ä¸‹å®šä¹‰pointä¸­ï¼Œå­—æ®µxæ˜¯å¯å˜çš„ï¼Œä½†yç»´æŒä¸å˜ï¼š\n(define-record-type point (fields (mutable x) y)) å½“ç„¶äº¦å¯æ˜¾å¼åœ°å°†å­—æ®µå£°æ˜ä¸ºä¸å¯å˜çš„ï¼š\n(define-record-type point (fields (mutable x) (immutable y))) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdefine-record-typeé™¤äº†ç”Ÿæˆäº†ä¸Šè¿°çš„å‡ ä¸ªå®šä¹‰å¼ä¹‹å¤–ï¼Œè¿˜ä¸ºå­—æ®µxå¢åŠ äº†ä¸€ä¸ªèµ‹å€¼è¿‡ç¨‹ï¼š\n(point-x-set! p x)\nè¯¥èµ‹å€¼è¿‡ç¨‹å¯ä»¥ç”¨äºæ”¹å˜xçš„å†…å®¹\n(define p (make-point 36 -17)) (point-x-set! p (- (point-x p) 12)) (point-x p) =\u0026gt; 24 è‡ªåŠ¨ç”Ÿæˆçš„å‡ ä¸ªå®šä¹‰å¼æ˜¯å…è®¸æ”¹å˜åç§°çš„ï¼Œä¸‹é¢çš„pointå®šä¹‰å¼ï¼Œå…¶æ„é€ å‡½æ•°åä¸ºmkpoint, è°“è¯ä¸ºispoint?ï¼Œxå’Œyçš„è®¿é—®å™¨åˆ†åˆ«ä¸ºx-valå’Œy-val, xçš„èµ‹å€¼å™¨ä¸ºset-x-val!\n(define-record-type (point mkpoint ispoint?) (fields (mutable x x-val set-x-val!) (immutable y y-val))) é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ä¸€ä¸ªrecord definitionåˆ›å»ºä¸€ä¸ªæ–°ç±»å‹ï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥ç”¨Javaæ¥è§£é‡Šï¼Œå³å¯¹äºåŒä¸€ä¸ªPOJOç±»newå‡ºä¸¤ä¸ªå®ä¾‹ï¼Œä½†è¿™ä¸¤ä¸ªå®ä¾‹å¹¶ä¸èƒ½equalï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define (f p) (define-record-type point (fields x y)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #f ç¬¬ä¸€ä¸ªfçš„è°ƒç”¨å³(f \u0026lsquo;make)è¿”å›ä¸€ä¸ªpointç±»å‹çš„pï¼Œå°†pä¼ é€’ç»™ç¬¬äºŒä¸ªfï¼Œä½†pæ˜¯ç”±ç¬¬ä¸€ä¸ªè°ƒç”¨ç”Ÿæˆçš„ç±»å‹ï¼Œæ‰€ä»¥point?è¿”å›#fã€‚æŒ‰ç…§SICPçš„è¯´æ³•ï¼Œè¿™ä¸¤ä¸ªdefine-record-typeå¹¶ä¸åœ¨ä¸€ä¸ªç¯å¢ƒä¸­ï¼Œåªæ˜¯åå­—ä¸€æ ·è€Œå·²ã€‚\né»˜è®¤çš„ç”Ÿäº§è¡Œä¸º(generative behavior)æˆ–è®¸å¯ä»¥ç”±è®°å½•å®šä¹‰å¼ä¸­çš„nongenerativeå­å¥æ¥é‡è½½ï¼š\n(define (f p) (define-record-type point (fields x y) (nongenerative)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #t ä»¥è¿™ç§æ–¹å¼åˆ›å»ºçš„è®°å½•ç±»å‹ä»ç„¶ä¸åŒäºç”±å®šä¹‰å‡ºç°åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¸­åˆ›å»ºçš„è®°å½•ç±»å‹ï¼Œå³ä½¿è¿™äº›å®šä¹‰åœ¨è¯­æ³•ä¸Šæ˜¯ç›¸åŒçš„ï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative)) (point? p)) (g (f)) =\u0026gt; #f ç”šè‡³å¯ä»¥é€šè¿‡åœ¨nongenerativeå­å¥ä¸­åŒ…å«uidï¼ˆå”¯ä¸€idï¼‰æ¥è¦†ç›–å®ƒï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (point? p)) (g (f)) =\u0026gt; #t è®°å½•ç±»å‹å¯ä»¥å®šä¹‰ä¸ºæœ‰parentå­å¥çš„å­ç±»å‹ï¼Œå³ä¸€ä¸ªè®°å½•ç±»å‹å¯ä»¥å£°æ˜ä¸ºæŸä¸€ä¸ªè®°å½•ç±»å‹çš„å­ç±»å‹ï¼Œå¦‚æœæŒ‡å®šäº†çˆ¶ç±»å‹ï¼Œåˆ™å­ç±»å‹å°†ç»§æ‰¿çˆ¶ç±»å‹æ‰€æœ‰å­—æ®µï¼Œä¸”å­ç±»å‹çš„æ¯ä¸ªå®ä¾‹éƒ½è¢«è§†ä¸ºçˆ¶ç±»å‹çš„å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»å‹çš„è®¿é—®å™¨å’Œå­—æ®µç­‰ç­‰ã€‚\n(define-record-type point (fields x y)) (define-record-type cpoint (parent point) (fields color)) (define cp (make-cpoint 3 4 \u0026#39;red)) (point? (make-cpoint 3 4 \u0026#39;red)) =\u0026gt; #t (cpoint? (make-point 3 4)) =\u0026gt; #f (define cp (make-cpoint 3 4 \u0026#39;red)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (cpoint-color cp) =\u0026gt; red åˆ°ç›®å‰ä¸ºæ­¢ï¼Œdefine-record-typeå®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°æ¥å—recordåŒ…å«çš„å­—æ®µä¸€æ ·å¤šçš„å‚æ•°ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥é‡å†™é»˜è®¤å€¼ï¼Œè¿™é‡Œéœ€è¦å¼•å…¥protocolå­å¥ï¼Œä»¥ä¸‹å®šä¹‰å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå­—æ®µçš„ç‚¹è®°å½•ï¼šxï¼Œyå’Œdï¼Œå…¶ä¸­dè¡¨ç¤ºè·åŸç‚¹çš„ä½ç§»ã€‚æ„é€ å‡½æ•°ä»ç„¶åªæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå³xå’Œyå€¼ï¼Œå¹¶å°†dåˆå§‹åŒ–ä¸ºxå’Œyå¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚\n(define-record-type point (fields x y d) (protocol (lambda (new) (lambda (x y) (new x y (sqrt (+ (* x x) (* y y)))))))) (define p (make-point 3 4)) (point-x p) =\u0026gt; 3 (point-y p) =\u0026gt; 4 (point-d p) =\u0026gt; 5 å¦å¤–ï¼Œå­ç±»å‹çš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•°é¡ºåºæ˜¯ä¸å¯æ”¹å˜çš„ï¼Œå³å…ˆæ˜¯çˆ¶ç±»å‹æ„é€ å‡½æ•°çš„å­—æ®µï¼Œç„¶åæ‰æ˜¯å­ç±»å‹çš„å‚æ•°ï¼Œå¦‚æœéœ€è¦æ”¹å˜å­ç±»å‹çš„æ„é€ å‡½æ•°çš„å‚æ•°é¡ºåºè¯¥å¦‚ä½•å‘¢ï¼Ÿ\n(define-record-type cpoint (parent point) (fields color) (protocol (lambda (pargs-\u0026gt;new) (lambda (x c y) ((pargs-\u0026gt;new x y) c))))) (define cp (make-cpoint 3 \u0026#39;red 4)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (point-d cp) =\u0026gt; 5 (cpoint-color cp) =\u0026gt; red æœ€åæ¥çœ‹çœ‹define-record-typeçš„è¯­æ³•å½¢å¼ï¼š\nsyntax: (define-record-type record-name clause \u0026hellip;)\nsyntax: (define-record-type (record-name constructor pred) clause \u0026hellip;)\nFields clauseè¯­æ³•å½¢å¼:\n(fields field-spec \u0026hellip;)\nfield-specå¿…é¡»æ˜¯ä¸‹é¢5ä¸ªä¸­çš„ä¸€ä¸ª:\nfield-name (immmutable field-name) (mutable field-name) (immmutable field-name accessor-name) (mutable field-name accessor-name mutator-name) define-record in Chez Scheme Chez Schemeä¾ç„¶æ”¯æŒ$R^6RS$ä¸­ä¼ ç»Ÿçš„recordç±»å‹çš„å®šä¹‰ï¼Œå¦å¤–è¿˜æä¾›ä¸€ä¸ªæ–°çš„è¯­æ³•ï¼Œå³define-recordï¼Œå…¶è¯­æ³•å½¢å¼ä¸define-record-typeä¸€æ ·ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œdefine-recordä¸­çš„å­—æ®µé»˜è®¤æ˜¯å¯å˜çš„ï¼Œè¿™ä¸$R^6RS$ä¸­çš„recordç›¸åï¼Œå› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªè®°å½•ç±»å‹æ—¶ï¼ŒåŒæ—¶ä¼šå®šä¹‰ä¸‹åˆ—è¿‡ç¨‹ï¼š\n(define-record point (x y)) (make-point x y) ;;\tconstructor (point? obj) ;;\tpredicate (point-x p) ;;\taccessor for field x (point-y p) ;;\taccessor for field y (set-point-x! p obj) ;;\tmutator for field x (set-point-y! p obj) ;;\tmutator for field y é€šè¿‡å¯¹define-record-typeçš„äº†è§£ï¼Œå¯ä»¥å‘ç°å…¶éå¸¸OOï¼Œsmalltalkæ˜¯å¦å—å…¶å½±å“ä¸å¾—è€ŒçŸ¥ï¼Œè‡³å°‘ç»è¿‡çºµå‘æ¯”è¾ƒå¯¹äºæˆ‘ä»¬å­¦ä¹ æŠ€æœ¯å¤§æœ‰è£¨ç›Šã€‚\n","id":59,"section":"posts","summary":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›tr","tags":["scheme"],"title":"Schemeè¯­æ³•define-record-typeä»‹ç»","uri":"https://lvsq.net/2020/02/define-record-type/","year":"2020"},{"content":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åœ¨ Chez Scheme ä¸­ä»¥â€œå¾®æ¨¡å—â€çº§åˆ«ä½¿ç”¨ï¼Œå› ä¸º Chez Scheme ä¸­çš„æ¨¡å—å’Œ import å½¢å¼å±äºå®šä¹‰ï¼Œå¹¶ä¸”å¯ä»¥å‡ºç°åœ¨å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»æ„ä½ç½®ï¼ŒåŒ…æ‹¬åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“æˆ–å…¶ä»–å±€éƒ¨ä½œç”¨åŸŸä¸­ã€‚\nå¾®æ¨¡å—ä¸å‡½æ•°å­°å¥½ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯è§†æƒ…å†µè€Œå®šï¼Ÿï¼Ÿï¼Ÿ\næ¨¡å—æ§åˆ¶ç»‘å®šçš„å¯è§æ€§ï¼Œå¯ä»¥ç”¨ä½œæ‰©å±•è¯æ³•ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ›´ç²¾ç¡®åœ°æ§åˆ¶ç»‘å®šçš„å¯è§èŒƒå›´ã€‚æ¨¡å—å¯¼å‡ºæ ‡è¯†ç¬¦çš„ç»‘å®šï¼Œå³å˜é‡ç»‘å®šã€å…³é”®å­—ç»‘å®šæˆ–æ¨¡å—åç»‘å®šã€‚æ¨¡å—å¯ä»¥æ˜¯å…·åçš„æŠ‘æˆ–åŒ¿åçš„ã€‚åªè¦æ¨¡å—åå¯è§ï¼Œé‚£ä¹ˆåœ¨å…·åæ¨¡å—å‡ºç°å¤„å¯¼å…¥çš„ç»‘å®šéƒ½å¯è§ã€‚åŒ¿åæ¨¡å—ä¸­å¯¼å‡ºçš„ç»‘å®šï¼Œåœ¨æ¨¡å—å‡ºç°çš„åœ°æ–¹è¢«éšå¼åœ°å¯¼å…¥ã€‚åŒ¿åæ¨¡å—å¯ç”¨äºéšè—ä¸€ç»„ç»‘å®šä¸­çš„ä¸€äº›ç»‘å®šï¼ŒåŒæ—¶å…è®¸å…¶ä½™ç»‘å®šå¯è§ã€‚\nè¯­æ³• (module name interface defn \u0026hellip; init \u0026hellip;)\n(module interface defn \u0026hellip; init \u0026hellip;)\nname æ˜¯æ ‡è¯†ç¬¦ï¼Œdefn \u0026hellip; æ˜¯å®šä¹‰ï¼Œinit \u0026hellip; æ˜¯è¡¨è¾¾å¼ã€‚interface æ˜¯å½¢å¦‚ (export \u0026hellip;) çš„å¯¼å‡ºè¡¨ï¼Œå…¶ä¸­æ¯ä¸ª export éƒ½æ˜¯æ ‡è¯†ç¬¦ identifier æŠ‘æˆ–å½¢å¼ (identifier export \u0026hellip;)ã€‚\næ¨¡å—ç”±ä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰å®šä¹‰å’Œä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰åˆå§‹åŒ–è¡¨è¾¾å¼åºåˆ—ç»„æˆã€‚æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼ˆå¯ç†è§£ä¸ºå˜é‡æˆ–è€…çŠ¶æ€ï¼Œä¸‹åŒï¼‰åœ¨æ¨¡å—çš„ç¨‹åºä½“ä¸­å¯è§ï¼Œè¢«å¯¼å‡ºçš„æ ‡è¯†ç¬¦åœ¨æ¨¡å—çš„å¯¼å…¥ä½œç”¨åŸŸå†…äº¦å¯è§ã€‚æ¨¡å—æ¥å£ä¸­åˆ—å‡ºçš„æ¯ä¸ªæ ‡è¯†ç¬¦å¿…é¡»åœ¨è¯¥æ¨¡å—ä¸­å®šä¹‰æˆ–è¢«å¯¼å…¥è¯¥åˆ°æ¨¡å—ã€‚module å½¢å¼æ˜¯ä¸€ç§å®šä¹‰ï¼Œå› æ­¤å¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ï¼ŒåŒ…æ‹¬åµŒå¥—åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“ã€ library å½¢å¼ã€é¡¶å±‚ç¨‹åºï¼Œä»¥åŠåµŒå¥—åœ¨å…¶ä»–æ¨¡å—ä¸­ã€‚æ­¤å¤–ï¼Œå› ä¸ºæ¨¡å—åçš„ä½œç”¨åŸŸä¸å…¶ä»–æ ‡è¯†ç¬¦ç›¸åŒï¼Œæ‰€ä»¥æ¨¡å—å’Œåº“å¯ä»¥åƒå˜é‡å’Œå…³é”®å­—é‚£æ ·å¯¼å‡ºæ¨¡å—åã€‚\næ¨¡å—åä¸å…¶ä»–æ ‡è¯†ç¬¦å ç”¨ç›¸åŒçš„åå­—ç©ºé—´ï¼Œå¹¶éµå¾ªç›¸åŒçš„ä½œç”¨åŸŸè§„åˆ™ã€‚é™¤éè¢«å¯¼å‡ºï¼Œå¦åˆ™æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ä»…åœ¨è¯¥æ¨¡å—ä¸­å¯è§ã€‚\næ¨¡å—å†…çš„è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨åœ¨æ¨¡å—å¤–éƒ¨ç»‘å®šçš„æ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (module m (plusx) (define plusx (lambda (y) (+ x y)))) (import m) (let ([x 4]) (plusx 5))) ; =\u0026gt; 8,æ³¨æ„ä¸æ˜¯9å“¦ï¼Œå¯ä»¥å°†plusxè§†ä¸ºï¼š(define plusx (lambda (y) (+ 3 y)))) åŒæ ·ï¼Œimportä¸ä¼šé˜»æ­¢è®¿é—®å‡ºç°å¯¼å…¥è¡¨å•çš„å¯è§æ ‡è¯†ç¬¦ï¼Œä½†importæ ‡è¯†ç¬¦æ‰€è¦†ç›–çš„å˜é‡é™¤å¤–ï¼ˆå•¥å«è¦†ç›–ï¼Œçœ‹ä¸‹é¢ä¸¤æ®µä»£ç ï¼‰ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import m) (list x y)) ; =\u0026gt; (local-x m-y) æ¨¡å—mä¸­å®šä¹‰äº†æ ‡è¯†ç¬¦y, åœ¨å…¶è¢«importä¹‹åä¼šè¦†ç›–letä¸­çš„yï¼›\n(module m (y) (define y \u0026#39;m-y)) (let () (import m) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (list x y)) ; =\u0026gt; (local-x local-y) ) å…ˆimport mï¼Œä¹‹åå†å®šä¹‰yï¼Œæ¨¡å—ä¸­å®šä¹‰çš„yä¸ä¼šè¦†ç›–letçš„yã€‚\nå¦ä¸€æ–¹é¢ï¼Œåœ¨æ¨¡å—ä¸­ä½¿ç”¨ import-only ä¼šå»ºç«‹ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨åŸŸï¼Œå…¶ä¸­å”¯ä¸€å¯è§çš„æ˜¯è¢«å¯¼å…¥æ¨¡å—æ‰€å¯¼å‡ºçš„æ ‡è¯†ç¬¦ï¼Œä¸‹é¢çš„ä»£ç ä¸­åªæœ‰yå¯è§ã€‚ å¯¹äºé™æ€éªŒè¯ï¼Œæœ‰æ—¶ä¸å¸Œæœ›ä½¿ç”¨ä»»ä½•æ ‡è¯†ç¬¦ï¼Œé™¤äº†æ˜ç¡®å¯¼å…¥æ¨¡å—æˆ–æœ¬åœ°èŒƒå›´çš„æ ‡è¯†ç¬¦å¤–ï¼Œè¿™æœ‰æ—¶æ˜¯åˆä¹éœ€è¦çš„ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import-only m) x) ; =\u0026gt; Error: x is not visible é™¤éé€šè¿‡â€œimport-onlyâ€å¯¼å…¥çš„æ¨¡å—å¯¼å‡ºâ€œimportâ€æˆ–â€œimport-onlyâ€ä»¥åŠè‡³å°‘ä¸€ä¸ªæ¨¡å—çš„åç§°ï¼Œå¦åˆ™æ— æ³•åœ¨â€œimport-onlyâ€èŒƒå›´å†…è¿›è¡Œåç»­å¯¼å…¥ã€‚ è¦åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—å¯¼å‡ºçš„éš”ç¦»èŒƒå›´è€Œåˆä¸ä½¿â€œimportâ€æˆ–â€œimport-onlyâ€å¯è§ï¼Œå¿…é¡»ä»¥ç›¸åŒçš„â€œimport-onlyâ€å½¢å¼åˆ—å‡ºæ‰€æœ‰è¦å¯¼å…¥çš„æ¨¡å—ã€‚\nå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«æ¯ä¸ªå…¶ä»–æ¨¡å—çš„å¯¼å‡ºçš„æ¨¡å—ã€‚\n(module m2 (y) (define y \u0026#39;y)) (module m1 (x) (define x \u0026#39;x)) (module mega-module (cons x y) (import m1) (import m2) (import scheme)) (let ([y 3]) (import-only mega-module) (cons x y)) ; =\u0026gt; (x . y) åœ¨å®ƒè¢«ç¼–è¯‘ä¹‹å‰ï¼Œæºç¨‹åºè¢«ç¿»è¯‘æˆä¸å«è¯­æ³•æŠ½è±¡ã€è¯­æ³•å®šä¹‰ã€åº“å®šä¹‰ã€æ¨¡å—å®šä¹‰ä»¥åŠ import å½¢å¼çš„æ ¸å¿ƒè¯­è¨€ç¨‹åºã€‚ç¿»è¯‘ç”±è¯­æ³•å±•å¼€å™¨è´Ÿè´£ï¼Œè¯­æ³•å±•å¼€å™¨ä»¥é€’å½’ä¸‹é™çš„æ–¹å¼å¤„ç†æºç¨‹åºä¸­çš„å½¢å¼ã€‚\nmodule å’Œ import ç‰¹æ®Šå½¢å¼ä»…å½±å“æ ‡è¯†ç¬¦(identifier)åœ¨æºç¨‹åºä¸­çš„å¯è§æ€§ï¼Œè€Œä¸å½±å“å…¶å«ä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œæ— è®ºå˜é‡è¢«ç»‘å®šåˆ°åœ¨æ¨¡å—å†…éƒ¨æˆ–å¤–éƒ¨å®šä¹‰çš„ä½ç½®ï¼Œimport éƒ½ä¸ä¼šå¼•å…¥æ–°ä½ç½®ã€‚ä¸ºäº†ä¿æŒç”±æ¨¡å—å’Œè¯­æ³•æŠ½è±¡å»ºç«‹çš„ä½œç”¨åŸŸå…³ç³»ï¼Œå±€éƒ¨å˜é‡åœ¨å¿…è¦æ—¶ä¼šè¢«é‡å‘½åã€‚å› æ­¤ï¼Œè¡¨è¾¾å¼ï¼š\n(let ([x 1]) (module m (x setter) (define-syntax x (identifier-syntax z)) (define setter (lambda (x) (set! z x))) (define z 5)) (let ([y x] [z 0]) (import m) (setter 3) (+ x y z))) ; =\u0026gt; 4 ç­‰ä»·äºä¸‹é¢çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­æ ‡è¯†ç¬¦è¢«ç»Ÿä¸€åœ°æ›´åï¼Œå¹¶å¸¦ä¸Šäº†ä¸‹æ ‡ï¼š\n(let ([x0 1]) (define-syntax x1 (identifier-syntax z1)) (define setter1 (lambda (x2) (set! z1 x2))) (define z1 5) (let ([y3 x0] [z3 0]) (setter1 3) (+ x1 y3 z3))) äº’é€’å½’module (module (a b) (module a (x) (define x (lambda () y))) (module b (y) (define y (lambda () x))) (import a) (import b)) æ­¤æ¨¡å¼çš„ä¸€èˆ¬åŒ–è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…è®¸å®šä¹‰å¤šä¸ªäº’é€’å½’çš„æ¨¡å—\n(define-syntax rec-modules (syntax-rules (module) [(_ (module m (id ...) form ...) ...) (module (m ...) (module m (id ...) form ...) ... (import m) ...)])) ç»„åˆmodule ç”±äºæ¨¡å—å¯ä»¥é‡æ–°å¯¼å‡ºæ‰€å¯¼å…¥çš„ç»‘å®šï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åœ¨å•ä¸ªæ¨¡å—ä¸Šæä¾›å¤šä¸ªè§†å›¾ï¼Œå°±åƒä¸‹é¢çš„ s å’Œ t ä¸º r æä¾›çš„è§†å›¾é‚£æ ·ï¼Œæˆ–è€…å°†å‡ ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªå¤åˆï¼Œå°±åƒ r é‚£æ ·ã€‚\n(module p (x y) (define x 1) (define y 2)) (module q (y z) (define y 3) (define z 4)) (module r (a b c d) (import* p (a x) (b y)) (import* q (c y) (d z))) (module s (a c) (import r)) (module t (b d) (import r)) import* ç¨å¾®è§£é‡Šä¸€ä¸‹import*, å…¶è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š\n(define-syntax import* (syntax-rules () [(_ m) (begin)] [(_ m (new old)) (module (new) (module (tmp) (import m) (alias tmp old)) (alias new tmp))] [(_ m id) (module (id) (import m))] [(_ m spec0 spec1 ...) (begin (import* m spec0) (import* m spec1 ...))])) å®ƒæ”¯æŒé‡å‘½åimportçš„ç»‘å®šå’Œé€‰æ‹©æ€§å¯¼å…¥ç‰¹å®šçš„ç»‘å®šï¼Œæ— éœ€ä½¿ç”¨å†…ç½®çš„importå­å½¢å¼æ¥é€‰æ‹©å’Œé‡å‘½åæ ‡è¯†ç¬¦ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š\n(let () (import* scheme (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) (let () (import* (rnrs) (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) å…ƒå®šä¹‰Meta Definitions è¯­æ³•ï¼š(meta . definition)\nmeta å…³é”®å­—å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥æ”¾åœ¨ä»»ä½•å®šä¹‰å…³é”®å­—å‰é¢çš„å‰ç¼€ï¼Œä¾‹å¦‚ï¼Œ\n(meta define x 3)\nå®ƒå‘Šè¯‰å±•å¼€å™¨ï¼Œè¯¥å®šä¹‰å¼äº§ç”Ÿçš„ä»»ä½•å˜é‡å®šä¹‰éƒ½åªæ˜¯å±•å¼€æœŸå®šä¹‰ï¼Œåªèƒ½ç”¨äºå…¶ä»–å…ƒå®šä¹‰çš„å³ä¾§ï¼Œæœ€ä¸»è¦æ˜¯ç”¨åœ¨è½¬æ¢å™¨è¡¨è¾¾å¼ä¸­ã€‚å®ƒç”¨äºå®šä¹‰å±•å¼€æœŸè¾…åŠ©å‡½æ•°ï¼Œä»¥åŠä¾›ä¸€ä¸ªæˆ–å¤šä¸ª syntax-case è½¬æ¢å™¨æ‰€ä½¿ç”¨çš„å…¶ä»–ä¿¡æ¯ã€‚\nå…ƒå®šä¹‰çš„è¯­ä¹‰ç±»ä¼¼äºlet*ï¼Œå®ƒå¯ä»¥æ˜¯è‡ªé€’å½’ï¼Œä½†ä¸æ˜¯äº’é€’å½’çš„ã€‚\nå…ƒå®šä¹‰é€šè¿‡å®å±•å¼€ä¼ æ’­ï¼Œå› æ­¤å¯ä»¥ç¼–å†™ï¼Œä¾‹å¦‚ï¼š\n(module (a) (meta define-record foo (x)) (define-syntax a (let ([q (make-foo #\u0026#39;\u0026#39;q)]) (lambda (x) (foo-x q))))) a ï¼›=\u0026gt; q æ¡ä»¶å±•å¼€Conditional expansion å¯ä»¥é€šè¿‡ meta-cond åœ¨å±•å¼€æœŸåšå‡ºå†³ç­–ï¼Œè¿™ç±»ä¼¼äº condï¼Œä½†æ˜¯æ˜¯åœ¨å±•å¼€æœŸæ±‚å€¼å¹¶æµ‹è¯•è¡¨è¾¾å¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é¢„æœŸä¸ºå®šä¹‰çš„ä¸Šä¸‹æ–‡ä¸­ä»¥åŠåœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚\nè¯­æ³•ï¼š(meta-cond clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ª clauseï¼Œå…¶ä½™çš„å¿…é¡»é‡‡å–ä»¥ä¸‹å½¢å¼ï¼š\n(test expr1 expr2 \u0026hellip;)\næœ€åä¸€ä¸ª cluase é™¤å¯é‡‡å–ä¸Šè¿°å½¢å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ else å­å¥å½¢å¼ï¼š\n(else expr1 expr2 \u0026hellip;)\nåœ¨å±•å¼€æœŸé—´ï¼Œtest è¡¨è¾¾å¼ä¼šè¢«é¡ºåºåœ°æ±‚å€¼ï¼Œç›´åˆ°æŸæ¡è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸæˆ–è€…æ±‚å€¼å®Œæ‰€æœ‰çš„è¡¨è¾¾å¼ä¸ºæ­¢ã€‚å¦‚æœä¸€æ¡ test è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºåŒ…å«ç›¸åº”è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦‚æœæ²¡æœ‰æ±‚å€¼ä¸ºçœŸçš„ test è¡¨è¾¾å¼ï¼Œä¸”å­˜åœ¨ else å­å¥ï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºç”±æ¥è‡ªäº else å­å¥çš„è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦åˆ™ï¼Œmeta-cond è¡¨è¾¾å¼å±•å¼€ä¸ºå¯¹ void è¿‡ç¨‹çš„è°ƒç”¨ã€‚\nmeta-cond å¯ä»¥æŒ‰å¦‚ä¸‹å®šä¹‰ï¼š\n(define-syntax meta-cond (syntax-rules () [(_ [a0 a1 a2 ...] [b0 b1 b2 ...] ...) (let-syntax ([expr (cond [a0 (identifier-syntax (begin a1 a2 ...))] [b0 (identifier-syntax (begin b1 b2 ...))] ...)]) expr)])) meta-cond ç”¨äºåœ¨å±•å¼€æœŸä»ä¸€ç»„å¯èƒ½çš„å½¢å¼ä¸­è¿›è¡Œé€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥å®šä¹‰è¿‡ç¨‹çš„å®‰å…¨ï¼ˆè¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰å’Œä¸å®‰å…¨ï¼ˆä¸è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰ç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®ç¼–è¯‘æœŸä¼˜åŒ–çº§åˆ«å†³å®šè°ƒç”¨ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:\n(meta-cond [(= (optimize-level) 3) (unsafe-frob x)] [else (safe-frob x)]) åˆ«åAliases è¯­æ³•ï¼š(alias id1 id2)\nalias æ˜¯ä¸€ç±»å®šä¹‰ï¼Œå¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ã€‚å®ƒç”¨äºå°†ç»‘å®šä»ä¸€ä¸ªæ ‡è¯†ç¬¦è½¬ç§»åˆ°å¦ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (alias y x) (set! y 4) (list x y)) ; =\u0026gt; (4 4) ç”±äºå±•å¼€æ˜¯ç”±å·¦è‡³å³è¿›è¡Œçš„ï¼Œåˆ«ååº”è¯¥å‡ºç°åœ¨å³ä¾§çš„æ ‡è¯†ç¬¦çš„å®šä¹‰ä¹‹åï¼Œä¾‹å¦‚ï¼š\n(let () (import-only (chezscheme)) (define y 3) (alias x y) x) ; =\u0026gt; 3 è€Œä¸æ˜¯ï¼š\n(let () (import-only (chezscheme)) (alias x y) (define y 3) x) ; =\u0026gt; exception: unbound identifier ","id":60,"section":"posts","summary":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥","tags":["modules"],"title":"Chez Scheme Modules","uri":"https://lvsq.net/2020/01/modules/","year":"2020"},{"content":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚\n(define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_ ((a1 v1) (a2 v2) ...) bodys ...) (let ((a1 v1)) (my-let* ((a2 v2) ...) bodys ...)) ) ) ) æ³¨æ„ï¼Œmy-let*æ˜¯å¯ä»¥é€’å½’ä½¿ç”¨çš„ï¼Œä»¥åŠ**\u0026hellip;**çš„ç”¨æ³•ã€‚\n(define-syntax my-let* (syntax-rules () ( (_ () bodys ...) (let () bodys ...) ) ( (_ ((a1 v1) ...) bodys ...) (let () (define a1 v1) ... bodys ... ) ) ) ) è¿™ä¸ªå®ç°æ–¹å¼ä¸ä¸Šé¢çš„ä¸åŒï¼Œä¸Šé¢çš„æ˜¯åµŒå¥—letï¼Œè¿™é‡Œå°†ç›´æ¥æŒ‰é¡ºåºdefineå†…éƒ¨å˜é‡ï¼Œä»£ç æ›´çŸ­ã€‚æ³¨æ„æ­¤å¤„çš„**\u0026hellip;**çš„ç”¨æ³•ã€‚\n","id":61,"section":"posts","summary":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚ (define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_","tags":["scheme"],"title":"è‡ªå®šä¹‰ Let*","uri":"https://lvsq.net/2020/01/my-let/","year":"2020"},{"content":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©å±•æœŸé—´ä¼šæš‚æ—¶æ›´æ”¹keywordçš„ç°æœ‰ç»‘å®šï¼Œè€Œä¸æ˜¯å¼•å…¥keywordçš„æ–°ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰©å±•form1 form2 \u0026hellip;çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªkeywordçš„å¯è§èŒƒå›´ï¼ˆæˆ–é¡¶çº§ï¼‰å°†ä¼šä¸´æ—¶æ›¿æ¢ä¸ºæ–°çš„ç»‘å®šå…³ç³»ã€‚\n(let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 2 ) ) ) (let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (fluid-let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 1 ) ) ) å¯¹æ¯”ä¸Šè¿°ä¸¤æ®µä»£ç ï¼Œå¯çŸ¥ï¼šä¸¤ä¸ªè¡¨è¾¾å¼åŸºæœ¬ç›¸åŒçš„ï¼Œé™¤äº†å‰è€…é‡‡ç”¨å†…éƒ¨let-synctaxè¯­æ³•ï¼Œç¬¬äºŒä¸ªé‡‡ç”¨fluid-let-syntaxè¯­æ³•ã€‚åœ¨ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œ(g 1)æ‰©å±•ä¸­çš„å‡ºç°çš„få¼•ç”¨çš„æ˜¯let-boundçš„å˜é‡fï¼Œè€Œç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œfå¼•ç”¨çš„æ˜¯ç”±fluid-let-syntaxç»‘å®šçš„f\n","id":62,"section":"posts","summary":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©","tags":["module","syntactic"],"title":"Syntactic Extension and Modules in Chez Scheme","uri":"https://lvsq.net/2020/01/syntactic-extension-and-modules/","year":"2020"},{"content":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„å¯ä»¥å…±äº«æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ–æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œåœ¨é‡‡ç”¨æ­¤ç§å‚æ•°ä¼ é€’è§„åˆ™çš„è¯­è¨€çš„è§£é‡Šå™¨ä¸­ï¼Œå¯ä»¥ç”¨ boxes å®ç° call-by-reference çš„è¯­ä¹‰ã€‚è§£é‡Šæœ‰ç‚¹ç»•ï¼ŒæŒ‰æˆ‘çš„ç†è§£boxeså°±ç›¸å½“äºGolangçš„structã€Javaä¸­çš„ç±»ï¼Œå°†ä¸€äº›çŠ¶æ€åŒ…è£…æˆä¸€ä¸ªæ•´å—ï¼Œå¤–ç•Œé€šè¿‡å¼•ç”¨è¯¥æ•´å—çš„æŒ‡é’ˆæ¥è®¿é—®å†…éƒ¨çš„å„ä¸ªçŠ¶æ€ã€‚\nBoxes çš„å­—é¢å½¢å¼å¸¦æœ‰å‰ç¼€ #\u0026amp; (å‘éŸ³ä¸º â€œhash-ampersandâ€). ä¾‹å¦‚ï¼Œ #\u0026amp;(a b c) æ˜¯ä¸€ä¸ª boxï¼Œå†…å®¹ä¸ºåˆ—è¡¨ (a b c). è¯»å–å™¨è‹¥é‡åˆ° #!r6rs ï¼Œåˆ™ä¼šåœ¨å…¶åçš„è¾“å…¥æµä¸­ç¦ç”¨ box è¯­æ³•ï¼Œé™¤éåœ¨æ›´è¿‘çš„ä½ç½®é‡åˆ° #!chezscheme.\næ‰€æœ‰ boxes é»˜è®¤æ˜¯å¯å˜çš„ï¼ŒåŒ…æ‹¬å¸¸é‡ã€‚ç¨‹åºå¯ä»¥é€šè¿‡ box-immutable åˆ›å»ºä¸å¯å˜ boxes. å°è¯•ä¿®æ”¹ä¸å¯å˜ box ä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ç”¨æ³•ï¼š\n(box? obj) å¦‚æœ obj æ˜¯ box, åˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box? \u0026#39;#\u0026amp;a) =\u0026gt; #t (box? \u0026#39;a) =\u0026gt; #f (box? (box 3)) =\u0026gt; #t (box obj) åˆ›å»ºä¸€ä¸ªç”±objç»„æˆçš„box\n(box \u0026#39;a) =\u0026gt; #\u0026amp;a (box (box \u0026#39;(a b c))) =\u0026gt; #\u0026amp;#\u0026amp;(a b c) (unbox box) è¿”å›boxçš„å†…å®¹\n(unbox #\u0026amp;a) =\u0026gt; a (unbox #\u0026amp;#\u0026amp;(a b c)) =\u0026gt; #\u0026amp;(a b c) (let ([b (box \u0026#34;hi\u0026#34;)]) (unbox b)) =\u0026gt; \u0026#34;hi\u0026#34; (set-box! box obj) box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ set-box! æŠŠ box çš„å†…å®¹è®¾ç½®ä¸º obj.\n(let ([b (box \u0026#39;x)]) (set-box! b \u0026#39;y) b) =\u0026gt; #\u0026amp;y (let ([incr! (lambda (x) (set-box! x (+ (unbox x) 1)))]) (let ([b (box 3)]) (incr! b) (unbox b))) =\u0026gt; 4 (box-cas! box old-obj new-obj) å¦‚æœ box è¢«æ”¹å˜ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f. box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ è‹¥ box å¾…æ›¿æ¢çš„å†…å®¹å’Œ old-obj ç›¸åŒ(åŸºäº eq?), åˆ™ box-cas! è‡ªåŠ¨å°† box çš„å†…å®¹æ›¿æ¢ä¸º new-obj; è‹¥ä¸ç›¸åŒï¼Œåˆ™ box ä¿æŒä¸å˜ã€‚å³CASæ“ä½œï¼ŒåŸå­çš„ã€‚\n(define b (box \u0026#39;old)) (box-cas! b \u0026#39;old \u0026#39;new) =\u0026gt; #t (unbox b) =\u0026gt; \u0026#39;new (box-cas! b \u0026#39;other \u0026#39;wrong) =\u0026gt; #f (unbox b) =\u0026gt; \u0026#39;new (mutable-box? obj) å¦‚æœ obj æ˜¯å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(immutable-box? obj) å¦‚æœ obj æ˜¯ä¸å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box-immutable obj) è¿”å›ä¸€ä¸ªå†…å®¹ä¸ºobjçš„ä¸å¯å˜çš„boxã€‚Boxes é€šå¸¸ç”¨æ¥æ”¯æŒå…±äº«çš„ï¼Œå¯å˜çš„ç»“æ„ï¼Œæ‰€ä»¥ä¸å¯å˜çš„ box ä¸€èˆ¬æ²¡ä»€ä¹ˆç”¨ã€‚\n","id":63,"section":"posts","summary":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„","tags":["scheme"],"title":"Chez Schemeä¸­Boxesä»‹ç»","uri":"https://lvsq.net/2020/01/boxes-in-chez/","year":"2020"},{"content":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x)))\n(atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦ï¼›list-headå’ŒSchemeæ ‡å‡†è¿‡ç¨‹list-tailå¯èƒ½ä¼šåŒæ—¶ä½¿ç”¨æ¥åˆ‡å‰²ä¸€ä¸ªlistï¼Œä¸åŒç‚¹åœ¨äºï¼Œlist-tailä¸ä¼šåˆ†é…å†…å­˜è€Œåªæ˜¯è¿”å›æºlistçš„ä¸€ä¸ªå­åˆ—è¡¨ï¼Œlist-headæ€»æ˜¯è¿”å›æºlistå‰nä¸ªå…ƒç´ çš„å‰¯æœ¬\n(list-head \u0026#39;(a b c) 0) â‡’ () (list-head \u0026#39;(a b c) 2) â‡’ (a b) (list-head \u0026#39;(a b c) 3) â‡’ (a b c) (list-head \u0026#39;(a b c . d) 2) â‡’ (a b) (list-head \u0026#39;(a b c . d) 3) â‡’ (a b c) (list-head \u0026#39;#1=(a . #1#) 5) â‡’ (a a a a a) last-pair(Chez) ç”¨æ³•ï¼š(last-pair list) åˆ—è¡¨ä¸èƒ½ä¸ºç©ºã€‚ last-pairè¿”å›åˆ—è¡¨çš„æœ€åä¸€å¯¹ï¼ˆpairï¼‰ï¼ˆä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼‰, listå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„åˆ—è¡¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€åä¸€å¯¹æ˜¯åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ å’Œç»ˆæ­¢å¯¹è±¡çš„ä¸€ä¸ªpairã€‚\n(last-pair \u0026#39;(a b c d)) â‡’ (d) (last-pair \u0026#39;(a b c.d)) â‡’ (c . d) list-copy(Chez) ç”¨æ³•ï¼š (list-copy list) è¿”å›ä¸€ä¸ªlistçš„å‰¯æœ¬ï¼Œequal?ï¼ˆç»“æ„å’Œå€¼ç›¸åŒï¼‰åˆ¤æ–­ä¸º#t\nlist*(Chez) ç”¨æ³•ï¼š(list* obj \u0026hellip; final-obj) è¿”å›ä¸€ä¸ªç”±obj \u0026hellip; final-obj ç»„æˆçš„list, ä¸R6RSçš„**cons***ç›¸åŒ\nmake-list(Chez) ç”¨æ³•ï¼š (make-list n) æˆ–è€… (make-list n obj) è¿”å›nä¸ªå¯¹è±¡çš„åˆ—è¡¨ã€‚næ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ å¦‚æœobjä¸æŒ‡å®šï¼Œåˆ™è¿”å›çš„listæ˜¯ä¸ç¡®å®šçš„\n(make-list 0 \u0026#39;()) =\u0026gt; () (make-list 3 0) =\u0026gt; (0 0 0) (make-list 2 \u0026#34;hi\u0026#34;) =\u0026gt; (\u0026#34;hi\u0026#34; \u0026#34;hi\u0026#34;) iota(Chez) ç”¨æ³•ï¼š(iota n) è¿”å›ä» 0ï¼ˆåŒ…å«ï¼‰åˆ° nï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨ï¼Œné¡»ä¸ºç²¾ç¡®çš„éè´Ÿæ•´æ•°\n(iota 0) =\u0026gt; () (iota 5) =\u0026gt; (0 1 2 3 4) enumerate(Chez) ç”¨æ³•ï¼š (enumerate ls) è¿”å›: ä» 0ï¼ˆåŒ…å«ï¼‰åˆ°é•¿åº¦ lsï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨\n(enumerate \u0026#39;()) =\u0026gt; () (enumerate \u0026#39;(a b c)) =\u0026gt; (0 1 2) (let ([ls \u0026#39;(a b c)]) (map cons ls (enumerate ls))) =\u0026gt; ((a . 0) (b . 1) (c . 2)) remq! | remv! | remove!(Chez) ç”¨æ³•ï¼š (remq! obj list) | (remv! obj list) | (remove! obj list) è¿”å›: åˆ—è¡¨ä¸­æ‰€æœ‰ obj éƒ½è¢«ç§»é™¤åçš„åˆ—è¡¨ è¿™äº›è¿‡ç¨‹ä¸ R6RS ä¸­çš„ remq, remv, åŠ remove è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯ remq!, remv! å’Œ remove! ä½¿ç”¨è¾“å…¥åˆ—è¡¨ä¸­çš„pairæ¥æ„æˆè¾“å‡ºåˆ—è¡¨ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„ç›¸åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(remq! \u0026#39;a \u0026#39;(a b a c a d)) â‡’ (b c d) (remv! #\\a \u0026#39;(#\\a #\\b #\\c)) =\u0026gt; (#\\b #\\c) (remove! \u0026#39;(c) \u0026#39;((a) (b) (c))) =\u0026gt; ((a) (b)) substq | substv | subst | substq! | substv! | subst!(Chez) ç”¨æ³•ï¼š (subs* new old tree) è¿”å›ï¼šåœ¨treeä¸­å°†åŒ¹é…åˆ°çš„oldå…ƒç´ å…¨éƒ¨æ›¿æ¢ä¸ºnewä¹‹åçš„tree. å¯¹äº substq å’Œ substq! ï¼Œç›¸ç­‰æ€§æµ‹è¯•æ˜¯åŸºäº eq?, substv å’Œ substv! æ˜¯åŸºäº eqv?, è€Œ subst å’Œ subst! æ˜¯åŸºäº equal? substq!, substv!, å’Œ subst! æ‰§è¡Œç ´åæ€§çš„æ›¿æ¢ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„å¯¹åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(substq \u0026#39;a \u0026#39;b \u0026#39;((b c) b a)) =\u0026gt; ((a c) a a) (substv 2 1 \u0026#39;((1 . 2) (1 . 4) . 1)) =\u0026gt; ((2 . 2) (2 . 4) . 2) (subst \u0026#39;a \u0026#39;(a . b) \u0026#39;((a . b) (c a . b) . c)) =\u0026gt; (a (c . a) . c) (let ([tr \u0026#39;((b c) b a)]) (substq! \u0026#39;a \u0026#39;b tr) tr) =\u0026gt; ((a c) a a) reverse! ç”¨æ³•ï¼š(reverse! list) è¿”å›ï¼šå°†åŸliståå‘è¾“å‡º reverse! é€šè¿‡åè½¬å…¶é“¾æ¥ç ´åæ€§åœ°åå‘æ’åºåˆ—è¡¨ã€‚ä»¥ reverse! å–ä»£ reverse å‡å°‘äº†ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”ä½¿ç”¨ reverse æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(reverse! \u0026#39;()) =\u0026gt; () (reverse! \u0026#39;(a b c)) =\u0026gt; (c b a) (let ([x \u0026#39;(a b c)]) (reverse! x) x) =\u0026gt; (a) (let ([x \u0026#39;(a b c)]) (set! x (reverse! x)) x) =\u0026gt; (c b a) append! ç”¨æ³•ï¼š(append! list \u0026hellip;) è¿”å›ï¼šå°†æ‰€æœ‰è¾“å…¥listä¸²è”èµ·æ¥çš„åˆ—è¡¨ å¦‚åŒ append, append! è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå…¶ä¸­å…ƒç´ ä¾æ¬¡ä¸ºç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬ä¸‰ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç­‰ç­‰ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ append! é‡ç”¨æ‰€æœ‰å‚æ•°ä¸­çš„ç‚¹å¯¹ä»¥æ„é€ æ–°åˆ—è¡¨ã€‚å³ï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨å‚æ•°çš„æœ€åä¸€ä¸ªcdr, å…¶åä¸€å…ƒç´ å˜ä¸ºæŒ‡å‘ä¸‹ä¸€ä¸ªåˆ—è¡¨å‚æ•°ã€‚é™¤æœ€åä¸€ä¸ªå‚æ•°å¤–ï¼Œå¦‚æœä»»ä¸€å‚æ•°ä¸ºç©ºåˆ—è¡¨ï¼Œå®ƒå®è´¨ä¸Šä¼šè¢«å¿½ç•¥ã€‚æœ€åä¸€ä¸ªå‚æ•°ï¼ˆå¹¶ä¸ä¸€å®šå¾—æ˜¯åˆ—è¡¨ï¼‰æ˜¯ä¸å˜çš„ã€‚\nç›¸æ¯”äº append, append! è¿›è¡Œæ›´å°‘çš„ç©ºé—´åˆ†é…ï¼ˆå› ä¸ºåªä¿®æ”¹æŒ‡é’ˆï¼Œå¹¶æ²¡æœ‰æ•°æ®æ‹·è´ï¼‰ï¼Œä½†å¹¶ä¸ä¸€å®šæ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(append! \u0026#39;(a b) \u0026#39;(c d)) =\u0026gt; (a b c d) (let ([x \u0026#39;(a b)]) (append! x \u0026#39;(c d)) x) =\u0026gt; (a b c d) (append \u0026#39;(1 2 (3 4)) \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) (append \u0026#39;(1 2 (3 4)) \u0026#39;() \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) ","id":64,"section":"posts","summary":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x))) (atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦","tags":["scheme"],"title":"Scheme/Chez Scheme å¯¹è±¡æ“ä½œ","uri":"https://lvsq.net/2019/12/operations-on-objects/","year":"2019"},{"content":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚\n(make-engine thunk)\né€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thunk(å½¢å®è½¬æ¢ç¨‹åº)ç»™make-engineæ¥åˆ›å»ºä¸€ä¸ªengineã€‚thunkçš„bodyæ˜¯ä¼šè¢«engineæ‰§è¡Œçš„è®¡ç®—ï¼Œengineæœ¬èº«æ˜¯å¸¦3ä¸ªå‚æ•°çš„è¿‡ç¨‹ï¼š\nticksï¼š ä¸€ä¸ªæ­£æ•´æ•°ï¼ŒæŒ‡å®šæä¾›ç»™engineçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼ˆåŸæ–‡ç”¨çš„æ˜¯fuelè¿™ä¸ªå•è¯ï¼Œæ„æ€æ˜¯ç‡ƒæ–™ï¼Œæ­£å¯¹åº”è¿™engineçš„æœ¬æ„ï¼Œååˆ†è´´åˆ‡ï¼‰çš„æ•°é‡ï¼Œengineå°†ä¼šæ‰§è¡Œåˆ°æ—¶é—´ç‰‡ç”¨å®Œæˆ–è€…è®¡ç®—å®Œæˆä¸ºæ­¢ï¼› completeï¼š ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç”¨äºæŒ‡å®šè®¡ç®—å®Œæˆåçš„æ“ä½œã€‚å®ƒçš„å‚æ•°æ˜¯å‰©ä½™çš„æ—¶é—´ç‰‡æ•°é‡å’Œè®¡ç®—äº§ç”Ÿçš„å€¼ï¼› expireï¼š ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æŒ‡å®šå¦‚æœåœ¨è®¡ç®—å®Œæˆä¹‹å‰æ—¶é—´ç‰‡ç”¨å®Œäº†è¯¥æ€ä¹ˆåŠã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªèƒ½ä»ä¸­æ–­ç‚¹ç»§ç»­è¿›è¡Œè®¡ç®—çš„æ–°å¼•æ“ã€‚ å°†å¼•æ“åº”ç”¨äºå…¶å‚æ•°æ—¶ï¼Œå®ƒå°†å¼€å¯ä¸€ä¸ªæ—¶é•¿ä¸ºticksçš„è®¡æ—¶å™¨ï¼Œå¦‚æœå¼•æ“è®¡ç®—åœ¨è®¡æ—¶å™¨æ‰§è¡Œä¹‹å‰å®Œæˆï¼Œç³»ç»Ÿå°†è°ƒç”¨completeï¼Œå¹¶å°†å‰©ä½™çš„tickså’Œè®¡ç®—äº§ç”Ÿçš„å€¼ä¼ é€’ç»™å®ƒï¼›\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœè®¡æ—¶å™¨åœ¨å¼•æ“è®¡ç®—å®Œæˆä¹‹å‰è€—å°½äº†ï¼Œåˆ™ç³»ç»Ÿä¼šä»ä¸­æ–­è®¡ç®—çš„continuationä¸­åˆ›å»ºä¸€ä¸ªæ–°å¼•æ“ï¼Œå¹¶ä½¿è¯¥å¼•æ“è¿‡æœŸã€‚completeå’Œexpireä¼šè¢«æ–°å¼•æ“ç»§ç»­ä½¿ç”¨ã€‚If, on the other hand, the timer goes off before the engine computation completes, the system creates a new engine from the continuation of the in- terrupted computation and passes this engine to expire. complete and expire are invoked in the continuation of the engine invocation.\nçœ‹çœ‹å…·ä½“çš„ä¾‹å­ï¼š\n(define eng (make-engine (lambda () 3))) (eng 10 ;; ticks (lambda (ticks value) value) ;; complete (lambda (x) x) ;; expire ) â‡’ 3 é€šå¸¸å°†åˆ—è¡¨ä½œä¸ºå®Œæ•´è¿‡ç¨‹ä¼ é€’ç»™å¼•æ“ï¼Œä½¿å¼•æ“å®Œæˆæ—¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å‰©ä½™çš„ticksï¼Œå¦ä¸€ä¸ªå…ƒç´ æ˜¯è®¡ç®—è¿”å›çš„å€¼ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚\n(define eng (make-engine (lambda () 3))) (eng 10 list (lambda (x) x)) â‡’ (9 3) åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè®¡ç®—å€¼ä¸º3ï¼Œè¿˜å‰©ä¸‹9ä¸ªæ—¶é—´ç‰‡ï¼Œå³ï¼Œéœ€è¦ä¸€å•ä½çš„æ—¶é—´ç‰‡æ¥è®¡ç®—å‡º3ã€‚\nå†çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼š å…ˆå®šä¹‰ä¸€ä¸ªè®¡ç®—è£´æ³¢é‚£åˆ‡å€¼çš„å‡½æ•°\n(define fibonacci (lambda (n) (let fib ([i n]) (cond [(= i 0) 0] [(= i 1) 1] [else (+ (fib (- i 1)) (fib (- i 2)))])))) åˆ›å»ºengine\n(define eng (make-engine (lambda () (fibonacci 10)))) (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ (21 55) æ¯æ¬¡æ—¶é—´ç‰‡ï¼ˆç‡ƒæ–™ï¼‰ç”¨å®Œæ—¶ï¼Œåˆ°æœŸç¨‹åºéƒ½ä¼šå°†engåˆ†é…ç»™æ–°å¼•æ“ã€‚æ•´ä¸ªè®¡ç®—éœ€è¦4ä¸ªblocksï¼Œæ¯ä¸ªblockåŒ…å«50ä¸ªticksã€‚æœ€å50ä¸ªç‡ƒæ–™ä¸­ï¼Œæœ‰21ä¸ªéƒ½ç”¨æ‰äº†ã€‚å› æ­¤ï¼Œä½¿ç”¨çš„ç‡ƒæ–™æ€»é‡ä¸º179ä¸ªã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ç»Ÿè®¡ä¸€ä¸‹æ¶ˆè€—çš„ticksæ•°é‡\n(define mileage (lambda (thunk) (let loop ([eng (make-engine thunk)] [total-ticks 0]) (eng 50 (lambda (ticks . values) (+ total-ticks (- 50 ticks))) (lambda (new-eng) (loop new-eng (+ total-ticks 50))))))) (mileage (lambda () (fibonacci 10))) â‡’ 179 å†çœ‹çœ‹ä¸€ä¸ªä¾‹å­â€”â€”round-robin:\n(define round-robin (lambda (engs) (if (null? engs) \u0026#39;() ((car engs) 1 ;;ticks (lambda (ticks value) (cons value (round-robin (cdr engs)))) ;;complete (lambda (eng) ;;expire (round-robin (append (cdr engs) (list eng)))))))) (round-robin (map (lambda (x) (make-engine (lambda () (fibonacci x)))) \u0026#39;(4 5 2 8 3 7 6 2))) â‡’ (1 1 2 3 5 8 13 21) è¿™æ®µä»£ç éœ€è¦è´¹äº›æ€é‡ï¼Œé¦–å…ˆmapå‡½æ•°åˆ›å»ºäº†8ä¸ªengine, ç„¶åä»£å…¥round-robinå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¾æ¬¡æ‰§è¡Œå„ä¸ªengineï¼Œä½†æ˜¯æ¯ä¸ªengineåˆ†é…çš„æ—¶é—´ç‰‡åªæœ‰1ï¼Œå¯¹äºå‚æ•°\u0026rsquo;(4 5 2 8 3 7 6 2)ï¼Œæ•°å­—è¶Šå°ï¼Œè¶Šå…ˆæ‰§è¡Œå®Œæˆï¼Œæ‰€ä»¥è¶Šæ—©æ‰§è¡Œcompleteå‡½æ•°ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯æ’å¥½é¡ºåºçš„äº†ï¼Œå¾ˆæ£’çš„ç¨‹åºï¼\n","id":65,"section":"posts","summary":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚ (make-engine thunk) é€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thun","tags":["engine","scheme"],"title":"Engine in Scheme","uri":"https://lvsq.net/2019/12/engine-in-scheme/","year":"2019"},{"content":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schemeæä¾›äº†caseè¯­æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œè¿™ä¸Javaä¸­çš„switchè¯­æ³•éå¸¸ç›¸ä¼¼ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹caseçš„è¯­æ³•ï¼š\n(case expr0 clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªclauseä¹‹å¤–ï¼Œæ¯ä¸ªå­å¥éƒ½å¿…é¡»é‡‡ç”¨ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š\n((key \u0026hellip;) expr1 expr2 \u0026hellip;) (key expr1 expr2 \u0026hellip;) æ¯ä¸€ä¸ªkeyå€¼éƒ½åº”è¯¥æ˜¯ä¸åŒçš„ï¼Œæœ€åä¸€ä¸ªå­å¥è¦ä¹ˆæ˜¯ä¸Šè¿°é‚£ç§å½¢å¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„elseå­å¥\n(else expr1 expr2 \u0026hellip;) é‚£ä¹ˆè¿”å›å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n(define p (lambda (x) (case x [(\u0026#34;abc\u0026#34; \u0026#34;def\u0026#34;) \u0026#39;one \u0026#39;1] [((a b c)) \u0026#39;two] [else #f]))) (p (string #\\d #\\e #\\f)) â‡’ 1 (p \u0026#39;(a b c)) â‡’ two (p \u0026#34;eee\u0026#34;) â‡’ #f ä¸Šé¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°pï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°x\nå¦‚æœxä¸ºå­—ç¬¦ä¸²\u0026quot;abc\u0026quot;æˆ–è€…\u0026quot;def\u0026quot;ï¼Œåˆ™è¿”å›1ï¼› å¦‚æœxä¸ºåˆ—è¡¨((a b c)ï¼Œåˆ™è¿”å›two å…¶ä»–æƒ…å†µè¿”å›#f å¯è§ï¼Œæœ‰äº†caseè¯­æ³•å¤šæ¡ä»¶åˆ¤æ–­å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šï¼Œå¹¶ä¸”ä»£ç ä¹Ÿå®¹æ˜“è¯»äº†ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç”¨condæ¥å†™ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æè¿°caseçš„è¯­æ³•è€Œæ²¡æœ‰ä½¿ç”¨cond\nå†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ï¼š\n(let ([ls \u0026#39;(ii iv)]) (case (cadr ls) [i 1] [ii 2] [iii 3] [(iiii iv) 4] [else \u0026#39;out-of-range])) â‡’ 4 record-case æ¥çœ‹çœ‹å¦ä¸€ä¸ªå¾ˆç±»ä¼¼çš„æ‰©å±•ï¼Œä¹Ÿååˆ†æœ‰ç”¨ï¼Œå®ƒå°±æ˜¯record-caseã€‚å®ƒå¯ä»¥ä»¥recordä¸ºå•ä½æ¥åšæ¡ä»¶åˆ¤æ–­å¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚\nè¯­æ³•æ ¼å¼ï¼š (record-case expr clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªå­å¥ä¹‹å¤–ï¼Œæ¯ä¸ªclauseçš„æ ¼å¼å¦‚ä¸‹ï¼š\n((key \u0026hellip;) formals body1 body2 \u0026hellip;)\næ¯ä¸€ä¸ªkeyéƒ½ä¸åº”è¯¥ç›¸åŒ, æœ€åä¸€ä¸ªclauseå¯èƒ½æ˜¯ä¸Šè¿°çš„æ ¼å¼æˆ–è€…æ˜¯ä¸€ä¸ªelseå­å¥ï¼š\n(else body1 body2 \u0026hellip;)\nexprå¿…é¡»æ˜¯ä¸€ä¸ªpairã€‚Chezä¼šæ‹¿(car expr)ä¸å„ä¸ªå­å¥ä¸­çš„keyè¿›è¡Œæ¯”è¾ƒï¼ˆç”¨eqv?ï¼‰æ¥ç¡®å®šå“ªä¸€ä¸ªclauseåŒ¹é…, ç„¶å(cdr expr)å°†ä¸formalsç»‘å®šã€‚\næ¥çœ‹æ¢ä¸€ä¸ªä¾‹å­ï¼š\n(define calc (lambda (x) (record-case x [(add) (x y) (+ x y)] [(sub) (x y) (- x y)] [(mul) (x y) (* x y)] [(div) (x y) (/ x y)] [else (assertion-violationf \u0026#39;calc \u0026#34;invalid expression ~s\u0026#34; x)]))) (calc \u0026#39;(add 3 4)) =\u0026gt; 7 (calc \u0026#39;(div 3 4)) =\u0026gt; 3/4 ","id":66,"section":"posts","summary":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schem","tags":["chez","scheme"],"title":"Chez Schemeä¸­çš„caseæ‰©å±•","uri":"https://lvsq.net/2019/12/case-in-chez-scheme/","year":"2019"},{"content":" æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´è‡³ï¼Œå…‹å°½å…¶ç”¨ï¼Œä¸Šä¸‹ä¸€ä½“ï¼Œä¿±ä¸å€¦è€Œäº‹å¯æ¯•çŸ£\nå‘¨äº‘æˆåº·ï¼Œæ±‰è¨€æ–‡æ™¯ã€‚æ— æœ‰å…­åå¹´ä¸æ°‘ä¼‘æ¯ï¼Œç´¯è—è“„ç§¯ï¼Œæ±‰æ­¦å¼€ç–†ä¹‹åŠŸä¾¿æ˜¯ç©ºæ–‡ï¼Œæ­¤åšç§¯è–„å‘è€³ï¼Œä¿—è¯­è¨€ï¼Œèƒ³è†Šæ”¶å›æ¥ï¼Œæ‰“å‡ºå»æ‰æœ‰åŠ›\næ­¦å¸ä¸€ä»£é›„ä¸»ï¼Œæ–‡æ²»æ­¦åŠŸï¼Œå¥‹é«˜ç¥–ä¹‹ä½™çƒˆï¼Œæ‰¿ä¸‰ç‹ä¹‹åœ£ç»ªï¼Œå¼€ä¸‡ä¸–ä¸æ‹”ä¹‹åŸºï¼Œå¾å›½æ–¯æ°‘ä¹‹å¹¸ï¼Œé“­è®°æ±‰é’\n","id":67,"section":"posts","summary":"æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´","tags":["éšæƒ³"],"title":"ç»§å­¦å½•","uri":"https://lvsq.net/2019/12/think/","year":"2019"},{"content":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚\nå…ˆçœ‹çœ‹è¯¥è¯­æ³•æè¿°ï¼š (fluid-let ((var expr) \u0026hellip;) body1 body2 \u0026hellip;) returns: the values of the body body1 body2 \u0026hellip; libraries: (chezscheme)\nè¯¥Bindingçš„ä½œç”¨ç±»ä¼¼å±€éƒ¨å˜é‡ï¼Œä¸set! æ¯”è¾ƒç›¸ä¼¼ã€‚ç”±fluid-letå®šä¹‰çš„å˜é‡å¿…é¡»å·²ç»‘å®šåˆ°é¡¶å±‚(top level)æˆ–è€…å°é—­çš„lambdaå†…æˆ–è€…å…¶ä»–å½¢å¼çš„ç»‘å®šï¼Œè¿™å¾ˆå…³é”®ï¼\nè¯·çœ‹ä»£ç ï¼š\n(let ([x 3]) (+ (fluid-let ([x 5]) x) x)) â‡’ 8 å…ˆå®šä¹‰å˜é‡x=3ï¼Œç„¶ååœ¨åŠ æ³•æ“ä½œå½“ä¸­ä¸´æ—¶å°†xçš„å€¼æ”¹ä¸º5ï¼Œæœ€åç»“æœä¸º8ï¼Œå¦‚æœå°†fluid-letä¸­çš„xæ¢ä¸ªåå­—ï¼Œæ¯”å¦‚yï¼Œå°†å¦‚ä½•å‘¢ï¼Ÿ ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼š\nException: variable y is not bound\nyæ²¡æœ‰ç»‘å®šï¼Œæ˜¯çš„ï¼Œyå³æ²¡æœ‰åœ¨é¡¶å±‚ä¸­è¢«å®šä¹‰ï¼Œä¹Ÿæœªåœ¨æŸä¸ªlambdaä¸­æˆ–è€…ä»»ä½•å…¶ä»–å½¢å¼ï¼Œè¿™é‡Œåªèƒ½æ˜¯x\nå†å­¦ä¹ ä¸‹ä¸¤ä¸ªä¾‹å­ï¼ŒåŠ æ·±å°è±¡ï¼š\n(let ([x \u0026#39;a]) (letrec ([f (lambda (y) (cons x y))]) (fluid-let ([x \u0026#39;b]) (f \u0026#39;c)) )) â‡’ (b . c) (let ([x \u0026#39;a]) (call/cc (lambda (k) (fluid-let ([x \u0026#39;b]) (letrec ([f (lambda (y) (k \u0026#39;*))]) (f \u0026#39;*))))) x) â‡’ a Fluid Bindingå®é™…ä¸Šæ˜¯Schemeå¯¹Dynamic Scopingçš„ä¿ç•™ï¼ŒSchemeä½¿ç”¨çš„æ˜¯Lexical Scopingï¼Œ å¯¹äºè¿™ä¸¤ç§Scopingæ›´è¯¦ç»†çš„æè¿°å¯å‚è€ƒLexical Scoping and Dynamic Scoping\n","id":68,"section":"posts","summary":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚ å…ˆçœ‹çœ‹è¯¥è¯­æ³•æ","tags":["fluid-let","Scheme"],"title":"Fluid Binding in Chez Scheme","uri":"https://lvsq.net/2019/12/fluid-binding/","year":"2019"},{"content":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚\nè¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec var expr) syntax returns: value of expr libraries: (chezscheme)\nThe syntactic form rec creates a recursive object from expr by establishing a binding of var within expr to the value of expr. In essence, it is a special case of letrec for self-recursive objects.\nThis form is useful for creating recursive objects (especially procedures) that do not depend on external variables for the recursion, which are sometimes undesirable because the exter-nal bindings can change. For example, a recursive procedure defined at top level depends on the value of the top-level variable given as its name. If the value of this variable should change, the meaning of the procedure itself would change. If the procedure is defined instead with rec, its meaning is independent of the variable to which it is bound.\nç®€è¦ç¿»è¯‘ä¸€ä¸‹ï¼š è¯­æ³•rec é€šè¿‡åœ¨exprä¸­å»ºç«‹varä¸exprçš„å€¼çš„ç»‘å®šï¼Œåˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ˜¯letrecç”¨äºè‡ªé€’å½’å¯¹è±¡çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚\nè¯­æ³•recé€šè¿‡ç»‘å®šexprä¸­åˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ï¼Œç”¨æ¥ è¿™ç§å½¢å¼å¯¹äºåˆ›å»ºä¸ä¾èµ–äºå¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’çš„é€’å½’å¯¹è±¡ï¼ˆå°¤å…¶æ˜¯è¿‡ç¨‹ï¼‰å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤–éƒ¨ç»‘å®šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥æœ‰æ—¶è¿™æ˜¯ä¸å¯å–çš„ã€‚\nçœ‹ä¸€ä¸ªä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹ï¼š ç»™å®šä¸€ä¸ªå…¨æ˜¯æ•°å­—çš„listï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°å­—nï¼Œç®—å‡º$1+2+\u0026hellip;+n$çš„å’Œï¼Œæœ€ç»ˆè¿”å›å’Œçš„list.\n(map (rec sum (lambda (x) (if (= x 0) 0 (+ x (sum (- x 1)))))) â€™(0 1 2 3 4 5)) â‡’ (0 1 3 6 10 15) å¦‚æœæ²¡æœ‰recè¯­æ³•ï¼Œç”¨letrecä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç¨æ˜¾éº»çƒ¦ï¼Œä»£ç ä¹Ÿå¤šä¸€äº›ï¼Œæ‰€ä»¥recè¿˜æ˜¯å¾ˆå¥½ç”¨çš„\næœ€åçœ‹ä¸€ä¸‹recè¯­æ³•çš„å®šä¹‰ï¼š\n(define-syntax rec (syntax-rules () [(_ x e) (letrec ((x e)) x)])) ","id":69,"section":"posts","summary":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚ è¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec","tags":["Scheme","Chez","rec"],"title":"Recursive Bindings in Chez Scheme","uri":"https://lvsq.net/2019/12/recursive-bindings/","year":"2019"},{"content":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´ï¼ŒåŠ¨æ‰‹å†™äº†ä¸€ä¸ªï¼Œç›®å‰å·²ç»åœ¨å…¬å¸å†…éƒ¨è¿è¡Œäº†å‡ å¹´ï¼Œæ•ˆæœè‰¯å¥½ï¼Œå¹¶ä¸”å·²ç»å¼€æºåœ¨Githubä¸Šï¼Œä»¥é£¨å„ä½ã€‚\nç‰¹ç‚¹ï¼š\nAPIç®€æ´\næ”¯æŒ3ç§äº‹ä»¶ï¼š\nUP DOWN JOIN åŸºäºVert.X\nå¼•å…¥ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;net.lvsq\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jgossip\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\nint gossip_port = 60001; String cluster = \u0026#34;gossip_cluster\u0026#34;; GossipSettings settings = new GossipSettings(); settings.setGossipInterval(1000); try { String myIpAddress = InetAddress.getLocalHost().getHostAddress(); List\u0026lt;SeedMember\u0026gt; seedNodes = new ArrayList\u0026lt;\u0026gt;(); SeedMember seed = new SeedMember(); seed.setCluster(cluster); seed.setIpAddress(myIpAddress); seed.setPort(60001); seedNodes.add(seed); gossipService = new GossipService(cluster, myIpAddress, gossip_port, null, seedNodes, settings, (member, state) -\u0026gt;System.out.println(\u0026#34;member:\u0026#34; + member + \u0026#34; state: \u0026#34; + state)); } catch (Exception e) { e.printStackTrace(); } gossipService.start(); è¯¦ç»†ä»‹ç»è¯·çœ‹ =\u0026gt; é¡¹ç›®åœ°å€\næ¬¢è¿å¤§å®¶forkï¼Œ å¦‚æœè§‰å¾—å¥½è¯·start ~~~\n","id":70,"section":"posts","summary":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›","tags":["jgossip","gossip"],"title":"Jgossip - gossipåè®®çš„å¼€æºå®ç°","uri":"https://lvsq.net/2019/12/jgossip/","year":"2019"},{"content":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ \nGolangçš„å®ç°ï¼š\n/** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result := \u0026amp;ListNode{} nodes := []*ListNode{} var carry = 0 for { node, c := add(l1, l2, carry) carry = c if node != nil { nodes = append(nodes, node) if l1 != nil \u0026amp;\u0026amp; l1.Next != nil { l1 = l1.Next } else { l1 = nil } if l2 != nil \u0026amp;\u0026amp; l2.Next != nil { l2 = l2.Next } else { l2 = nil } if carry \u0026gt; 0 \u0026amp;\u0026amp; (l1 == nil \u0026amp;\u0026amp; l2 == nil) { nodes = append(nodes, \u0026amp;ListNode{Val:carry}) } } else { break } } for i, n := range nodes{ if i == 0 { result = n } if i + 1 \u0026lt; len(nodes) { n.Next = nodes[i + 1] } } return result } func add (n1 *ListNode, n2 *ListNode, carry int) (*ListNode, int) { node := \u0026amp;ListNode{} if (n1 == nil \u0026amp;\u0026amp; n2 == nil) { return nil, 0 } if n1 == nil { n1 = \u0026amp;ListNode{Val : 0} } if n2 == nil { n2 = \u0026amp;ListNode{Val : 0} } sum := n1.Val + n2.Val + carry carry = 0 if sum \u0026gt; 9 { carry = 1 sum = sum - 10 } node.Val = sum return node, carry } ä¸‹é¢æä¾›Schemeç‰ˆæœ¬çš„å®ç°ã€(1 0) + (9 1 2) = (0 2 2)ã€‘ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œä¸é¢˜ç›®è¦æ±‚ç¨æœ‰ä¸åŒï¼Œè¿™é‡Œé‡‡ç”¨listï¼Œè€Œä¸æ˜¯é¢˜ç›®è¦æ±‚çš„é“¾è¡¨ï¼Œä½†å®é™…ä¸Šåº”æ˜¯ä¸€æ ·çš„ã€‚æ¯”è¾ƒä¹‹ä¸‹å¯ä»¥çœ‹å‡ºï¼Œç›¸å¯¹è€Œè¨€ï¼ŒSchemeè¯­è¨€çš„å®ç°æ›´åŠ ç®€çŸ­ä¼˜é›…ï¼Œå¾—ç›Šäºå…¶å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›\n(letrec ( [Polishing (lambda (l num) (if (eq? num 0) l (Polishing (append l \u0026#39;(0)) (- num 1))) ) ] [Align (lambda (l1 l2) (let ([len1 (length l1)] [len2 (length l2)]) (if [eq? len1 len2] [list l1 l2] [if (\u0026gt; len1 len2) (list l1 (Polishing l2 (- len1 len2))) (list (Polishing l1 (- len2 len1)) l2)])) ) ] [Add (lambda (l1 l2) (let ([ l (Align l1 l2)]) (Carry (map (lambda (x y) (+ x y)) (car l) (cadr l)) 0) ) ) ] [Carry (lambda (l c) (if (null? l) (if [eq? c 0] \u0026#39;() [cons c l]) (cons (mod ( + (car l) c ) 10) (Carry (cdr l) (quotient ( + (car l) c) 10))) ) ) ]) (Add \u0026#39;(1 0) \u0026#39;(9 1 2))) Golangç‰ˆæœ¬å’ŒSchemeç‰ˆæœ¬çš„å®ç°æ€è·¯ä¸ç›¸åŒï¼Œç®€è¦æè¿°ä¸€ä¸‹åè€…ï¼š\n(1 0) + (9 1 2), å…ˆè¿›è¡Œè¡¥ä½ï¼š (1 0 0) + (9 1 2), æŒ‰é¡ºåºç›¸åŠ ï¼Œå¾—ï¼š (10 1 2), å†è®¡ç®—è¿›ä½ï¼š (0 2 2) ","id":71,"section":"posts","summary":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ  Golangçš„å®ç°ï¼š /** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result","tags":["Scheme","leetcode"],"title":"ä¸¤æ•°ç›¸åŠ ","uri":"https://lvsq.net/2019/12/leetcode-2/","year":"2019"},{"content":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘ã€‚\né—®é¢˜æè¿° å‡è®¾æˆ‘ä»¬å·²ç»æœ‰è¶³å¤Ÿå¤šçš„1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†é’±å¸ï¼Œä»»æ„ç»™å®šé‡‘é¢æ¯”å¦‚1å…ƒï¼Œé—®æœ‰å¤šå°‘ç§ç»„åˆæ–¹å¼ï¼Ÿ æ¢è¨€ä¹‹ï¼Œ$$1x+2y+5z = 100$$ æ±‚x,y,zçš„è§£æœ‰å¤šå°‘ä¸ª\næ€è·¯ ç»„åˆæ–¹å¼çš„æ€»å’Œåº”ä¸ºï¼š\nä»»æ„æ‰£å»ä¸€ç§é’±å¸æ¯”å¦‚1åˆ†ï¼Œ1å…ƒé‡‡ç”¨2åˆ†ï¼Œ5åˆ†ä¸¤ç§é’±å¸çš„ç»„åˆæ•°ï¼Œå†åŠ ä¸Šï¼š\næ€»é¢ä¸ºï¼ˆ1å…ƒ-1åˆ†ï¼‰ï¼Œé‡‡ç”¨1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†ä¸‰ç§é’±å¸çš„ç»„åˆæ•°ï¼›\nå¾ˆæ˜æ˜¾è¿™å¯ä»¥å¾ˆå®¹æ˜“ç”¨é€’å½’å®ç°\nç¨ä½œä¸€ç‚¹è§£é‡Šï¼š\na. ä¸Šé¢ä¸¤æ­¥çš„æ„æ€æ˜¯ï¼šä¸å¸¦1åˆ†çš„ç»„åˆæ•° + å¸¦1åˆ†çš„ç»„åˆæ•° = å…¨éƒ¨çš„ç»„åˆæ•°ï¼› è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„\nb. ä¸Šè¿°ç¬¬2æ­¥ï¼Œï¼ˆ1å…ƒ-1åˆ†ï¼‰çš„æ„æ€æ˜¯ï¼šè¿™æ ·å¯ä»¥ä¿è¯ä»»æ„ä¸€ç§ç»„åˆæ–¹å¼å†åŠ 1åˆ†éƒ½ç­‰äº1å…ƒï¼Œä¿è¯è‡³å°‘æœ‰1ä¸ª1åˆ†çš„é’±å¸\n(letrec [ (A (lambda (n d) (if (= 0 (mod n d)) 1 0))) (B (lambda (n d) (cond [(not (pair? d)) 0] [(null? d) 0] [(= 0 n) 1] [(\u0026gt; 0 n) 0] [(= 1 (length d)) (A n (car d))] [else ( + (B n (cdr d)) (B (- n (car d)) d)) ] ) ) ) ] [B 100 \u0026#39;(1 2 5)] ) ","id":72,"section":"posts","summary":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘","tags":["Scheme","SICP"],"title":"é’±å¸ç»„åˆé—®é¢˜","uri":"https://lvsq.net/2019/12/count-coins/","year":"2019"},{"content":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quot;x-\u0026quot;ï¼‰è¯¥å¦‚ä½•å¼€å‘åšç´§è¦çš„ä»‹ç»ã€‚\nä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œæœ‰ä¸€ç‚¹éœ€è¦keep in mindï¼Œå³å¢åŠ æ‰©å±•çš„ä½ç½®ä¸åŒï¼Œæ‰€ç”¨çš„æ–¹æ³•ä¸åŒï¼Œæ‰€ä»¥éœ€è¦å¯¹Swaggerçš„æ ‡å‡†æœ‰æ‰€äº†è§£ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ springfoxç›®å‰åªå…è®¸ä¸‰ç§æ‰©å±•å®ç°:\nListVendorExtension:åˆ—è¡¨çš„å½¢å¼,è¯¥å¯¹è±¡æ”¯æŒæ³›å‹ï¼Œæœ€ç»ˆå½¢å¼ï¼šâ€x-fieldâ€:[{field:value}] ObjectVendorExtension:å¯¹è±¡çš„æ‰©å±•å½¢å¼,æœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯ï¼šâ€x-fieldâ€:[{field:value}] StringVendorExtension:stringç±»å‹çš„æ‰©å±•å®ç°ï¼Œæœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯â€x-fieldâ€:â€valueâ€ Swaggeræ ¹å¯¹è±¡æ‰©å±• ä»¥åœ¨infoä¸­æ·»åŠ ä¸€ä¸ªx-logoä¸ºä¾‹\n\u0026#34;info\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;swagger-bootstrap-uiï¼ï¼ï¼\u0026#34;, \u0026#34;termsOfService\u0026#34;: \u0026#34;http://www.xxx.com/\u0026#34;, \u0026#34;contact\u0026#34;: { \u0026#34;name\u0026#34;: pxxxx@domain.com\u0026#34; }, \u0026#34;x-logo\u0026#34;: { \u0026#34;url\u0026#34;: \u0026#34;http://\u0026#34;, \u0026#34;color\u0026#34;: \u0026#34;#090807\u0026#34; } }, ... åå°ä»£ç ï¼š\nObjectVendorExtension logo = new ObjectVendorExtension(\u0026#34;x-logo\u0026#34;); logo.addProperty(new StringVendorExtension(\u0026#34;url\u0026#34;, \u0026#34;https://xxx.svg\u0026#34;)); logo.addProperty(new StringVendorExtension(\u0026#34;color\u0026#34;, \u0026#34;#090807\u0026#34;)); return new ApiInfoBuilder() .title(\u0026#34;swagger-bootstrap-uiï¼ï¼\u0026#34;) .extensions(Lists.newArrayList(logo)) .description(\u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;) .termsOfServiceUrl(\u0026#34;http://www.xxx.com/\u0026#34;) .version(\u0026#34;1.0.0\u0026#34;) .build(); å†…éƒ¨å¯¹è±¡æ‰©å±• ç»™Pathæ·»åŠ ä¸€ä¸ªæ‰©å±•å±æ€§x-orderä¸ºä¾‹\n@Component @Order(Ordered.HIGHEST_PRECEDENCE+100) public class OperationPositionBulderPlugin implements OperationBuilderPlugin { @Override public void apply(OperationContext context) { context.operationBuilder().extensions(Lists.newArrayList(new StringVendorExtension(\u0026#34;x-order\u0026#34;,\u0026#34;1\u0026#34;))); } @Override public boolean supports(DocumentationType delimiter) { return true; } } è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ\n","id":73,"section":"posts","summary":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quo","tags":["swagger","vendorExtensions"],"title":"Swagger å¦‚ä½•ä½¿ç”¨vendorExtensionsè¿›è¡Œæ‰©å±•","uri":"https://lvsq.net/2019/11/swagger-vendor/","year":"2019"},{"content":" ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹ï¼Œå¦‚å¹³åŸå›å¹¿çº³å¼‚å›½å®¾å®¢ï¼›è‹ç§¦ä¸Šä¹¦äºä¸ƒå›½ï¼›è€å­éæ¸¸å¤©ä¸‹è€…çš†å¯è¯å„å›½æ–‡å­—å¹¶æ— å¤§ä¹–ã€‚ ã€Šå²ç±€ç¯‡ã€‹æ–‡é¦–ç›–äº‘â€œå¤ªå²ç±€ä¹¦â€ï¼Œäººå¤šè¯¯ä»¥å¤ªå²ç±€æ‰€ä½œï¼Œå¦‚æ­¤ä¾¿æœ›æ–‡ç”Ÿä¹‰äº†ã€‚å¤ªå²ä¹ƒå®˜èŒï¼Œç‹å›½ç»´å…ˆç”Ÿå¼•ã€Šè¯´æ–‡ã€‹è§£é‡Šï¼Œç±€å³è¯»ï¼Œè¯»å³ç±€ä¹¦ã€‚å¦å¤ªå²ç±€ä¹¦ä¹ƒå‘¨ä¸–ä¹‹æˆè¯­ï¼Œç»éäººåã€‚ è¿‘æ—¥å¾—é—»æ±‰æ–‡å¸éœ¸é™µè¢«å‘ç°ï¼Œè‡ªå…ƒä»¥é™ï¼Œè°¬ä¼ éœ¸é™µåœ¨å‡¤å‡°å˜´ï¼Œå¦‚ä»Šå¾—ä»¥ç¡®è®¤ï¼Œæ­¤æ¡ˆç»ˆäºå‹¾é”€ã€‚ã€Šæ±‰ä¹¦.æ–‡å¸çºªã€‹è½½ï¼šâ€œä¹™å·³ï¼Œè‘¬éœ¸é™µâ€ã€‚å‡¤å‡°å˜´ä¹Ÿå¥½ï¼Œæ±Ÿæ‘ä¹Ÿç½¢ï¼Œåœ¨å²ä¹¦ä¸Šåªæ˜¯ä¸€è¡Œå­—ã€‚å‘¨çŸ¥å…¬å…ƒå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå½“æ—¶æœ‰ä¸ªâ€œå«å›½â€å¹¶æœªç»Ÿä¸€ï¼Œä½†æ˜¯å²ä¹¦ä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå«å›½é™¤å¤–ã€‚â€ï¼›960å¹´ï¼Œå®‹æœç»Ÿä¸€ä¸­åŸï¼Œä½†æ˜¯ç°åœ¨çš„æ±Ÿæµ™åœ°åŒºè¿˜å­˜åœ¨ä¸€ä¸ªâ€œå´è¶Šå›½â€ï¼Œè¿‡äº†18å¹´æ‰çŒ®åœŸå…¥å®‹ï¼Œå²ä¹¦ä¹Ÿä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œ960å¹´ï¼Œå®‹æœ‰ä¸­å›½ï¼Œå´è¶Šé™¤å¤–â€ã€‚å«å›½å’Œå´è¶Šéƒ½åªæ˜¯å²ä¹¦ä¸Šçš„ä¸€è¡Œå­—ï¼Œè¿™å°±æ˜¯å†å²çš„çœ‹æ³•ã€‚1949å¹´ï¼Œå…±äº§å…šç»Ÿä¸€äº†ä¸­å›½ï¼Œå°æ¹¾å­¤æ‚¬ä¸€éš…ï¼Œå…¶å¤„å¢ƒå’Œå‰è€…æ¯”ç…§å¹¶æ— äºŒè‡´ï¼Œå°†æ¥å²ä¹¦ä¸Šçš„å°æ¹¾ä¹Ÿåªæ˜¯ä¸€è¡Œå­—ã€‚ ","id":74,"section":"posts","summary":"ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹","tags":["æ–‡å²"],"title":"å†å²ä¸èƒ½ç¢°","uri":"https://lvsq.net/2019/11/do-not-touch-history/","year":"2019"},{"content":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»åŠ¨8ä¸ªå­—ç¬¦ C-x C-f æŸ¥æ‰¾æˆ–è€…æ–°å»ºä¸€ä¸ªæ–‡ä»¶ C-x C-b åˆ—å‡ºç¼“å†²åŒºã€‚ C-x 1 å…³é—­ç¼“å†²åŒºåˆ—è¡¨ã€‚å°†éœ€è¦åˆ é™¤çš„ç¼“å†²åŒºæ ‡â€œdâ€(é€‰ä¸­ï¼ŒæŒ‰d),ç„¶åæŒ‰â€œxâ€æ‰§è¡Œåˆ é™¤æ ‡è®°çš„æ‰€æœ‰ç¼“å†²åŒº C-x b åˆ‡æ¢ç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºåå­—ï¼ŒRET C-x C-q å¼€å¯æˆ–è€…å…³é—­bufferçš„åªè¯»æ¨¡å¼ C-x k å…³é—­å½“å‰ç¼“å†²åŒº C-x C-s ä¿å­˜å½“å‰æ–‡ä»¶ C-x s ä¿å­˜æ‰€æœ‰æ–‡ä»¶ C-x h å…¨é€‰ M-w å¤åˆ¶ C-y ç²˜è´´ C-w å‰ªåˆ‡ C-s å¾€å‰æœç´¢ C-r å¾€åæœç´¢. DEL ä¹Ÿå¯ä»¥å¾€åæœç´¢ï¼Œ C-/ undo M-x calendar æ‰“å¼€æ—¥å†ã€‚æŒ‰ q é€€å‡ºã€‚ã€g d åˆ°æŒ‡å®šæ—¥æœŸã€‘ã€. åˆ°ä»Šæ—¥ï¼ˆä¸å±…ä¸­ï¼‰ã€‘ã€\u0026gt; å‰ä¸€ä¸ªæœˆã€‘ã€\u0026lt; åä¸€ä¸ªæœˆã€‘ M-x *-mode é€‰æ‹©Major mode M-x shell è¿è¡Œä¸€ä¸ªshell M-x eshell è¿è¡Œä¸€ä¸ªeshell C-a ç§»åˆ°è¡Œé¦– C-a C-kã€C-S-backspace åˆ é™¤æ•´è¡Œ C-u 5 C-S-backspaceã€M-5 C-S-backspace åˆ é™¤å5è¡Œï¼Œä¸åŠ æ•°å­—åˆ™åˆ é™¤4è¡Œï¼ˆé»˜è®¤ï¼‰ï¼Œå¦‚æœæ•°å­—ä¸ºè´Ÿæ•°ï¼Œåˆ™å¾€å‰åˆ  C-g åœæ­¢å½“å‰çš„å‘½ä»¤ C-k åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°è¡Œå°¾æ‰€æœ‰å­—ç¬¦ M-% æŸ¥æ‰¾åŠæ›¿æ¢ã€‚è¾“å…¥è¦è¢«æ›¿æ¢çš„è¯ï¼Œå›è½¦ï¼Œç„¶åè¾“å…¥è¦æ›¿æ¢çš„è¯ï¼Œå†å›è½¦ã€‚è¾“å…¥==y==æ›¿æ¢å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==n==å¿½ç•¥å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==q==ç»“æŸï¼Œ è¾“å…¥ ==!== æ›¿æ¢å‰©ä¸‹çš„å…¨éƒ¨ M-x occur RET xxx RET æ–°å¼€ä¸€ä¸ªçª—å£æ¥åˆ—å‡ºåŒ¹é…çš„è¡Œï¼Œç‚¹å‡»å°±ä¼šè·³è½¬åˆ°å¯¹åº”çš„ä½ç½®ï¼Œç¼–ç¨‹æ—¶æœ‰ç”¨ C-x C-t å½“å‰è¡Œä¸ä¸Šä¸€è¡Œæ¢ä½ç½® Org-Mode å¿«æ·é”® ç”¨é€” C-c . æ’å…¥æ—¶é—´ C-c C-e å¯¼å‡ºå…¶å®ƒæ ¼å¼ C-c C-s åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==SCHEDULED==â€å…³é”®å­—çš„æ—¶é—´æˆ³ã€‚ C-c C-d åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==DEADLINE==â€å…³é”®å­—çš„æ—¶é—´æˆ³ C-c C-t å°†å½“å‰é¡¹çš„çŠ¶æ€åœ¨ï¼ˆunmarkedï¼‰-\u0026gt;TODO-\u0026gt;DONE ä¹‹é—´å¾ªç¯åˆ‡æ¢ M-RET æ’å…¥ä¸€ä¸ªåŒçº§æ ‡é¢˜ M-LEFT/RIGHT å°†å½“å‰çš„æ ‡é¢˜æå‡/é™ä½ä¸€ä¸ªç­‰çº§ C-c C-c æ’å…¥æ ‡ç­¾tagã€‚ å…‰æ ‡åœ¨æ ‡é¢˜ä¸­ C-c C-q æ’å…¥æ ‡ç­¾tagã€‚å…‰æ ‡åœ¨ä»»æ„ä½ç½® C-c , è®¾ç½®å½“å‰æ ‡é¢˜çš„ä¼˜å…ˆçº§,â€™Aâ€˜ã€â€™Bâ€˜å’Œâ€™Câ€˜ã€‚â€™Aâ€˜æ˜¯æœ€é«˜çº§åˆ«ï¼Œå¦‚ä¸æŒ‡å®šï¼Œâ€™Bâ€˜æ˜¯é»˜è®¤çš„ C-c \\ æŸ¥æ‰¾æ ‡ç­¾tag S-Tab å±•å¼€æ‰€æœ‰æ ‡é¢˜ Tab å±•å¼€å…‰æ ‡æ‰€åœ¨æ ‡é¢˜ [==[== Link ==][== Description]==]== åˆ›å»ºé“¾æ¥ C-c C-l ç¼–è¾‘é“¾æ¥ C-c C-o æ‰“å¼€é“¾æ¥ C-c | (ç«–çº¿ï¼Œnot L) è¾“å…¥ åˆ— x è¡Œï¼Œ æ’å…¥ä¸€ä¸ªè¡¨æ ¼ [/] æˆ–è€… [%] é€šè¿‡åœ¨TODOé¡¹ç›®ä¸‹æ–°å»ºä¸€ä¸ªå¤§çº²æ ‘ï¼Œå¹¶åœ¨å­æ ‘ä¸Šæ ‡è®°å­ä»»åŠ¡æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸ºäº†èƒ½å¯¹å·²ç»å®Œæˆçš„ä»»åŠ¡æœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼Œä½ å¯ä»¥åœ¨æ ‡é¢˜çš„ä»»ä½•åœ°æ–¹æ’å…¥â€˜[/]â€™æˆ–è€…â€˜[%]â€™ã€‚å½“æ¯ä¸ªå­ä»»åŠ¡çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæˆ–è€…å½“ä½ åœ¨æ ‡è®°ä¸ŠæŒ‰ C-c C-æ—¶ï¼Œè¿™äº›æ ‡è®°çŠ¶æ€ä¹Ÿä¼šéšä¹‹æ›´æ–° \u0026lt;s Tab å¼€å¯ä¸€ä¸ªä»£ç å—ã€‚ #+begin_src c -n -t -h 7 -w 40: cä¸ºæ‰€æ·»åŠ çš„è¯­è¨€,-n æ˜¾ç¤ºè¡Œå·,-t æ¸…é™¤æ ¼å¼,-h 7 è®¾ç½®é«˜åº¦ä¸º7 -w 40è®¾ç½®å®½åº¦ä¸º40 C-c ' æ‰“å¼€ä¸€ä¸ªbuffer, è¾“å…¥ä»£ç ï¼Œå†æŒ‰ä¸€æ¬¡å¿«æ·é”®ï¼Œå°†ä»£ç å†™å…¥buffer C-c C-c è¿è¡Œæºä»£ç ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªRESULTå— å†…å®¹å…ƒæ•°æ® è¯¦æƒ…è§æ–‡å Markdown-Mode å¿«æ·é”® ç”¨é€” C-c C-c p ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-c v ç”Ÿæˆ basename.html å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-a u æ’å…¥=\u0026lt;\u0026gt;=è¿™æ ·çš„é“¾æ¥ C-c C-a f æ’å…¥è„šæ³¨é“¾æ¥ C-c C-a l æ’å…¥==è¿™æ ·çš„é“¾æ¥ Org-Mode å†…å®¹å…ƒæ•°æ® å¿«æ·é”® å†…å®¹ ç”¨é€” s #+begin_src \u0026hellip; #+end_src e #+begin_example \u0026hellip; #+end_example : å•è¡Œçš„ä¾‹å­ä»¥å†’å·å¼€å¤´ q #+begin_quote \u0026hellip; #+end_quote é€šå¸¸ç”¨äºå¼•ç”¨ï¼Œä¸é»˜è®¤æ ¼å¼ç›¸æ¯”å·¦å³éƒ½ä¼šç•™å‡ºç¼©è¿› v #+begin_verse \u0026hellip; #+end_verse é»˜è®¤å†…å®¹ä¸æ¢è¡Œï¼Œéœ€è¦ç•™å‡ºç©ºè¡Œæ‰èƒ½æ¢è¡Œ c #+begin_center \u0026hellip; #+end_center l #+begin_latex \u0026hellip; #+end_latex L #+latex: h #+begin_html \u0026hellip; #+end_html H #+html: a #+begin_ascii \u0026hellip; #+end_ascii A #+ascii: i #+index: line I #+include: line ","id":75,"section":"posts","summary":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»","tags":["emacs"],"title":"Emacs","uri":"https://lvsq.net/2019/11/emacs/","year":"2019"},{"content":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†å¾€å¾€è¯»å®Œå°±å¿˜è®°ï¼Œæˆ–è€…è®°ä½äº†å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯è½¬æ¢ä¸æˆèƒ½åŠ›ï¼Œæ‰è´¹äº†å¾ˆå¤šå¿ƒåŠ›å’Œæ—¶é—´ï¼Œæ‰€ä»¥è¯»ä¹¦æ–¹æ³•å°¤ä¸ºé‡è¦ã€‚æˆ‘è‡ªå°ä¹Ÿè¯»è¿‡ä¸€äº›ä¹¦ï¼Œä¸è¿‡ä»æ²¡æœ‰ç ”ç©¶è¿‡æ–¹æ³•è®ºï¼Œä¹Ÿå±äºä¸å¾—è¦é¢†çš„è¿™ä¸€ç±»ï¼Œæ‰€ä»¥æ½¦å€’åŠç”Ÿï¼Œé¡½æ„šä¸å ªã€‚\nå¤äººä¹‹ä¸­æœ‰å¾ˆå¤šè¯»ä¹¦å‰å®³çš„ï¼Œä¹Ÿæµä¼ ä¸‹æ¥ä¸€äº›è¯»ä¹¦ä¹‹é“ï¼Œæ¯”å¦‚äº”æŸ³ä¸æ±‚ç”šè§£ï¼Œå§é¾™è§‚å…¶å¤§ç•¥ã€‚ä¸¤ä½å…ˆè´¤éƒ½æ˜¯å–„å­¦ä¹‹å£«ï¼Œå…¶æ³•è•´å«è‡³ç†ï¼Œè‹¥æˆ‘ç­‰ä¸æ˜å°±é‡Œï¼Œå®¹æ˜“å •å…¥æ‡’æƒ°ã€‚æŸç§ç¨‹åº¦ä¸Šï¼Œäºè´¹æ›¼å­¦ä¹ æ³•æ®Šé€”åŒå½’ã€‚\nå¦å¤–éœ€è¦æŒ‡å‡ºçš„æ˜¯å­¦ä¹ åº”å½“æ˜¯ç³»ç»Ÿæ€§çš„ï¼Œç¢ç‰‡åŒ–å­¦ä¹ ä¸å¯å–ï¼Œè¿™ç§æ–¹å¼å¾—åˆ°çš„æ˜¯ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯çŸ¥è¯†ã€‚\nè´¹æ›¼å­¦ä¹ æ³•æœ‰å››ä¸ªæ ¸å¿ƒè¯ï¼šæ¦‚å¿µã€è®²æˆã€å®¡æŸ¥ã€ç®€åŒ–ã€‚\næ¦‚å¿µ æ¦‚å¿µæ˜¯æŒ‡æˆ‘ä»¬å¯¹éœ€è¦å­¦ä¹ çš„ç›®æ ‡æœ‰ç›¸å½“çš„æ¦‚å¿µï¼Œè¿™åŒ…æ‹¬æˆ‘ä»¬æ‰“ç®—å­¦ä¹ ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†å¾—åˆ°å“ªäº›çŸ¥è¯†ç­‰ç­‰ã€‚\nä¿—è¯­è¯´ï¼šå¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€åŠã€‚åœ¨å­¦ä¹ ä¹‹å‰æˆ‘ä»¬åº”å½“è°¨æ…åœ°æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®šè¦å­¦å—ï¼Ÿå¦‚æœæ˜¯è‚¯å®šçš„ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆèŠ±ä¸€ç‚¹ç‚¹æ—¶é—´åˆæ­¥äº†è§£ä¸€ä¸‹å°†è¦å­¦ä¹ çš„é¢†åŸŸçš„ä¸»è¦æ€æ½®æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›æƒå¨çš„ä¸“å®¶å’Œä¹¦ç±ï¼Ÿç„¶åå°±å¯ä»¥ä¹°ä¸€äº›ä¹¦å¹¶åˆ¶å®šåˆç†çš„è®¡åˆ’å¼€å§‹è¿™æ®µæ—…ç¨‹äº†ã€‚\nå…³äºä¹°ä¹¦ï¼Œæˆ‘çš„å»ºè®®æ˜¯å°½é‡é€‰æ‹©ç»å…¸è‘—ä½œï¼Œä¸ç”¨å¤ªå¤šï¼Œè´ªå¤šåè€Œåš¼ä¸çƒ‚ã€‚å¦å¤–ä¹Ÿè¦è€ƒè™‘å‡ºç‰ˆç¤¾ï¼Œä¸€èˆ¬å‡ºåçš„å‡ºç‰ˆç¤¾ç¼–è¾‘çš„ä¹¦è´¨é‡ä¼šæœ‰ä¿éšœï¼Œæ¯”å¦‚æ–‡å²ç±»çš„ï¼Œä¸­åä¹¦å±€ï¼Œä¸Šå¤ç­‰å¾ˆä¸é”™ã€‚\nç¿»å¼€ä¹¦æœ¬ä¹‹å‰ï¼Œéœ€æå‡ºè‡ªå·±çš„æœŸæœ›ï¼Œå³æˆ‘å¸Œæœ›æœ¬ä¹¦èƒ½æä¾›ç»™æˆ‘å…³äºæŸæŸé—®é¢˜çš„ç­”æ¡ˆï¼Œé˜…è¯»ä¸­æ—¶åˆ»å›´ç»•è¯¥é—®é¢˜è¿›è¡Œæ€è€ƒï¼Œè¿™æ ·å¯æ±²å–æƒ³è¦çš„çŸ¥è¯†ã€‚\nä¸€ä¸ªé¢†åŸŸçš„çŸ¥è¯†ç‚¹å¾€å¾€æå¤šï¼Œå› æ­¤é˜…è¯»æ—¶ä¸åº”è¢«åŠ¨åœ°å…¨ç›˜æ¥å—ï¼Œåº”ä¸»åŠ¨åŠ å·¥çŸ¥è¯†ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¼šå½’çº³ã€ç­›é€‰å’Œåˆ†æï¼Œè¿™å¯¹äºå½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æä¸ºé‡è¦ã€‚\nè®²æˆ è¿™æ˜¯è´¹æ›¼å­¦ä¹ æ³•çš„æ ¸å¿ƒã€‚é€šè¿‡å‘å…¶ä»–äººè®²æˆè‡ªå·±ä¹ å¾—çš„çŸ¥è¯†ï¼Œæ¥å·©å›ºè‡ªèº«æ‰€å­¦ï¼Œå¹¶ä¸”åˆ©ç”¨ä»–äººçš„åé¦ˆå’Œè´¨ç–‘æ¥æŸ¥ç¼ºè¡¥æ¼ï¼Œä»è€Œæ›´åŠ ç†è§£è¯¥é¢†åŸŸï¼Œè¿™æ˜¯ä¸€ç§æ­£å‘ç§¯æçš„è¿­ä»£ã€‚å½“æˆ‘ä»¬èƒ½å¤Ÿç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è§£é‡ŠæŸä¸ªé¢†åŸŸçš„çŸ¥è¯†ï¼Œå¹¶ä¸”èƒ½è®©ä¸€ä½é—¨å¤–æ±‰äº§ç”Ÿå…±é¸£ï¼Œé‚£ä¹ˆå¯ä»¥è¯´æˆ‘ä»¬å¯¹äºè¯¥é¢†åŸŸæœ‰ç›¸å½“çš„ç†è§£äº†ã€‚\nç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è®²æˆå¾ˆé‡è¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡ç‚¼çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šåŠ å…¥è‡ªå·±çš„æƒ³æ³•ï¼Œå¹¶ä¸å…¶ä»–çŸ¥è¯†äº¤å‰ææºï¼Œé€æ¸å½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚ä½“ç³»æ˜¯ç‹¬ç«‹æ€è€ƒçš„åŸºçŸ³ï¼Œå› æ­¤å¯¹ä»»ä½•äº‹éƒ½èƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œè€Œä¸æ˜¯äººäº‘äº¦äº‘ã€‚\né€šä¿—åœ°è®²ï¼Œè¿™æ˜¯ç”¨è¾“å‡ºæ¥å€’é€¼è¾“å…¥ã€‚å¦‚æœè‡ªå·±ä¸èƒ½è§£é‡Šæ¸…æ¥šï¼Œåªèƒ½è¯´æ˜è¿˜æ²¡æœ‰æŒæ¡ç²¾é«“ã€‚ä»»ä½•å¤æ‚çš„äº‹æƒ…èƒŒåéƒ½æœ‰ä¸€ä¸ªç®€å•çš„çœŸç†ã€‚\nå®¡æŸ¥ å­Ÿå­è¯´ï¼šå°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦ã€‚æ‰€ä»¥å­¦ä¹ å¿…éœ€å…·å¤‡æ€€ç–‘ç²¾ç¥ï¼Œå½“ç„¶ä¸æ˜¯ç›²ç›®çš„æ€€ç–‘ï¼Œæ€€ç–‘ä¸€åˆ‡æ˜¯ä¸€ç§æµªè´¹ã€‚å¥½å¥‡å¿ƒæ˜¯é©±ä½¿äººç±»è¿›æ­¥çš„åŸåŠ¨åŠ›ï¼Œå¹¼å„¿å¯¹ä»€ä¹ˆéƒ½å¥½å¥‡ï¼Œè¿™ä¼šä¿ƒè¿›ä»–ä»¬æˆé•¿ï¼Œå’Œè®¤è¯†ä¸–ç•Œã€‚æˆäººä¸¢æ‰äº†ç«¥çœŸï¼ŒæŸäº›æ–¹é¢çœ‹æ˜¯ä¸€ç§æŸå¤±ã€‚å²å®¶è’™æ–‡é€šå…ˆç”Ÿè€ƒè¯•é¥¶æœ‰è¶£å‘³ï¼Œä¸æ˜¯ä»–å‡ºé¢˜è€ƒå­¦ç”Ÿï¼Œè€Œæ˜¯ç”±å­¦ç”Ÿå‡ºé¢˜é—®ä»–ã€‚å¦‚æœå­¦ç”Ÿç§¯ç´¯ä¸å¤Ÿï¼Œå¥½å¥‡ä¸è¶³ï¼Œä¾¿æƒ³å‡ºä¸äº†å¥½é¢˜ï¼Œæ‰€ä»¥å¾€å¾€è€ƒç”Ÿä¸€å‡ºå£ï¼Œè’™å…ˆç”Ÿå°±çŸ¥é“è¯¥ç”Ÿå­¦é—®å¦‚ä½•äº†ã€‚\nç®€åŒ– äººçš„ç²¾åŠ›ç›¸å½“æœ‰é™ï¼Œå†µä¸”æˆå¹´ä¹‹åå„ç§æ‚äº‹çº·è‡³æ²“æ¥ï¼Œæ²‰ä¸‹å¿ƒå­¦ä¹ çš„æ—¶é—´å°‘ä¹‹åˆå°‘ï¼Œæ‰€ä»¥æ›´åº”å½“é›†ä¸­ç²¾ç¥ï¼Œç¼©å°èŒƒå›´ã€‚\nä¸‹é¢é™„ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œæ¾„æ¸…è„‰ç»œï¼š\n","id":76,"section":"posts","summary":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†","tags":["éšæƒ³"],"title":"è´¹æ›¼å­¦ä¹ æ³•","uri":"https://lvsq.net/2022/03/feynman_technique/","year":"2022"},{"content":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;; + `doom-font\u0026#39; ;; + `doom-variable-pitch-font\u0026#39; ;; + `doom-big-font\u0026#39; -- used for `doom-big-font-mode\u0026#39;; use this for ;; presentations or streaming. ;; ;; They all accept either a font-spec, font string (\u0026#34;Input Mono-12\u0026#34;), or xlfd ;; font string. You generally only need these two: ;;(setq doom-font (font-spec :family \u0026#34;monaco\u0026#34; :size 14 :weight \u0026#39;semi-light) ;; doom-variable-pitch-font (font-spec :family \u0026#34;sans\u0026#34; :size 13)) ;; There are two ways to load a theme. Both assume the theme is installed and ;; available. You can either set `doom-theme\u0026#39; or manually load a theme with the ;; `load-theme\u0026#39; function. This is the default: (setq doom-theme \u0026#39;doom-monokai-pro) ;; If you use `org\u0026#39; and don\u0026#39;t want your org files in the default location below, ;; change `org-directory\u0026#39;. It must be set before org loads! (setq org-directory \u0026#34;~/work/emacs-org/\u0026#34;) ;; This determines the style of line numbers in effect. If set to `nil\u0026#39;, line ;; numbers are disabled. For relative line numbers, set this to `relative\u0026#39;. (setq display-line-numbers-type t) ;; Here are some additional functions/macros that could help you configure Doom: ;; ;; - `load!\u0026#39; for loading external *.el files relative to this one ;; - `use-package!\u0026#39; for configuring packages ;; - `after!\u0026#39; for running code after a package has loaded ;; - `add-load-path!\u0026#39; for adding directories to the `load-path\u0026#39;, relative to ;; this file. Emacs searches the `load-path\u0026#39; when you load packages with ;; `require\u0026#39; or `use-package\u0026#39;. ;; - `map!\u0026#39; for binding new keys ;; ;; To get information about any of these functions/macros, move the cursor over ;; the highlighted symbol at press \u0026#39;K\u0026#39; (non-evil users must press \u0026#39;C-c c k\u0026#39;). ;; This will open documentation for it, including demos of how they are used. ;; ;; You can also try \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) to jump to their definition and see how ;; they are implemented. (custom-set-faces ;; custom-set-faces was added by Custom. ;; If you edit it by hand, you could mess it up, so be careful. ;; Your init file should contain only one such instance. ;; If there is more than one, they won\u0026#39;t work right. \u0026#39;(default ((t (:family \u0026#34;Monaco\u0026#34; :foundry \u0026#34;nil\u0026#34; :slant normal :weight normal :height 150 :width normal)))) \u0026#39;(rainbow-delimiters-depth-1-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;light green\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-2-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;goldenrod2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-3-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark magenta\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-4-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark cyan\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-5-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark blue\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-6-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;PaleVioletRed2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-7-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;SpringGreen4\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-8-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;chocolate3\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-9-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;blue\u0026#34;))))) (setq auto-save-default t) (run-with-idle-timer 5 t #\u0026#39;save-some-buffers t) (setq make-backup-files t) (setq confirm-kill-emacs nil) (set-frame-position (selected-frame) 0 0) (add-to-list \u0026#39;default-frame-alist \u0026#39;(fullscreen . maximized)) (setq initial-frame-alist \u0026#39;((top . 1) (left . 1) (width . 114) (height . 32))) ;;org-mode (setq org-superstar-headline-bullets-list \u0026#39;(\u0026#34;âœ¿\u0026#34; \u0026#34;âœ¸\u0026#34; \u0026#34;â—‰\u0026#34; \u0026#34;â–\u0026#34; \u0026#34;â—‹\u0026#34; )) ;;(setq org-todo-keywords \u0026#39;((sequence \u0026#34;TODO(t)\u0026#34; \u0026#34;STARTED(s!)\u0026#34; \u0026#34;WAITING(w@/!)\u0026#34; \u0026#34;|\u0026#34; \u0026#34;DONE(d@/!)\u0026#34; \u0026#34;CANCELLED(c@/!)\u0026#34;))) (setf org-todo-keyword-faces \u0026#39;((\u0026#34;TODO\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#95A5A6\u0026#34;))(\u0026#34;STRT\u0026#34;. (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#2E8B57\u0026#34;))(\u0026#34;DONE\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#3498DB\u0026#34;)))) (setq org-log-done \u0026#39;time) (setq org-cycle-include-plain-lists t) (setq org-export-coding-system \u0026#39;utf-8) (setq org-src-fontify-natively t) (setq org-html-doctype \u0026#34;html5\u0026#34;) (setq org-html-xml-declaration nil) (setq org-html-head \u0026#34;\u0026lt;link rel=\u0026#39;stylesheet\u0026#39; href=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css\u0026#39; integrity=\u0026#39;sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js\u0026#39; integrity=\u0026#39;sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js\u0026#39; integrity=\u0026#39;sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;) (org-babel-do-load-languages \u0026#39;org-babel-load-languages \u0026#39;((emacs-lisp . t) (c . t) (java . t) (go . t) (racket . t) (python . t) (latex . t) (shell . t) (js . t) (lisp . t) (scheme . t))) (setq-default prettify-symbols-alist \u0026#39;((\u0026#34;#+BEGIN_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+END_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+begin_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;#+end_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;\u0026gt;=\u0026#34; . \u0026#34;â‰¥\u0026#34;)(\u0026#34;=\u0026gt;\u0026#34; . \u0026#34;â‡¨\u0026#34;))) (setq prettify-symbols-unprettify-at-point \u0026#39;right-edge) (add-hook \u0026#39;org-mode-hook \u0026#39;prettify-symbols-mode) (setq org-adapt-indentation nil) : ;;auto-wrap (global-visual-line-mode 1) ;1 for on, 0 for off. ;;racket (require \u0026#39;racket-mode) (setq racket-program \u0026#34;/Applications/Racket v8.4/bin/racket\u0026#34;) (setq tab-always-indent \u0026#39;complete) ;; ä½¿ç”¨tabè‡ªåŠ¨è¡¥å…¨ (add-to-list \u0026#39;auto-mode-alist \u0026#39;(\u0026#34;\\\\.rkt\\\\\u0026#39;\u0026#34; . racket-mode)) (add-to-list \u0026#39;magic-mode-alist \u0026#39;(\u0026#34;^#lang racket\u0026#34; . :racket-mode)) ;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ;; language evniroment (set-language-environment \u0026#39;UTF-8) (set-locale-environment \u0026#34;UTF-8\u0026#34;) (define-coding-system-alias \u0026#39;UTF-8 \u0026#39;utf-8) ;; elfeed (setq elfeed-db-directory \u0026#34;~/work/emacs-org/elfeed\u0026#34;) (setq rmh-elfeed-org-files (list \u0026#34;~/work/emacs-org/elfeed/elfeed.org\u0026#34;)) (add-hook! \u0026#39;elfeed-search-mode-hook #\u0026#39;elfeed-update) ;;(add-hook \u0026#39;elfeed-new-entry-hook ;; (elfeed-make-tagger :before \u0026#34;2 weeks ago\u0026#34; ;; :remove \u0026#39;unread)) ;; lsp (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred) :custom ;; what to use when checking on-save. \u0026#34;check\u0026#34; is default, I prefer clippy (lsp-rust-analyzer-cargo-watch-command \u0026#34;clippy\u0026#34;) (lsp-eldoc-render-all t) (lsp-idle-delay 0.6) ;; enable / disable the hints as you prefer: (lsp-inlay-hint-enable t) ;; These are optional configurations. See https://emacs-lsp.github.io/lsp-mode/page/lsp-rust-analyzer/#lsp-rust-analyzer-display-chaining-hints for a full list (lsp-rust-analyzer-display-lifetime-elision-hints-enable \u0026#34;skip_trivial\u0026#34;) (lsp-rust-analyzer-display-chaining-hints t) (lsp-rust-analyzer-display-lifetime-elision-hints-use-parameter-names nil) (lsp-rust-analyzer-display-closure-return-type-hints t) (lsp-rust-analyzer-display-parameter-hints nil) (lsp-rust-analyzer-display-reborrow-hints nil) :config (add-hook \u0026#39;lsp-mode-hook \u0026#39;lsp-ui-mode)) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure :commands lsp-ui-mode :custom (lsp-ui-peek-always-show t) (lsp-ui-sideline-show-hover t) (lsp-ui-doc-enable nil)) (use-package flycheck :ensure) ;;rust ;;refer: https://robert.kra.hn/posts/rust-emacs-setup/ (use-package rustic :ensure :bind (:map rustic-mode-map (\u0026#34;M-j\u0026#34; . lsp-ui-imenu) (\u0026#34;M-?\u0026#34; . lsp-find-references) (\u0026#34;C-c C-c l\u0026#34; . flycheck-list-errors) (\u0026#34;C-c C-c a\u0026#34; . lsp-execute-code-action) (\u0026#34;C-c C-c r\u0026#34; . lsp-rename) (\u0026#34;C-c C-c q\u0026#34; . lsp-workspace-restart) (\u0026#34;C-c C-c Q\u0026#34; . lsp-workspace-shutdown) (\u0026#34;C-c C-c s\u0026#34; . lsp-rust-analyzer-status)) :config ;; uncomment for less flashiness ;; (setq lsp-eldoc-hook nil) ;; (setq lsp-enable-symbol-highlighting nil) ;; (setq lsp-signature-auto-activate nil) ;; comment to disable rustfmt on save (setq rustic-format-on-save t) (add-hook \u0026#39;rustic-mode-hook \u0026#39;rk/rustic-mode-hook)) (defun rk/rustic-mode-hook () ;; so that run C-c C-c C-r works without having to confirm, but don\u0026#39;t try to ;; save rust buffers that are not file visiting. Once ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should ;; no longer be necessary. (when buffer-file-name (setq-local buffer-save-without-query t)) (add-hook \u0026#39;before-save-hook \u0026#39;lsp-format-buffer nil t)) init.el ;;; init.el -*- lexical-binding: t; -*- ;; This file controls what Doom modules are enabled and what order they load ;; in. Remember to run \u0026#39;doom sync\u0026#39; after modifying it! ;; NOTE Press \u0026#39;SPC h d h\u0026#39; (or \u0026#39;C-h d h\u0026#39; for non-vim users) to access Doom\u0026#39;s ;; documentation. There you\u0026#39;ll find a \u0026#34;Module Index\u0026#34; link where you\u0026#39;ll find ;; a comprehensive list of Doom\u0026#39;s modules and what flags they support. ;; NOTE Move your cursor over a module\u0026#39;s name (or its flags) and press \u0026#39;K\u0026#39; (or ;; \u0026#39;C-c c k\u0026#39; for non-vim users) to view its documentation. This works on ;; flags as well (those symbols that start with a plus). ;; ;; Alternatively, press \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) on a module to browse its ;; directory (for easy access to its source code). ;;; æ·»åŠ ä¸­å›½æº ;;(setq package-archives \u0026#39;((\u0026#34;gnu\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/gnu/\u0026#34;) ;; (\u0026#34;melpa\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa/\u0026#34;) ;; (\u0026#34;melpa-stable\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa-stable/\u0026#34;) ;; (\u0026#34;org\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/org/\u0026#34;))) (doom! :input ;; chinese ;;japanese ;;layout ; auie,ctsrnm is the superior home row :completion company ; the ultimate code completion backend ;;helm ; the *other* search engine for love and life ;;ido ; the other *other* search engine... ivy ; a search engine for love and life vertico ; the search engine of the future :ui ;;deft ; notational velocity for Emacs doom ; what makes DOOM look the way it does doom-dashboard ; a nifty splash screen for Emacs doom-quit ; DOOM quit-message prompts when you quit Emacs ;;(emoji +unicode) ; ğŸ™‚ hl-todo ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW ;;hydra ;;indent-guides ; highlighted indent columns ;;ligatures ; ligatures and symbols to make your code pretty again ;;minimap ; show a map of the code on the side modeline ; snazzy, Atom-inspired modeline, plus API ;;nav-flash ; blink cursor line after big motions ;;neotree ; a project drawer, like NERDTree for vim ophints ; highlight the region an operation acts on (popup +defaults) ; tame sudden yet inevitable temporary windows ;;tabs ; a tab bar for Emacs treemacs ; a project drawer, like neotree but cooler ;;unicode ; extended unicode support for various languages vc-gutter ; vcs diff in the fringe vi-tilde-fringe ; fringe tildes to mark beyond EOB ;;window-select ; visually switch windows workspaces ; tab emulation, persistence \u0026amp; separate workspaces ;;zen ; distraction-free coding or writing :editor (evil +everywhere); come to the dark side, we have cookies file-templates ; auto-snippets for empty files fold ; (nigh) universal code folding (format +onsave) ; automated prettiness ;;god ; run Emacs commands without modifier keys ;;lispy ; vim for lisp, for people who don\u0026#39;t like vim ;;multiple-cursors ; editing in many places at once ;;objed ; text object editing for the innocent ;;parinfer ; turn lisp into python, sort of ;;rotate-text ; cycle region at point between text candidates snippets ; my elves. They type so I don\u0026#39;t have to word-wrap ; soft wrapping with language-aware indent :emacs dired ; making dired pretty [functional] electric ; smarter, keyword-based electric-indent ;;ibuffer ; interactive buffer management undo ; persistent, smarter undo for your inevitable mistakes vc ; version-control and Emacs, sitting in a tree :term eshell ; the elisp shell that works everywhere shell ; simple shell REPL for Emacs ;;term ; basic terminal emulator for Emacs vterm ; the best terminal emulation in Emacs :checkers syntax ; tasing you for every semicolon you forget ;;(spell +flyspell) ; tasing you for misspelling mispelling ;;grammar ; tasing grammar mistake every you make :tools ;;ansible ;;biblio ; Writes a PhD for you (citation needed) ;;debugger ; FIXME stepping through code, to help you add bugs ;;direnv ;;docker ;;editorconfig ; let someone else argue about tabs vs spaces ;;ein ; tame Jupyter notebooks with emacs (eval +overlay) ; run code, run (also, repls) ;;gist ; interacting with github gists lookup ; navigate your code and its documentation lsp ; M-x vscode magit ; a git porcelain for Emacs ;;make ; run make tasks from Emacs ;;pass ; password manager for nerds ;;pdf ; pdf enhancements ;;prodigy ; FIXME managing external services \u0026amp; code builders ;;rgb ; creating color strings ;;taskrunner ; taskrunner for all your projects ;;terraform ; infrastructure as code ;;tmux ; an API for interacting with tmux ;;upload ; map local to remote projects via ssh/ftp :os (:if IS-MAC macos) ; improve compatibility with macOS tty ; improve the terminal Emacs experience :lang ;;agda ; types of types of types of types... ;;beancount ; mind the GAAP ;;cc ; C \u0026gt; C++ == 1 ;;clojure ; java with a lisp ;;common-lisp ; if you\u0026#39;ve seen one lisp, you\u0026#39;ve seen them all ;;coq ; proofs-as-programs ;;crystal ; ruby at the speed of c ;;csharp ; unity, .NET, and mono shenanigans ;;data ; config/data formats ;;(dart +flutter) ; paint ui and not much else ;;dhall ;;elixir ; erlang done right ;;elm ; care for a cup of TEA? emacs-lisp ; drown in parentheses ;;erlang ; an elegant language for a more civilized age ;;ess ; emacs speaks statistics ;;factor ;;faust ; dsp, but you get to keep your soul ;;fortran ; in FORTRAN, GOD is REAL (unless declared INTEGER) ;;fsharp ; ML stands for Microsoft\u0026#39;s Language ;;fstar ; (dependent) types and (monadic) effects and Z3 ;;gdscript ; the language you waited for (go +lsp) ; the hipster dialect ;;(haskell +lsp) ; a language that\u0026#39;s lazier than I am ;;hy ; readability of scheme w/ speed of python ;;idris ; a language you can depend on json ; At least it ain\u0026#39;t XML ;;(java +meghanada) ; the poster child for carpal tunnel syndrome (java +lsp) javascript ; all(hope(abandon(ye(who(enter(here)))))) ;;julia ; a better, faster MATLAB ;;kotlin ; a better, slicker Java(Script) ;;latex ; writing papers in Emacs has never been so fun ;;lean ; for folks with too much to prove ;;ledger ; be audit you can be ;;lua ; one-based indices? one-based indices markdown ; writing docs for people to ignore ;;nim ; python + lisp at the speed of c ;;nix ; I hereby declare \u0026#34;nix geht mehr!\u0026#34; ;;ocaml ; an objective camel (org +pretty) ; organize your plain life in plain text ;;php ; perl\u0026#39;s insecure younger brother ;;plantuml ; diagrams for confusing people more ;;purescript ; javascript, but functional python ; beautiful is better than ugly ;;qt ; the \u0026#39;cutest\u0026#39; gui framework ever racket ; a DSL for DSLs ;;raku ; the artist formerly known as perl6 ;;rest ; Emacs as a REST client ;;rst ; ReST in peace ;;(ruby +rails) ; 1.step {|i| p \u0026#34;Ruby is #{i.even? ? \u0026#39;love\u0026#39; : \u0026#39;life\u0026#39;}\u0026#34;} ;;rust ; Fe2O3.unwrap().unwrap().unwrap().unwrap() ;;scala ; java, but good ;;(scheme +guile) ; a fully conniving family of lisps sh ; she sells {ba,z,fi}sh shells on the C xor ;;sml ;;solidity ; do you need a blockchain? No. ;;swift ; who asked for emoji variables? ;;terra ; Earth and Moon in alignment for performance. ;;web ; the tubes yaml ; JSON, but readable ;;zig ; C, but simpler :email ;;(mu4e +org +gmail) ;;notmuch ;;(wanderlust +gmail) :app ;;calendar ;;emms ;;everywhere ; *leave* Emacs!? You must be joking ;;irc ; how neckbeards socialize (rss +org) ; emacs as an RSS reader ;;twitter ; twitter client https://twitter.com/vnought :config ;;literate (default +bindings +smartparens)) packages.el ;; -*- no-byte-compile: t; -*- ;;; $DOOMDIR/packages.el ;; To install a package with Doom you must declare them here and run \u0026#39;doom sync\u0026#39; ;; on the command line, then restart Emacs for the changes to take effect -- or ;; use \u0026#39;M-x doom/reload\u0026#39;. ;; To install SOME-PACKAGE from MELPA, ELPA or emacsmirror: ;(package! some-package) ;; To install a package directly from a remote git repo, you must specify a ;; `:recipe\u0026#39;. You\u0026#39;ll find documentation on what `:recipe\u0026#39; accepts here: ;; https://github.com/raxod502/straight.el#the-recipe-format ;(package! another-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34;)) ;; If the package you are trying to install does not contain a PACKAGENAME.el ;; file, or is located in a subdirectory of the repo, you\u0026#39;ll need to specify ;; `:files\u0026#39; in the `:recipe\u0026#39;: ;(package! this-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34; ; :files (\u0026#34;some-file.el\u0026#34; \u0026#34;src/lisp/*.el\u0026#34;))) ;; If you\u0026#39;d like to disable a package included with Doom, you can do so here ;; with the `:disable\u0026#39; property: ;(package! builtin-package :disable t) ;; You can override the recipe of a built in package without having to specify ;; all the properties for `:recipe\u0026#39;. These will inherit the rest of its recipe ;; from Doom or MELPA/ELPA/Emacsmirror: ;(package! builtin-package :recipe (:nonrecursive t)) ;(package! builtin-package-2 :recipe (:repo \u0026#34;myfork/package\u0026#34;)) ;; Specify a `:branch\u0026#39; to install a package from a particular branch or tag. ;; This is required for some packages whose default branch isn\u0026#39;t \u0026#39;master\u0026#39; (which ;; our package manager can\u0026#39;t deal with; see raxod502/straight.el#279) ;(package! builtin-package :recipe (:branch \u0026#34;develop\u0026#34;)) ;; Use `:pin\u0026#39; to specify a particular commit to install. ;(package! builtin-package :pin \u0026#34;1a2b3c4d5e\u0026#34;) ;; Doom\u0026#39;s packages are pinned to a specific commit and updated from release to ;; release. The `unpin!\u0026#39; macro allows you to unpin single packages... ;(unpin! pinned-package) ;; ...or multiple packages ;(unpin! pinned-package another-pinned-package) ;; ...Or *all* packages (NOT RECOMMENDED; will likely break things) ;(unpin! t) (package! racket-mode) (package! spacemacs-theme) elfeed.org * root :elfeed: ** Programming :programming: *** https://www.reddit.com/r/functionalprogramming/.rss :Reddit: ** News :news: *** https://news.ycombinator.com/rss :Hack News: ","id":77,"section":"posts","summary":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;;","tags":["emacs"],"title":"æˆ‘çš„Doom Emacsé…ç½®","uri":"https://lvsq.net/2022/02/my-doom-emacs-config/","year":"2022"},{"content":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘äº†ç”¨æˆ·æŠ˜è…¾çš„æ—¶é—´ï¼Œè€Œä¸”å¯åŠ¨å¾ˆå¿«ï¼Œæä¾›è¶…è¿‡60é—¨ç¼–ç¨‹è¯­è¨€çš„å¯é€‰é¡¹ï¼Œå¯è°“ååˆ†å¼ºå¤§ã€‚\nç¬”è€…å¹³æ—¶ä¼šä½¿ç”¨Golangå¼€å‘ï¼Œæ‰€ä»¥ç¬¬ä¸€æ—¶é—´å¼€å¯äº†Golangçš„æ”¯æŒï¼Œç”±äºDoom Emacsçš„èµ„æ–™æ¯”è¾ƒå°‘ï¼Œåœ¨é…ç½®çš„è¿‡ç¨‹ä¸­èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œç»è¿‡ä¸€ç•ªæŠ˜è…¾ä¹‹åç»ˆäºæœ‰ä¸€ä¸ªå¯ç”¨çš„ç‰ˆæœ¬ï¼Œå¯èƒ½è¿˜æœ‰é—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰å‘ç°ï¼Œç°è®°å½•ä¸€ä¸‹ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚\nDoomå®‰è£…å®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ï¼š\nç¬¬ä¸€æ­¥ ä¿®æ”¹ ~/doom.d/init.el, å¯ç”¨ï¼ˆSPC f Pï¼‰æ‰¾åˆ°è¯¥æ–‡ä»¶\nåœ¨ (doom! ä¸‹é¢æ‰¾åˆ°ï¼š\n:lang (go +lsp)\n:tools (lsp)\n:editor (sinppets, evil +everywhere, format +onsave)\nï¼šcompletion (company)\n()ä¸­çš„é¡¹ç›®éƒ½æ‰“å¼€\nç¬¬äºŒæ­¥ æ‰¾åˆ°~/doom.d/config.el,æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\n;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred)) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure t :commands lsp-ui-mode) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ç¬¬ä¸‰æ­¥ å®‰è£…ä¾èµ–åŒ…ï¼š\ngo install github.com/motemen/gore/cmd/gore@latest go install github.com/stamblerre/gocode@latest go install golang.org/x/tools/cmd/godoc@latest go install golang.org/x/tools/cmd/goimports@latest go install golang.org/x/tools/cmd/gorename@latest go install golang.org/x/tools/cmd/guru@latest go install github.com/cweill/gotests/...@latest go install github.com/fatih/gomodifytags@latest # gopls for (+lsp) go install golang.org/x/tools/gopls@latest # golangci go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest è¿™æ˜¯é’ˆå¯¹Go \u0026gt;= v1.16çš„ï¼Œä½äºè¿™ä¸ªç‰ˆæœ¬çš„ç”¨go getï¼Œ æˆ‘æƒ³ç°åœ¨å¤§å®¶ç”¨çš„éƒ½æ˜¯æ–°ç‰ˆæœ¬äº†ã€‚\nç¬¬å››æ­¥ æ‰§è¡Œ~/.emacs.d/bin/doom sync æˆ–è€… (SPC h r r) ä½¿é…ç½®ç”Ÿæ•ˆ\nç¬¬äº”æ­¥ é‡å¯ä¸€ä¸‹Emacså³å¯\n","id":78,"section":"posts","summary":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘","tags":["emacs","golang"],"title":"Doom Emacs Golang ç¯å¢ƒé…ç½®","uri":"https://lvsq.net/2021/12/doom-emacs-golang-env/","year":"2021"},{"content":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œä»£ç å°±å®Œæˆäº†ã€‚\n#lang racket (require racket/cmdline) (define show-bytes (make-parameter #t)) (define show-lines (make-parameter #t)) (define show-words (make-parameter #t)) (define files (make-parameter null)) (define re-chan (make-channel)) (define cmd-line (command-line #:program \u0026#34;r-wc\u0026#34; #:once-any [(\u0026#34;-c\u0026#34; \u0026#34;--bytes\u0026#34; \u0026#34;--chars\u0026#34;) \u0026#34;The number of bytes\u0026#34; (show-bytes #t) (show-lines #f) (show-words #f)] [(\u0026#34;-l\u0026#34; \u0026#34;--lines\u0026#34;) \u0026#34;The number of lines\u0026#34; (show-lines #t) (show-bytes #f) (show-words #f)] [(\u0026#34;-w\u0026#34; \u0026#34;--words\u0026#34;) \u0026#34;The muber of words\u0026#34; (show-words #t) (show-bytes #f) (show-lines #f)] #:args file (files file))) (define (do-work) (if (null? (files)) (displayln \u0026#34;Please enter the file name\u0026#34;) (begin (for-each scan-file (files)) (let loop ([finished 0]) (unless (= finished (length (files))) (let ((re (channel-get re-chan))) (match re ((list l w b f) (displayln (append (for/list ([d (list l w b)] [t (list (show-lines) (show-words) (show-bytes) )] #:when t) d) f))))) (loop (add1 finished))))))) (define (scan-file f) (thread (lambda () (call-with-input-file f (lambda (in) (let loop ([a-line (read-line in)] [bytes 0] [lines 0] [words 0]) (if (eof-object? a-line) (channel-put re-chan (list lines words bytes f)) (let-values (((w b) (parse-line a-line))) (loop (read-line in) (+ bytes b) (add1 lines) (+ words w)))))))))) (define (parse-line a-line) (define s (open-input-string a-line)) (if (null? a-line) (values 0 0) (let loop ([w 0] [b 0] [pre-char #\\a]) (define bl b) (define c (read-char s)) (unless (eof-object? c) (set! bl (+ (char-utf-8-length c) b))) (if (eof-object? c) (values (add1 w) (add1 b)) (case c [(#\\space) (loop (if (char-whitespace? pre-char) w (add1 w)) (add1 b) c)] [else (loop w bl c)]))))) (do-work) ç„¶åç”¨racoç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº, åå­—å°±å«r-wcï¼Œå’Œwcç¨å¾®åŒºåˆ†ä¸€ä¸‹ï¼š\nraco exe -o r-wc r-wc.rkt å°±åƒä½¿ç”¨wcå‘½ä»¤ä¸€æ ·ï¼Œ\nâœ racket ./r-wc -h usage: r-wc [ \u0026lt;option\u0026gt; ... ] [\u0026lt;file\u0026gt;] ... \u0026lt;option\u0026gt; is one of / -c, --bytes, --chars | The number of bytes | -l, --lines | The number of lines | -w, --words \\ The muber of words --help, -h Show this help -- Do not treat any remaining argument as a switch (at this level) /|\\ Brackets indicate mutually exclusive options. Multiple single-letter switches can be combined after one `-`. For example, `-h-` is the same as `-h --`. ä¸Šé¢çš„ç¨‹åºæ‰§è¡Œæ•ˆç‡ä¸æ˜¯å¾ˆå¥½ï¼Œä¸»è¦è¡¨ç°åœ¨è¯»å–æ–‡ä»¶ï¼Œå’Œè§£ææ¯ä¸€è¡Œæ—¶ï¼Œå ç”¨çš„æ—¶é—´å’Œå†…å­˜å¤ªå¤§ã€‚Racketæä¾›äº†ä¸€ä¸ªç‰¹æ€§Sequences ï¼Œå®ƒå¯ä»¥ä¸for å½¢å¼ä¸€æ ·éå†æ•°æ®ç»“æœï¼Œä½†æ˜¯æ•ˆç‡å´é«˜å¾ˆå¤šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨Sequencesæ¥é‡æ„æˆ‘ä»¬çš„ç¨‹åºï¼Œå°†ä¸Šæ–‡çš„ä¸¤ä¸ªå‡½æ•°scan-file å’Œparse-line ä¿®æ”¹ä¸ºï¼š\n(define (scan-file f) (thread (lambda () (define bytes 0) (define lines 0) (define words 0) (call-with-input-file f (lambda (in) (for ([a-line (in-bytes-lines in)]) (let-values (((w b) (parse-line-seq a-line))) (set! bytes (+ bytes b)) (set! lines (add1 lines)) (set! words (+ words w)))) (channel-put re-chan (list lines words bytes f))))))) (define (parse-line a-line) (define pre-char #\\a) (define w 0) (define b 0) (if (null? a-line) (values 0 0) (for ([c (in-bytes a-line)]) (case c [(#\\space) (unless (char-whitespace? pre-char) (set! w (add1 w))) (set! b (add1 b))] [else (set! b (add1 b))]) (set! pre-char c))) (values (add1 w) (add1 b))) ä¸¤ä¸ªç‰ˆæœ¬å¯¹æ¯”ä¸€ä¸‹(æ–‡ä»¶å¤§å°100MB)ï¼š\nOld version Sequences version wc æ—¶é—´ 4.6s 0.8s 0.4s å³°å€¼å†…å­˜ 132M 115M 1M ç»è¿‡Sequencesé‡æ„ä¹‹åï¼Œæ‰§è¡Œæ—¶é—´æœ‰äº†å·¨å¤§çš„æå‡ï¼Œå¹¶ä¸”æœ€å¤§å†…å­˜ä½¿ç”¨é‡ä¹Ÿæœ‰æ‰€å‡å°‘ï¼Œä¸è¿‡ä¸wcè¿˜æ˜¯æœ‰ä¸å°‘å·®è·ã€‚å¸Œæœ›æœ‰ä¸€å¤©èƒ½å¤Ÿæ‰¾åˆ°è¶…è¶Šwcçš„æ–¹æ³•ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":79,"section":"posts","summary":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œ","tags":["racket"],"title":"ä¸åˆ°60è¡Œä»£ç ï¼Œç”¨Racketå®ç°wcå‘½ä»¤","uri":"https://lvsq.net/2021/08/racket-wc/","year":"2021"},{"content":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…çš„å­—èŠ‚æ•°ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™å¯¹äºæˆ‘ä»¬è°ƒè¯•å’Œä¼˜åŒ–ä»£ç å¾ˆæœ‰å¸®åŠ©ï¼Œä¸è¿‡Matthew Flattå¹¶æ²¡æœ‰æ‰“ç®—å°†Racketçš„timeå‡½æ•°æ·»åŠ è¿™ä¸€åŠŸèƒ½ï¼Œå°½ç®¡å¦‚æ­¤ï¼ŒMatthew Flattæä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œåªæ˜¯ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚\nChez Schemeçš„timeå‡½æ•°æ‰“å°çš„æ ¼å¼å¦‚ä¸‹ï¼š\n19 collections\n0.201254290s elapsed cpu time, including 0.183228711s collecting\n0.201678000s elapsed real time, including 0.183665000s collecting\n160012160 bytes allocated, including 113015168 bytes reclaimed\nä¸€ä¸‹æ˜¯æ”¹è¿›çš„timeå‡½æ•°ï¼Œåå­—å«time2:\n(define (time2 proc lst) (let ([mem-before (current-memory-use \u0026#39;cumulative)]) (let-values ([(r cpu-time real-time gc-time) (time-apply proc lst)]) (let ([mem-now (current-memory-use \u0026#39;cumulative)]) (values r (format \u0026#34;~ams elapsed cpu time\u0026#34; cpu-time) (format \u0026#34;~ams elapsed real time\u0026#34; real-time) (format \u0026#34;~ams elapsed gc time\u0026#34; gc-time) (format \u0026#34;~a bytes allocated\u0026#34; (- mem-now mem-before))))))) \u0026gt; (time2 make-list \u0026#39;(10000000 0)) \u0026#34;177ms elapsed cpu time\u0026#34; \u0026#34;178ms elapsed real time\u0026#34; \u0026#34;153ms elapsed gc time\u0026#34; \u0026#34;160100112 bytes allocated\u0026#34; (time2 make-bytes \u0026#39;(10000)) \u0026#34;0ms elapsed cpu time\u0026#34; \u0026#34;0ms elapsed real time\u0026#34; \u0026#34;0ms elapsed gc time\u0026#34; \u0026#34;10544 bytes allocated\u0026#34; åˆ†é…çš„å­—èŠ‚æ•°ä¸ä¼šéå¸¸ç²¾ç¡®ï¼Œæ¯”å¦‚æ²¡æœ‰è€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œä¸è¿‡åœ¨REPLä¸­å€’æ˜¯å¯ä»¥ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šæœ‰å¤ªå¤§çš„åå·®ã€‚\ncurrent-memory-useå’Œcustodian\ncurrent-memory-useå‡½æ•°çš„å‚æ•°æœ‰3ç§æ¨¡å¼ï¼š\n(current-memory-use [mode]) â†’ exact-nonnegative-integer?\nmode : (or/c #f \u0026lsquo;cumulative custodian?) = #f\nç¬¬ä¸‰ç§modeå«åš custodian? ï¼Œ è¿™æ˜¯Racketæä¾›çš„ä¸€ç§ç›‘æŠ¤æœºåˆ¶.\ncustodian å¯ä»¥ç”¨æ¥ç®¡ç†ä¸€ç»„çº¿ç¨‹ã€æ–‡ä»¶æµç«¯å£ã€TCPç«¯å£ã€TCPç›‘å¬å™¨ã€UDP socketsã€å­—èŠ‚è½¬æ¢å™¨ã€placeã€‚å½“çº¿ç¨‹æˆ–è€…ç«¯å£ç­‰ç­‰è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ç½®äº(current-custodian)çš„ç›‘æŠ¤ä¹‹ä¸‹ï¼Œé™¤äº†root custodian, æ¯ä¸€ä¸ªcustodianéƒ½å¤„äºå…¶çˆ¶çº§çš„custodiançš„ç®¡ç†ä¹‹ä¸‹ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå±‚æ¬¡ç»“æ„ã€‚\nå½“ä¸€ä¸ªcustodianè¢«( custodian-shutdown-all )å…³é—­æ—¶ï¼Œå®ƒä¼šç«‹å³ä¸”å¼ºåˆ¶ç»ˆç»“å…¶ä¸‹ç®¡ç†çš„çº¿ç¨‹ã€ç«¯å£ç­‰ç­‰ã€‚\ncustodianåœ¨å¾ˆå¤šåœºæ™¯ä¸­å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç”¨äºé‡Šæ”¾èµ„æºï¼š\n#lang racket (define done-chan (make-channel)) (define (print-hello) (define my-cust (make-custodian)) ;; å®šä¹‰ç›‘æŠ¤äºº,ä¾¿äºæ¸…ç†æ‰€æœ‰ç›¸å…³èµ„æº (parameterize ([current-custodian my-cust]) (thread (lambda () (let loop () (displayln \u0026#34;Hello\u0026#34;) (sleep 3) (loop)))) (thread (lambda () (let loop () (define item (channel-get done-chan)) (custodian-shutdown-all my-cust)))))) (print-hello) ;; (channel-put done-chan #t) è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªcustodianï¼Œ å¹¶å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ç”±è¿™ä¸ªcustodianç®¡ç†ï¼ˆ(parameterize ([current-custodian my-cust]))ï¼‰ã€‚ä¸€ä¸ªçº¿ç¨‹æ¯éš”3ç§’é’Ÿæ‰“å°ä¸€ä¸ªâ€œHelloâ€ï¼Œæ°¸ä¸åœæ­¢ã€‚å¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…done-chan æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ¶ˆæ¯ï¼Œåˆ™å…³é—­custodian, åŒæ—¶å…³é—­è¿™ä¸ªcustodianä¸‹çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±é‡Šæ”¾äº†èµ„æºã€‚\ncustodianè¿˜å¯ä»¥ç”¨æ¥é™åˆ¶å†…å­˜çš„ä½¿ç”¨é‡ï¼š\n(custodian-limit-memory (current-custodian) (* 2 1024)) (define x (make-bytes (* 4 1024))) è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šæç¤ºout of memoryï¼ˆåœ¨REPLæ— æ•ˆï¼‰ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":80,"section":"posts","summary":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…","tags":["racket"],"title":"æ”¹è¿›Racketçš„timeå‡½æ•°","uri":"https://lvsq.net/2021/07/racket-time-improvement/","year":"2021"},{"content":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š\n(thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰:\n(define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©ç”¨therad-waitæ¥ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæˆ.\n(define worker (thread (lambda () (for ([i 100]) (printf \u0026#34;Working hard... ~a~n\u0026#34; i))))) (thread-wait worker) (displayln \u0026#34;Worker finished\u0026#34;) Thread Mailboxes æ¯ä¸ªçº¿ç¨‹å…·å¤‡ä¸€ä¸ªé‚®ç®±æ¥æ¥å—æ¶ˆæ¯ï¼Œthread-sendç”¨äºå¼‚æ­¥åœ°å‘ä¸€ä¸ªçº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œthread-receiveå¯è·å–é‚®ç®±ä¸­æœ€è€çš„æ¶ˆæ¯,å¦‚æœ‰å¿…è¦çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ã€‚ è¿™å°±æ˜¯Actorå¹¶å‘æ¨¡å‹ï¼ŒErlangä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ¨¡å‹ã€‚\n(define worker-thread (thread (lambda () (let loop () (match (thread-receive) [(? number? num) (printf \u0026#34;Processing ~a~n\u0026#34; num) (loop)] [\u0026#39;done (printf \u0026#34;Done~n\u0026#34;)]))))) (for ([i 20]) (thread-send worker-thread i)) (thread-send worker-thread \u0026#39;done) (thread-wait worker-thread) Semaphores ç”¨äºåŒæ­¥ã€‚\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (semaphore-wait output-semaphore) (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i) (semaphore-post output-semaphore))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) æˆ–è€…ä½¿ç”¨call-with-semaphoreï¼Œä¸ç”¨æ˜¾å¼åœ°é‡Šæ”¾ä¿¡å·é‡\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (call-with-semaphore output-semaphore (lambda () (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i))))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) Channels é€šé“ç”¨äºçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®,Golangé‡‡å–çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚\nchannel-putç”¨æ¥å‘é€æ•°æ®åˆ°é€šé“ï¼Œchannel-getå¯ä»¥ä»é€šé“ä¸­è·å–æ•°æ®.\n(define result-channel (make-channel)) (define result-thread (thread (lambda () (let loop () (display (channel-get result-channel)) (loop))))) (define work-channel (make-channel)) (define (make-worker thread-id) (thread (lambda () (let loop () (define item (channel-get work-channel)) (case item [(DONE) (channel-put result-channel (format \u0026#34;Thread ~a done\\n\u0026#34; thread-id))] [else (channel-put result-channel (format \u0026#34;Thread ~a processed ~a\\n\u0026#34; thread-id item)) (loop)]))))) (define work-threads (map make-worker \u0026#39;(1 2))) (for ([item \u0026#39;(A B C D E F G H DONE DONE)]) (channel-put work-channel item)) (for-each thread-wait work-threads) (channel-put result-channel \u0026#34;\u0026#34;) ; waits until result-thread has printed all other output ç¼“å†²å¼‚æ­¥é€šé“Buffered Asynchronous Channels ä¸ä¸Šè¿°çš„channelç±»ä¼¼ï¼Œåªæ˜¯BACä¼šæœ‰ä¸€å®šçš„ç¼“å†²åŒºï¼Œä¸€èˆ¬ä¸ä¼šè¢«é˜»å¡ï¼Œé™¤éç¼“å†²åŒºæ»¡äº†ï¼ˆputæ“ä½œï¼‰æˆ–è€…ç©ºï¼ˆgetæ“ä½œï¼‰.\n(require racket/async-channel) (define print-thread (thread (lambda () (let loop () (displayln (thread-receive)) (loop))))) (define (safer-printf . items) (thread-send print-thread (apply format items))) (define work-channel (make-async-channel 3)) (define (make-worker-thread thread-id) (thread (lambda () (let loop () (define item (async-channel-get work-channel)) (safer-printf \u0026#34;Thread ~a processing item: ~a\u0026#34; thread-id item) (loop))))) (for-each make-worker-thread \u0026#39;(1 2 3)) (for ([item \u0026#39;(a b c d e f g h i j k l m)]) (async-channel-put work-channel item)) åŒæ­¥äº‹ä»¶å’Œsync (define main-thread (current-thread)) (define alarm (alarm-evt (+ 3000 (current-inexact-milliseconds)))) (define channel (make-channel)) (define (make-worker-thread thread-id) (thread (lambda () (define evt (sync channel alarm)) (cond [(equal? evt alarm) (thread-send main-thread \u0026#39;alarm)] [else (thread-send main-thread (format \u0026#34;Thread ~a received ~a\u0026#34; thread-id evt))])))) (make-worker-thread 1) (make-worker-thread 2) (make-worker-thread 3) (channel-put channel \u0026#39;A) (channel-put channel \u0026#39;B) (let loop () (match (thread-receive) [\u0026#39;alarm (displayln \u0026#34;Done\u0026#34;)] [result (displayln result) (loop)])) æ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":81,"section":"posts","summary":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š (thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰: (define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©","tags":["racket","thread"],"title":"Racket å¹¶å‘ä¸åŒæ­¥","uri":"https://lvsq.net/2021/07/racket-concurrency/","year":"2021"},{"content":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set!\né€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ª.rkt æ–‡ä»¶é‡Œçš„å†…å®¹å±äºæŸä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åå°±æ˜¯æ–‡ä»¶åã€‚\nåœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼šmod_demo\nâ”œâ”€â”€ mod_demo\nâ”‚ â”œâ”€â”€ ext\nâ”‚ â”‚ â””â”€â”€ cake.rkt\nâ”‚ â””â”€â”€ main.rkt\nmod_demoç›®å½•ä¸‹æœ‰ä¸€ä¸ªmain.rktæ¨¡å—ï¼Œå’Œä¸€ä¸ªextç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªcake.rktçš„æ¨¡å—ã€‚\ncake.rktçš„å†…å®¹å¦‚ä¸‹ï¼š\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (provide print-cake) æ„å‘³ç€å°†å‡½æ•°print-cakeå¯¼å‡ºï¼Œåœ¨æ¨¡å—å¤–éƒ¨å°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°äº†ï¼›è¿˜æœ‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°show, è¯¥å‡½æ•°æœªå¯¼å‡ºï¼Œæ‰€ä»¥å¤–éƒ¨æ— æ³•è®¿é—®ã€‚ main.rktçš„å†…å®¹ä¸ºï¼š\n#lang racket (require \u0026#34;ext/cake.rkt\u0026#34;) (print-cake (random 30)) (require \u0026ldquo;ext/cake.rkt\u0026rdquo;) å°†cakeæ¨¡å—å¼•å…¥ï¼Œå¼•ç”¨è·¯å¾„ç¬¦åˆUnixé£æ ¼(ä½†æ˜¯ï¼Œä¸èƒ½ä»¥æ–‡ä»¶åˆ†éš”ç¬¦å³\u0026rsquo;/\u0026lsquo;ä½œä¸ºå¼€å§‹æˆ–è€…ç»“æŸ)ï¼Œä¹Ÿæ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œ(require \u0026ldquo;./ext/cake.rkt\u0026rdquo;) ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚\nCollections collectionä¸­çš„æ¨¡å—é€šè¿‡ä¸å¸¦å¼•å·çš„ã€æ— åç¼€çš„è·¯å¾„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼šä»¥ä¸‹æ¨¡å—å¼•ç”¨äº†ä½œä¸ºâ€œracketâ€ collectionä¸€éƒ¨åˆ†çš„â€œdate.rktâ€åº“ï¼š\n#lang racket (require racket/date) (printf \u0026#34;Today is ~s\\n\u0026#34; (date-\u0026gt;string (seconds-\u0026gt;date (current-seconds)))) æ³¨æ„ï¼Œ(require racket/date)æ²¡æœ‰å¸¦åŒå¼•å·ã€‚åƒracket/dateè¿™æ ·çš„æ¨¡å—çœ‹èµ·æ¥åƒä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå½“requireçœ‹åˆ°ä¸€ä¸ªæœªåŠ å¼•å·çš„æ¨¡å—å¼•ç”¨æ—¶ï¼Œå®ƒä¼šå°†å¼•ç”¨è½¬æ¢ä¸ºåŸºäºcollectionçš„æ¨¡å—è·¯å¾„ï¼š\né¦–å…ˆï¼Œå¦‚æœæœªå¼•ç”¨çš„è·¯å¾„ä¸åŒ…å« /ï¼Œç„¶å requireä¼šè‡ªåŠ¨å‘å¼•ç”¨æ·»åŠ ä¸€ä¸ªâ€œ/mainâ€ã€‚ä¾‹å¦‚ï¼Œ( require slideshow )ç­‰æ•ˆäº( require slideshow/main )ã€‚ å…¶æ¬¡ï¼Œrequire å‘è·¯å¾„éšå¼æ·»åŠ äº†â€œ.rktâ€åç¼€ã€‚ æœ€åï¼Œrequireé€šè¿‡åœ¨å·²å®‰è£…çš„collectionä¸­æœç´¢æ¥è§£æè·¯å¾„ï¼Œè€Œä¸æ˜¯å°†è·¯å¾„è§†ä¸ºç›¸å¯¹äºå°é—­æ¨¡å—çš„è·¯å¾„ã€‚ Packages and Collections ä¸€ä¸ªpackageæ˜¯ä¸€ç»„é€šè¿‡RacketåŒ…ç®¡ç†å™¨å®‰è£…çš„åº“çš„é›†åˆã€‚Racket ç¨‹åºä¸ç›´æ¥å¼•ç”¨åŒ…ã€‚ç›¸åï¼Œç¨‹åºé€šè¿‡collectionså¼•ç”¨åº“ï¼Œå¹¶ä¸”æ·»åŠ æˆ–åˆ é™¤åŒ…ä¼šæ›´æ”¹å¯ç”¨çš„åŸºäºé›†åˆçš„åº“é›†ã€‚\næ·»åŠ Collections libraryçš„æ—¨åœ¨è·¨å¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œå› æ­¤å°†åº“çš„æºæ–‡ä»¶ä¿å­˜åœ¨ä¸€ä¸ªç›®å½•ä¸­å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œæ›´ä¸èƒ½å°†åº“å¤åˆ¶åˆ°ä¸åŒçš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯æ–°å¢ä¸€ä¸ªcollectionï¼Œå°†libæ”¾åœ¨collectionä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸å¸¦å¼•å·çš„è·¯å¾„å¼•ç”¨å®ƒï¼Œå°±åƒRacket å‘è¡Œç‰ˆä¸­åŒ…å«çš„åº“ä¸€æ ·ã€‚\nä¸ç”¨æ‹…å¿ƒï¼Œåˆ›å»ºä¸€ä¸ªåŒ…æ— éœ€æäº¤åˆ°å…¬å¼€çš„åŒ…æœåŠ¡å™¨ï¼Œå¯ä»¥å®‰è£…åˆ°æœ¬åœ°æ¥ä½¿ç”¨ã€‚\né‡‡ç”¨raco pkgå‘½ä»¤è¡Œå·¥å…·ï¼š raco pkg install \u0026ndash;link /path/to/mod_demo\nå®‰è£…ä¹‹åï¼Œåœ¨ä»»ä½•æ¨¡å—ä¸­ä½¿ç”¨(require mod_demo/ext/cake)éƒ½ä¼šä»/path/to/mod_demo/ext/cake.rktå¯¼å…¥print-cakeå«å‡½æ•°ã€‚\n\u0026gt; (require mod_demo/ext/cake) \u0026gt; (print-cake 4) ...... .-||||||-. | | ------------ \u0026gt; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å®‰è£…çš„ç›®å½•åç§°æ—¢ç”¨ä½œåŒ…åç§°åˆç”¨ä½œåŒ…æä¾›çš„collection\nå°†libæ”¾å…¥collectionä¹‹åï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨raco makeæ¥ç¼–è¯‘åº“çš„æºæ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨raco setupæ›´åŠ æ–¹ä¾¿ã€‚å°¤å…¶æ˜¯ä¿®æ”¹äº†æ¨¡å—ä»£ç åï¼Œä½¿ç”¨raco setupä¼šé‡æ–°ç¼–è¯‘æ‰€æœ‰åº“æ–‡ä»¶ï¼Œå¹¶é‡æ–°å®‰è£…åŒ…ã€‚ä¸raco makeä¸åŒçš„æ˜¯ï¼Œraco setup åé¢çš„å‚æ•°æ˜¯åŒ…åï¼Œå³raco setup mod_demo, è€Œraco makeåé¢æ˜¯æ¨¡å—åï¼Œå³raco make main.rktã€‚\næ¨¡å—è¯­æ³• æ¨¡å—æ–‡ä»¶å¼€å¤´å¤„çš„#langå…¶å®æ˜¯æ¨¡å—å½¢å¼çš„ç®€å†™ï¼Œä½†ä¸èƒ½ç”¨äºREPLã€‚\næ¨¡å—å½¢å¼ æ™®é€šå½¢å¼çš„æ¨¡å—å£°æ˜ï¼Œå¯ä»¥å·¥ä½œäºREPL\n(module name-id initial-module-path decl \u0026hellip;)\nname-idæ˜¯æ¨¡å—çš„åå­—ï¼Œinitial-module-path ä¸ºåˆå§‹åŒ–å¯¼å…¥ï¼Œæ¯ä¸ªdeclå¯ä»¥æ˜¯å¯¼å…¥ï¼Œæˆ–è€…å¯¼å‡ºï¼Œæˆ–è€…å®šä¹‰ï¼Œæˆ–è€…è¡¨è¾¾å¼ã€‚\ninitial-module-pathæ˜¯å¿…é¡»çš„ï¼Œæ¨¡å—å†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªç¯å¢ƒï¼ˆSICPä¸­çš„ç¯å¢ƒï¼Œå³ä¸Šä¸‹æ–‡ï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨çš„æŒ‡ä»¤æ˜¯éœ€è¦é€šè¿‡initial-module-pathå¼•å¯¼çš„ã€‚å¸¸ç”¨çš„initial-module-pathæ˜¯racket, require/define/provideç­‰ç­‰éƒ½æ¥è‡ªracketã€‚å¦ä¸€ä¸ªå¸¸ç”¨çš„initial-module-pathæ˜¯racket-base,å®ƒæä¾›çš„åŠŸèƒ½è¾ƒå°‘ï¼Œä½†ä»ç„¶æ˜¯å¾ˆå¸¸ç”¨ã€‚\nä¸Šä¸€èŠ‚ä¸­çš„â€œcake.rktâ€ä¹Ÿå¯ä»¥å†™æˆï¼š\n(module cake racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline))) è¿™ç§æ¨¡å—å½¢å¼æ˜¯å¯ä»¥è¢«REPLæ±‚å€¼çš„ï¼ˆæ³¨æ„(require \u0026lsquo;cake)ï¼Œ æ¨¡å—åcakeéœ€è¦è¢«quoteï¼Œå› ä¸ºè¿™æ—¶cakeæ˜¯éæ–‡ä»¶çš„æ¨¡å—å£°æ˜ï¼‰ï¼š\n\u0026gt; (require \u0026#39;cake) \u0026gt; (print-cake 3) ... .-|||-. | | --------- å£°æ˜ä¸€ä¸ªæ¨¡å—ï¼Œå…¶bodyä¸ä¼šè¢«ç«‹åˆ»æ±‚å€¼ï¼Œåªæœ‰åœ¨æ˜¾å¼åœ°è¢«requireä¹‹åæ‰ä¼šæ±‚å€¼ä¸€æ¬¡ã€‚\n\u0026gt; (module hi racket (printf \u0026#34;Hello\\n\u0026#34;)) \u0026gt; (require \u0026#39;hi) Hello \u0026gt; (require \u0026#39;hi) #lang #langå£°æ˜çš„æ¨¡å—çš„bodyæ²¡æœ‰ç‰¹å®šçš„è¯­æ³•ï¼Œå› ä¸ºå…¶è¯­æ³•ç”±#langä¹‹åçš„åç§°æ‰€å†³å®šã€‚\næ¯”å¦‚ï¼Œ#lang racketçš„è¯­æ³•æ˜¯ï¼š\n#lang racket decl ... ç­‰åŒäºï¼š\n(module name racket decl ...) nameæ˜¯åŒ…å«#langå½¢å¼çš„æ–‡ä»¶å\nå­æ¨¡å— ä¸€ä¸ªæ¨¡å—å¯ä»¥åµŒå¥—åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œçˆ¶æ¨¡å—å¯ä»¥ç›´æ¥è®¿é—®å­æ¨¡å—å¯¼å‡ºçš„å‡½æ•°ã€å®šä¹‰ã€è¡¨è¾¾å¼ã€‚\n#lang racket (module zoo racket (provide tiger) (define tiger \u0026#34;Tony\u0026#34;)) (require \u0026#39;zoo) tiger module* module*å½¢å¼ç±»ä¼¼moduleï¼š\n(module* name-id initial-module-path-or-#f decl ...) module*ä¸moduleçš„ä¸åŒä¹‹å¤„åœ¨äºï¼š\nç”±moduleå£°æ˜çš„å­æ¨¡å—ï¼Œå¯ä»¥è¢«å…¶çˆ¶æ¨¡å—require, ä½†æ˜¯å­æ¨¡å—ä¸èƒ½requireçˆ¶æ¨¡å—ï¼› ç”±module*å£°æ˜çš„å­—æ¨¡å—ï¼Œå¯ä»¥requireçˆ¶æ¨¡å—ï¼Œä½†æ˜¯çˆ¶æ¨¡å—ä¸èƒ½requireè¯¥å­æ¨¡å—ï¼› æ­¤å¤–ï¼Œmodule*å½¢å¼å¯ä»¥ç”¨#fä»£æ›¿initial-module-pathï¼Œè¿™æ„å‘³ç€ï¼Œå­æ¨¡å—å¯ä»¥è®¿é—®çˆ¶æ¨¡å—æ‰€ä»¥ç»‘å®šï¼ŒåŒ…æ‹¬æœªé€šè¿‡provideå¯¼å‡ºçš„ç»‘å®šã€‚\nå› æ­¤ï¼Œç”¨module*å’Œ#fæ¥å£°æ˜ä¸€ä¸ªæ¨¡å—çš„ä¸€ä¸ªç”¨é€”æ˜¯ï¼Œå°†æŸä¸ªæ¨¡å—æœªprovideå‡ºå»çš„ç»‘å®šå¯¼å‡ºã€‚\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* extras #f (provide show)) å°½ç®¡showå‡½æ•°æœªå¯¼å‡ºï¼Œä½†æ˜¯å­æ¨¡å—extraså´å°†å…¶å¯¼å‡ºäº†ï¼Œå¤–éƒ¨ç¨‹åºå¯ä»¥ä½¿ç”¨(require (submod \u0026ldquo;caske.rkt\u0026rdquo; extras))æ¥è®¿é—®éšè—çš„showå‡½æ•°ã€‚\nMainå’ŒTestå­æ¨¡å— #lang racket (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* main #f (print-cake 10)) è¿™ä¸ªâ€œcake.rktâ€å˜ä½“ï¼ŒåŒ…å«äº†ä¸€ä¸ªmainå­æ¨¡å—ï¼Œå¹¶è°ƒç”¨äº†print-cakeå‡½æ•°ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œè¿è¡Œä¸€ä¸ªæ¨¡å—æ—¶å¹¶ä¸ä¼šè¿è¡Œå…¶ä¸­ç”±module*å£°æ˜çš„å­æ¨¡å—ï¼Œä½†æ˜¯mainå­æ¨¡å—é™¤å¤–ã€‚\nmainå­æ¨¡å—å¹¶ä¸ä¸€å®šç”±module*å£°æ˜ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨çˆ¶æ¨¡å—çš„ç»‘å®šï¼Œä¹Ÿå¯ä»¥ç”±moduleæ¥å£°æ˜ã€‚ æ›´å¸¸è§çš„åšæ³•æ˜¯ç”±module+æ¥å£°æ˜\n``lisp (module+ name-id decl \u0026hellip;)\nmodule+å£°æ˜çš„æ¨¡å—å°±åƒé‡‡ç”¨module*å£°æ˜ä¸”ä½¿ç”¨#fä½œä¸ºinitial-module-pathçš„æ¨¡å—ã€‚æ­¤å¤–ï¼Œå¤šä¸ªmodule+æ¨¡å—å¯ä»¥åŒåï¼ŒåŒåçš„æ¨¡å—ä¼šç»„åˆæˆä¸€ä¸ªæ¨¡å—ã€‚è¿™ç§ç»„åˆç‰¹æ€§å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªtestæ¨¡å—ï¼Œåœ¨ä½¿ç”¨ raco testå‘½ä»¤æ—¶å°±å¯ä»¥å¤§æ˜¾èº«æ‰‹äº†ã€‚ å‡è®¾\u0026#34;physics.rkt\u0026#34; ä¸ºï¼š ```lisp #lang racket (module+ test (require rackunit) (define Îµ 1e-10)) (provide drop to-energy) (define (drop t) (* 1/2 9.8 t t)) (module+ test (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ)) (define (to-energy m) (* m (expt 299792458.0 2))) (module+ test (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) å¯¼å…¥\u0026quot;physics.rkt\u0026quot; æ—¶ï¼Œå¹¶ä¸ä¼šè¿è¡Œdropå’Œto-energyçš„æµ‹è¯•ï¼Œä¸è¿‡è¿è¡Œraco test physics.rktå°†ä¼šæ‰§è¡Œè¿™äº›æµ‹è¯•ã€‚\nè¿™ç­‰ä»·äºä½¿ç”¨module*:\n#lang racket (provide drop to-energy) (define (drop t) (* 1/2 49/5 t t)) (define (to-energy m) (* m (expt 299792458 2))) (module* test #f (require rackunit) (define Îµ 1e-10) (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ) (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) module+çš„ç»„åˆè¡Œä¸ºå¯¹mainæ¨¡å—ä¹Ÿæœ‰å¸®åŠ©ï¼Œå³ä½¿ä¸éœ€è¦ç»„åˆï¼Œ ( module+ main \u0026hellip;. )ä¹Ÿæ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒæ¯”( module* main #f \u0026hellip;. )æ›´å…·å¯è¯»æ€§ ã€‚\nRequire requireçš„å®šä¹‰ä¸ºï¼š\n(require require-spec \u0026hellip;)\nonly-in ç”¨æ¥é™åˆ¶æ¨¡å—å¯¼å‡ºçš„ç»‘å®šï¼Œä¹Ÿå¯é‡å‘½åç»‘å®š\n\u0026gt; (module m (lib \u0026#34;racket\u0026#34;) (provide tastes-great? less-filling?) (define tastes-great? #t) (define less-filling? #t)) \u0026gt; (require (only-in \u0026#39;m tastes-great?)) \u0026gt; tastes-great? #t \u0026gt; less-filling? less-filling?: undefined; cannot reference an identifier before its definition in module: top-level \u0026gt; (require (only-in \u0026#39;m [less-filling? lite?])) \u0026gt; lite? #t except-in æ˜¯only-inçš„è¡¥å……ï¼Œç”¨æ¥æ’é™¤æŸäº›ç»‘å®š\n(except-in require-spec id \u0026hellip;)\nrename-in ä¸only-inç±»ä¼¼ã€‚\n(rename-in require-spec [orig-id bind-id] \u0026hellip;)\nprefix-in (prefix-in prefix-id require-spec) ç»™æ¯ä¸€ä¸ªrequire-specçš„ç»‘å®šæ·»åŠ å‰ç¼€\nProvide (provide provide-spec \u0026hellip;)\nprovide-specå…è®¸é€’å½’å®šä¹‰ï¼š\nid: æœ€ç®€å•çš„å½¢å¼ï¼Œä¸Šæ–‡ä¸­å¤šæ¬¡å‡ºç°\n(rename-out [orig-id export-id] \u0026hellip;): é‡å‘½åå¯¼å‡ºçš„ç»‘å®š\n(struct-out struct-id): å¯¼å‡ºstruct\n(all-defined-out): å¯¼å‡ºæ‰€æœ‰ç»‘å®šï¼Œä¸æ¨è\n(all-from-out module-path): å¯¼å‡ºæ‰€æœ‰ç”±module-pathæŒ‡å®šçš„ç»‘å®š\n(except-out provide-spec id \u0026hellip;): æ’é™¤idæŒ‡å®šçš„ç»‘å®š\n(prefix-out prefix-id provide-spec)ï¼šç»™æ¯ä¸ªå¯¼å‡ºç»‘å®šæ·»åŠ ä¸€ä¸ªå‰ç¼€\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":82,"section":"posts","summary":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set! é€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥","tags":["racket","module"],"title":"Racket Modules","uri":"https://lvsq.net/2021/07/racket-modules/","year":"2021"},{"content":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜:\nç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ içš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º(i, $a_i$) å’Œ (i, 0) ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\nè¯´æ˜ï¼šä¸èƒ½å€¾æ–œå®¹å™¨\næ›´è¯¦ç»†çš„æè¿°è¯·è®¿é—®ï¼šhttps://leetcode-cn.com/problems/container-with-most-water/\né¦–å…ˆå¯ä»¥æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯æš´åŠ›æ±‚è§£ï¼Œå°†æ‰€æœ‰çš„é¢ç§¯éƒ½è®¡ç®—å‡ºæ¥ï¼Œå–æœ€å¤§å€¼å³å¯ã€‚ä¸‹é¢ç»™å‡º(Racket)[https://racket-lang.org/]çš„ä»£ç ï¼Œå¾—ç›Šäºå‡½æ•°å¼è¯­è¨€å’ŒSè¡¨è¾¾å¼å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œä»£ç å¯ä»¥å¾ˆçŸ­ï¼š\n(define/contract (max-area height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define len (length height)) (cond ((\u0026lt; len 2) 0) ((= len 2) (area (list 1 (car height)) (list 2 (cadr height)))) (else (max (each-area height) (max-area (cdr height)))))) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (define (each-area height) (let ([first (list 1 (car height))]) (foldl max 0 (map (lambda (i h) (area first (list i h))) (range 2 (add1 (length height)) ) (cdr height))))) ä¸Šè¿°è§£æ³•è™½ç„¶æ­£ç¡®ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½, å¦‚æœæœ‰10000ä¸ªæ•´æ•°ï¼Œå³n=10000ï¼Œå…¶æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†2ç§’ï¼š\n(time (max-area (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 2387 real time: 2466 gc time: 137 é‚£ä¹ˆæœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•å—ï¼Ÿ\næ˜¾ç„¶å¯ä»¥è®¤ä¸ºæ‰€æœ‰æ•´æ•°éƒ½ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨æˆ–è€…æ•°ç»„ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå«headï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªæ•´æ•°, è¡¨ç¤ºä¸ºï¼šhead -\u0026gt; (i, $h_i$)ï¼Œiä¸ºåˆ—è¡¨ä¸‹æ ‡ï¼Œ $h_i$ä»£è¡¨ç¬¬iä¸ªæ•´æ•°å€¼ï¼›å¦ä¸€ä¸ªå«tailï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸ºtail -\u0026gt; (j, $h_j$)ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…åˆ©ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨ï¼Œå°±èƒ½è®¡ç®—å‡ºæœ€å¤§çš„é¢ç§¯ï¼Œå…¶è¿‡ç¨‹ä¸ºï¼š\nè®¡ç®—ç”±headå’Œtailå›´æˆçš„çŸ©å½¢çš„é¢ç§¯$S_{ij}$, çŸ©å½¢çš„é•¿åº¦x = j - i, é«˜åº¦y = min ($h_i$, $h_j$); å°†çŸ©å½¢æ”¶çª„ä¸€æ ¼ï¼Œå³xå‡å°‘1ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æ”¶çª„æ–¹å¼ï¼š å°†é«˜åº¦çŸ­çš„ä¸€ä¾§æ”¶çª„ï¼Œé‚£ä¹ˆï¼Œæ”¶çª„åé«˜åº¦å¯èƒ½å˜å¤§ï¼Œåˆ™é¢ç§¯å¯èƒ½å¢å¤§; å°†é«˜åº¦é•¿çš„ä¸€ä¾§æ”¶çª„ï¼Œç”±äºå¦ä¸€ä¾§ä¸å˜,ä½†æ˜¯é•¿åº¦å˜å°äº†ä¸€æ ¼ï¼Œåˆ™é¢ç§¯ä¼šå˜å°; å› æ­¤ï¼Œéœ€è¦ç§»åŠ¨é«˜åº¦çŸ­çš„ä¸€ä¾§ï¼Œæ‰æœ‰å¯èƒ½æ‰¾åˆ°é¢ç§¯æ›´å¤§çš„çŸ©å½¢ å¾ˆæ˜¾ç„¶ï¼Œä½¿ç”¨åŒæŒ‡é’ˆç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†$O(n)$ã€‚\nRacket ç‰ˆæœ¬ ;;better solution (define/contract (max-area-pair-pointer height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (let ([len (length height)]) (if (\u0026lt; len 2) 0 (let loop ([h height] [hindex (range 0 len)] [rheight (reverse height)] [rindex (reverse (range 0 len))] [maxa 0]) (let* ([head (list (car hindex) (car h))] [tail (list (car rindex) (car rheight))] [a (area head tail)]) (if (= (car head) (car tail)) maxa (if (\u0026gt; (cadr head) (cadr tail)) (loop h hindex (cdr rheight) (cdr rindex) (max maxa a)) (loop (cdr h) (cdr hindex) rheight rindex (max maxa a))) )))))) å¦‚æœä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¡ç®—10000ä¸ªæ•´æ•°çš„é¢ç§¯ï¼Œæ‰§è¡Œæ—¶é—´åªéœ€1æ¯«ç§’ï¼Œè€Œä¸”ä¸éœ€è¦GCï¼ˆå¯¹ç…§æš´åŠ›ç ´è§£ç‰ˆæœ¬ï¼Œ2+ç§’ï¼‰\n(time (max-area-pair-pointer (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 1 real time: 1 gc time: 0 Rustç‰ˆæœ¬ åŒæ—¶æä¾›ä¸€ä¸ªRustç‰ˆæœ¬çš„å®ç°ï¼Œ\nuse std::cmp::{max, min}; type HeightType = i64; #[derive(Debug)] struct Solution {} impl Solution { pub fn max_area(height: Vec\u0026lt;HeightType\u0026gt;) -\u0026gt; HeightType { let len = height.len(); return if len \u0026lt; 2 { 0 } else { let mut max_area = 0; let mut hi = 0; let mut ti = len - 1; while ti \u0026gt; hi { let hd = height.get(hi).unwrap(); let td = height.get(ti).unwrap(); let a = ((ti - hi) as HeightType) * min(hd, td); max_area = max(max_area, a); if hd \u0026lt; td { hi += 1; } else { ti -= 1; } } max_area }; } } ä¸¤ä¸ªç‰ˆæœ¬åšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒï¼š\nsize Racket(8.0 CS) Rust(1.50.0) 100000 49ms 60ms 1000000 560ms 550ms 10000000 5s 5.6s ä¸¤ä¸ªç‰ˆæœ¬çš„å®ç°å‡æœªä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–,ä»¤äººæ„å¤–çš„æ˜¯Racketçš„æ‰§è¡Œæ•ˆç‡ä¸Rustå‡ ä¹æ²¡æœ‰å·®åˆ«ï¼Œä½¿ç”¨äº†CSç¼–è¯‘å™¨çš„RacketçœŸæ˜¯çªé£çŒ›è¿›ã€‚ ç”±äºæˆ‘çš„Rustç»éªŒå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæˆ–è®¸æœ‰æ›´å¥½çš„å†™æ³•ã€‚ä»æµ‹è¯•å¯ä»¥çœ‹åˆ°Racketè‡³å°‘åœ¨CPUå¯†é›†å‹åº”ç”¨ä¸­å¯å ªå¤§ç”¨ã€‚\n","id":83,"section":"posts","summary":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜: ç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨","tags":[],"title":"ã€ç››æœ€å¤šæ°´çš„å®¹å™¨ã€‘é—®é¢˜çš„æ±‚è§£","uri":"https://lvsq.net/2021/05/container-with-most-water/","year":"2021"},{"content":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚\nå®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15æ—¥\nåœ¨æŸäº›æ–¹é¢ï¼Œå­¦ä¹ è®¡ç®—æœºç¼–ç¨‹ä¸å­¦ä¹ æ–°è¯­è¨€ç›¸ä¼¼ã€‚å®ƒéœ€è¦å­¦ä¹ æ–°çš„ç¬¦å·å’Œæœ¯è¯­ï¼Œå¿…é¡»æ­£ç¡®ç»„ç»‡è¿™äº›ç¬¦å·å’Œæœ¯è¯­ä»¥æŒ‡å¯¼è®¡ç®—æœºè¯¥æ€ä¹ˆåšã€‚è®¡ç®—æœºä»£ç è¿˜å¿…é¡»è¶³å¤Ÿæ¸…æ™°ï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºå‘˜å¯ä»¥é˜…è¯»å’Œç†è§£ã€‚\nå°½ç®¡å­˜åœ¨è¿™äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œéº»çœç†å·¥å­¦é™¢çš„ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç å¹¶ä¸èƒ½æ¿€æ´»ä¸è¯­è¨€å¤„ç†æœ‰å…³çš„å¤§è„‘åŒºåŸŸã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒæ¿€æ´»äº†ä¸€ä¸ªç§°ä¸ºå¤šéœ€æ±‚ç½‘ç»œçš„åˆ†å¸ƒå¼ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¹Ÿè¢«æ‹›å‹Ÿç”¨äºè§£å†³å¤æ‚çš„è®¤çŸ¥ä»»åŠ¡ï¼Œä¾‹å¦‚è§£å†³æ•°å­¦é—®é¢˜æˆ–å¡«å­—æ¸¸æˆã€‚\nä½†æ˜¯ï¼Œå°½ç®¡é˜…è¯»è®¡ç®—æœºä»£ç ä¼šæ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œï¼Œä½†ä¸æ•°å­¦æˆ–é€»è¾‘é—®é¢˜ç›¸æ¯”ï¼Œå®ƒä¼¼ä¹æ›´å¤šåœ°ä¾èµ–äºç½‘ç»œçš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™è¡¨æ˜ç¼–ç ä¹Ÿä¸èƒ½ç²¾ç¡®åœ°å¤åˆ¶æ•°å­¦çš„è®¤çŸ¥éœ€æ±‚ã€‚\nâ€œç†è§£è®¡ç®—æœºä»£ç ä¼¼ä¹æ˜¯è‡ªå·±çš„äº‹ã€‚å®ƒä¸è¯­è¨€ä¸åŒï¼Œæ•°å­¦ä¸é€»è¾‘ä¹Ÿä¸ç›¸åŒã€‚â€éº»çœç†å·¥å­¦é™¢ç ”ç©¶ç”Ÿï¼Œè¯¥ç ”ç©¶çš„ä¸»è¦ä½œè€…å®‰å¨œÂ·ä¼Šå‡¡è¯ºå¨ƒï¼ˆAnna Ivanovaï¼‰è¯´ã€‚\nEvelina Fedorenkoï¼ŒFrederick A.å’ŒCarole J. MiddletonèŒä¸šå‘å±•ç¥ç»ç§‘å­¦å‰¯æ•™æˆï¼Œéº¦æˆˆæ–‡è„‘ç§‘å­¦ç ”ç©¶æ‰€çš„æˆå‘˜ï¼Œæ˜¯è¯¥è®ºæ–‡çš„é«˜çº§ä½œè€…ï¼Œè¯¥è®ºæ–‡ä»Šå¤©å‘è¡¨åœ¨eLifeä¸Šã€‚éº»çœç†å·¥å­¦é™¢è®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½å®éªŒå®¤å’Œå¡”å¤«èŒ¨å¤§å­¦çš„ç ”ç©¶äººå‘˜ä¹Ÿå‚ä¸äº†è¿™é¡¹ç ”ç©¶ã€‚\nè¯­è¨€ä¸è®¤çŸ¥ Fedorenkoç ”ç©¶çš„ä¸»è¦é‡ç‚¹æ˜¯è¯­è¨€ä¸å…¶ä»–è®¤çŸ¥åŠŸèƒ½ä¹‹é—´çš„å…³ç³»ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¥¹ä¸€ç›´åœ¨ç ”ç©¶å…¶ä»–åŠŸèƒ½æ˜¯å¦ä¾èµ–äºå¤§è„‘çš„è¯­è¨€ç½‘ç»œï¼ˆåŒ…æ‹¬BrocaåŒºåŸŸå’Œå¤§è„‘å·¦åŠçƒçš„å…¶ä»–åŒºåŸŸï¼‰çš„é—®é¢˜ã€‚åœ¨å…ˆå‰çš„å·¥ä½œä¸­ï¼Œå¥¹çš„å®éªŒå®¤è¡¨æ˜ï¼ŒéŸ³ä¹å’Œæ•°å­¦ä¼¼ä¹å¹¶æœªæ¿€æ´»è¯¥è¯­è¨€ç½‘ç»œã€‚\nâ€œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰å…´è¶£æ¢ç´¢è¯­è¨€å’Œè®¡ç®—æœºç¼–ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œéƒ¨åˆ†åŸå› æ˜¯è®¡ç®—æœºç¼–ç¨‹æ˜¯ä¸€ä¸ªæ–°å‘æ˜ï¼Œæˆ‘ä»¬çŸ¥é“ä¸å¯èƒ½æœ‰ä»»ä½•ç¡¬è¿çº¿æœºåˆ¶ä½¿æˆ‘ä»¬æˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œâ€ä¼Šä¸‡è¯ºå¨ƒè¯´ã€‚\nå¥¹è¯´ï¼Œå…³äºå¤§è„‘å¦‚ä½•å­¦ä¹ ç¼–ç ï¼Œå­˜åœ¨ä¸¤ç§æ€æƒ³æµæ´¾ã€‚æœ‰äººè®¤ä¸ºï¼Œè¦ç²¾é€šç¼–ç¨‹ï¼Œå°±å¿…é¡»ç²¾é€šæ•°å­¦ã€‚å¦ä¸€ä¸ªå»ºè®®è®¤ä¸ºï¼Œç”±äºç¼–ç å’Œè¯­è¨€ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè¯­è¨€æŠ€èƒ½å¯èƒ½æ›´ç›¸å…³ã€‚ä¸ºäº†é˜æ˜è¿™ä¸€é—®é¢˜ï¼Œç ”ç©¶äººå‘˜ç€æ‰‹ç ”ç©¶åœ¨é˜…è¯»è®¡ç®—æœºä»£ç æ—¶å¤§è„‘æ´»åŠ¨æ¨¡å¼æ˜¯å¦ä¼šä¸è¯­è¨€ç›¸å…³çš„å¤§è„‘æ´»åŠ¨é‡å ã€‚\nç ”ç©¶äººå‘˜åœ¨æœ¬ç ”ç©¶ä¸­é‡ç‚¹å…³æ³¨ä»¥å¯è¯»æ€§ç€ç§°çš„ä¸¤ç§ç¼–ç¨‹è¯­è¨€â€”â€”Pythonå’ŒScratchJrã€‚ScratchJrè¿™æ˜¯ä¸€ç§ä¸“ä¸º5å²åŠ5å²ä»¥ä¸Šå„¿ç«¥è®¾è®¡çš„å¯è§†åŒ–ç¼–ç¨‹è¯­è¨€ã€‚ç ”ç©¶å¯¹è±¡å‡ä¸ºç²¾é€šæµ‹è¯•è¯­è¨€çš„å¹´è½»äººã€‚å½“ç¨‹åºå‘˜èººåœ¨åŠŸèƒ½ç£å…±æŒ¯ï¼ˆfMRIï¼‰æ‰«æä»ªä¸­æ—¶ï¼Œç ”ç©¶äººå‘˜å‘ä»–ä»¬å±•ç¤ºäº†ä»£ç ç‰‡æ®µï¼Œå¹¶è¦æ±‚ä»–ä»¬é¢„æµ‹ä»£ç å°†äº§ç”Ÿä»€ä¹ˆåŠ¨ä½œã€‚\nç ”ç©¶äººå‘˜å‡ ä¹çœ‹ä¸åˆ°å¤§è„‘è¯­è¨€åŒºåŸŸå¯¹ä»£ç çš„ååº”ã€‚ç›¸åï¼Œä»–ä»¬å‘ç°ç¼–ç ä»»åŠ¡ä¸»è¦æ¿€æ´»äº†æ‰€è°“çš„å¤šéœ€æ±‚ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œçš„æ´»åŠ¨éå¸ƒæ•´ä¸ªå¤§è„‘çš„é¢å¶å’Œé¡¶å¶ï¼Œé€šå¸¸æ˜¯ä¸ºéœ€è¦åŒæ—¶è®°ä½è®¸å¤šä¿¡æ¯çš„ä»»åŠ¡è€Œæ‹›å‹Ÿçš„ï¼Œå®ƒè´Ÿè´£æˆ‘ä»¬æ‰§è¡Œå„ç§å¿ƒç†ä»»åŠ¡çš„èƒ½åŠ›ã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œå®ƒæ‰€åšçš„å‡ ä¹æ‰€æœ‰åœ¨è®¤çŸ¥ä¸Šéƒ½å…·æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ï¼Œä½¿æ‚¨éš¾ä»¥æ€è€ƒã€‚â€\nå…ˆå‰çš„ç ”ç©¶è¡¨æ˜ï¼Œæ•°å­¦å’Œé€»è¾‘é—®é¢˜ä¼¼ä¹ä¸»è¦å–å†³äºå·¦åŠçƒçš„å¤šä¸ªéœ€æ±‚åŒºåŸŸï¼Œè€Œæ¶‰åŠç©ºé—´å¯¼èˆªçš„ä»»åŠ¡æ¯”å³åŠçƒæ›´å¤šåœ°æ¿€æ´»å³åŠçƒã€‚éº»çœç†å·¥å­¦é™¢çš„ç ”ç©¶å°ç»„å‘ç°ï¼Œè¯»å–è®¡ç®—æœºä»£ç ä¼¼ä¹å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œçš„å·¦ä¾§å’Œå³ä¾§ï¼Œè€ŒScratchJræ¿€æ´»å³ä¾§çš„ç¨‹åº¦è¦æ¯”å·¦ä¾§é«˜ä¸€äº›ã€‚è¿™ä¸€å‘ç°è¿èƒŒäº†æ•°å­¦å’Œç¼–ç ä¾èµ–ç›¸åŒå¤§è„‘æœºåˆ¶çš„å‡è®¾ã€‚\nç»éªŒçš„å½±å“ ç ”ç©¶äººå‘˜è¯´ï¼Œå°½ç®¡ä»–ä»¬æ²¡æœ‰å‘ç°ä»»ä½•ä¼¼ä¹ä¸“é—¨ç”¨äºç¼–ç¨‹çš„åŒºåŸŸï¼Œä½†æ˜¯è¿™ç§å…·æœ‰ç‰¹æ®Šè„‘æ´»åŠ¨çš„åŒºåŸŸå¯èƒ½ä¼šåœ¨å…·æœ‰æ›´å¤šç¼–ç ç»éªŒçš„äººä¸­å‘å±•ã€‚\nFedorenkoè¯´ï¼šâ€œå¦‚æœæ‚¨è˜ç”¨äº†ä»¥30å¹´æˆ–40å¹´çš„ç‰¹å®šè¯­è¨€ç¼–å†™ä»£ç çš„ä¸“ä¸šç¨‹åºå‘˜çš„äººï¼Œæ‚¨å¯èƒ½ä¼šå¼€å§‹çœ‹åˆ°æŸäº›ä¸“ä¸šåŒ–çŸ¥è¯†ï¼Œæˆ–è€…æ˜¯å¤šä¸ªéœ€æ±‚ç³»ç»ŸæŸäº›éƒ¨åˆ†çš„ç»“æ™¶â€ï¼ŒFedorenkoè¯´ã€‚â€œå¯¹äºé‚£äº›ç†Ÿæ‚‰ç¼–ç å¹¶ä¸”å¯ä»¥æœ‰æ•ˆåœ°å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œä½†ç»éªŒç›¸å¯¹æœ‰é™çš„äººæ¥è¯´ï¼Œä¼¼ä¹æ‚¨è¿˜çœ‹ä¸åˆ°ä»»ä½•ä¸“ä¸šåŒ–çŸ¥è¯†ã€‚â€\nçº¦ç¿°Â·éœæ™®é‡‘æ–¯å¤§å­¦çš„ä¸€ç»„ç ”ç©¶äººå‘˜åœ¨åŒä¸€æœŸeLifeä¸Šå‘è¡¨çš„ä¸€ç¯‡ä¼´éšè®ºæ–‡ä¸­ä¹ŸæŠ¥å‘Šè¯´ï¼Œè§£å†³ä»£ç é—®é¢˜å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œè€Œä¸æ˜¯è¯­è¨€åŒºåŸŸã€‚\nç ”ç©¶ç»“æœè¡¨æ˜ï¼Œå¯¹äºç¼–ç åº”è¯¥ä»¥åŸºäºæ•°å­¦çš„æŠ€èƒ½è¿˜æ˜¯åŸºäºè¯­è¨€çš„æŠ€èƒ½è¿›è¡Œæ•™æˆï¼Œå°šæ— å®šè®ºã€‚ç ”ç©¶äººå‘˜è¯´ï¼Œéƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå­¦ä¹ ç¼–ç¨‹å¯èƒ½ä¼šåŒæ—¶ä¾èµ–è¯­è¨€å’Œå¤šç§éœ€æ±‚ç³»ç»Ÿï¼Œå³ä½¿â€”ä¸€æ—¦å­¦ä¼šäº†ç¼–ç¨‹ï¼Œå°±ä¸ä¼šä¾èµ–è¯­è¨€åŒºåŸŸã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œä¸¤ä¸ªé˜µè¥éƒ½å®£ç§°ï¼Œå®ƒå¿…é¡»ä¸æ•°å­¦ç»“åˆåœ¨ä¸€èµ·ï¼Œå¿…é¡»ä¸è¯­è¨€ç»“åˆåœ¨ä¸€èµ·ã€‚â€ â€œä½†æ˜¯çœ‹æ¥ï¼Œè®¡ç®—æœºç§‘å­¦æ•™è‚²è€…å°†ä¸å¾—ä¸å¼€å‘è‡ªå·±çš„æ–¹æ³•æ¥æœ€æœ‰æ•ˆåœ°æ•™æˆä»£ç ã€‚â€\nå…¨æ–‡å®Œã€‚\nå¦‚æœæ‚¨æƒ³çœ‹åŸæ–‡ï¼Œå¯ä»¥è®¿é—®ï¼šé“¾æ¥\n","id":84,"section":"posts","summary":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚ å®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15","tags":[],"title":"å¯¹å¤§è„‘è€Œè¨€ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç ä¸é˜…è¯»è¯­è¨€ä¸åŒ","uri":"https://lvsq.net/2020/12/brain-reading-computer-code/","year":"2020"},{"content":"ä½œè€…\nMATTHEW FLATT, University of Utah,\nUSACANER DERICI, Indiana University, USA\nR. KENT DYBVIG, Cisco Systems, Inc., USA\nANDREW W. KEEP, Cisco Systems, Inc., USA\nGUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina\nSARAH SPALL, Indiana University, USA\nSAM TOBIN-HOCHSTADT, Indiana University, USA\nJON ZEPPIERI, independent researcher, USA\næ¦‚è¦\næˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Racketï¼Œå¹¶ä¸”è¿è¡Œè‰¯å¥½â€”â€”åªè¦å¯¹Chez Schemeè¿›è¡Œä¸€äº›ä¿®è¡¥ï¼Œå°±å¯ä»¥è¿è¡ŒDrRacketã€‚ Racketå‘è¡Œç‰ˆå¯ä»¥è‡ªè¡Œæ„å»ºï¼Œå¹¶ä¸”å‡ ä¹æ‰€æœ‰æ ¸å¿ƒâ€‹â€‹çš„Racketæµ‹è¯•å¥—ä»¶éƒ½å¯ä»¥é€šè¿‡ã€‚å°½ç®¡ä»æœ‰ä¸€äº›å·¥ä½œå¯ä»¥æé«˜ç«¯åˆ°ç«¯çš„æ€§èƒ½ï¼Œä½†æœ€ç»ˆçš„å®ç°è¿˜æ˜¯ä¸é”™çš„ã€‚ æˆ‘ä»¬è¯„ä¼°çš„æœ€ä¸å¯é¢„æµ‹çš„éƒ¨åˆ†æ˜¯ï¼ŒRacketå’ŒChez Schemeä¹‹é—´çš„ä¸åŒå°†å˜å¾—å¤šå¤§ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›ä¸åŒã€‚æˆ‘ä»¬å¸Œæœ›Racket CSæˆä¸ºä¸»è¦çš„Racketå®ç°ï¼Œå¹¶ä¸”æˆ‘ä»¬é¼“åŠ±å…¶ä»–è¯­è¨€å®ç°è€…å°†Chez Schemeè§†ä¸ºç›®æ ‡è™šæ‹Ÿæœºã€‚\nè¯¥æ–‡è¯¦ç»†åœ°ä»‹ç»äº†Racket CSæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œä»¥åŠä¸Chez Schemeä¹‹é—´çš„å·®å¼‚ï¼Œ å®Œæ•´å†…å®¹è§(https://dl.acm.org/doi/epdf/10.1145/3341642)\n","id":85,"section":"posts","summary":"ä½œè€… MATTHEW FLATT, University of Utah, USACANER DERICI, Indiana University, USA R. KENT DYBVIG, Cisco Systems, Inc., USA ANDREW W. KEEP, Cisco Systems, Inc., USA GUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina SARAH SPALL, Indiana University, USA SAM TOBIN-HOCHSTADT, Indiana University, USA JON ZEPPIERI, independent researcher, USA æ¦‚è¦ æˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Ra","tags":["pl"],"title":"åŸºäºChez Schemeé‡å»ºRacket","uri":"https://lvsq.net/2020/10/rebuilding-racket/","year":"2020"},{"content":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„è®¡ç®—æœºè¯­è¨€Java, Python, Cç­‰ç­‰å‡ ä¹ä¸€è‡´é‡‡ç”¨Lexical Scoping,ç¨‹åºå‘˜æ²¡æœ‰æœºä¼šå¯Ÿè§‰åˆ°å¼‚æ ·ï¼Œä»è€Œæ©ç›–äº†è¿˜æœ‰å…¶ä»–ä½œç”¨åŸŸçš„äº‹å®ï¼Œè®¸å¤šæ•™ç§‘ä¹¦ä¹Ÿå¾ˆé…åˆåœ°ä¸€ç¬”å¸¦è¿‡ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯æ‚¨å·²ç»æ´å¯Ÿäº†ä¸åŒä½œç”¨åŸŸçš„å·®å¼‚å’Œå†…æ¶µï¼Œè‡ªè§‰åœ°è§„é¿äº†é—®é¢˜ã€‚æˆ‘è¡·å¿ƒçš„å¸Œæœ›æ‰€æœ‰ç¨‹åºå‘˜éƒ½æ˜¯ç¬¬äºŒç§å¯èƒ½ã€‚\næœ¬æ–‡å°†æµ…æ˜¾åœ°æè¿°ä¸¤ç§ä½œç”¨åŸŸçš„ç‰¹ç‚¹åŠå·®å¼‚ï¼Œå¸Œæœ›å¯ä»¥è§£é‡Šåœ°æ¸…æ¥šä¸€ç‚¹ï¼Œå¦‚æœè¯»å®Œä¹‹åæ‚¨æ›´åŠ æ¨¡ç³Šäº†ï¼Œè¯·è®°ä½ï¼Œè¿™å¹¶éæˆ‘çš„æœ¬æ„ã€‚\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œåç§°ç»‘å®šçš„ä½œç”¨åŸŸï¼ˆåç§°ä¸å®ä½“çš„å…³è”ï¼Œæ¯”å¦‚å˜é‡ï¼‰æ˜¯ç¨‹åºä¸­åç§°ç»‘å®šæœ‰æ•ˆçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åç§°å¯ä»¥è¢«å¼•ç”¨åˆ°ä¸€ä¸ªå®ä½“ã€‚ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œåç§°å¯èƒ½æŒ‡å‘ä¸åŒçš„å®ä½“ï¼ˆå®ƒå¯èƒ½å…·æœ‰ä¸åŒçš„ç»‘å®šï¼‰ï¼Œæˆ–è€…æ ¹æœ¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ˆå®ƒå¯èƒ½æ˜¯æœªç»‘å®šçš„ï¼‰ã€‚ä½œç”¨åŸŸä¹Ÿç§°ä¸ºå®ä½“çš„å¯è§æ€§ï¼Œ å°¤å…¶åœ¨è¾ƒæ—©çš„æŠ€æœ¯æ–‡çŒ®ä¸­å¯è§ï¼Œè¿™æ˜¯ä»æ‰€å¼•ç”¨çš„å®ä½“çš„è§’åº¦å‡ºå‘ï¼Œè€Œéå¼•ç”¨çš„åç§°ã€‚\næœ¯è¯­\u0026quot;scope\u0026ldquo;ä¹Ÿç”¨äºæŒ‡ä»£ç¨‹åºä¸­æœ‰æ•ˆçš„åç§°ç»‘å®šçš„é‚£éƒ¨åˆ†é›†åˆï¼Œæ›´åŠ æ­£ç¡®çš„ç§°å‘¼åº”è¯¥æ˜¯ä¸Šä¸‹æ–‡ æˆ–è€… ç¯å¢ƒ\nLexical Scoping è¯æ³•ä½œç”¨åŸŸï¼ŒæŸäº›ä¹¦ä¸­ä¹Ÿå«é™æ€ä½œç”¨åŸŸï¼Œå…¶åœ¨ç¼–å†™ä»£ç æ—¶æˆ–è€…è¯´å®šä¹‰æ—¶å°±ç¡®å®šçš„ï¼Œé€šè¿‡æ–‡æœ¬ï¼ˆæºä»£ç ï¼‰å°±å¯ä»¥è§‚å¯Ÿåˆ°åç§°ä¸å®ä½“çš„å…³è”ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šåœ¨è·ç¦»è¢«è°ƒç”¨ä»£ç æœ€è¿‘çš„ç¯å¢ƒä¸­å»æŸ¥æ‰¾ç»‘å®šï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç¯å¢ƒï¼Œåœ¨ä¼˜å…ˆä»æœ€é‡Œé¢ä¸€å±‚çš„ç¯å¢ƒæŸ¥æ‰¾ã€‚\næ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n(setf x 1) ;; bind x to 1 (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) ;; result is 6 (format t \u0026#34;X = ~d \u0026#34; x) ;; X = 1 å…ˆç»‘å®šxä¸º1ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªå‡½æ•°fï¼Œfä¸­çš„å˜é‡xç»‘å®šä¸º2ï¼Œå®é™…ä¸Šfå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œç”±äºä¸¤ä¸ªxçš„ç¯å¢ƒä¸åŒï¼Œæ‰€ä»¥äº’ä¸å¹²æ‰°ï¼Œç»“æœæ­£æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œè¿™å°±å±äºè¯æ³•ä½œç”¨åŸŸã€‚\nDynamic Scoping åŠ¨æ€ä½œç”¨åŸŸæ›¾ç»è®©å¾ˆå¤šäººæ·±æ¶ç—›ç»ï¼Œä»¥è‡³äºä¸æ„¿æ„å†æèµ·å®ƒã€‚æ—©æœŸçš„Lispæ™®éä½¿ç”¨äº†åŠ¨æ€ä½œç”¨åŸŸï¼Œå¹¶å¸¦æ¥äº†éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯Lisp Machineè¢«Unixæ‰“è´¥çš„é™¤äº†å•†ä¸šå› ç´ ä¹‹å¤–çš„é‡è¦åŸå› ï¼ŒLispè‡³ä»Šæœªæˆä¸ºä¸»æµè¯­è¨€å°±ä¸éš¾ç†è§£äº†ï¼Œå°½ç®¡Lispçš„è¯­æ³•æœ€ç²¾ç‚¼ã€æœ€ä¼˜ç¾ï¼Œè¿˜å…·æœ‰æœ€å¼ºæ‚çš„å®ç³»ç»Ÿï¼Œè¿˜æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªä½¿ç”¨GCçš„è¯­è¨€\u0026hellip;\nåº†å¹¸çš„æ˜¯ï¼ŒScheme, Common Lispç­‰Lispæ–¹è¨€å·²ç»éƒ½æ˜¯ç”¨äº†Lexial Scopingï¼ˆå±€éƒ¨å˜é‡ã€‚æ‰€ä»¥æŸäº›æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠLexical Scopingå’ŒLocal Variableç­‰ä»·ï¼‰, æˆ‘ä»¬æ— éœ€å†ä¸ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜è€Œçƒ¦æ¼ï¼Œçæƒœç”Ÿå‘½ï¼Œä¸æ˜¯å—ï¼Ÿ ä¸è¿‡Scheme, Common Lispè¿˜æ˜¯ä¿ç•™äº†åŠ¨æ€ä½œç”¨åŸŸçš„æ“ä½œï¼ŒSchemeå¯ä»¥å‚è€ƒFluid Binding, Common Lispçš„åŠ¨æ€ä½œç”¨åŸŸå°†åœ¨åæ–‡ä¸¾ä¾‹è¯´æ˜ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬æ— éœ€ä¸ºè¿™ä¸ªä¿ç•™æ‹…å¿§ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæˆ‘ä»¬å¾ˆå°‘éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚\næ‰€è°“dynamic scopingå°±æ˜¯è¯´ï¼Œåœ¨å‡½æ•°å®šä¹‰ä¸­å­˜åœ¨äº†â€œè‡ªç”±å˜é‡â€ï¼ˆfree variableï¼‰, ä¼šåœ¨è¿è¡Œæ—¶éšç€å‡½æ•°çš„â€œè°ƒç”¨ä½ç½®â€ä¸åŒè€Œå‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼Œä½†æ˜¯ç¨ä½œå˜åŒ–ï¼š\n(defvar x 1) ;; bind x to 1, x is a free variable (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) (format t \u0026#34;X = ~d \u0026#34; x) (let ((x 100)) (format t \u0026#34;Inner X is ~d \u0026#34; x)) (defvar x 1)å®šä¹‰äº†xï¼Œå€¼ä¸º1ï¼Œä½†æ˜¯è¿™ä¸ªxå±äºè‡ªç”±å˜é‡ï¼Œå¤„äºåŠ¨æ€ä½œç”¨åŸŸï¼Œå› ä¸ºLispè‡ªåŠ¨å°†å…¨å±€å˜é‡å³ç”±defvarã€defparameterã€specialå®šä¹‰çš„å˜é‡è‡ªåŠ¨å£°æ˜ä¸ºåŠ¨æ€ä½œç”¨åŸŸã€‚ xå¯¹äº(lambda (y) (* x y))æ¥è¯´æ˜¯â€œ è‡ªç”± â€ çš„ï¼Œå®ƒå¯ä¸ä¼šåœ¨æ„xç»‘å®šä¸º2æˆ–è€…ä»»ä½•å…¶ä»–å€¼ï¼Œå› ä¸º(let ((x 2)) \u0026hellip;)ä¸­æŒ‡å®šçš„xå·²ç»ä¸æ˜¯(lambda \u0026hellip;)çš„å‚æ•°äº†ã€‚\næ‰€ä»¥å½“æˆ‘ä»¬æ‰§è¡Œ(funcall f 3) æ—¶ï¼Œå…¶ç»“æœä¸åƒè¯æ³•ä½œç”¨åŸŸé‚£æ ·ç­‰äº6ï¼Œè€Œæ˜¯3\n(format t \u0026ldquo;X = ~d \u0026quot; x) ä¾ç„¶è¾“å‡ºï¼š X = 1\n(let ((x 100)) (format t \u0026ldquo;Inner X is ~d \u0026quot; x)) è¾“å‡ºä¸ºï¼šInner X is 100ã€‚ ç­‰ç­‰ï¼Œè¿™é‡Œçš„xä¸ºä»€ä¹ˆåˆæ˜¯100äº†ï¼Ÿ è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„ç¯å¢ƒ å—ï¼Ÿï¼\nå¦‚æœå°†å‡½æ•°fæ”¾åˆ°ä¸åŒçš„ä½ç½®æ‰§è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ä¸Šé¢(funcall f 3)æ˜¯åœ¨é¡¶å±‚æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬æ¢åˆ°letä¸­æ‰§è¡Œä¼šæ€ä¹ˆæ ·ï¼Ÿ\n(let ((x 2)) (funcall f 3)) è¿™æ¬¡å±…ç„¶è¿”å›6ï¼Œè€Œä¸æ˜¯3äº†ã€‚\nçœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿå‡½æ•°fçš„è¡Œä¸ºï¼Œä¼šéšç€è°ƒç”¨ä½ç½®çš„ä¸€ä¸ªåå«xçš„å˜é‡çš„å€¼çš„ä¸åŒè€Œå˜åŒ–ã€‚è™½ç„¶éƒ½å«xï¼Œä½†å¹¶ä¸æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯åå­—ç›¸åŒè€Œå·²ã€‚é¡ºå¸¦æä¸€å¥ï¼Œç°åœ¨å¯ä»¥ç†è§£Javaä¸­namespaceçš„ç”¨å¤„äº†å§ã€‚\nè¯æ³•ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°è¯æ³•ä¸Šä¸‹æ–‡è§£å†³çš„ï¼Œè€ŒåŠ¨æ€ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå³ä½ç½®ï¼‰è§£å†³çš„ã€‚è¿™æ˜¯ç¼–è¯‘å™¨å¿…é¡»é¢å¯¹å¹¶è§£å†³çš„é—®é¢˜ï¼Œæˆ–è®¸ç¼–å†™ç¨‹åºæ—¶æ— éœ€è¿‡å¤šå…³æ³¨ï¼Œä½†æ˜¯å¤šäº†è§£ä¸€ä¸‹ä¸€å®šå¤§æœ‰è£¨ç›Šã€‚å°½ç®¡åŠ¨æ€ä½œç”¨åŸŸå­˜åœ¨å¾ˆå¤§é—®é¢˜ï¼Œä½†å®ƒå¹¶éæ´ªæ°´çŒ›å…½ï¼Œå®ƒå¯ä»¥ä½¿å…¨å±€å˜é‡æ›´æ˜“äºç®¡ç†ï¼›å‡è®¾æ‚¨å¸Œæœ›ä¸´æ—¶æ”¹å˜è‡ªç”±å˜é‡çš„å€¼æ—¶ï¼Œä¹Ÿå¯ä»¥å£°æ˜ä¸ºdynamic socpingï¼›å¦å¤–åœ¨å¼‚å¸¸å¤„ç†ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ¨æ€ä½œç”¨åŸŸå°†å¤„ç†ç¨‹åºä¸å¼‚å¸¸ç›¸å…³è”ã€‚\n","id":86,"section":"posts","summary":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„","tags":["lexical","scoping"],"title":"Lexical Scoping and Dynamic Scoping","uri":"https://lvsq.net/2020/09/lexical-dynamic-scoping/","year":"2020"},{"content":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š\nè®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼›\néå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°åˆ—è¡¨çš„å·¦ä¾§ï¼Œæ‰€æœ‰å¤§äºæˆ–ç­‰äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°å³ä¾§ï¼›\nåˆ†åˆ«å¯¹å·¦ä¾§å’Œå³ä¾§çš„å…ƒç´ è¿›è¡Œå¿«æ’ï¼›\né‡å¤ä¸Šè¿°çš„æ­¥éª¤ï¼Œæ’åºå®Œæˆï¼›\nåœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åºnä¸ªå…ƒç´ éœ€è¦$O(nlog n)$å¤æ‚åº¦ï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦$O(n^2)$,ä½†ä¸€èˆ¬å¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µã€‚\nä»ç®—æ³•çš„åŸç†å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦å¤šæ¬¡æ‰§è¡Œé‡å¤çš„æ“ä½œï¼Œè‡ªç„¶é‡‡ç”¨é€’å½’å¯ä»¥å‡å°‘å¾ˆå¤šä»£ç ï¼Œè‹¥é—®é€’å½’æŠ€æœ¯å“ªå®¶å¼ºï¼Ÿé¦–å±ˆä¸€æŒ‡Lisp,ä¸‹é¢ç»™å‡ºCLç‰ˆæœ¬çš„å¿«æ’å®ç°ï¼ˆç®€æ˜“ç‰ˆæœ¬ï¼Œåªæ”¯æŒæ•°å­—ç±»å‹çš„åˆ—è¡¨ï¼Œå…¶ä»–ç±»å‹çš„æ’åºåªéœ€å¢åŠ ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å³å¯ï¼Œæœ¬æ–‡ä¸æ‰©å±•ï¼‰ï¼š\n(defun quickSort (lst) (let ( (len (list-length lst)) (st (lambda (l pk) ;; stå‡½æ•°å®ç°ä¸Šè¿°ç¬¬2æ­¥ (let ((left nil) (right nil)) (dolist (each l) (if (\u0026lt; each pk) (push each left) (push each right))) (values left right) ) ) ) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) (quickSort \u0026#39;(1 2 6 3 5 4)) =\u0026gt; (1 2 3 4 5 6) stå‡½æ•°å¯ä»¥ç”¨å®æ¥å®ç°ï¼š\n(defmacro st (lst pk) (let ((gslist (gensym))) `(let ((,gslist ,lst)) (let ((left nil) (right nil)) (dolist (each ,gslist) (if (\u0026lt; each ,pk) (push each left) (push each right))) (values left right) ) ) ) ) (defun quickSort (lst) (let ( (len (list-length lst)) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) ","id":87,"section":"posts","summary":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š è®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼› éå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äº","tags":["lisp"],"title":"å¿«é€Ÿæ’åºï¼ˆLispç‰ˆæœ¬ï¼‰","uri":"https://lvsq.net/2020/07/quick-sort-in-cl/","year":"2020"},{"content":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡ºäº†ä¸€ä¸ªå…³äºå…«çš‡åçš„é¢˜ç›®ï¼Œè¿™æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç»å…¸çš„é—®é¢˜ï¼Œå½“å¹´ä¸Šå­¦æ—¶æ›¾ç»å°½è„‘æ±ä»ç„¶äº‘å±±é›¾ç½©ï¼Œä¸å¾—å…¶è§£ã€‚å¦‚ä»Šå†æ¬¡ç›¸é‡ï¼Œå²‚èƒ½å†åå£ä¸Šè§‚ï¼Ÿï¼æ›´ä½•å†µæ‰‹è¾¹å·²æœ‰è¶æ‰‹çš„å…µå™¨ã€‚è¯•çœ‹Erlangçš„å®ç°ï¼š\n-module(queens). -export([queens/1]). queens(0) -\u0026gt; [[]]; queens(N) -\u0026gt; [[Row | Columns] || Columns \u0026lt;- queens(N - 1), Row \u0026lt;- lists:seq(1, 8) -- Columns, safe(Row, Columns, 1)]. safe(_Row, [], _N) -\u0026gt; true; safe(Row, [Column | Columns], N) -\u0026gt; (Row /= Column + N) andalso (Row /= Column - N) andalso safe(Row, Columns, (N + 1)). ä»å¤´è‡³å°¾10è¡Œä»£ç ï¼Œå¦‚æœä¸æ˜¯ä¸ºäº†ä½¿ä»£ç ç¾è§‚ï¼Œ6è¡Œè¶³çŸ£ï¼ˆè¿™è¿˜åŒ…æ‹¬äº†**-module** å’Œ**-export** ä¸¤è¡Œå£°æ˜è¯­æ³•ï¼Œä¸ç®—æ³•æœ¬èº«æ— å…³çš„ä»£ç ï¼‰ã€‚å¦‚æ­¤ç®€çŸ­å°½ç„¶å¯ä»¥æ¸…æ™°åœ°å®ç°å¤æ‚çš„å…«çš‡å é—®é¢˜ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼ç¨‹åºè¯­è¨€å¾—å†™å¤šå°‘è¡Œï¼Ÿæœ¬æ–‡çš„é‡ç‚¹ä¸åœ¨äºæ¯”è¾ƒè¿™ä¸ªï¼ŒErlangæ˜¯ä¸€é—¨éå¸¸å¼ºå¤§çš„è¯­è¨€ï¼Œå¯¹äºæˆ‘æ¥è¯´Erlangå¥½æ¯”æ¢æ˜¥ï¼Œä½†æ˜¯Schemeæ‰æ˜¯æ—é»›ç‰å‘€ï¼Œæ‰€ä»¥æ¯«ä¸è¿Ÿç–‘ç”¨Schemeæ¥å®ç°ï¼š\n(define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence)))) ) (define (enumerate-interval low high) (if (\u0026gt; low high) \u0026#39;() (cons low (enumerate-interval (+ low 1) high))) ) (define (flatmap proc seq) (accumulate append \u0026#39;() (map proc seq)) ) (define empty-board \u0026#39;()) (define (safe? k position) (let loop ([new-queen (car position)] [rest-queens (cdr position)] [i 1]) (if (null? rest-queens) #t (let ([rest-current-queen (car rest-queens)]) (if (or (= new-queen rest-current-queen) (= new-queen (+ rest-current-queen i)) (= new-queen (- rest-current-queen i)) ) #f (loop new-queen (cdr rest-queens) (+ i 1)) ) ) ) ) ) (define (adjoin-position new-row k rest-of-queens) (cons new-row rest-of-queens) ) (define (queens board-size) (define (queen-cols k) (if (= k 0) (list empty-board) (filter (lambda (position) (safe? k position)) ;è¿‡æ»¤æ— æ•ˆçš„è§£ (flatmap (lambda (rest-of-queens) (map (lambda (new-row) ;æ‰©å……ï¼ˆk-1ï¼‰ä¸ªçš‡åçš„æ¯ä¸€ä¸ªè§£ï¼Œç»™æ¯ä¸ªè§£éƒ½å¢åŠ ç¬¬kä¸ªçš‡å (adjoin-position new-row k rest-of-queens)) (enumerate-interval 1 board-size) ) ) (queen-cols (- k 1)) ;å‰ï¼ˆk-1ï¼‰ä¸ªæœ‰æ•ˆçš„çš‡åï¼Œè™½ç„¶æ˜¯å¤ªè™šå¹»å¢ƒï¼Œä½†å¯ä»¥è®¤ä¸ºæ˜¯äº‹å® ) ) ) ) (queen-cols board-size) ) Schemeç‰ˆæœ¬æ¯”Erlangç‰ˆæœ¬ä»£ç å¢åŠ äº†ä¸å°‘ï¼ŒåŸå› åœ¨äºå…¶æ²¡æœ‰æ¨¡å¼åŒ¹é… å’Œåˆ—è¡¨æ¨å¯¼ è¿™ä¸¤å¤§åˆ©å™¨ï¼Œä¸è¿‡æˆ‘æ›´å–œæ¬¢Schemeå¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ„é€ æˆ‘éœ€è¦çš„ä¸€åˆ‡ï¼Œè€Œä¸”S-è¡¨è¾¾å¼çœ‹èµ·æ¥ååˆ†ä¼˜ç¾è‡ªç„¶ã€‚Schemeç‰ˆæœ¬å®é™…ä¸Šè§£å†³äº†n-çš‡åï¼Œæ›´è¿›ä¸€æ­¥äº†ã€‚\näº‹æƒ…åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸï¼ŒåŸå› åœ¨äºæˆ‘åˆšå¼€å§‹å®ç°Schemeç‰ˆæœ¬çš„å…«çš‡åæ—¶ï¼Œé€‰æ‹©ç¿»è¯‘Erlangä»£ç ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼ä¸€ç•ªæŒ£æ‰ä¹‹åï¼Œæ„è¯†åˆ°è¯¥é—®é¢˜å±äºéç¡®å®šæ€§è®¡ç®—ï¼ŒçŒ›ç„¶æƒ³èµ·ã€ŠSICPã€‹ä¸­æœ‰ä¸€èŠ‚ä¸“é—¨ä»‹ç»äº†æ­¤ç§è®¡ç®—ï¼Œä¹Ÿå³æœ¬æ–‡çš„ä¸»è§’â€”â€”amb\néç¡®å®šæ€§è®¡ç®— ambè¿™ä¸ªåå­—æºäºambiguous ,å…¶å«ä¹‰å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£ã€‚ä¸€ç•ªæŠ«è‚æ²¥èƒ†ä¹‹åï¼Œç»ˆäºçª¥åˆ°äº†ä¸€äº›é—¨å¾„ï¼Œè¶æœºå˜æ¸…å¾ˆå¤šçŸ¥è¯†ç‚¹ã€‚æˆ‘å°†å°½åŠ›å¹³é“ºç›´è¿°ï¼Œç®€è¦çš„ä»‹ç»è¿™ç§å¼ºå¤§ä¸”ååˆ†æœ‰ç”¨çš„æ­¦å™¨ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸ªé—®é¢˜ï¼š\nå‡è®¾æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­éƒ½æ˜¯ä¸€äº›æ­£æ•´æ•°ï¼Œæ¯”å¦‚l1 = [1 2 3 4 5], l2 = [3 4 6 7 8]ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»l1å’Œl2ä¸­å„å–ä¸€ä¸ªæ•°å­—ï¼Œç›¸åŠ ä¹‹åï¼Œå¦‚æœæ˜¯ç´ æ•°ï¼Œåˆ™æ»¡è¶³è¦æ±‚ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå¯¹äºè¿™ä¸ªç®€å•çš„é—®é¢˜ï¼Œç›¸ä¿¡éš¾ä¸å€’å¤§å®¶ï¼Œé‡‡ç”¨å›æº¯ç®—æ³•è½»æ˜“å°±è§£å†³äº†ï¼Œè¿™é‡Œåªæ˜¯æƒ³å¼•å‡ºâ€œéç¡®å®šæ€§è®¡ç®—â€çš„æ¦‚å¿µã€‚éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†ç±»ä¼¼ï¼Œå¯¹äºâ€œç”Ÿæˆå’Œæ£€æµ‹å¼â€çš„åº”ç”¨ç‰¹åˆ«æœ‰ä»·å€¼ï¼Œå®ƒå¾€å¾€åªæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼Œè¿™å¥è¯å¾ˆæœ‰æ„æ€ï¼Œå¦‚æœæš‚æ—¶æ²¡æœ‰ç†è§£ä¸ç”¨ç€æ€¥ï¼Œç»§ç»­å¾€ä¸‹çœ‹ã€‚\nå¯¹äºéç¡®å®šæ€§è®¡ç®—ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè¡¨è¾¾å¼æ˜¯å…è®¸å­˜åœ¨å¤šä¸ªå€¼çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„é—®é¢˜çš„è§£è‡³å°‘æœ‰(1 4),(2 3)ä¸¤ä¸ªè§£å§ã€‚\næœ‰ä¸€ä»¶å¾ˆæœ‰æ•™ç›Šçš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†å¯¹äºæ—¶é—´çš„ä¸åŒçœ‹æ³•ã€‚æµå¤„ç†åˆ©ç”¨äº†æƒ°æ€§æ±‚å€¼ï¼Œè¿™ä¼šç»™æˆ‘ä»¬ä¸€ç§é”™è§‰ï¼Œä»¿ä½›æ‰€æœ‰å¯èƒ½çš„ç»“æœçš„å‡ºç°æ²¡æœ‰æ—¶é—´é¡ºåºï¼›å¯¹äºéç¡®å®šæ€§çš„æ±‚å€¼ï¼Œä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¯¹ä¸€ä¸ªå¯èƒ½çš„ä¸–ç•Œçš„æ¢ç´¢ï¼Œæ¯ä¸€ä¸ªå€¼éƒ½ç”±ä¸€æ¬¡é€‰æ‹©æ‰€ç¡®å®šï¼ŒæŸäº›é€‰æ‹©ä¼šèµ°å…¥æ­»èƒ¡åŒï¼Œè€Œå¦ä¸€äº›ä¼šå¾—åˆ°æœ‰ç”¨çš„å€¼ï¼Œæ‰€ä»¥éç¡®å®šæ€§è®¡ç®—ç»™æˆ‘ä»¬çš„æ„Ÿè§‰æ˜¯ï¼Œæ—¶é—´æ˜¯æœ‰åˆ†æ”¯çš„ã€‚ç¨‹åºå½“ä¸­ä¼šä¿å­˜æ‰€æœ‰å¯èƒ½çš„ä¸åŒæ‰§è¡Œå†å²ï¼Œåœ¨é‡åˆ°ä¸€ä¸ªæ­»èƒ¡åŒæ—¶ï¼Œæ€»æ˜¯å¯ä»¥å›åˆ°ä»¥å‰çš„é€‰æ‹©ç‚¹ï¼Œå¹¶æ²¿ç€å¦ä¸€ä¸ªåˆ†æ”¯ç»§ç»­ä¸‹å»ã€‚\nä¸‹é¢å°†è¦å®ç°çš„éç¡®å®šæ€§æ±‚å€¼å™¨ç§°ä¸ºâ€”â€”ambæ±‚å€¼å™¨\nambæ±‚å€¼å™¨ å‡è®¾ç›®å‰å·²ç»æ‰©å……äº†Schemeä»¥æ”¯æŒéç¡®å®šæ€§è®¡ç®—ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„ç§°ä¸ºambçš„æ–°å½¢å¼ï¼Œè¡¨è¾¾å¼ $(amb \u0026lt;e_1\u0026gt; \u0026lt;e_2\u0026gt; \u0026hellip; \u0026lt;e_n\u0026gt;)$ ä¼šâ€œæœ‰æ­§ä¹‰åœ°â€è¿”å›nä¸ªè¡¨è¾¾å¼ä¹‹ä¸€çš„å€¼ï¼Œæ¯”å¦‚ï¼š\n(list (amb 1 2 3) (amb \u0026#39;a \u0026#39;b)) å¯ä»¥æœ‰å¦‚ä¸‹6ä¸ªå¯èƒ½çš„å€¼ï¼š (1 a) (1 b) (2 a) (2 b) (3 a) (3 b)\nå¯¹äºæ²¡æœ‰é€‰é¡¹çš„ambï¼Œå³(amb) â€”â€”è§†ä¸ºæ²¡æœ‰å¯æ¥æ”¶å€¼çš„è¡¨è¾¾å¼ï¼Œè¿™å°†å¯¼è‡´æ±‚å€¼â€œfailâ€ã€‚\nambæ±‚å€¼å™¨åœ¨æ¯ä¸ªé€‰æ‹©ç‚¹ï¼Œæ€»æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªå¯èƒ½æ€§ï¼Œå¦‚æœé€‰æ‹©çš„ç»“æœå¤±è´¥ï¼Œé‚£ä¹ˆæ±‚å€¼å™¨è‡ªåŠ¨åœ°å›æº¯åˆ°æœ€è¿‘çš„é€‰æ‹©ç‚¹ï¼Œå»å°è¯•ä¸‹ä¸€ä¸ªå¯èƒ½æ€§ã€‚å¦‚æœå®ƒç”¨å®Œäº†æ‰€ä»¥çš„å¯èƒ½æ€§ï¼Œåˆ™è‡ªåŠ¨é€€å›åˆ°ä¸Šä¸€ä¸ªé€‰æ‹©ç‚¹ï¼Œå¹¶ä»é‚£é‡Œç»§ç»­ï¼ˆè¿™ä¸ªâ€œç»§ç»­â€å¾ˆæœ‰æ„æ€ï¼Œåæ–‡ä¼šçœ‹åˆ°ï¼Œâ€œç»§ç»­â€ä¸ä½†æ˜¯ç»“è®ºï¼Œè¿˜æ˜¯å…¶å®ç°çš„æ–¹å¼ï¼Œä¸€è¯­åŒå…³ï¼‰ä¸‹å»ã€‚ä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆ ç®—æ³•ã€‚\né€»è¾‘è°œé¢˜ åœ¨è®¨è®ºambæ±‚å€¼å™¨çš„å®ç°ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€é“é€»è¾‘è°œé¢˜ï¼š\næ›¹æ“ã€å­™æƒã€åˆ˜å¤‡ã€è¢ç»ã€é©¬è¶…5äººä½åœ¨ä¸€æ ‹5å±‚çš„æ¥¼æˆ¿é‡Œé¢ï¼Œæ¯äººä½ä¸€å±‚ã€‚æ›¹æ“ä¸ä½é¡¶å±‚ï¼Œå­™æƒä¸ä½åº•å±‚ï¼Œåˆ˜å¤‡ä¸ä½é¡¶å±‚ä¹Ÿä¸ä½åº•å±‚ï¼Œè¢ç»æ¯”åˆ˜å¤‡é«˜ä¸€å±‚ï¼Œé©¬è¶…ä¸åˆ˜å¤‡ä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œåˆ˜å¤‡ä¸å­™æƒä¹Ÿä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œè¯·é—®ä»–ä»¬å„ä½åœ¨å“ªä¸€å±‚ï¼Ÿ\nåœ¨æ²¡æœ‰ambæ—¶ï¼Œä»£ç æ€ä¹ˆå†™å‘¢ï¼Ÿææ€•ä¸å®¹æ˜“å§ã€‚ä½†æ˜¯ç°åœ¨æœ‰äº†ambæ±‚å€¼å™¨ï¼Œç¬é—´ç¾å¥½äº†ï¼š\n(define (multiple-dwelling) (let ( [caocao (amb 1 2 3 4 5)] [sunquan (amb 1 2 3 4 5)] [liubei (amb 1 2 3 4 5)] [yuanshao (amb 1 2 3 4 5)] [machao (amb 1 2 3 4 5)] ) (require (distinct? (list caocao sunquan liubei yuanshao machao))) (require (not (= caocao 5))) (require (not (= sunquan 1))) (require (not (= liubei 5))) (require (not (= liubei 1))) (require (\u0026gt; yuanshao liubei)) (require (not (= (abs (- machao liubei)) 1)) (require (not (= (abs (- sunquan liubei)) 1)) (list (list \u0026#39;caocao caocao) (list \u0026#39;sunquan sunquan) (list \u0026#39;liubei liubei) (list \u0026#39;yuanshao yuanshao) (list \u0026#39;machao machao)) ) ) ä¸Šè¿°ä»£ç åªæ˜¯æè¿°é—®é¢˜çš„å…³ç³»ï¼Œå³å„ä¸ªrequireéƒ¨åˆ†ï¼ˆå…ˆä¸è€ƒè™‘æ€§èƒ½é—®é¢˜ã€‚è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„â€œæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•â€å—ï¼Ÿï¼‰ï¼Œå¹¶æ²¡æœ‰æ·»åŠ ä»€ä¹ˆâ€œå¤„ç†é€»è¾‘â€ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿä¸‹é¢ç»“æœï¼š\n((caocao 3) (sunquan 2) (liubei 4) (yuanshao 5) (machao 1))\nå±…ç„¶å¾—åˆ°äº†è°œé¢˜çš„è§£ï¼Œè¿™æ˜¯ä»€ä¹ˆé­”æ³•ï¼Ÿï¼Ÿï¼Ÿ\nambè½»è€Œæ˜“ä¸¾åœ°è§£å†³äº†è¿™ç§éœ€è¦å¤§é‡å›æº¯çš„é—®é¢˜ã€‚\nå®ç° ç°åœ¨è¯¥è°ˆä¸€è°ˆç¥å¥‡çš„ambå¦‚ä½•å®ç°äº†å§ã€‚å‰æ–‡å·²ç»å¤šæ¬¡æåˆ°è¿‡ï¼Œambæ±‚å€¼çš„è¿‡ç¨‹å¯èƒ½ä¼šä¸æ–­çš„å›æº¯ï¼Œè¿™åŠ¿å¿…å¯¼è‡´ç¨‹åºæµç¨‹çš„è·³è½¬ï¼Œç¨‹åºè·³è½¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€å¯æ²¡æœ‰break,continueä¹‹ç±»çš„è¯­æ³•ï¼Œå› ä¸ºæ ¹æœ¬ä¸éœ€è¦ï¼Œé‚£ä¹ˆå‡½æ•°å¼è¯­è¨€æœ‰å•¥ï¼Ÿç­”æ¡ˆæ˜¯continuation(ç¿»è¯‘æˆç»§ç»­ï¼Œæˆ–è€…å»¶ç»­éƒ½å¯ä»¥ã€‚è¿˜è®°å¾—â€œä¸€è¯­åŒå…³â€å—ï¼Ÿ)\nSchemeå†…ç½®äº†è¿™ä¸ªå¼ºå¤§çš„æ§åˆ¶æŠ½è±¡ï¼Œè¿‡ç¨‹åä¸ºï¼šcall-with-current-continuationï¼Œ åå­—ç•¥é•¿ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯ç”¨å…¶ç¼©å†™ï¼šcall/ccã€‚å›¿äºç¯‡å¹…ï¼Œæœ¬æ–‡ä¸æ‰“ç®—ä»‹ç»continuationï¼Œå¦‚æœæƒ³è¯¦ç»†äº†è§£å®ƒï¼Œè¯·è‡ªè¡Œæœç´¢ã€‚\nå¸¸è§„æ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸€ä¸ªå‚æ•°ï¼šæ‰§è¡Œç¯å¢ƒenvã€‚ambæ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé™¤äº†æ‰§è¡Œç¯å¢ƒenvä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªcontinuationè¿‡ç¨‹ï¼ˆä¸€ä¸ªæˆåŠŸå»¶ç»­ã€ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼‰ã€‚å¯¹ä¸€ä¸ªè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œç»“æŸåä¼šè°ƒç”¨è¿™ä¸¤ä¸ªcontinuationè¿‡ç¨‹ä¹‹ä¸€ï¼šå¦‚æœæ­¤æ¬¡æ±‚å€¼å¾—åˆ°äº†ä¸€ä¸ªç»“æœï¼Œåˆ™è°ƒç”¨æˆåŠŸå»¶ç»­ï¼›å¦‚æœç»“æœæ˜¯é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™è°ƒç”¨å¤±è´¥å»¶ç»­ã€‚\næˆåŠŸå»¶ç»­çš„å·¥ä½œæ˜¯ï¼šæ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶å°†è®¡ç®—è¿›è¡Œå»ä¸‹ï¼Œä¸è¿™ä¸ªå€¼ä¸€èµ·ï¼ŒæˆåŠŸå»¶ç»­è¿‡ç¨‹è¿˜å°†å¾—åˆ°ä¸€ä¸ªå¦ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼Œå¦‚æœä½¿ç”¨è¯¥å€¼æ—¶é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™éœ€è¦è°ƒç”¨è¿™ä¸ªå¤±è´¥å»¶ç»­ã€‚\nå¤±è´¥å»¶ç»­çš„å·¥ä½œæ˜¯ï¼šè¯•æ¢éç¡®å®šæ€§è¿‡ç¨‹çš„å¦ä¸€ä¸ªåˆ†æ”¯ã€‚éç¡®å®šæ€§è®¡ç®—çš„æœ€å…³é”®çš„ç‰¹å¾ï¼Œåœ¨äºè¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºäºä¸åŒå¯èƒ½æ€§ä¹‹é—´çš„é€‰æ‹©ã€‚\næˆ‘æ‰¿è®¤æœ‰ç‚¹çƒ§è„‘ï¼Œä½†è¿˜ç®—æ¸…æ™°ï¼Œè®©é€’å½’åœ¨è„‘æµ·ä¸­å¥”æ¶Œå§ã€‚\nåˆ©ç”¨å®æ¥ç®€åŒ–ambçš„æ„é€ ï¼Œä»£ç å‚è€ƒè¿™é‡Œï¼š\n(define amb-fail \u0026#39;*) (define initialize-amb-fail (lambda () (set! amb-fail (lambda () (error \u0026#34;amb tree exhausted\u0026#34;))))) (initialize-amb-fail) (define-syntax amb (syntax-rules () ((amb alt ...) (let ((prev-amb-fail amb-fail)) ;ä¿å­˜å‰ä¸€ä¸ªé€‰æ‹©ç‚¹ (call/cc (lambda (sk) ;å¯¹äºæ•´ä¸ªambè¡¨è¾¾å¼æ„é€ ä¸€ä¸ªskçš„contnuation (call/cc (lambda (fk) ;å¯¹äºæ¯ä¸€ä¸ªambçš„é€‰é¡¹æ„é€ ä¸€ä¸ªfkçš„continuation (set! amb-fail ;å…ˆæŠŠamb-failè®¾ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯å°†amb-failæ¢å¤åˆ°è¿›å…¥ambå‰çš„å€¼ (lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) ) (sk alt) ;ç«‹å³è¿”å›è‡ªå·±çš„åˆ†æ”¯çš„å€¼,ä»è€Œå¼•èµ·ambè¡¨è¾¾å¼ä¸­é€”è¿”å›ã€‚æ³¨æ„ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œæ—¶éƒ½ä¼šå¼•èµ· amb ç«‹å³è¿”å›ã€‚åé¢çš„åˆ†æ”¯éƒ½è¿˜æ²¡æœ‰æ‰§è¡Œï¼ ) ) ... (prev-amb-fail) ) ) ) ) ) ) ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼ˆä¹Ÿå¯ä»¥å«åˆ†æ”¯ï¼‰ä¼šè¢«ç«‹å³è¿”å›ï¼Œåé¢çš„æš‚æ—¶ä¸æ‰§è¡Œã€‚å‡è®¾è¯¥å€¼è¢«è®¤ä¸ºæ˜¯â€œæ— æ•ˆçš„ï¼ˆæ¯”å¦‚åº”ç”¨è¯¥å€¼åï¼Œæ‰§è¡Œåˆ°(amb)äº†ï¼‰â€ï¼Œåˆ™æ‰§è¡Œ(prev-amb-fail)ï¼Œè€Œprev-amb-failåœ¨è¿›å…¥ambçš„æ—¶å€™è¢«ç»‘å®šåˆ°äº†amb-failï¼Œ ä¸è¿‡amb-failå·²è¢«è®¾ç½®æˆäº†ä¸€ä¸ªå‡½æ•°ï¼š\n(lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) å®ƒå…ˆæŠŠamb-failè®¾ç½®æˆprev-amb-fail,ä¹Ÿå°±æ˜¯è¿›å…¥ï¼ˆamb alt \u0026hellip;ï¼‰ä¹‹å‰çš„å€¼ï¼Œ ç„¶åç”¨(fk \u0026lsquo;fail)è¿”å›\u0026rsquo;failåˆ°åˆ†æ”¯çš„continuationï¼Œå³å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯ï¼ˆä¸‹ä¸€ä¸ªé€‰é¡¹ï¼‰äº†ã€‚\nååˆ†ç²¾å·§çš„ç¨‹åºï¼ï¼ï¼\nä¸Šè¿°çš„ambæ¯æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå¦‚æœéœ€è¦è¿”å›æ‰€æœ‰æœ‰æ•ˆçš„ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢å®šä¹‰çš„å®ï¼š\n(define-syntax bag-of (syntax-rules () ((bag-of e) (let ((prev-amb-fail amb-fail) (results \u0026#39;())) (if (call/cc (lambda (k) (set! amb-fail (lambda () (k #f))) ;\u0026lt;-----+ (let ((v e)) ;amb-fail will be modified by e | (set! results (cons v results)) ;| (k #t)))) ;| (amb-fail)) ;so this amb-fail may not be ---+ (set! amb-fail prev-amb-fail) (reverse! results))))) (bag-of (let ([a (amb 1 2 3)] [b (amb 0 -1 2)]) (if (= (+ a b) 1) (list a b) (amb)) )) ;ç»“æœä¸ºï¼š((1 0) (2 -1)) å›åˆ°n-çš‡åé—®é¢˜ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å·²æ‰‹æ¡ambè¿™æŠŠåˆ©å™¨ï¼Œæ˜¯æ—¶å€™é‡æ„ä¸€ä¸‹n-çš‡åé—®é¢˜äº†ã€‚\n(define number-between (lambda (lo hi) (let loop ((i lo)) (if (\u0026gt; i hi) (amb) (amb i (loop (+ i 1))))))) ; (amb 1 (amb 2 (amb 3 ... ))) (define (n-queens n) (call/cc (lambda (return) (let add-queen ([i 0] [result \u0026#39;()]) (when (\u0026lt; i n) ;æœ€å¤šæ‘†å‡ ä¸ªçš‡å (let ([new-queen (number-between 1 n)]) (if (safe? n (append (list new-queen) result)) ;æ–°åŠ å…¥çš„çš‡åå¿…é¡»æ˜¯æœ‰æ•ˆçš„ (add-queen (+ i 1) (append (list new-queen) result)) (amb)) ) ) (return result) ) ) ) ) (bag-of (n-queens 8)) ;8ä¸ªçš‡åçš„æ‰€æœ‰è§£ è¯¥ç‰ˆæœ¬æ¯”ä¹‹å‰çš„Schemeç‰ˆæœ¬çš„å®ç°æ”¹è¿›äº†å¾ˆå¤šï¼Œç°åœ¨åªéœ€è¦æè¿°ä¸€ä¸‹æˆ‘çš„é—®é¢˜çš„å…³ç³»å³å¯ï¼Œç¨‹åºä¼šè‡ªåŠ¨é€‰æ‹©æ‰€æœ‰æ­£ç¡®çš„å€¼ï¼Œæ— éœ€å…³å¿ƒè®¡ç®—æœºå†…éƒ¨åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨é¢å¯¹å¾ˆå¤šé€»è¾‘é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°è§£å†³äº†ã€‚\nä¹Ÿè®¸æœ‰äººä¼šé—®ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼è¯­è¨€æ¥å¤„ç†çš„è¯ï¼Œå¯èƒ½å‡ ä¸ªåµŒå¥—çš„å¾ªç¯ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœï¼Œå¦‚æ­¤å¤§è´¹å‘¨ç« çš„ä»‹ç»è¿™ä¸ªå«ambçš„æŠ€æœ¯ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆä»·å€¼å‘¢ï¼Ÿ é‚£å°±æ¥èŠä¸€èŠã€‚\næœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ åœ¨è°ˆè®ºæ„ä¹‰ä¹‹å‰ï¼Œå®¹è®¸æˆ‘æä¸€ä¸ªé—®é¢˜\nä¸ºä»€ä¹ˆSQLè¯­è¨€è¦è®¾è®¡æˆè¿™æ ·ï¼Ÿä¸å‘½ä»¤å¼è¯­è¨€å¦‚æ­¤çš„ä¸åŒï¼Ÿ\né¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè®¡ç®—æœºç§‘å­¦å¤„ç†çš„æ˜¯å‘½ä»¤å¼ï¼ˆæ€æ ·åšï¼‰çš„çŸ¥è¯†ï¼Œè€Œæ•°å­¦å¤„ç†çš„æ˜¯è¯´æ˜å¼ï¼ˆæ˜¯ä»€ä¹ˆï¼‰çš„çŸ¥è¯†ã€‚ äº‹å®ä¸Šï¼Œäººç±»ä¸å¯èƒ½åªé¢ä¸´å…¶ä¸­ä¸€ç§é—®é¢˜ï¼Œç¨‹åºè®¾è®¡ä¸­ä¸€ä¸ªé‡è¦çš„åˆ†æ”¯å°±æ˜¯é€»è¾‘ç¨‹åºè®¾è®¡ï¼Œæœ‰å¾ˆå¤šé—®é¢˜æˆ–è€…æ•°æ®ä¹‹é—´å­˜åœ¨ç€å…³è”å…³ç³»ï¼Œéš¾ä»¥è§‚æµ‹åˆ°ç»“è®ºï¼Œæè¿°å®ƒä»¬çš„å…³ç³»å¾ˆç®€å•ï¼Œä½†æ˜¯ç›´æ¥å‘Šè¯‰è®¡ç®—æœºå¦‚ä½•å»åšå´ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥ä¸ºè‹¥å¹²æ­¤ç±»é—®é¢˜ç¼–å†™å‘½ä»¤å¼ä»£ç ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ‰€æœ‰è¿™æ ·çš„é—®é¢˜éƒ½ç¼–å†™ä»£ç ï¼Œæ˜¾ç„¶ä¿¡æ¯ä¹‹é—´çš„å…³ç³»æ˜¯å¤šç§å¤šæ ·çš„ï¼Œé‚£ä¹ˆä»£ç å°±éœ€è¦ç›¸åº”çš„å˜åŒ–ï¼Œå¾€å¾€ä¿®æ”¹è¿™æ ·çš„ä»£ç æ˜¯å¾ˆå›°éš¾çš„ï¼Œ ç”šè‡³éœ€è¦é‡æ–°è®¾è®¡å¹¶ç¼–ç ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç¨‹åºè®¾è®¡å¯ä»¥å¤„ç†è¯´æ˜å¼çš„çŸ¥è¯†ï¼Œå²‚ä¸æ˜¯å¤§å¤§å‡è½»äº†ç¨‹åºå‘˜çš„å·¥ä½œäº†å‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€çš„è®¾è®¡æ˜¯åŸºäºlambdaç†è®ºï¼Œå›´ç»•ç€æ•°å­¦å‡½æ•°å€¼çš„è®¡ç®—ç»„ç»‡èµ·æ¥çš„ï¼Œä¾é å…¶å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œåœ¨å¤„ç†é€»è¾‘é—®é¢˜ä¸Šæ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼Œå¯ä»¥åŒ–ç¹ä¸ºç®€ã€‚\nè¯´åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ï¼Œä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ä¹‹é—´å­˜åœ¨ç€ç§ç§è”ç³»å‘¢ï¼ŸSQLæ­£æ˜¯æè¿°äº†è¿™ç§å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰æ•°æ®åº“æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ•°æ®ï¼ˆselectï¼‰, æ•°æ®åœ¨ä»€ä¹ˆä½ç½®ï¼ˆfromï¼‰, å“ªäº›æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆwhereï¼‰å°±è¡Œäº†ï¼Œå¹¶ä¸éœ€è¦å‘Šè¯‰æ•°æ®åº“è¯¥å¦‚ä½•å…·ä½“æ“ä½œï¼Œæ•°æ®åº“å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„æè¿°ï¼ˆSQLï¼‰å°±èƒ½å¤Ÿå‡†ç¡®çš„è¿”å›ç»“æœï¼Œè¿™çœŸæ˜¯å…³äºéç¡®å®šæ€§è®¡ç®—çš„ä¸€ä¸ªæå¥½çš„ä¾‹å­ï¼Œæ­¤æ—¶æˆ‘ä»¬æ€»è¯¥æ˜ç™½ä¸ºä»€ä¹ˆæ•°æ®åº“å«åšå…³ç³»å‹æ•°æ®åº“ äº†å§ã€‚æˆ‘ä»¬ä¸å¦¨è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸é‡‡ç”¨æè¿°çš„æ–¹å¼æ¥æŸ¥è¯¢æ•°æ®ï¼Œç¨‹åºå‘˜ä»¬è¯¥æ€ä¹ˆåšï¼Ÿè¿˜èƒ½å¤Ÿè½»æ˜“çš„æŸ¥æ‰¾åˆ°éœ€è¦çš„æ•°æ®å—ï¼Ÿ\nåˆšæ‰æˆ‘æå‡ºçš„é—®é¢˜ï¼Œæƒ³å¿…æ­¤åˆ»åº”è¯¥æœ‰ç­”æ¡ˆäº†ã€‚\n","id":88,"section":"posts","summary":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡º","tags":["scheme"],"title":"ä»â€œå…«çš‡åâ€åˆ°amb","uri":"https://lvsq.net/2020/05/n-queens/","year":"2020"},{"content":" ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah\nä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°å…¶ä»–è¯­è¨€ 2ï¼‰ç”¨äºæ„å»ºå¯ä¼¸ç¼©å’Œå¼¹æ€§å¹¶å‘ç³»ç»Ÿçš„OTPåº“å’Œä¸­é—´ä»¶ï¼Œä»¥åŠ 3ï¼‰ä¸è¯­è¨€è¯­ä¹‰ç´§å¯†è€¦åˆçš„BEAMè™šæ‹Ÿæœºå’ŒOTPã€‚\nå•ç‹¬ä½¿ç”¨è¿™äº›ç»„ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨å°†è·å¾—äºšå†›ã€‚ä½†æ˜¯ï¼Œå°†è¿™ä¸‰ä¸ªå› ç´ æ”¾åœ¨ä¸€èµ·ï¼Œæ‚¨å°†è·å¾—å¯ä¼¸ç¼©ï¼Œçµæ´»çš„è½¯å®æ—¶ç³»ç»Ÿçš„æ— å¯äº‰è®®çš„èµ¢å®¶ã€‚å¼•ç”¨Joe Armstrongçš„è¯ï¼šâ€œæ‚¨å¯ä»¥å¤åˆ¶Erlangåº“ï¼Œä½†æ˜¯å¦‚æœå®ƒä¸èƒ½åœ¨BEAMä¸Šè¿è¡Œï¼Œåˆ™æ— æ³•æ¨¡æ‹Ÿè¯­ä¹‰â€ã€‚è¿™æ˜¯ç”±ç½—ä¼¯ç‰¹Â·ç»´å°”ä¸ï¼ˆRobert Virdingï¼‰çš„ã€Šç¬¬ä¸€æ¡ç¼–ç¨‹è§„åˆ™ã€‹å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œè¯¥æ¡è§„å®šï¼šâ€œä»»ä½•å¦ä¸€ç§è¶³å¤Ÿå¤æ‚çš„å¹¶å‘ç¨‹åºéƒ½ä½¿ç”¨å¦ä¸€ç§è¯­è¨€ï¼ŒåŒ…å«éæ­£å¼çš„ï¼Œä¸´æ—¶æŒ‡å®šçš„ï¼Œbugç¼ èº«çš„ç¼“æ…¢çš„Erlangä¸€åŠå®ç°ã€‚â€\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æƒ³æ¢ç´¢BEAM VMå†…éƒ¨ã€‚æˆ‘ä»¬å°†åœ¨é€‚ç”¨çš„æƒ…å†µä¸‹å°†å®ƒä»¬ä¸JVMè¿›è¡Œæ¯”è¾ƒå’Œå¯¹æ¯”ï¼Œå¼ºè°ƒæ‚¨ä¸ºä»€ä¹ˆè¦æ³¨æ„å®ƒä»¬å¹¶åŠ ä»¥æ³¨æ„ã€‚é•¿æœŸä»¥æ¥ï¼Œæ­¤ç»„ä»¶ä¸€ç›´è¢«è§†ä¸ºé»‘åŒ£å­ï¼Œå¹¶ä¸”åœ¨ä¸äº†è§£åŸå› æˆ–å«ä¹‰çš„æƒ…å†µä¸‹è¢«è§†ä¸ºç†æ‰€å½“ç„¶ã€‚ç°åœ¨è¯¥æ”¹å˜è¿™ç§æƒ…å†µäº†ï¼\nBEAMçš„äº®ç‚¹ å‘æ˜Erlangå’ŒBEAM VMæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„æ­£ç¡®å·¥å…·ã€‚å®ƒä»¬æ˜¯ç”±çˆ±ç«‹ä¿¡å¼€å‘çš„ï¼Œæ—¨åœ¨å¸®åŠ©å®ç°å¤„ç†ç§»åŠ¨å’Œå›ºå®šç½‘ç»œçš„ç”µä¿¡åŸºç¡€è®¾æ–½ã€‚è¯¥åŸºç¡€æ¶æ„æœ¬è´¨ä¸Šæ˜¯é«˜åº¦å¹¶å‘å’Œå¯ä¼¸ç¼©çš„ã€‚å®ƒå¿…é¡»æ˜¾ç¤ºè½¯å®æ—¶å±æ€§ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ã€‚æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ‰‹æœºä¸Šä¸ç¥–æ¯è¿›è¡Œç¯èŠé€šè¯æ—¶æ‰çº¿æˆ–Fortniteçš„åœ¨çº¿æ¸¸æˆä½“éªŒä¸ä¼šå—åˆ°ç³»ç»Ÿå‡çº§ï¼Œé«˜ç”¨æˆ·è´Ÿè½½æˆ–è½¯ä»¶ï¼Œç¡¬ä»¶å’Œç½‘ç»œä¸­æ–­çš„å½±å“ã€‚BEAM VMé€šè¿‡æä¾›å¯åœ¨å¯é¢„æµ‹çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¹‹ä¸Šè¿è¡Œçš„å¾®è°ƒåŠŸèƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥è§£å†³è®¸å¤šæŒ‘æˆ˜ã€‚\nå®ƒçš„ç§˜è¯€æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œå®ƒä»¬ä¸å…±äº«å†…å­˜ï¼Œç”±è°ƒåº¦ç¨‹åºç®¡ç†ï¼Œè¯¥è°ƒåº¦ç¨‹åºå¯ä»¥è·¨å¤šä¸ªå†…æ ¸ç®¡ç†æ•°ç™¾ä¸‡ä¸ªè¿›ç¨‹ã€‚å®ƒä½¿ç”¨åŸºäºæ¯ä¸ªè¿›ç¨‹è¿è¡Œçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ä»¥å‡å°‘å¯¹å…¶ä»–è¿›ç¨‹çš„å½±å“ã€‚ç»“æœï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“è½¯å®æ—¶å±æ€§ã€‚BEAMä¹Ÿæ˜¯å”¯ä¸€ä½¿ç”¨è§„æ¨¡å¹¿æ³›ä¸”å…·æœ‰å†…ç½®åˆ†å‘æ¨¡å‹çš„VMï¼Œå®ƒå…·æœ‰å†…ç½®çš„åˆ†å‘æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…è®¸ç¨‹åºé€æ˜åœ°åœ¨å¤šå°è®¡ç®—æœºä¸Šè¿è¡Œã€‚\nJVMçš„äº®ç‚¹ Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æ˜¯â€‹â€‹ç”±Sun Microsystemå¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¯åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„â€œä¸€æ¬¡å†™å…¥â€ä»£ç çš„å¹³å°ã€‚ä»–ä»¬åˆ›å»ºäº†ä¸€ç§ç±»ä¼¼äºC++çš„é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æ˜¯å†…å­˜å®‰å…¨ï¼Œå› ä¸ºå…¶è¿è¡Œæ—¶é”™è¯¯æ£€æµ‹ä¼šæ£€æŸ¥æ•°ç»„èŒƒå›´å’ŒæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚åœ¨Internetæ—¶ä»£ï¼ŒJVMç”Ÿæ€ç³»ç»Ÿå˜å¾—éå¸¸æµè¡Œï¼Œä½¿å…¶æˆä¸ºä¼ä¸šæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®é™…æ ‡å‡†ã€‚æ»¡è¶³å¹¿æ³›ç”¨ä¾‹çš„è™šæ‹Ÿæœºå’Œå¯æ»¡è¶³ä¼ä¸šå‘å±•éœ€æ±‚çš„ä»¤äººå°è±¡æ·±åˆ»çš„åº“é›†ä½¿å¹¿æ³›çš„é€‚ç”¨æ€§æˆä¸ºå¯èƒ½ã€‚\nJVMè®¾è®¡æ—¶è€ƒè™‘äº†æ•ˆç‡ã€‚å®ƒçš„å¤§å¤šæ•°æ¦‚å¿µæ˜¯æµè¡Œæ“ä½œç³»ç»Ÿä¸­åŠŸèƒ½çš„æŠ½è±¡ï¼Œä¾‹å¦‚æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„çº¿ç¨‹æ¨¡å‹ã€‚JVMæ˜¯é«˜åº¦å¯å®šåˆ¶çš„ï¼ŒåŒ…æ‹¬åƒåœ¾æ”¶é›†å™¨ï¼ˆGCï¼‰å’Œç±»åŠ è½½å™¨ã€‚ä¸€äº›æœ€å…ˆè¿›çš„GCå®ç°æä¾›é«˜åº¦å¯è°ƒæ•´çš„åŠŸèƒ½ï¼Œä»¥é€‚åº”åŸºäºå…±äº«å†…å­˜çš„ç¼–ç¨‹æ¨¡å‹ã€‚JVMå…è®¸æ‚¨åœ¨ç¨‹åºè¿è¡Œæ—¶æ›´æ”¹ä»£ç ã€‚è€Œä¸”ï¼ŒJITç¼–è¯‘å™¨å…è®¸å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬æœºä»£ç ï¼Œç›®çš„æ˜¯åŠ å¿«åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†ã€‚\nJavaä¸–ç•Œä¸­çš„å¹¶å‘æ€§ä¸»è¦ä¸åœ¨å¹¶è¡Œçº¿ç¨‹ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæœ‰å…³ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ˜¯å¿«é€Ÿçš„ã€‚ç”±äºå¹¶å‘åŸè¯­çš„å…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå› æ­¤ä½¿ç”¨å¹¶å‘åŸè¯­è¿›è¡Œç¼–ç¨‹æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ï¼Œäººä»¬å°è¯•ç®€åŒ–å’Œç»Ÿä¸€å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œæœ€æˆåŠŸçš„å°è¯•æ˜¯Akkaæ¡†æ¶ã€‚\nå¹¶å‘ä¸å¹¶è¡Œ å¦‚æœéƒ¨åˆ†ä»£ç åœ¨å¤šä¸ªå†…æ ¸ï¼Œå¤„ç†å™¨æˆ–è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œï¼Œåˆ™æˆ‘ä»¬è°ˆè®ºå¹¶è¡Œä»£ç æ‰§è¡Œï¼Œè€Œå¹¶å‘ç¼–ç¨‹æ˜¯æŒ‡ç‹¬ç«‹å¤„ç†åˆ°è¾¾ç³»ç»Ÿçš„äº‹ä»¶ã€‚å¯ä»¥åœ¨å•çº¿ç¨‹ç¡¬ä»¶ä¸Šæ¨¡æ‹Ÿå¹¶å‘æ‰§è¡Œï¼Œè€Œå¹¶è¡Œæ‰§è¡Œåˆ™ä¸èƒ½ã€‚å°½ç®¡è¿™ç§åŒºåˆ«ä¼¼ä¹å¾ˆå¤æ€ªï¼Œä½†è¿™ç§å·®å¼‚å¯¼è‡´éœ€è¦è§£å†³çš„é—®é¢˜éå¸¸ä¸åŒã€‚æƒ³æƒ³å¾ˆå¤šå¨å¸ˆåœ¨åšä¸€ç›˜Carbonaraæ„å¤§åˆ©é¢ã€‚åœ¨å¹¶è¡Œæ–¹æ³•ä¸­ï¼Œå°†ä»»åŠ¡åˆ†é…ç»™å¯ç”¨å¨å¸ˆçš„æ•°é‡ï¼Œå¹¶ä¸”åªè¦å®Œæˆè¿™äº›å¨å¸ˆå®Œæˆå…¶ç‰¹å®šä»»åŠ¡çš„é€Ÿåº¦ï¼Œå°±å¯ä»¥å®Œæˆå•ä¸ªéƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ªå¹¶å‘çš„ä¸–ç•Œä¸­ï¼Œæ¯ä½å¨å¸ˆå°†è·å¾—ä¸€éƒ¨åˆ†ï¼Œæ¯ä½å¨å¸ˆå°†å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚æ‚¨å°†å¹¶è¡Œæ€§ç”¨äºé€Ÿåº¦ï¼Œå¹¶å‘æ€§ç”¨äºè§„æ¨¡ã€‚\nå¹¶è¡Œæ‰§è¡Œè¯•å›¾å°†é—®é¢˜çš„æœ€ä½³åˆ†è§£è§£å†³ä¸ºå½¼æ­¤ç‹¬ç«‹çš„éƒ¨åˆ†ã€‚å°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ï¼Œç‚¸ç“œé‡Œé˜¿å¡ç«è…¿ï¼Œå°†ä½©å…‹ç«‹è¯ºå¥¶é…ªç£¨ç¢1ã€‚å…±äº«æ•°æ®ï¼ˆæˆ–åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºé¤ç›˜ï¼‰ç”±é”ï¼Œäº’æ–¥é”å’Œå„ç§å…¶ä»–æŠ€æœ¯å¤„ç†ï¼Œä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å¦ä¸€ç§çœ‹å¾…è¿™ç§æƒ…å†µçš„æ–¹å¼æ˜¯å­˜åœ¨æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åˆ©ç”¨å°½å¯èƒ½å¤šçš„å¹¶è¡ŒCPUèµ„æºæ¥å°½å¿«å®Œæˆå·¥ä½œã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¹¶â€‹â€‹å‘ç¼–ç¨‹å¤„ç†è®¸å¤šäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶åœ¨ä¸åŒçš„æ—¶é—´åˆ°è¾¾ç³»ç»Ÿï¼Œå¹¶å°è¯•åœ¨åˆç†çš„æ—¶é—´å†…å¤„ç†æ‰€æœ‰äº‹ä»¶ã€‚åœ¨å¤šæ ¸æˆ–åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸Šï¼ŒæŸäº›æ‰§è¡Œæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚å¦ä¸€ç§çœ‹å¾…å®ƒçš„æ–¹æ³•æ˜¯ï¼ŒåŒä¸€ä½å¨å¸ˆæŒ‰ç…§å§‹ç»ˆç›¸åŒçš„é¡ºåºç®—æ³•ï¼Œå°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ç­‰ã€‚è·¨è¿‡ç¨‹ï¼ˆæˆ–åšé¥­ï¼‰çš„å˜åŒ–æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œè¿™äº›æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰å­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸­ã€‚\nJVMæ˜¯ä¸ºå¹¶è¡Œè€Œæ„å»ºçš„ï¼Œè€ŒBEAMæ˜¯ä¸ºå¹¶å‘æ„å»ºçš„ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªæœ¬è´¨ä¸Šä¸åŒçš„é—®é¢˜ï¼Œéœ€è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚\nBEAMå’Œå¹¶å‘ BEAMæä¾›è½»é‡çº§æµç¨‹ä¸ºæ­£åœ¨è¿è¡Œçš„ä»£ç æä¾›ä¸Šä¸‹æ–‡ã€‚è¿™äº›è¿›ç¨‹ä¹Ÿç§°ä¸ºactorï¼Œä¸å…±äº«å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œå°†æ•°æ®ä»ä¸€ä¸ªè¿›ç¨‹å¤åˆ¶åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯è™šæ‹Ÿæœºé€šè¿‡å„ä¸ªè¿›ç¨‹æ‹¥æœ‰çš„é‚®ç®±å®ç°çš„åŠŸèƒ½ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯ä¸€ç§éé˜»å¡æ“ä½œï¼Œè¿™æ„å‘³ç€å°†æ¶ˆæ¯å‘é€åˆ°å¦ä¸€ä¸ªè¿›ç¨‹å‡ ä¹æ˜¯å³æ—¶çš„ï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡å‘é€è€…çš„æ‰§è¡Œã€‚å‘é€çš„æ¶ˆæ¯é‡‡ç”¨ä¸å¯å˜æ•°æ®çš„å½¢å¼ï¼Œä»å‘é€è¿‡ç¨‹çš„å †æ ˆå¤åˆ¶åˆ°æ¥æ”¶è€…çš„é‚®ç®±ã€‚æ— éœ€åœ¨è¿›ç¨‹ä¹‹é—´ä½¿ç”¨é”å’Œäº’æ–¥é”å³å¯å®ç°æ­¤ç›®çš„ï¼Œè€Œåœ¨å¤šä¸ªè¿›ç¨‹å¹¶è¡Œå°†æ¶ˆæ¯å‘é€åˆ°åŒä¸€æ”¶ä»¶äººçš„æƒ…å†µä¸‹ï¼Œåªéœ€å¯¹é‚®ç®±è¿›è¡Œé”å®šå³å¯ã€‚\nä¸å˜çš„æ•°æ®å’Œæ¶ˆæ¯ä¼ é€’ä½¿ç¨‹åºå‘˜èƒ½å¤Ÿç¼–å†™å½¼æ­¤ç‹¬ç«‹å·¥ä½œçš„æµç¨‹ï¼Œå¹¶ä¸“æ³¨äºåŠŸèƒ½è€Œä¸æ˜¯å†…å­˜çš„ä½çº§ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ã€‚äº‹å®è¯æ˜ï¼Œè¿™ç§ç®€å•çš„è®¾è®¡ä¸ä»…é€‚ç”¨äºå•ä¸ªçº¿ç¨‹ï¼Œè€Œä¸”é€‚ç”¨äºåœ¨åŒä¸€VMä¸­è¿è¡Œçš„æœ¬åœ°è®¡ç®—æœºä¸Šçš„å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„åˆ†å‘ï¼Œåœ¨æ•´ä¸ªç½‘ç»œä¸Šé€šè¿‡VMå’Œè®¡ç®—æœºé›†ç¾¤è¿è¡Œã€‚å¦‚æœæ¶ˆæ¯åœ¨è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å¯å˜çš„ï¼Œåˆ™å¯ä»¥ä¸åŠ é”åœ°å°†å®ƒä»¬å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–è®¡ç®—æœºï¼‰ï¼Œä»è€Œåœ¨åˆ†å¸ƒå¼å¤šæ ¸ä½“ç³»ç»“æ„ä¸Šå‡ ä¹çº¿æ€§åœ°æ‰©å±•ã€‚è¿›ç¨‹åœ¨æœ¬åœ°VMä¸Šçš„å¯»å€æ–¹å¼ä¸VMç¾¤é›†ä¸­çš„å¯»å€æ–¹å¼ç›¸åŒï¼Œæ— è®ºæ¥æ”¶è¿›ç¨‹çš„ä½ç½®å¦‚ä½•ï¼Œæ¶ˆæ¯å‘é€éƒ½æ˜¯é€æ˜çš„ã€‚\nè¿›ç¨‹ä¸å…±äº«å†…å­˜ï¼Œå› æ­¤æ‚¨å¯ä»¥å¤åˆ¶æ•°æ®ä»¥æ¢å¤å¼¹æ€§å¹¶åˆ†å‘æ•°æ®ä»¥å®ç°è§„æ¨¡æ‰©å±•ã€‚è¿™æ„å‘³ç€åœ¨ä¸¤ä¸ªä¸åŒçš„æœºå™¨ä¸Šå…·æœ‰ç›¸åŒè¿›ç¨‹çš„ä¸¤ä¸ªå®ä¾‹ï¼Œå½¼æ­¤ä¹‹é—´å…±äº«çŠ¶æ€æ›´æ–°ã€‚å¦‚æœä¸€å°è®¡ç®—æœºå‘ç”Ÿæ•…éšœï¼Œåˆ™å¦ä¸€å°è®¡ç®—æœºå…·æœ‰æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç»§ç»­å¤„ç†è¯¥è¯·æ±‚ï¼Œä»è€Œä½¿ç³»ç»Ÿå…·æœ‰å®¹é”™èƒ½åŠ›ã€‚å¦‚æœä¸¤å°è®¡ç®—æœºéƒ½å¯è¿è¡Œï¼Œåˆ™ä¸¤ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä»è€Œä¸ºæ‚¨æä¾›å¯ä¼¸ç¼©æ€§ã€‚BEAMä¸ºæ‰€æœ‰è¿™äº›æ— ç¼é›†æˆæä¾›äº†é«˜åº¦ä¼˜åŒ–çš„åŸè¯­ï¼Œè€ŒOTPï¼ˆâ€œæ ‡å‡†åº“â€ï¼‰åˆ™æä¾›äº†æ›´é«˜çº§åˆ«çš„ç»“æ„ä»¥ç®€åŒ–ç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚\nAkkaåœ¨å¤åˆ¶æ›´é«˜çº§åˆ«çš„ç»“æ„æ–¹é¢åšå¾—å¾ˆå¥½ï¼Œä½†æ˜¯ç”±äºç¼ºå°‘JVMæä¾›çš„åŸè¯­è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå—åˆ°äº†é™åˆ¶ï¼Œä»è€Œä½¿å…¶å¯ä»¥é«˜åº¦ä¼˜åŒ–å¹¶å‘æ€§ã€‚å°½ç®¡JVMçš„åŸè¯­æ”¯æŒæ›´å¹¿æ³›çš„ç”¨ä¾‹ï¼Œä½†ç”±äºå®ƒä»¬æ²¡æœ‰ç”¨äºé€šä¿¡çš„å†…ç½®åŸè¯­ä¸”é€šå¸¸åŸºäºå…±äº«å†…å­˜æ¨¡å‹ï¼Œå› æ­¤å®ƒä»¬ä½¿å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¼–ç¨‹å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¾‹å¦‚ï¼Œæ‚¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä½•å¤„æ”¾ç½®å…±äº«å†…å­˜ï¼Ÿä»¥åŠè®¿é—®å®ƒçš„æˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ\nè°ƒåº¦å™¨ æˆ‘ä»¬æåˆ°è¿‡ï¼ŒBEAMçš„æœ€å¼ºåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿå°†ç¨‹åºåˆ†è§£ä¸ºå°çš„ï¼Œè½»é‡çº§çš„è¿‡ç¨‹ã€‚ç®¡ç†è¿™äº›è¿‡ç¨‹æ˜¯è°ƒåº¦ç¨‹åºçš„ä»»åŠ¡ã€‚ä¸JVMå°†å…¶çº¿ç¨‹æ˜ å°„åˆ°OSçº¿ç¨‹å¹¶è®©æ“ä½œç³»ç»Ÿè°ƒåº¦å®ƒä»¬ä¸åŒï¼ŒBEAMå¸¦æœ‰è‡ªå·±çš„è°ƒåº¦ç¨‹åºã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç¨‹åºä¸ºæ¯ä¸ªå†…æ ¸å¯åŠ¨ä¸€ä¸ªOSçº¿ç¨‹ï¼Œå¹¶ä¼˜åŒ–å®ƒä»¬ä¹‹é—´çš„å·¥ä½œè´Ÿè½½ã€‚æ¯ä¸ªè¿‡ç¨‹éƒ½åŒ…å«è¦æ‰§è¡Œçš„ä»£ç å’Œéšæ—¶é—´å˜åŒ–çš„çŠ¶æ€ã€‚è°ƒåº¦ç¨‹åºä¼šé€‰æ‹©è¿è¡Œé˜Ÿåˆ—ä¸­å‡†å¤‡è¿è¡Œçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºå…¶èµ‹äºˆå®šé‡çš„reductionsï¼ˆè¯‘è€…æ³¨ï¼š2000ä¸ªï¼‰ï¼Œå…¶ä¸­æ¯æ¬¡reductionéƒ½å¤§è‡´ç­‰åŒäºä¸€æ¡æŒ‡ä»¤ã€‚ä¸€æ—¦è¿›ç¨‹ç”¨å°½äº†reductionsï¼Œä¼šè¢«I/Oé˜»å¡ï¼Œç­‰å¾…æ¶ˆæ¯æˆ–ä»£ç å®Œæˆï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šåœ¨è¿è¡Œé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹å¹¶å°†å…¶åˆ†æ´¾ï¼ˆæ­¤å¥ç¿»è¯‘æœ‰é—®é¢˜ï¼šåŸæ–‡æ˜¯Once the process has either run out of reductions, is blocked by I/O, is waiting for a message or completes executing its code, the scheduler picks the next process in the run queue and dispatches it. å¦‚æœæ‚¨æœ‰æ›´å¥½çš„ç¿»è¯‘è¯·ä¸åæŒ‡æ•™ï¼‰ã€‚è¿™ç§è°ƒåº¦æŠ€æœ¯ç§°ä¸ºæŠ¢å…ˆå¼ã€‚\næˆ‘ä»¬å¤šæ¬¡æåˆ°Akkaæ¡†æ¶ï¼Œå› ä¸ºå®ƒçš„æœ€å¤§ç¼ºç‚¹æ˜¯éœ€è¦åœ¨è°ƒåº¦å¤„æ·»åŠ æ³¨è§£ï¼Œå› ä¸ºè°ƒåº¦ä¸æ˜¯åœ¨JVMçº§åˆ«è¿›è¡Œçš„ã€‚é€šè¿‡è§£é™¤ç¨‹åºå‘˜çš„æ§åˆ¶ï¼Œå¯ä»¥ä¿ç•™å’Œä¿è¯è½¯å®æ—¶å±æ€§ï¼Œä»è€Œå‡ä½äº†å¯¼è‡´è¿›ç¨‹é¥¿æ­»çš„é£é™©ã€‚\nè¿›ç¨‹å›´ç»•ç€è°ƒåº¦ç¨‹åºçº¿ç¨‹ï¼Œå¹¶æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨CPUã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è°ƒæ•´è°ƒåº¦ç¨‹åºï¼Œä½†æ˜¯å®ƒå¾ˆå°‘è§ï¼Œä»…åœ¨è¾¹ç¼˜å’Œè¾¹ç•Œæƒ…å†µä¸‹æ‰éœ€è¦ï¼Œå› ä¸ºé»˜è®¤é€‰é¡¹æ¶µç›–äº†å¤§å¤šæ•°ä½¿ç”¨æ¨¡å¼ã€‚\nå…³äºè°ƒåº¦ç¨‹åºï¼Œç»å¸¸å‡ºç°ä¸€ä¸ªæ•æ„Ÿçš„è¯é¢˜ï¼šå¦‚ä½•å¤„ç†æœ¬æœºå®ç°çš„å‡½æ•°ï¼ˆNIFï¼‰ã€‚NIFæ˜¯ç”¨Cç¼–å†™çš„ä»£ç ç‰‡æ®µï¼Œè¢«ç¼–è¯‘ä¸ºåº“å¹¶åœ¨ä¸BEAMç›¸åŒçš„å†…å­˜ç©ºé—´ä¸­è¿è¡Œä»¥æé«˜é€Ÿåº¦ã€‚NIFçš„é—®é¢˜åœ¨äºå®ƒä»¬ä¸æ˜¯æŠ¢å å¼çš„ï¼Œå¹¶ä¸”ä¼šå½±å“è°ƒåº¦ç¨‹åºã€‚åœ¨æœ€æ–°çš„BEAMç‰ˆæœ¬ä¸­ï¼Œæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå³è„è°ƒåº¦ç¨‹åºï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶NIFã€‚è‚®è„çš„è°ƒåº¦ç¨‹åºæ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œçš„å•ç‹¬çš„è°ƒåº¦ç¨‹åºï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘NIFå¯¹ç³»ç»Ÿé€ æˆçš„ä¸­æ–­ã€‚è„è¿™ä¸ªè¯æ˜¯æŒ‡è¿™äº›è°ƒåº¦ç¨‹åºè¿è¡Œçš„ä»£ç çš„æ€§è´¨ã€‚\nåƒåœ¾æ”¶é›†å™¨ å½“ä»Šï¼Œç°ä»£çš„é«˜çº§ç¼–ç¨‹è¯­è¨€å¤§å¤šä½¿ç”¨åƒåœ¾å›æ”¶å™¨è¿›è¡Œå†…å­˜ç®¡ç†ã€‚BEAMè¯­è¨€ä¹Ÿä¸ä¾‹å¤–ã€‚å½“æ‚¨è¦ç¼–å†™é«˜çº§å¹¶å‘ä»£ç æ—¶ï¼Œä¿¡ä»»è™šæ‹Ÿæœºæ¥å¤„ç†èµ„æºå’Œç®¡ç†å†…å­˜éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºè¿™å¯ä»¥ç®€åŒ–ä»»åŠ¡ã€‚å½’åŠŸäºåŸºäºä¸å¯å˜çŠ¶æ€çš„å†…å­˜æ¨¡å‹ï¼Œåƒåœ¾æ”¶é›†å™¨çš„åŸºç¡€å®ç°éå¸¸ç®€å•æœ‰æ•ˆã€‚æ•°æ®è¢«å¤åˆ¶è€Œä¸æ˜¯çªå˜ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸å…±äº«å†…å­˜è¿™ä¸€äº‹å®æ¶ˆé™¤äº†ä»»ä½•è¿›ç¨‹çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå› æ­¤ä¸éœ€è¦ç®¡ç†å®ƒä»¬ã€‚\nBEAMçš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰åœ¨æ¯ä¸ªè¿›ç¨‹çš„åŸºç¡€ä¸Šè¿è¡Œåƒåœ¾å›æ”¶ï¼Œè€Œä¸ä¼šå½±å“åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„å…¶ä»–è¿›ç¨‹ã€‚ç»“æœï¼ŒErlangä¸­çš„åƒåœ¾æ”¶é›†ä¸ä¼šâ€œstop-the-worldâ€ã€‚å®ƒå¯ä»¥é˜²æ­¢å¤„ç†å»¶è¿Ÿé«˜å³°ï¼Œå› ä¸ºVMä¸ä¼šä»æ•´ä½“ä¸Šåœæ­¢â€”â€”ä»…ç‰¹å®šè¿›ç¨‹åœæ­¢ï¼Œå¹¶ä¸”ç»ä¸ä¼šåŒæ—¶åœæ­¢æ‰€æœ‰è¿›ç¨‹ã€‚å®é™…ä¸Šï¼Œè¿™åªæ˜¯æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”è¢«è§†ä¸ºå¦ä¸€ç§reductionã€‚åƒåœ¾æ”¶é›†å™¨æ”¶é›†è¿‡ç¨‹å°†è¿‡ç¨‹æš‚åœå¾ˆçŸ­çš„æ—¶é—´é—´éš”ï¼Œé€šå¸¸æ˜¯å¾®ç§’ã€‚ä»£ä»·æ˜¯ï¼Œå°†æœ‰è®¸å¤šå°çš„çˆ†å‘ï¼ˆburstsï¼‰ï¼Œä»…åœ¨è¿›ç¨‹éœ€è¦æ›´å¤šå†…å­˜æ—¶æ‰è§¦å‘ã€‚å•ä¸ªè¿›ç¨‹é€šå¸¸ä¸ä¼šåˆ†é…å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œé€šè¿‡åœ¨ç»ˆæ­¢æ—¶ç«‹å³é‡Šæ”¾æ‰€æœ‰åˆ†é…çš„å†…å­˜ï¼Œè¿›ä¸€æ­¥é™ä½äº†å½±å“ã€‚JVMçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å…·å¤‡åˆ‡æ¢åƒåœ¾æ”¶é›†å™¨çš„èƒ½åŠ›ï¼Œå› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨å•†ç”¨GCï¼Œè¿˜å¯ä»¥åœ¨JVMä¸­å®ç°ä¸é—´æ–­çš„GCã€‚\nLukas Larssonåœ¨ä¸€ç¯‡å‡ºè‰²çš„åšå®¢æ–‡ç« ä¸­è®¨è®ºäº†åƒåœ¾æ”¶é›†å™¨çš„åŠŸèƒ½ã€‚æœ‰è®¸å¤šå¤æ‚çš„ç»†èŠ‚ï¼Œä½†å·²å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ä»¥æœ‰æ•ˆåœ°å¤„ç†ä¸å¯å˜æ•°æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿›ç¨‹åœ¨å †æ ˆå’Œå †ä¹‹é—´åˆ†é…äº†æ•°æ®ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨çŸ­æš‚çš„è¿‡ç¨‹ä¸­å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œã€‚\nè¿™ä¸ªä¸»é¢˜ä¸Šç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜æ˜¯BEAMä½¿ç”¨å¤šå°‘å†…å­˜ã€‚è™šæ‹Ÿæœºåœ¨åå°åˆ†é…äº†å¤§å—å†…å­˜ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰åˆ†é…å™¨æ¥æœ‰æ•ˆåœ°å­˜å‚¨æ•°æ®å¹¶æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚è¿™æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„æ•ˆæœï¼š 1ï¼‰åœ¨ä¸éœ€è¦ç©ºé—´ä¹‹åï¼Œå·²ç”¨å†…å­˜é€æ¸å‡å°‘ 2ï¼‰é‡æ–°åˆ†é…å¤§é‡æ•°æ®å¯èƒ½æ„å‘³ç€å°†å½“å‰å·¥ä½œå†…å­˜åŠ å€ã€‚\nå¦‚æœç¡®å®éœ€è¦ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´åˆ†é…å™¨ç­–ç•¥æ¥å‡è½»ç¬¬ä¸€ä¸ªå½±å“ã€‚å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°ä¸åŒç±»å‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåˆ™ç¬¬äºŒä¸ªæ˜“äºç›‘è§†å’Œè®¡åˆ’ã€‚ï¼ˆWombatOAMå°±æ˜¯è¿™æ ·ä¸€ç§æä¾›å¼€ç®±å³ç”¨çš„ç³»ç»ŸæŒ‡æ ‡çš„ç›‘è§†å·¥å…·ã€‚ï¼‰\nçƒ­ä»£ç åŠ è½½ çƒ­ä»£ç åŠ è½½å¯èƒ½æ˜¯BEAMå¼•ç”¨æœ€å¤šçš„ç‹¬ç‰¹åŠŸèƒ½ã€‚çƒ­ä»£ç åŠ è½½æ„å‘³ç€å¯ä»¥é€šè¿‡æ›´æ”¹ç³»ç»Ÿä¸­çš„å¯è¿è¡Œä»£ç æ¥æ›´æ–°åº”ç”¨ç¨‹åºé€»è¾‘ï¼ŒåŒæ—¶ä¿ç•™å†…éƒ¨æµç¨‹çŠ¶æ€ã€‚è¿™æ˜¯é€šè¿‡æ›¿æ¢å·²åŠ è½½çš„BEAMæ–‡ä»¶å¹¶æŒ‡ç¤ºVMæ›¿æ¢æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­çš„ä»£ç å¼•ç”¨æ¥å®ç°çš„ã€‚\nå¯¹äºç”µä¿¡åŸºç¡€æ¶æ„æ— éœ€åœæœºä»£ç å‡çº§è€Œè¨€ï¼Œè¿™æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„åŠŸèƒ½ï¼Œè¢«è£å‡çš„ç¡¬ä»¶å¯ç”¨äºå¤„ç†é«˜å³°ã€‚å¦‚ä»Šï¼Œåœ¨å®¹å™¨åŒ–æ—¶ä»£ï¼Œå…¶ä»–æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°äº§çº¿çš„æ›´æ–°ã€‚ä»æœªä½¿ç”¨è¿‡å®ƒçš„äººä¼šè®¤ä¸ºå®ƒæ˜¯ä¸é‡è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨å¼€å‘å·¥ä½œæµç¨‹ä¸­ä»ç„¶æœ‰ç”¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ›¿æ¢éƒ¨åˆ†ä»£ç æ¥åŠ å¿«è¿­ä»£é€Ÿåº¦ï¼Œè€Œä¸å¿…é‡æ–°å¯åŠ¨ç³»ç»Ÿæ¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚å³ä½¿è¯¥åº”ç”¨ç¨‹åºå¹¶éè®¾è®¡ä¸ºå¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå‡çº§ï¼Œä¹Ÿå¯ä»¥å‡å°‘é‡æ–°ç¼–è¯‘å’Œé‡æ–°éƒ¨ç½²æ‰€éœ€çš„æ—¶é—´ã€‚\nä½•æ—¶ä¸ä½¿ç”¨BEAM æ­£ç¡®çš„å·¥å…·éå¸¸é‡è¦ã€‚æ‚¨éœ€è¦ä¸€ä¸ªé€Ÿåº¦æå¿«çš„ç³»ç»Ÿï¼Œä½†ä¸å…³å¿ƒå¹¶å‘æ€§å—ï¼Ÿå¹¶è¡Œå¤„ç†ä¸€äº›äº‹ä»¶ï¼Œå¹¶ä¸”å¿…é¡»å¿«é€Ÿå¤„ç†å®ƒä»¬ï¼Ÿæ˜¯å¦éœ€è¦è®¡ç®—å›¾å½¢ï¼Œäººå·¥æ™ºèƒ½æˆ–åˆ†ææ•°æ®ï¼Ÿæ²¿C ++ï¼ŒPythonæˆ–Javaè·¯çº¿èµ°ã€‚ç”µä¿¡åŸºç¡€è®¾æ–½ä¸éœ€è¦å¿«é€Ÿè¿è¡Œï¼Œå› æ­¤é€Ÿåº¦ä»æ¥éƒ½ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹ã€‚åœ¨åŠ¨æ€ç±»å‹çš„è¾…åŠ©ä¸‹ï¼Œå®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œæ‰€æœ‰ç±»å‹æ£€æŸ¥ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘å™¨æ—¶é—´ä¼˜åŒ–å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚å› æ­¤ï¼Œæ•°å­—è¿ç®—æœ€å¥½ç•™ç»™JVMï¼ŒGoæˆ–å…¶ä»–ç¼–è¯‘æˆæœ¬åœ°è¯­è¨€çš„è¯­è¨€ä½¿ç”¨ã€‚æ¯«ä¸å¥‡æ€ªï¼Œåœ¨JVMä¸Šè¿è¡Œçš„Erlangç‰ˆæœ¬Erjangä¸Šçš„æµ®ç‚¹è¿ç®—æ¯”BEAMå¿«5000ï¼…ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°BEAMå¤§æ”¾å¼‚å½©çš„åœ°æ–¹æ˜¯åˆ©ç”¨å®ƒçš„å¹¶å‘æ¥å®‰æ’æ•°å­—è¿ç®—ï¼Œå°†åˆ†æå¤–åŒ…ç»™Cï¼ŒJuliaï¼ŒPythonæˆ–Rustã€‚æ‚¨å¯ä»¥åœ¨BEAMå¤–éƒ¨åšmapï¼Œè€Œåœ¨BEAMå†…éƒ¨åšreduce(è¯‘è€…æ³¨ï¼šmap-reduceæ€æƒ³)ã€‚\nå£å¤´ç¦…æ€»æ˜¯å¾ˆå¿«ã€‚äººç±»æ„ŸçŸ¥åˆºæ¿€ï¼ˆäº‹ä»¶ï¼‰å¹¶åœ¨å¤§è„‘ä¸­è¿›è¡Œå¤„ç†éœ€è¦å‡ ç™¾æ¯«ç§’ï¼Œè¿™æ„å‘³ç€å¯¹äºè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œå¾®ç§’æˆ–çº³ç§’çš„å“åº”æ—¶é—´å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨ä¹Ÿä¸ä¼šå°†BEAMç”¨äºå¾®æ§åˆ¶å™¨ï¼Œè¿™å¤ªæµªè´¹èµ„æºäº†ã€‚ä½†æ˜¯å¯¹äºå…·æœ‰æ›´å¤šå¤„ç†èƒ½åŠ›çš„åµŒå…¥å¼ç³»ç»Ÿï¼ˆå¤šæ ¸å·²æˆä¸ºå¸¸æ€ï¼‰ï¼Œæ‚¨éœ€è¦å¹¶å‘æ€§ï¼Œè€ŒBEAMä»¤äººçœ¼å‰ä¸€äº®ã€‚ä¸Šä¸–çºª90å¹´ä»£ï¼Œæˆ‘ä»¬å®ç°äº†ç”µè¯äº¤æ¢æœºï¼Œä»¥å¤„ç†è¿è¡Œåœ¨å…·æœ‰16MBå†…å­˜çš„åµŒå…¥å¼æ¿ä¸Šçš„æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚RaspberryPiéƒ½æœ‰å¤šå°‘å†…å­˜äº†ï¼Ÿè¿˜æœ‰ï¼Œç¡¬å®æ—¶ç³»ç»Ÿï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›BEAMç®¡ç†æ‚¨çš„å®‰å…¨æ°”å›Šæ§åˆ¶ç³»ç»Ÿã€‚ä½ éœ€è¦ç¡¬ä¿è¯ ä»…ä»…æ˜¯ç¡¬å®æ—¶æ“ä½œç³»ç»Ÿï¼Œæ²¡æœ‰åƒåœ¾æ”¶é›†æˆ–å¼‚å¸¸çš„è¯­è¨€ã€‚åœ¨è¯¸å¦‚GRiSPä¹‹ç±»çš„è£¸æœºä¸Šè¿è¡Œçš„Erlang VMçš„å®ç°å°†ä¸ºæ‚¨æä¾›ç±»ä¼¼çš„ä¿è¯ã€‚\nç»“è®º ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å®Œæˆå·¥ä½œã€‚å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªè½¯å®æ—¶ç³»ç»Ÿï¼Œè€Œè¯¥ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿç«‹å³æ‰©å±•å¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ï¼Œå¹¶ä¸”æ— éœ€é‡æ–°å‘æ˜è½®å­å°±å¯ä»¥åšåˆ°ï¼Œé‚£ä¹ˆBEAMæ˜¯æ‚¨æ­£åœ¨å¯»æ‰¾çš„ç»è¿‡éªŒè¯çš„æŠ€æœ¯ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªé»‘åŒ£å­ã€‚ä¸çŸ¥é“å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºé©¾é©¶æ³•æ‹‰åˆ©ï¼Œæ— æ³•è·å¾—æœ€ä½³æ€§èƒ½æˆ–æ— æ³•ç†è§£å¥‡æ€ªå£°éŸ³æ¥è‡ªé©¬è¾¾çš„å“ªä¸ªéƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åº”è¯¥æ›´å¤šåœ°äº†è§£BEAMï¼Œäº†è§£å…¶å†…éƒ¨ç»“æ„å¹¶å‡†å¤‡å¯¹å…¶è¿›è¡Œå¾®è°ƒå’Œä¿®å¤çš„åŸå› ã€‚å¯¹äºåœ¨å®é™…ä»»åŠ¡ä¸­ä½¿ç”¨Erlangå’ŒElixirçš„äººï¼ˆè¯‘è€…æ³¨ï¼šin anger çš„æ„æ€æ˜¯to do or use something in a real situationï¼‰ï¼Œæˆ‘ä»¬å¼€è®¾äº†ä¸€å¤©çš„è®²å¸ˆæŒ‡å¯¼è¯¾ç¨‹ï¼Œè¯¥è¯¾ç¨‹é€šä¿—æ˜“æ‡‚å¹¶è§£é‡Šæ‚¨æ‰€çœ‹åˆ°çš„å¾ˆå¤šå†…å®¹ï¼ŒåŒæ—¶ä¸ºæ‚¨å‡†å¤‡å¤§è§„æ¨¡å¤„ç†å¤§è§„æ¨¡å¹¶å‘åšå¥½å‡†å¤‡ã€‚åœ¨è¿™é‡Œäº†è§£æ›´å¤šã€‚æˆ‘ä»¬ä¹Ÿæ¨èErik Stenmanæ’°å†™çš„å…³äºBEAMçš„ä¹¦å’ŒDmytro Lytovchenkoçš„æ–‡ç« é›†â€”â€”BEAM Wisdomsã€‚\n","id":89,"section":"posts","summary":"ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah ä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°","tags":["erlang"],"title":"[è¯‘]BEAM vs JVM","uri":"https://lvsq.net/2020/05/beam-vs-jvm/","year":"2020"},{"content":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º\u0026quot;abcx\u0026quot;ï¼Œé•¿åº¦4ï¼Œè¯¦ç»†æè¿°å¯è®¿é—®https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/\n(let* ( [s \u0026#34;abbabcx\u0026#34;] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) å®ç°çš„æ€è·¯ä¸ºï¼š\nç”±äºå­—ç¬¦å¯ä»¥æœ‰ASCIIç è¡¨ç¤ºï¼Œæ•…å¯ä»¥ç”¨ä¸€ä¸ªé•¿åº¦ä¸º128çš„å‘é‡vecæ¥ä¿å­˜æ¯ä¸ªå­—ç¬¦åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æœ€åä¸€æ¬¡çš„ä½ç½®ã€‚ç»´æŠ¤ä¸€ä¸ªå˜é‡dæ¥è®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦çš„èµ·å§‹ä½ç½®ã€‚ å¦‚æœï¼š\nåˆ¤æ–­æŸå­—ç¬¦æ˜¯å¦é‡å¤ï¼š 1.1 æŸå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œæ‰§è¡Œç¬¬2æ­¥ 1.2 æŸå­—ç¬¦éç¬¬ä¸€æ¬¡å‡ºç°ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼Œåœ¨dä¹‹åï¼Œåˆ™å°†dè®¾ç½®ä¸ºè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ã€‚ç”±äºä¹‹å‰çš„æœ€å¤§é•¿åº¦å·²ç»ç”±ansä¿å­˜ï¼Œæ‰€ä»¥åªéœ€è¦è®¡ç®—å‰©ä¸‹çš„å­ä¸²çš„é•¿åº¦èƒ½ä¸èƒ½å¤§äºansï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆdè®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å°±å¥½äº† è®¡ç®—å½“å‰ä½ç½®å’Œdçš„é•¿åº¦len ä¿å­˜å…¶ä½ç½®åˆ°vec å¦‚æœlenå¤§äºansï¼Œæ”¹å˜ansä¸ºlen è¿™ç§å®ç°åªéœ€éå†ä¸€éå°±å¯ä»¥è®¡ç®—å‡ºç»“æœï¼Œæ€§èƒ½éå¸¸æ£’ã€‚å½“ç„¶æš´åŠ›è®¡ç®—æˆ–è€…æ»‘åŠ¨çª—å£ä¹Ÿå¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼Œåªæ˜¯éœ€è¦å¤šæ¬¡éå†ï¼Œæ€§èƒ½æ¯”ä¸ä¸Šã€‚\næ¦‚è¦åˆ†æ ä¸Šæ–‡è¯´åˆ°æ€§èƒ½é—®é¢˜ï¼Œæ‹¿ç‚¹æ•°æ®å‡ºæ¥è¯æ˜ä¸€ä¸‹å§ã€‚\nå°†ä¸Šé¢çš„ä»£ç ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œä½œä¸ºä¸€ä¸ªdefinitionï¼Œå¹¶ä¿å­˜åœ¨longest_substr.ssæ–‡ä»¶ä¸­ï¼Œ\n(define longest-substr (lambda (str) (let* ( [s str] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) ) ) Chez Schemeæä¾›äº†ä¸€ä¸ªæ¦‚è¦åˆ†æå·¥å…·ï¼Œéå¸¸å¥½ç”¨ï¼Œæ¥è¯•ç”¨ä¸€ä¸‹ï¼š ç”Ÿæˆçš„htmlå¯ä»¥éå¸¸ç›´è§‚çš„çœ‹åˆ°è¯¥å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ å­—ç¬¦ä¸²è¶Šé•¿ï¼Œæ‰§è¡Œæ¬¡æ•°è¶Šå¤šï¼Œæ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘å‘¢ï¼Ÿé€‰ä¸€ä¸ªä¸Šé¢ä¾‹å­ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²æ¥çœ‹çœ‹ï¼š\n\u0026gt; (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) no collections 0.000003672s elapsed cpu time 0.000002000s elapsed real time 1792 bytes allocated 12 \u0026gt; æ¶ˆè€—çš„CPUæ—¶é—´0.000003672sï¼Œå¯ä»¥è¯´éå¸¸çŸ­äº†ï¼Œä¸”åˆ†é…çš„å†…å­˜ä»…ä»…1792ä¸ªå­—èŠ‚ã€‚è¶…ä¹å¯»å¸¸çš„æ€§èƒ½ï¼Œæˆ‘æƒ³åº”è¯¥æœ‰ä¸¤ä¸ªæ–¹é¢åŸå› ï¼š\nç®—æ³• Scheme å’Œ Chez Scheme ","id":90,"section":"posts","summary":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º","tags":["scheme"],"title":"æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²-Schemeå®ç°","uri":"https://lvsq.net/2020/03/longest-substr/","year":"2020"},{"content":"\nä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿åå‡½æ•°å¼ç¼–ç¨‹è§„åˆ™ï¼Œå°±å¯ä»¥å¿«é€Ÿè°ƒè¯•åº”ç”¨ç¨‹åºã€‚å½“å‡½æ•°è¢«éš”ç¦»æ—¶ï¼Œæ‚¨ä¸å¿…å¤„ç†å½±å“è¾“å‡ºçš„éšè—çŠ¶æ€çš„æ›´æ”¹ã€‚\nè½¯ä»¶å·¥ç¨‹å¸ˆå…¼ä½œè€…Eric Elliotå®šä¹‰äº†ä»¥ä¸‹å‡½æ•°ç¼–ç¨‹ã€‚\nå‡½æ•°å¼ç¼–ç¨‹æ˜¯é€šè¿‡ç»„åˆçº¯å‡½æ•°ï¼Œé¿å…å…±äº«çŠ¶æ€ï¼Œå¯å˜æ•°æ®å’Œå‰¯ä½œç”¨æ¥æ„å»ºè½¯ä»¶çš„è¿‡ç¨‹ã€‚å‡½æ•°å¼ç¼–ç¨‹æ˜¯å£°æ˜æ€§çš„ï¼Œè€Œä¸æ˜¯å‘½ä»¤æ€§çš„ï¼Œåº”ç”¨ç¨‹åºçŠ¶æ€é€šè¿‡çº¯å‡½æ•°æµåŠ¨ã€‚ä¸é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ç›¸åï¼Œåè€…é€šå¸¸å°†åº”ç”¨ç¨‹åºçŠ¶æ€ä¸å¯¹è±¡ä¸­çš„æ–¹æ³•å…±äº«å¹¶æ”¾ç½®åœ¨å¯¹è±¡ä¸­ã€‚\næˆ‘å°†æ›´è¿›ä¸€æ­¥ï¼šå‡½æ•°å¼ç¼–ç¨‹ï¼ˆå¦‚é¢å‘å¯¹è±¡å’Œè¿‡ç¨‹å¼ç¼–ç¨‹ï¼‰ä»£è¡¨ç€èŒƒå¼çš„è½¬å˜ã€‚å®ƒåœ¨ç¼–å†™ä»£ç æ—¶é‡‡ç”¨äº†ç‹¬ç‰¹çš„æ€ç»´æ–¹å¼ï¼Œå¹¶å¼•å…¥äº†ä¸€å¥—å…¨æ–°çš„è§„åˆ™ã€‚\n4ä¸ªé‡è¦æ¦‚å¿µ è¦å®Œå…¨æŒæ¡å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¿…é¡»é¦–å…ˆäº†è§£ä»¥ä¸‹ç›¸å…³æ¦‚å¿µã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å‰¯ä½œç”¨ å‡½æ•°æ„æˆ å…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å¦‚æœç»™çº¯å‡½æ•°æä¾›ç›¸åŒçš„è¾“å…¥ï¼Œåˆ™å®ƒæ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„è¾“å‡ºã€‚æ­¤å±æ€§ä¹Ÿç§°ä¸ºå¹‚ç­‰ã€‚å¹‚ç­‰æ„å‘³ç€å‡½æ•°åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸è°ƒç”¨æ¬¡æ•°æ— å…³ã€‚\nå‰¯ä½œç”¨ çº¯å‡½æ•°ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„å‡½æ•°æ— æ³•ä¸å¤–éƒ¨ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚\nä¾‹å¦‚ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°†APIè°ƒç”¨è§†ä¸ºå‰¯ä½œç”¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºAPIè°ƒç”¨è¢«è®¤ä¸ºæ˜¯ä¸å—æ‚¨ç›´æ¥æ§åˆ¶çš„å¤–éƒ¨ç¯å¢ƒã€‚ä¸€ä¸ªAPIå¯èƒ½æœ‰å‡ ä¸ªä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œä¾‹å¦‚è¶…æ—¶æˆ–å¤±è´¥ï¼Œæˆ–è€…ç”šè‡³å¯èƒ½è¿”å›æ„å¤–çš„å€¼ã€‚å®ƒä¸é€‚åˆçº¯å‡½æ•°çš„å®šä¹‰ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨APIæ—¶éƒ½éœ€è¦ä¸€è‡´çš„ç»“æœã€‚\nå…¶ä»–å¸¸è§çš„å‰¯ä½œç”¨åŒ…æ‹¬ï¼š\næ•°æ®å˜åŒ– DOMæ“ä½œ è¯·æ±‚æœ‰å†²çªçš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰æ—¶é—´time.Now() å‡½æ•°æ„æˆ å‡½æ•°æ„æˆçš„åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šå°†ä¸¤ä¸ªçº¯å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ä»¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚è¿™æ„å‘³ç€ä¸ºç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡ºçš„æ¦‚å¿µåœ¨è¿™é‡Œä»ç„¶é€‚ç”¨ã€‚å› æ­¤ï¼Œä»ç®€å•çš„çº¯å‡½æ•°å¼€å§‹åˆ›å»ºæ›´é«˜çº§çš„å‡½æ•°å¾ˆé‡è¦ã€‚\nå…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯åˆ›å»ºä¸ä¿æŒçŠ¶æ€çš„å‡½æ•°ã€‚å…±äº«çŠ¶æ€å°¤å…¶ä¼šåœ¨çº¯å‡½æ•°ä¸­å¼•å…¥å‰¯ä½œç”¨æˆ–å¯å˜æ€§é—®é¢˜ï¼Œä½¿å®ƒä»¬å˜å¾—ä¸çº¯ç²¹ã€‚\nä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰çŠ¶æ€éƒ½ä¸å¥½ã€‚æœ‰æ—¶ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªçŠ¶æ€æ‰èƒ½è§£å†³ç‰¹å®šçš„è½¯ä»¶é—®é¢˜ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿çŠ¶æ€å¯è§å’Œæ˜¾å¼ï¼Œä»¥æ¶ˆé™¤ä»»ä½•å‰¯ä½œç”¨ã€‚ç¨‹åºä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ä»çº¯å‡½æ•°ä¸­æ´¾ç”Ÿæ–°æ•°æ®ã€‚è¿™æ ·ï¼Œå°±ä¸éœ€è¦å¯èƒ½å¼•èµ·å‰¯ä½œç”¨çš„å¯å˜æ•°æ®ã€‚\nç°åœ¨æˆ‘ä»¬å·²ç»æ¶µç›–äº†åŸºç¡€ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€äº›åœ¨Goä¸­ç¼–å†™åŠŸèƒ½ä»£ç æ—¶è¦éµå¾ªçš„è§„åˆ™ã€‚\nåŠŸèƒ½ç¼–ç¨‹è§„åˆ™ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§èŒƒä¾‹ã€‚å› æ­¤ï¼Œå¾ˆéš¾ä¸ºè¿™ç§ç¼–ç¨‹é£æ ¼å®šä¹‰ç¡®åˆ‡çš„è§„åˆ™ã€‚ä¹Ÿä¸ä¸€å®šæ€»æ˜¯éµå¾ªè¿™äº›è§„åˆ™ã€‚æœ‰æ—¶ï¼Œæ‚¨ç¡®å®éœ€è¦ä¾èµ–æ‹¥æœ‰çŠ¶æ€çš„åŠŸèƒ½ã€‚\nä½†æ˜¯ï¼Œä¸ºäº†å°½å¯èƒ½ä¸¥æ ¼åœ°éµå¾ªå‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ï¼Œæˆ‘å»ºè®®åšæŒä»¥ä¸‹å‡†åˆ™ã€‚\næ²¡æœ‰å¯å˜æ•°æ®ä»¥é¿å…å‰¯ä½œç”¨ æ— çŠ¶æ€ï¼ˆæˆ–è€…éšå¼çŠ¶æ€ï¼Œä¾‹å¦‚å¾ªç¯è®¡æ•°å™¨ï¼‰ ç»™å˜é‡èµ‹å€¼åè¯·å‹¿ä¿®æ”¹ é¿å…å‰¯ä½œç”¨ï¼Œä¾‹å¦‚APIè°ƒç”¨ æˆ‘ä»¬åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªå¥½çš„â€œå‰¯ä½œç”¨â€æ˜¯å¼ºå¤§çš„æ¨¡å—åŒ–ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸æ˜¯è‡ªä¸Šè€Œä¸‹åœ°è¿›è¡Œè½¯ä»¶å·¥ç¨‹ï¼Œè€Œæ˜¯é¼“åŠ±è‡ªä¸‹è€Œä¸Šçš„ç¼–ç¨‹é£æ ¼ã€‚é¦–å…ˆå®šä¹‰æ¨¡å—ï¼ŒæŠŠå°†æ¥å¯èƒ½ä½¿ç”¨çš„åŒç±»çº¯å‡½æ•°ç»„åˆèµ·æ¥ã€‚æ¥ä¸‹æ¥ï¼Œå¼€å§‹ç¼–å†™é‚£äº›å°çš„ï¼Œæ— çŠ¶æ€çš„ç‹¬ç«‹å‡½æ•°ï¼Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚\nå®è´¨ä¸Šæˆ‘ä»¬æ˜¯åœ¨åˆ›å»ºé»‘åŒ£å­ã€‚ç¨åï¼Œæˆ‘ä»¬å°†æŒ‰ç…§è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼å°†å„ä¸ªå—æ†ç»‘åœ¨ä¸€èµ·ã€‚è¿™ä½¿æ‚¨å¯ä»¥å»ºç«‹å¼ºå¤§çš„æµ‹è¯•åŸºç¡€ï¼Œå°¤å…¶æ˜¯å¯ä»¥éªŒè¯çº¯å‡½æ•°æ­£ç¡®æ€§çš„å•å…ƒæµ‹è¯•ã€‚\nä¸€æ—¦æ‚¨å¯ä»¥ä¿¡ä»»æ‚¨çš„æ¨¡å—ï¼Œå°±å¯ä»¥å°†æ¨¡å—æ†ç»‘åœ¨ä¸€èµ·äº†ã€‚å¼€å‘è¿‡ç¨‹ä¸­çš„è¿™ä¸€æ­¥è¿˜æ¶‰åŠç¼–å†™é›†æˆæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä¸¤ä¸ªç»„ä»¶çš„æ­£ç¡®é›†æˆã€‚\n5ä¸ªç¤ºä¾‹ ä¸ºäº†æ›´å…¨é¢åœ°æè¿°Goå‡½æ•°ç¼–ç¨‹çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬æ¢ç´¢äº”ä¸ªåŸºæœ¬ç¤ºä¾‹ã€‚\næ›´æ–°å­—ç¬¦ä¸² è¿™æ˜¯çº¯å‡½æ•°çš„æœ€ç®€å•ç¤ºä¾‹ã€‚é€šå¸¸ï¼Œå½“æ‚¨è¦æ›´æ–°å­—ç¬¦ä¸²æ—¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\nnameï¼š= \u0026#34;first name\u0026#34; nameï¼š= name + \u0026#34;last name\u0026#34; ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„è§„åˆ™ï¼Œå› ä¸ºä¸èƒ½åœ¨å‡½æ•°å†…ä¿®æ”¹å˜é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥é‡å†™ä»£ç æ®µï¼Œä»¥ä¾¿æ¯ä¸ªå€¼éƒ½å…·æœ‰è‡ªå·±çš„å˜é‡ã€‚\nä¸‹é¢çš„ä»£ç æ®µä¸­çš„ä»£ç æ›´å…·å¯è¯»æ€§ã€‚\nfirstname := \u0026#34;first\u0026#34; lastname := \u0026#34;last\u0026#34; fullname := firstname + \u0026#34; \u0026#34; + lastname åœ¨æŸ¥çœ‹éå‡½æ•°å¼ä»£ç æ®µæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æµè§ˆç¨‹åºä»¥ç¡®å®šæœ€æ–°çŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰¾åˆ°nameå˜é‡çš„ç»“æœå€¼ã€‚è¿™éœ€è¦æ›´å¤šçš„ç²¾åŠ›å’Œæ—¶é—´æ¥äº†è§£è¯¥åŠŸèƒ½çš„ä½œç”¨ã€‚\né¿å…æ›´æ–°æ•°ç»„ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿ç”¨ä¸å˜æ•°æ®é€šè¿‡çº¯å‡½æ•°å¾—å‡ºæ–°çš„ä¸å˜æ•°æ®çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡éœ€è¦æ›´æ–°æ•°ç»„æ—¶åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„æ¥å®ç°\nåœ¨éå‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæ›´æ–°æ•°ç»„å¦‚ä¸‹ï¼š\nnames := [3]string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} // Add Lucas to the array names[2] = \u0026#34;Lucas\u0026#34; è®©æˆ‘ä»¬æ ¹æ®åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹è¿›è¡Œå°è¯•ã€‚\nnames := []string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} allNames := append(names, \u0026#34;Lucas\u0026#34;) é¿å…æ›´æ–°map è¿™æ˜¯å‡½æ•°ç¼–ç¨‹çš„æç«¯ç¤ºä¾‹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰å­—ç¬¦ä¸²ç±»å‹çš„é”®å’Œæ•´æ•°ç±»å‹çš„å€¼çš„mapã€‚è¯¥mapåŒ…å«æˆ‘ä»¬ä»ç„¶ç•™åœ¨å®¶ä¸­çš„æ°´æœæ•°é‡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆšè´­ä¹°äº†è‹¹æœï¼Œå¹¶å¸Œæœ›å°†å…¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} // Buy five apples fruits[\u0026#34;apples\u0026#34;] = 5 æˆ‘ä»¬å¯ä»¥åœ¨åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹ä¸‹å®Œæˆç›¸åŒçš„åŠŸèƒ½ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} newFruits := map[string]int{\u0026#34;apples\u0026#34;: 5} allFruits := make(map[string]int, len(fruits) + len(newFruits)) for k, v := range fruits { allFruits[k] = v } for k, v := range newFruits { allFruits[k] = v } ç”±äºæˆ‘ä»¬ä¸æƒ³ä¿®æ”¹åŸå§‹mapï¼Œå› æ­¤ä»£ç ä¼šéå†ä¸¤ä¸ªmapï¼Œå¹¶å°†å€¼æ·»åŠ åˆ°æ–°mapã€‚è¿™æ ·ï¼Œæ•°æ®ä¿æŒä¸å˜ã€‚\næ­£å¦‚æ‚¨å¯èƒ½é€šè¿‡ä»£ç çš„é•¿åº¦å¯ä»¥çœ‹å‡ºçš„é‚£æ ·ï¼Œæ­¤ä»£ç æ®µçš„æ€§èƒ½æ¯”å¯¹mapè¿›è¡Œç®€å•çš„å¯å˜æ›´æ–°è¦å·®å¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬è¦éå†ä¸¤ä¸ªmapã€‚è¿™æ˜¯æ‚¨ä¸ºä»£ç æ€§èƒ½äº¤æ¢æ›´å¥½çš„ä»£ç è´¨é‡çš„æ—¶é—´ã€‚\né«˜é˜¶å‡½æ•°å’ŒæŸ¯é‡ŒåŒ– å¤§å¤šæ•°ç¨‹åºå‘˜åœ¨ä»–ä»¬çš„ä»£ç ä¸­é€šå¸¸ä¸ä¼šä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼Œä½†æ˜¯åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æŸ¯é‡ŒåŒ–å¾ˆæ–¹ä¾¿ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå°†ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ã€‚å°½ç®¡è¿™å·²ç»æ˜¯ä¸€ä¸ªçº¯ç²¹çš„åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¯¦ç»†è¯´æ˜è¯¥ç¤ºä¾‹ï¼Œä»¥å±•ç¤ºå¦‚ä½•é€šè¿‡curringåˆ›å»ºæ›´é«˜çº§çš„åŠŸèƒ½ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ã€‚æ¥ä¸‹æ¥ï¼Œè¯¥å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºé—­åŒ…ã€‚å› ä¸ºè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥å®ƒå°†è®°ä½å¤–éƒ¨èŒƒå›´ï¼Œè¯¥èŒƒå›´åŒ…å«åˆå§‹è¾“å…¥å‚æ•°ã€‚\nfunc add ï¼ˆx intï¼‰func ï¼ˆy intï¼‰int { return funcï¼ˆy intï¼‰int { return x + y } } ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•curryingå¹¶åˆ›å»ºæ›´å¤šé«˜çº§çº¯å‡½æ•°ã€‚\nfunc main() { // Create more variations add10 := add(10) add20 := add(20) // Currying fmt.Println(add10(1)) // 11 fmt.Println(add20(1)) // 21 } è¿™ç§æ–¹æ³•åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¾ˆå¸¸è§ï¼Œå°½ç®¡æ‚¨é€šå¸¸ä¸ä¼šåœ¨èŒƒå¼ä¹‹å¤–çœ‹åˆ°å®ƒã€‚\né€’å½’ é€’å½’æ˜¯ä¸€ç§é€šå¸¸ç”¨äºè§„é¿å¾ªç¯ä½¿ç”¨çš„è½¯ä»¶æ¨¡å¼ã€‚å› ä¸ºå¾ªç¯å§‹ç»ˆä¿æŒå†…éƒ¨çŠ¶æ€ä»¥æ˜ç¡®å¾ªç¯åœ¨å“ªä¸€è½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ä¸‹ä½¿ç”¨å¾ªç¯ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µå°è¯•è®¡ç®—æ•°å­—çš„é˜¶ä¹˜ã€‚é˜¶ä¹˜æ˜¯ä¸€ä¸ªæ•´æ•°ä¸å…¶ä¸‹æ‰€æœ‰æ•´æ•°çš„ä¹˜ç§¯ã€‚å› æ­¤ï¼Œé˜¶ä¹˜4ç­‰äº24ï¼ˆ= 4 * 3 * 2 * 1ï¼‰ã€‚\né€šå¸¸ï¼Œæ‚¨å°†ä¸ºæ­¤ä½¿ç”¨å¾ªç¯ã€‚\nfunc factorial(fac int) int { result := 1 for ; fac \u0026gt; 0; fac-- { result *= fac } return result } ä¸ºäº†åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ä¸­å®Œæˆæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é€’å½’ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å°†ä¸€éåˆä¸€éåœ°è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œç›´åˆ°è¾¾åˆ°é˜¶ä¹˜çš„æœ€ä½æ•´æ•°ä¸ºæ­¢ã€‚\nfunc calculateFactorial(fac int) int { if fac == 0 { return 1 } return fac * calculateFactorial(fac - 1) } ç»“è®º è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä»å‡½æ•°å¼ç¼–ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼š\nå°½ç®¡Golangæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†å®ƒå¹¶éä¸ºæ­¤ç›®çš„è€Œè®¾è®¡çš„ï¼Œå¦‚ç¼ºå°‘Mapï¼ŒFilterå’ŒReduceå‡½æ•°ã€‚ å‡½æ•°å¼ç¼–ç¨‹æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºå‡½æ•°æ˜¯çº¯ç²¹çš„ï¼Œå› æ­¤æ˜“äºç†è§£ çº¯å‡½æ•°æ›´æ˜“äºæµ‹è¯•ï¼Œå› ä¸ºæ²¡æœ‰å†…éƒ¨çŠ¶æ€ä¼šæ”¹å˜è¾“å‡º åŸæ–‡åœ¨æ­¤: https://blog.logrocket.com/functional-programming-in-go/\n","id":91,"section":"posts","summary":"ä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿","tags":["functional"],"title":"ä½¿ç”¨Golangè¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹","uri":"https://lvsq.net/2020/03/fp-in-go/","year":"2020"},{"content":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚\né˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š\næ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ªç©ºé˜Ÿåˆ—\né€‰æ‹©å‡½æ•° (empty-queue? \u0026lt;queue\u0026gt; ) æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º (front-queue \u0026lt;queue\u0026gt; ) è¿”å›æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„æ•°æ®ï¼Œå…¶ä¸ä¼šä¿®æ”¹é˜Ÿåˆ— (length-queue \u0026lt;queue\u0026gt; ) è¿”å›é˜Ÿåˆ—é•¿åº¦\næ”¹å˜å‡½æ•° (insert-queue! \u0026lt;queue\u0026gt; \u0026lt;item\u0026gt; ) å°†æ•°æ®æ’å…¥æœ«ç«¯ (delete-queue! \u0026lt;queue\u0026gt; ) åˆ é™¤åˆ—å¤´çš„æ•°æ®\næ‰“å°å‡½æ•° (print-queue \u0026lt;queue\u0026gt;)\n(module FIFO-QUEUE (make-queue empty-queue? front-queue insert-queue! delete-queue! length-queue print-queue) (define front-ptr (lambda (q) (caar q))) (define set-front-ptr! (lambda (q item) (set-car! (car q) item))) (define rear-ptr (lambda (q) (cdar q))) (define set-rear-ptr! (lambda (q item) (set-cdr! (car q) item))) (define make-queue (lambda () (cons (cons \u0026#39;() \u0026#39;()) 0))) (define empty-queue? (lambda (q) (null? (front-ptr q)))) (define front-queue (lambda (q) (if (empty-queue? q) (error \u0026#34;FRONT called with an empty queue\u0026#34; q) (car (front-ptr q))))) (define (insert-queue! q item) (let ((new-pair (cons item \u0026#39;()))) (if (empty-queue? q) (begin (set-front-ptr! q new-pair) (set-rear-ptr! q new-pair) (set-cdr! q (+ 1 (cdr q))) q) (begin (set-cdr! (rear-ptr q) new-pair) (set-rear-ptr! q new-pair) (set-cdr! q ( + 1 (cdr q))) q) ) ) ) (define delete-queue! (lambda (q) (if (empty-queue? q) (error \u0026#34;DELETE! called with an empty queue\u0026#34; q) (begin (set-front-ptr! q (cdr (front-ptr q))) (set-cdr! q (- (cdr q) 1)) q) ) ) ) (define length-queue (lambda (q) (cdr q))) (define print-queue (lambda (q) (if (empty-queue? q) \u0026#39;() (front-ptr q)) )) ) å‰4ä¸ªè¿‡ç¨‹æ˜¯ç”¨äºå†…éƒ¨çš„å¸®åŠ©å‡½æ•°ï¼Œé˜Ÿåˆ—ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åˆ—å¤´ï¼ˆfront-ptrï¼‰,ä¸€ä¸ªæŒ‡å‘åˆ—å°¾ï¼ˆrear-ptrï¼‰ï¼Œè¿™æ ·å¯ä»¥å¼¥è¡¥åŸç”Ÿçš„set-car!å’Œset-cdr!çš„ä¸è¶³ã€‚\n\u0026gt; (load \u0026#34;/path/to/FIFO-QUEUE.scm\u0026#34;) ;;åŠ è½½FIFO-QUEUEæ¨¡å— \u0026gt; (import FIFO-QUEUE) \u0026gt; (define q (make-queue)) \u0026gt; (insert-queue! q 1) ;; (((1) 1) . 1), æœ€åä¸€ä¸ªæ•°å­—1è¡¨ç¤ºé˜Ÿåˆ—é•¿åº¦, åœ¨é˜Ÿåˆ—æœ‰åˆ é™¤æˆ–è€…æ’å…¥æ—¶ï¼ŒåŠæ—¶ä¿®æ”¹è¯¥å€¼ï¼Œä¸ºäº†åœ¨å–é˜Ÿåˆ—é•¿åº¦æ—¶å‡å°å¼€é”€ï¼Œå¦åˆ™è¦éå†ä¸€æ¬¡æ‰è¡Œ \u0026gt; (insert-queue! q 2) ;; (((1 2) 2) . 2) \u0026gt; (insert-queue! q 3) ;; (((1 2 3) 3) . 3) \u0026gt; (insert-queue! q 4) ;; (((1 2 3 4) 4) . 4) \u0026gt; (delete-queue! q) ;; (((2 3 4) 4) . 3) \u0026gt; (delete-queue! q) ;; (((3 4) 4) . 2) \u0026gt; (front-queue q) ;; 3 \u0026gt; (length-queue q) ;; 2 ","id":92,"section":"posts","summary":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚ é˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š æ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ª","tags":["scheme"],"title":"Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—","uri":"https://lvsq.net/2020/03/fifo-queue/","year":"2020"},{"content":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯èƒ½ä½¿ç”¨Schemeæ ‡å‡†æœºåˆ¶ã€‚\nHash Tables ç•¥è¿‡ã€‚åº”ä½¿ç”¨æ ‡å‡†hash table.\nExtend-Syntax Macros æœ¬èŠ‚ä»‹ç»äº†extend-syntaxï¼Œå®ƒæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ä½†æ˜“äºä½¿ç”¨çš„åŸºäºæ¨¡å¼åŒ¹é…çš„è¯­æ³•æ‰©å±•å·¥å…·ã€‚ ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•è½¬æ¢ä¸ä½¿ç”¨define-syntaxå’Œsyntax-caseç¼–å†™çš„è¯­æ³•è½¬æ¢ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºextend-syntaxäº§ç”Ÿçš„è½¬æ¢ä¸ä¼šè‡ªåŠ¨éµå¾ªè¯æ³•ä½œç”¨åŸŸã€‚\né€šå¸¸ä¸å¯èƒ½å°†ä½¿ç”¨syntax-caseç¼–å†™çš„è¯­æ³•æŠ½è±¡ä¸ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•æŠ½è±¡æ— ç¼åœ°æ··åˆåœ¨ä¸€èµ·ã€‚ é€šå¸¸å°½å¯èƒ½åªä½¿ç”¨å…¶ä¸­ä¸€ç§ã€‚ ä»…åœ¨è¿ç§»åˆ°syntax-caseæ—¶æä¾›äº†å¯¹syntax-caseæ‰©å±•å™¨ä¸­extend-syntaxçš„æ”¯æŒã€‚\n(extend-syntax (name key \u0026hellip;) (pat fender template) \u0026hellip;)\næ ‡è¯†ç¬¦name æ˜¯è¦å®šä¹‰çš„å¥æ³•æ‰©å±•åæˆ–è¯­æ³•å…³é”®å­—ã€‚ å½“ç³»ç»Ÿæ‰©å±•å™¨å¤„ç†carä¸ºname çš„ä»»ä½•listè¡¨è¾¾å¼æ—¶ï¼Œå°†åœ¨è¯¥è¡¨è¾¾å¼ä¸Šè°ƒç”¨extend-syntaxç”Ÿæˆçš„è¯­æ³•è½¬æ¢è¿‡ç¨‹ã€‚ å…¶ä½™çš„æ ‡è¯†ç¬¦key \u0026hellip; æ˜¯åœ¨æ‰©å±•è¿‡ç¨‹ä¸­è¦åœ¨è¾“å…¥è¡¨è¾¾å¼ä¸­è¯†åˆ«çš„å…¶ä»–å…³é”®å­—ï¼ˆä¾‹å¦‚condä¸­çš„elseæˆ–caseï¼‰ã€‚\nkeyåˆ—è¡¨ä¹‹åçš„æ¯ä¸ªå­å¥éƒ½åŒ…å«ä¸€ä¸ªæ¨¡å¼pat ï¼Œä¸€ä¸ªå¯é€‰çš„fender å’Œä¸€ä¸ªtemplate ã€‚ å¯é€‰çš„fender ç»å¸¸è¢«çœç•¥ã€‚pat æŒ‡å®šäº†è¯­æ³•ï¼Œç”¨äºåŒ¹é…å­å¥ã€‚æ¨¡å¼ä¸­ä¸æ˜¯å…³é”®å­—ï¼ˆæ¨¡å¼å˜é‡ï¼‰çš„æ ‡è¯†ç¬¦ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ã€‚fender å¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯Schemeè¡¨è¾¾å¼ï¼Œå®ƒæŒ‡å®šè¾“å…¥è¡¨è¾¾å¼ï¼ˆé€šè¿‡æ¨¡å¼å˜é‡è®¿é—®ï¼‰ä¸Šçš„é™„åŠ çº¦æŸï¼Œå¿…é¡»é€‰æ‹©è¿™äº›çº¦æŸæ‰èƒ½é€‰æ‹©å­å¥ã€‚template é€šå¸¸æ ¹æ®æ¨¡å¼å˜é‡æ¥æŒ‡å®šè¾“å‡ºé‡‡ç”¨ä»€ä¹ˆå½¢å¼ã€‚\nåœ¨æ‰©å±•è¿‡ç¨‹ä¸­ï¼Œè½¬æ¢è¿‡ç¨‹extend-syntaxä¼šå°è¯•ä»¥ç»™å®šçš„å­å¥çš„é¡ºåºå°†è¾“å…¥è¡¨è¾¾å¼ä¸æ¯ä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¾“å…¥è¡¨è¾¾å¼åŒ¹é…äº†æŸä¸ªæ¨¡å¼ï¼Œåˆ™å°†æ¨¡å¼å˜é‡ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ï¼Œå¹¶å¯¹å­å¥çš„fender ï¼ˆå¦‚æœæœ‰ï¼‰è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœfender è¿”å›ä¸€ä¸ªçœŸå€¼ï¼Œåˆ™æ‰§è¡Œç»™å®šçš„æ‰©å±•ã€‚ å¦‚æœè¾“å…¥ä¸æ¨¡å¼ä¸åŒ¹é…ï¼Œæˆ–è€…fender è¿”å›é”™è¯¯å€¼ï¼Œåˆ™è½¬æ¢è¿‡ç¨‹å°†å°è¯•ä¸‹ä¸€ä¸ªå­å¥ã€‚å¦‚æœæ— æ³•é€‰æ‹©ä»»ä½•å­å¥ï¼Œåˆ™ä¼šå¼•å‘æ¡ä»¶ç±»å‹**ï¼†assertion**çš„å¼‚å¸¸ã€‚\nåœ¨æ¨¡å¼å†…ï¼Œçœç•¥å·ï¼ˆ\u0026hellip;ï¼‰å¯ç”¨äºæŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªå‡ºç°çš„å‰é¢çš„æ¨¡å¼ç‰‡æ®µæˆ–åŸå‹ã€‚ç±»ä¼¼åœ°ï¼Œå¯ä»¥åœ¨è¾“å‡ºä¸­ä½¿ç”¨çœç•¥å·æ¥æŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªæ‰©å±•åŸå‹çš„ç»“æ„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å±•åŸå‹å¿…é¡»åŒ…å«è¾“å…¥æ¨¡å¼åŸå‹çš„ä¸€éƒ¨åˆ†ã€‚\nç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå®šä¹‰äº†rec, ä½¿ç”¨å•ä¸ªå…³é”®å­—ï¼Œä¸€ä¸ªå­å¥ï¼Œä¸”æ²¡æœ‰fenderå’Œçœç•¥å·\n(extend-syntax (rec) [(rec id val) (let ([id #f]) (set! id val) id)]) ç¬¬äºŒä¸ªä¾‹å­ï¼Œå®šä¹‰äº†whenï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨çœç•¥å·\n(extend-syntax (when) [(when test exp1 exp2 ...) (if test (begin exp1 exp2 ...) #f)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºletçš„å®šä¹‰ã€‚ letçš„å®šä¹‰æ˜¾ç¤ºäº†å¤šä¸ªçœç•¥å·çš„ä½¿ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨äºæ ‡è¯†ç¬¦/å€¼åºå¯¹ï¼Œå¦ä¸€ä¸ªç”¨äºbodyä¸­çš„è¡¨è¾¾å¼ã€‚å®ƒè¿˜è¡¨æ˜åŸå‹ä¸å¿…æ˜¯å•ä¸ªæ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”åœ¨templateä¸­å¯ä»¥å°†åŸå‹çš„å„ä¸ªéƒ¨åˆ†å½¼æ­¤åˆ†å¼€ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) ((lambda (x ...) b1 b2 ...) e ...)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºlet*ï¼Œå…¶è¯­æ³•ä¸letç›¸åŒï¼Œä½†æ˜¯æ ¹æ®letä»¥ä¸¤ä¸ªå­å¥ï¼ˆä¸€ä¸ªç”¨äºåŸºæœ¬æƒ…å†µï¼Œä¸€ä¸ªç”¨äºé€’å½’æ­¥éª¤ï¼‰é€’å½’å®šä¹‰ï¼Œå› ä¸ºå®ƒå¿…é¡»äº§ç”Ÿä¸€ä¸ªåµŒå¥—ç»“æ„ã€‚\n(extend-syntax (let*) [(let* () b1 b2 ...) (let () b1 b2 ...)] [(let* ([x e] more ...) b1 b2 ...) (let ([x e]) (let* (more ...) b1 b2 ...))]) å®šä¹‰å¼andéœ€è¦3ä¸ªå­å¥ã€‚ç¬¬ä¸€ä¸ªå­å¥å¯¹äºè¯†åˆ«**(and)æ˜¯å¿…è¦çš„ï¼Œåä¸¤ä¸ªä»¥é€’å½’æ–¹å¼å®šä¹‰æ‰€æœ‰å…¶ä»–and**å½¢å¼ã€‚\n(extend-syntax (and) [(and) #t] [(and x) x] [(and x y ...) (if x (and y ...) #f)]) condçš„å®šä¹‰éœ€è¦å››ä¸ªå­å¥ã€‚ ä¸let*ä¸€æ ·ï¼Œå¿…é¡»å¯¹condè¿›è¡Œé€’å½’æè¿°ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒä¼šäº§ç”ŸåµŒå¥—çš„ifè¡¨è¾¾å¼ï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸€ä¸ªçœç•¥å·åŸå‹ä¸è¶³ä»¥æè¿°æ‰€æœ‰å¯èƒ½çš„condå­å¥ã€‚ condçš„å®šä¹‰è¿˜è¦æ±‚é™¤condä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šelseä½œä¸ºå…³é”®å­—ã€‚ è¿™æ˜¯å®šä¹‰ï¼š\n(extend-syntax (cond else) [(cond) #f] [(cond (else e1 e2 ...)) (begin e1 e2 ...)] [(cond (test) more ...) (or test (cond more ...))] [(cond (test e1 e2 ...) more ...) (if test (begin e1 e2 ...) (cond more ...))]) ä¸ºäº†ä½¿letçš„è¯­æ³•ç»å¯¹æ­£ç¡®ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¿…é¡»è¦æ±‚è¾“å…¥ä¸­çš„ç»‘å®šæ ‡è¯†ç¬¦æ˜¯ç¬¦å·ã€‚ å¦‚æœæˆ‘ä»¬è¾“å…¥ç±»ä¼¼**ï¼ˆletï¼ˆ[3 x]ï¼‰xï¼‰çš„å†…å®¹ï¼Œåˆ™ä¸ä¼šä»let**ä¸­å¾—åˆ°é”™è¯¯ï¼Œå› ä¸ºå®ƒä¸ä¼šæ£€æŸ¥éªŒè¯æ ‡è¯†ç¬¦ä½ç½®ä¸­çš„å¯¹è±¡æ˜¯å¦ä¸ºç¬¦å·ã€‚ ç›¸åï¼Œlambdaå¯èƒ½ä¼šæŠ±æ€¨ï¼Œæˆ–è€…å¯èƒ½æ˜¯æ‰©å±•å®Œæˆå¾ˆä¹…ä¹‹åçš„æ±‚å€¼ç¨‹åºã€‚ è¿™æ˜¯fenders èµ·ä½œç”¨çš„åœ°æ–¹ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) (andmap symbol? \u0026#39;(x ...)) ((lambda (x ...) b1 b2 ...) e ...)]) \u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰ä¸Šçš„symbol?çš„andmapç¡®ä¿æ¯ä¸ªç»‘å®šæ ‡è¯†ç¬¦éƒ½æ˜¯ä¸€ä¸ªç¬¦å·ã€‚ fender ä»…ä»…æ˜¯Schemeè¡¨è¾¾å¼ã€‚ åœ¨è¯¥è¡¨è¾¾å¼ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ä¸å­å¥çš„template éƒ¨åˆ†ç›¸åŒçš„è§„åˆ™æ¥æ‰©å±•å¼•ç”¨çš„å¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†**\u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰**æ‰©å±•åˆ°æ ‡è¯†ç¬¦/å€¼å¯¹ä¸­çš„æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚\nextend-syntaxé€šå¸¸å¯ä»¥å¤„ç†æ‚¨çš„ä¸€åˆ‡éœ€æ±‚ï¼Œä½†æ˜¯æŸäº›è¯­æ³•æ‰©å±•å®šä¹‰è¦æ±‚èƒ½å¤ŸåŒ…å«å¯¹ä»»æ„Schemeè¡¨è¾¾å¼æ±‚å€¼çš„ç»“æœã€‚ è¯¥åŠŸèƒ½ç”±withæä¾›ã€‚\n(with ((pat expr) \u0026hellip;) template)\nwithä»…åœ¨extend-syntaxå†…éƒ¨çš„template å†…æœ‰æ•ˆã€‚ withæ¨¡å¼ä¸extend-syntaxæ¨¡å¼ç›¸åŒï¼Œwithè¡¨è¾¾å¼ä¸extend-syntaxçš„fenders ç›¸åŒï¼Œwithæ¨¡æ¿ä¸extend-syntaxæ¨¡æ¿ç›¸åŒã€‚\nwithå¯ç”¨äºå¼•å…¥æ–°çš„æ¨¡å¼æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦ç»‘å®šåˆ°extend-syntaxæ¨¡æ¿ä¸­çš„ä»»æ„Schemeè¡¨è¾¾å¼æ‰€ç”Ÿæˆçš„è¡¨è¾¾å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œwithå…è®¸ä»extend-syntaxçš„å£°æ˜å¼æ ·å¼è½¬ä¸ºfull Schemeçš„è¿‡ç¨‹å¼æ ·å¼ã€‚\nwithçš„ä¸€ç§å¸¸è§ç”¨æ³•æ˜¯åœ¨æ¨¡æ¿ä¸­å¼•å…¥ä¸´æ—¶æ ‡è¯†ç¬¦æˆ–ä¸´æ—¶æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚ å¦‚æœåœ¨extend-syntaxæ¡†æ¶å†…æ‰§è¡Œï¼Œwithä¹Ÿå¯ç”¨äºæ‰§è¡Œå¯èƒ½ç¬¨æ‹™æˆ–æ•ˆç‡ä½ä¸‹çš„å¤æ‚è½¬æ¢ã€‚\nä¾‹å¦‚ï¼Œoréœ€è¦ä½¿ç”¨ä¸´æ—¶æ ‡è¯†ç¬¦ã€‚ æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®šä¹‰orï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (let ([temp x]) (if temp temp (or y ...)))]) è¿™ä¼šä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°å°†orè¡¨è¾¾å¼æ”¾ç½®åœ¨tempå‘ç”Ÿçš„èŒƒå›´å†…ä¸ºæ­¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…ï¼Œå› ä¸ºextend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸã€‚ ï¼ˆè¿™æ˜¯define-syntaxä¼˜äºextend-syntaxçš„åŸå› ä¹‹ä¸€ã€‚ï¼‰\n(let ([temp #t]) (or #f temp)) â‡’ #f å¦‚æœå°†æ ‡è¯†ç¬¦tempæ¢ä¸ªåå­—ï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚å°±å¯ä»¥ç†è§£\u0026quot;extend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸ\u0026quot;è¿™å¥è¯äº†ã€‚ å®é™…ä¸Šï¼Œä¸Šè¿°çš„(let \u0026hellip;)è¡¨è¾¾å¼ï¼Œå±•å¼€ä¹‹åå°±å˜æˆäº†ï¼š\n(let ([temp #t]) (let ([temp #f]) (if temp temp (or temp)) ) ) ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨gensymå’Œwithæ¥åˆ›å»ºä¸´æ—¶æ ‡è¯†ç¬¦ï¼Œå¦‚ä¸‹ï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (with ([temp (gensym)]) (let ([temp x]) (if temp temp (or y ...))))]) è€Œä¸”ï¼Œwithå¯ä»¥ä»¥extend-syntaxæ— æ³•ç›´æ¥ä½¿ç”¨çš„æ–¹å¼æ¥ç»„åˆè¾“å…¥æ¨¡å¼çš„å…ƒç´ ï¼Œä¾‹å¦‚ä»¥ä¸‹folding-plusç¤ºä¾‹:\n(extend-syntax (folding-plus) [(folding-plus x y) (and (number? \u0026#39;x) (number? \u0026#39;y)) (with ([val (+ \u0026#39;x \u0026#39;y)]) val)] [(folding-plus x y) (+ x y)]) å¦‚æœxå’Œyå‡ä¸ºæ•°å­—å¸¸æ•°ï¼Œåˆ™folding-plusæŠ˜å ä¸ºï¼ˆ+ x yï¼‰çš„å€¼ã€‚ å¦åˆ™ï¼Œfolding-plusè½¬æ¢ä¸ºï¼ˆ+ x yï¼‰ä»¥ä¾›ä»¥åè¯„ä¼°ã€‚ fenderåœ¨æ‰©å±•æ—¶æ£€æŸ¥æ“ä½œæ•°æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¹¶ä½¿ç”¨withè¿›è¡Œæ±‚å€¼ã€‚ ä¸fenderä¸€æ ·ï¼Œæ‰©å±•ä»…åœ¨å¸¦å¼•å·çš„è¡¨è¾¾å¼å†…æ‰§è¡Œï¼Œå› ä¸ºquoteå°†æ•°æ®ä¸Schemeè¡¨è¾¾å¼çš„å…¶ä½™éƒ¨åˆ†åŒºåˆ†å¼€ã€‚\nä¸‹é¢çš„ç¤ºä¾‹åˆ©ç”¨withå…è®¸æˆ‘ä»¬å°†æ¨¡å¼ç»‘å®šåˆ°è¡¨è¾¾å¼è¿™ä¸€äº‹å®ï¼Œå°†æ¨¡å¼å˜é‡åˆ—è¡¨ç»‘å®šåˆ°ä¸´æ—¶ç¬¦å·åˆ—è¡¨ã€‚ æ­¤ä¸´æ—¶åˆ—è¡¨å¸®åŠ©æˆ‘ä»¬å®ç°sigmaè¯­æ³•æ‰©å±•ã€‚ sigmaä¸lambdaç›¸ä¼¼ï¼Œé™¤äº†å®ƒåœ¨æ ‡è¯†ç¬¦åˆ—è¡¨ä¸­åˆ†é…æ ‡è¯†ç¬¦è€Œä¸æ˜¯åˆ›å»ºæ–°ç»‘å®šä¹‹å¤–ã€‚ å®ƒå¯ç”¨äºå¹¶è¡Œæ‰§è¡Œä¸€ç³»åˆ—åˆ†é…ã€‚\n(extend-syntax (sigma) [(sigma (x ...) e1 e2 ...) (with ([(t ...) (map (lambda (x) (gensym)) \u0026#39;(x ...))]) (lambda (t ...) (set! x t) ... e1 e2 ...))]) (let ([x \u0026#39;a] [y \u0026#39;b]) ((sigma (x y) (list x y)) y x)) â‡’ (b a) ç»“æ„ä½“ æœ¬èŠ‚ä»‹ç»ä¸€ç§æœºåˆ¶ï¼Œç±»ä¼¼äºç¬¬7.15èŠ‚çš„recordå®šä¹‰æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ä½¿ç”¨å›ºå®šçš„å‘½åå­—æ®µé›†åˆ›å»ºæ•°æ®ç»“æ„ã€‚ ä¸recordç±»å‹ä¸åŒï¼Œç»“æ„ä½“ç±»å‹ä¸æ˜¯å”¯ä¸€ç±»å‹ï¼Œè€Œæ˜¯å®ç°ä¸ºå‘é‡ã€‚ å…·ä½“è€Œè¨€ï¼Œå°†ç»“æ„ä½“å®ç°ä¸ºå‘é‡ï¼Œå…¶é•¿åº¦æ¯”å­—æ®µæ•°å¤§ä¸€å€ï¼Œå¹¶ä¸”å…¶ç¬¬ä¸€ä¸ªå…ƒç´ åŒ…å«è¯¥ç»“æ„ä½“çš„ç¬¦å·åç§°ã€‚\nå°†ç»“æ„ä½“è¡¨ç¤ºä¸ºå‘é‡å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šç®€åŒ–ç»“æ„ä½“çš„è¯»å–å’Œæ‰“å°ä»¥åŠç»“æ„ä½“å®šä¹‰å·¥å…·çš„æ‰©å±•ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®æœ‰ä¸€äº›ç¼ºç‚¹ã€‚ ä¸€ä¸ªæ˜¯åœ¨ä¸é€‚å½“çš„æƒ…å†µä¸‹ï¼Œç»“æ„ä½“å¯èƒ½ä¼šè¢«é”™è¯¯åœ°è§†ä¸ºæ™®é€šå‘é‡ã€‚å½“åœ¨ç¨‹åºä¸­å¤„ç†ç»“æ„ä½“å’Œå‘é‡æ—¶ï¼Œåœ¨æ£€æŸ¥æ›´é€šç”¨çš„å‘é‡ç±»å‹ä¹‹å‰ï¼Œå¿…é¡»æ³¨æ„å…ˆå¯»æ‰¾æ›´å…·ä½“çš„ç»“æ„ä½“ç±»å‹ï¼Œä¾‹å¦‚åœ¨ä¸€ç³»åˆ—condå­å¥ä¸­ã€‚ä¸€ä¸ªç±»ä¼¼çš„ç¼ºç‚¹æ˜¯ï¼Œç»“æ„ä½“å®ä¾‹å®¹æ˜“è¢«æœ‰æ„æˆ–æ— æ„åœ°â€œä¼ªé€ â€ã€‚ ä¹Ÿä¸å¯èƒ½æ§åˆ¶å¦‚ä½•æ‰“å°å’Œè¯»å–ç»“æ„ä½“ã€‚\né€šè¿‡define-structureåˆ›å»ºç»“æ„ä½“ã€‚ æ¯ä¸ªç»“æ„ä½“å®šä¹‰å¼éƒ½å®šä¹‰ä¸€ä¸ªæ„é€ è¿‡ç¨‹ï¼Œä¸€ä¸ªç±»å‹è°“è¯ï¼Œæ¯ä¸ªå­—æ®µçš„è®¿é—®è¿‡ç¨‹ä»¥åŠæ¯ä¸ªå­—æ®µçš„åˆ†é…è¿‡ç¨‹ã€‚define-structureå…è®¸ç¨‹åºå‘˜æ§åˆ¶å“ªäº›å­—æ®µæ˜¯æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°ï¼Œä»¥åŠå“ªäº›å­—æ®µç”±æ„é€ å‡½æ•°è¿‡ç¨‹æ˜¾å¼åˆå§‹åŒ–ã€‚define-structureéå¸¸ç®€å•ï¼Œä½†å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´è¶³å¤Ÿå¼ºå¤§ï¼Œå¦‚æœè¿˜ä¸è¶³ä»¥åº”ä»˜åº”ç”¨ç¨‹åºçš„éœ€æ±‚è¿˜å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰©å±•ä»¥æ»¡è¶³ä¹‹ã€‚ æœ¬èŠ‚æœ«å°¾ç»™å‡ºçš„define-structureå®šä¹‰å¯ä»¥ä½œä¸ºæ›´å¤æ‚å˜ä½“çš„èµ·ç‚¹ã€‚\n(define-structure (name id1 \u0026hellip;) ((id2 expr) \u0026hellip;))\ndefine-structureå½¢å¼å¯ä»¥å‡ºç°åœ¨ä»»æ„ä½ç½®ã€‚\ndefine-structureå®šä¹‰ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„name ï¼Œå¹¶åˆ›å»ºä¸€ç»„ç”¨äºæ„é€ å’Œæ“ä½œè¯¥ç»“æ„å®ä¾‹çš„è¿‡ç¨‹ã€‚ æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; å‘½åæ•°æ®ç»“æ„çš„å­—æ®µã€‚\nä¸‹é¢çš„è¿‡ç¨‹éƒ½æœ‰define-structureå®šä¹‰ï¼š\nåä¸º**make-**name çš„æ„é€ è¿‡ç¨‹ åä¸ºname? çš„ç±»å‹è°“è¯ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸ºname-field çš„è®¿é—®è¿‡ç¨‹ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸º**set-**name-field! çš„åˆ†é…è¿‡ç¨‹ æ ‡è¯†ç¬¦id1 \u0026hellip; å‘½åçš„å­—æ®µç”±æ„é€ å‡½æ•°çš„å‚æ•°åˆå§‹åŒ–ã€‚ ç”±æ ‡è¯†ç¬¦id2 \u0026hellip; å‘½åçš„å­—æ®µè¢«æ˜¾å¼åˆå§‹åŒ–ä¸ºè¡¨è¾¾å¼expr \u0026hellip; çš„å€¼ã€‚æ¯ä¸ªè¡¨è¾¾å¼éƒ½åœ¨æ ‡è¯†ç¬¦id1 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…è¿›è¡Œæ±‚å€¼ï¼Œå¹¶ä¸”åœ¨æ ‡è¯†ç¬¦id2 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…å‡ºç°ï¼ˆç±»ä¼¼let*ï¼‰ ã€‚\nä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæ„é€ å‡½æ•°çš„è¡Œä¸ºå°±åƒå®šä¹‰ä¸ºï¼š\n(define make-name (lambda (id1 ...) (let* ([id2 expr ] ...) body ))) å…¶ä¸­body æ ¹æ®æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; çš„å€¼æ„å»ºç»“æ„ä½“ã€‚\nå¦‚æœä¸éœ€è¦é™¤æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–çš„å­—æ®µä»¥å¤–çš„å…¶ä»–å­—æ®µï¼Œåˆ™å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå­è¡¨è¾¾å¼*( (id2 expr) \u0026hellip;)* ã€‚\nä»¥ä¸‹ç®€å•ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨Schemeä¸­å®šä¹‰pairï¼ˆå¦‚æœå®ƒä»¬ä¸å­˜åœ¨çš„è¯ï¼‰ã€‚ è¿™ä¸¤ä¸ªå­—æ®µéƒ½ç”±æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–ã€‚\n(define-structure (pare car cdr)) (define p (make-pare â€™a â€™b)) (pare? p) â‡’ #t (pair? p) â‡’ #f (pare? â€™(a . b)) â‡’ #f (pare-car p) â‡’ a (pare-cdr p) â‡’ b (set-pare-cdr! p (make-pare \u0026#39;b \u0026#39;c)) (pare-car (pare-cdr p)) â‡’ b (pare-cdr (pare-cdr p)) â‡’ c ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªæ–¹ä¾¿çš„å­—ç¬¦ä¸²æ•°æ®ç»“æ„ï¼Œç§°ä¸ºstrext-string ï¼Œè¯¥ç»“æ„ä¼šæ ¹æ®éœ€è¦å¢é•¿ã€‚æœ¬ä¾‹å­ä¸­ï¼Œä¼šæ˜¾å¼åœ°åˆå§‹åŒ–ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œè¯¥å­—æ®µåœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ã€‚\n(define-structure (stretch-string length fill) ([string (make-string length fill)])) (define stretch-string-ref (lambda (s i) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-ref (stretch-string-string s) i)))) (define stretch-string-set! (lambda (s i c) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-set! (stretch-string-string s) i c)))) (define stretch-string-fill! (lambda (s c) (string-fill! (stretch-string-string s) c) (set-stretch-string-fill! s c))) (define stretch-stretch-string! (lambda (s i n) (set-stretch-string-length! s i) (let ([str (stretch-string-string s)] [fill (stretch-string-fill s)]) (let ([xtra (make-string (- i n) fill)]) (set-stretch-string-string! s (string-append str xtra)))))) é€šå¸¸ï¼Œå¤§å¤šæ•°è‡ªåŠ¨å®šä¹‰çš„è¿‡ç¨‹éƒ½ç”¨äºå®šä¹‰æ›´ç‰¹æ®Šçš„è¿‡ç¨‹ï¼Œ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯´çš„å°±æ˜¯stretch-string-ref ** å’Œstretch-string-set!ã€‚è€Œstretch-string-length** å’Œ stretch-string-stringæ˜¯æƒŸä¸€ç›´æ¥ä½¿ç”¨çš„è‡ªåŠ¨ç”Ÿæˆçš„è¿‡ç¨‹ã€‚\n(define ss (make-stretch-string 2 #\\X)) (stretch-string-string ss) â‡’ \u0026#34;XX\u0026#34; (stretch-string-ref ss 3) â‡’ #\\X (stretch-string-length ss) â‡’ 4 (stretch-string-string ss) â‡’ \u0026#34;XXXX\u0026#34; (stretch-string-fill! ss #\\@) (stretch-string-string ss) â‡’ \u0026#34;@@@@\u0026#34; (stretch-string-ref ss 5) â‡’ #\\@ (stretch-string-string ss) â‡’ \u0026#34;@@@@@@\u0026#34; (stretch-string-set! ss 7 #\\=) (stretch-string-length ss) â‡’ 8 (stretch-string-string ss) â‡’ \u0026#34;@@@@@@@=\u0026#34; ã€ŠThe Scheme Programming Languageã€‹ï¼ˆç¬¬4ç‰ˆï¼‰çš„8.4èŠ‚å®šä¹‰äº†define-structureçš„ç®€åŒ–å˜ä½“ï¼Œä½œä¸ºä½¿ç”¨syntax-caseçš„ç¤ºä¾‹ã€‚ ä¸‹é¢ç»™å‡ºçš„å®šä¹‰å®ç°äº†å®Œæ•´ç‰ˆæœ¬ã€‚\n(define-syntax define-structure (lambda (x) (define gen-id (lambda (template-id . args) (datum-\u0026gt;syntax template-id (string-\u0026gt;symbol (apply string-append (map (lambda (x) (if (string? x) x (symbol-\u0026gt;string (syntax-\u0026gt;datum x)))) args)))))) (syntax-case x () ((_ (name field1 ...)) (andmap identifier? #\u0026#39;(name field1 ...)) #\u0026#39;(define-structure (name field1 ...) ())) ((_ (name field1 ...) ((field2 init) ...)) (andmap identifier? #\u0026#39;(name field1 ... field2 ...)) (with-syntax ((constructor (gen-id #\u0026#39;name \u0026#34;make-\u0026#34; #\u0026#39;name)) (predicate (gen-id #\u0026#39;name #\u0026#39;name \u0026#34;?\u0026#34;)) ((access ...) (map (lambda (x) (gen-id x #\u0026#39;name \u0026#34;-\u0026#34; x)) #\u0026#39;(field1 ... field2 ...))) ((assign ...) (map (lambda (x) (gen-id x \u0026#34;set-\u0026#34; #\u0026#39;name \u0026#34;-\u0026#34; x \u0026#34;!\u0026#34;)) #\u0026#39;(field1 ... field2 ...))) (structure-length (+ (length #\u0026#39;(field1 ... field2 ...)) 1)) ((index ...) (let f ([i 1] [ids #\u0026#39;(field1 ... field2 ...)]) (if (null? ids) \u0026#39;() (cons i (f (+ i 1) (cdr ids))))))) #\u0026#39;(begin (define constructor (lambda (field1 ...) (let* ([field2 init] ...) (vector \u0026#39;name field1 ... field2 ...)))) (define predicate (lambda (x) (and (vector? x) (#3%fx= (vector-length x) structure-length) (eq? (vector-ref x 0) \u0026#39;name)))) (define access (lambda (x) (vector-ref x index))) ... (define assign (lambda (x update) (vector-set! x index update))) ...)))))) ","id":93,"section":"posts","summary":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯","tags":["scheme"],"title":"å…¼å®¹æ€§ï¼ˆCompatibility Features in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/compatibility/","year":"2020"},{"content":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹ç³»ç»Ÿï¼ˆpthreadsï¼‰ä¹‹ä¸Šå®ç°ï¼Œå¹¶åœ¨åŸºäºWindowsçš„ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨Windows APIã€‚ æœ‰å…³çº¿ç¨‹åˆ›å»ºå’Œäº¤äº’çš„åŸºæœ¬è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…ç³»ç»Ÿä¸Šçš„ç›¸åº”æ–‡æ¡£ã€‚\nå¤§å¤šæ•°åŸç”Ÿçš„Schemeè¿‡ç¨‹éƒ½æ˜¯çº¿ç¨‹å®‰å…¨ çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶è°ƒç”¨å®ƒä»¬ã€‚ è¿™åŒ…æ‹¬è¯¸å¦‚conså’Œmake-stringä¹‹ç±»çš„åˆ†é…æ“ä½œï¼Œè¯¸å¦‚carå’Œvector-refä¹‹ç±»çš„è®¿é—®å™¨ï¼Œè¯¸å¦‚**+å’Œsqrtä¹‹ç±»çš„æ•°å­—è¿ç®—ç¬¦ä»¥åŠè¯¸å¦‚appendå’Œmap**ä¹‹ç±»çš„éç ´åæ€§çš„é«˜çº§åŸç”Ÿæ“ä½œã€‚\nç®€å•çš„å˜åŠ¨è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚set-carï¼ï¼Œvector-setï¼å’Œrecordå­—æ®µå˜åŠ¨å™¨ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åŒæ ·ï¼Œå¯¹å±€éƒ¨å˜é‡çš„åˆ†é…ï¼ŒåŒ…æ‹¬ï¼ˆæœªå¯¼å‡ºçš„ï¼‰åº“å’Œé¡¶çº§ç¨‹åºå˜é‡çš„åˆ†é…ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nå¤§å¤šæ•°I/Oæ“ä½œåº”è¢«è§†ä¸ºå…·æœ‰ç ´åæ€§ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šä¿®æ”¹ç«¯å£çš„å†…éƒ¨ç»“æ„ã€‚\nä½¿ç”¨æ²¡æœ‰è¿›è¡Œåˆé€‚çš„åŒæ­¥ç­–ç•¥çš„éçº¿ç¨‹å®‰å…¨çš„è¿ç®—ç¬¦å¯èƒ½ä¼šç ´åå®ƒä»¬æ‰€æ“ä½œçš„å¯¹è±¡ã€‚ è¿™ç§æŸåå¯èƒ½å¯¼è‡´é”™è¯¯çš„è¡Œä¸ºï¼Œå†…å­˜æ•…éšœï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿä¸­æ­¢çš„ä¸å¯æ¢å¤çš„é”™è¯¯ã€‚\nçº¿ç¨‹åˆ›å»º (fork-thread thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—0ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚\nfork-threadåœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è°ƒç”¨thunk ï¼Œå¹¶è¿”å›ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚\né™¤äº†æ‰“å°å®ƒå¤–ï¼Œfork-threadè¿”å›çš„çº¿ç¨‹å¯¹è±¡æ— æ³•æ‰§è¡Œä»»ä½•æ“ä½œã€‚\né™¤äº†ä½¿ç”¨fork-threadä»¥å¤–ï¼Œå¯é€šè¿‡å¤–éƒ¨ä»£ç æ¥åˆ›å»ºçš„çº¿ç¨‹å¿…é¡»åœ¨è§¦åŠä»»ä½•Schemeæ•°æ®æˆ–è°ƒç”¨ä»»ä½•Schemeè¿‡ç¨‹ä¹‹å‰è°ƒç”¨Sactivate_thread\n(thread? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè¿”å›#t,å¦åˆ™è¿”å›#f\n(get-thread-id)\nè¿”å›ï¼šå½“å‰çº¿ç¨‹çš„id\nçº¿ç¨‹idæ˜¯ç”±çº¿ç¨‹åˆ†é…çš„çº¿ç¨‹å·ï¼Œå¹¶ä¸”ä¸get-process-idè¿”å›çš„è¿›ç¨‹idæ²¡æœ‰å…³ç³»ï¼Œè¿›ç¨‹idåœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚\näº’æ–¥é” (make-mutex)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„äº’æ–¥é”å¯¹è±¡\n(mutex? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯äº’æ–¥é”ï¼Œè¿”å›#t\n(mutex-acquire mutex) | (mutex-acquire mutex block?)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-acquireè·å–ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚å¯é€‰çš„boolå‚æ•°blockï¼Ÿ é»˜è®¤ä¸º#tï¼ŒæŒ‡å®šçº¿ç¨‹æ˜¯å¦åº”é˜»å¡ç­‰å¾…äº’æ–¥é”ã€‚blockï¼Ÿ å¦‚æœçœç•¥æˆ–ä¸ºtrueï¼Œåˆ™çº¿ç¨‹å°†é˜»å¡ï¼Œç›´åˆ°è·å–äº†äº’æ–¥é”ä¸ºæ­¢ï¼Œå¹¶è¿”å›æœªæŒ‡å®šçš„å€¼ã€‚\nå¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”äº’æ–¥é”å½“å‰å·²å±äºå…¶ä»–çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ï¼Œmutex-acquireç«‹å³è¿”å›å€¼**#f**ï¼Œä»¥æŒ‡ç¤ºäº’æ–¥é”ä¸å¯ç”¨ã€‚ å¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”æˆåŠŸè·å–äº†äº’æ–¥é”ï¼Œmutex-acquireè¿”å›#tã€‚\näº’æ–¥é”åœ¨Posixçº¿ç¨‹æœ¯è¯­ä¸­æ˜¯é€’å½’çš„ï¼Œè¿™æ„å‘³ç€è°ƒç”¨çº¿ç¨‹å¯ä»¥ä½¿ç”¨äº’æ–¥é”è·å–ï¼ˆé‡æ–°ï¼‰è·å–å®ƒå·²ç»æ‹¥æœ‰çš„äº’æ–¥é”ï¼ˆæ³¨ï¼šé”æ˜¯å¯ä»¥é‡å…¥çš„ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡Šæ”¾äº’æ–¥é”éœ€è¦æ‰§è¡Œç›¸ç­‰æ•°é‡çš„mutex-releaseã€‚\n(mutex-release mutex)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-releaseé‡Šæ”¾ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚ å¦‚æœmutex ä¸å±äºè°ƒç”¨çº¿ç¨‹ï¼ˆå³é‡Šæ”¾åˆ«äººçš„äº’æ–¥é”ï¼‰ï¼Œåˆ™ä¼šå¯¼è‡´æ— æ³•é¢„æ–™çš„è¡Œä¸ºã€‚\n(with-mutex mutex body1 body2 \u0026hellip;)\nwith-mutexè®¡ç®—è¡¨è¾¾å¼mutex ï¼Œå…¶å¿…é¡»å¯ä»¥è®¡ç®—ä¸ºä¸€ä¸ªäº’æ–¥é”ï¼Œè·å–é”ï¼Œå¹¶è®¡ç®—body1 body2 \u0026hellip; ,ç„¶åé‡Šæ”¾é”ã€‚æ— è®ºbodyæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯é€šè¿‡æ§åˆ¶æ“ä½œï¼ˆå³å¯èƒ½ç”±äºé”™è¯¯è€ŒæŠ›åˆ°continuationï¼‰é‡Šæ”¾äº’æ–¥é‡ï¼Œè¿™éƒ½ä¼šå¯¼è‡´with-mutexå½¢å¼çš„éæœ¬åœ°é€€å‡ºã€‚å¦‚æœæ§åˆ¶éšåé€šè¿‡continuationè°ƒç”¨è¿”å›åˆ°bodyï¼Œåˆ™å°†é‡æ–°è·å–äº’æ–¥é”ã€‚\nä¸ç›´æ¥ä½¿ç”¨mutex-acquireå’Œmutex-releaseç›¸æ¯”ï¼Œä½¿ç”¨with-mutexé€šå¸¸æ›´æ–¹ä¾¿ï¼Œæ›´å®‰å…¨ã€‚\næ¡ä»¶ (make-condition)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„æ¡ä»¶å¯¹è±¡\n(thread-condition? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œè¿”å›#t\n(condition-wait cond mutex) | (condition-wait cond mutex timeout)\nè¿”å›ï¼šå¦‚æœè°ƒç”¨çº¿ç¨‹è¢«æ¡ä»¶å”¤é†’è¿”å›#tï¼Œå¦‚æœè°ƒç”¨çº¿ç¨‹è¶…æ—¶ç­‰å¾…è¿”å›#f\ncond å¿…é¡»æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”mutex å¿…é¡»æ˜¯äº’æ–¥é”ã€‚ å¯é€‰å‚æ•°timeout æ˜¯ç±»å‹ä¸ºtime-durationæˆ–time-utcæˆ–**#fçš„æ—¶é—´è®°å½•ï¼Œè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶ã€‚ é»˜è®¤ä¸º#f**ã€‚\ncondition-waitç­‰å¾…ç”±cond æ ‡è¯†çš„æ¡ä»¶ï¼Œä¸”ç­‰å¾…æŒ‡å®šçš„timeoutæ—¶é•¿ã€‚åœ¨è°ƒç”¨condition-waitæ—¶ï¼Œè°ƒç”¨çº¿ç¨‹å¿…é¡»å·²è·å–äº’æ–¥é”mutex ã€‚ç”±äºè°ƒç”¨condition-waitçš„å‰¯ä½œç”¨è€Œé‡Šæ”¾äº†mutex ã€‚å½“ç¨åé€šè¿‡ä¸‹è¿°çš„è¿‡ç¨‹ä¹‹ä¸€ä»æ¡ä»¶å˜é‡é‡Šæ”¾çº¿ç¨‹æˆ–è¶…æ—¶åˆ°æœŸæ—¶ï¼Œå°†é‡æ–°è·å–mutex ï¼Œå¹¶è¿”å›condition-waitã€‚\n(condition-signal cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-signalé‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªã€‚\n(condition-broadcast cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-broadcasté‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹\né” é”æ¯”äº’æ–¥é”æ›´åŸç”Ÿï¼Œä½†æ˜¯æ›´åŠ çµæ´»å’Œæœ‰æ•ˆã€‚\nåªè¦é”åœ¨è¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­åˆ†é…ï¼Œå®ƒä»¬è¿˜å¯ä»¥ç‹¬ç«‹äºçº¿ç¨‹ç³»ç»Ÿä½¿ç”¨ï¼ˆåŒ…æ‹¬åœ¨Chez Schemeçš„éçº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼‰ä»¥åœ¨åˆ†ç¦»çš„Schemeè¿›ç¨‹ä¸­æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ é”åªæ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³iptræˆ–uptrå¤–éƒ¨ç±»å‹ï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡è®¡ç®—æœºçš„æœ¬æœºå­—èŠ‚åºï¼Œå¯èƒ½æ˜¯ä½¿ç”¨define-ftypeå®šä¹‰çš„å¤§ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚å¿…é¡»åœ¨é©»ç•™äºSchemeå †å¤–éƒ¨çš„å†…å­˜ä¸­æ˜¾å¼åˆ†é…å®ƒï¼Œå¹¶åœ¨é€‚å½“æ—¶æ˜¾å¼é‡Šæ”¾ã€‚å½“ä»…æ¶‰åŠçº¿ç¨‹æ—¶ï¼ˆå³ï¼Œå½“ä¸æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡foreign-allocåˆ†é…å†…å­˜ã€‚ å½“æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼Œåº”åœ¨è¿›ç¨‹å…±äº«çš„æŸä¸ªåŒºåŸŸä¸­åˆ†é…è¯¥é”ã€‚\nä½¿ç”¨ftype-init-lock! åˆå§‹åŒ–åï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥å°è¯•é€šè¿‡**ftype-lock!æˆ–ftype-spin-lock!é”å®šlock ã€‚ä¸€æ—¦é”å·²è¢«é”å®šå¹¶ä¸”åœ¨è§£é”ä¹‹å‰ï¼Œå³ä½¿é€šè¿‡æœ€è¿‘é”å®šå®ƒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œå†ä¸€æ¬¡å°è¯•é”å®šè¯¥é”ä¹Ÿä¼šå¤±è´¥ã€‚ ä»»ä½•è¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥ä½¿ç”¨ftype-unlock!**æ¥è§£é”lockï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡æœ€è¿‘é”å®šé”çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ¥è§£é”ã€‚\né”æœºåˆ¶æä¾›çš„ç»“æ„å¾ˆå°‘ï¼Œå¹¶ä¸”åˆ†é…å’Œä½¿ç”¨ä¸­çš„é”™è¯¯å¯èƒ½å¯¼è‡´å†…å­˜é”™è¯¯ï¼Œæ­»é”å’Œå…¶ä»–é—®é¢˜ã€‚ å› æ­¤ï¼Œé€šå¸¸å»ºè®®ä»…å°†é”ç”¨ä½œæ›´é«˜çº§åˆ«æŠ½è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æŒ‰è§„èŒƒæ–¹å¼ä½¿ç”¨é”ã€‚\n(define lock (make-ftype-pointer uptr (foreign-alloc (ftype-sizeof uptr)))) (ftype-init-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #t (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-spin-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr index)\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\n**ftype-init-lock!**åº”è¯¥åœ¨ä½¿ç”¨ä»»ä½•å…¶ä»–è¿ç®—ç¬¦ä¹‹å‰ç”¨äºåˆå§‹åŒ–é”ï¼› å¦‚æœä¸è¿™æ ·åšï¼Œåˆ™å…¶ä»–æ“ä½œç¬¦çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚\nftype-lock! å¯ç”¨äºåŠ é”ã€‚å¦‚æœå‘ç°åœ¨æ“ä½œæ—¶é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›#tï¼›å¦‚æœå‘ç°è¯¥é”å·²åŠ é”ï¼Œåˆ™è¿”å›#fä¸”ä¸æ›´æ”¹è¯¥é”ã€‚\nftype-spin-lock! ä¹Ÿå¯ä»¥ç”¨æ¥åŠ é”ã€‚ å¦‚æœåœ¨æ“ä½œæ—¶å‘ç°è¯¥é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›ï¼› å¦‚æœå‘ç°è¯¥é”å·²é”å®šï¼Œå®ƒå°†ä¸€ç›´ç­‰å¾…ç›´åˆ°é”è¢«è§£é”ï¼Œç„¶åå†é”å®šå¹¶è¿”å›ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–è¿›ç¨‹æˆ–è€…çº¿ç¨‹æ¥é‡Šæ”¾è¯¥é”ï¼Œè¯¥æ“ä½œä¸ä¼šè¿”å›ä¸”ä¸èƒ½ä»¥æ­£å¸¸çš„æ–¹å¼ï¼ˆåŒ…æ‹¬GCï¼‰ä¸­æ–­ã€‚ä¹Ÿä¸ä¿è¯å…¬å¹³ï¼Œå› æ­¤å³ä½¿å…¶ä»–è¿›ç¨‹æ­£åœ¨ä¸»åŠ¨é”å®šå’Œé‡Šæ”¾è¯¥é”ï¼Œè¿›ç¨‹ä¹Ÿå¯èƒ½æ— é™æœŸæŒ‚èµ·ã€‚\nftype-unlock! ç”¨äºè§£é”ã€‚å¦‚æœå‘ç°é”å·²è¢«é”å®šï¼Œåˆ™å°†å…¶è§£é”å¹¶è¿”å›ã€‚ å¦åˆ™ï¼Œå®ƒå°†è¿”å›è€Œä¸æ›´æ”¹é”ã€‚\nåŸå­æ“ä½œLocked increment and decrement å½“éœ€è¦åŸå­é€’å¢æˆ–é€’å‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¤„æè¿°çš„é”å®šæ“ä½œã€‚\n(ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\n(ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\nftype-locked-incr! è‡ªåŠ¨è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œå°†å€¼åŠ 1ï¼Œç„¶åå°†æ–°å€¼å†™å›è¯¥å­—æ®µã€‚ åŒæ ·ï¼Œftype-locked-decr! åŸå­è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œä»è¯¥å€¼ä¸­å‡å»1ï¼Œç„¶åå°†æ–°å€¼å†™å›åˆ°è¯¥å­—æ®µä¸­ã€‚ å¦‚æœæ–°å€¼ä¸º0ï¼Œåˆ™ä¸¤è€…éƒ½è¿”å›#tï¼Œå¦åˆ™è¿”å›#fã€‚\nå¼•ç”¨è®¡æ•° åœ¨Schemeå †ä¹‹å¤–ç®¡ç†å†…å­˜çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨Schemeå­˜å‚¨ç®¡ç†ç³»ç»Ÿé€šè¿‡ftype guardians æ‰§è¡Œå¼•ç”¨è®¡æ•°ã€‚ åœ¨å¼•ç”¨è®¡æ•°çš„å†…å­˜ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¿å­˜ç€æŒ‡å‘å®ƒçš„æŒ‡é’ˆè®¡æ•°ã€‚ å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å¢åŠ ï¼›è€Œåœ¨åˆ é™¤æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å‡å°ã€‚ å½“è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œä¸å†éœ€è¦è¯¥å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç”¨äºå…¶ä»–ç›®çš„ã€‚\n(ftype-guardian ftype-name)\nftype-name å¿…é¡»å‘½åä¸€ä¸ªftypeã€‚ ftypeçš„ç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼ˆæˆ–åœ¨unionsçš„æƒ…å†µä¸‹ä¸ºç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼‰å¿…é¡»æ˜¯å…·æœ‰æœ¬åœ°å°¾æ•°çš„å­—é•¿æ•´æ•°ï¼ˆiptræˆ–uptrï¼‰ã€‚ å‡å®šæ­¤å­—æ®µä¿å­˜å¼•ç”¨è®¡æ•°ã€‚\nè¿”å›æ–°çš„ftype guardian g ï¼Œå¯ä»¥ä½¿ç”¨å…¶æ³¨å†Œftype-name ç±»å‹ï¼ˆæˆ–ftype-nam eçš„æŸäº›å­ç±»å‹ï¼‰çš„ftype-pointerã€‚ é€šè¿‡ä½¿ç”¨ftypeæŒ‡é’ˆä½œä¸ºå‚æ•°è°ƒç”¨g ï¼Œå¯ä»¥å‘g æ³¨å†ŒftypeæŒ‡é’ˆã€‚\nftype guardianä¸ä¼šåƒæ™®é€šçš„guardiané‚£æ ·è‡ªåŠ¨ä¿æŠ¤å…¶æ³¨å†Œçš„ftypeæŒ‡é’ˆå…é­å›æ”¶ã€‚è€Œæ˜¯ï¼Œå¯¹äºæ¯ä¸ªé€šè¿‡æ™®é€šï¼ˆéå¼±ï¼Œéç›‘æŠ¤äººæŒ‡é’ˆï¼‰å˜å¾—ä¸å¯è®¿é—®çš„å·²æ³¨å†Œçš„ftypeæŒ‡é’ˆï¼Œguardianä¼šå‡å°‘ftypeæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å€¼ä¸º0ï¼Œåˆ™ftypeæŒ‡é’ˆå°†ä¿ç•™å¹¶å¯ä»¥ä»guardianä¸­æ£€ç´¢ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆçš„å¼•ç”¨è®¡æ•°å€¼éé›¶ï¼Œåˆ™ä¸ä¼šä¿ç•™ftypeæŒ‡é’ˆã€‚å‡è®¾å›æ”¶å™¨å¤–éƒ¨çš„ä»£ç æ­£ç¡®ç»´æŠ¤äº†å¼•ç”¨è®¡æ•°ï¼Œåˆ™ä»ftype guardianæ£€ç´¢çš„å¯¹è±¡ï¼ˆé€šè¿‡ä¸å¸¦å‚æ•°çš„è°ƒç”¨ï¼‰å°†ç¡®ä¿å…·æœ‰0å¼•ç”¨è®¡æ•°ã€‚å›æ”¶å™¨ä½¿ç”¨ç­‰æ•ˆçš„ftype-locked-decr!æ¥å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œä»¥æ”¯æŒç”±å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­çš„éSchemeå¯¹è±¡ã€‚åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œç¨‹åºæœ¬èº«åº”ä½¿ç”¨ftype-locked-incr! å’Œftype-locked-decr! æˆ–éSchemeç­‰æ•ˆé¡¹ï¼ˆä¾‹å¦‚ï¼Œç¬¬4.8èŠ‚ä¸­æ‰€è¿°Cè¯­è¨€çš„scheme.hä¸­çš„ LOCKED_INCRå’ŒLOCKED_DECRå®ï¼‰æ¥ç»´æŠ¤å¼•ç”¨è®¡æ•°ã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä¸ºftypeå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ftypeå’Œä¸€ä¸ªåˆ†é…å™¨ï¼Œè¯¥å¯¹è±¡é‡Šæ”¾ä»¥å‰åˆ†é…çš„ä¸”ä¸å†å¯è®¿é—®çš„ftypeå¯¹è±¡ã€‚\nmodule (A make-A free-dropped-As) (define-ftype A (struct [refcount uptr] [data int])) (define g (ftype-guardian A)) (define free-dropped-As (lambda () (let ([a (g)]) (when a (printf \u0026#34;freeing ~s\\n\u0026#34; (ftype-ref A (data) a)) (foreign-free (ftype-pointer-address a)) (free-dropped-As))))) (define make-A (lambda (n) (free-dropped-As) (let ([a (make-ftype-pointer A (foreign-alloc (ftype-sizeof A)))]) (ftype-set! A (refcount) a 1) (ftype-set! A (data) a n) (g a) a)))) æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…ï¼Œä¸¢å¼ƒå¹¶ç«‹å³å›æ”¶æŒ‡å‘Açš„ftypeæŒ‡é’ˆè¿›è¡Œæµ‹è¯•ã€‚\n\u0026gt; (do ([i 10 (fx- i 1)]) ((fx= i 0)) (make-A i) (collect)) freeing 10 freeing 9 freeing 8 freeing 7 freeing 6 freeing 5 freeing 4 freeing 3 freeing 2 \u0026gt; (free-dropped-As) freeing 1 ç”±ftype guardianä¿æŠ¤çš„å¯¹è±¡å¯èƒ½åŒ…å«æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¿™äº›å…¶ä»–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¹Ÿåº”åœ¨åˆ†é…åŒ…å«å¯¹è±¡æ—¶å¢åŠ ï¼Œå¹¶åœ¨é‡Šæ”¾åŒ…å«å¯¹è±¡æ—¶å‡å°‘ã€‚\nçº¿ç¨‹å‚æ•° (make-thread-parameter object) | (make-thread-parameter object procedure)\nåˆ›å»ºçº¿ç¨‹å‚æ•°åï¼Œå°†åœ¨æ¯ä¸ªå½“å‰çº¿ç¨‹å’Œå°†æ¥çš„çº¿ç¨‹ä¸­æ”¾ç½®ä¸€ä¸ªå•ç‹¬çš„ä½ç½®ï¼Œä»¥ä¿å­˜å‚æ•°çš„å†…éƒ¨çŠ¶æ€å˜é‡çš„å€¼ã€‚ ï¼ˆå½“è¯¥å‚æ•°å˜å¾—ä¸å¯è®¿é—®æ—¶ï¼Œå­˜å‚¨ç®¡ç†å™¨å¯ä»¥æ¶ˆé™¤è¯¥ä½ç½®ã€‚ï¼‰ä¸€ä¸ªçº¿ç¨‹ä¸­å¯¹çº¿ç¨‹å‚æ•°çš„æ›´æ”¹ä¸ä¼šè¢«å…¶ä»–ä»»ä½•çº¿ç¨‹çœ‹åˆ°ã€‚\nåˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼ˆè¯·å‚é˜…fork-threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»æ´¾ç”Ÿçº¿ç¨‹ç»§æ‰¿ã€‚ ç±»ä¼¼åœ°ï¼Œå½“ç¬¬ä¸€æ¬¡æ¿€æ´»é€šè¿‡å…¶ä»–æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ—¶ï¼ˆè¯·å‚è§4.8èŠ‚ä¸­çš„Sactivate_threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»ä¸»ï¼ˆåŸå§‹ï¼‰çº¿ç¨‹ç»§æ‰¿ã€‚\nå¤§å¤šæ•°å†…ç½®å‚æ•°æ˜¯çº¿ç¨‹å‚æ•°ï¼Œä½†æœ‰äº›æ˜¯å…¨å±€çš„ã€‚ åœ¨ä»–ä»¬å®šä¹‰çš„åœ°æ–¹å·²ç»æ ‡æ³¨äº†æ˜¯çº¿ç¨‹çš„è¿˜æ˜¯å…¨å±€çš„ã€‚ åœ¨éçº¿ç¨‹ç‰ˆæœ¬çš„Chez Schemeä¸­ï¼Œå†…ç½®å…¨å±€å‚æ•°å’Œçº¿ç¨‹å‚æ•°ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚\nI/O ç¼“å†²åŒº Chez Schemeä¸ºæé«˜æ•ˆç‡è€Œç¼“å†²æ–‡ä»¶I/Oæ“ä½œï¼Œä½†æ˜¯ç¼“å†²çš„I/Oä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç¼“å†²ç«¯å£å¯èƒ½ä¼šç ´åè¯¥ç«¯å£ï¼Œä»è€Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶æœ€ç»ˆå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ã€‚\nå½“ä»¥ç¼“å†²æ¨¡å¼noneæ‰“å¼€æ—¶ï¼Œå¯ä»¥ç¦ç”¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ä¸Šçš„ç¼“å†²ã€‚ ä½†æ˜¯ï¼Œç”±äºéœ€è¦æ”¯æŒå…ˆè¡Œï¼ˆlookaheadï¼‰ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨è¾“å…¥ç«¯å£ä¸Šçš„ç¼“å†²ï¼Œå¹¶ä¸”ç”±äºè¦åœ¨å­—ç¬¦å’Œå­—èŠ‚ä¹‹é—´è¿›è¡Œè½¬æ¢çš„ä»£ç è½¬æ¢å™¨æœ‰æ—¶éœ€è¦å…ˆè¡Œè¾“å…¥ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨æ–‡æœ¬ç«¯å£ï¼ˆç”šè‡³æ˜¯æ–‡æœ¬è¾“å‡ºç«¯å£ï¼‰ä¸Šçš„ç¼“å†²ã€‚\nå› æ­¤ï¼Œé™¤éåœ¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£å¼€å¯ç¼“å†²æ¨¡å¼ä¸ºnoneçš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦åˆ™ä¸¤ä¸ªçº¿ç¨‹ç»ä¸åº”è¯¥å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç«¯å£ã€‚æ›¿ä»£æ–¹æ³•åŒ…æ‹¬æŒ‡å®šä¸€ä¸ªçº¿ç¨‹ä¸ºç»™å®šç«¯å£æ‰§è¡Œæ‰€æœ‰I / Oï¼Œå’Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›é€šç”¨ç«¯å£åŒ…è£…ç¨‹åºï¼Œä»…åœ¨è·å–äº’æ–¥é‡åæ‰å°†è¯·æ±‚è½¬å‘åˆ°ç«¯å£ã€‚\nåˆå§‹çš„æ§åˆ¶å°ä»¥åŠå½“å‰çš„è¾“å…¥å’Œè¾“å‡ºç«¯å£ä»¥åŠtranscriptç«¯å£éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¤šä¸ªçº¿ç¨‹å‘æ§åˆ¶å°æ‰“å°é”™è¯¯å’Œ/æˆ–è°ƒè¯•æ¶ˆæ¯æ˜¯å®‰å…¨çš„ã€‚å³ä½¿åœ¨åŒä¸€è¡Œå†…ï¼Œè¾“å‡ºä¹Ÿå¯èƒ½æ˜¯äº¤é”™çš„ï¼Œä½†æ˜¯ç«¯å£ä¸ä¼šæŸåã€‚ è¿™äº›ç«¯å£çš„çº¿ç¨‹å®‰å…¨æ€§æ˜¯é€šè¿‡ä¸ºæ¯ä¸ªI/Oæ“ä½œè·å–ä¸€ä¸ªäº’æ–¥é”çš„é«˜æˆæœ¬æ¥å®ç°çš„ã€‚\nå®ä¾‹ï¼šæœ‰ç•Œé˜Ÿåˆ— ä»¥ä¸‹ä»£ç æ‘˜è‡ªæ–‡ç« â€œA Scheme for native threads1â€ï¼Œå®ƒä½¿ç”¨è®¸å¤šçº¿ç¨‹ç³»ç»ŸåŠŸèƒ½å®ç°äº†æœ‰ç•Œé˜Ÿåˆ—ã€‚ æœ‰ç•Œé˜Ÿåˆ—å…·æœ‰å›ºå®šæ•°é‡çš„å¯ç”¨æ’æ§½ã€‚ å½“é˜Ÿåˆ—å·²æ»¡æ—¶å°è¯•å…¥é˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚ å°è¯•ä»ç©ºé˜Ÿåˆ—ä¸­å‡ºé˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚\n(define-record-type bq (fields (immutable data) (mutable head) (mutable tail) (immutable mutex) (immutable ready) (immutable room)) (protocol (lambda (new) (lambda (bound) (new (make-vector bound) 0 0 (make-mutex) (make-condition) (make-condition)))))) (define dequeue! (lambda (q) (with-mutex (bq-mutex q) (let loop () (let ([head (bq-head q)]) (cond [(= head (bq-tail q)) (condition-wait (bq-ready q) (bq-mutex q)) (loop)] [else (bq-head-set! q (incr q head)) (condition-signal (bq-room q)) (vector-ref (bq-data q) head)])))))) (define enqueue! (lambda (item q) (with-mutex (bq-mutex q) (let loop () (let* ([tail (bq-tail q)] [tail^ (incr q tail)]) (cond [(= tail^ (bq-head q)) (condition-wait (bq-room q) (bq-mutex q)) (loop)] [else (vector-set! (bq-data q) tail item) (bq-tail-set! q tail^) (condition-signal (bq-ready q))])))))) (define incr (lambda (q i) (modulo (+ i 1) (vector-length (bq-data q))))) ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æœ‰ç•Œé˜Ÿåˆ—åœ¨ä¸€ç»„çº¿ç¨‹ä¸­çš„åº”ç”¨ï¼Œè¿™äº›çº¿ç¨‹åˆ†åˆ«æ‰®æ¼”æ•°æ®çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ã€‚\n(define job-queue) (define die? #f) (define make-job (let ([count 0]) (define fib (lambda (n) (if (\u0026lt; n 2) n (+ (fib (- n 2)) (fib (- n 1)))))) (lambda (n) (set! count (+ count 1)) (printf \u0026#34;Adding job #~s = (lambda () (fib ~s))\\n\u0026#34; count n) (cons count (lambda () (fib n)))))) (define make-producer (lambda (n) (rec producer (lambda () (printf \u0026#34;producer ~s posting a job\\n\u0026#34; n) (enqueue! (make-job (+ 20 (random 10))) job-queue) (if die? (printf \u0026#34;producer ~s dying\\n\u0026#34; n) (producer)))))) (define make-consumer (lambda (n) (rec consumer (lambda () (printf \u0026#34;consumer ~s looking for a job~%\u0026#34; n) (let ([job (dequeue! job-queue)]) (if die? (printf \u0026#34;consumer ~s dying\\n\u0026#34; n) (begin (printf \u0026#34;consumer ~s executing job #~s~%\u0026#34; n (car job)) (printf \u0026#34;consumer ~s computed: ~s~%\u0026#34; n ((cdr job))) (consumer)))))))) (define (bq-test np nc) (set! job-queue (make-bq (max nc np))) (do ([np np (- np 1)]) ((\u0026lt;= np 0)) (fork-thread (make-producer np))) (do ([nc nc (- nc 1)]) ((\u0026lt;= nc 0)) (fork-thread (make-consumer nc)))) è¿™æ˜¯ç¤ºä¾‹ç¨‹åºè¿è¡Œåçš„å¯èƒ½çš„å‰å‡ è¡Œè¾“å‡ºï¼š\n\u0026gt; (begin (bq-test 3 4) (system \u0026#34;sleep 3\u0026#34;) (set! die? #t)) producer 3 posting a job Adding job #1 = (lambda () (fib 29)) producer 3 posting a job Adding job #2 = (lambda () (fib 26)) producer 3 posting a job Adding job #3 = (lambda () (fib 22)) producer 3 posting a job Adding job #4 = (lambda () (fib 21)) producer 2 posting a job Adding job #5 = (lambda () (fib 29)) producer 1 posting a job Adding job #6 = (lambda () (fib 29)) consumer 4 looking for a job producer 3 posting a job Adding job #7 = (lambda () (fib 24)) consumer 4 executing job #1 consumer 3 looking for a job producer 2 posting a job Adding job #8 = (lambda () (fib 26)) consumer 3 executing job #2 consumer 3 computed: 121393 consumer 3 looking for a job producer 1 posting a job Adding job #9 = (lambda () (fib 26)) ... åœ¨â€œA Scheme for native threads1â€ä¸­ç»™å‡ºäº†å…¶ä»–ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¯æ‚¬æŒ‚çº¿ç¨‹çš„å®šä¹‰å’Œåœ¨æ— æ³•è®¿é—®æ—¶è‡ªåŠ¨ç»ˆæ­¢çš„çº¿ç¨‹ã€‚\nR. Kent Dybvig. A Scheme for native threads. In Symposium in Honor of Mitchell Wand, August 2009. http://www.ccs.neu.edu/events/wand-symposium/.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":94,"section":"posts","summary":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹","tags":["thread","scheme"],"title":"çº¿ç¨‹ï¼ˆThread System in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/thread/","year":"2020"},{"content":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å›æ”¶ä¸è¯¥å¯¹è±¡å…³è”çš„å­˜å‚¨ã€‚ ä¸ºäº†å›æ”¶æ­¤å­˜å‚¨ï¼ŒChez Schemeä½¿ç”¨äº†ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¯¥åƒåœ¾æ”¶é›†å™¨åœ¨ç¨‹åºè¿è¡Œæ—¶å®šæœŸè¿è¡Œã€‚ åƒåœ¾æ”¶é›†å™¨ä»ä¸€ç»„å·²çŸ¥çš„æ ¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœºå™¨æ³¨å†Œï¼‰ï¼ŒæŸ¥æ‰¾æ‰€æœ‰å¯è®¿é—®å¯¹è±¡ï¼Œå¹¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¤åˆ¶å®ƒä»¬ï¼Œä»¥æ¶ˆé™¤å¯è®¿é—®å¯¹è±¡ä¹‹é—´çš„ç¢ç‰‡ï¼Œå¹¶å›æ”¶ä¸å¯è®¿é—®å¯¹è±¡æ‰€å ç”¨çš„å­˜å‚¨ã€‚\nå›æ”¶ç”±é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºè‡ªåŠ¨è§¦å‘ï¼Œè¯¥å¤„ç†ç¨‹åºé€šè¿‡collect-requestä¸­æ–­è°ƒç”¨ï¼Œè¯¥ä¸­æ–­åœ¨åˆ†é…äº†å¤§çº¦nä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´åå‘ç”Ÿï¼Œå…¶ä¸­næ˜¯å‚æ•°collect-trip-bytes çš„å€¼ã€‚ é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºé€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectç¨‹åºæ¥è¿›è¡Œä¼šç¡ã€‚ å¯ä»¥é€šè¿‡æ›´æ”¹å‚æ•°collect-request-handler çš„å€¼æ¥é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºã€‚ ç¨‹åºè¿˜å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨collectæ¥å¯¼è‡´åœ¨collect-requestä¸­æ–­ä¹‹é—´å‘ç”Ÿå›æ”¶ã€‚\nChez Schemeçš„å›æ”¶å™¨æ˜¯åŸºäºåˆ†ä»£ çš„ã€‚å®ƒæ ¹æ®å¯¹è±¡çš„å¹´é¾„ï¼ˆå¤§è‡´æ¥è¯´ï¼Œå›æ”¶å¹¸å­˜æ•°ï¼‰æ¥å¯¹å¯¹è±¡è¿›è¡Œåˆ†ç±»ï¼Œä¸”è€å¯¹è±¡æ¯”å¹´è½»å¯¹è±¡å›æ”¶çš„é¢‘ç‡è¦ä½ã€‚ç”±äºå¹´è½»å¯¹è±¡æ¯”è€å¯¹è±¡æ›´å¿«åœ°å˜ä¸ºä¸å¯è®¿é—®ï¼Œå› æ­¤ç»“æœæ˜¯å¤§å¤šæ•°çš„å›æ”¶èŠ±è´¹çš„æ—¶é—´æ›´å°‘ã€‚ç³»ç»Ÿè¿˜ç»´æŠ¤ä¸€ä¸ªé™æ€ä»£ï¼ˆstatic generation, ç±»ä¼¼Javaçš„æ°¸ä¹…ä»£ï¼‰ï¼Œä¸ä¼šå¯¹æ­¤å­˜å‚¨è¿›è¡Œå›æ”¶ã€‚ä»…å½“å‹ç¼©å †ï¼ˆScompact_heapï¼‰æˆ–è¦collectçš„target-generation å‚æ•°ä¸ºstaticç¬¦å·æ—¶ï¼Œæ‰å°†å¯¹è±¡æ”¾å…¥é™æ€ä»£ä¸­ã€‚\néé™æ€ä»£çš„ç¼–å·ä»æœ€å¹´è½»çš„ä¸–ä»£ï¼ˆå¼€å§‹äº0ï¼‰åˆ°collect-maximum-generationçš„å½“å‰å€¼ã€‚å­˜å‚¨ç®¡ç†å™¨å°†æ–°åˆ†é…çš„å¯¹è±¡æ”¾å…¥ç¬¬0ä»£ã€‚åœ¨ç¬¬0ä»£çš„å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ç¬¬0ä»£çš„å¯¹è±¡æŒªåˆ°ç¬¬1ä»£ï¼Œç±»ä¼¼åœ°ï¼Œåœ¨ç¬¬1ä»£å›æ”¶æœŸé—´ï¼Œå­˜æ´»çš„ç¬¬0ä»£å’Œç¬¬1ä»£å¯¹è±¡ç§»åŠ¨åˆ°ç¬¬2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨æœ€å¤§éé™æ€å¯¹è±¡å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å¹¸å­˜çš„éé™æ€å¯¹è±¡éƒ½å°†ç§»åŠ¨ï¼ˆå¯èƒ½è¿”å›ï¼‰åˆ°æœ€å¤§éé™æ€ä»£ä¸­ã€‚ é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡æœ‰å¯èƒ½è·³è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ï¼Œä½†è¿™åœ¨è®¸å¤šå¯¹è±¡ä¸Šä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œå¹¶ä¸”å¦‚æœè¿™äº›å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œåˆ™æœ€ç»ˆå°†å›æ”¶å®ƒä»¬çš„å­˜å‚¨ã€‚\nç»´æŠ¤å†…éƒ¨è®¡æ•°å™¨gc-tripæ¥æ§åˆ¶ä½•æ—¶å›æ”¶æ¯ä¸€ä»£ã€‚ æ¯æ¬¡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collect æ—¶ï¼ˆä»é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºå¼€å§‹ï¼‰ï¼Œgc-tripéƒ½ä¼šåŠ 1ã€‚åœ¨collect-generationåŸºæ•°ä¸ºr çš„æƒ…å†µä¸‹ï¼Œå›æ”¶çš„ä¸–ä»£ç¼–å·ä¸ºg ï¼Œå…¶gc-tripæ˜¯$r^g$çš„å€æ•°ã€‚ å¦‚æœå°†collect-generation-radixè®¾ç½®ä¸º4ï¼Œåˆ™ç³»ç»Ÿå°†æ¯æ¬¡æ”¶é›†0ä»£ï¼Œæ¯4æ¬¡æ”¶é›†1ä»£ï¼Œæ¯16æ¬¡æ”¶é›†2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚\næ¯æ¬¡æŸä¸ªä¸–ä»£g è°ƒç”¨collectæ—¶ï¼Œè¯¥ä¸–ä»£g è¢«å›æ”¶ä¸”gc-tripå‰è¿›åˆ°ä¸‹ä¸ª$r^g$çš„è¾¹ç•Œï¼Œä½†æ˜¯ä¸ä¼šè¶…è¿‡$r^{g+1}$çš„è¾¹ç•Œï¼Œr ä¸å˜è¿˜æ˜¯collect-generation-radixçš„å€¼ã€‚\nå¦‚æœä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°tg è°ƒç”¨collectï¼Œåˆ™tg ç¡®å®šç›®æ ‡ä»£ã€‚ å½“g æ˜¯æœ€å¤§çš„éé™æ€ä»£æ—¶ï¼Œtg å¿…é¡»ä¸ºg æˆ–ä¸ºstaticã€‚ å¦åˆ™ï¼Œtg å¿…é¡»ä¸ºg æˆ–g + 1 ã€‚ å½“ç›®æ ‡ä»£æ˜¯staticç¬¦å·æ—¶ï¼Œéé™æ€ä»£ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å°†ç§»åŠ¨åˆ°é™æ€ä»£ä¸­ã€‚é™æ€ä»£ä¸­çš„å¯¹è±¡ä»ä¸ä¼šè¢«å›æ”¶ã€‚ è¿™åœ¨åŠ è½½å’Œåˆå§‹åŒ–åº”ç”¨ç¨‹åºçš„æ°¸ä¹…ä»£ç å’Œæ•°æ®ç»“æ„ä¹‹åéå¸¸æœ‰ç”¨ï¼Œä»¥å‡å°‘åç»­å›æ”¶çš„å¼€é”€ã€‚\né€šè¿‡è®¾ç½®æœ¬èŠ‚ä¸­æè¿°çš„å‚æ•°ï¼Œå¯ä»¥å¯¹å›æ”¶å™¨çš„è¡Œä¸ºè¿›è¡Œå®è´¨æ€§çš„è°ƒæ•´ã€‚é€šè¿‡é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºä¸”ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectï¼Œç”šè‡³æœ‰å¯èƒ½å®Œå…¨è¦†ç›–æ”¶é›†å™¨çš„é»˜è®¤ç­–ç•¥æ¥ç¡®å®šä½•æ—¶å›æ”¶æ¯ä¸ªä¸–ä»£ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectæ¥é‡æ–°å®šä¹‰å¤„ç†ç¨‹åºï¼Œä»¥åœ¨é•¿æ—¶é—´å†…å°†æœ€å¤§çš„éé™æ€ä»£è§†ä¸ºé™æ€ä»£ï¼Œè¯¥å‚æ•°åœ¨è¯¥æ—¶é—´æ®µå†…ç»ä¸ç­‰äºæœ€å¤§çš„éé™æ€ä»£ã€‚\n(collect) | (collect g) | (collect g tg)\ng å¿…é¡»æ˜¯ä¸å¤§äºæœ€å¤§éé™æ€ä»£ï¼ˆcollect-maximum-generationè¿”å›çš„å€¼ï¼‰çš„éè´Ÿç¡®å®šç¼–å·ã€‚ å¦‚æœg å·²ç»æ˜¯æœ€å¤§çš„éé™æ€ä»£ç¼–å·ï¼Œåˆ™tg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg çš„fixnumæˆ–staticç¬¦å·ã€‚ å¦åˆ™ï¼Œtg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg æˆ–å¤§äºg çš„fixnumã€‚\næ­¤è¿‡ç¨‹ä½¿å­˜å‚¨ç®¡ç†å™¨æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚ collectæ˜¯é€šè¿‡collect-requestå¤„ç†ç¨‹åºå®šæœŸè°ƒç”¨çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¾å¼è°ƒç”¨å®ƒï¼Œä»¥åœ¨ç‰¹å®šæ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨è®¡æ—¶è®¡ç®—ä¹‹å‰ï¼‰å¼ºåˆ¶è¿›è¡Œå›æ”¶ã€‚ åœ¨Chez Schemeçš„çº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼Œè°ƒç”¨collectçš„çº¿ç¨‹å¿…é¡»æ˜¯å”¯ä¸€çš„æ´»åŠ¨çº¿ç¨‹ã€‚\nç³»ç»Ÿå°†æ ¹æ®g å’Œtg ï¼ˆå¦‚æœæä¾›ï¼‰ç¡®å®šå›æ”¶å“ªäº›ä¸–ä»£ï¼Œå¦‚æœ¬èŠ‚çš„ä»‹ç»ä¸­æ‰€è¿°ã€‚\n(collect-rendezvous)\nè¯·æ±‚åƒåœ¾å›æ”¶çš„æ–¹å¼åº”è¯¥ä¸ç”±ç³»ç»Ÿè‡ªåŠ¨å‘èµ·çš„GCçš„æ–¹å¼ç›¸ä¸€è‡´ã€‚æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ç»è¿‡åè°ƒï¼Œä»¥ä¾¿å…¶ä¸­ä¸€ä¸ªè°ƒç”¨collect-requestå¤„ç†ç¨‹åºï¼Œè€Œå…¶ä»–çº¿ç¨‹æš‚åœç›´åˆ°å¤„ç†ç¨‹åºè¿”å›ã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœcollect-requestå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…collect-request-handlerï¼‰æ²¡æœ‰è°ƒç”¨collectï¼Œé‚£ä¹ˆcollect-rendezvouså®é™…ä¸Šä¸ä¼šæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚\ncollect-notify\nå¦‚æœå°†collect-notifyè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¯å½“è¿è¡ŒGCæ—¶ï¼Œå›æ”¶å™¨éƒ½ä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-notifyè®¾ç½®ä¸º#fã€‚\ncollect-trip-bytes\nChez Schemeåœ¨å†…éƒ¨ä»¥å¤§å—åˆ†é…å†…å­˜ï¼Œå¹¶é€šè¿‡å†…è”æ“ä½œå°†è¿™äº›å—ç»†åˆ†ä»¥æé«˜æ•ˆç‡ã€‚å­˜å‚¨ç®¡ç†å™¨ç¡®å®šæ˜¯å¦ä¸ºæ¯ä¸ªåˆ†é…çš„å¤§å—ä»…è¯·æ±‚ä¸€æ¬¡å›æ”¶ã€‚æ­¤å¤–ï¼Œåœ¨å­˜å‚¨ç®¡ç†å™¨è¯·æ±‚å›æ”¶å’Œå…‘ç°å›æ”¶è¯·æ±‚ä¹‹é—´å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå°¤å…¶æ˜¯å¦‚æœé€šè¿‡with-interrupts-disabledæˆ–disable-interruptsä¸´æ—¶ç¦ç”¨äº†ä¸­æ–­æ—¶ã€‚å› æ­¤ï¼Œcollect-trip-bytesä»…æ˜¯ä¸€ç§è¿‘ä¼¼åº¦é‡ã€‚\ncollect-generation-radix\næ­¤å‚æ•°ç¡®å®šé»˜è®¤æƒ…å†µä¸‹çš„collect-requestå¤„ç†ç¨‹åºè°ƒç”¨ä¸å¸¦å‚æ•°çš„collectæ—¶å›æ”¶æ¯ä¸€ä»£çš„é¢‘ç‡ã€‚æ¯$r^g$æ¬¡å‘ç”Ÿä¸€æ¬¡å¯¹åº”ä¸–ä»£çš„å›æ”¶ï¼Œå…¶ä¸­r æ˜¯collect-generation-radixçš„å€¼ï¼Œg æ˜¯ä¸–ä»£æ•°ã€‚\nå°†collect-generation-radixè®¾ç½®ä¸º1ä¼šå¼ºåˆ¶æ‰€æœ‰ä¸–ä»£æ¯æ¬¡éƒ½è¢«å›æ”¶ï¼Œ å°†collect-generation-radixè®¾ç½®ä¸ºéå¸¸å¤§çš„æ•°ç›®å°†æ— é™æœŸæœ‰æ•ˆåœ°å»¶è¿Ÿè¾ƒæ—©çš„ä¸€ä»£çš„å›æ”¶ã€‚\ncollect-maximum-generation\næ­¤å‚æ•°ç¡®å®šå½“å‰å¯ä»¥ä½¿ç”¨çš„æœ€å¤§éé™æ€ä¸–ä»£æ•°,å®ƒçš„å€¼æ˜¯1åˆ°254èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œä»…ä½¿ç”¨ä¸¤ä¸ªéé™æ€ç”Ÿæˆã€‚ è®¾ç½®ä¸º2æ—¶ï¼Œå°†ä½¿ç”¨ä¸‰ä¸ªéé™æ€ä¸–ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚ å½“è®¾ç½®ä¸º254æ—¶ï¼Œå°†ä½¿ç”¨255ä¸ªéé™æ€ä»£ï¼Œå†åŠ ä¸Šä¸€ä¸ªé™æ€ä»£ï¼Œæ€»å…±256ä¸ªä¸–ä»£ã€‚å¢åŠ ä¸–ä»£æ•°å¯ä»¥å‡å°‘äº†æ”¶é›†æ—§å¯¹è±¡çš„é¢‘ç‡ï¼Œæ½œåœ¨åœ°å‡å°‘äº†æ”¶é›†å¼€é”€ï¼Œä½†åŒæ—¶ä¹Ÿæ½œåœ¨åœ°å¢åŠ äº†ç³»ç»Ÿä¸­ä¿ç•™çš„ä¸å¯è®¿é—®å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œå¢åŠ äº†æ‰€éœ€çš„å†…å­˜æ€»é‡ã€‚\ncollect-request-handler\ncollect-request-handlerçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“ç³»ç»Ÿè®¤ä¸ºåº”è¯¥è¦è¿›è¡ŒGCæ—¶ï¼ˆå³ï¼Œè‡ªä¸Šæ¬¡GCä»¥æ¥ï¼Œç³»ç»Ÿåˆ†é…äº†ç”±å‚æ•°collect-trip-bytesè§„å®šçš„å­˜å‚¨é‡ä¹‹åï¼‰ï¼Œè¯¥è¿‡ç¨‹åœ¨ä¸å¸¦å‚æ•°çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-request-handlerä»…è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectã€‚ å¯ä»¥é€šè¿‡å°†collect-request-handlerè®¾ç½®ä¸ºä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„è¿‡ç¨‹æ¥ç¦ç”¨è‡ªåŠ¨æ”¶é›†ï¼Œä¾‹å¦‚ï¼š\n(collect-request-handler void) ä¹Ÿå¯ä»¥åˆ©ç”¨é˜²æ­¢ä»»ä½•ä¸­æ–­çš„critical-sectionæ¥ä¸´æ—¶ç¦ç”¨GC\nrelease-minimum-generation\næ­¤å‚æ•°çš„å€¼å¿…é¡»ä»‹äº0åˆ°collect-maximum-generationçš„å€¼ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹é—´ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºcollect-maximum-generationçš„å€¼ã€‚\nå½“åˆ†é…æ–°æ•°æ®ä¸”è¿›è¡ŒGCæ—¶ï¼Œstorage-managementä¼šè‡ªåŠ¨åœ°ä»æ“ä½œç³»ç»Ÿä¸­è¯·æ±‚é¢å¤–çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ç›¸åº”åœ°ï¼Œåœ¨å †æ˜¾è‘—å‡å°çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå°è¯•å°†å…ˆå‰ä»æ“ä½œç³»ç»Ÿè·å¾—çš„æŸäº›è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä»…åœ¨é’ˆå¯¹æœ€å¤§éé™æ€æ—¶ä»£çš„GCä¹‹åæ‰è¿™æ ·åšã€‚ä¹Ÿå¯ä»¥è®©ç³»ç»Ÿåœ¨å¯¹æ›´å¹´è½»çš„ä¸–ä»£å›æ”¶ä¹‹åå°±æ‰§è¡Œæ­¤æ“ä½œï¼Œæ–¹æ³•æ˜¯å°†release-minimum-generationçš„å€¼æ›´æ”¹ä¸ºå°äºcollect-maximum-generationçš„å€¼ã€‚ç”±å‚æ•°æŒ‡å®šçš„ä¸–ä»£ï¼Œæˆ–è€…ä»»ä½•è¾ƒè€çš„ä¸–ä»£æ˜¯GCçš„ç›®æ ‡ä¸–ä»£æ—¶ï¼Œå­˜å‚¨ç®¡ç†ç³»ç»Ÿå°†åœ¨GCä¹‹åå°è¯•å°†ä¸éœ€è¦çš„è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\nå½“collect-maximum-generationè®¾ç½®ä¸ºä¸€ä¸ªæ–°å€¼g æ—¶ï¼Œrelease-minimum-generationä¹ŸåŒæ—¶éšå¼åœ°æ›´æ”¹ä¸ºg ï¼Œæœ‰ä¸¤ä¸ªå‰æï¼šï¼ˆaï¼‰ä¿®æ”¹å‰è¿™ä¸¤ä¸ªå‚æ•°å…·æœ‰ç›¸åŒçš„å€¼ï¼›ï¼ˆbï¼‰release-minimum-generationçš„å€¼å¤§äºg\nheap-reserve-ratio\næ­¤å‚æ•°ç¡®å®šäº†ä¿ç•™çš„å†…å­˜çš„å¤§æ¦‚æ•°é‡ï¼ˆæ²¡æœ‰è¿”å›ç»™OSï¼Œå¦‚release-minimum-generationæ‰€æè¿°çš„ï¼‰ä¸å½“å‰å·²å ç”¨çš„å†…å­˜é‡ï¼ˆä¸åŒ…å«å·²å˜ä¸ºé™æ€çš„å†…å­˜åŒºåŸŸï¼‰çš„æ¯”ä¾‹ï¼Œå®ƒçš„å€¼å¿…é¡»æ˜¯ä¸ç²¾ç¡®çš„éè´Ÿæ•´æ•°å€¼ï¼› å¦‚æœè®¾ç½®ä¸ºç²¾ç¡®çš„å®æ•°å€¼ï¼Œåˆ™ç²¾ç¡®çš„å€¼å°†è½¬æ¢ä¸ºä¸ç²¾ç¡®çš„å€¼ã€‚é»˜è®¤å€¼1.0ï¼Œä¸ºæ¯ä¸ªå½“å‰å ç”¨çš„éé™æ€é¡µé¢ä¿ç•™ä¸€é¡µå†…å­˜ã€‚ å°†å…¶è®¾ç½®ä¸ºè¾ƒå°çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°çš„å¹³å‡è™šæ‹Ÿå†…å­˜å ç”¨é‡ï¼Œè€Œå°†å…¶è®¾ç½®ä¸ºè¾ƒå¤§çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°‘çš„æ“ä½œç³»ç»Ÿè°ƒç”¨ä»¥è¯·æ±‚å’Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚\nå¼±åºå¯¹ï¼Œæš‚æ—¶åºå¯¹å’Œå®ˆæŠ¤è€…Weak Pairs, Ephemeron Pairs, and Guardians weak pairså…è®¸ç¨‹åºç»´æŠ¤æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆã€‚ æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆä¸ä¼šé˜»æ­¢å­˜å‚¨ç®¡ç†ç³»ç»Ÿå›æ”¶è¯¥å¯¹è±¡ï¼Œä½†æ˜¯åªè¦è¯¥å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æ˜¯å¯è®¿é—®çš„ï¼Œå®ƒä»ç„¶æœ‰æ•ˆã€‚\nephemeron pairsä¸weak pairsç±»ä¼¼ï¼Œä½†æ˜¯ephemeron pairsæ‹¥æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œå…¶ä¸­ä»…ä»…åœ¨ç¬¬ä¸€ä¸ªæŒ‡é’ˆå­˜åœ¨çš„æƒ…å†µç¬¬äºŒä¸ªæŒ‡é’ˆæ‰èƒ½å­˜åœ¨\nguardianså…è®¸ç¨‹åºä¿æŠ¤å¯¹è±¡å…é­åƒåœ¾å›æ”¶å™¨çš„é‡åˆ†é…ï¼Œå¹¶ç¡®å®šè¯¥å¯¹è±¡ä½•æ—¶è¢«é‡æ–°åˆ†é…ã€‚\nweak paris, ephemeron pairs å’Œguardianså…è®¸ç¨‹åºå°†æœ‰å…³å¯¹è±¡çš„ä¿¡æ¯ä¿ç•™åœ¨å•ç‹¬çš„æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚å“ˆå¸Œè¡¨ï¼‰ä¸­ï¼Œè€Œæ— éœ€æ‹…å¿ƒç»´æŠ¤æ­¤ä¿¡æ¯å°†å¯¼è‡´å¯¹è±¡æ— é™æœŸåœ°ä¿ç•™åœ¨ç³»ç»Ÿä¸­ã€‚\nå¦å¤–ï¼Œguardianså…è®¸æ— é™æœŸåœ°ä»é‡Šæ”¾å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥é‡ç”¨å®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨å¯¹è±¡ä¸­çš„æ•°æ®æ‰§è¡Œæ¸…ç†æˆ–å…¶ä»–æ“ä½œã€‚\n(weak-cons obj1 obj2)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„å¼±åºå¯¹\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚å¼±åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\nå¼±åºå¯¹å¯ä»¥ä½¿ç”¨**weak-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ å¼±åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆ å¼±åºå¯¹çš„carä¸­çš„å¼±æŒ‡é’ˆå°±åƒæ™®é€šæŒ‡é’ˆä¸€æ ·ï¼Œåªè¦å®ƒæŒ‡å‘çš„å¯¹è±¡å¯ä»¥é€šè¿‡ç³»ç»Ÿä¸­æŸä¸ªåœ°æ–¹çš„æ™®é€šï¼ˆéå¼±ï¼‰æŒ‡é’ˆè®¿é—®å³å¯ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåƒåœ¾æ”¶é›†å™¨åœ¨æŸä¸ªæ—¶å€™è¯†åˆ«å‡ºä¸å­˜åœ¨æŒ‡å‘è¯¥å¯¹è±¡çš„éå¼±æŒ‡é’ˆï¼Œåˆ™å®ƒå°†æ¯ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„å¼±æŒ‡é’ˆæ›¿æ¢ä¸ºâ€œ broken weak-pointerâ€å¯¹è±¡**#!bwp**ï¼Œå¹¶ä¸¢å¼ƒè¯¥å¯¹è±¡ã€‚\nå¼±åºå¯¹çš„cdrå­—æ®µä¸æ˜¯å¼±æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¼±åºå¯¹æ¥æ„é€ å¼±ä¿æŒå¯¹è±¡çš„åˆ—è¡¨ã€‚å¯ä»¥åƒä½¿ç”¨æ™®é€šçš„åˆ—è¡¨çš„å¤„ç†æ“ä½œï¼ˆä¾‹å¦‚lengthï¼Œmapå’Œassvï¼‰æ¥æ“ä½œè¿™äº›listã€‚å¼±åºå¯¹å¯ä»¥ä½¿ç”¨set-car!å’Œset-cdr!æ¥ä¿®æ”¹ï¼› åœ¨set-car!ä¹‹åï¼Œcarå­—æ®µåŒ…å«æŒ‡å‘æ–°å¯¹è±¡çš„å¼±æŒ‡é’ˆï¼Œä»£æ›¿äº†æ—§å¯¹è±¡ã€‚å¼±åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ç›¸åŒã€‚ å¼±åºå¯¹æ²¡æœ‰readerè¯­æ³•ã€‚å¼±åºå¯¹åœ¨è¢«å†™å…¥ç„¶åè¢«è¯»å–æ—¶æˆä¸ºæ™®é€šå¯¹ã€‚\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (car p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (weak-pair? obj)\n(weak-pair? (weak-cons â€™a â€™b)) â‡’ #t (weak-pair? (cons â€™a â€™b)) â‡’ #f (weak-pair? \u0026#34;oops\u0026#34;) â‡’ #f (ephemeron-cons obj1 obj2)\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚æš‚æ—¶åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\næš‚æ—¶åºå¯¹å¯ä»¥ä½¿ç”¨**ephemeron-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ æš‚æ—¶åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆï¼Œå¹¶ä¸”ä»…ä»…åœ¨pairçš„carå­˜åœ¨æ—¶cdræ‰èƒ½ä¿ç•™ æš‚æ—¶åºå¯¹çš„è¡Œä¸ºä¸å¼±åºå¯¹ç±»ä¼¼ï¼Œä¸è¿‡cdræœ‰ç‰¹æ®Šçš„å¤„ç†ï¼šå¦‚æœcarè¢«è®¾ç½®ä¸º**#!bwpçš„åŒæ—¶ä¹Ÿä¼šå°†cdrè®¾ç½®ä¸º#!bwp**ã€‚ç”±äºåŒæ—¶å°†carå’Œcdrå­—æ®µè®¾ç½®ä¸ºä¸º**#!bwp**ï¼Œå› æ­¤å¯ä»¥é€šè¿‡cdrå¯¹è±¡å¼•ç”¨carå¯¹è±¡è¿™ä¸€äº‹å®æœ¬èº«å¹¶ä¸æ„å‘³ç€å¿…é¡»ä¿ç•™carï¼ˆä¸å¼±åºå¯¹ä¸åŒï¼‰ã€‚ ç›¸åï¼Œå‡ºäºæŸç§åŸå› ï¼Œcarå¿…é¡»ç‹¬ç«‹äºcdrå¯¹è±¡ä¿å­˜ã€‚\nä¸å¼±åºå¯¹å’Œå…¶ä»–å¯¹ä¸€æ ·ï¼Œæš‚æ—¶åºå¯¹ä½¿ç”¨**set-car!å’Œset-cdr!**æ¥ä¿®æ”¹æ•°æ®ï¼Œæš‚æ—¶åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ä¸€æ ·ï¼Œä½†æ²¡æœ‰readerè¯­æ³•\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (cdr p) â‡’ #!bwp (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x x)) ; not an ephemeron pair (set! x \u0026#39;*) (collect) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) ä¸å¼±åºå¯¹ä¸€æ ·ï¼Œå¦‚æœåœ¨å°†xè®¾ç½®ä¸º*ä¹‹å‰è¿›è¡Œäº†åƒåœ¾å›æ”¶å°†è¯¥pairæå‡ä¸ºè¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™ä¸Šé¢ä¸­é—´ç¤ºä¾‹çš„æœ€åä¸¤ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šå¯èƒ½è¿”å›ï¼ˆa . bï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸Šé¢çš„æœ€åä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæœ€åä¸¤ä¸ªè¡¨è¾¾å¼çš„ç»“æœå°†å§‹ç»ˆä¸ºï¼ˆa . bï¼‰ï¼Œå› ä¸ºå¼±åºå¯¹çš„cdræŒæœ‰éå¼±å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥éå¼±å¼•ç”¨é˜»æ­¢carå­—æ®µå˜** #!bwp**ã€‚\n(ephemeron-pair? obj)\n(ephemeron-pair? (ephemeron-cons \u0026#39;a \u0026#39;b)) â‡’ #t (ephemeron-pair? (cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? (weak-cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? \u0026#34;oops\u0026#34;) â‡’ #f (bwp-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯æ–­å¼€çš„broken weak-pairå¯¹è±¡ï¼Œåˆ™è¿”å›#tï¼Œå¦åˆ™è¿”å›#f\n(bwp-object? #!bwp) â‡’ #t (bwp-object? \u0026#39;bwp) â‡’ #f (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect (collect-maximum-generation)) (car p) â‡’ #!bwp (bwp-object? (car p)) â‡’ #t (make-guardian)\nGuardiansç”±è¦ä¿æŠ¤çš„å¯¹è±¡ç»„çš„è¿‡ç¨‹è¡¨ç¤ºã€‚åˆ›å»ºguardianåï¼Œæ³¨å†Œå¯¹è±¡ç»„ä¸ºç©ºã€‚ é€šè¿‡å°†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ˆæŠ¤è€…ï¼Œå¯ä»¥å‘guardianæ³¨å†Œå¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) x â‡’ (aaa . bbb) (G x) æ³¨å†Œå¯¹è±¡æ—¶ä¹Ÿå¯ä»¥æŒ‡å®šâ€œrepresentativeâ€ï¼ˆå³ï¼Œyï¼‰å¯¹è±¡ã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(define y (cons \u0026#39;ccc \u0026#39;ddd)) y â‡’ (ccc . ddd) (G y \u0026#39;rep) ä¸å®ˆæŠ¤è€…å…³è”çš„ä¸€ç»„æ³¨å†Œå¯¹è±¡åœ¨é€»è¾‘ä¸Šç»†åˆ†ä¸ºä¸¤ä¸ªä¸ç›¸äº¤çš„å­ç»„ï¼šä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œå¯è®¿é—®â€å¯¹è±¡ï¼Œä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œä¸å¯è®¿é—®â€å¯¹è±¡ã€‚ä¸å¯è®¿é—®çš„å¯¹è±¡æ˜¯å·²è¢«è¯æ˜æ— æ³•è®¿é—®çš„å¯¹è±¡ï¼ˆé€šè¿‡guardianæœºåˆ¶æœ¬èº«æˆ–é€šè¿‡å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µé™¤å¤–ï¼‰ï¼Œå¯è®¿é—®çš„å¯¹è±¡æ˜¯æœªç»è¯æ˜çš„å¯¹è±¡ã€‚â€œå·²è¯æ˜â€ä¸€è¯åœ¨è¿™é‡Œå¾ˆé‡è¦ï¼šå¯èƒ½æ˜¯å¯è®¿é—®ç»„ä¸­çš„æŸäº›å¯¹è±¡ç¡®å®æ˜¯ä¸å¯è®¿é—®çš„ï¼Œä½†è¿™å°šæœªå¾—åˆ°è¯æ˜ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç›´åˆ°å¯¹è±¡å®é™…ä¸Šå˜å¾—ä¸å¯è®¿é—®å¾ˆä¹…ä¹‹åï¼ˆåœ¨å½“å‰å®ç°ä¸­ï¼Œç›´åˆ°å‘ç”ŸåŒ…å«å¯¹è±¡çš„ä¸–ä»£çš„åƒåœ¾å›æ”¶ï¼‰ï¼Œæ‰å¯èƒ½åšå‡ºè¿™ç§è¯æ˜ã€‚\nå‘guardianæ³¨å†Œçš„å¯¹è±¡æœ€åˆè¢«æ”¾ç½®åœ¨å¯è®¿é—®ç»„ä¸­ï¼Œå¹¶åœ¨å®ƒä»¬å˜å¾—ä¸å¯è®¿é—®åçš„æŸä¸ªæ—¶åˆ»ç§»å…¥ä¸å¯è®¿é—®ç»„ã€‚ ä¸å¯è®¿é—®ç»„ä¸­çš„å¯¹è±¡æ˜¯é€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„guardianæ¥æ£€ç´¢çš„ã€‚ å¦‚æœä¸å¯è®¿é—®ç»„ä¸­æ²¡æœ‰å¯¹è±¡ï¼Œåˆ™guardianè¿”å›#fã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(G) â‡’ #f (set! x #f) (set! y #f) (collect) (G) â‡’ (aaa . bbb) ; ä¹Ÿæœ‰å¯èƒ½è¿™ä¸ªåæ‰“å°å‡ºæ¥ (G) â‡’ rep ; è¿™ä¸ªå…ˆæ‰“å°å‡ºæ¥ (G) â‡’ #f å¯¹Gçš„åˆå§‹è°ƒç”¨è¿”å›#fï¼Œå› ä¸ºç»‘å®šåˆ°xå’Œyçš„å¯¹æ˜¯å‘Gæ³¨å†Œçš„å”¯ä¸€å¯¹è±¡ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥é€šè¿‡è¿™äº›ç»‘å®šè®¿é—®è¿™äº›åºå¯¹ã€‚è°ƒç”¨collectæ—¶ï¼Œå¯¹è±¡å°†ç§»å…¥ä¸å¯è®¿é—®çš„ç»„ã€‚ å› æ­¤ï¼Œå¯¹Gçš„ä¸¤ä¸ªè°ƒç”¨è¿”å›å…ˆå‰ç»‘å®šåˆ°xçš„åºå¯¹å’Œå…ˆå‰ç»‘å®šåˆ°yçš„åºå¯¹çš„representativeï¼Œå°½ç®¡å¯èƒ½ä¸æ‰€ç¤ºé¡ºåºç›¸åã€‚ ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºå¼±åºå¯¹ï¼Œå¦‚æœå¯¹è±¡å·²è¿ç§»åˆ°è¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™è°ƒç”¨collectå®é™…ä¸Šå¯èƒ½ä¸è¶³ä»¥è¯æ˜è¯¥å¯¹è±¡ä¸å¯è®¿é—®ã€‚ï¼‰\nå®é™…ä¸Šï¼Œä»guardiané‚£é‡Œè·å–çš„å¯¹è±¡åœ¨ä»»ä½•æ–¹é¢éƒ½æ²¡æœ‰ç‰¹æ®Šçš„åœ°ä½ã€‚ æ­¤åŠŸèƒ½é¿å…äº†å…±äº«æˆ–å¾ªç¯ç»“æ„å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ã€‚ ç”±ä¸å¯è®¿é—®å¯¹è±¡ç»„æˆçš„å…±äº«æˆ–å¾ªç¯ç»“æ„å°†è¢«å®Œæ•´ä¿ç•™ï¼Œå°†æ³¨å†Œç”±guardianä¿æŠ¤çš„éƒ¨åˆ†éƒ½æ”¾ç½®åœ¨è¯¥guardianä¸å¯è®¿é—®çš„é›†åˆä¸­ã€‚ ç„¶åï¼Œç¨‹åºå‘˜å¯ä»¥å®Œå…¨æ§åˆ¶ç»“æ„çš„å¤„ç†é¡ºåºã€‚\nä¸€ä¸ªå¯¹è±¡å¯ä»¥åœ¨guardianå¤„å¤šæ¬¡æ³¨å†Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤šæ¬¡æ£€ç´¢è¯¥å¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (G x) (G x) (set! x #f) (collect) (G) â‡’ (aaa . bbb) (G) â‡’ (aaa . bbb) å®ƒä¹Ÿå¯ä»¥å‘ä¸æ­¢ä¸€ä¸ªguardianæ³¨å†Œï¼Œå¹¶ä¸”guardianæœ¬èº«ä¹Ÿå¯ä»¥å‘å…¶ä»–guardianæ³¨å†Œã€‚ åœ¨æ²¡æœ‰â€œrepresentativeâ€çš„æƒ…å†µä¸‹å‘guardianæ³¨å†Œçš„å¯¹è±¡ï¼Œå¹¶æ”¾ç½®åœ¨ä¸€ä¸ªå¼±åºå¯¹æˆ–æš‚æ—¶å¯¹çš„carå­—æ®µä¸­ï¼Œå…¶ç›´åˆ°ä»guardianå¤„å°†è¿”å›å¹¶ç”±ç¨‹åºä¸¢å¼ƒï¼Œæˆ–è€…ç›´åˆ°guardianæœ¬èº«è¢«ä¸¢å¼ƒä¸ºæ­¢ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (collect) (set! y (G)) y â‡’ (aaa . bbb) (car p) â‡’ (aaa . bbb) (set! y #f) (collect 1) (car p) â‡’ #!bwp å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæŒ‡å®šäº†representativeï¼ˆå¯¹è±¡æœ¬èº«é™¤å¤–ï¼‰ï¼Œåˆ™åœ¨ä»guardianå¤„è·å¾—representativeçš„åŒæ—¶ï¼Œä¹Ÿä¼šä»å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µä¸­ä¸¢å¼ƒå—ä¿æŠ¤çš„å¯¹è±¡ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x \u0026#39;rep) (set! x #f) (collect) (G) â‡’ rep ; è·å¾—representativeçš„å€¼ (car p) â‡’ #!bwp ; è‡ªåŠ¨ä¸¢å¼ƒ ä¸‹é¢çš„ç¤ºä¾‹è¯´æ˜äº†å½“guardianæœ¬èº«ä¸¢å¼ƒæ—¶ï¼Œè¯¥å¯¹è±¡å·²è¢«é‡Šæ”¾å¹¶ä¸”å¼±åºå¯¹çš„carå­—æ®µè®¾ç½®ä¸º#!bwpï¼š\n(define G (make-guardian)) (define x (cons aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (set! G #f) (collect) (car p) â‡’ #!bwp ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨guardianæ¥é‡Šæ”¾å¤–éƒ¨å­˜å‚¨ï¼Œå°±åƒç”±Cåº“â€œmallocâ€å’Œâ€œfreeâ€æ“ä½œç®¡ç†å­˜å‚¨ã€‚\n(define malloc (let ([malloc-guardian (make-guardian)]) (lambda (size) ; first free any storage that has been dropped. to avoid long ; delays, it might be better to deallocate no more than, say, ; ten objects for each one allocated (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f)))) ; then allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x)))) do-mallocå¿…é¡»è¿”å›ä¸€ä¸ªSchemeå¯¹è±¡â€œheaderâ€ï¼Œè¯¥headerå°è£…ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆï¼ˆå¯èƒ½æ˜¯æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡æ­¤headerå¯¹å¤–éƒ¨å­˜å‚¨è¿›è¡Œæ‰€æœ‰è®¿é—®ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¿…é¡»æ³¨æ„åœ¨åˆ é™¤ç›¸åº”çš„headerä¹‹åï¼Œåœ¨Schemeä¹‹å¤–ä¸å­˜åœ¨æŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆã€‚ do-freeå¿…é¡»ä½¿ç”¨å°è£…çš„æŒ‡é’ˆé‡Šæ”¾å¤–éƒ¨å­˜å‚¨ã€‚è¿™ä¸¤ä¸ªåŸè¯­éƒ½å¯ä»¥ä½¿ç”¨å¤–éƒ¨åˆ†é…å’Œå¤–éƒ¨æ— å…³çš„å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¤–éƒ¨è¿‡ç¨‹å¯¼å…¥çš„Cåº“â€œmallocâ€å’Œâ€œfreeâ€è¿ç®—ç¬¦è¿›è¡Œå®šä¹‰ã€‚\nå¦‚æœä¸å¸Œæœ›è°ƒç”¨mallocæ¥é‡Šæ”¾å­˜å‚¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨collect-requestå¤„ç†å™¨æ¥æ£€æŸ¥å¹¶é‡Šæ”¾å·²ä¸¢å¼ƒçš„å­˜å‚¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define malloc) (let ([malloc-guardian (make-guardian)]) (set! malloc (lambda (size) ; allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x))) (collect-request-handler (lambda () ; first, invoke the collector (collect) ; then free any storage that has been dropped (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f))))))) é€šè¿‡ä¸€ç‚¹é‡æ„ï¼Œå°±æœ‰å¯èƒ½å°†å°è£…çš„å¤–éƒ¨åœ°å€æ³¨å†Œä¸ºå¸¦headerçš„representativeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdo-freeå°†ä»…å°†å¤–éƒ¨åœ°å€ä½œä¸ºå‚æ•°ã€‚ è¿™å°†ä½¿æ ‡å¤´ä¸€æ—¦å˜å¾—ä¸å¯è®¿é—®ï¼Œä¾¿å¯ä»¥å°†å…¶ä»Schemeå †ä¸­åˆ é™¤ã€‚\né”å¯¹è±¡Locking Objects æ¥è‡ªCè¯­è¨€çš„å˜é‡æˆ–æ•°æ®ç»“æ„åˆ°Schemeå¯¹è±¡çš„æ‰€æœ‰æŒ‡é’ˆï¼Œé€šå¸¸åº”åœ¨è¾“å…¥ï¼ˆæˆ–é‡æ–°è¾“å…¥ï¼‰Schemeä¹‹å‰ä¸¢å¼ƒã€‚ å½“æ— æ³•éµå¾ªè¯¥å‡†åˆ™æ—¶ï¼Œå¯ä»¥é€šè¿‡é”å®šå¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Slock_objecté”å®šè¯¥å¯¹è±¡ã€‚\n(lock-object obj)\né”å®šå¯¹è±¡å¯é˜²æ­¢å­˜å‚¨ç®¡ç†å™¨æ”¶å›æˆ–é‡å®šä½è¯¥å¯¹è±¡ã€‚ åº”è°¨æ…ä½¿ç”¨é”å®šï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡å¹¶å¢åŠ å­˜å‚¨ç®¡ç†å¼€é”€ã€‚\nå¦‚æœæœªè§£é”å¯¹è±¡ï¼Œé”å®šä¹Ÿä¼šå¯¼è‡´æ„å¤–ä¿ç•™å­˜å‚¨ç©ºé—´ã€‚ å¯ä»¥é€šè¿‡è§£é”å¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Sunlock_objectæ¥è§£é”å¯¹è±¡ã€‚\né”å®šç«‹å³æ•°ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è¢«é™æ€åŒ–çš„å¯¹è±¡æ˜¯ä¸å¿…è¦ä½†æ— å®³çš„ã€‚\n(unlock-object obj)\né€šè¿‡è¿ç»­è°ƒç”¨lock-objectï¼ŒSlock_objectæˆ–åŒæ—¶è°ƒç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¤šæ¬¡é”å®šå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å…ˆé€šè¿‡ç›¸ç­‰æ¬¡æ•°çš„å¯¹unlock-objectæˆ–Sunlock_objectçš„è°ƒç”¨æ¥å°†å…¶è§£é”ã€‚\né™¤éå­˜åœ¨æŒ‡å‘å¯¹è±¡çš„å•ç‹¬çš„CæŒ‡é’ˆï¼Œå¦åˆ™ä¹Ÿæ— éœ€é”å®šåŒ…å«åœ¨é”å®šå¯¹è±¡ä¸­çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œé”å®šåºå¯¹çš„carä¸­çš„å¯¹è±¡ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»…å…è®¸é€šè¿‡å¤–éƒ¨å¯¹è±¡æ¥é—´æ¥è®¿é—®çš„å†…éƒ¨å¯¹è±¡ï¼Œåˆ™åº”å°†å…¶è§£é”ï¼Œä»¥ä¾¿å›æ”¶å™¨åœ¨å›æ”¶æœŸé—´å¯ä»¥è‡ªç”±åœ°é‡åˆ†é…å®ƒã€‚\nè§£é”ç«‹å³å€¼ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è®¾ä¸ºé™æ€çš„å¯¹è±¡æ˜¯ä¸å¿…è¦çš„ï¼Œæ— æ•ˆçš„ï¼Œä½†æ— å®³ã€‚\n(locked-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯é”å®šçš„ï¼Œç«‹å³çš„æˆ–é™æ€çš„ï¼Œè¿”å›#t\nå¦‚æœå›æ”¶å™¨æ— æ³•é‡åˆ†é…æˆ–å›æ”¶objï¼Œåˆ™è¯¥è°“è¯å°†è¿”å›trueï¼ŒåŒ…æ‹¬ç«‹å³å€¼ï¼Œä¾‹å¦‚fixnumsï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ä»¥åŠå·²è®¾ä¸ºé™æ€çš„å¯¹è±¡ã€‚\n","id":95,"section":"posts","summary":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨","tags":["scheme"],"title":"å­˜å‚¨ç®¡ç†(Storage Management in Chez Scheme)","uri":"https://lvsq.net/2020/02/storage-management/","year":"2020"},{"content":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;)\nè¿”å›ï¼šæœªæŒ‡å®š\nè­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢ç¨‹åºç»§ç»­è¿è¡Œä½†å¯èƒ½åœ¨ä»¥åå¯¼è‡´æ›´ä¸¥é‡é—®é¢˜çš„æƒ…å†µã€‚ é€šå¸¸æœ€å¥½æ˜¯è¯†åˆ«ç¨‹åºå‘˜å·²è°ƒç”¨çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜å¯èƒ½ä¸çŸ¥é“çš„å…¶ä»–è¿‡ç¨‹ã€‚ msgå¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶åº”æè¿°å¼‚å¸¸æƒ…å†µã€‚irritantå¯ä»¥æ˜¯ä»»ä½•Schemeå¯¹è±¡ï¼Œå¹¶ä¸”åº”åŒ…å«å¯èƒ½å¯¼è‡´æˆ–ä¸¥é‡æ¶‰åŠå¼‚å¸¸æƒ…å†µçš„å€¼ã€‚\n(assertion-violationf who msg irritant \u0026hellip;) | (errorf who msg irritant \u0026hellip;) | (warningf who msg irritant \u0026hellip;)\nè¿™äº›è¿‡ç¨‹ç±»ä¼¼äºassertion-violation, error, warning, æ‰€ä¸åŒçš„åœ¨äº msg è®¾å®šä¸ºä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²\nä¸­æ–­ Chez Schemeå…è®¸ç¨‹åºåœ¨å‘ç”Ÿå„ç§äº‹ä»¶æ—¶æ§åˆ¶Schemeç³»ç»Ÿçš„æ“ä½œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬é”®ç›˜ä¸­æ–­ï¼Œç”±set-timerè®¾ç½®çš„å†…éƒ¨è®¡æ—¶å™¨åˆ°æœŸï¼Œç”±ä¸­æ–­è°ƒç”¨å¼•å‘çš„æ–­ç‚¹æˆ–è€…æ¥è‡ªå­˜å‚¨ç®¡ç†å™¨çš„è¯·æ±‚å¯åŠ¨GCã€‚\næ— è®ºä½•æ—¶breakè¢«è°ƒç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šç«‹å³å¯ç”¨ä¸­æ–­å¤„ç†ç¨‹åº\n(break who msg irritant \u0026hellip;) | (break who) | (break)\nbreakå‚æ•°éµå¾ªä¸Šè¿°errorfçš„åè®®ã€‚é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆè¯·å‚è§break-handlerï¼‰æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯å¹¶è°ƒç”¨è°ƒè¯•å™¨ã€‚å¯ä»¥çœç•¥æ ¼å¼å­—ç¬¦ä¸²å’Œå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºå‘å‡ºçš„æ¶ˆæ¯ä½¿ç”¨whoå‚æ•°æ ‡è¯†ä¸­æ–­ï¼Œä½†ä¸æä¾›æœ‰å…³ä¸­æ–­çš„æ›´å¤šä¿¡æ¯ã€‚å¦‚æœä¹Ÿçœç•¥äº†whoå‚æ•°ï¼Œåˆ™ä¸ä¼šç”Ÿæˆä»»ä½•æ¶ˆæ¯ã€‚å¦‚æœè°ƒè¯•å™¨æ­£å¸¸é€€å‡ºï¼Œåˆ™é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºå°†æ­£å¸¸è¿”å›ã€‚\nbreak-handler\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“å‰çš„ä¸­æ–­å¤„ç†ç¨‹åºç”±breakè°ƒç”¨ï¼Œå®ƒä¼ é€’å…¶å‚æ•°ã€‚æœ‰å…³é»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºçš„æè¿°ï¼Œè¯·å‚è§breakã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ç¦ç”¨breaksã€‚\n(break-handler (lambda args (void))) (set-timer n)\nn å¿…é¡»ä¸ºéè´Ÿæ•´æ•°ã€‚å½“n ä¸ºéé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å¯åŠ¨ä¸€ä¸ªå†…éƒ¨è®¡æ—¶å™¨ï¼Œå…¶åˆå§‹å€¼ä¸ºnã€‚ç»è¿‡nä¸ªtickåï¼Œå°†å‘ç”Ÿè®¡æ—¶å™¨ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´è®¡æ—¶å™¨ä¸­æ–­å¤„ç†ç¨‹åºè¢«è°ƒç”¨ã€‚tickä¸æ˜¯ç»Ÿä¸€çš„æ—¶é—´å•ä½ï¼Œè€Œæ˜¯åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ¯ä¸ªè¿‡ç¨‹è°ƒç”¨è¦å®Œæˆå¤šå°‘å·¥ä½œã€‚\nå½“nä¸ºé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å…³é—­è®¡æ—¶å™¨ã€‚\nengineæœºåˆ¶å»ºç«‹åœ¨è®¡æ—¶å™¨ä¸­æ–­ä¹‹ä¸Šï¼Œå› æ­¤ä¸åº”ä¸engineå…±åŒä½¿ç”¨ã€‚\n(register-signal-handler sig procedure)\nregister-signal-handlerç”¨äºä¸ºç»™å®šçš„åº•å±‚ä¿¡å·å»ºç«‹ä¿¡å·å¤„ç†ç¨‹åºã€‚ sigå¿…é¡»æ˜¯æ ‡è¯†æœ‰æ•ˆä¿¡å·çš„ç²¾ç¡®æ•´æ•°ï¼Œè¿‡ç¨‹åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚åœ¨æ³¨å†Œäº†ç»™å®šsignalçš„å¤„ç†ç¨‹åºä¹‹åï¼Œæ”¶åˆ°äº†ç»™å®šçš„signalä¼šè°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚signalç¼–å·ä¼šä¼ é€’ç»™è¯¥å¤„ç†ç¨‹åºï¼Œä»è€Œå…è®¸åŒä¸€å¤„ç†ç¨‹åºç”¨äºä¸åŒçš„ä¿¡å·ï¼ŒåŒæ—¶åŒºåˆ†å®ƒä»¬ã€‚\nä»¥è¿™ç§æ–¹å¼å¤„ç†çš„ä¿¡å·ç±»ä¼¼äºé”®ç›˜ä¸­æ–­ï¼Œå› ä¸ºåœ¨å°†ä¿¡å·ä¼ é€’åˆ°è¿›ç¨‹æ—¶ä¸ä¼šç«‹å³è°ƒç”¨å¤„ç†ç¨‹åºï¼Œè€Œæ˜¯åœ¨ä¿¡å·ä¼ é€’ååœ¨æŸä¸ªè¿‡ç¨‹è°ƒç”¨è¾¹ç•Œå¤„è°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚å› æ­¤ï¼Œä¸ºå†…å­˜æ•…éšœï¼Œéæ³•æŒ‡ä»¤ç­‰å»ºç«‹å¤„ç†ç¨‹åºé€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå¯¼è‡´æ•…éšœæˆ–éæ³•æŒ‡ä»¤çš„ä»£ç å°†åœ¨è°ƒç”¨å¤„ç†ç¨‹åºä¹‹å‰ç»§ç»­æ‰§è¡Œï¼ˆå¯èƒ½æ˜¯é”™è¯¯çš„ï¼‰ä¸€æ®µæ—¶é—´ã€‚\nå¦å¤–ï¼Œä»…åœ¨åŸºäºUnixçš„ç³»ç»Ÿä¸Šæ‰æ”¯æŒregister-signal-handlerã€‚\nç¯å¢ƒ ç¯å¢ƒæ˜¯åŒ…å«æ ‡è¯†ç¬¦ç»‘å®šçš„é¡¶çº§ï¼ˆfirst-classï¼‰å¯¹è±¡ã€‚å®ƒä»¬ç±»ä¼¼äºæ¨¡å—ï¼Œä½†æ˜¯ä¸æ¨¡å—ä¸åŒï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ“ä½œã€‚ç¯å¢ƒå¯ä»¥ä½œä¸ºevalï¼Œexpandä»¥åŠè¿‡ç¨‹çš„å®šä¹‰ï¼Œåˆ†é…æˆ–å¼•ç”¨é¡¶çº§å€¼çš„å¯é€‰å‚æ•°ã€‚\næœ‰å‡ ç§å†…ç½®ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤åˆ¶ç°æœ‰ç¯å¢ƒæˆ–ä»ç°æœ‰ç¯å¢ƒä¸­é€‰æ‹©çš„ç»‘å®šæ¥åˆ›å»ºæ–°ç¯å¢ƒã€‚\nç¯å¢ƒå¯ä»¥æ˜¯å¯å˜çš„æˆ–ä¸å˜çš„ã€‚å¯å˜çš„ç¯å¢ƒå¯ä»¥ä½¿ç”¨æ–°çš„ç»‘å®šè¿›è¡Œæ‰©å±•ï¼Œå¯ä»¥ä¿®æ”¹å…¶ç°æœ‰ç»‘å®šï¼Œè¿˜å¯ä»¥åˆ†é…å…¶å˜é‡ã€‚ä¸å˜çš„ç¯å¢ƒä¸èƒ½ä»¥ä»»ä½•è¿™äº›æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚\nè”æƒ³ä¸€ä¸‹SICPä¸­å…³äºç¯å¢ƒçš„å†…å®¹ (environment? obj)\n(environment? (interaction-environment)) â‡’ #t (environment? \u0026#39;interaction-environment) â‡’ #f (environment? (copy-environment (scheme-environment))) â‡’ #t (environment? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #t (environment-mutable? env)\n(environment-mutable? (interaction-environment)) â‡’ #t (environment-mutable? (scheme-environment)) â‡’ #f (environment-mutable? (copy-environment (scheme-environment))) â‡’ #t (environment-mutable? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #f (scheme-environment)\nscheme-environmentè¿”å›ä¸€ä¸ªåŒ…å«åˆå§‹é¡¶çº§ç»‘å®šçš„ç¯å¢ƒã€‚è¯¥ç¯å¢ƒå¯¹åº”äºSchemeæ¨¡å—ã€‚æ­¤è¿‡ç¨‹è¿”å›çš„ç¯å¢ƒæ˜¯ä¸å¯å˜çš„ã€‚\n(define cons 3) (top-level-value \u0026#39;cons (scheme-environment)) â‡’ #\u0026lt;procedure cons\u0026gt; (set-top-level-value! \u0026#39;cons 3 (scheme-environment)) â‡’ exception (copy-environment env) | (copy-environment env mutable?) | (copy-environment env mutable? syms)\ncopy-environmentè¿”å›envçš„å‰¯æœ¬ï¼Œå³åŒ…å«ä¸env ç›¸åŒç»‘å®šçš„æ–°ç¯å¢ƒã€‚mutable? å¦‚æœä¸ºtrueï¼Œåˆ™è¯¥environmentæ˜¯å¯å˜çš„ï¼Œåä¹‹åˆ™ä¸å¯å˜ï¼›\nä»env å¤åˆ¶åˆ°æ–°ç¯å¢ƒçš„ç»‘å®šé›†ç”±syms ç¡®å®šï¼Œå…¶é»˜è®¤å€¼ä¸ºï¼ˆenvironment-symbols envï¼‰ã€‚æ¯ä¸ªsyms å…ƒç´ çš„ç»‘å®šï¼ˆå¦‚æœæœ‰ï¼‰éƒ½è¢«å¤åˆ¶åˆ°æ–°ç¯å¢ƒä¸­ï¼Œå¹¶ä¸”æ–°ç¯å¢ƒä¸­ä¸å­˜åœ¨å…¶ä»–ç»‘å®šã€‚\nåœ¨å½“å‰çš„å®ç°ä¸­ï¼Œæ°¸è¿œä¸ä¼šæ”¶é›†ç¯å¢ƒä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤é‡å¤ä½¿ç”¨å¤åˆ¶ç¯å¢ƒæœ€ç»ˆå°†å¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚\n(define e (copy-environment (scheme-environment))) (eval \u0026#39;(define cons +) e) (eval \u0026#39;(cons 3 4) e) â‡’ 7 (eval \u0026#39;(cons 3 4) (scheme-environment)) â‡’ (3 . 4) (environment-symbols env)\næ­¤è¿‡ç¨‹è¿”å›ä»£è¡¨ç¯å¢ƒenvä¸­ç»‘å®šçš„æ ‡è¯†ç¬¦çš„ç¬¦å·åˆ—è¡¨ã€‚å®ƒä¸»è¦ç”¨äºæ„å»ºè¦ä»ä¸€ç§ç¯å¢ƒå¤åˆ¶åˆ°å¦ä¸€ç§ç¯å¢ƒçš„ç¬¦å·åˆ—è¡¨ã€‚\n(define listless-environment (copy-environment (scheme-environment) #t (remq \u0026#39;list (environment-symbols (scheme-environment))))) (eval \u0026#39;(let ([x (cons 3 4)]) x) listless-environment) â‡’ (3 . 4) (eval \u0026#39;(list 3 4) listless-environment) â‡’ exception ç¼–è¯‘ã€æ±‚å€¼å’ŒåŠ è½½ (eval obj) | (eval obj env)\nevalå°†obj è§†ä¸ºè¡¨è¾¾å¼çš„è¡¨ç¤ºå½¢å¼ã€‚å®ƒåœ¨ç¯å¢ƒenvä¸­è®¡ç®—è¡¨è¾¾å¼å¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœæœªæä¾›ä»»ä½•ç¯å¢ƒï¼Œåˆ™é»˜è®¤ä¸ºç”±äº¤äº’ç¯å¢ƒè¿”å›çš„ç¯å¢ƒã€‚ å•å‚æ•°æ±‚å€¼æ˜¯Chez Schemeçš„æ‰©å±•ã€‚å½“ç¯å¢ƒå¯å˜æ—¶ï¼ŒChez Schemeè¿˜å…è®¸objè¡¨ç¤ºéè¡¨è¾¾å½¢å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªdefinitionã€‚ Chez Schemeè¿˜å…è®¸objä½œä¸ºä¸€ä¸ªannotationï¼Œé»˜è®¤æ±‚å€¼ç¨‹åºåˆ©ç”¨æ³¨é‡Šå°†æºæ–‡ä»¶ä¿¡æ¯åˆå¹¶åˆ°é”™è¯¯æ¶ˆæ¯ä¸­ï¼Œå¹¶å°†æºæ–‡ä»¶ä¿¡æ¯ä¸ç¼–è¯‘åçš„ä»£ç ç›¸å…³è”ã€‚\nåœ¨Chez Schemeä¸­ï¼Œevalå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œä»…å°†å…¶å‚æ•°ä¼ é€’ç»™å½“å‰æ±‚å€¼å™¨ï¼ˆè¯·å‚é˜…current-evalï¼‰ã€‚é»˜è®¤çš„è¯„ä¼°å™¨æ˜¯compileï¼Œå®ƒé€šè¿‡å½“å‰çš„æ‰©å±•å™¨ï¼ˆå‚é˜…current-expandï¼‰æ‰©å±•è¡¨è¾¾å¼ï¼Œå¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰§è¡Œç”Ÿæˆçš„ä»£ç ï¼Œå¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœå­˜åœ¨ç¯å¢ƒå‚æ•°env ï¼Œåˆ™compileå°†å…¶ä¼ é€’ç»™å½“å‰çš„æ‰©å±•å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºsc-expandã€‚\n(compile obj) | (compile obj env)\nobj å¯ä»¥ä¸ºSchemeè¡¨è¾¾å¼ï¼Œåœ¨æŒ‡å®šçš„ç¯å¢ƒï¼ˆæˆ–äº¤äº’ç¯å¢ƒï¼Œå¦‚æœæœªæä¾›ç¯å¢ƒï¼‰ä¸­ä½¿ç”¨å½“å‰æ‰©å±•å™¨ï¼ˆcurrent-expandçš„å€¼ï¼‰è¿›è¡Œæ‰©å±•ï¼‰ï¼Œç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œç„¶åæ‰§è¡Œã€‚ compileæ˜¯current-evalå‚æ•°çš„é»˜è®¤å€¼ã€‚\n(compile \u0026#39;(cons 1 2)) =\u0026gt; (1 . 2) (interpret obj) | (interpret obj env)\nè§£é‡Šç±»ä¼¼äºç¼–è¯‘ï¼Œåªæ˜¯è¡¨è¾¾å¼æ˜¯è§£é‡Šçš„è€Œä¸æ˜¯ç¼–è¯‘çš„ï¼ˆthe expression is interpreted rather than compiledï¼‰ã€‚è§£é‡Šå¯ä»¥ç”¨ä½œç¼–è¯‘çš„æ›¿ä»£å“ï¼Œä½†æœ‰ä»¥ä¸‹è­¦å‘Šï¼š\nè§£é‡Šåçš„ä»£ç è¿è¡Œé€Ÿåº¦å¤§å¤§é™ä½ è§£é‡Šåçš„ä»£ç ä¸ä¼šç”Ÿæˆæ£€æŸ¥å™¨ä¿¡æ¯ï¼Œå› æ­¤æ£€æŸ¥å™¨å¯¹äºè§£é‡Šçš„ä»£ç ä¸å¦‚åœ¨ç¼–è¯‘çš„ä»£ç ä¸­æœ‰ç”¨ã€ æ— æ³•è§£é‡Šå¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼ï¼Œå› æ­¤è§£é‡Šå™¨éœ€è¦ä¸ºæ‰€æœ‰å¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼è°ƒç”¨ç¼–è¯‘å™¨ï¼ˆè¿™æ˜¯é€æ˜å®Œæˆçš„ï¼‰ å½“æ±‚å€¼å½¢å¼è¿è¡Œæ—¶é—´è¾ƒçŸ­æ—¶ï¼Œè§£é‡Šæœ‰æ—¶æ¯”ç¼–è¯‘æ›´å¿«ï¼Œå› ä¸ºå®ƒé¿å…äº†åœ¨æ±‚å€¼ä¹‹å‰é€šè¿‡ç¼–è¯‘å®Œæˆçš„æŸäº›å·¥ä½œã€‚\n(load path) | (load path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚ loadè¯»å–å¹¶æ±‚å€¼path æŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œloadä½¿ç”¨evalæ±‚å€¼æºæ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-proc ï¼Œåˆ™loadå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-proc å¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\neval-procå‚æ•°æœ‰åŠ©äºå®ç°åµŒå…¥çš„ç±»ä¼¼äºSchemeçš„è¯­è¨€ï¼Œå¹¶æœ‰åŠ©äºä½¿ç”¨ç”¨äºSchemeç¨‹åºçš„æ›¿ä»£è¯„ä¼°æœºåˆ¶ã€‚ eval-procä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–ç”¨é€”ã€‚ä¾‹å¦‚ï¼Œ\n(load \u0026#34;myfile.ss\u0026#34; (lambda (x) (pretty-print (if (annotation? x) (annotation-stripped x) x)) (newline) (eval x))) å¯¹æ¯ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼ä¹‹å‰ä½¿ç”¨pretty-printæ‰“å°ã€‚\nå‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-library path) | (load-library path eval-proc)\nload-libraryä¸loadç›¸åŒï¼Œé™¤äº†å®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rsä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒï¼chezscheme**è¦†ç›–\n(load-program path) | (load-program path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚åŠ è½½ç¨‹åºè¯»å–å¹¶æ±‚å€¼pathæŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚ è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚å¦‚æœåŒ…å«æºä»£ç ï¼Œåˆ™åŠ è½½ç¨‹åºä¼šå°†ä»£ç ä»¥é¡¶çº§ç¨‹åºå½¢å¼åŒ…è£…èµ·æ¥ï¼Œä»¥ä¾¿å°†æ–‡ä»¶çš„å†…å®¹è§†ä¸ºRNRSé¡¶çº§ç¨‹åºï¼ˆSchemeç¼–ç¨‹è¯­è¨€ï¼Œç¬¬4ç‰ˆçš„10.3èŠ‚ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½ç¨‹åºä½¿ç”¨evalæ±‚å€¼æ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-procï¼Œåˆ™è£…å…¥ç¨‹åºå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¯„ä¼°çš„è¡¨è¾¾å¼ã€‚ä¼ é€’ç»™eval-procçš„è¡¨è¾¾å¼å¯èƒ½æ˜¯æ³¨é‡Šæˆ–æœªæ³¨é‡Šçš„å€¼ã€‚ å‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-compiled-from-port input-port)\nload-compiled-from-portè¯»å–å¹¶æ±‚å€¼æ¥è‡ªinput-portçš„å¯¹è±¡ä»£ç çš„å†…å®¹ï¼Œè¿™äº›input-portæ˜¯äº‹å…ˆç”±è¯¸å¦‚compile-file, compile-script, compile-library, compile-to-portåˆ›å»ºçš„ è¿”å›å€¼æ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè¯¥è¡¨è¾¾å¼çš„ç¼–è¯‘å½¢å¼ä¸ºinput-portã€‚å¦‚æœinput-portä¸ºç©ºï¼Œåˆ™ç»“æœå€¼æœªæŒ‡å®šã€‚\n(compile-file input-filename) | (compile-file input-filename output-filename)\ninput-filename å’Œoutput-filename å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚input-filename å¿…é¡»æ˜¯å·²å­˜åœ¨çš„å¯è¯»æ–‡ä»¶ã€‚å®ƒå¿…é¡»åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªæºè¡¨è¾¾å¼çš„åºåˆ—ï¼›å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™ç¼–è¯‘æ–‡ä»¶ä¼šå¼•å‘æ¡ä»¶ç±»å‹ä¸ºï¼†syntaxçš„å¼‚å¸¸ã€‚\næ­£å¸¸æ±‚å€¼è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚ compile-fileå¯¹æ•´ä¸ªæºæ–‡ä»¶æ‰§è¡Œç¼–è¯‘è¿‡ç¨‹ï¼Œä»è€Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚éšååŠ è½½ç›®æ ‡æ–‡ä»¶ï¼ˆè¯·å‚è§loadï¼‰æ—¶ï¼Œä¸éœ€è¦ç¼–è¯‘è¿‡ç¨‹ï¼Œå¹¶ä¸”æ–‡ä»¶åŠ è½½é€šå¸¸å¿«å‡ å€ã€‚\n(compile-script input-filename) | (compile-script input-filename output-filename)\ncompile-scriptä¸compile-fileç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºï¼Œå®ƒä¼šä»æºæ–‡ä»¶å¤åˆ¶å¼€å¤´çš„**#!è¡Œåˆ°ç›®æ ‡æ–‡ä»¶ï¼ŒåŒæ—¶è¯¥è¡Œä¸ä¼šè¢«å‹ç¼©ï¼Œå°½ç®¡å‚æ•°compile-compressed**è¢«è®¾ç½®ä¸º#tï¼Œå…¶ä»–ä»£ç ä¼šè¢«å‹ç¼©ï¼Œè¿™æ ·ä¼šä¿è¯æ“ä½œç³»ç»Ÿå¯ä»¥æ­£ç¡®åœ°è§£é‡Šã€‚\ncompile-scriptå…è®¸ä»æºè„šæœ¬åˆ›å»ºå·²ç¼–è¯‘çš„è„šæœ¬æ–‡ä»¶ï¼Œä»¥å‡å°‘è„šæœ¬åŠ è½½æ—¶é—´ã€‚ä¸æºä»£ç è„šæœ¬ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨**\u0026ndash;script**å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œå·²ç¼–è¯‘çš„è„šæœ¬ã€‚\n(compile-library input-filename) | (compile-library input-filename oiutput-filename)\ncompile-libraryä¸compile-fileç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rs**ä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒ!chezschemeè¦†ç›–ã€‚\n(compile-program input-filename) | (compile-program input-filename output-filename)\ncompile-programç±»ä¼¼äºcompile-scriptï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå®ç°äº†RNRSé¡¶çº§ç¨‹åºçš„è¯­ä¹‰ï¼Œè€Œcompile-scriptåˆ™å®ç°äº†äº¤äº’å¼é¡¶çº§ç¨‹åºçš„è¯­ä¹‰ã€‚ä¸é€šè¿‡compile-fileæˆ–compile-scriptè¿›è¡Œç¼–è¯‘ç›¸æ¯”ï¼Œç”Ÿæˆçš„å·²ç¼–è¯‘ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚\ncompile-programè¿”å›ç”±ç¼–è¯‘çš„é¡¶å±‚ç¨‹åºç›´æ¥è°ƒç”¨çš„åº“çš„åˆ—è¡¨ï¼Œä¸åŒ…æ‹¬ï¼ˆrnrsï¼‰å’Œï¼ˆchezschemeï¼‰ä¹‹ç±»çš„å†…ç½®åº“\n(compile-whole-program input-filename output-filename) | (compile-whole-program input-filename output-filename libs-visible?)\ncompile-whole-programæ¥å—ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºåç§°è¾“å…¥ï¼Œè¯¥æ–‡ä»¶åä¸ºé¡¶çº§ç¨‹åºå‘½åä¸ºâ€œ whole program optimizationâ€ï¼ˆwpoï¼‰æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒ…å«è¯¥ç¨‹åºåŠå…¶æ‰€ä¾èµ–çš„æ¯ä¸ªåº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œå‰ææ˜¯éœ€è¦ä¸€ä¸ªå¯ä»¥æ‰¾åˆ°åº“çš„wpoæ–‡ä»¶ã€‚\nå¦‚æœwpoæ–‡ä»¶æ‰¾ä¸åˆ°æ‰€éœ€åº“ï¼Œä½†å¯ä»¥æ‰¾åˆ°è¯¥åº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™è¯¥åº“ä¸ä¼šåˆå¹¶åˆ°ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚è¿™äº›åº“å°†åœ¨è¿è¡Œæ—¶åŠ è½½ã€‚ compile-whole-programè¿”å›è¿™äº›åº“çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„åº“ï¼Œåˆ™ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶æ˜¯è‡ªåŒ…å«çš„ï¼Œå¹¶ä¸”compile-whole-programè¿”å›ç©ºåˆ—è¡¨ã€‚\nå¦‚æœlibs-visible? è®¾ç½®ä¸ºéfalseï¼Œåˆ™åº“åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶æ˜¯å¯è§çš„ï¼ˆä¾›environmentå’Œevalä½¿ç”¨ï¼‰ï¼Œä»»ä½•åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­å¹¶åœ¨è¿è¡Œæ—¶ä¿ç•™ä¸‹æ¥çš„ç›®æ ‡æ–‡ä»¶æ‰€è¦æ±‚çš„åº“éƒ½æ˜¯å¯è§çš„ã€‚\nå½“generate-wpo-fileså‚æ•°è®¾ç½®ä¸º#tæ—¶ï¼Œè¿‡ç¨‹compile-fileï¼Œcompile-programï¼Œcompile-libraryï¼Œcompile-scriptå’Œcompile-whole-libraryä¼šç”Ÿæˆwpoæ–‡ä»¶ä»¥åŠæ™®é€šç›®æ ‡æ–‡ä»¶ã€‚ ï¼ˆé»˜è®¤å€¼ä¸º#fï¼‰ã€‚å¦å¤–å¦‚æœä¼ é€’å¯é€‰çš„wpoç«¯å£æ—¶ï¼Œcompile-portå’Œcompile-to-portä¹Ÿä¼šè¿™æ ·åšã€‚\n(compile-whole-library input-filename output-filename)\ncompile-whole-libraryç±»ä¼¼äºcompile-whole-programï¼Œä¸åŒä¹‹å¤„åœ¨äºinput-filenameå¿…é¡»ä¸ºåº“æŒ‡å®šä¸€ä¸ªwpoæ–‡ä»¶ï¼Œæ‰€æœ‰åº“è‡ªåŠ¨æ˜¾ç¤ºï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„wpoæ–‡ä»¶ï¼ˆå½“generate-wpo-filesä¸º#tæ—¶ï¼‰ä»¥åŠç”¨äºç”Ÿæˆçš„åº“ç»„åˆçš„ç›®æ ‡æ–‡ä»¶ã€‚\n(compile-port input-port output-port) | (compile-port input-port output-port sfd) | (compile-port input-port output-port sfd wpo-port)\ninput-port å¿…é¡»æ˜¯æ–‡æœ¬è¾“å…¥ç«¯å£ã€‚out-port å’Œwpo-portï¼ˆå¦‚æœå­˜åœ¨ï¼‰å¿…é¡»æ˜¯äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ã€‚å¦‚æœå­˜åœ¨sfd ,å¿…é¡»æ˜¯æºæ–‡ä»¶æè¿°ç¬¦ã€‚\n(make-boot-file output-filename base-boot-list input-filename \u0026hellip;)\næ‰€æœ‰å‚æ•°éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚\nmake-boot-fileå°†å¼•å¯¼æ ‡å¤´ï¼ˆboot headerï¼‰å†™å…¥ä»¥output-filename å‘½åçš„æ–‡ä»¶ï¼Œç„¶åä¾æ¬¡å†™å…¥æ¯ä¸ªinput-filename çš„ç›®æ ‡ä»£ç ã€‚å¦‚æœå°šæœªç¼–è¯‘è¾“å…¥æ–‡ä»¶ï¼Œmake-boot-fileå°†åœ¨å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚\nå¼•å¯¼æ–‡ä»¶é€šè¿‡\u0026ndash;bootæˆ–-bå‘½ä»¤è¡Œé€‰é¡¹æ˜¾å¼åŠ è½½ï¼Œæˆ–åŸºäºå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°éšå¼åŠ è½½ã€‚\n(make-boot-header output-filename base-boot1 base-boot2\u0026hellip;)\nè¯¥è¿‡ç¨‹å·²åŒ…å«åœ¨make-boot-fileä¸­ï¼Œå¹¶æä¾›äº†å‘åå…¼å®¹æ€§ã€‚\n(make-boot-header output-filename base-boot1 base-boot2 \u0026hellip;) ç­‰ä»·äºï¼š (make-boot-file output-filename â€™(base-boot1 base-boot2 \u0026hellip;))\næºç›®å½•å’Œæ–‡ä»¶ source-directories\nsource-directoriesçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²éƒ½å‘½åä¸€ä¸ªç›®å½•è·¯å¾„ã€‚å½“é€šè¿‡load, load-library, load-program, include, visit, or revisitåœ¨äº¤äº’å¼æ£€æŸ¥å™¨ä¸­å‘ç”Ÿè¯­æ³•é”™è¯¯æˆ–æ‰“å¼€æºæ–‡ä»¶æ—¶ï¼Œsource-directoryç¡®å®šç”¨äºæœç´¢æºæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶çš„ç›®å½•é›†ã€‚\né»˜è®¤å€¼ä¸ºåˆ—è¡¨ï¼ˆâ€œ.â€ï¼‰ï¼Œè¿™æ„å‘³ç€ä»…åœ¨å½“å‰ç›®å½•ä¸­æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•æ‰èƒ½æ‰¾åˆ°æºæ–‡ä»¶ï¼Œé™¤éä½¿ç”¨ç»å¯¹è·¯å¾„å‘½åã€‚\n(with-source-path who name procedure)\nè¿‡ç¨‹with-source-pathä¾æ¬¡æœç´¢å½“å‰æºç›®å½•è·¯å¾„ï¼Œä»¥æŸ¥æ‰¾å…·æœ‰æŒ‡å®šåç§°çš„æ–‡ä»¶ï¼Œå¹¶åœ¨ç»“æœä¸Šè°ƒç”¨è¿‡ç¨‹ã€‚å¦‚æœæœªæ‰¾åˆ°è¿™æ ·çš„æ–‡ä»¶ï¼Œåˆ™å¼•å‘**\u0026amp;assertionå’Œ\u0026amp;whoå¼‚å¸¸ï¼Œ\u0026amp;who**çš„å€¼ä¸ºwho çš„å€¼\nå¦‚æœname æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ä»¥./ï¼ˆWindowsä¸‹æ˜¯./ï¼‰ï¼Œæˆ–è€…../ï¼ˆWindowsä¸‹æ˜¯..\\ï¼‰ï¼Œæˆ–è€…æºç›®å½•åˆ—è¡¨ä¸­åªåŒ…å«â€œ.â€ï¼Œæˆ–è€…é»˜è®¤å€¼ \u0026ldquo;\u0026quot;ï¼Œç›¸å½“äº \u0026ldquo;.\u0026quot;ï¼Œä¸æ‰§è¡Œæœç´¢å¹¶è¿”å›nameã€‚\nwho å¿…é¡»æ˜¯ç¬¦å·ï¼Œname å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œprocedure åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚\nä»¥ä¸‹ç¤ºä¾‹å‡å®šæ–‡ä»¶â€œ pieâ€å­˜åœ¨äºç›®å½•â€œ ../spamâ€ä¸­ï¼Œä½†ä¸åœ¨â€œ ../hamâ€æˆ–å½“å‰ç›®å½•ä¸­ã€‚\n(define find-file (lambda (fn) (with-source-path \u0026#39;find-file fn values))) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ exception in find-file: pie not found (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;../spam/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;/pie\u0026#34;) â‡’ \u0026#34;/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;./pie\u0026#34;) â‡’ \u0026#34;./pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;../pie\u0026#34;) â‡’ \u0026#34;../ham/pie\u0026#34; ç¼–è¯‘å™¨ç®¡ç† optimize-level\nè¯¥å‚æ•°å¯ä»¥æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3è¿™4ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚\nç†è®ºä¸Šï¼Œæ­¤å‚æ•°æ§åˆ¶ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¼˜åŒ–é‡ã€‚ å®é™…ä¸Šï¼Œå®ƒåªæ˜¯é—´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºä¼˜åŒ–çº§åˆ«3ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œä¸å®‰å…¨â€ä»£ç ï¼‰ä¸ä¼˜åŒ–çº§åˆ«0-2ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œå®‰å…¨â€ä»£ç ï¼‰ä¹‹é—´ã€‚ å®‰å…¨ä»£ç ä¼šæ‰§è¡Œå®Œæ•´ç±»å‹å’ŒèŒƒå›´æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼Œå°è¯•åº”ç”¨éè¿‡ç¨‹ï¼Œå°è¯•å¯¹non-pairçš„caræ“ä½œæˆ–å°è¯•å¼•ç”¨å‘é‡çš„æœ«å°¾ï¼Œå‡ä¼šå¯¼è‡´ å¼•å‘å¼‚å¸¸ã€‚ å¯¹äºä¸å®‰å…¨çš„ä»£ç ï¼Œç›¸åŒçš„æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ï¼ŒSchemeå †æŸåï¼ˆè¿™å¯èƒ½åœ¨ä»¥åå¼•èµ·çœ‹ä¼¼æ— å…³çš„é—®é¢˜ï¼‰ï¼Œç³»ç»Ÿå´©æºƒæˆ–å…¶ä»–ä¸è‰¯è¡Œä¸ºã€‚ä¸å®‰å…¨çš„ä»£ç é€šå¸¸ä¼šæ›´å¿«ï¼Œä½†æ˜¯åº”è¯¥è°¨æ…ä½¿ç”¨ä¼˜åŒ–çº§åˆ«3ï¼Œå¹¶ä¸”ä»…è¿ç”¨åœ¨å¿…é¡»å°½å¿«è¿è¡Œä¸”ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ä»£ç ä¸­ã€‚\nå°½ç®¡ç¼–è¯‘å™¨ä¸ºä¼˜åŒ–0è‡³2çº§ç”Ÿæˆäº†ç›¸åŒçš„ä»£ç ï¼Œä½†å¦‚æœéœ€è¦ï¼Œç”¨æˆ·å®šä¹‰çš„å®è½¬æ¢å™¨å¯ä»¥åŒºåˆ†ä¸åŒçš„çº§åˆ«ã€‚\nä¸€ç§ä½¿ç”¨ä¼˜åŒ–çº§åˆ«çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ–‡ä»¶ä¸Šï¼Œå¼ºåˆ¶ä½¿ç”¨eval-whenã€‚ ä¾‹å¦‚:\n(eval-when (compile) (optimize-level 3)) ä¹Ÿå¯ä»¥é€šè¿‡\u0026ndash;optimize-levelå‘½ä»¤è¡Œé€‰é¡¹è®¾ç½®ä¼˜åŒ–çº§åˆ«ã€‚æ­¤é€‰é¡¹å¯¹äºé€šè¿‡\u0026ndash;programå‘½ä»¤è¡Œé€‰é¡¹åœ¨ä¼˜åŒ–çº§åˆ«3è¿è¡ŒRNRSé¡¶å±‚ç¨‹åºç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºeval-whenå¯¹RNRSé¡¶å±‚ç¨‹åºæ— æ•ˆã€‚\n($primitive variable) | ($primitive 2 variable) | ($primitive 3 variable)\nvariable å¿…é¡»æ˜¯ä¸€ä¸ªåŸå§‹procedureçš„åå­—ã€‚** $primitive**è¯­æ³•å½¢å¼å…è®¸ä»¥å•ä¸ªåŸå§‹å¼•ç”¨çš„ç²’åº¦æ§åˆ¶ä¼˜åŒ–çº§åˆ«ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ç”¨äºè®¿é—®åŸå§‹å€¼ã€‚\nè¡¨è¾¾å¼ï¼ˆ$primitive variableï¼‰å¯ä»¥ç¼©å†™ä¸º**#%variable**ã€‚\n(#%car â€™(a b c)) â‡’ a (let ([car cdr]) (car \u0026#39;(a b c))) â‡’ (b c) (let ([car cdr]) (#%car \u0026#39;(a b c))) â‡’ a (begin (set! car cdr) (#%car \u0026#39;(a b c))) â‡’ a debug-level\nè¯¥å‚æ•°å¯ä»¥é‡‡ç”¨0ã€1ã€2å’Œ3è¿™å››ä¸ªå€¼ä¹‹ä¸€ã€‚å®ƒç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ä¿ç•™è°ƒè¯•ä¿¡æ¯çš„é‡è¦æ€§ï¼Œå…¶ä¸­0çš„é‡è¦æ€§æœ€ä½ï¼Œè€Œ3çš„é‡è¦æ€§æœ€é«˜ã€‚ é»˜è®¤å€¼æ˜¯1ã€‚ä»9.0ç‰ˆå¼€å§‹ï¼Œå®ƒä»…ç”¨äºç¡®å®šåœ¨éå°¾éƒ¨ä½ç½®é‡åˆ°çš„å¼•èµ·é”™è¯¯çš„è°ƒç”¨æ˜¯å¦è¢«è§†ä¸ºåœ¨å°¾éƒ¨ä½ç½®ï¼ˆå› æ­¤ï¼Œå¯¼è‡´è°ƒç”¨è€…çš„å¸§ä¸å‡ºç°åœ¨å †æ ˆå›æº¯ä¸­ï¼‰ã€‚ è¿™å‘ç”Ÿåœ¨ä½äº2çš„è°ƒè¯•çº§åˆ«ã€‚\næ¦‚è¦åˆ†æProfiling ChezSchemeæ”¯æŒä¸¤ç§ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼šæºä»£ç æ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æã€‚\nå¯ç”¨æºæ¦‚è¦åˆ†æåï¼Œç¼–è¯‘å™¨ä¼šå¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œä»¥è®¡ç®—æ¯ä¸ªæºä»£ç è¡¨è¾¾å¼çš„æ‰§è¡Œæ¬¡æ•°ã€‚ è¯¥ä¿¡æ¯å¯ä»¥HTMLæ ¼å¼æ˜¾ç¤ºæˆ–æ‰“åŒ…åœ¨åˆ—è¡¨ä¸­ï¼Œä»¥è¿›è¡Œä»»æ„ç”¨æˆ·å®šä¹‰çš„å¤„ç†ã€‚ ä¹Ÿå¯ä»¥å°†å…¶è½¬å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†åŠ è½½åˆ°ç¼–è¯‘å™¨çš„æ¦‚è¦åˆ†æä¿¡æ¯æ•°æ®åº“ä¸­ï¼Œä»¥ç”¨äºæºä»£ç çº§ä¼˜åŒ–ã€‚\næºä»£ç æ¦‚è¦åˆ†æè‡³å°‘åŒ…å«ä¸‹é¢ä¸€äº›æ­¥éª¤ï¼š\nç¼–è¯‘ä»£ç ä¸”å¼€å¯source profiling è¿è¡Œç¼–è¯‘åçš„ä»£ç ç”Ÿæˆæºä»£ç æ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä¸” è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·æºæˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨æºæ¦‚è¦åˆ†æã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ï¼š\nprofile-dump-html ä»¥HTMLæ ¼å¼æ˜¾ç¤ºï¼Œä»¥ä¾¿ç¨‹åºå‘˜å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ä½¿ç”¨å½©è‰²ç¼–ç ç³»ç»Ÿæ‰§è¡Œæ¯ä¸ªè¡¨è¾¾å¼çš„é¢‘ç‡ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥è½»æ¾å‘ç°â€œçƒ­ç‚¹â€ profile-dump-list ä»¥é€‚åˆç”¨æˆ·å®šä¹‰çš„åå¤„ç†çš„å½¢å¼; profile-dump ä»¥é€‚åˆäºé€šè¿‡ä¸Šè¿°æ–¹æ³•ä¹‹ä¸€æˆ–æŸäº›è‡ªå®šä¹‰æ–¹å¼è¿›è¡Œç¦»çº¿å¤„ç†çš„å½¢å¼ï¼Œæˆ– profile-dump-data ä»¥é€‚åˆåŠ è½½åˆ°ç¼–è¯‘å™¨æ•°æ®åº“ä¸­çš„å½¢å¼ã€‚\nç”±profile-dump-dataè½¬å‚¨çš„æ¦‚è¦åˆ†æä¿¡æ¯é€šè¿‡profile-load-dataåŠ è½½åˆ°ç¼–è¯‘å™¨çš„profilingæ•°æ®åº“ä¸­ã€‚ é™¤éé€šè¿‡profile-dump-dataæ˜¾å¼è½¬å‚¨å¹¶é€šè¿‡profile-load-dataåŠ è½½ï¼Œå¦åˆ™åˆ†æä¿¡æ¯å¯¹ç¼–è¯‘å™¨ä¸å¯ç”¨ã€‚\nå½“ä½¿ç”¨å—æ¦‚è¦æ–‡ä»¶ä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œæ­¥éª¤æ˜¯ç›¸ä¼¼çš„ï¼š\nç¼–è¯‘ä»£ç å¹¶å¼€å¯block profiling è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ åŠ è½½æ¦‚è¦ä¿¡æ¯ï¼Œä¸” é‡æ–°ç¼–è¯‘ä»£ç  é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·å—æˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨å—åˆ†æã€‚ æ¦‚è¦æ–‡ä»¶ä¿¡æ¯å¿…é¡»é€šè¿‡profile-dump-dataè½¬å‚¨ï¼Œå¹¶é€šè¿‡profile-load-dataåŠ è½½ã€‚ ä¸æºé…ç½®æ–‡ä»¶ä¿¡æ¯ä¸€æ ·ï¼Œå—é…ç½®æ–‡ä»¶ä¿¡æ¯å¯ä»¥ä¸è½¬å‚¨ä¿¡æ¯çš„åŠ è½½è¿‡ç¨‹ç›¸åŒæˆ–ä¸åŒã€‚\nå¯¹äºå—ä¼˜åŒ–ï¼Œè¦é‡æ–°ç¼–è¯‘çš„ä»£ç å¿…é¡»ç›¸åŒã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€æ‰€æ¶‰åŠçš„æ–‡ä»¶å¿…é¡»æœªç»ä¿®æ”¹ï¼Œå¹¶ä¸”å…¶ä»–ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šé—´æ¥å½±å“ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ã€‚\nå‡ºäºåŒæ ·çš„åŸå› ï¼Œå½“è¦åŒæ—¶ä½¿ç”¨æºæ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œå¿…é¡»å…ˆæ”¶é›†å¹¶åŠ è½½æºä¿¡æ¯ï¼Œç„¶åå†è¿è¡Œæ¶‰åŠå—æ¦‚è¦åˆ†æçš„ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ç¼–è¯‘ã€‚ å³ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š\n1. ç¼–è¯‘ä»£ç å¹¶èµ·å¼€æºä»£ç æ¦‚è¦åˆ†æ 2. è¿è¡Œä»£ç ç”Ÿæˆsource-profilingä¿¡æ¯ 2. è½¬å‚¨source-profiling 3. åŠ è½½source-profiling 3. é‡æ–°ç¼–è¯‘ä»£ç ï¼Œå¹¶å¼€å¯å—æ¦‚è¦åˆ†æ 4. è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ 4. è½¬å‚¨block-profiling 5. åŠ è½½source-å’Œblock-profiling 5. é‡æ–°ç¼–è¯‘ä»£ç  æ ‡è®°æ¯ä¸ªæ­¥éª¤çš„æ•°å­—æ—¢æŒ‡ç¤ºæ­¥éª¤çš„é¡ºåºï¼ŒåˆæŒ‡ç¤ºå¿…é¡»åœ¨åŒä¸€è®¡åˆ’è¿‡ç¨‹ä¸­æ‰§è¡Œçš„é¡ºåºã€‚ ï¼ˆå¦‚æœéœ€è¦ï¼Œæ‰€æœ‰æ­¥éª¤éƒ½å¯ä»¥åœ¨åŒä¸€Schemeæµç¨‹ä¸­æ‰§è¡Œã€‚ï¼‰ å½“compile-profileè®¾ç½®ä¸ºé»˜è®¤å€¼#fæ—¶ï¼Œå°†ç¦ç”¨æºå’Œå—åˆ†æã€‚\nå‡è®¾æ–‡ä»¶/tmp/fatfib/fatfib.ssåŒ…å«ä»¥ä¸‹ä»£ç ï¼š\n(define fat+ (lambda (x y) (if (zero? y) x (fat+ (1+ x) (1- y))))) (define fatfib (lambda (x) (if (\u0026lt; x 2) 1 (fat+ (fatfib (1- x)) (fatfib (1- (1- x))))))) æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·åŠ è½½fatfib.sså¹¶ä¸”å¼€å¯æ¦‚è¦åˆ†æï¼š\n(parameterize ([compile-profile \u0026#39;source]) (load \u0026#34;/tmp/fatfib/fatfib.ss\u0026#34;)) ç„¶åè¿è¡Œä»£ç ï¼š\n(fatfib 20) â‡’ 10946 è¿è¡Œï¼ˆæˆ–å¤šæ¬¡è¿è¡Œï¼‰ä¹‹åï¼Œè½¬å‚¨æ¦‚è¦æ–‡ä»¶ä¸ºä¸€äº›htmlæ–‡ä»¶é›†åˆï¼š ä½¿ç”¨profile-dump-html\n(profile-dump-html) è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºprofile.htmlçš„æ–‡ä»¶\nåœ¨å›¾ä¸­ï¼Œæ‰§è¡Œæœ€é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘çº¢è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºï¼Œè€Œæ‰§è¡Œæœ€ä¸é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘ç´«è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºã€‚\ncompile-profile\nå½“å°†æ­¤å‚æ•°è®¾ç½®ä¸ºç¬¦å·sourceæˆ–å¸ƒå°”å€¼**#tæ—¶ï¼Œç¼–è¯‘å™¨å°†ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¿™äº›æŒ‡ä»¤å¯¹æºä»£ç çš„æ¯ä¸ªéƒ¨åˆ†æ‰§è¡Œçš„æ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸ºç¬¦å·blockæ—¶ï¼Œç¼–è¯‘å™¨ç±»ä¼¼åœ°ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¯¥æŒ‡ä»¤å¯¹æ¯ä¸ªä»£ç å—çš„æ‰§è¡Œæ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸º#f**ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ’å…¥è¿™äº›æŒ‡ä»¤ã€‚\nå½“compile-profileä¸ºéfalseæ—¶ç”Ÿæˆçš„ä»£ç è¾ƒå¤§ä¸”æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤ä»…åœ¨éœ€è¦æ¦‚è¦åˆ†æä¿¡æ¯æ—¶æ‰åº”è®¾ç½®æ­¤å‚æ•°ã€‚å¯ç”¨æ¦‚è¦åˆ†ææ£€æµ‹åç¼–è¯‘çš„ä»£ç çš„æ¦‚è¦æ–‡ä»¶è®¡æ•°å™¨å°†æ— é™æœŸä¿ç•™ï¼Œå³ä½¿ä¸å®ƒä»¬å…³è”çš„ä»£ç å·²è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ è¿™æ ·å¯ä»¥å¾—åˆ°æ›´å®Œæ•´å’Œå‡†ç¡®çš„æ¦‚è¦åˆ†ææ•°æ®ï¼Œä½†ä¼šå¯¼è‡´åŠ¨æ€ç”Ÿæˆæˆ–åŠ è½½ä»£ç çš„ç¨‹åºå‡ºç°ç©ºé—´æ³„æ¼ï¼Œç¨‹åºå¯ä»¥é€šè¿‡profile-release-countersè¿‡ç¨‹æ˜¾å¼åœ°é‡Šæ”¾è®¡æ•°å™¨ï¼Œä»è€Œé¿å…æ½œåœ¨çš„ç©ºé—´æ³„æ¼ã€‚\n(profile-clear)\nè°ƒç”¨æ­¤è¿‡ç¨‹ä¼šæ¸…ç©ºæ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä»£ç æ¯ä¸ªéƒ¨åˆ†å…³è”çš„è®¡æ•°éƒ½è¢«ç½®ä¸º0\n(profile-release-counters)\nè°ƒç”¨æ­¤è¿‡ç¨‹å°†ä¸¢å¼ƒæ¦‚è¦åˆ†æ\n(profile-dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆè‡ªå¯åŠ¨æˆ–ä¸Šæ¬¡è°ƒç”¨profile-clearä»¥æ¥æ”¶é›†çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ä¿¡æ¯çš„è½¬å‚¨ã€‚ å®ƒè¿”å›ä¸€ä¸ªpairçš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªpairçš„caræ˜¯ä¸€ä¸ªsource-objectï¼Œè€Œcdræ˜¯ä¸€ä¸ªç²¾ç¡®çš„éè´Ÿæ•´æ•°è®¡æ•°ã€‚\nprofile-dumpä¼˜äºprofile-dump-listçš„ä¼˜ç‚¹åœ¨äºï¼Œprofile-dumpä»…æ‰§è¡Œæœ€å°‘çš„å¤„ç†ï¼Œå¹¶ä¿ç•™å®Œæ•´çš„æºå¯¹è±¡ï¼ŒåŒ…æ‹¬å…¶åµŒå…¥å¼æºæ–‡ä»¶æè¿°ç¬¦ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºå°†æ¦‚è¦åˆ†æä¿¡æ¯è½¬å‚¨åˆ°ä¸€å°è®¡ç®—æœºä¸Šçš„faslæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šè¿›è¡Œåç»­å¤„ç†ã€‚\n(profile-dump-html) | (profile-dump-html prefix) | (profile-dump-html prefix dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªHTMLæ–‡ä»¶ï¼ŒåŒ…æ‹¬profile.htmlï¼ˆå…¶ä¸­åŒ…å«ç”¨é¢œè‰²ç¼–ç çš„æ‘˜è¦ä¿¡æ¯ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ–‡ä»¶source.htmlï¼Œå…¶ä¸­æ¯ä¸ªæºæ–‡ä»¶æºéƒ½åŒ…å«ç”¨æºä»£ç è¿›è¡Œé¢œè‰²ç¼–ç çš„å‰¯æœ¬ï¼Œå¦‚å‰å¯¼ä¸­æ‰€è¿°ï¼š åœ¨æœ¬èŠ‚ä¸­ã€‚ å¦‚æœæŒ‡å®šäº†prefix ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆçš„HTMLæ–‡ä»¶çš„åç§°ä¹‹å‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå‰ç¼€ä¸º**â€œ /tmp/â€ï¼Œåˆ™ç”Ÿæˆçš„æ–‡ä»¶å°†æ”¾ç½®åœ¨ç›®å½•/tmpä¸­ã€‚ åŸå§‹æ¦‚è¦åˆ†æä¿¡æ¯æ˜¯ä»è½¬å‚¨è·å–çš„ï¼Œé»˜è®¤ä¸ºprofile-dump**è¿”å›çš„å€¼\n(profile-palette)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯è‡³å°‘ä¸‰å¯¹çš„éç©ºå‘é‡ã€‚ æ¯ä¸ªpairçš„caræ˜¯èƒŒæ™¯è‰²ï¼Œè€Œcdræ˜¯å‰æ™¯ï¼ˆæ–‡æœ¬ï¼‰è‰²ã€‚ æ¯ç§é¢œè‰²éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ¯ä¸ªå­—ç¬¦ä¸²éƒ½åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ ç¬¬ä¸€ç»„ç”¨äºæœªé…ç½®çš„ä»£ç ï¼Œç¬¬äºŒå¯¹ç”¨äºæœªæ‰§è¡Œçš„é…ç½®çš„ä»£ç ã€‚ ç¬¬ä¸‰ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€ä½çš„ä»£ç ï¼Œç¬¬å››ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡å€’æ•°ç¬¬äºŒä½çš„ä»£ç ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„ä»£ç ã€‚ ç¨‹åºå‘˜å¯èƒ½å¸Œæœ›æä¾›è‡ªå·±çš„è°ƒè‰²æ¿ä»¥å¢å¼ºå¯è§æ€§æˆ–æ›´æ”¹æ‰€ç”¨é¢œè‰²çš„æ•°é‡ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œé»‘è‰²èƒŒæ™¯ç”¨äºæœªé…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œç°è‰²èƒŒæ™¯ç”¨äºæœªæ‰§è¡Œçš„é…ç½®æ–‡ä»¶çš„ä»£ç ã€‚ æ ¹æ®æ‰§è¡Œé¢‘ç‡ï¼Œç´«è‰²åˆ°çº¢è‰²çš„èƒŒæ™¯é¢œè‰²ç”¨äºæ‰§è¡Œçš„æ¦‚è¦åˆ†æä»£ç ï¼Œè€Œæœ€é¢‘ç¹æ‰§è¡Œçš„ä»£ç ä½¿ç”¨çº¢è‰²ã€‚\n(profile-palette) â‡’ #((\u0026#34;#111111\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#607D8B\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#9C27B0\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#673AB7\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#3F51B5\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#2196F3\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00BCD4\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#4CAF50\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#CDDC39\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFEB3B\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFC107\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF9800\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#F44336\u0026#34; . \u0026#34;white\u0026#34;)) (profile-palette ; set palette with rainbow colors and black text ; for all but unprofiled or unexecuted code \u0026#39;#((\u0026#34;#000000\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#666666\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#8B00FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#6600FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#0000FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00FF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFFF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF7F00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF0000\u0026#34; . \u0026#34;black\u0026#34;))) ; red (profile-line-number-color)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–#fã€‚ å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™profile-dump-htmlä½¿ç”¨æŒ‡å®šçš„é¢œè‰²åœ¨æ¯ä¸ªæºæ–‡ä»¶çš„htmlå‘ˆç°ä¸­åŒ…æ‹¬è¡Œå·ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸º#fï¼Œåˆ™ä¸åŒ…å«è¡Œå·ã€‚\nä¸ªæ€§åŒ–ï¼ˆWaiter Customizationï¼‰ (new-cafe) | (new-cafe eval-proc)\nChez Schemeé€šè¿‡waiter æˆ–read-eval-printå¾ªç¯ï¼ˆREPLï¼‰ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚ waiteråœ¨ç§°ä¸ºcafÌeçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå°†ç”¨æˆ·ç½®äºcafÌeä¸­å¹¶åˆ†é…waiter ã€‚ new-cafeåœ¨æ—§çš„cafÌeä¹‹ä¸Šå¼€å¯äº†ä¸€ä¸ªæ–°çš„Scheme cafÌeã€‚ é™¤äº†å¯åŠ¨waiter ä¹‹å¤–ï¼Œnew-cafeè¿˜è®¾ç½®äº†cafÌeçš„é‡ç½®å’Œé€€å‡ºå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…reset-handlerå’Œexit-handlerï¼‰ã€‚ é€€å‡ºcafÌeä¼šè¿”å›åˆ°åˆ›å»ºè¯¥cafÌeçš„cafÌeã€‚ä»æœ€åˆçš„cafÌeé€€å‡ºåä¼šå®Œå…¨é€€å‡ºäº†Schemeã€‚ cafÌeå¯ä»¥é€šè¿‡æ˜¾å¼è°ƒç”¨exitæˆ–é€šè¿‡æ¥æ”¶end-of-fileï¼ˆUnixç³»ç»Ÿä¸Šä¸ºâ€œ control-Dâ€ï¼‰æ¥é€€å‡ºã€‚åœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™exitçš„ä»»ä½•å€¼éƒ½æ˜¯ä»new-cafeè¿”å›çš„ã€‚\n\u0026gt; (define x 1) \u0026gt; x 1 \u0026gt; (new-cafe) \u0026gt;\u0026gt; x 1 \u0026gt;\u0026gt; (define y 2) \u0026gt;\u0026gt; y 2 \u0026gt;\u0026gt; (exit 1) 1 å¦‚æœæŒ‡å®šäº†å¯é€‰çš„eval-proc å‚æ•°ï¼Œåˆ™ä½¿ç”¨eval-proc æ±‚å€¼ä»æ§åˆ¶å°è¾“å…¥çš„ç¨‹åºã€‚ å¦åˆ™ï¼Œå°†ä½¿ç”¨å‚æ•°current-eval çš„å€¼ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\n\u0026gt; (new-cafe (lambda (x) x)) \u0026gt;\u0026gt; 3 3 \u0026gt;\u0026gt; (a . (b . (c . ()))) (a b c) \u0026gt; (define sum (lambda (ls) (if (null? ls) 0 (+ (car ls) (sum (cdr ls)))))) \u0026gt; (new-cafe sum) \u0026gt;\u0026gt; (1 2 3) 6 æ—¶é—´å’Œæ—¥æœŸ æ—¶é—´ç”±æ—¶é—´å¯¹è±¡è¡¨ç¤ºã€‚ æ—¶é—´å¯¹è±¡è®°å½•ç‰¹å®šæ—¶é—´æˆ–æŒç»­æ—¶é—´çš„çº³ç§’å’Œç§’ï¼Œä»¥åŠæ ‡è¯†æ—¶é—´å¯¹è±¡æ€§è´¨çš„time type ã€‚ æ—¶é—´ç±»å‹æ˜¯ä»¥ä¸‹ç¬¦å·ä¹‹ä¸€ï¼š time-utc: ä»â€œçºªå…ƒâ€1970å¹´1æœˆ1æ—¥0ç‚¹0åˆ†0ç§’ä»¥æ¥çš„æ—¶é—´ time-monotonic: ä»è¿‡å»æŸä¸ªä»»æ„æ—¶é—´ç‚¹å¼€å§‹ç»è¿‡çš„æ—¶é—´ï¼Œç†æƒ³æƒ…å†µä¸‹æ— éœ€è¿›è¡Œè°ƒæ•´ã€‚ time-duration: ä¸¤ä¸ªæ—¶é—´çš„é—´éš”ã€‚å½“ä½œä¸ºcurrent-timeçš„å‚æ•°æ—¶ï¼Œå…¶è¡Œä¸ºä¸time-monotonicç±»ä¼¼ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ—¶é—´å¯¹è±¡ç›¸å‡çš„ç»“æœ time-process: å½“å‰è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ time-thread: å½“å‰çº¿ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ å¦‚æœæœªè¿è¡Œçº¿ç¨‹ï¼Œæˆ–è€…ç³»ç»Ÿä¸å…è®¸ç¡®å®šå•ä¸ªçº¿ç¨‹æ—¶é—´ï¼Œåˆ™è¯¥æ—¶é—´ä¸time-processç›¸åŒã€‚ time-collector-cpu: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†CPUæ¶ˆè€—çš„æ—¶é—´ã€‚ time-collector-real: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†å®æ—¶æ¶ˆè€—çš„æ—¶é—´\næ—¥æœŸç”±æ—¥æœŸå¯¹è±¡è¡¨ç¤ºã€‚ æ—¥æœŸå¯¹è±¡è®°å½•ç‰¹å®šæ—¥æœŸçš„çº³ç§’ï¼Œç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œæ—¥ï¼Œæœˆå’Œå¹´ï¼Œä»¥åŠæ ‡è¯†æ—¶åŒºçš„åç§»é‡ã€‚\n(current-time) | (current-time time-type)\ntime-type å¿…é¡»æ˜¯ä¸Šè¿°çš„æ—¶é—´å¯¹è±¡ä¹‹ä¸€ï¼Œé»˜è®¤ä¸ºtime-utc\n(current-time) â‡’ #\u0026lt;time-utc 1198815722.473668000\u0026gt; (current-time â€™time-process) â‡’ #\u0026lt;time-process 0.120534264\u0026gt; (make-time type nsec sec)\ntype å¿…é¡»æ˜¯ä¸Šé¢åˆ—å‡ºçš„æ—¶é—´ç±»å‹ç¬¦å·ä¹‹ä¸€ã€‚ nsec è¡¨ç¤ºçº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚sec è¡¨ç¤ºç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç²¾ç¡®çš„æ•´æ•°ã€‚\n(make-time \u0026#39;time-utc 787511000 1198783214) (make-time \u0026#39;time-duration 10 5) (make-time \u0026#39;time-duration 10 -5) (time? obj)\n(time? (current-time)) â‡’ #t (time? (make-time â€™time-utc 0 0)) â‡’ #t (time? \u0026#34;1400 hours\u0026#34;) â‡’ #f (time-type time)\nè¿”å›time çš„æ—¶é—´ç±»å‹\n(time-nanosecond time)\nè¿”å›time çš„çº³ç§’\n(time-second time)\nè¿”å›time çš„ç§’\n(set-time-type! time type) | (set-time-nanosecond! time nsec) | (set-time-second! time sec)\næ¯ä¸€ä¸ªè¿‡ç¨‹éƒ½ä¼šä¿®æ”¹æ—¶é—´å¯¹è±¡ï¼Œåªæ”¹å˜å±€éƒ¨ï¼Œè€Œå…¶ä»–å€¼åˆ™ä¸å—å½±å“ã€‚ ä¾‹å¦‚ï¼Œset-time-nanosecond! åªæ›´æ”¹çº³ç§’æ—¶é—´ï¼Œè€Œä¸æ›´æ”¹ç§’æˆ–ç±»å‹ã€‚ ç‰¹åˆ«åœ°ï¼Œå½“æ—¶é—´å¯¹è±¡çš„ç±»å‹æ”¹å˜æ—¶ï¼Œå€¼å¹¶ä¸ä¼šæ›´æ”¹ã€‚\n(time=? time1 time2) | (time\u0026lt;? time1 time2) | (time\u0026gt;? time1 time2) | (time\u0026lt;=? time1 time2) | (time\u0026gt;=? time1 time2)\næ—¶é—´æ¯”è¾ƒã€‚\n(copy-time time)\nå¤åˆ¶æ—¶é—´ã€‚\n(define t1 (current-time)) (define t2 (copy-time t1)) (eq? t2 t1) â‡’ #f (eqv? (time-second t2) (time-second t1)) â‡’ #t (eqv? (time-nanosecond t2) (time-nanosecond t1)) â‡’ #t (time-difference time1 time2 ) | (time-difference! time1 time2 ) | (add-duration time timed) | (add-duration! time timed) | (subtract-duration time timed) | (subtract-duration! time timed)\nå¯¹äºtime-differenceï¼Œtime1å’Œtime2å¿…é¡»å…·æœ‰ç›¸åŒçš„æ—¶é—´ç±»å‹ï¼Œç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ å¯¹äºadd-durationï¼Œadd-durationï¼ï¼Œsubtract-durationå’Œsubtract-durationï¼ï¼Œtimedå¿…é¡»å…·æœ‰æ—¶é—´ç±»å‹time-durationï¼Œå¹¶ä¸”ç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸æ—¶é—´ç›¸åŒçš„æ—¶é—´å¯¹è±¡ã€‚ time-differenceï¼ï¼Œadd-durationï¼å’Œsubtract-durationï¼ å¯èƒ½å…·æœ‰ç ´åæ€§ï¼Œå³æ¯ä¸ªå¯¹è±¡éƒ½å¯èƒ½ä¿®æ”¹å¹¶è¿”å›å…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ–è€…å¯èƒ½åˆ†é…äº†æ–°çš„æ—¶é—´å¯¹è±¡\n(let ([delay (make-time \u0026#39;time-duration 0 1)]) (let ([t1 (current-time \u0026#39;time-monotonic)]) (sleep delay) (let ([t2 (current-time \u0026#39;time-monotonic)]) (let ([t3 (time-difference t2 t1)]) (and (eq? (time-type t3) \u0026#39;time-duration) (time\u0026gt;=? t3 delay) (time=? (add-duration t1 t3) t2) (time=? (subtract-duration t2 t3) t1)))))) â‡’ #t (current-date) | (current-date offset)\nå¦‚ä¸Šæ‰€è¿°ï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»é‡ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥è·å¾—UTC.offsetè¡¨ç¤ºUTCä»¥ä¸œä»¥ç§’ä¸ºå•ä½çš„æ—¶åŒºåç§»é‡ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\nå¦‚æœæœªæä¾›offset ï¼Œåˆ™ä½¿ç”¨å½“å‰æ—¶åŒºçš„offsetï¼Œä»¥åŠdate-dstï¼Ÿ å’Œdate-zone-nameæŠ¥å‘Šæœ‰å…³æ—¶åŒºçš„ä¿¡æ¯ã€‚ å¦‚æœæä¾›äº†åç§»é‡ï¼Œé‚£ä¹ˆdate-dstï¼Ÿ å’Œç»“æœæ—¥æœŸå¯¹è±¡ä¸Šçš„date-zone-nameéƒ½æ˜¯**#f**ã€‚\n(current-date) â‡’ #\u0026lt;date Thu Dec 27 23:23:20 2007\u0026gt; (current-date 0) â‡’ #\u0026lt;date Fri Dec 28 04:23:20 2007\u0026gt; (date-zone-name (current-date)) â‡’ \u0026#34;EST\u0026#34; or other system-provided string (date-zone-name (current-date 0)) â‡’ #f (make-date nsec sec min hour day mon year) | (make-date nsec sec min hour day mon year offset)\nnsecä»£è¡¨çº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚secä»£è¡¨ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº62çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚minä»£è¡¨åˆ†é’Ÿï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº60çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚hourå¿…é¡»æ˜¯ç²¾ç¡®çš„éè´Ÿæ•´æ•° å°äº24ã€‚dayå¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤dayâ‰¤31ã€‚ï¼ˆå®é™…ä¸Šé™å¯èƒ½å–å†³äºæœˆä»½å’Œå¹´ä»½ã€‚ï¼‰monè¡¨ç¤ºæœˆä»½å¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤monâ‰¤12ã€‚å¹´å¿…é¡» æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå®ƒåº”è‡³å°‘ä¸º1970ã€‚offsetè¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯-86400åˆ°+86400ï¼ˆå«ï¼‰èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥æŒ‡å®šUTCã€‚\n(make-date 0 0 0 0 1 1 1970 0) â‡’ #\u0026lt;date Thu Jan 1 00:00:00 1970\u0026gt; (make-date 0 30 7 9 23 9 2007 -14400) â‡’ #\u0026lt;date Sun Sep 23 09:07:30 2007\u0026gt; (date-zone-name (make-date 0 30 7 9 23 9 2007 -14400)) â‡’ #f (string? (date-zone-name (make-date 0 30 7 9 23 9 2007))) â‡’ #t (date-nanosecond date) | (date-second date) | (date-minute date) | (date-hour date) | (date-day date) | (date-month date) | (date-year date) | (date-zone-offset date)\nå¦‚å­—é¢çš„æ„æ€ï¼Œ è¿”å›æ—¥æœŸçš„å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(date-week-day date) | (date-year-day date)\né€šè¿‡è¿™äº›è¿‡ç¨‹ï¼Œå¯ä»¥ç¡®å®šä»¥date è¡¨ç¤ºçš„æ—¥æœŸæ˜¯æ˜ŸæœŸå‡ è¿˜æ˜¯æ¯å¹´çš„æŸå¤©ã€‚ week-dayæ˜¯å°äº7çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0è¡¨ç¤ºæ˜ŸæœŸæ—¥ï¼Œ1è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œä¾æ­¤ç±»æ¨ã€‚ year-dayæ˜¯å°äº367çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0ä»£è¡¨ä¸€å¹´çš„ç¬¬ä¸€å¤©ï¼ˆ1æœˆ1æ—¥ï¼‰ï¼Œ1ä»£è¡¨ç¬¬äºŒå¤©ï¼Œ2ä»£è¡¨ç¬¬ä¸‰å¤©ï¼Œä¾æ­¤ç±»æ¨ã€‚\n(time-utc-\u0026gt;date time) | (time-utc-\u0026gt;date time offset) | (date-\u0026gt;time-utc date)\nè¿™äº›è¿‡ç¨‹ç”¨äºåœ¨æ—¶é—´å’Œæ—¥æœŸå¯¹è±¡ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ time-utc-\u0026gt;dateçš„æ—¶é—´å‚æ•°å¿…é¡»å…·æœ‰time-type utcï¼Œdate-\u0026gt;time-utcå§‹ç»ˆè¿”å›å¸¦æœ‰time-type utcçš„æ—¶é—´å¯¹è±¡ã€‚\nå¯¹äºtime-utc-\u0026gt;dateï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„ç§’æ•°ä¸­çš„æ—¶åŒºåç§»ï¼Œå¦‚æœ¬èŠ‚å¼€å¤´æ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\n(date-and-time) | (date-and-time date)\nå­—ç¬¦ä¸²å§‹ç»ˆé‡‡ç”¨ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºçš„æ ¼å¼ï¼Œé•¿åº¦å§‹ç»ˆä¸º24ã€‚\n(date-and-time) â‡’ \u0026#34;Fri Jul 13 13:13:13 2001\u0026#34; (defined (make-date 0 0 0 0 1 1 2007 0)) (date-and-time d) â‡’ \u0026#34;Mon Jan 01 00:00:00 2007\u0026#34; (sleep time)\ntime å¿…é¡»æ˜¯ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ sleep å¯¼è‡´è°ƒç”¨çº¿ç¨‹åœ¨å¤§çº¦ç”±æ—¶é—´å¯¹è±¡æŒ‡ç¤ºçš„æ—¶é—´é‡å†…æš‚åœæ“ä½œï¼Œé™¤éè¯¥è¿›ç¨‹æ”¶åˆ°ä¸­æ–­ç¡çœ æ“ä½œçš„ä¿¡å·ã€‚ å®é™…ç¡çœ æ—¶é—´å–å†³äºç³»ç»Ÿæ—¶é’Ÿçš„ç²’åº¦ä»¥åŠç³»ç»Ÿè¿è¡Œå…¶ä»–çº¿ç¨‹å’Œè¿›ç¨‹çš„ç¹å¿™ç¨‹åº¦ã€‚\næ—¶é—´å’Œç»Ÿè®¡ (time expr) timeæ±‚å€¼expr ï¼Œå¹¶ä¸”ä½œä¸ºå‰¯ä½œç”¨ï¼Œæ‰“å°ï¼ˆåˆ°console-outputç«¯å£ï¼‰cpuæ—¶é—´é‡ï¼Œå®æ—¶æ—¶é—´é‡ï¼Œåˆ†é…çš„å­—èŠ‚æ•°ä»¥åŠä¸æ±‚å€¼expr ç›¸å…³çš„æ”¶é›†å¼€é”€ã€‚\n\u0026gt; (time (collect)) (time (collect)) 1 collection 1 ms elapsed cpu time, including 1 ms collecting 1 ms elapsed real time, including 1 ms collecting 160 bytes allocated, including 8184 bytes reclaimed (cpu-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥æ¶ˆè€—çš„cpuæ—¶é—´é‡ã€‚\nè¯¥é‡ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ è¯¥æ•°é‡åŒ…æ‹¬â€œsystemâ€æ—¶é—´å’Œâ€œuserâ€æ—¶é—´ï¼Œå³ä»£è¡¨è¿›ç¨‹åœ¨å†…æ ¸ä¸­èŠ±è´¹çš„æ—¶é—´ä»¥åŠåœ¨è¿›ç¨‹æœ¬èº«ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚\n(real-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥ç»è¿‡çš„å®æ—¶æ—¶é—´\nä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´æ€»é‡\n(bytes-allocated) | (bytes-allocated g)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ•°\nå¦‚æœæä¾›äº†g ï¼Œåˆ™bytes-allocatedè¿”å›æŒ‡å®šgenerationä¸­å½“å‰ä¸ºSchemeå¯¹è±¡åˆ†é…çš„å­—èŠ‚æ•°ã€‚ g å¿…é¡»ä¸ºéè´Ÿç²¾ç¡®æ•´æ•°ï¼Œä¸”ä¸å¾—å¤§äºæœ€å¤§éé™æ€generationï¼Œå³ï¼Œcollect-maximum-generationè¿”å›çš„å€¼æˆ–ç¬¦å·ä¸ºstaticã€‚ å¦‚æœæœªæä¾›g ï¼Œåˆ™bytes-allocatedè¿”å›æ‰€æœ‰generationä¸­åˆ†é…çš„å­—èŠ‚æ€»æ•°ã€‚\n(initial-bytes-allocated)\nè¿”å›ï¼šåŠ è½½å¯åŠ¨æ–‡ä»¶ååˆ†é…çš„æ€»å­—èŠ‚æ•°\n(bytes-deallocated)\nè¿”å›ï¼šåƒåœ¾å›æ”¶å™¨é‡Šæ”¾çš„æ€»å­—èŠ‚æ•°\né€šè¿‡å°†ï¼ˆbytes-deallocatedï¼‰å’Œï¼ˆbytes-allocatedï¼‰ç›¸åŠ å¹¶å‡å»ï¼ˆinitial-bytes-allocatedï¼‰ï¼Œå¯ä»¥è·å¾—å½“å‰è¿›ç¨‹åˆ†é…çš„æ€»å­—èŠ‚æ•°ï¼ˆæ— è®ºæ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ï¼‰ã€‚\n(current-memory-bytes)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ€»æ•°ï¼ŒåŒ…æ‹¬å¼€é”€.\ncurrent-memory-bytesè¿”å›å †çš„æ€»å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä¸ä»…åŒ…æ‹¬Schemeå¯¹è±¡å ç”¨çš„å­—èŠ‚ï¼Œè¿˜åŒ…æ‹¬å„ç§å½¢å¼çš„å¼€é”€ï¼ˆåŒ…æ‹¬ç¢ç‰‡å’Œä¿ç•™ä½†å½“å‰ä¸å ç”¨çš„å†…å­˜ï¼‰ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿä¸­å½“å‰è¿›ç¨‹çš„å †å†…å­˜é‡çš„å‡†ç¡®åº¦é‡å€¼\n(maximum-memory-bytes)\nè¿”å›ï¼šåˆ†é…è¿‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å¼€é”€\n(reset-maximum-memory-bytes!)\nå°†å †å†…å­˜çš„æœ€å¤§è®°å½•å€¼é‡ç½®ä¸ºå½“å‰å †å¤§å°\n(collections)\nè¿”å›ï¼šåˆ°ç›®å‰ä¸ºæ­¢çš„åƒåœ¾å›æ”¶æ¬¡æ•°\n(statistics)\nè¿”å›ï¼šåŒ…å«å½“å‰ç»Ÿè®¡ä¿¡æ¯çš„sstatsè®°å½•\nstatisticså°†å„ç§æ—¶é—´å’Œåˆ†é…ç»Ÿè®¡ä¿¡æ¯æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªsstatsè®°å½•ã€‚ sstatsè®°å½•å…·æœ‰ä»¥ä¸‹å­—æ®µï¼š\ncpu, æ¶ˆè€—çš„cpuæ—¶é—´ real, ç»è¿‡çš„æ—¶é—´ bytes, åˆ†é…çš„å­—èŠ‚æ•° gc-count, gcæ¬¡æ•° gc-real, gcç»å†çš„æ—¶é—´ gc-bytes, gcå›æ”¶çš„å­—èŠ‚æ•° æ‰€æœ‰å€¼éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç®—\nstatisticså¯ä»¥åƒå¦‚ä¸‹å®šä¹‰ï¼š\n(define statistics (lambda () (make-sstats (current-time â€™time-thread) (current-time â€™time-monotonic) (- (+ (bytes-allocated) (bytes-deallocated)) (initial-bytes-allocated)) (collections) (current-time â€™time-collector-cpu) (current-time â€™time-collector-real) (bytes-deallocated)))) (make-sstats cpu real bytes gc-count gc-cpu gc-real gc-bytes) è¿”å›ï¼šsstatsè®°å½•\n(sstats-cpu s) | (sstats-real s) | (sstats-bytes s) | (sstats-gc-count s) | (sstats-gc-cpu s) | (sstats-gc-real s) | (sstats-gc-bytes s)\nè¿”å›ï¼šs å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(set-sstats-cpu! s new-value) | (set-sstats-real! s new-value) | (set-sstats-bytes! s new-value) | (set-sstats-gc-count! s new-value) | (set-sstats-gc-cpu! s new-value) | (set-sstats-gc-real! s new-value) | (set-sstats-gc-bytes! s new-value)\nè®¾ç½®å¯¹åº”éƒ¨åˆ†çš„å€¼\n(sstats-difference s1 s2)\næ¯”è¾ƒä¸¤ä¸ªsstats\nenable-object-counts\nenable-object-countsçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒç¡®å®šæ”¶é›†å™¨åœ¨è¿è¡Œæ—¶æ˜¯å¦è®°å½•å¯¹è±¡è®¡æ•°ï¼Œä»è€Œç¡®å®šè¿‡ç¨‹å¯¹è±¡è®¡æ•°è¿”å›çš„object-countsæ˜¯å¦å‡†ç¡®ã€‚ ç”±äºå¯ç”¨å¯¹è±¡è®¡æ•°ä¼šå¢åŠ æ”¶é›†çš„å¼€é”€ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹è¯¥å‚æ•°è®¾ç½®ä¸º#fã€‚\n(object-counts)\nè¿‡ç¨‹object-countsxè¿”å›ä¸€ä¸ªåµŒå¥—çš„å…³è”åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨è¡¨ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨å®ä¾‹çš„æ¯ä¸ªå †åˆ†é…çš„åŸå§‹ç±»å‹å’Œè®°å½•ç±»å‹åˆ†é…çš„å¯¹è±¡è®¡æ•°å’Œå­—èŠ‚ã€‚ ï¼ˆå †åˆ†é…çš„åŸºæœ¬ç±»å‹åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œpairå’Œå‘é‡ï¼Œä½†ä¸åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œfixnumæˆ–å­—ç¬¦ã€‚ï¼‰ä»…å½“enable-object-countsxxä¸º#tæ—¶ï¼Œæ”¶é›†å™¨æ‰ä¼šæ”¶é›†å¯¹è±¡è®¡æ•°ã€‚\nobject-countsxè¿”å›çš„å…³è”åˆ—è¡¨å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š ((type (generation count . bytes) \u0026hellip;) \u0026hellip;)\ntypeæ˜¯åŸå§‹ç±»å‹çš„åç§°ï¼Œä»¥ç¬¦å·ï¼ˆä¾‹å¦‚ï¼Œå¯¹ï¼‰è¡¨ç¤ºï¼Œæˆ–è€…æ˜¯record-typeæè¿°ç¬¦ï¼ˆrtdï¼‰ã€‚ generationæ˜¯ä»‹äº0å’Œï¼ˆcollect-maximum-generationï¼‰çš„å€¼ï¼ˆåŒ…å«åœ¨å†…ï¼‰æˆ–è¡¨ç¤ºé™æ€ç”Ÿæˆçš„ç¬¦å·staticä¹‹é—´çš„éè´Ÿå›ºå®šç¼–å·ã€‚ countå’Œå­—èŠ‚æ˜¯éè´Ÿçš„fixnumã€‚\n(collect-request-handler void) (enable-object-counts #t) (define-record-type frob (fields x)) (define x (make-frob (make-frob #f))) (collect 3 3) (cdr (assoc 3 (cdr (assoc (record-type-descriptor frob) (object-counts))))) =\u0026gt; (2. 16) æˆæœ¬ä¸­å¿ƒ Cost Centers æˆæœ¬ä¸­å¿ƒç”¨äºåœ¨æ±‚å€¼é€‰å®šçš„ä»£ç æ®µæ—¶è·Ÿè¸ªåˆ†é…çš„å­—èŠ‚ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤å’Œ/æˆ–ç»è¿‡çš„CPUæ—¶é—´ã€‚ æˆæœ¬ä¸­å¿ƒæ˜¯é€šè¿‡è¿‡ç¨‹make-cost-centeråˆ›å»ºçš„ï¼Œè€Œæˆæœ¬æ˜¯é€šè¿‡with-cost-centerè¿‡ç¨‹è¿›è¡Œè·Ÿè¸ªçš„ã€‚\nä»…ä¸ºæ­¤ç›®çš„ä»£ç è·Ÿè¸ªåˆ†é…å’ŒæŒ‡ä»¤è®¡æ•°ã€‚ è¯¥å·¥å…·ç”±ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼šgenerate-allocation-countså’Œgenerate-instruction-countsã€‚ é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ£€æµ‹ã€‚ å†…ç½®ç¨‹åºæ²¡æœ‰æ£€æµ‹ï¼Œè§£é‡Šä»£ç æˆ–éSchemeä»£ç ä¹Ÿæ²¡æœ‰ã€‚ ä»…å½“è¿‡ç¨‹with-cost-centerçš„å¯é€‰å‚æ•°*timed?*æœ‰å€¼ä¸”ä¸ä¸ºfalseæ—¶æ‰ä¼šè·Ÿè¸ªç»å†çš„æ—¶é—´\nwith-cost-centerè¿‡ç¨‹å³ä½¿åœ¨ä½¿ç”¨åŒä¸€æˆæœ¬ä¸­å¿ƒé‡æ–°è¾“å…¥ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä½¿ç”¨å¹¶é€šè¿‡ç»§ç»­è°ƒç”¨é€€å‡ºæˆ–é‡æ–°è¾“å…¥ä¸€æ¬¡æˆ–å¤šæ¬¡åï¼Œä¹Ÿè¦éµå¾ªä¸Šè¿°æ³¨æ„äº‹é¡¹æ¥å‡†ç¡®è·Ÿè¸ªæˆæœ¬ã€‚\ngenerate-allocation-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªåˆ†é…ç‚¹æ’å…¥ä¸€å°æ®µæŒ‡ä»¤ï¼Œä»¥è·Ÿè¸ªå‘ç”Ÿçš„åˆ†é…é‡ã€‚æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\ngenerate-instruction-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨å°†åœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªå—ä¸­æ’å…¥ç®€çŸ­çš„æŒ‡ä»¤åºåˆ—ï¼Œä»¥è·Ÿè¸ªè¯¥å—æ‰§è¡Œçš„æŒ‡ä»¤æ•°ã€‚ æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\n(make-cost-center)\nè¿”å›: æ–°çš„æˆæœ¬ä¸­å¿ƒ\n(with-cost-center cost-center thunk) | (with-cost-center timed? cost-center thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—é›¶å‚æ•°çš„è¿‡ç¨‹ã€‚ with-cost-centerè°ƒç”¨ä¸å¸¦å‚æ•°çš„thunk å¹¶è¿”å›å…¶å€¼ã€‚ å®ƒè¿˜å¯ä»¥åŠ¨æ€è®¡ç®—åˆ†é…çš„å­—èŠ‚æ•°ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤ä»¥åŠåœ¨è®¡ç®—thunk è°ƒç”¨æ—¶æ‰€ç»è¿‡çš„cpuæ—¶é—´ï¼Œå¹¶å°†è·Ÿè¸ªçš„æˆæœ¬æ·»åŠ åˆ°æˆæœ¬ä¸­å¿ƒè®°å½•ä¸­ã€‚\nå¦‚ä¸Šæ‰€è¿°ï¼Œä»…å¯¹äºå°†å‚æ•°generate-allocation-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªåˆ†é…è®¡æ•°ï¼Œå¹¶ä¸”ä»…å¯¹å°†generate-instruction-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªæŒ‡ä»¤è®¡æ•°ã€‚ ä»…åœ¨æä¾›timed? ä¸”ä¸ä¸ºfalseçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè·Ÿè¸ªcpuæ—¶é—´ï¼Œå…¶ä¸­åŒ…æ‹¬åœ¨å·²æµ‹é‡çš„ä»£ç ï¼Œæœªæµ‹é‡ä»£ç å’ŒéSchemeä»£ç ä¸­èŠ±è´¹çš„cpuæ—¶é—´ã€‚\n(cost-center-instruction-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„æŒ‡ä»¤æ•°\n(cost-center-allocation-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„å·²åˆ†é…å­—èŠ‚æ•°\n(cost-center-time cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„CPUæ—¶é—´\n(reset-cost-center! cost-center)\næ­¤è¿‡ç¨‹å°†æˆæœ¬ä¸­å¿ƒè®°å½•çš„æˆæœ¬é‡ç½®ä¸ºé›¶ã€‚\nå‚æ•° æœ¬èŠ‚ä»‹ç»äº†ç”¨äºåˆ›å»ºå’Œæ“ä½œå‚æ•°çš„æœºåˆ¶ã€‚ å¯ä»¥ä½¿ç”¨make-parameteræ–¹ä¾¿åœ°åˆ›å»ºæ–°å‚æ•°ã€‚ ä½†æ˜¯ï¼Œé™¤äº†å®ƒä»¬çš„è¡Œä¸ºå¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½å°†å‚æ•°ä¸å…¶ä»–è¿‡ç¨‹åŒºåˆ†å¼€ã€‚ å¦‚æœè°ƒç”¨å‚æ•°æ—¶å¿…é¡»é‡‡å–æ¯”é€šè¿‡make-parameteræœºåˆ¶å®¹æ˜“å®¹çº³çš„æ›´ä¸ºå¤æ‚çš„åŠ¨ä½œï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨case-lambdaå®šä¹‰è¯¥å‚æ•°\n(make-parameter object) | (make-parameter object procudure)\nmake-parameteræ¥å—ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å†…éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯åº”ç”¨äºåˆå§‹å€¼å’Œæ‰€æœ‰åç»­å€¼çš„è¿‡æ»¤å™¨ã€‚ è¿‡æ»¤å™¨åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœè¯¥å€¼ä¸åˆé€‚ï¼Œåˆ™è¿‡æ»¤å™¨åº”å¼•å‘å¼‚å¸¸æˆ–å°†å€¼è½¬æ¢ä¸ºæ›´åˆé€‚çš„å½¢å¼ã€‚\nä¾‹å¦‚ï¼Œprint-lengthçš„é»˜è®¤å®šä¹‰å¦‚ä¸‹ï¼š\n(define print-length (make-parameter #f (lambda (x) (unless (or (not x) (and (fixnum? x) (fx\u0026gt;= x 0))) (assertion-violationf â€™print-length \u0026#34;~s is not a positive fixnum or #f\u0026#34; x)) x))) (print-length) â‡’ #f (print-length 3) (print-length) â‡’ 3 (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123...)\u0026#34; (print-length #f) (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123456)\u0026#34; make-parameterçš„å®šä¹‰ä½¿ç”¨case-lambdaå¾ˆç®€å•ï¼š\n(define make-parameter (case-lambda [(init guard) (let ([v (guard init)]) (case-lambda [() v] [(u) (set! v (guard u))]))] [(init) (make-parameter init (lambda (x) x))])) (parameterize ((param expr) \u0026hellip;) body1 body2 \u0026hellip;)\nä½¿ç”¨è¯­æ³•å½¢å¼parameterizeï¼Œå¯ä»¥ä»¥ç±»ä¼¼äºæ™®é€šå˜é‡çš„fluid-letçš„æ–¹å¼æ›´æ”¹å‚æ•°çš„å€¼ã€‚ åœ¨è®¡ç®—bodyæ—¶ï¼Œå°†æ¯ä¸ªparam è®¾ç½®ä¸ºç›¸åº”çš„expr çš„å€¼ã€‚\n(define test (make-parameter 0)) (test) â‡’ 0 (test 1) (test) â‡’ 1 (parameterize ([test 2]) (test)) â‡’ 2 (test) â‡’ 1 (parameterize ([test 2]) (test 3) (test)) â‡’ 3 (test) â‡’ 1 (define k (lambda (x) x)) (begin (set! k (call/cc k)) â€™k) â‡’ k (parameterize ([test 2]) (test (call/cc k)) (test)) â‡’ k (test) â‡’ 1 (k3) â‡’3 (test) â‡’ 1 è™šæ‹Ÿå¯„å­˜å™¨Virtual registers ç¼–è¯‘å™¨æ”¯æŒä¸€ç»„æœ‰é™çš„è™šæ‹Ÿå¯„å­˜å™¨ ï¼Œä»¥ä¾›éœ€è¦é«˜é€Ÿï¼Œå…¨å±€å’Œå¯å˜å­˜å‚¨ä½ç½®çš„ç¨‹åºä½¿ç”¨ã€‚ å¼•ç”¨æˆ–åˆ†é…è™šæ‹Ÿå¯„å­˜å™¨å¯èƒ½æ¯”è®¿é—®å¯åˆ†é…çš„å±€éƒ¨å˜é‡æˆ–å…¨å±€å˜é‡æ›´å¿«ï¼Œå¹¶ä¸”è®¿é—®æ—¶æ°¸è¿œä¸ä¼šæ¯”å®ƒä»¬æ›´æ…¢ï¼Œè€Œä¸”è¿™æ ·åšçš„ä»£ç åºåˆ—é€šå¸¸æ›´å°ã€‚ åˆ†é…å¯èƒ½ä¼šæ˜¾è‘—åŠ å¿«ï¼Œå› ä¸ºä¸éœ€è¦è·Ÿè¸ªä»è™šæ‹Ÿå¯„å­˜å™¨åˆ°å¹´è½»å¯¹è±¡çš„æŒ‡é’ˆï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨äºè¾ƒæ—©ä¸€ä¸–ä»£ä¸­çš„å¯å˜ä½ç½®ã€‚ åœ¨ç³»ç»Ÿçš„çº¿ç¨‹ç‰ˆæœ¬ä¸Šï¼Œè™šæ‹Ÿå¯„å­˜å™¨æ˜¯â€œæ¯ä¸ªçº¿ç¨‹â€çš„ï¼Œå› æ­¤å¯ä»¥ä»¥æ¯”çº¿ç¨‹å‚æ•°ä½å»‰çš„æ–¹å¼ç”¨ä½œthread-localå­˜å‚¨ã€‚\nè¯¥æ¥å£åŒ…å«ä¸‰ä¸ªè¿‡ç¨‹ï¼švirtual-register-countï¼ˆè¿”å›è™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡ï¼‰ï¼Œset-virtual-register!ï¼ˆè®¾ç½®æŒ‡å®šçš„è™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰å’Œvirtual-registerï¼ˆè·å–æŒ‡å®šè™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰ã€‚\nè™šæ‹Ÿå¯„å­˜å™¨ç”±å°äºè™šæ‹Ÿå¯„å­˜å™¨æ•°é‡çš„éè´Ÿfixnumç´¢å¼•æŒ‡å®šã€‚ ä¸ºäº†è·å¾—set-virtual-register!å’Œvirtual-registerçš„æœ€ä½³æ€§èƒ½ï¼Œç´¢å¼•åº”è¯¥æ˜¯ç›´æ¥åµŒå…¥åœ¨è°ƒç”¨ä¸­çš„å¸¸é‡ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡å¯¹è°ƒç”¨çš„ä¼˜åŒ–æ¥ä¼ æ’­ï¼‰ã€‚ ä¸ºäº†é¿å…å°†è¿™äº›å¸¸é‡æ”¾åœ¨æºä»£ç ä¸­ï¼Œç¨‹åºå‘˜åº”è€ƒè™‘ä½¿ç”¨æ ‡è¯†ç¬¦å®ä¸ºè™šæ‹Ÿå¯„å­˜å™¨å‘½åï¼Œä¾‹å¦‚ï¼š\n(define-syntax current-state (identifier-syntax [id (virtual-register 0)] [(set! id e) (set-virtual-register! 0 e)])) (set! current-state \u0026#39;start) current-state â‡’ start è™šæ‹Ÿå¯„å­˜å™¨å¿…é¡»è¢«è§†ä¸ºåº”ç”¨ç¨‹åºçº§èµ„æºï¼Œå³ï¼Œæ‰“ç®—ç”±å¤šä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨çš„åº“é€šå¸¸ä¸åº”ä½¿ç”¨è™šæ‹Ÿå¯„å­˜å™¨ï¼Œä»¥é¿å…ä¸åº”ç”¨ç¨‹åºä½¿ç”¨å¯„å­˜å™¨å†²çªã€‚\n(virtual-register-count)\nä»9.0ç‰ˆå¼€å§‹ï¼Œè™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡è®¾ç½®ä¸º16ã€‚é™¤éé€šè¿‡æºé‡æ–°ç¼–è¯‘Chez Schemeï¼Œå¦åˆ™æ— æ³•æ›´æ”¹ã€‚\n(set-virtual-register! k x)\n**set-virtual-register!**å°†x å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­ã€‚ k å¿…é¡»æ˜¯å°äºï¼ˆvirtual-register-countï¼‰çš„å€¼çš„éè´Ÿfixnumã€‚\n(virtual-register k)\nvirtual-registerè¿”å›æœ€åä¸€æ¬¡å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­çš„å€¼ï¼ˆåœ¨å½“å‰çº¿ç¨‹ä¸Šï¼‰ã€‚\nç¯å¢ƒæŸ¥è¯¢å’Œè®¾ç½®Environmental Queries and Settings (scheme-version)\nChez Schemeçš„ç‰ˆæœ¬\n(threaded?)\nè¿”å›ï¼š#tï¼ˆå¦‚æœåœ¨ç³»ç»Ÿä¸ºçº¿ç¨‹ç‰ˆæœ¬ï¼‰ï¼Œå¦åˆ™è¿”å›#f\n(get-process-id)\nè¿”å›ï¼šå½“å‰è¿›ç¨‹çš„PID\n(getenv key)\nè¿”å›ï¼šç¯å¢ƒä¸­key çš„å€¼ï¼Œæˆ– #f\n(getenv \u0026#34;HOME\u0026#34;) â‡’ \u0026#34;/u/freddy\u0026#34; (putenv key value)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n(putenv \u0026#34;SCHEME\u0026#34; \u0026#34;rocks!\u0026#34;) (getenv \u0026#34;SCHEME\u0026#34;) â‡’ \u0026#34;rocks!\u0026#34; (get-registry key)\nè¿”å›ï¼škey çš„æ³¨å†Œè¡¨å€¼ï¼Œæˆ–è€…**#f**\n(put-registry! key val) | (remove-registry! key)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n","id":96,"section":"posts","summary":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;) è¿”å›ï¼šæœªæŒ‡å®š è­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢","tags":["scheme"],"title":"ç³»ç»Ÿæ“ä½œ(System Operations in Chez Scheme)","uri":"https://lvsq.net/2020/02/system-operations/","year":"2020"},{"content":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›trueçš„è°“è¯ã€ä»¥åŠæ¯ä¸ªå­—æ®µçš„è®¿é—®procedureå’Œé’ˆå¯¹å¯å˜å­—æ®µçš„èµ‹å€¼procedureã€‚æ€»çš„æ¥è¯´ï¼Œä¸Javaä¸­çš„POJOç±»æ¯”è¾ƒç›¸ä¼¼ï¼Œä¸è¿‡ä¸ç”¨è‡ªå®šä¹‰getterå’Œsetteræ–¹æ³•ï¼Œè¿™ä¸Kotlinå€’ä¸ºç±»ä¼¼ï¼Œä¾‹å¦‚ï¼š\n(define-record-type point (fields x y)) åˆ›å»ºäº†ä¸€ä¸ªåä¸ºpointçš„recordç±»å‹ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå­—æ®µxå’Œyï¼Œå’Œå¦‚ä¸‹å‡ ä¸ªå®šä¹‰å¼ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š\n(make-point x y) æ„é€ å‡½æ•° (point? obj) è°“è¯ (point-x p) å­—æ®µxçš„è®¿é—®å™¨ (point-y p) å­—æ®µyçš„è®¿é—®å™¨ é»˜è®¤ä¸‹ï¼Œå­—æ®µæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å¯ä»¥å£°æ˜ä¸ºå¯å˜çš„ï¼ˆmutableï¼‰ã€‚å¦‚ä¸‹å®šä¹‰pointä¸­ï¼Œå­—æ®µxæ˜¯å¯å˜çš„ï¼Œä½†yç»´æŒä¸å˜ï¼š\n(define-record-type point (fields (mutable x) y)) å½“ç„¶äº¦å¯æ˜¾å¼åœ°å°†å­—æ®µå£°æ˜ä¸ºä¸å¯å˜çš„ï¼š\n(define-record-type point (fields (mutable x) (immutable y))) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdefine-record-typeé™¤äº†ç”Ÿæˆäº†ä¸Šè¿°çš„å‡ ä¸ªå®šä¹‰å¼ä¹‹å¤–ï¼Œè¿˜ä¸ºå­—æ®µxå¢åŠ äº†ä¸€ä¸ªèµ‹å€¼è¿‡ç¨‹ï¼š\n(point-x-set! p x)\nè¯¥èµ‹å€¼è¿‡ç¨‹å¯ä»¥ç”¨äºæ”¹å˜xçš„å†…å®¹\n(define p (make-point 36 -17)) (point-x-set! p (- (point-x p) 12)) (point-x p) =\u0026gt; 24 è‡ªåŠ¨ç”Ÿæˆçš„å‡ ä¸ªå®šä¹‰å¼æ˜¯å…è®¸æ”¹å˜åç§°çš„ï¼Œä¸‹é¢çš„pointå®šä¹‰å¼ï¼Œå…¶æ„é€ å‡½æ•°åä¸ºmkpoint, è°“è¯ä¸ºispoint?ï¼Œxå’Œyçš„è®¿é—®å™¨åˆ†åˆ«ä¸ºx-valå’Œy-val, xçš„èµ‹å€¼å™¨ä¸ºset-x-val!\n(define-record-type (point mkpoint ispoint?) (fields (mutable x x-val set-x-val!) (immutable y y-val))) é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ä¸€ä¸ªrecord definitionåˆ›å»ºä¸€ä¸ªæ–°ç±»å‹ï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥ç”¨Javaæ¥è§£é‡Šï¼Œå³å¯¹äºåŒä¸€ä¸ªPOJOç±»newå‡ºä¸¤ä¸ªå®ä¾‹ï¼Œä½†è¿™ä¸¤ä¸ªå®ä¾‹å¹¶ä¸èƒ½equalï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define (f p) (define-record-type point (fields x y)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #f ç¬¬ä¸€ä¸ªfçš„è°ƒç”¨å³(f \u0026lsquo;make)è¿”å›ä¸€ä¸ªpointç±»å‹çš„pï¼Œå°†pä¼ é€’ç»™ç¬¬äºŒä¸ªfï¼Œä½†pæ˜¯ç”±ç¬¬ä¸€ä¸ªè°ƒç”¨ç”Ÿæˆçš„ç±»å‹ï¼Œæ‰€ä»¥point?è¿”å›#fã€‚æŒ‰ç…§SICPçš„è¯´æ³•ï¼Œè¿™ä¸¤ä¸ªdefine-record-typeå¹¶ä¸åœ¨ä¸€ä¸ªç¯å¢ƒä¸­ï¼Œåªæ˜¯åå­—ä¸€æ ·è€Œå·²ã€‚\né»˜è®¤çš„ç”Ÿäº§è¡Œä¸º(generative behavior)æˆ–è®¸å¯ä»¥ç”±è®°å½•å®šä¹‰å¼ä¸­çš„nongenerativeå­å¥æ¥é‡è½½ï¼š\n(define (f p) (define-record-type point (fields x y) (nongenerative)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #t ä»¥è¿™ç§æ–¹å¼åˆ›å»ºçš„è®°å½•ç±»å‹ä»ç„¶ä¸åŒäºç”±å®šä¹‰å‡ºç°åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¸­åˆ›å»ºçš„è®°å½•ç±»å‹ï¼Œå³ä½¿è¿™äº›å®šä¹‰åœ¨è¯­æ³•ä¸Šæ˜¯ç›¸åŒçš„ï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative)) (point? p)) (g (f)) =\u0026gt; #f ç”šè‡³å¯ä»¥é€šè¿‡åœ¨nongenerativeå­å¥ä¸­åŒ…å«uidï¼ˆå”¯ä¸€idï¼‰æ¥è¦†ç›–å®ƒï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (point? p)) (g (f)) =\u0026gt; #t è®°å½•ç±»å‹å¯ä»¥å®šä¹‰ä¸ºæœ‰parentå­å¥çš„å­ç±»å‹ï¼Œå³ä¸€ä¸ªè®°å½•ç±»å‹å¯ä»¥å£°æ˜ä¸ºæŸä¸€ä¸ªè®°å½•ç±»å‹çš„å­ç±»å‹ï¼Œå¦‚æœæŒ‡å®šäº†çˆ¶ç±»å‹ï¼Œåˆ™å­ç±»å‹å°†ç»§æ‰¿çˆ¶ç±»å‹æ‰€æœ‰å­—æ®µï¼Œä¸”å­ç±»å‹çš„æ¯ä¸ªå®ä¾‹éƒ½è¢«è§†ä¸ºçˆ¶ç±»å‹çš„å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»å‹çš„è®¿é—®å™¨å’Œå­—æ®µç­‰ç­‰ã€‚\n(define-record-type point (fields x y)) (define-record-type cpoint (parent point) (fields color)) (define cp (make-cpoint 3 4 \u0026#39;red)) (point? (make-cpoint 3 4 \u0026#39;red)) =\u0026gt; #t (cpoint? (make-point 3 4)) =\u0026gt; #f (define cp (make-cpoint 3 4 \u0026#39;red)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (cpoint-color cp) =\u0026gt; red åˆ°ç›®å‰ä¸ºæ­¢ï¼Œdefine-record-typeå®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°æ¥å—recordåŒ…å«çš„å­—æ®µä¸€æ ·å¤šçš„å‚æ•°ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥é‡å†™é»˜è®¤å€¼ï¼Œè¿™é‡Œéœ€è¦å¼•å…¥protocolå­å¥ï¼Œä»¥ä¸‹å®šä¹‰å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå­—æ®µçš„ç‚¹è®°å½•ï¼šxï¼Œyå’Œdï¼Œå…¶ä¸­dè¡¨ç¤ºè·åŸç‚¹çš„ä½ç§»ã€‚æ„é€ å‡½æ•°ä»ç„¶åªæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå³xå’Œyå€¼ï¼Œå¹¶å°†dåˆå§‹åŒ–ä¸ºxå’Œyå¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚\n(define-record-type point (fields x y d) (protocol (lambda (new) (lambda (x y) (new x y (sqrt (+ (* x x) (* y y)))))))) (define p (make-point 3 4)) (point-x p) =\u0026gt; 3 (point-y p) =\u0026gt; 4 (point-d p) =\u0026gt; 5 å¦å¤–ï¼Œå­ç±»å‹çš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•°é¡ºåºæ˜¯ä¸å¯æ”¹å˜çš„ï¼Œå³å…ˆæ˜¯çˆ¶ç±»å‹æ„é€ å‡½æ•°çš„å­—æ®µï¼Œç„¶åæ‰æ˜¯å­ç±»å‹çš„å‚æ•°ï¼Œå¦‚æœéœ€è¦æ”¹å˜å­ç±»å‹çš„æ„é€ å‡½æ•°çš„å‚æ•°é¡ºåºè¯¥å¦‚ä½•å‘¢ï¼Ÿ\n(define-record-type cpoint (parent point) (fields color) (protocol (lambda (pargs-\u0026gt;new) (lambda (x c y) ((pargs-\u0026gt;new x y) c))))) (define cp (make-cpoint 3 \u0026#39;red 4)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (point-d cp) =\u0026gt; 5 (cpoint-color cp) =\u0026gt; red æœ€åæ¥çœ‹çœ‹define-record-typeçš„è¯­æ³•å½¢å¼ï¼š\nsyntax: (define-record-type record-name clause \u0026hellip;)\nsyntax: (define-record-type (record-name constructor pred) clause \u0026hellip;)\nFields clauseè¯­æ³•å½¢å¼:\n(fields field-spec \u0026hellip;)\nfield-specå¿…é¡»æ˜¯ä¸‹é¢5ä¸ªä¸­çš„ä¸€ä¸ª:\nfield-name (immmutable field-name) (mutable field-name) (immmutable field-name accessor-name) (mutable field-name accessor-name mutator-name) define-record in Chez Scheme Chez Schemeä¾ç„¶æ”¯æŒ$R^6RS$ä¸­ä¼ ç»Ÿçš„recordç±»å‹çš„å®šä¹‰ï¼Œå¦å¤–è¿˜æä¾›ä¸€ä¸ªæ–°çš„è¯­æ³•ï¼Œå³define-recordï¼Œå…¶è¯­æ³•å½¢å¼ä¸define-record-typeä¸€æ ·ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œdefine-recordä¸­çš„å­—æ®µé»˜è®¤æ˜¯å¯å˜çš„ï¼Œè¿™ä¸$R^6RS$ä¸­çš„recordç›¸åï¼Œå› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªè®°å½•ç±»å‹æ—¶ï¼ŒåŒæ—¶ä¼šå®šä¹‰ä¸‹åˆ—è¿‡ç¨‹ï¼š\n(define-record point (x y)) (make-point x y) ;;\tconstructor (point? obj) ;;\tpredicate (point-x p) ;;\taccessor for field x (point-y p) ;;\taccessor for field y (set-point-x! p obj) ;;\tmutator for field x (set-point-y! p obj) ;;\tmutator for field y é€šè¿‡å¯¹define-record-typeçš„äº†è§£ï¼Œå¯ä»¥å‘ç°å…¶éå¸¸OOï¼Œsmalltalkæ˜¯å¦å—å…¶å½±å“ä¸å¾—è€ŒçŸ¥ï¼Œè‡³å°‘ç»è¿‡çºµå‘æ¯”è¾ƒå¯¹äºæˆ‘ä»¬å­¦ä¹ æŠ€æœ¯å¤§æœ‰è£¨ç›Šã€‚\n","id":97,"section":"posts","summary":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›tr","tags":["scheme"],"title":"Schemeè¯­æ³•define-record-typeä»‹ç»","uri":"https://lvsq.net/2020/02/define-record-type/","year":"2020"},{"content":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åœ¨ Chez Scheme ä¸­ä»¥â€œå¾®æ¨¡å—â€çº§åˆ«ä½¿ç”¨ï¼Œå› ä¸º Chez Scheme ä¸­çš„æ¨¡å—å’Œ import å½¢å¼å±äºå®šä¹‰ï¼Œå¹¶ä¸”å¯ä»¥å‡ºç°åœ¨å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»æ„ä½ç½®ï¼ŒåŒ…æ‹¬åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“æˆ–å…¶ä»–å±€éƒ¨ä½œç”¨åŸŸä¸­ã€‚\nå¾®æ¨¡å—ä¸å‡½æ•°å­°å¥½ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯è§†æƒ…å†µè€Œå®šï¼Ÿï¼Ÿï¼Ÿ\næ¨¡å—æ§åˆ¶ç»‘å®šçš„å¯è§æ€§ï¼Œå¯ä»¥ç”¨ä½œæ‰©å±•è¯æ³•ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ›´ç²¾ç¡®åœ°æ§åˆ¶ç»‘å®šçš„å¯è§èŒƒå›´ã€‚æ¨¡å—å¯¼å‡ºæ ‡è¯†ç¬¦çš„ç»‘å®šï¼Œå³å˜é‡ç»‘å®šã€å…³é”®å­—ç»‘å®šæˆ–æ¨¡å—åç»‘å®šã€‚æ¨¡å—å¯ä»¥æ˜¯å…·åçš„æŠ‘æˆ–åŒ¿åçš„ã€‚åªè¦æ¨¡å—åå¯è§ï¼Œé‚£ä¹ˆåœ¨å…·åæ¨¡å—å‡ºç°å¤„å¯¼å…¥çš„ç»‘å®šéƒ½å¯è§ã€‚åŒ¿åæ¨¡å—ä¸­å¯¼å‡ºçš„ç»‘å®šï¼Œåœ¨æ¨¡å—å‡ºç°çš„åœ°æ–¹è¢«éšå¼åœ°å¯¼å…¥ã€‚åŒ¿åæ¨¡å—å¯ç”¨äºéšè—ä¸€ç»„ç»‘å®šä¸­çš„ä¸€äº›ç»‘å®šï¼ŒåŒæ—¶å…è®¸å…¶ä½™ç»‘å®šå¯è§ã€‚\nè¯­æ³• (module name interface defn \u0026hellip; init \u0026hellip;)\n(module interface defn \u0026hellip; init \u0026hellip;)\nname æ˜¯æ ‡è¯†ç¬¦ï¼Œdefn \u0026hellip; æ˜¯å®šä¹‰ï¼Œinit \u0026hellip; æ˜¯è¡¨è¾¾å¼ã€‚interface æ˜¯å½¢å¦‚ (export \u0026hellip;) çš„å¯¼å‡ºè¡¨ï¼Œå…¶ä¸­æ¯ä¸ª export éƒ½æ˜¯æ ‡è¯†ç¬¦ identifier æŠ‘æˆ–å½¢å¼ (identifier export \u0026hellip;)ã€‚\næ¨¡å—ç”±ä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰å®šä¹‰å’Œä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰åˆå§‹åŒ–è¡¨è¾¾å¼åºåˆ—ç»„æˆã€‚æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼ˆå¯ç†è§£ä¸ºå˜é‡æˆ–è€…çŠ¶æ€ï¼Œä¸‹åŒï¼‰åœ¨æ¨¡å—çš„ç¨‹åºä½“ä¸­å¯è§ï¼Œè¢«å¯¼å‡ºçš„æ ‡è¯†ç¬¦åœ¨æ¨¡å—çš„å¯¼å…¥ä½œç”¨åŸŸå†…äº¦å¯è§ã€‚æ¨¡å—æ¥å£ä¸­åˆ—å‡ºçš„æ¯ä¸ªæ ‡è¯†ç¬¦å¿…é¡»åœ¨è¯¥æ¨¡å—ä¸­å®šä¹‰æˆ–è¢«å¯¼å…¥è¯¥åˆ°æ¨¡å—ã€‚module å½¢å¼æ˜¯ä¸€ç§å®šä¹‰ï¼Œå› æ­¤å¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ï¼ŒåŒ…æ‹¬åµŒå¥—åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“ã€ library å½¢å¼ã€é¡¶å±‚ç¨‹åºï¼Œä»¥åŠåµŒå¥—åœ¨å…¶ä»–æ¨¡å—ä¸­ã€‚æ­¤å¤–ï¼Œå› ä¸ºæ¨¡å—åçš„ä½œç”¨åŸŸä¸å…¶ä»–æ ‡è¯†ç¬¦ç›¸åŒï¼Œæ‰€ä»¥æ¨¡å—å’Œåº“å¯ä»¥åƒå˜é‡å’Œå…³é”®å­—é‚£æ ·å¯¼å‡ºæ¨¡å—åã€‚\næ¨¡å—åä¸å…¶ä»–æ ‡è¯†ç¬¦å ç”¨ç›¸åŒçš„åå­—ç©ºé—´ï¼Œå¹¶éµå¾ªç›¸åŒçš„ä½œç”¨åŸŸè§„åˆ™ã€‚é™¤éè¢«å¯¼å‡ºï¼Œå¦åˆ™æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ä»…åœ¨è¯¥æ¨¡å—ä¸­å¯è§ã€‚\næ¨¡å—å†…çš„è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨åœ¨æ¨¡å—å¤–éƒ¨ç»‘å®šçš„æ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (module m (plusx) (define plusx (lambda (y) (+ x y)))) (import m) (let ([x 4]) (plusx 5))) ; =\u0026gt; 8,æ³¨æ„ä¸æ˜¯9å“¦ï¼Œå¯ä»¥å°†plusxè§†ä¸ºï¼š(define plusx (lambda (y) (+ 3 y)))) åŒæ ·ï¼Œimportä¸ä¼šé˜»æ­¢è®¿é—®å‡ºç°å¯¼å…¥è¡¨å•çš„å¯è§æ ‡è¯†ç¬¦ï¼Œä½†importæ ‡è¯†ç¬¦æ‰€è¦†ç›–çš„å˜é‡é™¤å¤–ï¼ˆå•¥å«è¦†ç›–ï¼Œçœ‹ä¸‹é¢ä¸¤æ®µä»£ç ï¼‰ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import m) (list x y)) ; =\u0026gt; (local-x m-y) æ¨¡å—mä¸­å®šä¹‰äº†æ ‡è¯†ç¬¦y, åœ¨å…¶è¢«importä¹‹åä¼šè¦†ç›–letä¸­çš„yï¼›\n(module m (y) (define y \u0026#39;m-y)) (let () (import m) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (list x y)) ; =\u0026gt; (local-x local-y) ) å…ˆimport mï¼Œä¹‹åå†å®šä¹‰yï¼Œæ¨¡å—ä¸­å®šä¹‰çš„yä¸ä¼šè¦†ç›–letçš„yã€‚\nå¦ä¸€æ–¹é¢ï¼Œåœ¨æ¨¡å—ä¸­ä½¿ç”¨ import-only ä¼šå»ºç«‹ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨åŸŸï¼Œå…¶ä¸­å”¯ä¸€å¯è§çš„æ˜¯è¢«å¯¼å…¥æ¨¡å—æ‰€å¯¼å‡ºçš„æ ‡è¯†ç¬¦ï¼Œä¸‹é¢çš„ä»£ç ä¸­åªæœ‰yå¯è§ã€‚ å¯¹äºé™æ€éªŒè¯ï¼Œæœ‰æ—¶ä¸å¸Œæœ›ä½¿ç”¨ä»»ä½•æ ‡è¯†ç¬¦ï¼Œé™¤äº†æ˜ç¡®å¯¼å…¥æ¨¡å—æˆ–æœ¬åœ°èŒƒå›´çš„æ ‡è¯†ç¬¦å¤–ï¼Œè¿™æœ‰æ—¶æ˜¯åˆä¹éœ€è¦çš„ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import-only m) x) ; =\u0026gt; Error: x is not visible é™¤éé€šè¿‡â€œimport-onlyâ€å¯¼å…¥çš„æ¨¡å—å¯¼å‡ºâ€œimportâ€æˆ–â€œimport-onlyâ€ä»¥åŠè‡³å°‘ä¸€ä¸ªæ¨¡å—çš„åç§°ï¼Œå¦åˆ™æ— æ³•åœ¨â€œimport-onlyâ€èŒƒå›´å†…è¿›è¡Œåç»­å¯¼å…¥ã€‚ è¦åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—å¯¼å‡ºçš„éš”ç¦»èŒƒå›´è€Œåˆä¸ä½¿â€œimportâ€æˆ–â€œimport-onlyâ€å¯è§ï¼Œå¿…é¡»ä»¥ç›¸åŒçš„â€œimport-onlyâ€å½¢å¼åˆ—å‡ºæ‰€æœ‰è¦å¯¼å…¥çš„æ¨¡å—ã€‚\nå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«æ¯ä¸ªå…¶ä»–æ¨¡å—çš„å¯¼å‡ºçš„æ¨¡å—ã€‚\n(module m2 (y) (define y \u0026#39;y)) (module m1 (x) (define x \u0026#39;x)) (module mega-module (cons x y) (import m1) (import m2) (import scheme)) (let ([y 3]) (import-only mega-module) (cons x y)) ; =\u0026gt; (x . y) åœ¨å®ƒè¢«ç¼–è¯‘ä¹‹å‰ï¼Œæºç¨‹åºè¢«ç¿»è¯‘æˆä¸å«è¯­æ³•æŠ½è±¡ã€è¯­æ³•å®šä¹‰ã€åº“å®šä¹‰ã€æ¨¡å—å®šä¹‰ä»¥åŠ import å½¢å¼çš„æ ¸å¿ƒè¯­è¨€ç¨‹åºã€‚ç¿»è¯‘ç”±è¯­æ³•å±•å¼€å™¨è´Ÿè´£ï¼Œè¯­æ³•å±•å¼€å™¨ä»¥é€’å½’ä¸‹é™çš„æ–¹å¼å¤„ç†æºç¨‹åºä¸­çš„å½¢å¼ã€‚\nmodule å’Œ import ç‰¹æ®Šå½¢å¼ä»…å½±å“æ ‡è¯†ç¬¦(identifier)åœ¨æºç¨‹åºä¸­çš„å¯è§æ€§ï¼Œè€Œä¸å½±å“å…¶å«ä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œæ— è®ºå˜é‡è¢«ç»‘å®šåˆ°åœ¨æ¨¡å—å†…éƒ¨æˆ–å¤–éƒ¨å®šä¹‰çš„ä½ç½®ï¼Œimport éƒ½ä¸ä¼šå¼•å…¥æ–°ä½ç½®ã€‚ä¸ºäº†ä¿æŒç”±æ¨¡å—å’Œè¯­æ³•æŠ½è±¡å»ºç«‹çš„ä½œç”¨åŸŸå…³ç³»ï¼Œå±€éƒ¨å˜é‡åœ¨å¿…è¦æ—¶ä¼šè¢«é‡å‘½åã€‚å› æ­¤ï¼Œè¡¨è¾¾å¼ï¼š\n(let ([x 1]) (module m (x setter) (define-syntax x (identifier-syntax z)) (define setter (lambda (x) (set! z x))) (define z 5)) (let ([y x] [z 0]) (import m) (setter 3) (+ x y z))) ; =\u0026gt; 4 ç­‰ä»·äºä¸‹é¢çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­æ ‡è¯†ç¬¦è¢«ç»Ÿä¸€åœ°æ›´åï¼Œå¹¶å¸¦ä¸Šäº†ä¸‹æ ‡ï¼š\n(let ([x0 1]) (define-syntax x1 (identifier-syntax z1)) (define setter1 (lambda (x2) (set! z1 x2))) (define z1 5) (let ([y3 x0] [z3 0]) (setter1 3) (+ x1 y3 z3))) äº’é€’å½’module (module (a b) (module a (x) (define x (lambda () y))) (module b (y) (define y (lambda () x))) (import a) (import b)) æ­¤æ¨¡å¼çš„ä¸€èˆ¬åŒ–è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…è®¸å®šä¹‰å¤šä¸ªäº’é€’å½’çš„æ¨¡å—\n(define-syntax rec-modules (syntax-rules (module) [(_ (module m (id ...) form ...) ...) (module (m ...) (module m (id ...) form ...) ... (import m) ...)])) ç»„åˆmodule ç”±äºæ¨¡å—å¯ä»¥é‡æ–°å¯¼å‡ºæ‰€å¯¼å…¥çš„ç»‘å®šï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åœ¨å•ä¸ªæ¨¡å—ä¸Šæä¾›å¤šä¸ªè§†å›¾ï¼Œå°±åƒä¸‹é¢çš„ s å’Œ t ä¸º r æä¾›çš„è§†å›¾é‚£æ ·ï¼Œæˆ–è€…å°†å‡ ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªå¤åˆï¼Œå°±åƒ r é‚£æ ·ã€‚\n(module p (x y) (define x 1) (define y 2)) (module q (y z) (define y 3) (define z 4)) (module r (a b c d) (import* p (a x) (b y)) (import* q (c y) (d z))) (module s (a c) (import r)) (module t (b d) (import r)) import* ç¨å¾®è§£é‡Šä¸€ä¸‹import*, å…¶è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š\n(define-syntax import* (syntax-rules () [(_ m) (begin)] [(_ m (new old)) (module (new) (module (tmp) (import m) (alias tmp old)) (alias new tmp))] [(_ m id) (module (id) (import m))] [(_ m spec0 spec1 ...) (begin (import* m spec0) (import* m spec1 ...))])) å®ƒæ”¯æŒé‡å‘½åimportçš„ç»‘å®šå’Œé€‰æ‹©æ€§å¯¼å…¥ç‰¹å®šçš„ç»‘å®šï¼Œæ— éœ€ä½¿ç”¨å†…ç½®çš„importå­å½¢å¼æ¥é€‰æ‹©å’Œé‡å‘½åæ ‡è¯†ç¬¦ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š\n(let () (import* scheme (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) (let () (import* (rnrs) (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) å…ƒå®šä¹‰Meta Definitions è¯­æ³•ï¼š(meta . definition)\nmeta å…³é”®å­—å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥æ”¾åœ¨ä»»ä½•å®šä¹‰å…³é”®å­—å‰é¢çš„å‰ç¼€ï¼Œä¾‹å¦‚ï¼Œ\n(meta define x 3)\nå®ƒå‘Šè¯‰å±•å¼€å™¨ï¼Œè¯¥å®šä¹‰å¼äº§ç”Ÿçš„ä»»ä½•å˜é‡å®šä¹‰éƒ½åªæ˜¯å±•å¼€æœŸå®šä¹‰ï¼Œåªèƒ½ç”¨äºå…¶ä»–å…ƒå®šä¹‰çš„å³ä¾§ï¼Œæœ€ä¸»è¦æ˜¯ç”¨åœ¨è½¬æ¢å™¨è¡¨è¾¾å¼ä¸­ã€‚å®ƒç”¨äºå®šä¹‰å±•å¼€æœŸè¾…åŠ©å‡½æ•°ï¼Œä»¥åŠä¾›ä¸€ä¸ªæˆ–å¤šä¸ª syntax-case è½¬æ¢å™¨æ‰€ä½¿ç”¨çš„å…¶ä»–ä¿¡æ¯ã€‚\nå…ƒå®šä¹‰çš„è¯­ä¹‰ç±»ä¼¼äºlet*ï¼Œå®ƒå¯ä»¥æ˜¯è‡ªé€’å½’ï¼Œä½†ä¸æ˜¯äº’é€’å½’çš„ã€‚\nå…ƒå®šä¹‰é€šè¿‡å®å±•å¼€ä¼ æ’­ï¼Œå› æ­¤å¯ä»¥ç¼–å†™ï¼Œä¾‹å¦‚ï¼š\n(module (a) (meta define-record foo (x)) (define-syntax a (let ([q (make-foo #\u0026#39;\u0026#39;q)]) (lambda (x) (foo-x q))))) a ï¼›=\u0026gt; q æ¡ä»¶å±•å¼€Conditional expansion å¯ä»¥é€šè¿‡ meta-cond åœ¨å±•å¼€æœŸåšå‡ºå†³ç­–ï¼Œè¿™ç±»ä¼¼äº condï¼Œä½†æ˜¯æ˜¯åœ¨å±•å¼€æœŸæ±‚å€¼å¹¶æµ‹è¯•è¡¨è¾¾å¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é¢„æœŸä¸ºå®šä¹‰çš„ä¸Šä¸‹æ–‡ä¸­ä»¥åŠåœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚\nè¯­æ³•ï¼š(meta-cond clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ª clauseï¼Œå…¶ä½™çš„å¿…é¡»é‡‡å–ä»¥ä¸‹å½¢å¼ï¼š\n(test expr1 expr2 \u0026hellip;)\næœ€åä¸€ä¸ª cluase é™¤å¯é‡‡å–ä¸Šè¿°å½¢å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ else å­å¥å½¢å¼ï¼š\n(else expr1 expr2 \u0026hellip;)\nåœ¨å±•å¼€æœŸé—´ï¼Œtest è¡¨è¾¾å¼ä¼šè¢«é¡ºåºåœ°æ±‚å€¼ï¼Œç›´åˆ°æŸæ¡è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸæˆ–è€…æ±‚å€¼å®Œæ‰€æœ‰çš„è¡¨è¾¾å¼ä¸ºæ­¢ã€‚å¦‚æœä¸€æ¡ test è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºåŒ…å«ç›¸åº”è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦‚æœæ²¡æœ‰æ±‚å€¼ä¸ºçœŸçš„ test è¡¨è¾¾å¼ï¼Œä¸”å­˜åœ¨ else å­å¥ï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºç”±æ¥è‡ªäº else å­å¥çš„è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦åˆ™ï¼Œmeta-cond è¡¨è¾¾å¼å±•å¼€ä¸ºå¯¹ void è¿‡ç¨‹çš„è°ƒç”¨ã€‚\nmeta-cond å¯ä»¥æŒ‰å¦‚ä¸‹å®šä¹‰ï¼š\n(define-syntax meta-cond (syntax-rules () [(_ [a0 a1 a2 ...] [b0 b1 b2 ...] ...) (let-syntax ([expr (cond [a0 (identifier-syntax (begin a1 a2 ...))] [b0 (identifier-syntax (begin b1 b2 ...))] ...)]) expr)])) meta-cond ç”¨äºåœ¨å±•å¼€æœŸä»ä¸€ç»„å¯èƒ½çš„å½¢å¼ä¸­è¿›è¡Œé€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥å®šä¹‰è¿‡ç¨‹çš„å®‰å…¨ï¼ˆè¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰å’Œä¸å®‰å…¨ï¼ˆä¸è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰ç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®ç¼–è¯‘æœŸä¼˜åŒ–çº§åˆ«å†³å®šè°ƒç”¨ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:\n(meta-cond [(= (optimize-level) 3) (unsafe-frob x)] [else (safe-frob x)]) åˆ«åAliases è¯­æ³•ï¼š(alias id1 id2)\nalias æ˜¯ä¸€ç±»å®šä¹‰ï¼Œå¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ã€‚å®ƒç”¨äºå°†ç»‘å®šä»ä¸€ä¸ªæ ‡è¯†ç¬¦è½¬ç§»åˆ°å¦ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (alias y x) (set! y 4) (list x y)) ; =\u0026gt; (4 4) ç”±äºå±•å¼€æ˜¯ç”±å·¦è‡³å³è¿›è¡Œçš„ï¼Œåˆ«ååº”è¯¥å‡ºç°åœ¨å³ä¾§çš„æ ‡è¯†ç¬¦çš„å®šä¹‰ä¹‹åï¼Œä¾‹å¦‚ï¼š\n(let () (import-only (chezscheme)) (define y 3) (alias x y) x) ; =\u0026gt; 3 è€Œä¸æ˜¯ï¼š\n(let () (import-only (chezscheme)) (alias x y) (define y 3) x) ; =\u0026gt; exception: unbound identifier ","id":98,"section":"posts","summary":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥","tags":["modules"],"title":"Chez Scheme Modules","uri":"https://lvsq.net/2020/01/modules/","year":"2020"},{"content":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚\n(define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_ ((a1 v1) (a2 v2) ...) bodys ...) (let ((a1 v1)) (my-let* ((a2 v2) ...) bodys ...)) ) ) ) æ³¨æ„ï¼Œmy-let*æ˜¯å¯ä»¥é€’å½’ä½¿ç”¨çš„ï¼Œä»¥åŠ**\u0026hellip;**çš„ç”¨æ³•ã€‚\n(define-syntax my-let* (syntax-rules () ( (_ () bodys ...) (let () bodys ...) ) ( (_ ((a1 v1) ...) bodys ...) (let () (define a1 v1) ... bodys ... ) ) ) ) è¿™ä¸ªå®ç°æ–¹å¼ä¸ä¸Šé¢çš„ä¸åŒï¼Œä¸Šé¢çš„æ˜¯åµŒå¥—letï¼Œè¿™é‡Œå°†ç›´æ¥æŒ‰é¡ºåºdefineå†…éƒ¨å˜é‡ï¼Œä»£ç æ›´çŸ­ã€‚æ³¨æ„æ­¤å¤„çš„**\u0026hellip;**çš„ç”¨æ³•ã€‚\n","id":99,"section":"posts","summary":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚ (define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_","tags":["scheme"],"title":"è‡ªå®šä¹‰ Let*","uri":"https://lvsq.net/2020/01/my-let/","year":"2020"},{"content":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©å±•æœŸé—´ä¼šæš‚æ—¶æ›´æ”¹keywordçš„ç°æœ‰ç»‘å®šï¼Œè€Œä¸æ˜¯å¼•å…¥keywordçš„æ–°ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰©å±•form1 form2 \u0026hellip;çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªkeywordçš„å¯è§èŒƒå›´ï¼ˆæˆ–é¡¶çº§ï¼‰å°†ä¼šä¸´æ—¶æ›¿æ¢ä¸ºæ–°çš„ç»‘å®šå…³ç³»ã€‚\n(let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 2 ) ) ) (let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (fluid-let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 1 ) ) ) å¯¹æ¯”ä¸Šè¿°ä¸¤æ®µä»£ç ï¼Œå¯çŸ¥ï¼šä¸¤ä¸ªè¡¨è¾¾å¼åŸºæœ¬ç›¸åŒçš„ï¼Œé™¤äº†å‰è€…é‡‡ç”¨å†…éƒ¨let-synctaxè¯­æ³•ï¼Œç¬¬äºŒä¸ªé‡‡ç”¨fluid-let-syntaxè¯­æ³•ã€‚åœ¨ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œ(g 1)æ‰©å±•ä¸­çš„å‡ºç°çš„få¼•ç”¨çš„æ˜¯let-boundçš„å˜é‡fï¼Œè€Œç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œfå¼•ç”¨çš„æ˜¯ç”±fluid-let-syntaxç»‘å®šçš„f\n","id":100,"section":"posts","summary":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©","tags":["module","syntactic"],"title":"Syntactic Extension and Modules in Chez Scheme","uri":"https://lvsq.net/2020/01/syntactic-extension-and-modules/","year":"2020"},{"content":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„å¯ä»¥å…±äº«æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ–æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œåœ¨é‡‡ç”¨æ­¤ç§å‚æ•°ä¼ é€’è§„åˆ™çš„è¯­è¨€çš„è§£é‡Šå™¨ä¸­ï¼Œå¯ä»¥ç”¨ boxes å®ç° call-by-reference çš„è¯­ä¹‰ã€‚è§£é‡Šæœ‰ç‚¹ç»•ï¼ŒæŒ‰æˆ‘çš„ç†è§£boxeså°±ç›¸å½“äºGolangçš„structã€Javaä¸­çš„ç±»ï¼Œå°†ä¸€äº›çŠ¶æ€åŒ…è£…æˆä¸€ä¸ªæ•´å—ï¼Œå¤–ç•Œé€šè¿‡å¼•ç”¨è¯¥æ•´å—çš„æŒ‡é’ˆæ¥è®¿é—®å†…éƒ¨çš„å„ä¸ªçŠ¶æ€ã€‚\nBoxes çš„å­—é¢å½¢å¼å¸¦æœ‰å‰ç¼€ #\u0026amp; (å‘éŸ³ä¸º â€œhash-ampersandâ€). ä¾‹å¦‚ï¼Œ #\u0026amp;(a b c) æ˜¯ä¸€ä¸ª boxï¼Œå†…å®¹ä¸ºåˆ—è¡¨ (a b c). è¯»å–å™¨è‹¥é‡åˆ° #!r6rs ï¼Œåˆ™ä¼šåœ¨å…¶åçš„è¾“å…¥æµä¸­ç¦ç”¨ box è¯­æ³•ï¼Œé™¤éåœ¨æ›´è¿‘çš„ä½ç½®é‡åˆ° #!chezscheme.\næ‰€æœ‰ boxes é»˜è®¤æ˜¯å¯å˜çš„ï¼ŒåŒ…æ‹¬å¸¸é‡ã€‚ç¨‹åºå¯ä»¥é€šè¿‡ box-immutable åˆ›å»ºä¸å¯å˜ boxes. å°è¯•ä¿®æ”¹ä¸å¯å˜ box ä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ç”¨æ³•ï¼š\n(box? obj) å¦‚æœ obj æ˜¯ box, åˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box? \u0026#39;#\u0026amp;a) =\u0026gt; #t (box? \u0026#39;a) =\u0026gt; #f (box? (box 3)) =\u0026gt; #t (box obj) åˆ›å»ºä¸€ä¸ªç”±objç»„æˆçš„box\n(box \u0026#39;a) =\u0026gt; #\u0026amp;a (box (box \u0026#39;(a b c))) =\u0026gt; #\u0026amp;#\u0026amp;(a b c) (unbox box) è¿”å›boxçš„å†…å®¹\n(unbox #\u0026amp;a) =\u0026gt; a (unbox #\u0026amp;#\u0026amp;(a b c)) =\u0026gt; #\u0026amp;(a b c) (let ([b (box \u0026#34;hi\u0026#34;)]) (unbox b)) =\u0026gt; \u0026#34;hi\u0026#34; (set-box! box obj) box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ set-box! æŠŠ box çš„å†…å®¹è®¾ç½®ä¸º obj.\n(let ([b (box \u0026#39;x)]) (set-box! b \u0026#39;y) b) =\u0026gt; #\u0026amp;y (let ([incr! (lambda (x) (set-box! x (+ (unbox x) 1)))]) (let ([b (box 3)]) (incr! b) (unbox b))) =\u0026gt; 4 (box-cas! box old-obj new-obj) å¦‚æœ box è¢«æ”¹å˜ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f. box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ è‹¥ box å¾…æ›¿æ¢çš„å†…å®¹å’Œ old-obj ç›¸åŒ(åŸºäº eq?), åˆ™ box-cas! è‡ªåŠ¨å°† box çš„å†…å®¹æ›¿æ¢ä¸º new-obj; è‹¥ä¸ç›¸åŒï¼Œåˆ™ box ä¿æŒä¸å˜ã€‚å³CASæ“ä½œï¼ŒåŸå­çš„ã€‚\n(define b (box \u0026#39;old)) (box-cas! b \u0026#39;old \u0026#39;new) =\u0026gt; #t (unbox b) =\u0026gt; \u0026#39;new (box-cas! b \u0026#39;other \u0026#39;wrong) =\u0026gt; #f (unbox b) =\u0026gt; \u0026#39;new (mutable-box? obj) å¦‚æœ obj æ˜¯å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(immutable-box? obj) å¦‚æœ obj æ˜¯ä¸å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box-immutable obj) è¿”å›ä¸€ä¸ªå†…å®¹ä¸ºobjçš„ä¸å¯å˜çš„boxã€‚Boxes é€šå¸¸ç”¨æ¥æ”¯æŒå…±äº«çš„ï¼Œå¯å˜çš„ç»“æ„ï¼Œæ‰€ä»¥ä¸å¯å˜çš„ box ä¸€èˆ¬æ²¡ä»€ä¹ˆç”¨ã€‚\n","id":101,"section":"posts","summary":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„","tags":["scheme"],"title":"Chez Schemeä¸­Boxesä»‹ç»","uri":"https://lvsq.net/2020/01/boxes-in-chez/","year":"2020"},{"content":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x)))\n(atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦ï¼›list-headå’ŒSchemeæ ‡å‡†è¿‡ç¨‹list-tailå¯èƒ½ä¼šåŒæ—¶ä½¿ç”¨æ¥åˆ‡å‰²ä¸€ä¸ªlistï¼Œä¸åŒç‚¹åœ¨äºï¼Œlist-tailä¸ä¼šåˆ†é…å†…å­˜è€Œåªæ˜¯è¿”å›æºlistçš„ä¸€ä¸ªå­åˆ—è¡¨ï¼Œlist-headæ€»æ˜¯è¿”å›æºlistå‰nä¸ªå…ƒç´ çš„å‰¯æœ¬\n(list-head \u0026#39;(a b c) 0) â‡’ () (list-head \u0026#39;(a b c) 2) â‡’ (a b) (list-head \u0026#39;(a b c) 3) â‡’ (a b c) (list-head \u0026#39;(a b c . d) 2) â‡’ (a b) (list-head \u0026#39;(a b c . d) 3) â‡’ (a b c) (list-head \u0026#39;#1=(a . #1#) 5) â‡’ (a a a a a) last-pair(Chez) ç”¨æ³•ï¼š(last-pair list) åˆ—è¡¨ä¸èƒ½ä¸ºç©ºã€‚ last-pairè¿”å›åˆ—è¡¨çš„æœ€åä¸€å¯¹ï¼ˆpairï¼‰ï¼ˆä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼‰, listå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„åˆ—è¡¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€åä¸€å¯¹æ˜¯åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ å’Œç»ˆæ­¢å¯¹è±¡çš„ä¸€ä¸ªpairã€‚\n(last-pair \u0026#39;(a b c d)) â‡’ (d) (last-pair \u0026#39;(a b c.d)) â‡’ (c . d) list-copy(Chez) ç”¨æ³•ï¼š (list-copy list) è¿”å›ä¸€ä¸ªlistçš„å‰¯æœ¬ï¼Œequal?ï¼ˆç»“æ„å’Œå€¼ç›¸åŒï¼‰åˆ¤æ–­ä¸º#t\nlist*(Chez) ç”¨æ³•ï¼š(list* obj \u0026hellip; final-obj) è¿”å›ä¸€ä¸ªç”±obj \u0026hellip; final-obj ç»„æˆçš„list, ä¸R6RSçš„**cons***ç›¸åŒ\nmake-list(Chez) ç”¨æ³•ï¼š (make-list n) æˆ–è€… (make-list n obj) è¿”å›nä¸ªå¯¹è±¡çš„åˆ—è¡¨ã€‚næ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ å¦‚æœobjä¸æŒ‡å®šï¼Œåˆ™è¿”å›çš„listæ˜¯ä¸ç¡®å®šçš„\n(make-list 0 \u0026#39;()) =\u0026gt; () (make-list 3 0) =\u0026gt; (0 0 0) (make-list 2 \u0026#34;hi\u0026#34;) =\u0026gt; (\u0026#34;hi\u0026#34; \u0026#34;hi\u0026#34;) iota(Chez) ç”¨æ³•ï¼š(iota n) è¿”å›ä» 0ï¼ˆåŒ…å«ï¼‰åˆ° nï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨ï¼Œné¡»ä¸ºç²¾ç¡®çš„éè´Ÿæ•´æ•°\n(iota 0) =\u0026gt; () (iota 5) =\u0026gt; (0 1 2 3 4) enumerate(Chez) ç”¨æ³•ï¼š (enumerate ls) è¿”å›: ä» 0ï¼ˆåŒ…å«ï¼‰åˆ°é•¿åº¦ lsï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨\n(enumerate \u0026#39;()) =\u0026gt; () (enumerate \u0026#39;(a b c)) =\u0026gt; (0 1 2) (let ([ls \u0026#39;(a b c)]) (map cons ls (enumerate ls))) =\u0026gt; ((a . 0) (b . 1) (c . 2)) remq! | remv! | remove!(Chez) ç”¨æ³•ï¼š (remq! obj list) | (remv! obj list) | (remove! obj list) è¿”å›: åˆ—è¡¨ä¸­æ‰€æœ‰ obj éƒ½è¢«ç§»é™¤åçš„åˆ—è¡¨ è¿™äº›è¿‡ç¨‹ä¸ R6RS ä¸­çš„ remq, remv, åŠ remove è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯ remq!, remv! å’Œ remove! ä½¿ç”¨è¾“å…¥åˆ—è¡¨ä¸­çš„pairæ¥æ„æˆè¾“å‡ºåˆ—è¡¨ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„ç›¸åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(remq! \u0026#39;a \u0026#39;(a b a c a d)) â‡’ (b c d) (remv! #\\a \u0026#39;(#\\a #\\b #\\c)) =\u0026gt; (#\\b #\\c) (remove! \u0026#39;(c) \u0026#39;((a) (b) (c))) =\u0026gt; ((a) (b)) substq | substv | subst | substq! | substv! | subst!(Chez) ç”¨æ³•ï¼š (subs* new old tree) è¿”å›ï¼šåœ¨treeä¸­å°†åŒ¹é…åˆ°çš„oldå…ƒç´ å…¨éƒ¨æ›¿æ¢ä¸ºnewä¹‹åçš„tree. å¯¹äº substq å’Œ substq! ï¼Œç›¸ç­‰æ€§æµ‹è¯•æ˜¯åŸºäº eq?, substv å’Œ substv! æ˜¯åŸºäº eqv?, è€Œ subst å’Œ subst! æ˜¯åŸºäº equal? substq!, substv!, å’Œ subst! æ‰§è¡Œç ´åæ€§çš„æ›¿æ¢ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„å¯¹åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(substq \u0026#39;a \u0026#39;b \u0026#39;((b c) b a)) =\u0026gt; ((a c) a a) (substv 2 1 \u0026#39;((1 . 2) (1 . 4) . 1)) =\u0026gt; ((2 . 2) (2 . 4) . 2) (subst \u0026#39;a \u0026#39;(a . b) \u0026#39;((a . b) (c a . b) . c)) =\u0026gt; (a (c . a) . c) (let ([tr \u0026#39;((b c) b a)]) (substq! \u0026#39;a \u0026#39;b tr) tr) =\u0026gt; ((a c) a a) reverse! ç”¨æ³•ï¼š(reverse! list) è¿”å›ï¼šå°†åŸliståå‘è¾“å‡º reverse! é€šè¿‡åè½¬å…¶é“¾æ¥ç ´åæ€§åœ°åå‘æ’åºåˆ—è¡¨ã€‚ä»¥ reverse! å–ä»£ reverse å‡å°‘äº†ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”ä½¿ç”¨ reverse æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(reverse! \u0026#39;()) =\u0026gt; () (reverse! \u0026#39;(a b c)) =\u0026gt; (c b a) (let ([x \u0026#39;(a b c)]) (reverse! x) x) =\u0026gt; (a) (let ([x \u0026#39;(a b c)]) (set! x (reverse! x)) x) =\u0026gt; (c b a) append! ç”¨æ³•ï¼š(append! list \u0026hellip;) è¿”å›ï¼šå°†æ‰€æœ‰è¾“å…¥listä¸²è”èµ·æ¥çš„åˆ—è¡¨ å¦‚åŒ append, append! è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå…¶ä¸­å…ƒç´ ä¾æ¬¡ä¸ºç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬ä¸‰ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç­‰ç­‰ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ append! é‡ç”¨æ‰€æœ‰å‚æ•°ä¸­çš„ç‚¹å¯¹ä»¥æ„é€ æ–°åˆ—è¡¨ã€‚å³ï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨å‚æ•°çš„æœ€åä¸€ä¸ªcdr, å…¶åä¸€å…ƒç´ å˜ä¸ºæŒ‡å‘ä¸‹ä¸€ä¸ªåˆ—è¡¨å‚æ•°ã€‚é™¤æœ€åä¸€ä¸ªå‚æ•°å¤–ï¼Œå¦‚æœä»»ä¸€å‚æ•°ä¸ºç©ºåˆ—è¡¨ï¼Œå®ƒå®è´¨ä¸Šä¼šè¢«å¿½ç•¥ã€‚æœ€åä¸€ä¸ªå‚æ•°ï¼ˆå¹¶ä¸ä¸€å®šå¾—æ˜¯åˆ—è¡¨ï¼‰æ˜¯ä¸å˜çš„ã€‚\nç›¸æ¯”äº append, append! è¿›è¡Œæ›´å°‘çš„ç©ºé—´åˆ†é…ï¼ˆå› ä¸ºåªä¿®æ”¹æŒ‡é’ˆï¼Œå¹¶æ²¡æœ‰æ•°æ®æ‹·è´ï¼‰ï¼Œä½†å¹¶ä¸ä¸€å®šæ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(append! \u0026#39;(a b) \u0026#39;(c d)) =\u0026gt; (a b c d) (let ([x \u0026#39;(a b)]) (append! x \u0026#39;(c d)) x) =\u0026gt; (a b c d) (append \u0026#39;(1 2 (3 4)) \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) (append \u0026#39;(1 2 (3 4)) \u0026#39;() \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) ","id":102,"section":"posts","summary":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x))) (atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦","tags":["scheme"],"title":"Scheme/Chez Scheme å¯¹è±¡æ“ä½œ","uri":"https://lvsq.net/2019/12/operations-on-objects/","year":"2019"},{"content":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚\n(make-engine thunk)\né€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thunk(å½¢å®è½¬æ¢ç¨‹åº)ç»™make-engineæ¥åˆ›å»ºä¸€ä¸ªengineã€‚thunkçš„bodyæ˜¯ä¼šè¢«engineæ‰§è¡Œçš„è®¡ç®—ï¼Œengineæœ¬èº«æ˜¯å¸¦3ä¸ªå‚æ•°çš„è¿‡ç¨‹ï¼š\nticksï¼š ä¸€ä¸ªæ­£æ•´æ•°ï¼ŒæŒ‡å®šæä¾›ç»™engineçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼ˆåŸæ–‡ç”¨çš„æ˜¯fuelè¿™ä¸ªå•è¯ï¼Œæ„æ€æ˜¯ç‡ƒæ–™ï¼Œæ­£å¯¹åº”è¿™engineçš„æœ¬æ„ï¼Œååˆ†è´´åˆ‡ï¼‰çš„æ•°é‡ï¼Œengineå°†ä¼šæ‰§è¡Œåˆ°æ—¶é—´ç‰‡ç”¨å®Œæˆ–è€…è®¡ç®—å®Œæˆä¸ºæ­¢ï¼› completeï¼š ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç”¨äºæŒ‡å®šè®¡ç®—å®Œæˆåçš„æ“ä½œã€‚å®ƒçš„å‚æ•°æ˜¯å‰©ä½™çš„æ—¶é—´ç‰‡æ•°é‡å’Œè®¡ç®—äº§ç”Ÿçš„å€¼ï¼› expireï¼š ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æŒ‡å®šå¦‚æœåœ¨è®¡ç®—å®Œæˆä¹‹å‰æ—¶é—´ç‰‡ç”¨å®Œäº†è¯¥æ€ä¹ˆåŠã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªèƒ½ä»ä¸­æ–­ç‚¹ç»§ç»­è¿›è¡Œè®¡ç®—çš„æ–°å¼•æ“ã€‚ å°†å¼•æ“åº”ç”¨äºå…¶å‚æ•°æ—¶ï¼Œå®ƒå°†å¼€å¯ä¸€ä¸ªæ—¶é•¿ä¸ºticksçš„è®¡æ—¶å™¨ï¼Œå¦‚æœå¼•æ“è®¡ç®—åœ¨è®¡æ—¶å™¨æ‰§è¡Œä¹‹å‰å®Œæˆï¼Œç³»ç»Ÿå°†è°ƒç”¨completeï¼Œå¹¶å°†å‰©ä½™çš„tickså’Œè®¡ç®—äº§ç”Ÿçš„å€¼ä¼ é€’ç»™å®ƒï¼›\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœè®¡æ—¶å™¨åœ¨å¼•æ“è®¡ç®—å®Œæˆä¹‹å‰è€—å°½äº†ï¼Œåˆ™ç³»ç»Ÿä¼šä»ä¸­æ–­è®¡ç®—çš„continuationä¸­åˆ›å»ºä¸€ä¸ªæ–°å¼•æ“ï¼Œå¹¶ä½¿è¯¥å¼•æ“è¿‡æœŸã€‚completeå’Œexpireä¼šè¢«æ–°å¼•æ“ç»§ç»­ä½¿ç”¨ã€‚If, on the other hand, the timer goes off before the engine computation completes, the system creates a new engine from the continuation of the in- terrupted computation and passes this engine to expire. complete and expire are invoked in the continuation of the engine invocation.\nçœ‹çœ‹å…·ä½“çš„ä¾‹å­ï¼š\n(define eng (make-engine (lambda () 3))) (eng 10 ;; ticks (lambda (ticks value) value) ;; complete (lambda (x) x) ;; expire ) â‡’ 3 é€šå¸¸å°†åˆ—è¡¨ä½œä¸ºå®Œæ•´è¿‡ç¨‹ä¼ é€’ç»™å¼•æ“ï¼Œä½¿å¼•æ“å®Œæˆæ—¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å‰©ä½™çš„ticksï¼Œå¦ä¸€ä¸ªå…ƒç´ æ˜¯è®¡ç®—è¿”å›çš„å€¼ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚\n(define eng (make-engine (lambda () 3))) (eng 10 list (lambda (x) x)) â‡’ (9 3) åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè®¡ç®—å€¼ä¸º3ï¼Œè¿˜å‰©ä¸‹9ä¸ªæ—¶é—´ç‰‡ï¼Œå³ï¼Œéœ€è¦ä¸€å•ä½çš„æ—¶é—´ç‰‡æ¥è®¡ç®—å‡º3ã€‚\nå†çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼š å…ˆå®šä¹‰ä¸€ä¸ªè®¡ç®—è£´æ³¢é‚£åˆ‡å€¼çš„å‡½æ•°\n(define fibonacci (lambda (n) (let fib ([i n]) (cond [(= i 0) 0] [(= i 1) 1] [else (+ (fib (- i 1)) (fib (- i 2)))])))) åˆ›å»ºengine\n(define eng (make-engine (lambda () (fibonacci 10)))) (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ (21 55) æ¯æ¬¡æ—¶é—´ç‰‡ï¼ˆç‡ƒæ–™ï¼‰ç”¨å®Œæ—¶ï¼Œåˆ°æœŸç¨‹åºéƒ½ä¼šå°†engåˆ†é…ç»™æ–°å¼•æ“ã€‚æ•´ä¸ªè®¡ç®—éœ€è¦4ä¸ªblocksï¼Œæ¯ä¸ªblockåŒ…å«50ä¸ªticksã€‚æœ€å50ä¸ªç‡ƒæ–™ä¸­ï¼Œæœ‰21ä¸ªéƒ½ç”¨æ‰äº†ã€‚å› æ­¤ï¼Œä½¿ç”¨çš„ç‡ƒæ–™æ€»é‡ä¸º179ä¸ªã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ç»Ÿè®¡ä¸€ä¸‹æ¶ˆè€—çš„ticksæ•°é‡\n(define mileage (lambda (thunk) (let loop ([eng (make-engine thunk)] [total-ticks 0]) (eng 50 (lambda (ticks . values) (+ total-ticks (- 50 ticks))) (lambda (new-eng) (loop new-eng (+ total-ticks 50))))))) (mileage (lambda () (fibonacci 10))) â‡’ 179 å†çœ‹çœ‹ä¸€ä¸ªä¾‹å­â€”â€”round-robin:\n(define round-robin (lambda (engs) (if (null? engs) \u0026#39;() ((car engs) 1 ;;ticks (lambda (ticks value) (cons value (round-robin (cdr engs)))) ;;complete (lambda (eng) ;;expire (round-robin (append (cdr engs) (list eng)))))))) (round-robin (map (lambda (x) (make-engine (lambda () (fibonacci x)))) \u0026#39;(4 5 2 8 3 7 6 2))) â‡’ (1 1 2 3 5 8 13 21) è¿™æ®µä»£ç éœ€è¦è´¹äº›æ€é‡ï¼Œé¦–å…ˆmapå‡½æ•°åˆ›å»ºäº†8ä¸ªengine, ç„¶åä»£å…¥round-robinå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¾æ¬¡æ‰§è¡Œå„ä¸ªengineï¼Œä½†æ˜¯æ¯ä¸ªengineåˆ†é…çš„æ—¶é—´ç‰‡åªæœ‰1ï¼Œå¯¹äºå‚æ•°\u0026rsquo;(4 5 2 8 3 7 6 2)ï¼Œæ•°å­—è¶Šå°ï¼Œè¶Šå…ˆæ‰§è¡Œå®Œæˆï¼Œæ‰€ä»¥è¶Šæ—©æ‰§è¡Œcompleteå‡½æ•°ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯æ’å¥½é¡ºåºçš„äº†ï¼Œå¾ˆæ£’çš„ç¨‹åºï¼\n","id":103,"section":"posts","summary":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚ (make-engine thunk) é€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thun","tags":["engine","scheme"],"title":"Engine in Scheme","uri":"https://lvsq.net/2019/12/engine-in-scheme/","year":"2019"},{"content":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schemeæä¾›äº†caseè¯­æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œè¿™ä¸Javaä¸­çš„switchè¯­æ³•éå¸¸ç›¸ä¼¼ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹caseçš„è¯­æ³•ï¼š\n(case expr0 clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªclauseä¹‹å¤–ï¼Œæ¯ä¸ªå­å¥éƒ½å¿…é¡»é‡‡ç”¨ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š\n((key \u0026hellip;) expr1 expr2 \u0026hellip;) (key expr1 expr2 \u0026hellip;) æ¯ä¸€ä¸ªkeyå€¼éƒ½åº”è¯¥æ˜¯ä¸åŒçš„ï¼Œæœ€åä¸€ä¸ªå­å¥è¦ä¹ˆæ˜¯ä¸Šè¿°é‚£ç§å½¢å¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„elseå­å¥\n(else expr1 expr2 \u0026hellip;) é‚£ä¹ˆè¿”å›å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n(define p (lambda (x) (case x [(\u0026#34;abc\u0026#34; \u0026#34;def\u0026#34;) \u0026#39;one \u0026#39;1] [((a b c)) \u0026#39;two] [else #f]))) (p (string #\\d #\\e #\\f)) â‡’ 1 (p \u0026#39;(a b c)) â‡’ two (p \u0026#34;eee\u0026#34;) â‡’ #f ä¸Šé¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°pï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°x\nå¦‚æœxä¸ºå­—ç¬¦ä¸²\u0026quot;abc\u0026quot;æˆ–è€…\u0026quot;def\u0026quot;ï¼Œåˆ™è¿”å›1ï¼› å¦‚æœxä¸ºåˆ—è¡¨((a b c)ï¼Œåˆ™è¿”å›two å…¶ä»–æƒ…å†µè¿”å›#f å¯è§ï¼Œæœ‰äº†caseè¯­æ³•å¤šæ¡ä»¶åˆ¤æ–­å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šï¼Œå¹¶ä¸”ä»£ç ä¹Ÿå®¹æ˜“è¯»äº†ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç”¨condæ¥å†™ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æè¿°caseçš„è¯­æ³•è€Œæ²¡æœ‰ä½¿ç”¨cond\nå†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ï¼š\n(let ([ls \u0026#39;(ii iv)]) (case (cadr ls) [i 1] [ii 2] [iii 3] [(iiii iv) 4] [else \u0026#39;out-of-range])) â‡’ 4 record-case æ¥çœ‹çœ‹å¦ä¸€ä¸ªå¾ˆç±»ä¼¼çš„æ‰©å±•ï¼Œä¹Ÿååˆ†æœ‰ç”¨ï¼Œå®ƒå°±æ˜¯record-caseã€‚å®ƒå¯ä»¥ä»¥recordä¸ºå•ä½æ¥åšæ¡ä»¶åˆ¤æ–­å¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚\nè¯­æ³•æ ¼å¼ï¼š (record-case expr clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªå­å¥ä¹‹å¤–ï¼Œæ¯ä¸ªclauseçš„æ ¼å¼å¦‚ä¸‹ï¼š\n((key \u0026hellip;) formals body1 body2 \u0026hellip;)\næ¯ä¸€ä¸ªkeyéƒ½ä¸åº”è¯¥ç›¸åŒ, æœ€åä¸€ä¸ªclauseå¯èƒ½æ˜¯ä¸Šè¿°çš„æ ¼å¼æˆ–è€…æ˜¯ä¸€ä¸ªelseå­å¥ï¼š\n(else body1 body2 \u0026hellip;)\nexprå¿…é¡»æ˜¯ä¸€ä¸ªpairã€‚Chezä¼šæ‹¿(car expr)ä¸å„ä¸ªå­å¥ä¸­çš„keyè¿›è¡Œæ¯”è¾ƒï¼ˆç”¨eqv?ï¼‰æ¥ç¡®å®šå“ªä¸€ä¸ªclauseåŒ¹é…, ç„¶å(cdr expr)å°†ä¸formalsç»‘å®šã€‚\næ¥çœ‹æ¢ä¸€ä¸ªä¾‹å­ï¼š\n(define calc (lambda (x) (record-case x [(add) (x y) (+ x y)] [(sub) (x y) (- x y)] [(mul) (x y) (* x y)] [(div) (x y) (/ x y)] [else (assertion-violationf \u0026#39;calc \u0026#34;invalid expression ~s\u0026#34; x)]))) (calc \u0026#39;(add 3 4)) =\u0026gt; 7 (calc \u0026#39;(div 3 4)) =\u0026gt; 3/4 ","id":104,"section":"posts","summary":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schem","tags":["chez","scheme"],"title":"Chez Schemeä¸­çš„caseæ‰©å±•","uri":"https://lvsq.net/2019/12/case-in-chez-scheme/","year":"2019"},{"content":" æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´è‡³ï¼Œå…‹å°½å…¶ç”¨ï¼Œä¸Šä¸‹ä¸€ä½“ï¼Œä¿±ä¸å€¦è€Œäº‹å¯æ¯•çŸ£\nå‘¨äº‘æˆåº·ï¼Œæ±‰è¨€æ–‡æ™¯ã€‚æ— æœ‰å…­åå¹´ä¸æ°‘ä¼‘æ¯ï¼Œç´¯è—è“„ç§¯ï¼Œæ±‰æ­¦å¼€ç–†ä¹‹åŠŸä¾¿æ˜¯ç©ºæ–‡ï¼Œæ­¤åšç§¯è–„å‘è€³ï¼Œä¿—è¯­è¨€ï¼Œèƒ³è†Šæ”¶å›æ¥ï¼Œæ‰“å‡ºå»æ‰æœ‰åŠ›\næ­¦å¸ä¸€ä»£é›„ä¸»ï¼Œæ–‡æ²»æ­¦åŠŸï¼Œå¥‹é«˜ç¥–ä¹‹ä½™çƒˆï¼Œæ‰¿ä¸‰ç‹ä¹‹åœ£ç»ªï¼Œå¼€ä¸‡ä¸–ä¸æ‹”ä¹‹åŸºï¼Œå¾å›½æ–¯æ°‘ä¹‹å¹¸ï¼Œé“­è®°æ±‰é’\n","id":105,"section":"posts","summary":"æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´","tags":["éšæƒ³"],"title":"ç»§å­¦å½•","uri":"https://lvsq.net/2019/12/think/","year":"2019"},{"content":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚\nå…ˆçœ‹çœ‹è¯¥è¯­æ³•æè¿°ï¼š (fluid-let ((var expr) \u0026hellip;) body1 body2 \u0026hellip;) returns: the values of the body body1 body2 \u0026hellip; libraries: (chezscheme)\nè¯¥Bindingçš„ä½œç”¨ç±»ä¼¼å±€éƒ¨å˜é‡ï¼Œä¸set! æ¯”è¾ƒç›¸ä¼¼ã€‚ç”±fluid-letå®šä¹‰çš„å˜é‡å¿…é¡»å·²ç»‘å®šåˆ°é¡¶å±‚(top level)æˆ–è€…å°é—­çš„lambdaå†…æˆ–è€…å…¶ä»–å½¢å¼çš„ç»‘å®šï¼Œè¿™å¾ˆå…³é”®ï¼\nè¯·çœ‹ä»£ç ï¼š\n(let ([x 3]) (+ (fluid-let ([x 5]) x) x)) â‡’ 8 å…ˆå®šä¹‰å˜é‡x=3ï¼Œç„¶ååœ¨åŠ æ³•æ“ä½œå½“ä¸­ä¸´æ—¶å°†xçš„å€¼æ”¹ä¸º5ï¼Œæœ€åç»“æœä¸º8ï¼Œå¦‚æœå°†fluid-letä¸­çš„xæ¢ä¸ªåå­—ï¼Œæ¯”å¦‚yï¼Œå°†å¦‚ä½•å‘¢ï¼Ÿ ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼š\nException: variable y is not bound\nyæ²¡æœ‰ç»‘å®šï¼Œæ˜¯çš„ï¼Œyå³æ²¡æœ‰åœ¨é¡¶å±‚ä¸­è¢«å®šä¹‰ï¼Œä¹Ÿæœªåœ¨æŸä¸ªlambdaä¸­æˆ–è€…ä»»ä½•å…¶ä»–å½¢å¼ï¼Œè¿™é‡Œåªèƒ½æ˜¯x\nå†å­¦ä¹ ä¸‹ä¸¤ä¸ªä¾‹å­ï¼ŒåŠ æ·±å°è±¡ï¼š\n(let ([x \u0026#39;a]) (letrec ([f (lambda (y) (cons x y))]) (fluid-let ([x \u0026#39;b]) (f \u0026#39;c)) )) â‡’ (b . c) (let ([x \u0026#39;a]) (call/cc (lambda (k) (fluid-let ([x \u0026#39;b]) (letrec ([f (lambda (y) (k \u0026#39;*))]) (f \u0026#39;*))))) x) â‡’ a Fluid Bindingå®é™…ä¸Šæ˜¯Schemeå¯¹Dynamic Scopingçš„ä¿ç•™ï¼ŒSchemeä½¿ç”¨çš„æ˜¯Lexical Scopingï¼Œ å¯¹äºè¿™ä¸¤ç§Scopingæ›´è¯¦ç»†çš„æè¿°å¯å‚è€ƒLexical Scoping and Dynamic Scoping\n","id":106,"section":"posts","summary":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚ å…ˆçœ‹çœ‹è¯¥è¯­æ³•æ","tags":["fluid-let","Scheme"],"title":"Fluid Binding in Chez Scheme","uri":"https://lvsq.net/2019/12/fluid-binding/","year":"2019"},{"content":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚\nè¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec var expr) syntax returns: value of expr libraries: (chezscheme)\nThe syntactic form rec creates a recursive object from expr by establishing a binding of var within expr to the value of expr. In essence, it is a special case of letrec for self-recursive objects.\nThis form is useful for creating recursive objects (especially procedures) that do not depend on external variables for the recursion, which are sometimes undesirable because the exter-nal bindings can change. For example, a recursive procedure defined at top level depends on the value of the top-level variable given as its name. If the value of this variable should change, the meaning of the procedure itself would change. If the procedure is defined instead with rec, its meaning is independent of the variable to which it is bound.\nç®€è¦ç¿»è¯‘ä¸€ä¸‹ï¼š è¯­æ³•rec é€šè¿‡åœ¨exprä¸­å»ºç«‹varä¸exprçš„å€¼çš„ç»‘å®šï¼Œåˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ˜¯letrecç”¨äºè‡ªé€’å½’å¯¹è±¡çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚\nè¯­æ³•recé€šè¿‡ç»‘å®šexprä¸­åˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ï¼Œç”¨æ¥ è¿™ç§å½¢å¼å¯¹äºåˆ›å»ºä¸ä¾èµ–äºå¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’çš„é€’å½’å¯¹è±¡ï¼ˆå°¤å…¶æ˜¯è¿‡ç¨‹ï¼‰å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤–éƒ¨ç»‘å®šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥æœ‰æ—¶è¿™æ˜¯ä¸å¯å–çš„ã€‚\nçœ‹ä¸€ä¸ªä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹ï¼š ç»™å®šä¸€ä¸ªå…¨æ˜¯æ•°å­—çš„listï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°å­—nï¼Œç®—å‡º$1+2+\u0026hellip;+n$çš„å’Œï¼Œæœ€ç»ˆè¿”å›å’Œçš„list.\n(map (rec sum (lambda (x) (if (= x 0) 0 (+ x (sum (- x 1)))))) â€™(0 1 2 3 4 5)) â‡’ (0 1 3 6 10 15) å¦‚æœæ²¡æœ‰recè¯­æ³•ï¼Œç”¨letrecä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç¨æ˜¾éº»çƒ¦ï¼Œä»£ç ä¹Ÿå¤šä¸€äº›ï¼Œæ‰€ä»¥recè¿˜æ˜¯å¾ˆå¥½ç”¨çš„\næœ€åçœ‹ä¸€ä¸‹recè¯­æ³•çš„å®šä¹‰ï¼š\n(define-syntax rec (syntax-rules () [(_ x e) (letrec ((x e)) x)])) ","id":107,"section":"posts","summary":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚ è¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec","tags":["Scheme","Chez","rec"],"title":"Recursive Bindings in Chez Scheme","uri":"https://lvsq.net/2019/12/recursive-bindings/","year":"2019"},{"content":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´ï¼ŒåŠ¨æ‰‹å†™äº†ä¸€ä¸ªï¼Œç›®å‰å·²ç»åœ¨å…¬å¸å†…éƒ¨è¿è¡Œäº†å‡ å¹´ï¼Œæ•ˆæœè‰¯å¥½ï¼Œå¹¶ä¸”å·²ç»å¼€æºåœ¨Githubä¸Šï¼Œä»¥é£¨å„ä½ã€‚\nç‰¹ç‚¹ï¼š\nAPIç®€æ´\næ”¯æŒ3ç§äº‹ä»¶ï¼š\nUP DOWN JOIN åŸºäºVert.X\nå¼•å…¥ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;net.lvsq\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jgossip\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\nint gossip_port = 60001; String cluster = \u0026#34;gossip_cluster\u0026#34;; GossipSettings settings = new GossipSettings(); settings.setGossipInterval(1000); try { String myIpAddress = InetAddress.getLocalHost().getHostAddress(); List\u0026lt;SeedMember\u0026gt; seedNodes = new ArrayList\u0026lt;\u0026gt;(); SeedMember seed = new SeedMember(); seed.setCluster(cluster); seed.setIpAddress(myIpAddress); seed.setPort(60001); seedNodes.add(seed); gossipService = new GossipService(cluster, myIpAddress, gossip_port, null, seedNodes, settings, (member, state) -\u0026gt;System.out.println(\u0026#34;member:\u0026#34; + member + \u0026#34; state: \u0026#34; + state)); } catch (Exception e) { e.printStackTrace(); } gossipService.start(); è¯¦ç»†ä»‹ç»è¯·çœ‹ =\u0026gt; é¡¹ç›®åœ°å€\næ¬¢è¿å¤§å®¶forkï¼Œ å¦‚æœè§‰å¾—å¥½è¯·start ~~~\n","id":108,"section":"posts","summary":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›","tags":["jgossip","gossip"],"title":"Jgossip - gossipåè®®çš„å¼€æºå®ç°","uri":"https://lvsq.net/2019/12/jgossip/","year":"2019"},{"content":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ \nGolangçš„å®ç°ï¼š\n/** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result := \u0026amp;ListNode{} nodes := []*ListNode{} var carry = 0 for { node, c := add(l1, l2, carry) carry = c if node != nil { nodes = append(nodes, node) if l1 != nil \u0026amp;\u0026amp; l1.Next != nil { l1 = l1.Next } else { l1 = nil } if l2 != nil \u0026amp;\u0026amp; l2.Next != nil { l2 = l2.Next } else { l2 = nil } if carry \u0026gt; 0 \u0026amp;\u0026amp; (l1 == nil \u0026amp;\u0026amp; l2 == nil) { nodes = append(nodes, \u0026amp;ListNode{Val:carry}) } } else { break } } for i, n := range nodes{ if i == 0 { result = n } if i + 1 \u0026lt; len(nodes) { n.Next = nodes[i + 1] } } return result } func add (n1 *ListNode, n2 *ListNode, carry int) (*ListNode, int) { node := \u0026amp;ListNode{} if (n1 == nil \u0026amp;\u0026amp; n2 == nil) { return nil, 0 } if n1 == nil { n1 = \u0026amp;ListNode{Val : 0} } if n2 == nil { n2 = \u0026amp;ListNode{Val : 0} } sum := n1.Val + n2.Val + carry carry = 0 if sum \u0026gt; 9 { carry = 1 sum = sum - 10 } node.Val = sum return node, carry } ä¸‹é¢æä¾›Schemeç‰ˆæœ¬çš„å®ç°ã€(1 0) + (9 1 2) = (0 2 2)ã€‘ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œä¸é¢˜ç›®è¦æ±‚ç¨æœ‰ä¸åŒï¼Œè¿™é‡Œé‡‡ç”¨listï¼Œè€Œä¸æ˜¯é¢˜ç›®è¦æ±‚çš„é“¾è¡¨ï¼Œä½†å®é™…ä¸Šåº”æ˜¯ä¸€æ ·çš„ã€‚æ¯”è¾ƒä¹‹ä¸‹å¯ä»¥çœ‹å‡ºï¼Œç›¸å¯¹è€Œè¨€ï¼ŒSchemeè¯­è¨€çš„å®ç°æ›´åŠ ç®€çŸ­ä¼˜é›…ï¼Œå¾—ç›Šäºå…¶å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›\n(letrec ( [Polishing (lambda (l num) (if (eq? num 0) l (Polishing (append l \u0026#39;(0)) (- num 1))) ) ] [Align (lambda (l1 l2) (let ([len1 (length l1)] [len2 (length l2)]) (if [eq? len1 len2] [list l1 l2] [if (\u0026gt; len1 len2) (list l1 (Polishing l2 (- len1 len2))) (list (Polishing l1 (- len2 len1)) l2)])) ) ] [Add (lambda (l1 l2) (let ([ l (Align l1 l2)]) (Carry (map (lambda (x y) (+ x y)) (car l) (cadr l)) 0) ) ) ] [Carry (lambda (l c) (if (null? l) (if [eq? c 0] \u0026#39;() [cons c l]) (cons (mod ( + (car l) c ) 10) (Carry (cdr l) (quotient ( + (car l) c) 10))) ) ) ]) (Add \u0026#39;(1 0) \u0026#39;(9 1 2))) Golangç‰ˆæœ¬å’ŒSchemeç‰ˆæœ¬çš„å®ç°æ€è·¯ä¸ç›¸åŒï¼Œç®€è¦æè¿°ä¸€ä¸‹åè€…ï¼š\n(1 0) + (9 1 2), å…ˆè¿›è¡Œè¡¥ä½ï¼š (1 0 0) + (9 1 2), æŒ‰é¡ºåºç›¸åŠ ï¼Œå¾—ï¼š (10 1 2), å†è®¡ç®—è¿›ä½ï¼š (0 2 2) ","id":109,"section":"posts","summary":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ  Golangçš„å®ç°ï¼š /** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result","tags":["Scheme","leetcode"],"title":"ä¸¤æ•°ç›¸åŠ ","uri":"https://lvsq.net/2019/12/leetcode-2/","year":"2019"},{"content":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘ã€‚\né—®é¢˜æè¿° å‡è®¾æˆ‘ä»¬å·²ç»æœ‰è¶³å¤Ÿå¤šçš„1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†é’±å¸ï¼Œä»»æ„ç»™å®šé‡‘é¢æ¯”å¦‚1å…ƒï¼Œé—®æœ‰å¤šå°‘ç§ç»„åˆæ–¹å¼ï¼Ÿ æ¢è¨€ä¹‹ï¼Œ$$1x+2y+5z = 100$$ æ±‚x,y,zçš„è§£æœ‰å¤šå°‘ä¸ª\næ€è·¯ ç»„åˆæ–¹å¼çš„æ€»å’Œåº”ä¸ºï¼š\nä»»æ„æ‰£å»ä¸€ç§é’±å¸æ¯”å¦‚1åˆ†ï¼Œ1å…ƒé‡‡ç”¨2åˆ†ï¼Œ5åˆ†ä¸¤ç§é’±å¸çš„ç»„åˆæ•°ï¼Œå†åŠ ä¸Šï¼š\næ€»é¢ä¸ºï¼ˆ1å…ƒ-1åˆ†ï¼‰ï¼Œé‡‡ç”¨1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†ä¸‰ç§é’±å¸çš„ç»„åˆæ•°ï¼›\nå¾ˆæ˜æ˜¾è¿™å¯ä»¥å¾ˆå®¹æ˜“ç”¨é€’å½’å®ç°\nç¨ä½œä¸€ç‚¹è§£é‡Šï¼š\na. ä¸Šé¢ä¸¤æ­¥çš„æ„æ€æ˜¯ï¼šä¸å¸¦1åˆ†çš„ç»„åˆæ•° + å¸¦1åˆ†çš„ç»„åˆæ•° = å…¨éƒ¨çš„ç»„åˆæ•°ï¼› è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„\nb. ä¸Šè¿°ç¬¬2æ­¥ï¼Œï¼ˆ1å…ƒ-1åˆ†ï¼‰çš„æ„æ€æ˜¯ï¼šè¿™æ ·å¯ä»¥ä¿è¯ä»»æ„ä¸€ç§ç»„åˆæ–¹å¼å†åŠ 1åˆ†éƒ½ç­‰äº1å…ƒï¼Œä¿è¯è‡³å°‘æœ‰1ä¸ª1åˆ†çš„é’±å¸\n(letrec [ (A (lambda (n d) (if (= 0 (mod n d)) 1 0))) (B (lambda (n d) (cond [(not (pair? d)) 0] [(null? d) 0] [(= 0 n) 1] [(\u0026gt; 0 n) 0] [(= 1 (length d)) (A n (car d))] [else ( + (B n (cdr d)) (B (- n (car d)) d)) ] ) ) ) ] [B 100 \u0026#39;(1 2 5)] ) ","id":110,"section":"posts","summary":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘","tags":["Scheme","SICP"],"title":"é’±å¸ç»„åˆé—®é¢˜","uri":"https://lvsq.net/2019/12/count-coins/","year":"2019"},{"content":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quot;x-\u0026quot;ï¼‰è¯¥å¦‚ä½•å¼€å‘åšç´§è¦çš„ä»‹ç»ã€‚\nä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œæœ‰ä¸€ç‚¹éœ€è¦keep in mindï¼Œå³å¢åŠ æ‰©å±•çš„ä½ç½®ä¸åŒï¼Œæ‰€ç”¨çš„æ–¹æ³•ä¸åŒï¼Œæ‰€ä»¥éœ€è¦å¯¹Swaggerçš„æ ‡å‡†æœ‰æ‰€äº†è§£ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ springfoxç›®å‰åªå…è®¸ä¸‰ç§æ‰©å±•å®ç°:\nListVendorExtension:åˆ—è¡¨çš„å½¢å¼,è¯¥å¯¹è±¡æ”¯æŒæ³›å‹ï¼Œæœ€ç»ˆå½¢å¼ï¼šâ€x-fieldâ€:[{field:value}] ObjectVendorExtension:å¯¹è±¡çš„æ‰©å±•å½¢å¼,æœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯ï¼šâ€x-fieldâ€:[{field:value}] StringVendorExtension:stringç±»å‹çš„æ‰©å±•å®ç°ï¼Œæœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯â€x-fieldâ€:â€valueâ€ Swaggeræ ¹å¯¹è±¡æ‰©å±• ä»¥åœ¨infoä¸­æ·»åŠ ä¸€ä¸ªx-logoä¸ºä¾‹\n\u0026#34;info\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;swagger-bootstrap-uiï¼ï¼ï¼\u0026#34;, \u0026#34;termsOfService\u0026#34;: \u0026#34;http://www.xxx.com/\u0026#34;, \u0026#34;contact\u0026#34;: { \u0026#34;name\u0026#34;: pxxxx@domain.com\u0026#34; }, \u0026#34;x-logo\u0026#34;: { \u0026#34;url\u0026#34;: \u0026#34;http://\u0026#34;, \u0026#34;color\u0026#34;: \u0026#34;#090807\u0026#34; } }, ... åå°ä»£ç ï¼š\nObjectVendorExtension logo = new ObjectVendorExtension(\u0026#34;x-logo\u0026#34;); logo.addProperty(new StringVendorExtension(\u0026#34;url\u0026#34;, \u0026#34;https://xxx.svg\u0026#34;)); logo.addProperty(new StringVendorExtension(\u0026#34;color\u0026#34;, \u0026#34;#090807\u0026#34;)); return new ApiInfoBuilder() .title(\u0026#34;swagger-bootstrap-uiï¼ï¼\u0026#34;) .extensions(Lists.newArrayList(logo)) .description(\u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;) .termsOfServiceUrl(\u0026#34;http://www.xxx.com/\u0026#34;) .version(\u0026#34;1.0.0\u0026#34;) .build(); å†…éƒ¨å¯¹è±¡æ‰©å±• ç»™Pathæ·»åŠ ä¸€ä¸ªæ‰©å±•å±æ€§x-orderä¸ºä¾‹\n@Component @Order(Ordered.HIGHEST_PRECEDENCE+100) public class OperationPositionBulderPlugin implements OperationBuilderPlugin { @Override public void apply(OperationContext context) { context.operationBuilder().extensions(Lists.newArrayList(new StringVendorExtension(\u0026#34;x-order\u0026#34;,\u0026#34;1\u0026#34;))); } @Override public boolean supports(DocumentationType delimiter) { return true; } } è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ\n","id":111,"section":"posts","summary":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quo","tags":["swagger","vendorExtensions"],"title":"Swagger å¦‚ä½•ä½¿ç”¨vendorExtensionsè¿›è¡Œæ‰©å±•","uri":"https://lvsq.net/2019/11/swagger-vendor/","year":"2019"},{"content":" ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹ï¼Œå¦‚å¹³åŸå›å¹¿çº³å¼‚å›½å®¾å®¢ï¼›è‹ç§¦ä¸Šä¹¦äºä¸ƒå›½ï¼›è€å­éæ¸¸å¤©ä¸‹è€…çš†å¯è¯å„å›½æ–‡å­—å¹¶æ— å¤§ä¹–ã€‚ ã€Šå²ç±€ç¯‡ã€‹æ–‡é¦–ç›–äº‘â€œå¤ªå²ç±€ä¹¦â€ï¼Œäººå¤šè¯¯ä»¥å¤ªå²ç±€æ‰€ä½œï¼Œå¦‚æ­¤ä¾¿æœ›æ–‡ç”Ÿä¹‰äº†ã€‚å¤ªå²ä¹ƒå®˜èŒï¼Œç‹å›½ç»´å…ˆç”Ÿå¼•ã€Šè¯´æ–‡ã€‹è§£é‡Šï¼Œç±€å³è¯»ï¼Œè¯»å³ç±€ä¹¦ã€‚å¦å¤ªå²ç±€ä¹¦ä¹ƒå‘¨ä¸–ä¹‹æˆè¯­ï¼Œç»éäººåã€‚ è¿‘æ—¥å¾—é—»æ±‰æ–‡å¸éœ¸é™µè¢«å‘ç°ï¼Œè‡ªå…ƒä»¥é™ï¼Œè°¬ä¼ éœ¸é™µåœ¨å‡¤å‡°å˜´ï¼Œå¦‚ä»Šå¾—ä»¥ç¡®è®¤ï¼Œæ­¤æ¡ˆç»ˆäºå‹¾é”€ã€‚ã€Šæ±‰ä¹¦.æ–‡å¸çºªã€‹è½½ï¼šâ€œä¹™å·³ï¼Œè‘¬éœ¸é™µâ€ã€‚å‡¤å‡°å˜´ä¹Ÿå¥½ï¼Œæ±Ÿæ‘ä¹Ÿç½¢ï¼Œåœ¨å²ä¹¦ä¸Šåªæ˜¯ä¸€è¡Œå­—ã€‚å‘¨çŸ¥å…¬å…ƒå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå½“æ—¶æœ‰ä¸ªâ€œå«å›½â€å¹¶æœªç»Ÿä¸€ï¼Œä½†æ˜¯å²ä¹¦ä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå«å›½é™¤å¤–ã€‚â€ï¼›960å¹´ï¼Œå®‹æœç»Ÿä¸€ä¸­åŸï¼Œä½†æ˜¯ç°åœ¨çš„æ±Ÿæµ™åœ°åŒºè¿˜å­˜åœ¨ä¸€ä¸ªâ€œå´è¶Šå›½â€ï¼Œè¿‡äº†18å¹´æ‰çŒ®åœŸå…¥å®‹ï¼Œå²ä¹¦ä¹Ÿä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œ960å¹´ï¼Œå®‹æœ‰ä¸­å›½ï¼Œå´è¶Šé™¤å¤–â€ã€‚å«å›½å’Œå´è¶Šéƒ½åªæ˜¯å²ä¹¦ä¸Šçš„ä¸€è¡Œå­—ï¼Œè¿™å°±æ˜¯å†å²çš„çœ‹æ³•ã€‚1949å¹´ï¼Œå…±äº§å…šç»Ÿä¸€äº†ä¸­å›½ï¼Œå°æ¹¾å­¤æ‚¬ä¸€éš…ï¼Œå…¶å¤„å¢ƒå’Œå‰è€…æ¯”ç…§å¹¶æ— äºŒè‡´ï¼Œå°†æ¥å²ä¹¦ä¸Šçš„å°æ¹¾ä¹Ÿåªæ˜¯ä¸€è¡Œå­—ã€‚ ","id":112,"section":"posts","summary":"ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹","tags":["æ–‡å²"],"title":"å†å²ä¸èƒ½ç¢°","uri":"https://lvsq.net/2019/11/do-not-touch-history/","year":"2019"},{"content":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»åŠ¨8ä¸ªå­—ç¬¦ C-x C-f æŸ¥æ‰¾æˆ–è€…æ–°å»ºä¸€ä¸ªæ–‡ä»¶ C-x C-b åˆ—å‡ºç¼“å†²åŒºã€‚ C-x 1 å…³é—­ç¼“å†²åŒºåˆ—è¡¨ã€‚å°†éœ€è¦åˆ é™¤çš„ç¼“å†²åŒºæ ‡â€œdâ€(é€‰ä¸­ï¼ŒæŒ‰d),ç„¶åæŒ‰â€œxâ€æ‰§è¡Œåˆ é™¤æ ‡è®°çš„æ‰€æœ‰ç¼“å†²åŒº C-x b åˆ‡æ¢ç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºåå­—ï¼ŒRET C-x C-q å¼€å¯æˆ–è€…å…³é—­bufferçš„åªè¯»æ¨¡å¼ C-x k å…³é—­å½“å‰ç¼“å†²åŒº C-x C-s ä¿å­˜å½“å‰æ–‡ä»¶ C-x s ä¿å­˜æ‰€æœ‰æ–‡ä»¶ C-x h å…¨é€‰ M-w å¤åˆ¶ C-y ç²˜è´´ C-w å‰ªåˆ‡ C-s å¾€å‰æœç´¢ C-r å¾€åæœç´¢. DEL ä¹Ÿå¯ä»¥å¾€åæœç´¢ï¼Œ C-/ undo M-x calendar æ‰“å¼€æ—¥å†ã€‚æŒ‰ q é€€å‡ºã€‚ã€g d åˆ°æŒ‡å®šæ—¥æœŸã€‘ã€. åˆ°ä»Šæ—¥ï¼ˆä¸å±…ä¸­ï¼‰ã€‘ã€\u0026gt; å‰ä¸€ä¸ªæœˆã€‘ã€\u0026lt; åä¸€ä¸ªæœˆã€‘ M-x *-mode é€‰æ‹©Major mode M-x shell è¿è¡Œä¸€ä¸ªshell M-x eshell è¿è¡Œä¸€ä¸ªeshell C-a ç§»åˆ°è¡Œé¦– C-a C-kã€C-S-backspace åˆ é™¤æ•´è¡Œ C-u 5 C-S-backspaceã€M-5 C-S-backspace åˆ é™¤å5è¡Œï¼Œä¸åŠ æ•°å­—åˆ™åˆ é™¤4è¡Œï¼ˆé»˜è®¤ï¼‰ï¼Œå¦‚æœæ•°å­—ä¸ºè´Ÿæ•°ï¼Œåˆ™å¾€å‰åˆ  C-g åœæ­¢å½“å‰çš„å‘½ä»¤ C-k åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°è¡Œå°¾æ‰€æœ‰å­—ç¬¦ M-% æŸ¥æ‰¾åŠæ›¿æ¢ã€‚è¾“å…¥è¦è¢«æ›¿æ¢çš„è¯ï¼Œå›è½¦ï¼Œç„¶åè¾“å…¥è¦æ›¿æ¢çš„è¯ï¼Œå†å›è½¦ã€‚è¾“å…¥==y==æ›¿æ¢å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==n==å¿½ç•¥å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==q==ç»“æŸï¼Œ è¾“å…¥ ==!== æ›¿æ¢å‰©ä¸‹çš„å…¨éƒ¨ M-x occur RET xxx RET æ–°å¼€ä¸€ä¸ªçª—å£æ¥åˆ—å‡ºåŒ¹é…çš„è¡Œï¼Œç‚¹å‡»å°±ä¼šè·³è½¬åˆ°å¯¹åº”çš„ä½ç½®ï¼Œç¼–ç¨‹æ—¶æœ‰ç”¨ C-x C-t å½“å‰è¡Œä¸ä¸Šä¸€è¡Œæ¢ä½ç½® Org-Mode å¿«æ·é”® ç”¨é€” C-c . æ’å…¥æ—¶é—´ C-c C-e å¯¼å‡ºå…¶å®ƒæ ¼å¼ C-c C-s åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==SCHEDULED==â€å…³é”®å­—çš„æ—¶é—´æˆ³ã€‚ C-c C-d åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==DEADLINE==â€å…³é”®å­—çš„æ—¶é—´æˆ³ C-c C-t å°†å½“å‰é¡¹çš„çŠ¶æ€åœ¨ï¼ˆunmarkedï¼‰-\u0026gt;TODO-\u0026gt;DONE ä¹‹é—´å¾ªç¯åˆ‡æ¢ M-RET æ’å…¥ä¸€ä¸ªåŒçº§æ ‡é¢˜ M-LEFT/RIGHT å°†å½“å‰çš„æ ‡é¢˜æå‡/é™ä½ä¸€ä¸ªç­‰çº§ C-c C-c æ’å…¥æ ‡ç­¾tagã€‚ å…‰æ ‡åœ¨æ ‡é¢˜ä¸­ C-c C-q æ’å…¥æ ‡ç­¾tagã€‚å…‰æ ‡åœ¨ä»»æ„ä½ç½® C-c , è®¾ç½®å½“å‰æ ‡é¢˜çš„ä¼˜å…ˆçº§,â€™Aâ€˜ã€â€™Bâ€˜å’Œâ€™Câ€˜ã€‚â€™Aâ€˜æ˜¯æœ€é«˜çº§åˆ«ï¼Œå¦‚ä¸æŒ‡å®šï¼Œâ€™Bâ€˜æ˜¯é»˜è®¤çš„ C-c \\ æŸ¥æ‰¾æ ‡ç­¾tag S-Tab å±•å¼€æ‰€æœ‰æ ‡é¢˜ Tab å±•å¼€å…‰æ ‡æ‰€åœ¨æ ‡é¢˜ [==[== Link ==][== Description]==]== åˆ›å»ºé“¾æ¥ C-c C-l ç¼–è¾‘é“¾æ¥ C-c C-o æ‰“å¼€é“¾æ¥ C-c | (ç«–çº¿ï¼Œnot L) è¾“å…¥ åˆ— x è¡Œï¼Œ æ’å…¥ä¸€ä¸ªè¡¨æ ¼ [/] æˆ–è€… [%] é€šè¿‡åœ¨TODOé¡¹ç›®ä¸‹æ–°å»ºä¸€ä¸ªå¤§çº²æ ‘ï¼Œå¹¶åœ¨å­æ ‘ä¸Šæ ‡è®°å­ä»»åŠ¡æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸ºäº†èƒ½å¯¹å·²ç»å®Œæˆçš„ä»»åŠ¡æœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼Œä½ å¯ä»¥åœ¨æ ‡é¢˜çš„ä»»ä½•åœ°æ–¹æ’å…¥â€˜[/]â€™æˆ–è€…â€˜[%]â€™ã€‚å½“æ¯ä¸ªå­ä»»åŠ¡çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæˆ–è€…å½“ä½ åœ¨æ ‡è®°ä¸ŠæŒ‰ C-c C-æ—¶ï¼Œè¿™äº›æ ‡è®°çŠ¶æ€ä¹Ÿä¼šéšä¹‹æ›´æ–° \u0026lt;s Tab å¼€å¯ä¸€ä¸ªä»£ç å—ã€‚ #+begin_src c -n -t -h 7 -w 40: cä¸ºæ‰€æ·»åŠ çš„è¯­è¨€,-n æ˜¾ç¤ºè¡Œå·,-t æ¸…é™¤æ ¼å¼,-h 7 è®¾ç½®é«˜åº¦ä¸º7 -w 40è®¾ç½®å®½åº¦ä¸º40 C-c ' æ‰“å¼€ä¸€ä¸ªbuffer, è¾“å…¥ä»£ç ï¼Œå†æŒ‰ä¸€æ¬¡å¿«æ·é”®ï¼Œå°†ä»£ç å†™å…¥buffer C-c C-c è¿è¡Œæºä»£ç ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªRESULTå— å†…å®¹å…ƒæ•°æ® è¯¦æƒ…è§æ–‡å Markdown-Mode å¿«æ·é”® ç”¨é€” C-c C-c p ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-c v ç”Ÿæˆ basename.html å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-a u æ’å…¥=\u0026lt;\u0026gt;=è¿™æ ·çš„é“¾æ¥ C-c C-a f æ’å…¥è„šæ³¨é“¾æ¥ C-c C-a l æ’å…¥==è¿™æ ·çš„é“¾æ¥ Org-Mode å†…å®¹å…ƒæ•°æ® å¿«æ·é”® å†…å®¹ ç”¨é€” s #+begin_src \u0026hellip; #+end_src e #+begin_example \u0026hellip; #+end_example : å•è¡Œçš„ä¾‹å­ä»¥å†’å·å¼€å¤´ q #+begin_quote \u0026hellip; #+end_quote é€šå¸¸ç”¨äºå¼•ç”¨ï¼Œä¸é»˜è®¤æ ¼å¼ç›¸æ¯”å·¦å³éƒ½ä¼šç•™å‡ºç¼©è¿› v #+begin_verse \u0026hellip; #+end_verse é»˜è®¤å†…å®¹ä¸æ¢è¡Œï¼Œéœ€è¦ç•™å‡ºç©ºè¡Œæ‰èƒ½æ¢è¡Œ c #+begin_center \u0026hellip; #+end_center l #+begin_latex \u0026hellip; #+end_latex L #+latex: h #+begin_html \u0026hellip; #+end_html H #+html: a #+begin_ascii \u0026hellip; #+end_ascii A #+ascii: i #+index: line I #+include: line ","id":113,"section":"posts","summary":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»","tags":["emacs"],"title":"Emacs","uri":"https://lvsq.net/2019/11/emacs/","year":"2019"},{"content":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†å¾€å¾€è¯»å®Œå°±å¿˜è®°ï¼Œæˆ–è€…è®°ä½äº†å¾ˆå¤šçŸ¥è¯†ç‚¹ï¼Œä½†æ˜¯è½¬æ¢ä¸æˆèƒ½åŠ›ï¼Œæ‰è´¹äº†å¾ˆå¤šå¿ƒåŠ›å’Œæ—¶é—´ï¼Œæ‰€ä»¥è¯»ä¹¦æ–¹æ³•å°¤ä¸ºé‡è¦ã€‚æˆ‘è‡ªå°ä¹Ÿè¯»è¿‡ä¸€äº›ä¹¦ï¼Œä¸è¿‡ä»æ²¡æœ‰ç ”ç©¶è¿‡æ–¹æ³•è®ºï¼Œä¹Ÿå±äºä¸å¾—è¦é¢†çš„è¿™ä¸€ç±»ï¼Œæ‰€ä»¥æ½¦å€’åŠç”Ÿï¼Œé¡½æ„šä¸å ªã€‚\nå¤äººä¹‹ä¸­æœ‰å¾ˆå¤šè¯»ä¹¦å‰å®³çš„ï¼Œä¹Ÿæµä¼ ä¸‹æ¥ä¸€äº›è¯»ä¹¦ä¹‹é“ï¼Œæ¯”å¦‚äº”æŸ³ä¸æ±‚ç”šè§£ï¼Œå§é¾™è§‚å…¶å¤§ç•¥ã€‚ä¸¤ä½å…ˆè´¤éƒ½æ˜¯å–„å­¦ä¹‹å£«ï¼Œå…¶æ³•è•´å«è‡³ç†ï¼Œè‹¥æˆ‘ç­‰ä¸æ˜å°±é‡Œï¼Œå®¹æ˜“å •å…¥æ‡’æƒ°ã€‚æŸç§ç¨‹åº¦ä¸Šï¼Œäºè´¹æ›¼å­¦ä¹ æ³•æ®Šé€”åŒå½’ã€‚\nå¦å¤–éœ€è¦æŒ‡å‡ºçš„æ˜¯å­¦ä¹ åº”å½“æ˜¯ç³»ç»Ÿæ€§çš„ï¼Œç¢ç‰‡åŒ–å­¦ä¹ ä¸å¯å–ï¼Œè¿™ç§æ–¹å¼å¾—åˆ°çš„æ˜¯ä¿¡æ¯ï¼Œå¹¶ä¸æ˜¯çŸ¥è¯†ã€‚\nè´¹æ›¼å­¦ä¹ æ³•æœ‰å››ä¸ªæ ¸å¿ƒè¯ï¼šæ¦‚å¿µã€è®²æˆã€å®¡æŸ¥ã€ç®€åŒ–ã€‚\næ¦‚å¿µ æ¦‚å¿µæ˜¯æŒ‡æˆ‘ä»¬å¯¹éœ€è¦å­¦ä¹ çš„ç›®æ ‡æœ‰ç›¸å½“çš„æ¦‚å¿µï¼Œè¿™åŒ…æ‹¬æˆ‘ä»¬æ‰“ç®—å­¦ä¹ ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å°†å¾—åˆ°å“ªäº›çŸ¥è¯†ç­‰ç­‰ã€‚\nä¿—è¯­è¯´ï¼šå¥½çš„å¼€å§‹æ˜¯æˆåŠŸçš„ä¸€åŠã€‚åœ¨å­¦ä¹ ä¹‹å‰æˆ‘ä»¬åº”å½“è°¨æ…åœ°æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬ç¡®å®šè¦å­¦å—ï¼Ÿå¦‚æœæ˜¯è‚¯å®šçš„ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆèŠ±ä¸€ç‚¹ç‚¹æ—¶é—´åˆæ­¥äº†è§£ä¸€ä¸‹å°†è¦å­¦ä¹ çš„é¢†åŸŸçš„ä¸»è¦æ€æ½®æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å“ªäº›æƒå¨çš„ä¸“å®¶å’Œä¹¦ç±ï¼Ÿç„¶åå°±å¯ä»¥ä¹°ä¸€äº›ä¹¦å¹¶åˆ¶å®šåˆç†çš„è®¡åˆ’å¼€å§‹è¿™æ®µæ—…ç¨‹äº†ã€‚\nå…³äºä¹°ä¹¦ï¼Œæˆ‘çš„å»ºè®®æ˜¯å°½é‡é€‰æ‹©ç»å…¸è‘—ä½œï¼Œä¸ç”¨å¤ªå¤šï¼Œè´ªå¤šåè€Œåš¼ä¸çƒ‚ã€‚å¦å¤–ä¹Ÿè¦è€ƒè™‘å‡ºç‰ˆç¤¾ï¼Œä¸€èˆ¬å‡ºåçš„å‡ºç‰ˆç¤¾ç¼–è¾‘çš„ä¹¦è´¨é‡ä¼šæœ‰ä¿éšœï¼Œæ¯”å¦‚æ–‡å²ç±»çš„ï¼Œä¸­åä¹¦å±€ï¼Œä¸Šå¤ç­‰å¾ˆä¸é”™ã€‚\nç¿»å¼€ä¹¦æœ¬ä¹‹å‰ï¼Œéœ€æå‡ºè‡ªå·±çš„æœŸæœ›ï¼Œå³æˆ‘å¸Œæœ›æœ¬ä¹¦èƒ½æä¾›ç»™æˆ‘å…³äºæŸæŸé—®é¢˜çš„ç­”æ¡ˆï¼Œé˜…è¯»ä¸­æ—¶åˆ»å›´ç»•è¯¥é—®é¢˜è¿›è¡Œæ€è€ƒï¼Œè¿™æ ·å¯æ±²å–æƒ³è¦çš„çŸ¥è¯†ã€‚\nä¸€ä¸ªé¢†åŸŸçš„çŸ¥è¯†ç‚¹å¾€å¾€æå¤šï¼Œå› æ­¤é˜…è¯»æ—¶ä¸åº”è¢«åŠ¨åœ°å…¨ç›˜æ¥å—ï¼Œåº”ä¸»åŠ¨åŠ å·¥çŸ¥è¯†ï¼Œæˆ‘ä»¬éœ€è¦å­¦ä¼šå½’çº³ã€ç­›é€‰å’Œåˆ†æï¼Œè¿™å¯¹äºå½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»æä¸ºé‡è¦ã€‚\nè®²æˆ è¿™æ˜¯è´¹æ›¼å­¦ä¹ æ³•çš„æ ¸å¿ƒã€‚é€šè¿‡å‘å…¶ä»–äººè®²æˆè‡ªå·±ä¹ å¾—çš„çŸ¥è¯†ï¼Œæ¥å·©å›ºè‡ªèº«æ‰€å­¦ï¼Œå¹¶ä¸”åˆ©ç”¨ä»–äººçš„åé¦ˆå’Œè´¨ç–‘æ¥æŸ¥ç¼ºè¡¥æ¼ï¼Œä»è€Œæ›´åŠ ç†è§£è¯¥é¢†åŸŸï¼Œè¿™æ˜¯ä¸€ç§æ­£å‘ç§¯æçš„è¿­ä»£ã€‚å½“æˆ‘ä»¬èƒ½å¤Ÿç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è§£é‡ŠæŸä¸ªé¢†åŸŸçš„çŸ¥è¯†ï¼Œå¹¶ä¸”èƒ½è®©ä¸€ä½é—¨å¤–æ±‰äº§ç”Ÿå…±é¸£ï¼Œé‚£ä¹ˆå¯ä»¥è¯´æˆ‘ä»¬å¯¹äºè¯¥é¢†åŸŸæœ‰ç›¸å½“çš„ç†è§£äº†ã€‚\nç”¨æœ€ç®€å•çš„è¯­è¨€æ¥è®²æˆå¾ˆé‡è¦ï¼Œè¿™æ˜¯ä¸€ä¸ªå‡ç‚¼çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šåŠ å…¥è‡ªå·±çš„æƒ³æ³•ï¼Œå¹¶ä¸å…¶ä»–çŸ¥è¯†äº¤å‰ææºï¼Œé€æ¸å½¢æˆè‡ªå·±çš„çŸ¥è¯†ä½“ç³»ã€‚ä½“ç³»æ˜¯ç‹¬ç«‹æ€è€ƒçš„åŸºçŸ³ï¼Œå› æ­¤å¯¹ä»»ä½•äº‹éƒ½èƒ½æœ‰è‡ªå·±çš„è§è§£ï¼Œè€Œä¸æ˜¯äººäº‘äº¦äº‘ã€‚\né€šä¿—åœ°è®²ï¼Œè¿™æ˜¯ç”¨è¾“å‡ºæ¥å€’é€¼è¾“å…¥ã€‚å¦‚æœè‡ªå·±ä¸èƒ½è§£é‡Šæ¸…æ¥šï¼Œåªèƒ½è¯´æ˜è¿˜æ²¡æœ‰æŒæ¡ç²¾é«“ã€‚ä»»ä½•å¤æ‚çš„äº‹æƒ…èƒŒåéƒ½æœ‰ä¸€ä¸ªç®€å•çš„çœŸç†ã€‚\nå®¡æŸ¥ å­Ÿå­è¯´ï¼šå°½ä¿¡ä¹¦ä¸å¦‚æ— ä¹¦ã€‚æ‰€ä»¥å­¦ä¹ å¿…éœ€å…·å¤‡æ€€ç–‘ç²¾ç¥ï¼Œå½“ç„¶ä¸æ˜¯ç›²ç›®çš„æ€€ç–‘ï¼Œæ€€ç–‘ä¸€åˆ‡æ˜¯ä¸€ç§æµªè´¹ã€‚å¥½å¥‡å¿ƒæ˜¯é©±ä½¿äººç±»è¿›æ­¥çš„åŸåŠ¨åŠ›ï¼Œå¹¼å„¿å¯¹ä»€ä¹ˆéƒ½å¥½å¥‡ï¼Œè¿™ä¼šä¿ƒè¿›ä»–ä»¬æˆé•¿ï¼Œå’Œè®¤è¯†ä¸–ç•Œã€‚æˆäººä¸¢æ‰äº†ç«¥çœŸï¼ŒæŸäº›æ–¹é¢çœ‹æ˜¯ä¸€ç§æŸå¤±ã€‚å²å®¶è’™æ–‡é€šå…ˆç”Ÿè€ƒè¯•é¥¶æœ‰è¶£å‘³ï¼Œä¸æ˜¯ä»–å‡ºé¢˜è€ƒå­¦ç”Ÿï¼Œè€Œæ˜¯ç”±å­¦ç”Ÿå‡ºé¢˜é—®ä»–ã€‚å¦‚æœå­¦ç”Ÿç§¯ç´¯ä¸å¤Ÿï¼Œå¥½å¥‡ä¸è¶³ï¼Œä¾¿æƒ³å‡ºä¸äº†å¥½é¢˜ï¼Œæ‰€ä»¥å¾€å¾€è€ƒç”Ÿä¸€å‡ºå£ï¼Œè’™å…ˆç”Ÿå°±çŸ¥é“è¯¥ç”Ÿå­¦é—®å¦‚ä½•äº†ã€‚\nç®€åŒ– äººçš„ç²¾åŠ›ç›¸å½“æœ‰é™ï¼Œå†µä¸”æˆå¹´ä¹‹åå„ç§æ‚äº‹çº·è‡³æ²“æ¥ï¼Œæ²‰ä¸‹å¿ƒå­¦ä¹ çš„æ—¶é—´å°‘ä¹‹åˆå°‘ï¼Œæ‰€ä»¥æ›´åº”å½“é›†ä¸­ç²¾ç¥ï¼Œç¼©å°èŒƒå›´ã€‚\nä¸‹é¢é™„ä¸€å¼ æ€ç»´å¯¼å›¾ï¼Œæ¾„æ¸…è„‰ç»œï¼š\n","id":114,"section":"posts","summary":"æœ¬ç¯‡æ˜¯ç”¨è´¹æ›¼å­¦ä¹ æ³•æ¥å­¦ä¹ ã€Šè´¹æ›¼å­¦ä¹ æ³•ã€‹ã€‚å½“ä»£å¾ˆå¤šäººéƒ½æœ‰çŸ¥è¯†ç„¦è™‘ï¼Œäººå‰éœ²æ€¯ä¸åœ¨å°‘æ•°ï¼Œæ²‰ä¸‹å¿ƒæ¥è¯»ä¸€äº›ä¹¦å……å®è‡ªå·±å°±å¾ˆé‡è¦ï¼Œå¾ˆå¤šäººç¡®å®è¯»äº†ä¸€äº›ä¹¦ï¼Œä½†","tags":["éšæƒ³"],"title":"è´¹æ›¼å­¦ä¹ æ³•","uri":"https://lvsq.net/2022/03/feynman_technique/","year":"2022"},{"content":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;; + `doom-font\u0026#39; ;; + `doom-variable-pitch-font\u0026#39; ;; + `doom-big-font\u0026#39; -- used for `doom-big-font-mode\u0026#39;; use this for ;; presentations or streaming. ;; ;; They all accept either a font-spec, font string (\u0026#34;Input Mono-12\u0026#34;), or xlfd ;; font string. You generally only need these two: ;;(setq doom-font (font-spec :family \u0026#34;monaco\u0026#34; :size 14 :weight \u0026#39;semi-light) ;; doom-variable-pitch-font (font-spec :family \u0026#34;sans\u0026#34; :size 13)) ;; There are two ways to load a theme. Both assume the theme is installed and ;; available. You can either set `doom-theme\u0026#39; or manually load a theme with the ;; `load-theme\u0026#39; function. This is the default: (setq doom-theme \u0026#39;doom-monokai-pro) ;; If you use `org\u0026#39; and don\u0026#39;t want your org files in the default location below, ;; change `org-directory\u0026#39;. It must be set before org loads! (setq org-directory \u0026#34;~/work/emacs-org/\u0026#34;) ;; This determines the style of line numbers in effect. If set to `nil\u0026#39;, line ;; numbers are disabled. For relative line numbers, set this to `relative\u0026#39;. (setq display-line-numbers-type t) ;; Here are some additional functions/macros that could help you configure Doom: ;; ;; - `load!\u0026#39; for loading external *.el files relative to this one ;; - `use-package!\u0026#39; for configuring packages ;; - `after!\u0026#39; for running code after a package has loaded ;; - `add-load-path!\u0026#39; for adding directories to the `load-path\u0026#39;, relative to ;; this file. Emacs searches the `load-path\u0026#39; when you load packages with ;; `require\u0026#39; or `use-package\u0026#39;. ;; - `map!\u0026#39; for binding new keys ;; ;; To get information about any of these functions/macros, move the cursor over ;; the highlighted symbol at press \u0026#39;K\u0026#39; (non-evil users must press \u0026#39;C-c c k\u0026#39;). ;; This will open documentation for it, including demos of how they are used. ;; ;; You can also try \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) to jump to their definition and see how ;; they are implemented. (custom-set-faces ;; custom-set-faces was added by Custom. ;; If you edit it by hand, you could mess it up, so be careful. ;; Your init file should contain only one such instance. ;; If there is more than one, they won\u0026#39;t work right. \u0026#39;(default ((t (:family \u0026#34;Monaco\u0026#34; :foundry \u0026#34;nil\u0026#34; :slant normal :weight normal :height 150 :width normal)))) \u0026#39;(rainbow-delimiters-depth-1-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;light green\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-2-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;goldenrod2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-3-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark magenta\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-4-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark cyan\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-5-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;dark blue\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-6-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;PaleVioletRed2\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-7-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;SpringGreen4\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-8-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;chocolate3\u0026#34;)))) \u0026#39;(rainbow-delimiters-depth-9-face ((t (:inherit rainbow-delimiters-base-face :foreground \u0026#34;blue\u0026#34;))))) (setq auto-save-default t) (run-with-idle-timer 5 t #\u0026#39;save-some-buffers t) (setq make-backup-files t) (setq confirm-kill-emacs nil) (set-frame-position (selected-frame) 0 0) (add-to-list \u0026#39;default-frame-alist \u0026#39;(fullscreen . maximized)) (setq initial-frame-alist \u0026#39;((top . 1) (left . 1) (width . 114) (height . 32))) ;;org-mode (setq org-superstar-headline-bullets-list \u0026#39;(\u0026#34;âœ¿\u0026#34; \u0026#34;âœ¸\u0026#34; \u0026#34;â—‰\u0026#34; \u0026#34;â–\u0026#34; \u0026#34;â—‹\u0026#34; )) ;;(setq org-todo-keywords \u0026#39;((sequence \u0026#34;TODO(t)\u0026#34; \u0026#34;STARTED(s!)\u0026#34; \u0026#34;WAITING(w@/!)\u0026#34; \u0026#34;|\u0026#34; \u0026#34;DONE(d@/!)\u0026#34; \u0026#34;CANCELLED(c@/!)\u0026#34;))) (setf org-todo-keyword-faces \u0026#39;((\u0026#34;TODO\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#95A5A6\u0026#34;))(\u0026#34;STRT\u0026#34;. (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#2E8B57\u0026#34;))(\u0026#34;DONE\u0026#34; . (:foreground \u0026#34;white\u0026#34; :background \u0026#34;#3498DB\u0026#34;)))) (setq org-log-done \u0026#39;time) (setq org-cycle-include-plain-lists t) (setq org-export-coding-system \u0026#39;utf-8) (setq org-src-fontify-natively t) (setq org-html-doctype \u0026#34;html5\u0026#34;) (setq org-html-xml-declaration nil) (setq org-html-head \u0026#34;\u0026lt;link rel=\u0026#39;stylesheet\u0026#39; href=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css\u0026#39; integrity=\u0026#39;sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js\u0026#39; integrity=\u0026#39;sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\\n\u0026lt;script src=\u0026#39;https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js\u0026#39; integrity=\u0026#39;sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2\u0026#39; crossorigin=\u0026#39;anonymous\u0026#39;\u0026gt;\u0026lt;/script\u0026gt;\u0026#34;) (org-babel-do-load-languages \u0026#39;org-babel-load-languages \u0026#39;((emacs-lisp . t) (c . t) (java . t) (go . t) (racket . t) (python . t) (latex . t) (shell . t) (js . t) (lisp . t) (scheme . t))) (setq-default prettify-symbols-alist \u0026#39;((\u0026#34;#+BEGIN_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+END_SRC\u0026#34; . \u0026#34;â€ \u0026#34;)(\u0026#34;#+begin_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;#+end_src\u0026#34; . \u0026#34;â€ \u0026#34;) (\u0026#34;\u0026gt;=\u0026#34; . \u0026#34;â‰¥\u0026#34;)(\u0026#34;=\u0026gt;\u0026#34; . \u0026#34;â‡¨\u0026#34;))) (setq prettify-symbols-unprettify-at-point \u0026#39;right-edge) (add-hook \u0026#39;org-mode-hook \u0026#39;prettify-symbols-mode) (setq org-adapt-indentation nil) : ;;auto-wrap (global-visual-line-mode 1) ;1 for on, 0 for off. ;;racket (require \u0026#39;racket-mode) (setq racket-program \u0026#34;/Applications/Racket v8.4/bin/racket\u0026#34;) (setq tab-always-indent \u0026#39;complete) ;; ä½¿ç”¨tabè‡ªåŠ¨è¡¥å…¨ (add-to-list \u0026#39;auto-mode-alist \u0026#39;(\u0026#34;\\\\.rkt\\\\\u0026#39;\u0026#34; . racket-mode)) (add-to-list \u0026#39;magic-mode-alist \u0026#39;(\u0026#34;^#lang racket\u0026#34; . :racket-mode)) ;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ;; language evniroment (set-language-environment \u0026#39;UTF-8) (set-locale-environment \u0026#34;UTF-8\u0026#34;) (define-coding-system-alias \u0026#39;UTF-8 \u0026#39;utf-8) ;; elfeed (setq elfeed-db-directory \u0026#34;~/work/emacs-org/elfeed\u0026#34;) (setq rmh-elfeed-org-files (list \u0026#34;~/work/emacs-org/elfeed/elfeed.org\u0026#34;)) (add-hook! \u0026#39;elfeed-search-mode-hook #\u0026#39;elfeed-update) ;;(add-hook \u0026#39;elfeed-new-entry-hook ;; (elfeed-make-tagger :before \u0026#34;2 weeks ago\u0026#34; ;; :remove \u0026#39;unread)) ;; lsp (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred) :custom ;; what to use when checking on-save. \u0026#34;check\u0026#34; is default, I prefer clippy (lsp-rust-analyzer-cargo-watch-command \u0026#34;clippy\u0026#34;) (lsp-eldoc-render-all t) (lsp-idle-delay 0.6) ;; enable / disable the hints as you prefer: (lsp-inlay-hint-enable t) ;; These are optional configurations. See https://emacs-lsp.github.io/lsp-mode/page/lsp-rust-analyzer/#lsp-rust-analyzer-display-chaining-hints for a full list (lsp-rust-analyzer-display-lifetime-elision-hints-enable \u0026#34;skip_trivial\u0026#34;) (lsp-rust-analyzer-display-chaining-hints t) (lsp-rust-analyzer-display-lifetime-elision-hints-use-parameter-names nil) (lsp-rust-analyzer-display-closure-return-type-hints t) (lsp-rust-analyzer-display-parameter-hints nil) (lsp-rust-analyzer-display-reborrow-hints nil) :config (add-hook \u0026#39;lsp-mode-hook \u0026#39;lsp-ui-mode)) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure :commands lsp-ui-mode :custom (lsp-ui-peek-always-show t) (lsp-ui-sideline-show-hover t) (lsp-ui-doc-enable nil)) (use-package flycheck :ensure) ;;rust ;;refer: https://robert.kra.hn/posts/rust-emacs-setup/ (use-package rustic :ensure :bind (:map rustic-mode-map (\u0026#34;M-j\u0026#34; . lsp-ui-imenu) (\u0026#34;M-?\u0026#34; . lsp-find-references) (\u0026#34;C-c C-c l\u0026#34; . flycheck-list-errors) (\u0026#34;C-c C-c a\u0026#34; . lsp-execute-code-action) (\u0026#34;C-c C-c r\u0026#34; . lsp-rename) (\u0026#34;C-c C-c q\u0026#34; . lsp-workspace-restart) (\u0026#34;C-c C-c Q\u0026#34; . lsp-workspace-shutdown) (\u0026#34;C-c C-c s\u0026#34; . lsp-rust-analyzer-status)) :config ;; uncomment for less flashiness ;; (setq lsp-eldoc-hook nil) ;; (setq lsp-enable-symbol-highlighting nil) ;; (setq lsp-signature-auto-activate nil) ;; comment to disable rustfmt on save (setq rustic-format-on-save t) (add-hook \u0026#39;rustic-mode-hook \u0026#39;rk/rustic-mode-hook)) (defun rk/rustic-mode-hook () ;; so that run C-c C-c C-r works without having to confirm, but don\u0026#39;t try to ;; save rust buffers that are not file visiting. Once ;; https://github.com/brotzeit/rustic/issues/253 has been resolved this should ;; no longer be necessary. (when buffer-file-name (setq-local buffer-save-without-query t)) (add-hook \u0026#39;before-save-hook \u0026#39;lsp-format-buffer nil t)) init.el ;;; init.el -*- lexical-binding: t; -*- ;; This file controls what Doom modules are enabled and what order they load ;; in. Remember to run \u0026#39;doom sync\u0026#39; after modifying it! ;; NOTE Press \u0026#39;SPC h d h\u0026#39; (or \u0026#39;C-h d h\u0026#39; for non-vim users) to access Doom\u0026#39;s ;; documentation. There you\u0026#39;ll find a \u0026#34;Module Index\u0026#34; link where you\u0026#39;ll find ;; a comprehensive list of Doom\u0026#39;s modules and what flags they support. ;; NOTE Move your cursor over a module\u0026#39;s name (or its flags) and press \u0026#39;K\u0026#39; (or ;; \u0026#39;C-c c k\u0026#39; for non-vim users) to view its documentation. This works on ;; flags as well (those symbols that start with a plus). ;; ;; Alternatively, press \u0026#39;gd\u0026#39; (or \u0026#39;C-c c d\u0026#39;) on a module to browse its ;; directory (for easy access to its source code). ;;; æ·»åŠ ä¸­å›½æº ;;(setq package-archives \u0026#39;((\u0026#34;gnu\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/gnu/\u0026#34;) ;; (\u0026#34;melpa\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa/\u0026#34;) ;; (\u0026#34;melpa-stable\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/melpa-stable/\u0026#34;) ;; (\u0026#34;org\u0026#34; . \u0026#34;http://mirrors.ustc.edu.cn/elpa/org/\u0026#34;))) (doom! :input ;; chinese ;;japanese ;;layout ; auie,ctsrnm is the superior home row :completion company ; the ultimate code completion backend ;;helm ; the *other* search engine for love and life ;;ido ; the other *other* search engine... ivy ; a search engine for love and life vertico ; the search engine of the future :ui ;;deft ; notational velocity for Emacs doom ; what makes DOOM look the way it does doom-dashboard ; a nifty splash screen for Emacs doom-quit ; DOOM quit-message prompts when you quit Emacs ;;(emoji +unicode) ; ğŸ™‚ hl-todo ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW ;;hydra ;;indent-guides ; highlighted indent columns ;;ligatures ; ligatures and symbols to make your code pretty again ;;minimap ; show a map of the code on the side modeline ; snazzy, Atom-inspired modeline, plus API ;;nav-flash ; blink cursor line after big motions ;;neotree ; a project drawer, like NERDTree for vim ophints ; highlight the region an operation acts on (popup +defaults) ; tame sudden yet inevitable temporary windows ;;tabs ; a tab bar for Emacs treemacs ; a project drawer, like neotree but cooler ;;unicode ; extended unicode support for various languages vc-gutter ; vcs diff in the fringe vi-tilde-fringe ; fringe tildes to mark beyond EOB ;;window-select ; visually switch windows workspaces ; tab emulation, persistence \u0026amp; separate workspaces ;;zen ; distraction-free coding or writing :editor (evil +everywhere); come to the dark side, we have cookies file-templates ; auto-snippets for empty files fold ; (nigh) universal code folding (format +onsave) ; automated prettiness ;;god ; run Emacs commands without modifier keys ;;lispy ; vim for lisp, for people who don\u0026#39;t like vim ;;multiple-cursors ; editing in many places at once ;;objed ; text object editing for the innocent ;;parinfer ; turn lisp into python, sort of ;;rotate-text ; cycle region at point between text candidates snippets ; my elves. They type so I don\u0026#39;t have to word-wrap ; soft wrapping with language-aware indent :emacs dired ; making dired pretty [functional] electric ; smarter, keyword-based electric-indent ;;ibuffer ; interactive buffer management undo ; persistent, smarter undo for your inevitable mistakes vc ; version-control and Emacs, sitting in a tree :term eshell ; the elisp shell that works everywhere shell ; simple shell REPL for Emacs ;;term ; basic terminal emulator for Emacs vterm ; the best terminal emulation in Emacs :checkers syntax ; tasing you for every semicolon you forget ;;(spell +flyspell) ; tasing you for misspelling mispelling ;;grammar ; tasing grammar mistake every you make :tools ;;ansible ;;biblio ; Writes a PhD for you (citation needed) ;;debugger ; FIXME stepping through code, to help you add bugs ;;direnv ;;docker ;;editorconfig ; let someone else argue about tabs vs spaces ;;ein ; tame Jupyter notebooks with emacs (eval +overlay) ; run code, run (also, repls) ;;gist ; interacting with github gists lookup ; navigate your code and its documentation lsp ; M-x vscode magit ; a git porcelain for Emacs ;;make ; run make tasks from Emacs ;;pass ; password manager for nerds ;;pdf ; pdf enhancements ;;prodigy ; FIXME managing external services \u0026amp; code builders ;;rgb ; creating color strings ;;taskrunner ; taskrunner for all your projects ;;terraform ; infrastructure as code ;;tmux ; an API for interacting with tmux ;;upload ; map local to remote projects via ssh/ftp :os (:if IS-MAC macos) ; improve compatibility with macOS tty ; improve the terminal Emacs experience :lang ;;agda ; types of types of types of types... ;;beancount ; mind the GAAP ;;cc ; C \u0026gt; C++ == 1 ;;clojure ; java with a lisp ;;common-lisp ; if you\u0026#39;ve seen one lisp, you\u0026#39;ve seen them all ;;coq ; proofs-as-programs ;;crystal ; ruby at the speed of c ;;csharp ; unity, .NET, and mono shenanigans ;;data ; config/data formats ;;(dart +flutter) ; paint ui and not much else ;;dhall ;;elixir ; erlang done right ;;elm ; care for a cup of TEA? emacs-lisp ; drown in parentheses ;;erlang ; an elegant language for a more civilized age ;;ess ; emacs speaks statistics ;;factor ;;faust ; dsp, but you get to keep your soul ;;fortran ; in FORTRAN, GOD is REAL (unless declared INTEGER) ;;fsharp ; ML stands for Microsoft\u0026#39;s Language ;;fstar ; (dependent) types and (monadic) effects and Z3 ;;gdscript ; the language you waited for (go +lsp) ; the hipster dialect ;;(haskell +lsp) ; a language that\u0026#39;s lazier than I am ;;hy ; readability of scheme w/ speed of python ;;idris ; a language you can depend on json ; At least it ain\u0026#39;t XML ;;(java +meghanada) ; the poster child for carpal tunnel syndrome (java +lsp) javascript ; all(hope(abandon(ye(who(enter(here)))))) ;;julia ; a better, faster MATLAB ;;kotlin ; a better, slicker Java(Script) ;;latex ; writing papers in Emacs has never been so fun ;;lean ; for folks with too much to prove ;;ledger ; be audit you can be ;;lua ; one-based indices? one-based indices markdown ; writing docs for people to ignore ;;nim ; python + lisp at the speed of c ;;nix ; I hereby declare \u0026#34;nix geht mehr!\u0026#34; ;;ocaml ; an objective camel (org +pretty) ; organize your plain life in plain text ;;php ; perl\u0026#39;s insecure younger brother ;;plantuml ; diagrams for confusing people more ;;purescript ; javascript, but functional python ; beautiful is better than ugly ;;qt ; the \u0026#39;cutest\u0026#39; gui framework ever racket ; a DSL for DSLs ;;raku ; the artist formerly known as perl6 ;;rest ; Emacs as a REST client ;;rst ; ReST in peace ;;(ruby +rails) ; 1.step {|i| p \u0026#34;Ruby is #{i.even? ? \u0026#39;love\u0026#39; : \u0026#39;life\u0026#39;}\u0026#34;} ;;rust ; Fe2O3.unwrap().unwrap().unwrap().unwrap() ;;scala ; java, but good ;;(scheme +guile) ; a fully conniving family of lisps sh ; she sells {ba,z,fi}sh shells on the C xor ;;sml ;;solidity ; do you need a blockchain? No. ;;swift ; who asked for emoji variables? ;;terra ; Earth and Moon in alignment for performance. ;;web ; the tubes yaml ; JSON, but readable ;;zig ; C, but simpler :email ;;(mu4e +org +gmail) ;;notmuch ;;(wanderlust +gmail) :app ;;calendar ;;emms ;;everywhere ; *leave* Emacs!? You must be joking ;;irc ; how neckbeards socialize (rss +org) ; emacs as an RSS reader ;;twitter ; twitter client https://twitter.com/vnought :config ;;literate (default +bindings +smartparens)) packages.el ;; -*- no-byte-compile: t; -*- ;;; $DOOMDIR/packages.el ;; To install a package with Doom you must declare them here and run \u0026#39;doom sync\u0026#39; ;; on the command line, then restart Emacs for the changes to take effect -- or ;; use \u0026#39;M-x doom/reload\u0026#39;. ;; To install SOME-PACKAGE from MELPA, ELPA or emacsmirror: ;(package! some-package) ;; To install a package directly from a remote git repo, you must specify a ;; `:recipe\u0026#39;. You\u0026#39;ll find documentation on what `:recipe\u0026#39; accepts here: ;; https://github.com/raxod502/straight.el#the-recipe-format ;(package! another-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34;)) ;; If the package you are trying to install does not contain a PACKAGENAME.el ;; file, or is located in a subdirectory of the repo, you\u0026#39;ll need to specify ;; `:files\u0026#39; in the `:recipe\u0026#39;: ;(package! this-package ; :recipe (:host github :repo \u0026#34;username/repo\u0026#34; ; :files (\u0026#34;some-file.el\u0026#34; \u0026#34;src/lisp/*.el\u0026#34;))) ;; If you\u0026#39;d like to disable a package included with Doom, you can do so here ;; with the `:disable\u0026#39; property: ;(package! builtin-package :disable t) ;; You can override the recipe of a built in package without having to specify ;; all the properties for `:recipe\u0026#39;. These will inherit the rest of its recipe ;; from Doom or MELPA/ELPA/Emacsmirror: ;(package! builtin-package :recipe (:nonrecursive t)) ;(package! builtin-package-2 :recipe (:repo \u0026#34;myfork/package\u0026#34;)) ;; Specify a `:branch\u0026#39; to install a package from a particular branch or tag. ;; This is required for some packages whose default branch isn\u0026#39;t \u0026#39;master\u0026#39; (which ;; our package manager can\u0026#39;t deal with; see raxod502/straight.el#279) ;(package! builtin-package :recipe (:branch \u0026#34;develop\u0026#34;)) ;; Use `:pin\u0026#39; to specify a particular commit to install. ;(package! builtin-package :pin \u0026#34;1a2b3c4d5e\u0026#34;) ;; Doom\u0026#39;s packages are pinned to a specific commit and updated from release to ;; release. The `unpin!\u0026#39; macro allows you to unpin single packages... ;(unpin! pinned-package) ;; ...or multiple packages ;(unpin! pinned-package another-pinned-package) ;; ...Or *all* packages (NOT RECOMMENDED; will likely break things) ;(unpin! t) (package! racket-mode) (package! spacemacs-theme) elfeed.org * root :elfeed: ** Programming :programming: *** https://www.reddit.com/r/functionalprogramming/.rss :Reddit: ** News :news: *** https://news.ycombinator.com/rss :Hack News: ","id":115,"section":"posts","summary":"config.el ;;; $DOOMDIR/config.el -*- lexical-binding: t; -*- ;; Place your private configuration here! Remember, you do not need to run \u0026#39;doom ;; sync\u0026#39; after modifying this file! ;; Some functionality uses this to identify you, e.g. GPG configuration, email ;; clients, file templates and snippets. (setq user-full-name \u0026#34;Siquan\u0026#34; user-mail-address \u0026#34;xx@xx.com\u0026#34;) ;; Doom exposes five (optional) variables for controlling fonts in Doom. Here ;; are the three important ones: ;; ;;","tags":["emacs"],"title":"æˆ‘çš„Doom Emacsé…ç½®","uri":"https://lvsq.net/2022/02/my-doom-emacs-config/","year":"2022"},{"content":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘äº†ç”¨æˆ·æŠ˜è…¾çš„æ—¶é—´ï¼Œè€Œä¸”å¯åŠ¨å¾ˆå¿«ï¼Œæä¾›è¶…è¿‡60é—¨ç¼–ç¨‹è¯­è¨€çš„å¯é€‰é¡¹ï¼Œå¯è°“ååˆ†å¼ºå¤§ã€‚\nç¬”è€…å¹³æ—¶ä¼šä½¿ç”¨Golangå¼€å‘ï¼Œæ‰€ä»¥ç¬¬ä¸€æ—¶é—´å¼€å¯äº†Golangçš„æ”¯æŒï¼Œç”±äºDoom Emacsçš„èµ„æ–™æ¯”è¾ƒå°‘ï¼Œåœ¨é…ç½®çš„è¿‡ç¨‹ä¸­èµ°äº†å¾ˆå¤šå¼¯è·¯ï¼Œç»è¿‡ä¸€ç•ªæŠ˜è…¾ä¹‹åç»ˆäºæœ‰ä¸€ä¸ªå¯ç”¨çš„ç‰ˆæœ¬ï¼Œå¯èƒ½è¿˜æœ‰é—®é¢˜ï¼Œæš‚æ—¶æ²¡æœ‰å‘ç°ï¼Œç°è®°å½•ä¸€ä¸‹ï¼Œä¾›å¤§å®¶å‚è€ƒã€‚\nDoomå®‰è£…å®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„æ­¥éª¤ï¼š\nç¬¬ä¸€æ­¥ ä¿®æ”¹ ~/doom.d/init.el, å¯ç”¨ï¼ˆSPC f Pï¼‰æ‰¾åˆ°è¯¥æ–‡ä»¶\nåœ¨ (doom! ä¸‹é¢æ‰¾åˆ°ï¼š\n:lang (go +lsp)\n:tools (lsp)\n:editor (sinppets, evil +everywhere, format +onsave)\nï¼šcompletion (company)\n()ä¸­çš„é¡¹ç›®éƒ½æ‰“å¼€\nç¬¬äºŒæ­¥ æ‰¾åˆ°~/doom.d/config.el,æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\n;;golang (setq lsp-gopls-staticcheck t) (setq lsp-eldoc-render-all t) (setq lsp-gopls-complete-unimported t) (setq lsp-gopls-codelens nil) (use-package lsp-mode :ensure t :commands (lsp lsp-deferred) :hook (go-mode . lsp-deferred)) ;; Set up before-save hooks to format buffer and add/delete imports. ;; Make sure you don\u0026#39;t have other gofmt/goimports hooks enabled. (defun lsp-go-install-save-hooks () (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-format-buffer t t) (add-hook \u0026#39;before-save-hook #\u0026#39;lsp-organize-imports t t)) (add-hook \u0026#39;go-mode-hook #\u0026#39;lsp-go-install-save-hooks) ;; Optional - provides fancier overlays. (use-package lsp-ui :ensure t :commands lsp-ui-mode) ;; Company mode is a standard completion package that works well with lsp-mode. (use-package company :ensure t :config ;; Optionally enable completion-as-you-type behavior. (setq company-idle-delay 0) (setq company-minimum-prefix-length 1)) ;; Optional - provides snippet support. (use-package yasnippet :ensure t :commands yas-minor-mode :hook (go-mode . yas-minor-mode)) ç¬¬ä¸‰æ­¥ å®‰è£…ä¾èµ–åŒ…ï¼š\ngo install github.com/motemen/gore/cmd/gore@latest go install github.com/stamblerre/gocode@latest go install golang.org/x/tools/cmd/godoc@latest go install golang.org/x/tools/cmd/goimports@latest go install golang.org/x/tools/cmd/gorename@latest go install golang.org/x/tools/cmd/guru@latest go install github.com/cweill/gotests/...@latest go install github.com/fatih/gomodifytags@latest # gopls for (+lsp) go install golang.org/x/tools/gopls@latest # golangci go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest è¿™æ˜¯é’ˆå¯¹Go \u0026gt;= v1.16çš„ï¼Œä½äºè¿™ä¸ªç‰ˆæœ¬çš„ç”¨go getï¼Œ æˆ‘æƒ³ç°åœ¨å¤§å®¶ç”¨çš„éƒ½æ˜¯æ–°ç‰ˆæœ¬äº†ã€‚\nç¬¬å››æ­¥ æ‰§è¡Œ~/.emacs.d/bin/doom sync æˆ–è€… (SPC h r r) ä½¿é…ç½®ç”Ÿæ•ˆ\nç¬¬äº”æ­¥ é‡å¯ä¸€ä¸‹Emacså³å¯\n","id":116,"section":"posts","summary":"Doom Emacsæ˜¯ä¸€ä¸ªEmacsçš„ä¸€ä¸ªé…ç½®é›†åˆï¼Œå¯çœ‹åšCentOSå’ŒLinuxçš„å…³ç³»ã€‚å®ƒå°†Emcaså’ŒVimç›¸ç»“åˆï¼ŒåŒ…å«äº†å„è‡ªçš„ç§ç§ä¼˜ç‚¹ï¼Œå¹¶å‡å°‘","tags":["emacs","golang"],"title":"Doom Emacs Golang ç¯å¢ƒé…ç½®","uri":"https://lvsq.net/2021/12/doom-emacs-golang-env/","year":"2021"},{"content":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œä»£ç å°±å®Œæˆäº†ã€‚\n#lang racket (require racket/cmdline) (define show-bytes (make-parameter #t)) (define show-lines (make-parameter #t)) (define show-words (make-parameter #t)) (define files (make-parameter null)) (define re-chan (make-channel)) (define cmd-line (command-line #:program \u0026#34;r-wc\u0026#34; #:once-any [(\u0026#34;-c\u0026#34; \u0026#34;--bytes\u0026#34; \u0026#34;--chars\u0026#34;) \u0026#34;The number of bytes\u0026#34; (show-bytes #t) (show-lines #f) (show-words #f)] [(\u0026#34;-l\u0026#34; \u0026#34;--lines\u0026#34;) \u0026#34;The number of lines\u0026#34; (show-lines #t) (show-bytes #f) (show-words #f)] [(\u0026#34;-w\u0026#34; \u0026#34;--words\u0026#34;) \u0026#34;The muber of words\u0026#34; (show-words #t) (show-bytes #f) (show-lines #f)] #:args file (files file))) (define (do-work) (if (null? (files)) (displayln \u0026#34;Please enter the file name\u0026#34;) (begin (for-each scan-file (files)) (let loop ([finished 0]) (unless (= finished (length (files))) (let ((re (channel-get re-chan))) (match re ((list l w b f) (displayln (append (for/list ([d (list l w b)] [t (list (show-lines) (show-words) (show-bytes) )] #:when t) d) f))))) (loop (add1 finished))))))) (define (scan-file f) (thread (lambda () (call-with-input-file f (lambda (in) (let loop ([a-line (read-line in)] [bytes 0] [lines 0] [words 0]) (if (eof-object? a-line) (channel-put re-chan (list lines words bytes f)) (let-values (((w b) (parse-line a-line))) (loop (read-line in) (+ bytes b) (add1 lines) (+ words w)))))))))) (define (parse-line a-line) (define s (open-input-string a-line)) (if (null? a-line) (values 0 0) (let loop ([w 0] [b 0] [pre-char #\\a]) (define bl b) (define c (read-char s)) (unless (eof-object? c) (set! bl (+ (char-utf-8-length c) b))) (if (eof-object? c) (values (add1 w) (add1 b)) (case c [(#\\space) (loop (if (char-whitespace? pre-char) w (add1 w)) (add1 b) c)] [else (loop w bl c)]))))) (do-work) ç„¶åç”¨racoç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº, åå­—å°±å«r-wcï¼Œå’Œwcç¨å¾®åŒºåˆ†ä¸€ä¸‹ï¼š\nraco exe -o r-wc r-wc.rkt å°±åƒä½¿ç”¨wcå‘½ä»¤ä¸€æ ·ï¼Œ\nâœ racket ./r-wc -h usage: r-wc [ \u0026lt;option\u0026gt; ... ] [\u0026lt;file\u0026gt;] ... \u0026lt;option\u0026gt; is one of / -c, --bytes, --chars | The number of bytes | -l, --lines | The number of lines | -w, --words \\ The muber of words --help, -h Show this help -- Do not treat any remaining argument as a switch (at this level) /|\\ Brackets indicate mutually exclusive options. Multiple single-letter switches can be combined after one `-`. For example, `-h-` is the same as `-h --`. ä¸Šé¢çš„ç¨‹åºæ‰§è¡Œæ•ˆç‡ä¸æ˜¯å¾ˆå¥½ï¼Œä¸»è¦è¡¨ç°åœ¨è¯»å–æ–‡ä»¶ï¼Œå’Œè§£ææ¯ä¸€è¡Œæ—¶ï¼Œå ç”¨çš„æ—¶é—´å’Œå†…å­˜å¤ªå¤§ã€‚Racketæä¾›äº†ä¸€ä¸ªç‰¹æ€§Sequences ï¼Œå®ƒå¯ä»¥ä¸for å½¢å¼ä¸€æ ·éå†æ•°æ®ç»“æœï¼Œä½†æ˜¯æ•ˆç‡å´é«˜å¾ˆå¤šï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨Sequencesæ¥é‡æ„æˆ‘ä»¬çš„ç¨‹åºï¼Œå°†ä¸Šæ–‡çš„ä¸¤ä¸ªå‡½æ•°scan-file å’Œparse-line ä¿®æ”¹ä¸ºï¼š\n(define (scan-file f) (thread (lambda () (define bytes 0) (define lines 0) (define words 0) (call-with-input-file f (lambda (in) (for ([a-line (in-bytes-lines in)]) (let-values (((w b) (parse-line-seq a-line))) (set! bytes (+ bytes b)) (set! lines (add1 lines)) (set! words (+ words w)))) (channel-put re-chan (list lines words bytes f))))))) (define (parse-line a-line) (define pre-char #\\a) (define w 0) (define b 0) (if (null? a-line) (values 0 0) (for ([c (in-bytes a-line)]) (case c [(#\\space) (unless (char-whitespace? pre-char) (set! w (add1 w))) (set! b (add1 b))] [else (set! b (add1 b))]) (set! pre-char c))) (values (add1 w) (add1 b))) ä¸¤ä¸ªç‰ˆæœ¬å¯¹æ¯”ä¸€ä¸‹(æ–‡ä»¶å¤§å°100MB)ï¼š\nOld version Sequences version wc æ—¶é—´ 4.6s 0.8s 0.4s å³°å€¼å†…å­˜ 132M 115M 1M ç»è¿‡Sequencesé‡æ„ä¹‹åï¼Œæ‰§è¡Œæ—¶é—´æœ‰äº†å·¨å¤§çš„æå‡ï¼Œå¹¶ä¸”æœ€å¤§å†…å­˜ä½¿ç”¨é‡ä¹Ÿæœ‰æ‰€å‡å°‘ï¼Œä¸è¿‡ä¸wcè¿˜æ˜¯æœ‰ä¸å°‘å·®è·ã€‚å¸Œæœ›æœ‰ä¸€å¤©èƒ½å¤Ÿæ‰¾åˆ°è¶…è¶Šwcçš„æ–¹æ³•ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":117,"section":"posts","summary":"Racketè¯­è¨€å¼€å‘å‘½ä»¤è¡Œç¨‹åºååˆ†ç®€å•ï¼Œè€Œä¸”æ”¯æŒè·¨å¹³å°ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å¼€å‘å„ç§æ–¹ä¾¿çš„å·¥å…·ç¨‹åºã€‚ä¸‹é¢å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„wcç¨‹åºï¼Œåªéœ€50å¤šè¡Œ","tags":["racket"],"title":"ä¸åˆ°60è¡Œä»£ç ï¼Œç”¨Racketå®ç°wcå‘½ä»¤","uri":"https://lvsq.net/2021/08/racket-wc/","year":"2021"},{"content":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…çš„å­—èŠ‚æ•°ä¹Ÿæ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™å¯¹äºæˆ‘ä»¬è°ƒè¯•å’Œä¼˜åŒ–ä»£ç å¾ˆæœ‰å¸®åŠ©ï¼Œä¸è¿‡Matthew Flattå¹¶æ²¡æœ‰æ‰“ç®—å°†Racketçš„timeå‡½æ•°æ·»åŠ è¿™ä¸€åŠŸèƒ½ï¼Œå°½ç®¡å¦‚æ­¤ï¼ŒMatthew Flattæä¾›äº†ä¸€ä¸ªæ€è·¯ï¼Œåªæ˜¯ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚\nChez Schemeçš„timeå‡½æ•°æ‰“å°çš„æ ¼å¼å¦‚ä¸‹ï¼š\n19 collections\n0.201254290s elapsed cpu time, including 0.183228711s collecting\n0.201678000s elapsed real time, including 0.183665000s collecting\n160012160 bytes allocated, including 113015168 bytes reclaimed\nä¸€ä¸‹æ˜¯æ”¹è¿›çš„timeå‡½æ•°ï¼Œåå­—å«time2:\n(define (time2 proc lst) (let ([mem-before (current-memory-use \u0026#39;cumulative)]) (let-values ([(r cpu-time real-time gc-time) (time-apply proc lst)]) (let ([mem-now (current-memory-use \u0026#39;cumulative)]) (values r (format \u0026#34;~ams elapsed cpu time\u0026#34; cpu-time) (format \u0026#34;~ams elapsed real time\u0026#34; real-time) (format \u0026#34;~ams elapsed gc time\u0026#34; gc-time) (format \u0026#34;~a bytes allocated\u0026#34; (- mem-now mem-before))))))) \u0026gt; (time2 make-list \u0026#39;(10000000 0)) \u0026#34;177ms elapsed cpu time\u0026#34; \u0026#34;178ms elapsed real time\u0026#34; \u0026#34;153ms elapsed gc time\u0026#34; \u0026#34;160100112 bytes allocated\u0026#34; (time2 make-bytes \u0026#39;(10000)) \u0026#34;0ms elapsed cpu time\u0026#34; \u0026#34;0ms elapsed real time\u0026#34; \u0026#34;0ms elapsed gc time\u0026#34; \u0026#34;10544 bytes allocated\u0026#34; åˆ†é…çš„å­—èŠ‚æ•°ä¸ä¼šéå¸¸ç²¾ç¡®ï¼Œæ¯”å¦‚æ²¡æœ‰è€ƒè™‘å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œä¸è¿‡åœ¨REPLä¸­å€’æ˜¯å¯ä»¥ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šä¸ä¼šæœ‰å¤ªå¤§çš„åå·®ã€‚\ncurrent-memory-useå’Œcustodian\ncurrent-memory-useå‡½æ•°çš„å‚æ•°æœ‰3ç§æ¨¡å¼ï¼š\n(current-memory-use [mode]) â†’ exact-nonnegative-integer?\nmode : (or/c #f \u0026lsquo;cumulative custodian?) = #f\nç¬¬ä¸‰ç§modeå«åš custodian? ï¼Œ è¿™æ˜¯Racketæä¾›çš„ä¸€ç§ç›‘æŠ¤æœºåˆ¶.\ncustodian å¯ä»¥ç”¨æ¥ç®¡ç†ä¸€ç»„çº¿ç¨‹ã€æ–‡ä»¶æµç«¯å£ã€TCPç«¯å£ã€TCPç›‘å¬å™¨ã€UDP socketsã€å­—èŠ‚è½¬æ¢å™¨ã€placeã€‚å½“çº¿ç¨‹æˆ–è€…ç«¯å£ç­‰ç­‰è¢«åˆ›å»ºæ—¶ï¼Œå®ƒå°±ç½®äº(current-custodian)çš„ç›‘æŠ¤ä¹‹ä¸‹ï¼Œé™¤äº†root custodian, æ¯ä¸€ä¸ªcustodianéƒ½å¤„äºå…¶çˆ¶çº§çš„custodiançš„ç®¡ç†ä¹‹ä¸‹ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå±‚æ¬¡ç»“æ„ã€‚\nå½“ä¸€ä¸ªcustodianè¢«( custodian-shutdown-all )å…³é—­æ—¶ï¼Œå®ƒä¼šç«‹å³ä¸”å¼ºåˆ¶ç»ˆç»“å…¶ä¸‹ç®¡ç†çš„çº¿ç¨‹ã€ç«¯å£ç­‰ç­‰ã€‚\ncustodianåœ¨å¾ˆå¤šåœºæ™¯ä¸­å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç”¨äºé‡Šæ”¾èµ„æºï¼š\n#lang racket (define done-chan (make-channel)) (define (print-hello) (define my-cust (make-custodian)) ;; å®šä¹‰ç›‘æŠ¤äºº,ä¾¿äºæ¸…ç†æ‰€æœ‰ç›¸å…³èµ„æº (parameterize ([current-custodian my-cust]) (thread (lambda () (let loop () (displayln \u0026#34;Hello\u0026#34;) (sleep 3) (loop)))) (thread (lambda () (let loop () (define item (channel-get done-chan)) (custodian-shutdown-all my-cust)))))) (print-hello) ;; (channel-put done-chan #t) è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªcustodianï¼Œ å¹¶å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹ç”±è¿™ä¸ªcustodianç®¡ç†ï¼ˆ(parameterize ([current-custodian my-cust]))ï¼‰ã€‚ä¸€ä¸ªçº¿ç¨‹æ¯éš”3ç§’é’Ÿæ‰“å°ä¸€ä¸ªâ€œHelloâ€ï¼Œæ°¸ä¸åœæ­¢ã€‚å¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…done-chan æ¶ˆæ¯ï¼Œå¦‚æœæœ‰æ¶ˆæ¯ï¼Œåˆ™å…³é—­custodian, åŒæ—¶å…³é—­è¿™ä¸ªcustodianä¸‹çš„ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±é‡Šæ”¾äº†èµ„æºã€‚\ncustodianè¿˜å¯ä»¥ç”¨æ¥é™åˆ¶å†…å­˜çš„ä½¿ç”¨é‡ï¼š\n(custodian-limit-memory (current-custodian) (* 2 1024)) (define x (make-bytes (* 4 1024))) è¿è¡Œè¿™æ®µä»£ç ï¼Œä¼šæç¤ºout of memoryï¼ˆåœ¨REPLæ— æ•ˆï¼‰ã€‚\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":118,"section":"posts","summary":"Racketå’ŒChez Schemeä¸€æ ·éƒ½æœ‰timeå‡½æ•°ï¼Œç”¨æ¥æ‰“å°å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼ŒChez Schemeçš„timeå‡½æ•°ä¼šæŠŠåˆ†é…","tags":["racket"],"title":"æ”¹è¿›Racketçš„timeå‡½æ•°","uri":"https://lvsq.net/2021/07/racket-time-improvement/","year":"2021"},{"content":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š\n(thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰:\n(define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©ç”¨therad-waitæ¥ç­‰å¾…å…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œæˆ.\n(define worker (thread (lambda () (for ([i 100]) (printf \u0026#34;Working hard... ~a~n\u0026#34; i))))) (thread-wait worker) (displayln \u0026#34;Worker finished\u0026#34;) Thread Mailboxes æ¯ä¸ªçº¿ç¨‹å…·å¤‡ä¸€ä¸ªé‚®ç®±æ¥æ¥å—æ¶ˆæ¯ï¼Œthread-sendç”¨äºå¼‚æ­¥åœ°å‘ä¸€ä¸ªçº¿ç¨‹å‘é€æ¶ˆæ¯ï¼Œthread-receiveå¯è·å–é‚®ç®±ä¸­æœ€è€çš„æ¶ˆæ¯,å¦‚æœ‰å¿…è¦çº¿ç¨‹ä¼šé˜»å¡ç­‰å¾…æ¶ˆæ¯åˆ°æ¥ã€‚ è¿™å°±æ˜¯Actorå¹¶å‘æ¨¡å‹ï¼ŒErlangä¹Ÿæ˜¯é‡‡ç”¨è¿™ç§æ¨¡å‹ã€‚\n(define worker-thread (thread (lambda () (let loop () (match (thread-receive) [(? number? num) (printf \u0026#34;Processing ~a~n\u0026#34; num) (loop)] [\u0026#39;done (printf \u0026#34;Done~n\u0026#34;)]))))) (for ([i 20]) (thread-send worker-thread i)) (thread-send worker-thread \u0026#39;done) (thread-wait worker-thread) Semaphores ç”¨äºåŒæ­¥ã€‚\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (semaphore-wait output-semaphore) (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i) (semaphore-post output-semaphore))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) æˆ–è€…ä½¿ç”¨call-with-semaphoreï¼Œä¸ç”¨æ˜¾å¼åœ°é‡Šæ”¾ä¿¡å·é‡\n(define output-semaphore (make-semaphore 1)) (define (make-thread name) (thread (lambda () (for [(i 10)] (call-with-semaphore output-semaphore (lambda () (printf \u0026#34;thread ~a: ~a~n\u0026#34; name i))))))) (define threads (map make-thread \u0026#39;(A B C))) (for-each thread-wait threads) Channels é€šé“ç”¨äºçº¿ç¨‹ä¹‹é—´ä¼ é€’æ•°æ®,Golangé‡‡å–çš„å°±æ˜¯è¿™ç§æ–¹å¼ã€‚\nchannel-putç”¨æ¥å‘é€æ•°æ®åˆ°é€šé“ï¼Œchannel-getå¯ä»¥ä»é€šé“ä¸­è·å–æ•°æ®.\n(define result-channel (make-channel)) (define result-thread (thread (lambda () (let loop () (display (channel-get result-channel)) (loop))))) (define work-channel (make-channel)) (define (make-worker thread-id) (thread (lambda () (let loop () (define item (channel-get work-channel)) (case item [(DONE) (channel-put result-channel (format \u0026#34;Thread ~a done\\n\u0026#34; thread-id))] [else (channel-put result-channel (format \u0026#34;Thread ~a processed ~a\\n\u0026#34; thread-id item)) (loop)]))))) (define work-threads (map make-worker \u0026#39;(1 2))) (for ([item \u0026#39;(A B C D E F G H DONE DONE)]) (channel-put work-channel item)) (for-each thread-wait work-threads) (channel-put result-channel \u0026#34;\u0026#34;) ; waits until result-thread has printed all other output ç¼“å†²å¼‚æ­¥é€šé“Buffered Asynchronous Channels ä¸ä¸Šè¿°çš„channelç±»ä¼¼ï¼Œåªæ˜¯BACä¼šæœ‰ä¸€å®šçš„ç¼“å†²åŒºï¼Œä¸€èˆ¬ä¸ä¼šè¢«é˜»å¡ï¼Œé™¤éç¼“å†²åŒºæ»¡äº†ï¼ˆputæ“ä½œï¼‰æˆ–è€…ç©ºï¼ˆgetæ“ä½œï¼‰.\n(require racket/async-channel) (define print-thread (thread (lambda () (let loop () (displayln (thread-receive)) (loop))))) (define (safer-printf . items) (thread-send print-thread (apply format items))) (define work-channel (make-async-channel 3)) (define (make-worker-thread thread-id) (thread (lambda () (let loop () (define item (async-channel-get work-channel)) (safer-printf \u0026#34;Thread ~a processing item: ~a\u0026#34; thread-id item) (loop))))) (for-each make-worker-thread \u0026#39;(1 2 3)) (for ([item \u0026#39;(a b c d e f g h i j k l m)]) (async-channel-put work-channel item)) åŒæ­¥äº‹ä»¶å’Œsync (define main-thread (current-thread)) (define alarm (alarm-evt (+ 3000 (current-inexact-milliseconds)))) (define channel (make-channel)) (define (make-worker-thread thread-id) (thread (lambda () (define evt (sync channel alarm)) (cond [(equal? evt alarm) (thread-send main-thread \u0026#39;alarm)] [else (thread-send main-thread (format \u0026#34;Thread ~a received ~a\u0026#34; thread-id evt))])))) (make-worker-thread 1) (make-worker-thread 2) (make-worker-thread 3) (channel-put channel \u0026#39;A) (channel-put channel \u0026#39;B) (let loop () (match (thread-receive) [\u0026#39;alarm (displayln \u0026#34;Done\u0026#34;)] [result (displayln result) (loop)])) æ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":119,"section":"posts","summary":"Threads åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼š (thread (lambda() (displayln \u0026#34;This is a new thread\u0026#34;))) ä¼‘çœ çº¿ç¨‹å¹¶ä¸”æ€æ‰: (define worker (thread (lambda () (let loop () (displayln \u0026#34;Working...\u0026#34;) (sleep 0.2) (loop))))) (sleep 2.5) (kill-thread worker) å¦‚æœä¸»çº¿ç¨‹é€€å‡ºæˆ–è€…è¢«æ€æ‰ï¼Œå…¶å­çº¿ç¨‹ä¹Ÿé¢ä¸´ç€é€€å‡º, å¯ä»¥åˆ©","tags":["racket","thread"],"title":"Racket å¹¶å‘ä¸åŒæ­¥","uri":"https://lvsq.net/2021/07/racket-concurrency/","year":"2021"},{"content":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set!\né€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥è®¤ä¸ºä¸€ä¸ª.rkt æ–‡ä»¶é‡Œçš„å†…å®¹å±äºæŸä¸€ä¸ªæ¨¡å—ï¼Œæ¨¡å—åå°±æ˜¯æ–‡ä»¶åã€‚\nåœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼šmod_demo\nâ”œâ”€â”€ mod_demo\nâ”‚ â”œâ”€â”€ ext\nâ”‚ â”‚ â””â”€â”€ cake.rkt\nâ”‚ â””â”€â”€ main.rkt\nmod_demoç›®å½•ä¸‹æœ‰ä¸€ä¸ªmain.rktæ¨¡å—ï¼Œå’Œä¸€ä¸ªextç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹æœ‰ä¸€ä¸ªcake.rktçš„æ¨¡å—ã€‚\ncake.rktçš„å†…å®¹å¦‚ä¸‹ï¼š\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (provide print-cake) æ„å‘³ç€å°†å‡½æ•°print-cakeå¯¼å‡ºï¼Œåœ¨æ¨¡å—å¤–éƒ¨å°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°äº†ï¼›è¿˜æœ‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°show, è¯¥å‡½æ•°æœªå¯¼å‡ºï¼Œæ‰€ä»¥å¤–éƒ¨æ— æ³•è®¿é—®ã€‚ main.rktçš„å†…å®¹ä¸ºï¼š\n#lang racket (require \u0026#34;ext/cake.rkt\u0026#34;) (print-cake (random 30)) (require \u0026ldquo;ext/cake.rkt\u0026rdquo;) å°†cakeæ¨¡å—å¼•å…¥ï¼Œå¼•ç”¨è·¯å¾„ç¬¦åˆUnixé£æ ¼(ä½†æ˜¯ï¼Œä¸èƒ½ä»¥æ–‡ä»¶åˆ†éš”ç¬¦å³\u0026rsquo;/\u0026lsquo;ä½œä¸ºå¼€å§‹æˆ–è€…ç»“æŸ)ï¼Œä¹Ÿæ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œ(require \u0026ldquo;./ext/cake.rkt\u0026rdquo;) ä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ã€‚\nCollections collectionä¸­çš„æ¨¡å—é€šè¿‡ä¸å¸¦å¼•å·çš„ã€æ— åç¼€çš„è·¯å¾„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼šä»¥ä¸‹æ¨¡å—å¼•ç”¨äº†ä½œä¸ºâ€œracketâ€ collectionä¸€éƒ¨åˆ†çš„â€œdate.rktâ€åº“ï¼š\n#lang racket (require racket/date) (printf \u0026#34;Today is ~s\\n\u0026#34; (date-\u0026gt;string (seconds-\u0026gt;date (current-seconds)))) æ³¨æ„ï¼Œ(require racket/date)æ²¡æœ‰å¸¦åŒå¼•å·ã€‚åƒracket/dateè¿™æ ·çš„æ¨¡å—çœ‹èµ·æ¥åƒä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œå½“requireçœ‹åˆ°ä¸€ä¸ªæœªåŠ å¼•å·çš„æ¨¡å—å¼•ç”¨æ—¶ï¼Œå®ƒä¼šå°†å¼•ç”¨è½¬æ¢ä¸ºåŸºäºcollectionçš„æ¨¡å—è·¯å¾„ï¼š\né¦–å…ˆï¼Œå¦‚æœæœªå¼•ç”¨çš„è·¯å¾„ä¸åŒ…å« /ï¼Œç„¶å requireä¼šè‡ªåŠ¨å‘å¼•ç”¨æ·»åŠ ä¸€ä¸ªâ€œ/mainâ€ã€‚ä¾‹å¦‚ï¼Œ( require slideshow )ç­‰æ•ˆäº( require slideshow/main )ã€‚ å…¶æ¬¡ï¼Œrequire å‘è·¯å¾„éšå¼æ·»åŠ äº†â€œ.rktâ€åç¼€ã€‚ æœ€åï¼Œrequireé€šè¿‡åœ¨å·²å®‰è£…çš„collectionä¸­æœç´¢æ¥è§£æè·¯å¾„ï¼Œè€Œä¸æ˜¯å°†è·¯å¾„è§†ä¸ºç›¸å¯¹äºå°é—­æ¨¡å—çš„è·¯å¾„ã€‚ Packages and Collections ä¸€ä¸ªpackageæ˜¯ä¸€ç»„é€šè¿‡RacketåŒ…ç®¡ç†å™¨å®‰è£…çš„åº“çš„é›†åˆã€‚Racket ç¨‹åºä¸ç›´æ¥å¼•ç”¨åŒ…ã€‚ç›¸åï¼Œç¨‹åºé€šè¿‡collectionså¼•ç”¨åº“ï¼Œå¹¶ä¸”æ·»åŠ æˆ–åˆ é™¤åŒ…ä¼šæ›´æ”¹å¯ç”¨çš„åŸºäºé›†åˆçš„åº“é›†ã€‚\næ·»åŠ Collections libraryçš„æ—¨åœ¨è·¨å¤šä¸ªé¡¹ç›®ä½¿ç”¨ï¼Œå› æ­¤å°†åº“çš„æºæ–‡ä»¶ä¿å­˜åœ¨ä¸€ä¸ªç›®å½•ä¸­å¹¶æ²¡æœ‰æ„ä¹‰ï¼Œæ›´ä¸èƒ½å°†åº“å¤åˆ¶åˆ°ä¸åŒçš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯æ–°å¢ä¸€ä¸ªcollectionï¼Œå°†libæ”¾åœ¨collectionä¸­ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸å¸¦å¼•å·çš„è·¯å¾„å¼•ç”¨å®ƒï¼Œå°±åƒRacket å‘è¡Œç‰ˆä¸­åŒ…å«çš„åº“ä¸€æ ·ã€‚\nä¸ç”¨æ‹…å¿ƒï¼Œåˆ›å»ºä¸€ä¸ªåŒ…æ— éœ€æäº¤åˆ°å…¬å¼€çš„åŒ…æœåŠ¡å™¨ï¼Œå¯ä»¥å®‰è£…åˆ°æœ¬åœ°æ¥ä½¿ç”¨ã€‚\né‡‡ç”¨raco pkgå‘½ä»¤è¡Œå·¥å…·ï¼š raco pkg install \u0026ndash;link /path/to/mod_demo\nå®‰è£…ä¹‹åï¼Œåœ¨ä»»ä½•æ¨¡å—ä¸­ä½¿ç”¨(require mod_demo/ext/cake)éƒ½ä¼šä»/path/to/mod_demo/ext/cake.rktå¯¼å…¥print-cakeå«å‡½æ•°ã€‚\n\u0026gt; (require mod_demo/ext/cake) \u0026gt; (print-cake 4) ...... .-||||||-. | | ------------ \u0026gt; é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨å®‰è£…çš„ç›®å½•åç§°æ—¢ç”¨ä½œåŒ…åç§°åˆç”¨ä½œåŒ…æä¾›çš„collection\nå°†libæ”¾å…¥collectionä¹‹åï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨raco makeæ¥ç¼–è¯‘åº“çš„æºæ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨raco setupæ›´åŠ æ–¹ä¾¿ã€‚å°¤å…¶æ˜¯ä¿®æ”¹äº†æ¨¡å—ä»£ç åï¼Œä½¿ç”¨raco setupä¼šé‡æ–°ç¼–è¯‘æ‰€æœ‰åº“æ–‡ä»¶ï¼Œå¹¶é‡æ–°å®‰è£…åŒ…ã€‚ä¸raco makeä¸åŒçš„æ˜¯ï¼Œraco setup åé¢çš„å‚æ•°æ˜¯åŒ…åï¼Œå³raco setup mod_demo, è€Œraco makeåé¢æ˜¯æ¨¡å—åï¼Œå³raco make main.rktã€‚\næ¨¡å—è¯­æ³• æ¨¡å—æ–‡ä»¶å¼€å¤´å¤„çš„#langå…¶å®æ˜¯æ¨¡å—å½¢å¼çš„ç®€å†™ï¼Œä½†ä¸èƒ½ç”¨äºREPLã€‚\næ¨¡å—å½¢å¼ æ™®é€šå½¢å¼çš„æ¨¡å—å£°æ˜ï¼Œå¯ä»¥å·¥ä½œäºREPL\n(module name-id initial-module-path decl \u0026hellip;)\nname-idæ˜¯æ¨¡å—çš„åå­—ï¼Œinitial-module-path ä¸ºåˆå§‹åŒ–å¯¼å…¥ï¼Œæ¯ä¸ªdeclå¯ä»¥æ˜¯å¯¼å…¥ï¼Œæˆ–è€…å¯¼å‡ºï¼Œæˆ–è€…å®šä¹‰ï¼Œæˆ–è€…è¡¨è¾¾å¼ã€‚\ninitial-module-pathæ˜¯å¿…é¡»çš„ï¼Œæ¨¡å—å†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªç¯å¢ƒï¼ˆSICPä¸­çš„ç¯å¢ƒï¼Œå³ä¸Šä¸‹æ–‡ï¼‰ï¼Œå†…éƒ¨ä½¿ç”¨çš„æŒ‡ä»¤æ˜¯éœ€è¦é€šè¿‡initial-module-pathå¼•å¯¼çš„ã€‚å¸¸ç”¨çš„initial-module-pathæ˜¯racket, require/define/provideç­‰ç­‰éƒ½æ¥è‡ªracketã€‚å¦ä¸€ä¸ªå¸¸ç”¨çš„initial-module-pathæ˜¯racket-base,å®ƒæä¾›çš„åŠŸèƒ½è¾ƒå°‘ï¼Œä½†ä»ç„¶æ˜¯å¾ˆå¸¸ç”¨ã€‚\nä¸Šä¸€èŠ‚ä¸­çš„â€œcake.rktâ€ä¹Ÿå¯ä»¥å†™æˆï¼š\n(module cake racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline))) è¿™ç§æ¨¡å—å½¢å¼æ˜¯å¯ä»¥è¢«REPLæ±‚å€¼çš„ï¼ˆæ³¨æ„(require \u0026lsquo;cake)ï¼Œ æ¨¡å—åcakeéœ€è¦è¢«quoteï¼Œå› ä¸ºè¿™æ—¶cakeæ˜¯éæ–‡ä»¶çš„æ¨¡å—å£°æ˜ï¼‰ï¼š\n\u0026gt; (require \u0026#39;cake) \u0026gt; (print-cake 3) ... .-|||-. | | --------- å£°æ˜ä¸€ä¸ªæ¨¡å—ï¼Œå…¶bodyä¸ä¼šè¢«ç«‹åˆ»æ±‚å€¼ï¼Œåªæœ‰åœ¨æ˜¾å¼åœ°è¢«requireä¹‹åæ‰ä¼šæ±‚å€¼ä¸€æ¬¡ã€‚\n\u0026gt; (module hi racket (printf \u0026#34;Hello\\n\u0026#34;)) \u0026gt; (require \u0026#39;hi) Hello \u0026gt; (require \u0026#39;hi) #lang #langå£°æ˜çš„æ¨¡å—çš„bodyæ²¡æœ‰ç‰¹å®šçš„è¯­æ³•ï¼Œå› ä¸ºå…¶è¯­æ³•ç”±#langä¹‹åçš„åç§°æ‰€å†³å®šã€‚\næ¯”å¦‚ï¼Œ#lang racketçš„è¯­æ³•æ˜¯ï¼š\n#lang racket decl ... ç­‰åŒäºï¼š\n(module name racket decl ...) nameæ˜¯åŒ…å«#langå½¢å¼çš„æ–‡ä»¶å\nå­æ¨¡å— ä¸€ä¸ªæ¨¡å—å¯ä»¥åµŒå¥—åœ¨å¦ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œçˆ¶æ¨¡å—å¯ä»¥ç›´æ¥è®¿é—®å­æ¨¡å—å¯¼å‡ºçš„å‡½æ•°ã€å®šä¹‰ã€è¡¨è¾¾å¼ã€‚\n#lang racket (module zoo racket (provide tiger) (define tiger \u0026#34;Tony\u0026#34;)) (require \u0026#39;zoo) tiger module* module*å½¢å¼ç±»ä¼¼moduleï¼š\n(module* name-id initial-module-path-or-#f decl ...) module*ä¸moduleçš„ä¸åŒä¹‹å¤„åœ¨äºï¼š\nç”±moduleå£°æ˜çš„å­æ¨¡å—ï¼Œå¯ä»¥è¢«å…¶çˆ¶æ¨¡å—require, ä½†æ˜¯å­æ¨¡å—ä¸èƒ½requireçˆ¶æ¨¡å—ï¼› ç”±module*å£°æ˜çš„å­—æ¨¡å—ï¼Œå¯ä»¥requireçˆ¶æ¨¡å—ï¼Œä½†æ˜¯çˆ¶æ¨¡å—ä¸èƒ½requireè¯¥å­æ¨¡å—ï¼› æ­¤å¤–ï¼Œmodule*å½¢å¼å¯ä»¥ç”¨#fä»£æ›¿initial-module-pathï¼Œè¿™æ„å‘³ç€ï¼Œå­æ¨¡å—å¯ä»¥è®¿é—®çˆ¶æ¨¡å—æ‰€ä»¥ç»‘å®šï¼ŒåŒ…æ‹¬æœªé€šè¿‡provideå¯¼å‡ºçš„ç»‘å®šã€‚\nå› æ­¤ï¼Œç”¨module*å’Œ#fæ¥å£°æ˜ä¸€ä¸ªæ¨¡å—çš„ä¸€ä¸ªç”¨é€”æ˜¯ï¼Œå°†æŸä¸ªæ¨¡å—æœªprovideå‡ºå»çš„ç»‘å®šå¯¼å‡ºã€‚\n#lang racket (provide print-cake) (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* extras #f (provide show)) å°½ç®¡showå‡½æ•°æœªå¯¼å‡ºï¼Œä½†æ˜¯å­æ¨¡å—extraså´å°†å…¶å¯¼å‡ºäº†ï¼Œå¤–éƒ¨ç¨‹åºå¯ä»¥ä½¿ç”¨(require (submod \u0026ldquo;caske.rkt\u0026rdquo; extras))æ¥è®¿é—®éšè—çš„showå‡½æ•°ã€‚\nMainå’ŒTestå­æ¨¡å— #lang racket (define (print-cake n) (show \u0026#34; ~a \u0026#34; n #\\.) (show \u0026#34; .-~a-. \u0026#34; n #\\|) (show \u0026#34; | ~a | \u0026#34; n #\\space) (show \u0026#34;---~a---\u0026#34; n #\\-)) (define (show fmt n ch) (printf fmt (make-string n ch)) (newline)) (module* main #f (print-cake 10)) è¿™ä¸ªâ€œcake.rktâ€å˜ä½“ï¼ŒåŒ…å«äº†ä¸€ä¸ªmainå­æ¨¡å—ï¼Œå¹¶è°ƒç”¨äº†print-cakeå‡½æ•°ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œè¿è¡Œä¸€ä¸ªæ¨¡å—æ—¶å¹¶ä¸ä¼šè¿è¡Œå…¶ä¸­ç”±module*å£°æ˜çš„å­æ¨¡å—ï¼Œä½†æ˜¯mainå­æ¨¡å—é™¤å¤–ã€‚\nmainå­æ¨¡å—å¹¶ä¸ä¸€å®šç”±module*å£°æ˜ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨çˆ¶æ¨¡å—çš„ç»‘å®šï¼Œä¹Ÿå¯ä»¥ç”±moduleæ¥å£°æ˜ã€‚ æ›´å¸¸è§çš„åšæ³•æ˜¯ç”±module+æ¥å£°æ˜\n``lisp (module+ name-id decl \u0026hellip;)\nmodule+å£°æ˜çš„æ¨¡å—å°±åƒé‡‡ç”¨module*å£°æ˜ä¸”ä½¿ç”¨#fä½œä¸ºinitial-module-pathçš„æ¨¡å—ã€‚æ­¤å¤–ï¼Œå¤šä¸ªmodule+æ¨¡å—å¯ä»¥åŒåï¼ŒåŒåçš„æ¨¡å—ä¼šç»„åˆæˆä¸€ä¸ªæ¨¡å—ã€‚è¿™ç§ç»„åˆç‰¹æ€§å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªtestæ¨¡å—ï¼Œåœ¨ä½¿ç”¨ raco testå‘½ä»¤æ—¶å°±å¯ä»¥å¤§æ˜¾èº«æ‰‹äº†ã€‚ å‡è®¾\u0026#34;physics.rkt\u0026#34; ä¸ºï¼š ```lisp #lang racket (module+ test (require rackunit) (define Îµ 1e-10)) (provide drop to-energy) (define (drop t) (* 1/2 9.8 t t)) (module+ test (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ)) (define (to-energy m) (* m (expt 299792458.0 2))) (module+ test (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) å¯¼å…¥\u0026quot;physics.rkt\u0026quot; æ—¶ï¼Œå¹¶ä¸ä¼šè¿è¡Œdropå’Œto-energyçš„æµ‹è¯•ï¼Œä¸è¿‡è¿è¡Œraco test physics.rktå°†ä¼šæ‰§è¡Œè¿™äº›æµ‹è¯•ã€‚\nè¿™ç­‰ä»·äºä½¿ç”¨module*:\n#lang racket (provide drop to-energy) (define (drop t) (* 1/2 49/5 t t)) (define (to-energy m) (* m (expt 299792458 2))) (module* test #f (require rackunit) (define Îµ 1e-10) (check-= (drop 0) 0 Îµ) (check-= (drop 10) 490 Îµ) (check-= (to-energy 0) 0 Îµ) (check-= (to-energy 1) 9e+16 1e+15)) module+çš„ç»„åˆè¡Œä¸ºå¯¹mainæ¨¡å—ä¹Ÿæœ‰å¸®åŠ©ï¼Œå³ä½¿ä¸éœ€è¦ç»„åˆï¼Œ ( module+ main \u0026hellip;. )ä¹Ÿæ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒæ¯”( module* main #f \u0026hellip;. )æ›´å…·å¯è¯»æ€§ ã€‚\nRequire requireçš„å®šä¹‰ä¸ºï¼š\n(require require-spec \u0026hellip;)\nonly-in ç”¨æ¥é™åˆ¶æ¨¡å—å¯¼å‡ºçš„ç»‘å®šï¼Œä¹Ÿå¯é‡å‘½åç»‘å®š\n\u0026gt; (module m (lib \u0026#34;racket\u0026#34;) (provide tastes-great? less-filling?) (define tastes-great? #t) (define less-filling? #t)) \u0026gt; (require (only-in \u0026#39;m tastes-great?)) \u0026gt; tastes-great? #t \u0026gt; less-filling? less-filling?: undefined; cannot reference an identifier before its definition in module: top-level \u0026gt; (require (only-in \u0026#39;m [less-filling? lite?])) \u0026gt; lite? #t except-in æ˜¯only-inçš„è¡¥å……ï¼Œç”¨æ¥æ’é™¤æŸäº›ç»‘å®š\n(except-in require-spec id \u0026hellip;)\nrename-in ä¸only-inç±»ä¼¼ã€‚\n(rename-in require-spec [orig-id bind-id] \u0026hellip;)\nprefix-in (prefix-in prefix-id require-spec) ç»™æ¯ä¸€ä¸ªrequire-specçš„ç»‘å®šæ·»åŠ å‰ç¼€\nProvide (provide provide-spec \u0026hellip;)\nprovide-specå…è®¸é€’å½’å®šä¹‰ï¼š\nid: æœ€ç®€å•çš„å½¢å¼ï¼Œä¸Šæ–‡ä¸­å¤šæ¬¡å‡ºç°\n(rename-out [orig-id export-id] \u0026hellip;): é‡å‘½åå¯¼å‡ºçš„ç»‘å®š\n(struct-out struct-id): å¯¼å‡ºstruct\n(all-defined-out): å¯¼å‡ºæ‰€æœ‰ç»‘å®šï¼Œä¸æ¨è\n(all-from-out module-path): å¯¼å‡ºæ‰€æœ‰ç”±module-pathæŒ‡å®šçš„ç»‘å®š\n(except-out provide-spec id \u0026hellip;): æ’é™¤idæŒ‡å®šçš„ç»‘å®š\n(prefix-out prefix-id provide-spec)ï¼šç»™æ¯ä¸ªå¯¼å‡ºç»‘å®šæ·»åŠ ä¸€ä¸ªå‰ç¼€\næ¬¢è¿åŠ å…¥Racket éšä¿®ä¼š ï¼š731859928(QQ)\n","id":120,"section":"posts","summary":"æ¨¡å—åŸºç¡€ ä¸€ä¸ªæ¨¡å—å¯ä»¥è¢«å¦ä¸€ä¸ªæ¨¡å—ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å—å†…éƒ¨çš„å˜é‡ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œå³set! é€šå¸¸ï¼Œæ¯ä¸ªRacketæ¨¡å—é©»ç•™åœ¨è‡ªå·±çš„æ–‡ä»¶ä¸­ï¼Œæ¢å¥è¯è¯´ï¼Œå¯ä»¥","tags":["racket","module"],"title":"Racket Modules","uri":"https://lvsq.net/2021/07/racket-modules/","year":"2021"},{"content":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜:\nç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ içš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º(i, $a_i$) å’Œ (i, 0) ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸Â xÂ è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚\nè¯´æ˜ï¼šä¸èƒ½å€¾æ–œå®¹å™¨\næ›´è¯¦ç»†çš„æè¿°è¯·è®¿é—®ï¼šhttps://leetcode-cn.com/problems/container-with-most-water/\né¦–å…ˆå¯ä»¥æƒ³åˆ°çš„æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯æš´åŠ›æ±‚è§£ï¼Œå°†æ‰€æœ‰çš„é¢ç§¯éƒ½è®¡ç®—å‡ºæ¥ï¼Œå–æœ€å¤§å€¼å³å¯ã€‚ä¸‹é¢ç»™å‡º(Racket)[https://racket-lang.org/]çš„ä»£ç ï¼Œå¾—ç›Šäºå‡½æ•°å¼è¯­è¨€å’ŒSè¡¨è¾¾å¼å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œä»£ç å¯ä»¥å¾ˆçŸ­ï¼š\n(define/contract (max-area height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define len (length height)) (cond ((\u0026lt; len 2) 0) ((= len 2) (area (list 1 (car height)) (list 2 (cadr height)))) (else (max (each-area height) (max-area (cdr height)))))) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (define (each-area height) (let ([first (list 1 (car height))]) (foldl max 0 (map (lambda (i h) (area first (list i h))) (range 2 (add1 (length height)) ) (cdr height))))) ä¸Šè¿°è§£æ³•è™½ç„¶æ­£ç¡®ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆä½, å¦‚æœæœ‰10000ä¸ªæ•´æ•°ï¼Œå³n=10000ï¼Œå…¶æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†2ç§’ï¼š\n(time (max-area (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 2387 real time: 2466 gc time: 137 é‚£ä¹ˆæœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•å—ï¼Ÿ\næ˜¾ç„¶å¯ä»¥è®¤ä¸ºæ‰€æœ‰æ•´æ•°éƒ½ä¿å­˜åœ¨ä¸€ä¸ªåˆ—è¡¨æˆ–è€…æ•°ç»„ä¸­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå«headï¼ŒæŒ‡å‘ç¬¬ä¸€ä¸ªæ•´æ•°, è¡¨ç¤ºä¸ºï¼šhead -\u0026gt; (i, $h_i$)ï¼Œiä¸ºåˆ—è¡¨ä¸‹æ ‡ï¼Œ $h_i$ä»£è¡¨ç¬¬iä¸ªæ•´æ•°å€¼ï¼›å¦ä¸€ä¸ªå«tailï¼ŒæŒ‡å‘æœ€åä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸ºtail -\u0026gt; (j, $h_j$)ï¼Œæˆ‘ä»¬å¯ä»¥ä»…ä»…åˆ©ç”¨è¿™ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨ï¼Œå°±èƒ½è®¡ç®—å‡ºæœ€å¤§çš„é¢ç§¯ï¼Œå…¶è¿‡ç¨‹ä¸ºï¼š\nè®¡ç®—ç”±headå’Œtailå›´æˆçš„çŸ©å½¢çš„é¢ç§¯$S_{ij}$, çŸ©å½¢çš„é•¿åº¦x = j - i, é«˜åº¦y = min ($h_i$, $h_j$); å°†çŸ©å½¢æ”¶çª„ä¸€æ ¼ï¼Œå³xå‡å°‘1ï¼Œé‚£ä¹ˆæœ‰ä¸¤ç§æ”¶çª„æ–¹å¼ï¼š å°†é«˜åº¦çŸ­çš„ä¸€ä¾§æ”¶çª„ï¼Œé‚£ä¹ˆï¼Œæ”¶çª„åé«˜åº¦å¯èƒ½å˜å¤§ï¼Œåˆ™é¢ç§¯å¯èƒ½å¢å¤§; å°†é«˜åº¦é•¿çš„ä¸€ä¾§æ”¶çª„ï¼Œç”±äºå¦ä¸€ä¾§ä¸å˜,ä½†æ˜¯é•¿åº¦å˜å°äº†ä¸€æ ¼ï¼Œåˆ™é¢ç§¯ä¼šå˜å°; å› æ­¤ï¼Œéœ€è¦ç§»åŠ¨é«˜åº¦çŸ­çš„ä¸€ä¾§ï¼Œæ‰æœ‰å¯èƒ½æ‰¾åˆ°é¢ç§¯æ›´å¤§çš„çŸ©å½¢ å¾ˆæ˜¾ç„¶ï¼Œä½¿ç”¨åŒæŒ‡é’ˆç®—æ³•ï¼Œæ—¶é—´å¤æ‚åº¦é™ä½åˆ°äº†$O(n)$ã€‚\nRacket ç‰ˆæœ¬ ;;better solution (define/contract (max-area-pair-pointer height) (-\u0026gt; (listof exact-integer?) exact-integer?) (define (area n1 n2) (* (- (car n2) (car n1)) (min (cadr n1) (cadr n2)))) (let ([len (length height)]) (if (\u0026lt; len 2) 0 (let loop ([h height] [hindex (range 0 len)] [rheight (reverse height)] [rindex (reverse (range 0 len))] [maxa 0]) (let* ([head (list (car hindex) (car h))] [tail (list (car rindex) (car rheight))] [a (area head tail)]) (if (= (car head) (car tail)) maxa (if (\u0026gt; (cadr head) (cadr tail)) (loop h hindex (cdr rheight) (cdr rindex) (max maxa a)) (loop (cdr h) (cdr hindex) rheight rindex (max maxa a))) )))))) å¦‚æœä½¿ç”¨è¿™ä¸ªæ–¹æ³•è®¡ç®—10000ä¸ªæ•´æ•°çš„é¢ç§¯ï¼Œæ‰§è¡Œæ—¶é—´åªéœ€1æ¯«ç§’ï¼Œè€Œä¸”ä¸éœ€è¦GCï¼ˆå¯¹ç…§æš´åŠ›ç ´è§£ç‰ˆæœ¬ï¼Œ2+ç§’ï¼‰\n(time (max-area-pair-pointer (build-list 10000 (lambda(x) (random 1000000))))) =\u0026gt; cpu time: 1 real time: 1 gc time: 0 Rustç‰ˆæœ¬ åŒæ—¶æä¾›ä¸€ä¸ªRustç‰ˆæœ¬çš„å®ç°ï¼Œ\nuse std::cmp::{max, min}; type HeightType = i64; #[derive(Debug)] struct Solution {} impl Solution { pub fn max_area(height: Vec\u0026lt;HeightType\u0026gt;) -\u0026gt; HeightType { let len = height.len(); return if len \u0026lt; 2 { 0 } else { let mut max_area = 0; let mut hi = 0; let mut ti = len - 1; while ti \u0026gt; hi { let hd = height.get(hi).unwrap(); let td = height.get(ti).unwrap(); let a = ((ti - hi) as HeightType) * min(hd, td); max_area = max(max_area, a); if hd \u0026lt; td { hi += 1; } else { ti -= 1; } } max_area }; } } ä¸¤ä¸ªç‰ˆæœ¬åšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒï¼š\nsize Racket(8.0 CS) Rust(1.50.0) 100000 49ms 60ms 1000000 560ms 550ms 10000000 5s 5.6s ä¸¤ä¸ªç‰ˆæœ¬çš„å®ç°å‡æœªä½¿ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–,ä»¤äººæ„å¤–çš„æ˜¯Racketçš„æ‰§è¡Œæ•ˆç‡ä¸Rustå‡ ä¹æ²¡æœ‰å·®åˆ«ï¼Œä½¿ç”¨äº†CSç¼–è¯‘å™¨çš„RacketçœŸæ˜¯çªé£çŒ›è¿›ã€‚ ç”±äºæˆ‘çš„Rustç»éªŒå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæˆ–è®¸æœ‰æ›´å¥½çš„å†™æ³•ã€‚ä»æµ‹è¯•å¯ä»¥çœ‹åˆ°Racketè‡³å°‘åœ¨CPUå¯†é›†å‹åº”ç”¨ä¸­å¯å ªå¤§ç”¨ã€‚\n","id":121,"section":"posts","summary":"è¿™æ˜¯ä¸€ä¸ªleet codeå‡ºç°çš„é—®é¢˜: ç»™ n ä¸ªéè´Ÿæ•´æ•° $a_1$ï¼Œ$a_2$ï¼Œ\u0026hellip;ï¼Œ$a_n$ï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹(i, $a_i$) ã€‚åœ¨","tags":[],"title":"ã€ç››æœ€å¤šæ°´çš„å®¹å™¨ã€‘é—®é¢˜çš„æ±‚è§£","uri":"https://lvsq.net/2021/05/container-with-most-water/","year":"2021"},{"content":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚\nå®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15æ—¥\nåœ¨æŸäº›æ–¹é¢ï¼Œå­¦ä¹ è®¡ç®—æœºç¼–ç¨‹ä¸å­¦ä¹ æ–°è¯­è¨€ç›¸ä¼¼ã€‚å®ƒéœ€è¦å­¦ä¹ æ–°çš„ç¬¦å·å’Œæœ¯è¯­ï¼Œå¿…é¡»æ­£ç¡®ç»„ç»‡è¿™äº›ç¬¦å·å’Œæœ¯è¯­ä»¥æŒ‡å¯¼è®¡ç®—æœºè¯¥æ€ä¹ˆåšã€‚è®¡ç®—æœºä»£ç è¿˜å¿…é¡»è¶³å¤Ÿæ¸…æ™°ï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºå‘˜å¯ä»¥é˜…è¯»å’Œç†è§£ã€‚\nå°½ç®¡å­˜åœ¨è¿™äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œéº»çœç†å·¥å­¦é™¢çš„ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç å¹¶ä¸èƒ½æ¿€æ´»ä¸è¯­è¨€å¤„ç†æœ‰å…³çš„å¤§è„‘åŒºåŸŸã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒæ¿€æ´»äº†ä¸€ä¸ªç§°ä¸ºå¤šéœ€æ±‚ç½‘ç»œçš„åˆ†å¸ƒå¼ç½‘ç»œï¼Œè¯¥ç½‘ç»œä¹Ÿè¢«æ‹›å‹Ÿç”¨äºè§£å†³å¤æ‚çš„è®¤çŸ¥ä»»åŠ¡ï¼Œä¾‹å¦‚è§£å†³æ•°å­¦é—®é¢˜æˆ–å¡«å­—æ¸¸æˆã€‚\nä½†æ˜¯ï¼Œå°½ç®¡é˜…è¯»è®¡ç®—æœºä»£ç ä¼šæ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œï¼Œä½†ä¸æ•°å­¦æˆ–é€»è¾‘é—®é¢˜ç›¸æ¯”ï¼Œå®ƒä¼¼ä¹æ›´å¤šåœ°ä¾èµ–äºç½‘ç»œçš„ä¸åŒéƒ¨åˆ†ï¼Œè¿™è¡¨æ˜ç¼–ç ä¹Ÿä¸èƒ½ç²¾ç¡®åœ°å¤åˆ¶æ•°å­¦çš„è®¤çŸ¥éœ€æ±‚ã€‚\nâ€œç†è§£è®¡ç®—æœºä»£ç ä¼¼ä¹æ˜¯è‡ªå·±çš„äº‹ã€‚å®ƒä¸è¯­è¨€ä¸åŒï¼Œæ•°å­¦ä¸é€»è¾‘ä¹Ÿä¸ç›¸åŒã€‚â€éº»çœç†å·¥å­¦é™¢ç ”ç©¶ç”Ÿï¼Œè¯¥ç ”ç©¶çš„ä¸»è¦ä½œè€…å®‰å¨œÂ·ä¼Šå‡¡è¯ºå¨ƒï¼ˆAnna Ivanovaï¼‰è¯´ã€‚\nEvelina Fedorenkoï¼ŒFrederick A.å’ŒCarole J. MiddletonèŒä¸šå‘å±•ç¥ç»ç§‘å­¦å‰¯æ•™æˆï¼Œéº¦æˆˆæ–‡è„‘ç§‘å­¦ç ”ç©¶æ‰€çš„æˆå‘˜ï¼Œæ˜¯è¯¥è®ºæ–‡çš„é«˜çº§ä½œè€…ï¼Œè¯¥è®ºæ–‡ä»Šå¤©å‘è¡¨åœ¨eLifeä¸Šã€‚éº»çœç†å·¥å­¦é™¢è®¡ç®—æœºç§‘å­¦ä¸äººå·¥æ™ºèƒ½å®éªŒå®¤å’Œå¡”å¤«èŒ¨å¤§å­¦çš„ç ”ç©¶äººå‘˜ä¹Ÿå‚ä¸äº†è¿™é¡¹ç ”ç©¶ã€‚\nè¯­è¨€ä¸è®¤çŸ¥ Fedorenkoç ”ç©¶çš„ä¸»è¦é‡ç‚¹æ˜¯è¯­è¨€ä¸å…¶ä»–è®¤çŸ¥åŠŸèƒ½ä¹‹é—´çš„å…³ç³»ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¥¹ä¸€ç›´åœ¨ç ”ç©¶å…¶ä»–åŠŸèƒ½æ˜¯å¦ä¾èµ–äºå¤§è„‘çš„è¯­è¨€ç½‘ç»œï¼ˆåŒ…æ‹¬BrocaåŒºåŸŸå’Œå¤§è„‘å·¦åŠçƒçš„å…¶ä»–åŒºåŸŸï¼‰çš„é—®é¢˜ã€‚åœ¨å…ˆå‰çš„å·¥ä½œä¸­ï¼Œå¥¹çš„å®éªŒå®¤è¡¨æ˜ï¼ŒéŸ³ä¹å’Œæ•°å­¦ä¼¼ä¹å¹¶æœªæ¿€æ´»è¯¥è¯­è¨€ç½‘ç»œã€‚\nâ€œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰å…´è¶£æ¢ç´¢è¯­è¨€å’Œè®¡ç®—æœºç¼–ç¨‹ä¹‹é—´çš„å…³ç³»ï¼Œéƒ¨åˆ†åŸå› æ˜¯è®¡ç®—æœºç¼–ç¨‹æ˜¯ä¸€ä¸ªæ–°å‘æ˜ï¼Œæˆ‘ä»¬çŸ¥é“ä¸å¯èƒ½æœ‰ä»»ä½•ç¡¬è¿çº¿æœºåˆ¶ä½¿æˆ‘ä»¬æˆä¸ºä¼˜ç§€çš„ç¨‹åºå‘˜ï¼Œâ€ä¼Šä¸‡è¯ºå¨ƒè¯´ã€‚\nå¥¹è¯´ï¼Œå…³äºå¤§è„‘å¦‚ä½•å­¦ä¹ ç¼–ç ï¼Œå­˜åœ¨ä¸¤ç§æ€æƒ³æµæ´¾ã€‚æœ‰äººè®¤ä¸ºï¼Œè¦ç²¾é€šç¼–ç¨‹ï¼Œå°±å¿…é¡»ç²¾é€šæ•°å­¦ã€‚å¦ä¸€ä¸ªå»ºè®®è®¤ä¸ºï¼Œç”±äºç¼–ç å’Œè¯­è¨€ä¹‹é—´çš„ç›¸ä¼¼æ€§ï¼Œè¯­è¨€æŠ€èƒ½å¯èƒ½æ›´ç›¸å…³ã€‚ä¸ºäº†é˜æ˜è¿™ä¸€é—®é¢˜ï¼Œç ”ç©¶äººå‘˜ç€æ‰‹ç ”ç©¶åœ¨é˜…è¯»è®¡ç®—æœºä»£ç æ—¶å¤§è„‘æ´»åŠ¨æ¨¡å¼æ˜¯å¦ä¼šä¸è¯­è¨€ç›¸å…³çš„å¤§è„‘æ´»åŠ¨é‡å ã€‚\nç ”ç©¶äººå‘˜åœ¨æœ¬ç ”ç©¶ä¸­é‡ç‚¹å…³æ³¨ä»¥å¯è¯»æ€§ç€ç§°çš„ä¸¤ç§ç¼–ç¨‹è¯­è¨€â€”â€”Pythonå’ŒScratchJrã€‚ScratchJrè¿™æ˜¯ä¸€ç§ä¸“ä¸º5å²åŠ5å²ä»¥ä¸Šå„¿ç«¥è®¾è®¡çš„å¯è§†åŒ–ç¼–ç¨‹è¯­è¨€ã€‚ç ”ç©¶å¯¹è±¡å‡ä¸ºç²¾é€šæµ‹è¯•è¯­è¨€çš„å¹´è½»äººã€‚å½“ç¨‹åºå‘˜èººåœ¨åŠŸèƒ½ç£å…±æŒ¯ï¼ˆfMRIï¼‰æ‰«æä»ªä¸­æ—¶ï¼Œç ”ç©¶äººå‘˜å‘ä»–ä»¬å±•ç¤ºäº†ä»£ç ç‰‡æ®µï¼Œå¹¶è¦æ±‚ä»–ä»¬é¢„æµ‹ä»£ç å°†äº§ç”Ÿä»€ä¹ˆåŠ¨ä½œã€‚\nç ”ç©¶äººå‘˜å‡ ä¹çœ‹ä¸åˆ°å¤§è„‘è¯­è¨€åŒºåŸŸå¯¹ä»£ç çš„ååº”ã€‚ç›¸åï¼Œä»–ä»¬å‘ç°ç¼–ç ä»»åŠ¡ä¸»è¦æ¿€æ´»äº†æ‰€è°“çš„å¤šéœ€æ±‚ç½‘ç»œã€‚è¿™ä¸ªç½‘ç»œçš„æ´»åŠ¨éå¸ƒæ•´ä¸ªå¤§è„‘çš„é¢å¶å’Œé¡¶å¶ï¼Œé€šå¸¸æ˜¯ä¸ºéœ€è¦åŒæ—¶è®°ä½è®¸å¤šä¿¡æ¯çš„ä»»åŠ¡è€Œæ‹›å‹Ÿçš„ï¼Œå®ƒè´Ÿè´£æˆ‘ä»¬æ‰§è¡Œå„ç§å¿ƒç†ä»»åŠ¡çš„èƒ½åŠ›ã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œå®ƒæ‰€åšçš„å‡ ä¹æ‰€æœ‰åœ¨è®¤çŸ¥ä¸Šéƒ½å…·æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ï¼Œä½¿æ‚¨éš¾ä»¥æ€è€ƒã€‚â€\nå…ˆå‰çš„ç ”ç©¶è¡¨æ˜ï¼Œæ•°å­¦å’Œé€»è¾‘é—®é¢˜ä¼¼ä¹ä¸»è¦å–å†³äºå·¦åŠçƒçš„å¤šä¸ªéœ€æ±‚åŒºåŸŸï¼Œè€Œæ¶‰åŠç©ºé—´å¯¼èˆªçš„ä»»åŠ¡æ¯”å³åŠçƒæ›´å¤šåœ°æ¿€æ´»å³åŠçƒã€‚éº»çœç†å·¥å­¦é™¢çš„ç ”ç©¶å°ç»„å‘ç°ï¼Œè¯»å–è®¡ç®—æœºä»£ç ä¼¼ä¹å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œçš„å·¦ä¾§å’Œå³ä¾§ï¼Œè€ŒScratchJræ¿€æ´»å³ä¾§çš„ç¨‹åº¦è¦æ¯”å·¦ä¾§é«˜ä¸€äº›ã€‚è¿™ä¸€å‘ç°è¿èƒŒäº†æ•°å­¦å’Œç¼–ç ä¾èµ–ç›¸åŒå¤§è„‘æœºåˆ¶çš„å‡è®¾ã€‚\nç»éªŒçš„å½±å“ ç ”ç©¶äººå‘˜è¯´ï¼Œå°½ç®¡ä»–ä»¬æ²¡æœ‰å‘ç°ä»»ä½•ä¼¼ä¹ä¸“é—¨ç”¨äºç¼–ç¨‹çš„åŒºåŸŸï¼Œä½†æ˜¯è¿™ç§å…·æœ‰ç‰¹æ®Šè„‘æ´»åŠ¨çš„åŒºåŸŸå¯èƒ½ä¼šåœ¨å…·æœ‰æ›´å¤šç¼–ç ç»éªŒçš„äººä¸­å‘å±•ã€‚\nFedorenkoè¯´ï¼šâ€œå¦‚æœæ‚¨è˜ç”¨äº†ä»¥30å¹´æˆ–40å¹´çš„ç‰¹å®šè¯­è¨€ç¼–å†™ä»£ç çš„ä¸“ä¸šç¨‹åºå‘˜çš„äººï¼Œæ‚¨å¯èƒ½ä¼šå¼€å§‹çœ‹åˆ°æŸäº›ä¸“ä¸šåŒ–çŸ¥è¯†ï¼Œæˆ–è€…æ˜¯å¤šä¸ªéœ€æ±‚ç³»ç»ŸæŸäº›éƒ¨åˆ†çš„ç»“æ™¶â€ï¼ŒFedorenkoè¯´ã€‚â€œå¯¹äºé‚£äº›ç†Ÿæ‚‰ç¼–ç å¹¶ä¸”å¯ä»¥æœ‰æ•ˆåœ°å®Œæˆè¿™äº›ä»»åŠ¡ï¼Œä½†ç»éªŒç›¸å¯¹æœ‰é™çš„äººæ¥è¯´ï¼Œä¼¼ä¹æ‚¨è¿˜çœ‹ä¸åˆ°ä»»ä½•ä¸“ä¸šåŒ–çŸ¥è¯†ã€‚â€\nçº¦ç¿°Â·éœæ™®é‡‘æ–¯å¤§å­¦çš„ä¸€ç»„ç ”ç©¶äººå‘˜åœ¨åŒä¸€æœŸeLifeä¸Šå‘è¡¨çš„ä¸€ç¯‡ä¼´éšè®ºæ–‡ä¸­ä¹ŸæŠ¥å‘Šè¯´ï¼Œè§£å†³ä»£ç é—®é¢˜å¯ä»¥æ¿€æ´»å¤šéœ€æ±‚ç½‘ç»œè€Œä¸æ˜¯è¯­è¨€åŒºåŸŸã€‚\nç ”ç©¶ç»“æœè¡¨æ˜ï¼Œå¯¹äºç¼–ç åº”è¯¥ä»¥åŸºäºæ•°å­¦çš„æŠ€èƒ½è¿˜æ˜¯åŸºäºè¯­è¨€çš„æŠ€èƒ½è¿›è¡Œæ•™æˆï¼Œå°šæ— å®šè®ºã€‚ç ”ç©¶äººå‘˜è¯´ï¼Œéƒ¨åˆ†åŸå› æ˜¯å› ä¸ºå­¦ä¹ ç¼–ç¨‹å¯èƒ½ä¼šåŒæ—¶ä¾èµ–è¯­è¨€å’Œå¤šç§éœ€æ±‚ç³»ç»Ÿï¼Œå³ä½¿â€”ä¸€æ—¦å­¦ä¼šäº†ç¼–ç¨‹ï¼Œå°±ä¸ä¼šä¾èµ–è¯­è¨€åŒºåŸŸã€‚\nä¼Šä¸‡è¯ºå¨ƒè¯´ï¼šâ€œä¸¤ä¸ªé˜µè¥éƒ½å®£ç§°ï¼Œå®ƒå¿…é¡»ä¸æ•°å­¦ç»“åˆåœ¨ä¸€èµ·ï¼Œå¿…é¡»ä¸è¯­è¨€ç»“åˆåœ¨ä¸€èµ·ã€‚â€ â€œä½†æ˜¯çœ‹æ¥ï¼Œè®¡ç®—æœºç§‘å­¦æ•™è‚²è€…å°†ä¸å¾—ä¸å¼€å‘è‡ªå·±çš„æ–¹æ³•æ¥æœ€æœ‰æ•ˆåœ°æ•™æˆä»£ç ã€‚â€\nå…¨æ–‡å®Œã€‚\nå¦‚æœæ‚¨æƒ³çœ‹åŸæ–‡ï¼Œå¯ä»¥è®¿é—®ï¼šé“¾æ¥\n","id":122,"section":"posts","summary":"ç¥ç»ç§‘å­¦å®¶å‘ç°ï¼Œè§£é‡Šä»£ç å¯ä»¥æ¿€æ´»é€šç”¨çš„å¤§è„‘ç½‘ç»œï¼Œä½†ä¸èƒ½æ¿€æ´»è¯­è¨€å¤„ç†ä¸­å¿ƒã€‚ å®‰å¦®Â·ç‰¹æ‹‰å¤«é¡¿ | éº»çœç†å·¥å­¦é™¢æ–°é—»åŠå…¬å®¤ å‘å¸ƒæ—¥æœŸï¼š2020å¹´12æœˆ15","tags":[],"title":"å¯¹å¤§è„‘è€Œè¨€ï¼Œé˜…è¯»è®¡ç®—æœºä»£ç ä¸é˜…è¯»è¯­è¨€ä¸åŒ","uri":"https://lvsq.net/2020/12/brain-reading-computer-code/","year":"2020"},{"content":"ä½œè€…\nMATTHEW FLATT, University of Utah,\nUSACANER DERICI, Indiana University, USA\nR. KENT DYBVIG, Cisco Systems, Inc., USA\nANDREW W. KEEP, Cisco Systems, Inc., USA\nGUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina\nSARAH SPALL, Indiana University, USA\nSAM TOBIN-HOCHSTADT, Indiana University, USA\nJON ZEPPIERI, independent researcher, USA\næ¦‚è¦\næˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Racketï¼Œå¹¶ä¸”è¿è¡Œè‰¯å¥½â€”â€”åªè¦å¯¹Chez Schemeè¿›è¡Œä¸€äº›ä¿®è¡¥ï¼Œå°±å¯ä»¥è¿è¡ŒDrRacketã€‚ Racketå‘è¡Œç‰ˆå¯ä»¥è‡ªè¡Œæ„å»ºï¼Œå¹¶ä¸”å‡ ä¹æ‰€æœ‰æ ¸å¿ƒâ€‹â€‹çš„Racketæµ‹è¯•å¥—ä»¶éƒ½å¯ä»¥é€šè¿‡ã€‚å°½ç®¡ä»æœ‰ä¸€äº›å·¥ä½œå¯ä»¥æé«˜ç«¯åˆ°ç«¯çš„æ€§èƒ½ï¼Œä½†æœ€ç»ˆçš„å®ç°è¿˜æ˜¯ä¸é”™çš„ã€‚ æˆ‘ä»¬è¯„ä¼°çš„æœ€ä¸å¯é¢„æµ‹çš„éƒ¨åˆ†æ˜¯ï¼ŒRacketå’ŒChez Schemeä¹‹é—´çš„ä¸åŒå°†å˜å¾—å¤šå¤§ï¼Œä»¥åŠæˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›ä¸åŒã€‚æˆ‘ä»¬å¸Œæœ›Racket CSæˆä¸ºä¸»è¦çš„Racketå®ç°ï¼Œå¹¶ä¸”æˆ‘ä»¬é¼“åŠ±å…¶ä»–è¯­è¨€å®ç°è€…å°†Chez Schemeè§†ä¸ºç›®æ ‡è™šæ‹Ÿæœºã€‚\nè¯¥æ–‡è¯¦ç»†åœ°ä»‹ç»äº†Racket CSæ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œä»¥åŠä¸Chez Schemeä¹‹é—´çš„å·®å¼‚ï¼Œ å®Œæ•´å†…å®¹è§(https://dl.acm.org/doi/epdf/10.1145/3341642)\n","id":123,"section":"posts","summary":"ä½œè€… MATTHEW FLATT, University of Utah, USACANER DERICI, Indiana University, USA R. KENT DYBVIG, Cisco Systems, Inc., USA ANDREW W. KEEP, Cisco Systems, Inc., USA GUSTAVO E. MASSACCESI, Universidad de Buenos Aires, Argentina SARAH SPALL, Indiana University, USA SAM TOBIN-HOCHSTADT, Indiana University, USA JON ZEPPIERI, independent researcher, USA æ¦‚è¦ æˆ‘ä»¬åœ¨Chez Schemeä¸Šé‡å»ºäº†Ra","tags":["pl"],"title":"åŸºäºChez Schemeé‡å»ºRacket","uri":"https://lvsq.net/2020/10/rebuilding-racket/","year":"2020"},{"content":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„è®¡ç®—æœºè¯­è¨€Java, Python, Cç­‰ç­‰å‡ ä¹ä¸€è‡´é‡‡ç”¨Lexical Scoping,ç¨‹åºå‘˜æ²¡æœ‰æœºä¼šå¯Ÿè§‰åˆ°å¼‚æ ·ï¼Œä»è€Œæ©ç›–äº†è¿˜æœ‰å…¶ä»–ä½œç”¨åŸŸçš„äº‹å®ï¼Œè®¸å¤šæ•™ç§‘ä¹¦ä¹Ÿå¾ˆé…åˆåœ°ä¸€ç¬”å¸¦è¿‡ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯æ‚¨å·²ç»æ´å¯Ÿäº†ä¸åŒä½œç”¨åŸŸçš„å·®å¼‚å’Œå†…æ¶µï¼Œè‡ªè§‰åœ°è§„é¿äº†é—®é¢˜ã€‚æˆ‘è¡·å¿ƒçš„å¸Œæœ›æ‰€æœ‰ç¨‹åºå‘˜éƒ½æ˜¯ç¬¬äºŒç§å¯èƒ½ã€‚\næœ¬æ–‡å°†æµ…æ˜¾åœ°æè¿°ä¸¤ç§ä½œç”¨åŸŸçš„ç‰¹ç‚¹åŠå·®å¼‚ï¼Œå¸Œæœ›å¯ä»¥è§£é‡Šåœ°æ¸…æ¥šä¸€ç‚¹ï¼Œå¦‚æœè¯»å®Œä¹‹åæ‚¨æ›´åŠ æ¨¡ç³Šäº†ï¼Œè¯·è®°ä½ï¼Œè¿™å¹¶éæˆ‘çš„æœ¬æ„ã€‚\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œåç§°ç»‘å®šçš„ä½œç”¨åŸŸï¼ˆåç§°ä¸å®ä½“çš„å…³è”ï¼Œæ¯”å¦‚å˜é‡ï¼‰æ˜¯ç¨‹åºä¸­åç§°ç»‘å®šæœ‰æ•ˆçš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åç§°å¯ä»¥è¢«å¼•ç”¨åˆ°ä¸€ä¸ªå®ä½“ã€‚ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ï¼Œåç§°å¯èƒ½æŒ‡å‘ä¸åŒçš„å®ä½“ï¼ˆå®ƒå¯èƒ½å…·æœ‰ä¸åŒçš„ç»‘å®šï¼‰ï¼Œæˆ–è€…æ ¹æœ¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼ˆå®ƒå¯èƒ½æ˜¯æœªç»‘å®šçš„ï¼‰ã€‚ä½œç”¨åŸŸä¹Ÿç§°ä¸ºå®ä½“çš„å¯è§æ€§ï¼Œ å°¤å…¶åœ¨è¾ƒæ—©çš„æŠ€æœ¯æ–‡çŒ®ä¸­å¯è§ï¼Œè¿™æ˜¯ä»æ‰€å¼•ç”¨çš„å®ä½“çš„è§’åº¦å‡ºå‘ï¼Œè€Œéå¼•ç”¨çš„åç§°ã€‚\næœ¯è¯­\u0026quot;scope\u0026ldquo;ä¹Ÿç”¨äºæŒ‡ä»£ç¨‹åºä¸­æœ‰æ•ˆçš„åç§°ç»‘å®šçš„é‚£éƒ¨åˆ†é›†åˆï¼Œæ›´åŠ æ­£ç¡®çš„ç§°å‘¼åº”è¯¥æ˜¯ä¸Šä¸‹æ–‡ æˆ–è€… ç¯å¢ƒ\nLexical Scoping è¯æ³•ä½œç”¨åŸŸï¼ŒæŸäº›ä¹¦ä¸­ä¹Ÿå«é™æ€ä½œç”¨åŸŸï¼Œå…¶åœ¨ç¼–å†™ä»£ç æ—¶æˆ–è€…è¯´å®šä¹‰æ—¶å°±ç¡®å®šçš„ï¼Œé€šè¿‡æ–‡æœ¬ï¼ˆæºä»£ç ï¼‰å°±å¯ä»¥è§‚å¯Ÿåˆ°åç§°ä¸å®ä½“çš„å…³è”ï¼Œç¨‹åºè¿è¡Œæ—¶ä¼šåœ¨è·ç¦»è¢«è°ƒç”¨ä»£ç æœ€è¿‘çš„ç¯å¢ƒä¸­å»æŸ¥æ‰¾ç»‘å®šï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç¯å¢ƒï¼Œåœ¨ä¼˜å…ˆä»æœ€é‡Œé¢ä¸€å±‚çš„ç¯å¢ƒæŸ¥æ‰¾ã€‚\næ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n(setf x 1) ;; bind x to 1 (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) ;; result is 6 (format t \u0026#34;X = ~d \u0026#34; x) ;; X = 1 å…ˆç»‘å®šxä¸º1ï¼Œç„¶åå®šä¹‰ä¸€ä¸ªå‡½æ•°fï¼Œfä¸­çš„å˜é‡xç»‘å®šä¸º2ï¼Œå®é™…ä¸Šfå½¢æˆäº†ä¸€ä¸ªé—­åŒ…ï¼Œç”±äºä¸¤ä¸ªxçš„ç¯å¢ƒä¸åŒï¼Œæ‰€ä»¥äº’ä¸å¹²æ‰°ï¼Œç»“æœæ­£æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œè¿™å°±å±äºè¯æ³•ä½œç”¨åŸŸã€‚\nDynamic Scoping åŠ¨æ€ä½œç”¨åŸŸæ›¾ç»è®©å¾ˆå¤šäººæ·±æ¶ç—›ç»ï¼Œä»¥è‡³äºä¸æ„¿æ„å†æèµ·å®ƒã€‚æ—©æœŸçš„Lispæ™®éä½¿ç”¨äº†åŠ¨æ€ä½œç”¨åŸŸï¼Œå¹¶å¸¦æ¥äº†éå¸¸ä¸¥é‡çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯Lisp Machineè¢«Unixæ‰“è´¥çš„é™¤äº†å•†ä¸šå› ç´ ä¹‹å¤–çš„é‡è¦åŸå› ï¼ŒLispè‡³ä»Šæœªæˆä¸ºä¸»æµè¯­è¨€å°±ä¸éš¾ç†è§£äº†ï¼Œå°½ç®¡Lispçš„è¯­æ³•æœ€ç²¾ç‚¼ã€æœ€ä¼˜ç¾ï¼Œè¿˜å…·æœ‰æœ€å¼ºæ‚çš„å®ç³»ç»Ÿï¼Œè¿˜æ˜¯ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªä½¿ç”¨GCçš„è¯­è¨€\u0026hellip;\nåº†å¹¸çš„æ˜¯ï¼ŒScheme, Common Lispç­‰Lispæ–¹è¨€å·²ç»éƒ½æ˜¯ç”¨äº†Lexial Scopingï¼ˆå±€éƒ¨å˜é‡ã€‚æ‰€ä»¥æŸäº›æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠLexical Scopingå’ŒLocal Variableç­‰ä»·ï¼‰, æˆ‘ä»¬æ— éœ€å†ä¸ºä¸€äº›è«åå…¶å¦™çš„é—®é¢˜è€Œçƒ¦æ¼ï¼Œçæƒœç”Ÿå‘½ï¼Œä¸æ˜¯å—ï¼Ÿ ä¸è¿‡Scheme, Common Lispè¿˜æ˜¯ä¿ç•™äº†åŠ¨æ€ä½œç”¨åŸŸçš„æ“ä½œï¼ŒSchemeå¯ä»¥å‚è€ƒFluid Binding, Common Lispçš„åŠ¨æ€ä½œç”¨åŸŸå°†åœ¨åæ–‡ä¸¾ä¾‹è¯´æ˜ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬æ— éœ€ä¸ºè¿™ä¸ªä¿ç•™æ‹…å¿§ï¼Œå› ä¸ºåŸºæœ¬ä¸Šæˆ‘ä»¬å¾ˆå°‘éœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚\næ‰€è°“dynamic scopingå°±æ˜¯è¯´ï¼Œåœ¨å‡½æ•°å®šä¹‰ä¸­å­˜åœ¨äº†â€œè‡ªç”±å˜é‡â€ï¼ˆfree variableï¼‰, ä¼šåœ¨è¿è¡Œæ—¶éšç€å‡½æ•°çš„â€œè°ƒç”¨ä½ç½®â€ä¸åŒè€Œå‘ç”Ÿå˜åŒ–ï¼Œè¿˜æ˜¯ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´æ˜ï¼Œä½†æ˜¯ç¨ä½œå˜åŒ–ï¼š\n(defvar x 1) ;; bind x to 1, x is a free variable (setq f (let ((x 2)) ;; bind x to 2 (lambda (y) (* x y)))) (funcall f 3) (format t \u0026#34;X = ~d \u0026#34; x) (let ((x 100)) (format t \u0026#34;Inner X is ~d \u0026#34; x)) (defvar x 1)å®šä¹‰äº†xï¼Œå€¼ä¸º1ï¼Œä½†æ˜¯è¿™ä¸ªxå±äºè‡ªç”±å˜é‡ï¼Œå¤„äºåŠ¨æ€ä½œç”¨åŸŸï¼Œå› ä¸ºLispè‡ªåŠ¨å°†å…¨å±€å˜é‡å³ç”±defvarã€defparameterã€specialå®šä¹‰çš„å˜é‡è‡ªåŠ¨å£°æ˜ä¸ºåŠ¨æ€ä½œç”¨åŸŸã€‚ xå¯¹äº(lambda (y) (* x y))æ¥è¯´æ˜¯â€œ è‡ªç”± â€ çš„ï¼Œå®ƒå¯ä¸ä¼šåœ¨æ„xç»‘å®šä¸º2æˆ–è€…ä»»ä½•å…¶ä»–å€¼ï¼Œå› ä¸º(let ((x 2)) \u0026hellip;)ä¸­æŒ‡å®šçš„xå·²ç»ä¸æ˜¯(lambda \u0026hellip;)çš„å‚æ•°äº†ã€‚\næ‰€ä»¥å½“æˆ‘ä»¬æ‰§è¡Œ(funcall f 3) æ—¶ï¼Œå…¶ç»“æœä¸åƒè¯æ³•ä½œç”¨åŸŸé‚£æ ·ç­‰äº6ï¼Œè€Œæ˜¯3\n(format t \u0026ldquo;X = ~d \u0026quot; x) ä¾ç„¶è¾“å‡ºï¼š X = 1\n(let ((x 100)) (format t \u0026ldquo;Inner X is ~d \u0026quot; x)) è¾“å‡ºä¸ºï¼šInner X is 100ã€‚ ç­‰ç­‰ï¼Œè¿™é‡Œçš„xä¸ºä»€ä¹ˆåˆæ˜¯100äº†ï¼Ÿ è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„ç¯å¢ƒ å—ï¼Ÿï¼\nå¦‚æœå°†å‡½æ•°fæ”¾åˆ°ä¸åŒçš„ä½ç½®æ‰§è¡Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ä¸Šé¢(funcall f 3)æ˜¯åœ¨é¡¶å±‚æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬æ¢åˆ°letä¸­æ‰§è¡Œä¼šæ€ä¹ˆæ ·ï¼Ÿ\n(let ((x 2)) (funcall f 3)) è¿™æ¬¡å±…ç„¶è¿”å›6ï¼Œè€Œä¸æ˜¯3äº†ã€‚\nçœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿå‡½æ•°fçš„è¡Œä¸ºï¼Œä¼šéšç€è°ƒç”¨ä½ç½®çš„ä¸€ä¸ªåå«xçš„å˜é‡çš„å€¼çš„ä¸åŒè€Œå˜åŒ–ã€‚è™½ç„¶éƒ½å«xï¼Œä½†å¹¶ä¸æ˜¯åŒä¸€ä¸ªå˜é‡ï¼Œåªæ˜¯åå­—ç›¸åŒè€Œå·²ã€‚é¡ºå¸¦æä¸€å¥ï¼Œç°åœ¨å¯ä»¥ç†è§£Javaä¸­namespaceçš„ç”¨å¤„äº†å§ã€‚\nè¯æ³•ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°è¯æ³•ä¸Šä¸‹æ–‡è§£å†³çš„ï¼Œè€ŒåŠ¨æ€ä½œç”¨åŸŸæ˜¯é€šè¿‡æœç´¢æœ¬åœ°æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå³ä½ç½®ï¼‰è§£å†³çš„ã€‚è¿™æ˜¯ç¼–è¯‘å™¨å¿…é¡»é¢å¯¹å¹¶è§£å†³çš„é—®é¢˜ï¼Œæˆ–è®¸ç¼–å†™ç¨‹åºæ—¶æ— éœ€è¿‡å¤šå…³æ³¨ï¼Œä½†æ˜¯å¤šäº†è§£ä¸€ä¸‹ä¸€å®šå¤§æœ‰è£¨ç›Šã€‚å°½ç®¡åŠ¨æ€ä½œç”¨åŸŸå­˜åœ¨å¾ˆå¤§é—®é¢˜ï¼Œä½†å®ƒå¹¶éæ´ªæ°´çŒ›å…½ï¼Œå®ƒå¯ä»¥ä½¿å…¨å±€å˜é‡æ›´æ˜“äºç®¡ç†ï¼›å‡è®¾æ‚¨å¸Œæœ›ä¸´æ—¶æ”¹å˜è‡ªç”±å˜é‡çš„å€¼æ—¶ï¼Œä¹Ÿå¯ä»¥å£°æ˜ä¸ºdynamic socpingï¼›å¦å¤–åœ¨å¼‚å¸¸å¤„ç†ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ¨æ€ä½œç”¨åŸŸå°†å¤„ç†ç¨‹åºä¸å¼‚å¸¸ç›¸å…³è”ã€‚\n","id":124,"section":"posts","summary":"æˆ‘ç›¸ä¿¡æ¯ä¸€ä½ç¨‹åºå‘˜åœ¨å­¦ä¹ æˆ–è€…å®è·µç¼–ç¨‹æ—¶ï¼Œéƒ½ä¼šé‡åˆ°ä½œç”¨åŸŸçš„é—®é¢˜ã€‚æ‚¨å¯èƒ½è§‰å¾—ä½œç”¨åŸŸå¾ˆç®€å•ï¼Œç”šè‡³éƒ½ä¸èƒ½å½“åšä¸€ä¸ªé—®é¢˜æ¥çœ‹å¾…ï¼Œæˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ç›®å‰ä¸»æµçš„","tags":["lexical","scoping"],"title":"Lexical Scoping and Dynamic Scoping","uri":"https://lvsq.net/2020/09/lexical-dynamic-scoping/","year":"2020"},{"content":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š\nè®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼›\néå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°åˆ—è¡¨çš„å·¦ä¾§ï¼Œæ‰€æœ‰å¤§äºæˆ–ç­‰äºåˆ†ç•Œå€¼çš„å…ƒç´ é›†ä¸­åˆ°å³ä¾§ï¼›\nåˆ†åˆ«å¯¹å·¦ä¾§å’Œå³ä¾§çš„å…ƒç´ è¿›è¡Œå¿«æ’ï¼›\né‡å¤ä¸Šè¿°çš„æ­¥éª¤ï¼Œæ’åºå®Œæˆï¼›\nåœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åºnä¸ªå…ƒç´ éœ€è¦$O(nlog n)$å¤æ‚åº¦ï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦$O(n^2)$,ä½†ä¸€èˆ¬å¾ˆå°‘å‡ºç°è¿™ç§æƒ…å†µã€‚\nä»ç®—æ³•çš„åŸç†å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦å¤šæ¬¡æ‰§è¡Œé‡å¤çš„æ“ä½œï¼Œè‡ªç„¶é‡‡ç”¨é€’å½’å¯ä»¥å‡å°‘å¾ˆå¤šä»£ç ï¼Œè‹¥é—®é€’å½’æŠ€æœ¯å“ªå®¶å¼ºï¼Ÿé¦–å±ˆä¸€æŒ‡Lisp,ä¸‹é¢ç»™å‡ºCLç‰ˆæœ¬çš„å¿«æ’å®ç°ï¼ˆç®€æ˜“ç‰ˆæœ¬ï¼Œåªæ”¯æŒæ•°å­—ç±»å‹çš„åˆ—è¡¨ï¼Œå…¶ä»–ç±»å‹çš„æ’åºåªéœ€å¢åŠ ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°å³å¯ï¼Œæœ¬æ–‡ä¸æ‰©å±•ï¼‰ï¼š\n(defun quickSort (lst) (let ( (len (list-length lst)) (st (lambda (l pk) ;; stå‡½æ•°å®ç°ä¸Šè¿°ç¬¬2æ­¥ (let ((left nil) (right nil)) (dolist (each l) (if (\u0026lt; each pk) (push each left) (push each right))) (values left right) ) ) ) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) (quickSort \u0026#39;(1 2 6 3 5 4)) =\u0026gt; (1 2 3 4 5 6) stå‡½æ•°å¯ä»¥ç”¨å®æ¥å®ç°ï¼š\n(defmacro st (lst pk) (let ((gslist (gensym))) `(let ((,gslist ,lst)) (let ((left nil) (right nil)) (dolist (each ,gslist) (if (\u0026lt; each ,pk) (push each left) (push each right))) (values left right) ) ) ) ) (defun quickSort (lst) (let ( (len (list-length lst)) ) (if (\u0026lt; len 2) lst (multiple-value-bind (l r) (st (cdr lst) (car lst)) (append (quickSort l) (cons (car lst) (quickSort r)))) ) ) ) ","id":125,"section":"posts","summary":"å¿«é€Ÿæ’åºæ˜¯ä¸€ç§å¸¸è§çš„æ’åºæ‰‹æ®µï¼Œç”±C.A.R.Hoareåœ¨1960å¹´æå‡ºã€‚å…¶åŸºæœ¬æ€è·¯ä¸ºï¼š è®¾å®šä¸€ä¸ªåˆ†ç•Œå€¼ï¼Œé€šå¸¸ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ ï¼› éå†åˆ—è¡¨ï¼Œå°†æ‰€æœ‰å°äº","tags":["lisp"],"title":"å¿«é€Ÿæ’åºï¼ˆLispç‰ˆæœ¬ï¼‰","uri":"https://lvsq.net/2020/07/quick-sort-in-cl/","year":"2020"},{"content":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡ºäº†ä¸€ä¸ªå…³äºå…«çš‡åçš„é¢˜ç›®ï¼Œè¿™æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­ç»å…¸çš„é—®é¢˜ï¼Œå½“å¹´ä¸Šå­¦æ—¶æ›¾ç»å°½è„‘æ±ä»ç„¶äº‘å±±é›¾ç½©ï¼Œä¸å¾—å…¶è§£ã€‚å¦‚ä»Šå†æ¬¡ç›¸é‡ï¼Œå²‚èƒ½å†åå£ä¸Šè§‚ï¼Ÿï¼æ›´ä½•å†µæ‰‹è¾¹å·²æœ‰è¶æ‰‹çš„å…µå™¨ã€‚è¯•çœ‹Erlangçš„å®ç°ï¼š\n-module(queens). -export([queens/1]). queens(0) -\u0026gt; [[]]; queens(N) -\u0026gt; [[Row | Columns] || Columns \u0026lt;- queens(N - 1), Row \u0026lt;- lists:seq(1, 8) -- Columns, safe(Row, Columns, 1)]. safe(_Row, [], _N) -\u0026gt; true; safe(Row, [Column | Columns], N) -\u0026gt; (Row /= Column + N) andalso (Row /= Column - N) andalso safe(Row, Columns, (N + 1)). ä»å¤´è‡³å°¾10è¡Œä»£ç ï¼Œå¦‚æœä¸æ˜¯ä¸ºäº†ä½¿ä»£ç ç¾è§‚ï¼Œ6è¡Œè¶³çŸ£ï¼ˆè¿™è¿˜åŒ…æ‹¬äº†**-module** å’Œ**-export** ä¸¤è¡Œå£°æ˜è¯­æ³•ï¼Œä¸ç®—æ³•æœ¬èº«æ— å…³çš„ä»£ç ï¼‰ã€‚å¦‚æ­¤ç®€çŸ­å°½ç„¶å¯ä»¥æ¸…æ™°åœ°å®ç°å¤æ‚çš„å…«çš‡å é—®é¢˜ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼ç¨‹åºè¯­è¨€å¾—å†™å¤šå°‘è¡Œï¼Ÿæœ¬æ–‡çš„é‡ç‚¹ä¸åœ¨äºæ¯”è¾ƒè¿™ä¸ªï¼ŒErlangæ˜¯ä¸€é—¨éå¸¸å¼ºå¤§çš„è¯­è¨€ï¼Œå¯¹äºæˆ‘æ¥è¯´Erlangå¥½æ¯”æ¢æ˜¥ï¼Œä½†æ˜¯Schemeæ‰æ˜¯æ—é»›ç‰å‘€ï¼Œæ‰€ä»¥æ¯«ä¸è¿Ÿç–‘ç”¨Schemeæ¥å®ç°ï¼š\n(define (accumulate op initial sequence) (if (null? sequence) initial (op (car sequence) (accumulate op initial (cdr sequence)))) ) (define (enumerate-interval low high) (if (\u0026gt; low high) \u0026#39;() (cons low (enumerate-interval (+ low 1) high))) ) (define (flatmap proc seq) (accumulate append \u0026#39;() (map proc seq)) ) (define empty-board \u0026#39;()) (define (safe? k position) (let loop ([new-queen (car position)] [rest-queens (cdr position)] [i 1]) (if (null? rest-queens) #t (let ([rest-current-queen (car rest-queens)]) (if (or (= new-queen rest-current-queen) (= new-queen (+ rest-current-queen i)) (= new-queen (- rest-current-queen i)) ) #f (loop new-queen (cdr rest-queens) (+ i 1)) ) ) ) ) ) (define (adjoin-position new-row k rest-of-queens) (cons new-row rest-of-queens) ) (define (queens board-size) (define (queen-cols k) (if (= k 0) (list empty-board) (filter (lambda (position) (safe? k position)) ;è¿‡æ»¤æ— æ•ˆçš„è§£ (flatmap (lambda (rest-of-queens) (map (lambda (new-row) ;æ‰©å……ï¼ˆk-1ï¼‰ä¸ªçš‡åçš„æ¯ä¸€ä¸ªè§£ï¼Œç»™æ¯ä¸ªè§£éƒ½å¢åŠ ç¬¬kä¸ªçš‡å (adjoin-position new-row k rest-of-queens)) (enumerate-interval 1 board-size) ) ) (queen-cols (- k 1)) ;å‰ï¼ˆk-1ï¼‰ä¸ªæœ‰æ•ˆçš„çš‡åï¼Œè™½ç„¶æ˜¯å¤ªè™šå¹»å¢ƒï¼Œä½†å¯ä»¥è®¤ä¸ºæ˜¯äº‹å® ) ) ) ) (queen-cols board-size) ) Schemeç‰ˆæœ¬æ¯”Erlangç‰ˆæœ¬ä»£ç å¢åŠ äº†ä¸å°‘ï¼ŒåŸå› åœ¨äºå…¶æ²¡æœ‰æ¨¡å¼åŒ¹é… å’Œåˆ—è¡¨æ¨å¯¼ è¿™ä¸¤å¤§åˆ©å™¨ï¼Œä¸è¿‡æˆ‘æ›´å–œæ¬¢Schemeå¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ„é€ æˆ‘éœ€è¦çš„ä¸€åˆ‡ï¼Œè€Œä¸”S-è¡¨è¾¾å¼çœ‹èµ·æ¥ååˆ†ä¼˜ç¾è‡ªç„¶ã€‚Schemeç‰ˆæœ¬å®é™…ä¸Šè§£å†³äº†n-çš‡åï¼Œæ›´è¿›ä¸€æ­¥äº†ã€‚\näº‹æƒ…åˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸï¼ŒåŸå› åœ¨äºæˆ‘åˆšå¼€å§‹å®ç°Schemeç‰ˆæœ¬çš„å…«çš‡åæ—¶ï¼Œé€‰æ‹©ç¿»è¯‘Erlangä»£ç ï¼Œæœ€ç»ˆå¤±è´¥äº†ï¼ä¸€ç•ªæŒ£æ‰ä¹‹åï¼Œæ„è¯†åˆ°è¯¥é—®é¢˜å±äºéç¡®å®šæ€§è®¡ç®—ï¼ŒçŒ›ç„¶æƒ³èµ·ã€ŠSICPã€‹ä¸­æœ‰ä¸€èŠ‚ä¸“é—¨ä»‹ç»äº†æ­¤ç§è®¡ç®—ï¼Œä¹Ÿå³æœ¬æ–‡çš„ä¸»è§’â€”â€”amb\néç¡®å®šæ€§è®¡ç®— ambè¿™ä¸ªåå­—æºäºambiguous ,å…¶å«ä¹‰å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£ã€‚ä¸€ç•ªæŠ«è‚æ²¥èƒ†ä¹‹åï¼Œç»ˆäºçª¥åˆ°äº†ä¸€äº›é—¨å¾„ï¼Œè¶æœºå˜æ¸…å¾ˆå¤šçŸ¥è¯†ç‚¹ã€‚æˆ‘å°†å°½åŠ›å¹³é“ºç›´è¿°ï¼Œç®€è¦çš„ä»‹ç»è¿™ç§å¼ºå¤§ä¸”ååˆ†æœ‰ç”¨çš„æ­¦å™¨ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸ªé—®é¢˜ï¼š\nå‡è®¾æœ‰ä¸¤ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­éƒ½æ˜¯ä¸€äº›æ­£æ•´æ•°ï¼Œæ¯”å¦‚l1 = [1 2 3 4 5], l2 = [3 4 6 7 8]ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»l1å’Œl2ä¸­å„å–ä¸€ä¸ªæ•°å­—ï¼Œç›¸åŠ ä¹‹åï¼Œå¦‚æœæ˜¯ç´ æ•°ï¼Œåˆ™æ»¡è¶³è¦æ±‚ã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå¯¹äºè¿™ä¸ªç®€å•çš„é—®é¢˜ï¼Œç›¸ä¿¡éš¾ä¸å€’å¤§å®¶ï¼Œé‡‡ç”¨å›æº¯ç®—æ³•è½»æ˜“å°±è§£å†³äº†ï¼Œè¿™é‡Œåªæ˜¯æƒ³å¼•å‡ºâ€œéç¡®å®šæ€§è®¡ç®—â€çš„æ¦‚å¿µã€‚éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†ç±»ä¼¼ï¼Œå¯¹äºâ€œç”Ÿæˆå’Œæ£€æµ‹å¼â€çš„åº”ç”¨ç‰¹åˆ«æœ‰ä»·å€¼ï¼Œå®ƒå¾€å¾€åªæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼Œè¿™å¥è¯å¾ˆæœ‰æ„æ€ï¼Œå¦‚æœæš‚æ—¶æ²¡æœ‰ç†è§£ä¸ç”¨ç€æ€¥ï¼Œç»§ç»­å¾€ä¸‹çœ‹ã€‚\nå¯¹äºéç¡®å®šæ€§è®¡ç®—ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè¡¨è¾¾å¼æ˜¯å…è®¸å­˜åœ¨å¤šä¸ªå€¼çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„é—®é¢˜çš„è§£è‡³å°‘æœ‰(1 4),(2 3)ä¸¤ä¸ªè§£å§ã€‚\næœ‰ä¸€ä»¶å¾ˆæœ‰æ•™ç›Šçš„äº‹æƒ…ï¼Œé‚£å°±æ˜¯éç¡®å®šæ€§è®¡ç®—å’Œæµå¤„ç†å¯¹äºæ—¶é—´çš„ä¸åŒçœ‹æ³•ã€‚æµå¤„ç†åˆ©ç”¨äº†æƒ°æ€§æ±‚å€¼ï¼Œè¿™ä¼šç»™æˆ‘ä»¬ä¸€ç§é”™è§‰ï¼Œä»¿ä½›æ‰€æœ‰å¯èƒ½çš„ç»“æœçš„å‡ºç°æ²¡æœ‰æ—¶é—´é¡ºåºï¼›å¯¹äºéç¡®å®šæ€§çš„æ±‚å€¼ï¼Œä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å¯¹ä¸€ä¸ªå¯èƒ½çš„ä¸–ç•Œçš„æ¢ç´¢ï¼Œæ¯ä¸€ä¸ªå€¼éƒ½ç”±ä¸€æ¬¡é€‰æ‹©æ‰€ç¡®å®šï¼ŒæŸäº›é€‰æ‹©ä¼šèµ°å…¥æ­»èƒ¡åŒï¼Œè€Œå¦ä¸€äº›ä¼šå¾—åˆ°æœ‰ç”¨çš„å€¼ï¼Œæ‰€ä»¥éç¡®å®šæ€§è®¡ç®—ç»™æˆ‘ä»¬çš„æ„Ÿè§‰æ˜¯ï¼Œæ—¶é—´æ˜¯æœ‰åˆ†æ”¯çš„ã€‚ç¨‹åºå½“ä¸­ä¼šä¿å­˜æ‰€æœ‰å¯èƒ½çš„ä¸åŒæ‰§è¡Œå†å²ï¼Œåœ¨é‡åˆ°ä¸€ä¸ªæ­»èƒ¡åŒæ—¶ï¼Œæ€»æ˜¯å¯ä»¥å›åˆ°ä»¥å‰çš„é€‰æ‹©ç‚¹ï¼Œå¹¶æ²¿ç€å¦ä¸€ä¸ªåˆ†æ”¯ç»§ç»­ä¸‹å»ã€‚\nä¸‹é¢å°†è¦å®ç°çš„éç¡®å®šæ€§æ±‚å€¼å™¨ç§°ä¸ºâ€”â€”ambæ±‚å€¼å™¨\nambæ±‚å€¼å™¨ å‡è®¾ç›®å‰å·²ç»æ‰©å……äº†Schemeä»¥æ”¯æŒéç¡®å®šæ€§è®¡ç®—ï¼Œå¼•å…¥äº†ä¸€ç§æ–°çš„ç§°ä¸ºambçš„æ–°å½¢å¼ï¼Œè¡¨è¾¾å¼ $(amb \u0026lt;e_1\u0026gt; \u0026lt;e_2\u0026gt; \u0026hellip; \u0026lt;e_n\u0026gt;)$ ä¼šâ€œæœ‰æ­§ä¹‰åœ°â€è¿”å›nä¸ªè¡¨è¾¾å¼ä¹‹ä¸€çš„å€¼ï¼Œæ¯”å¦‚ï¼š\n(list (amb 1 2 3) (amb \u0026#39;a \u0026#39;b)) å¯ä»¥æœ‰å¦‚ä¸‹6ä¸ªå¯èƒ½çš„å€¼ï¼š (1 a) (1 b) (2 a) (2 b) (3 a) (3 b)\nå¯¹äºæ²¡æœ‰é€‰é¡¹çš„ambï¼Œå³(amb) â€”â€”è§†ä¸ºæ²¡æœ‰å¯æ¥æ”¶å€¼çš„è¡¨è¾¾å¼ï¼Œè¿™å°†å¯¼è‡´æ±‚å€¼â€œfailâ€ã€‚\nambæ±‚å€¼å™¨åœ¨æ¯ä¸ªé€‰æ‹©ç‚¹ï¼Œæ€»æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ªå¯èƒ½æ€§ï¼Œå¦‚æœé€‰æ‹©çš„ç»“æœå¤±è´¥ï¼Œé‚£ä¹ˆæ±‚å€¼å™¨è‡ªåŠ¨åœ°å›æº¯åˆ°æœ€è¿‘çš„é€‰æ‹©ç‚¹ï¼Œå»å°è¯•ä¸‹ä¸€ä¸ªå¯èƒ½æ€§ã€‚å¦‚æœå®ƒç”¨å®Œäº†æ‰€ä»¥çš„å¯èƒ½æ€§ï¼Œåˆ™è‡ªåŠ¨é€€å›åˆ°ä¸Šä¸€ä¸ªé€‰æ‹©ç‚¹ï¼Œå¹¶ä»é‚£é‡Œç»§ç»­ï¼ˆè¿™ä¸ªâ€œç»§ç»­â€å¾ˆæœ‰æ„æ€ï¼Œåæ–‡ä¼šçœ‹åˆ°ï¼Œâ€œç»§ç»­â€ä¸ä½†æ˜¯ç»“è®ºï¼Œè¿˜æ˜¯å…¶å®ç°çš„æ–¹å¼ï¼Œä¸€è¯­åŒå…³ï¼‰ä¸‹å»ã€‚ä»è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ç§æ·±åº¦ä¼˜å…ˆ ç®—æ³•ã€‚\né€»è¾‘è°œé¢˜ åœ¨è®¨è®ºambæ±‚å€¼å™¨çš„å®ç°ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€é“é€»è¾‘è°œé¢˜ï¼š\næ›¹æ“ã€å­™æƒã€åˆ˜å¤‡ã€è¢ç»ã€é©¬è¶…5äººä½åœ¨ä¸€æ ‹5å±‚çš„æ¥¼æˆ¿é‡Œé¢ï¼Œæ¯äººä½ä¸€å±‚ã€‚æ›¹æ“ä¸ä½é¡¶å±‚ï¼Œå­™æƒä¸ä½åº•å±‚ï¼Œåˆ˜å¤‡ä¸ä½é¡¶å±‚ä¹Ÿä¸ä½åº•å±‚ï¼Œè¢ç»æ¯”åˆ˜å¤‡é«˜ä¸€å±‚ï¼Œé©¬è¶…ä¸åˆ˜å¤‡ä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œåˆ˜å¤‡ä¸å­™æƒä¹Ÿä¸åœ¨ç›¸é‚»çš„æ¥¼å±‚ï¼Œè¯·é—®ä»–ä»¬å„ä½åœ¨å“ªä¸€å±‚ï¼Ÿ\nåœ¨æ²¡æœ‰ambæ—¶ï¼Œä»£ç æ€ä¹ˆå†™å‘¢ï¼Ÿææ€•ä¸å®¹æ˜“å§ã€‚ä½†æ˜¯ç°åœ¨æœ‰äº†ambæ±‚å€¼å™¨ï¼Œç¬é—´ç¾å¥½äº†ï¼š\n(define (multiple-dwelling) (let ( [caocao (amb 1 2 3 4 5)] [sunquan (amb 1 2 3 4 5)] [liubei (amb 1 2 3 4 5)] [yuanshao (amb 1 2 3 4 5)] [machao (amb 1 2 3 4 5)] ) (require (distinct? (list caocao sunquan liubei yuanshao machao))) (require (not (= caocao 5))) (require (not (= sunquan 1))) (require (not (= liubei 5))) (require (not (= liubei 1))) (require (\u0026gt; yuanshao liubei)) (require (not (= (abs (- machao liubei)) 1)) (require (not (= (abs (- sunquan liubei)) 1)) (list (list \u0026#39;caocao caocao) (list \u0026#39;sunquan sunquan) (list \u0026#39;liubei liubei) (list \u0026#39;yuanshao yuanshao) (list \u0026#39;machao machao)) ) ) ä¸Šè¿°ä»£ç åªæ˜¯æè¿°é—®é¢˜çš„å…³ç³»ï¼Œå³å„ä¸ªrequireéƒ¨åˆ†ï¼ˆå…ˆä¸è€ƒè™‘æ€§èƒ½é—®é¢˜ã€‚è¿˜è®°å¾—ä¸Šæ–‡æåˆ°çš„â€œæè¿°é—®é¢˜ï¼Œä½†æ²¡æœ‰æè¿°é—®é¢˜çš„è§£å†³æ–¹æ³•â€å—ï¼Ÿï¼‰ï¼Œå¹¶æ²¡æœ‰æ·»åŠ ä»€ä¹ˆâ€œå¤„ç†é€»è¾‘â€ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿä¸‹é¢ç»“æœï¼š\n((caocao 3) (sunquan 2) (liubei 4) (yuanshao 5) (machao 1))\nå±…ç„¶å¾—åˆ°äº†è°œé¢˜çš„è§£ï¼Œè¿™æ˜¯ä»€ä¹ˆé­”æ³•ï¼Ÿï¼Ÿï¼Ÿ\nambè½»è€Œæ˜“ä¸¾åœ°è§£å†³äº†è¿™ç§éœ€è¦å¤§é‡å›æº¯çš„é—®é¢˜ã€‚\nå®ç° ç°åœ¨è¯¥è°ˆä¸€è°ˆç¥å¥‡çš„ambå¦‚ä½•å®ç°äº†å§ã€‚å‰æ–‡å·²ç»å¤šæ¬¡æåˆ°è¿‡ï¼Œambæ±‚å€¼çš„è¿‡ç¨‹å¯èƒ½ä¼šä¸æ–­çš„å›æº¯ï¼Œè¿™åŠ¿å¿…å¯¼è‡´ç¨‹åºæµç¨‹çš„è·³è½¬ï¼Œç¨‹åºè·³è½¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€å¯æ²¡æœ‰break,continueä¹‹ç±»çš„è¯­æ³•ï¼Œå› ä¸ºæ ¹æœ¬ä¸éœ€è¦ï¼Œé‚£ä¹ˆå‡½æ•°å¼è¯­è¨€æœ‰å•¥ï¼Ÿç­”æ¡ˆæ˜¯continuation(ç¿»è¯‘æˆç»§ç»­ï¼Œæˆ–è€…å»¶ç»­éƒ½å¯ä»¥ã€‚è¿˜è®°å¾—â€œä¸€è¯­åŒå…³â€å—ï¼Ÿ)\nSchemeå†…ç½®äº†è¿™ä¸ªå¼ºå¤§çš„æ§åˆ¶æŠ½è±¡ï¼Œè¿‡ç¨‹åä¸ºï¼šcall-with-current-continuationï¼Œ åå­—ç•¥é•¿ï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯ç”¨å…¶ç¼©å†™ï¼šcall/ccã€‚å›¿äºç¯‡å¹…ï¼Œæœ¬æ–‡ä¸æ‰“ç®—ä»‹ç»continuationï¼Œå¦‚æœæƒ³è¯¦ç»†äº†è§£å®ƒï¼Œè¯·è‡ªè¡Œæœç´¢ã€‚\nå¸¸è§„æ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸€ä¸ªå‚æ•°ï¼šæ‰§è¡Œç¯å¢ƒenvã€‚ambæ±‚å€¼å™¨çš„æ‰§è¡Œè¿‡ç¨‹æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œé™¤äº†æ‰§è¡Œç¯å¢ƒenvä¹‹å¤–ï¼Œè¿˜æœ‰ä¸¤ä¸ªcontinuationè¿‡ç¨‹ï¼ˆä¸€ä¸ªæˆåŠŸå»¶ç»­ã€ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼‰ã€‚å¯¹ä¸€ä¸ªè¡¨è¾¾å¼è¿›è¡Œæ±‚å€¼ï¼Œç»“æŸåä¼šè°ƒç”¨è¿™ä¸¤ä¸ªcontinuationè¿‡ç¨‹ä¹‹ä¸€ï¼šå¦‚æœæ­¤æ¬¡æ±‚å€¼å¾—åˆ°äº†ä¸€ä¸ªç»“æœï¼Œåˆ™è°ƒç”¨æˆåŠŸå»¶ç»­ï¼›å¦‚æœç»“æœæ˜¯é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™è°ƒç”¨å¤±è´¥å»¶ç»­ã€‚\næˆåŠŸå»¶ç»­çš„å·¥ä½œæ˜¯ï¼šæ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶å°†è®¡ç®—è¿›è¡Œå»ä¸‹ï¼Œä¸è¿™ä¸ªå€¼ä¸€èµ·ï¼ŒæˆåŠŸå»¶ç»­è¿‡ç¨‹è¿˜å°†å¾—åˆ°ä¸€ä¸ªå¦ä¸€ä¸ªå¤±è´¥å»¶ç»­ï¼Œå¦‚æœä½¿ç”¨è¯¥å€¼æ—¶é‡åˆ°äº†æ­»èƒ¡åŒï¼Œåˆ™éœ€è¦è°ƒç”¨è¿™ä¸ªå¤±è´¥å»¶ç»­ã€‚\nå¤±è´¥å»¶ç»­çš„å·¥ä½œæ˜¯ï¼šè¯•æ¢éç¡®å®šæ€§è¿‡ç¨‹çš„å¦ä¸€ä¸ªåˆ†æ”¯ã€‚éç¡®å®šæ€§è®¡ç®—çš„æœ€å…³é”®çš„ç‰¹å¾ï¼Œåœ¨äºè¡¨è¾¾å¼å¯ä»¥è¡¨ç¤ºäºä¸åŒå¯èƒ½æ€§ä¹‹é—´çš„é€‰æ‹©ã€‚\næˆ‘æ‰¿è®¤æœ‰ç‚¹çƒ§è„‘ï¼Œä½†è¿˜ç®—æ¸…æ™°ï¼Œè®©é€’å½’åœ¨è„‘æµ·ä¸­å¥”æ¶Œå§ã€‚\nåˆ©ç”¨å®æ¥ç®€åŒ–ambçš„æ„é€ ï¼Œä»£ç å‚è€ƒè¿™é‡Œï¼š\n(define amb-fail \u0026#39;*) (define initialize-amb-fail (lambda () (set! amb-fail (lambda () (error \u0026#34;amb tree exhausted\u0026#34;))))) (initialize-amb-fail) (define-syntax amb (syntax-rules () ((amb alt ...) (let ((prev-amb-fail amb-fail)) ;ä¿å­˜å‰ä¸€ä¸ªé€‰æ‹©ç‚¹ (call/cc (lambda (sk) ;å¯¹äºæ•´ä¸ªambè¡¨è¾¾å¼æ„é€ ä¸€ä¸ªskçš„contnuation (call/cc (lambda (fk) ;å¯¹äºæ¯ä¸€ä¸ªambçš„é€‰é¡¹æ„é€ ä¸€ä¸ªfkçš„continuation (set! amb-fail ;å…ˆæŠŠamb-failè®¾ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å¯å°†amb-failæ¢å¤åˆ°è¿›å…¥ambå‰çš„å€¼ (lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) ) (sk alt) ;ç«‹å³è¿”å›è‡ªå·±çš„åˆ†æ”¯çš„å€¼,ä»è€Œå¼•èµ·ambè¡¨è¾¾å¼ä¸­é€”è¿”å›ã€‚æ³¨æ„ï¼Œæ¯ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œæ—¶éƒ½ä¼šå¼•èµ· amb ç«‹å³è¿”å›ã€‚åé¢çš„åˆ†æ”¯éƒ½è¿˜æ²¡æœ‰æ‰§è¡Œï¼ ) ) ... (prev-amb-fail) ) ) ) ) ) ) ç¬¬ä¸€ä¸ªé€‰é¡¹ï¼ˆä¹Ÿå¯ä»¥å«åˆ†æ”¯ï¼‰ä¼šè¢«ç«‹å³è¿”å›ï¼Œåé¢çš„æš‚æ—¶ä¸æ‰§è¡Œã€‚å‡è®¾è¯¥å€¼è¢«è®¤ä¸ºæ˜¯â€œæ— æ•ˆçš„ï¼ˆæ¯”å¦‚åº”ç”¨è¯¥å€¼åï¼Œæ‰§è¡Œåˆ°(amb)äº†ï¼‰â€ï¼Œåˆ™æ‰§è¡Œ(prev-amb-fail)ï¼Œè€Œprev-amb-failåœ¨è¿›å…¥ambçš„æ—¶å€™è¢«ç»‘å®šåˆ°äº†amb-failï¼Œ ä¸è¿‡amb-failå·²è¢«è®¾ç½®æˆäº†ä¸€ä¸ªå‡½æ•°ï¼š\n(lambda () (set! amb-fail prev-amb-fail) (fk \u0026#39;fail)) å®ƒå…ˆæŠŠamb-failè®¾ç½®æˆprev-amb-fail,ä¹Ÿå°±æ˜¯è¿›å…¥ï¼ˆamb alt \u0026hellip;ï¼‰ä¹‹å‰çš„å€¼ï¼Œ ç„¶åç”¨(fk \u0026lsquo;fail)è¿”å›\u0026rsquo;failåˆ°åˆ†æ”¯çš„continuationï¼Œå³å¯ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†æ”¯ï¼ˆä¸‹ä¸€ä¸ªé€‰é¡¹ï¼‰äº†ã€‚\nååˆ†ç²¾å·§çš„ç¨‹åºï¼ï¼ï¼\nä¸Šè¿°çš„ambæ¯æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå¦‚æœéœ€è¦è¿”å›æ‰€æœ‰æœ‰æ•ˆçš„ç»“æœï¼Œå¯ä»¥ç”¨ä¸‹é¢å®šä¹‰çš„å®ï¼š\n(define-syntax bag-of (syntax-rules () ((bag-of e) (let ((prev-amb-fail amb-fail) (results \u0026#39;())) (if (call/cc (lambda (k) (set! amb-fail (lambda () (k #f))) ;\u0026lt;-----+ (let ((v e)) ;amb-fail will be modified by e | (set! results (cons v results)) ;| (k #t)))) ;| (amb-fail)) ;so this amb-fail may not be ---+ (set! amb-fail prev-amb-fail) (reverse! results))))) (bag-of (let ([a (amb 1 2 3)] [b (amb 0 -1 2)]) (if (= (+ a b) 1) (list a b) (amb)) )) ;ç»“æœä¸ºï¼š((1 0) (2 -1)) å›åˆ°n-çš‡åé—®é¢˜ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å·²æ‰‹æ¡ambè¿™æŠŠåˆ©å™¨ï¼Œæ˜¯æ—¶å€™é‡æ„ä¸€ä¸‹n-çš‡åé—®é¢˜äº†ã€‚\n(define number-between (lambda (lo hi) (let loop ((i lo)) (if (\u0026gt; i hi) (amb) (amb i (loop (+ i 1))))))) ; (amb 1 (amb 2 (amb 3 ... ))) (define (n-queens n) (call/cc (lambda (return) (let add-queen ([i 0] [result \u0026#39;()]) (when (\u0026lt; i n) ;æœ€å¤šæ‘†å‡ ä¸ªçš‡å (let ([new-queen (number-between 1 n)]) (if (safe? n (append (list new-queen) result)) ;æ–°åŠ å…¥çš„çš‡åå¿…é¡»æ˜¯æœ‰æ•ˆçš„ (add-queen (+ i 1) (append (list new-queen) result)) (amb)) ) ) (return result) ) ) ) ) (bag-of (n-queens 8)) ;8ä¸ªçš‡åçš„æ‰€æœ‰è§£ è¯¥ç‰ˆæœ¬æ¯”ä¹‹å‰çš„Schemeç‰ˆæœ¬çš„å®ç°æ”¹è¿›äº†å¾ˆå¤šï¼Œç°åœ¨åªéœ€è¦æè¿°ä¸€ä¸‹æˆ‘çš„é—®é¢˜çš„å…³ç³»å³å¯ï¼Œç¨‹åºä¼šè‡ªåŠ¨é€‰æ‹©æ‰€æœ‰æ­£ç¡®çš„å€¼ï¼Œæ— éœ€å…³å¿ƒè®¡ç®—æœºå†…éƒ¨åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚åœ¨é¢å¯¹å¾ˆå¤šé€»è¾‘é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ¾åœ°è§£å†³äº†ã€‚\nä¹Ÿè®¸æœ‰äººä¼šé—®ï¼Œå¦‚æœé‡‡ç”¨å‘½ä»¤å¼è¯­è¨€æ¥å¤„ç†çš„è¯ï¼Œå¯èƒ½å‡ ä¸ªåµŒå¥—çš„å¾ªç¯ä¹Ÿèƒ½è¾¾åˆ°ç›¸åŒçš„ç»“æœï¼Œå¦‚æ­¤å¤§è´¹å‘¨ç« çš„ä»‹ç»è¿™ä¸ªå«ambçš„æŠ€æœ¯ï¼Œåˆ°åº•æœ‰ä»€ä¹ˆä»·å€¼å‘¢ï¼Ÿ é‚£å°±æ¥èŠä¸€èŠã€‚\næœ‰ä»€ä¹ˆæ„ä¹‰ï¼Ÿ åœ¨è°ˆè®ºæ„ä¹‰ä¹‹å‰ï¼Œå®¹è®¸æˆ‘æä¸€ä¸ªé—®é¢˜\nä¸ºä»€ä¹ˆSQLè¯­è¨€è¦è®¾è®¡æˆè¿™æ ·ï¼Ÿä¸å‘½ä»¤å¼è¯­è¨€å¦‚æ­¤çš„ä¸åŒï¼Ÿ\né¦–å…ˆéœ€è¦æ˜ç¡®çš„ä¸€ç‚¹æ˜¯ï¼Œè®¡ç®—æœºç§‘å­¦å¤„ç†çš„æ˜¯å‘½ä»¤å¼ï¼ˆæ€æ ·åšï¼‰çš„çŸ¥è¯†ï¼Œè€Œæ•°å­¦å¤„ç†çš„æ˜¯è¯´æ˜å¼ï¼ˆæ˜¯ä»€ä¹ˆï¼‰çš„çŸ¥è¯†ã€‚ äº‹å®ä¸Šï¼Œäººç±»ä¸å¯èƒ½åªé¢ä¸´å…¶ä¸­ä¸€ç§é—®é¢˜ï¼Œç¨‹åºè®¾è®¡ä¸­ä¸€ä¸ªé‡è¦çš„åˆ†æ”¯å°±æ˜¯é€»è¾‘ç¨‹åºè®¾è®¡ï¼Œæœ‰å¾ˆå¤šé—®é¢˜æˆ–è€…æ•°æ®ä¹‹é—´å­˜åœ¨ç€å…³è”å…³ç³»ï¼Œéš¾ä»¥è§‚æµ‹åˆ°ç»“è®ºï¼Œæè¿°å®ƒä»¬çš„å…³ç³»å¾ˆç®€å•ï¼Œä½†æ˜¯ç›´æ¥å‘Šè¯‰è®¡ç®—æœºå¦‚ä½•å»åšå´ä¸é‚£ä¹ˆå®¹æ˜“ï¼Œæˆ–è®¸æˆ‘ä»¬å¯ä»¥ä¸ºè‹¥å¹²æ­¤ç±»é—®é¢˜ç¼–å†™å‘½ä»¤å¼ä»£ç ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ‰€æœ‰è¿™æ ·çš„é—®é¢˜éƒ½ç¼–å†™ä»£ç ï¼Œæ˜¾ç„¶ä¿¡æ¯ä¹‹é—´çš„å…³ç³»æ˜¯å¤šç§å¤šæ ·çš„ï¼Œé‚£ä¹ˆä»£ç å°±éœ€è¦ç›¸åº”çš„å˜åŒ–ï¼Œå¾€å¾€ä¿®æ”¹è¿™æ ·çš„ä»£ç æ˜¯å¾ˆå›°éš¾çš„ï¼Œ ç”šè‡³éœ€è¦é‡æ–°è®¾è®¡å¹¶ç¼–ç ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœç¨‹åºè®¾è®¡å¯ä»¥å¤„ç†è¯´æ˜å¼çš„çŸ¥è¯†ï¼Œå²‚ä¸æ˜¯å¤§å¤§å‡è½»äº†ç¨‹åºå‘˜çš„å·¥ä½œäº†å‘¢ï¼Ÿå‡½æ•°å¼è¯­è¨€çš„è®¾è®¡æ˜¯åŸºäºlambdaç†è®ºï¼Œå›´ç»•ç€æ•°å­¦å‡½æ•°å€¼çš„è®¡ç®—ç»„ç»‡èµ·æ¥çš„ï¼Œä¾é å…¶å¼ºå¤§çš„è¡¨ç°åŠ›ï¼Œåœ¨å¤„ç†é€»è¾‘é—®é¢˜ä¸Šæ›´åŠ å¾—å¿ƒåº”æ‰‹ï¼Œå¯ä»¥åŒ–ç¹ä¸ºç®€ã€‚\nè¯´åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯è§‰å¾—ï¼Œä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ä¹‹é—´å­˜åœ¨ç€ç§ç§è”ç³»å‘¢ï¼ŸSQLæ­£æ˜¯æè¿°äº†è¿™ç§å…³ç³»ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰æ•°æ®åº“æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ•°æ®ï¼ˆselectï¼‰, æ•°æ®åœ¨ä»€ä¹ˆä½ç½®ï¼ˆfromï¼‰, å“ªäº›æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆwhereï¼‰å°±è¡Œäº†ï¼Œå¹¶ä¸éœ€è¦å‘Šè¯‰æ•°æ®åº“è¯¥å¦‚ä½•å…·ä½“æ“ä½œï¼Œæ•°æ®åº“å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„æè¿°ï¼ˆSQLï¼‰å°±èƒ½å¤Ÿå‡†ç¡®çš„è¿”å›ç»“æœï¼Œè¿™çœŸæ˜¯å…³äºéç¡®å®šæ€§è®¡ç®—çš„ä¸€ä¸ªæå¥½çš„ä¾‹å­ï¼Œæ­¤æ—¶æˆ‘ä»¬æ€»è¯¥æ˜ç™½ä¸ºä»€ä¹ˆæ•°æ®åº“å«åšå…³ç³»å‹æ•°æ®åº“ äº†å§ã€‚æˆ‘ä»¬ä¸å¦¨è®¾æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸é‡‡ç”¨æè¿°çš„æ–¹å¼æ¥æŸ¥è¯¢æ•°æ®ï¼Œç¨‹åºå‘˜ä»¬è¯¥æ€ä¹ˆåšï¼Ÿè¿˜èƒ½å¤Ÿè½»æ˜“çš„æŸ¥æ‰¾åˆ°éœ€è¦çš„æ•°æ®å—ï¼Ÿ\nåˆšæ‰æˆ‘æå‡ºçš„é—®é¢˜ï¼Œæƒ³å¿…æ­¤åˆ»åº”è¯¥æœ‰ç­”æ¡ˆäº†ã€‚\n","id":126,"section":"posts","summary":"è®²æ•…äº‹å¹¶ä¸æ˜¯æˆ‘æ“…é•¿çš„äº‹æƒ…ï¼Œä¸è¿‡äº‹æƒ…æ€»æœ‰ä¸€ä¸ªå¼€å§‹ï¼Œè¯¸ä½çœ‹å®˜è«å«Œæˆ‘çµ®çƒ¦ï¼Œåªæ˜¯å¸Œæœ›å¯ä»¥è®²è¿°çš„æ›´æœ‰æ¡ç†ä¸€äº›ã€‚æŸæ—¥æ­£è¯»ä¸€æœ¬å…³äºErlangçš„ä¹¦ï¼Œä¹¦ä¸­å‡º","tags":["scheme"],"title":"ä»â€œå…«çš‡åâ€åˆ°amb","uri":"https://lvsq.net/2020/05/n-queens/","year":"2020"},{"content":" ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah\nä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°å…¶ä»–è¯­è¨€ 2ï¼‰ç”¨äºæ„å»ºå¯ä¼¸ç¼©å’Œå¼¹æ€§å¹¶å‘ç³»ç»Ÿçš„OTPåº“å’Œä¸­é—´ä»¶ï¼Œä»¥åŠ 3ï¼‰ä¸è¯­è¨€è¯­ä¹‰ç´§å¯†è€¦åˆçš„BEAMè™šæ‹Ÿæœºå’ŒOTPã€‚\nå•ç‹¬ä½¿ç”¨è¿™äº›ç»„ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæ‚¨å°†è·å¾—äºšå†›ã€‚ä½†æ˜¯ï¼Œå°†è¿™ä¸‰ä¸ªå› ç´ æ”¾åœ¨ä¸€èµ·ï¼Œæ‚¨å°†è·å¾—å¯ä¼¸ç¼©ï¼Œçµæ´»çš„è½¯å®æ—¶ç³»ç»Ÿçš„æ— å¯äº‰è®®çš„èµ¢å®¶ã€‚å¼•ç”¨Joe Armstrongçš„è¯ï¼šâ€œæ‚¨å¯ä»¥å¤åˆ¶Erlangåº“ï¼Œä½†æ˜¯å¦‚æœå®ƒä¸èƒ½åœ¨BEAMä¸Šè¿è¡Œï¼Œåˆ™æ— æ³•æ¨¡æ‹Ÿè¯­ä¹‰â€ã€‚è¿™æ˜¯ç”±ç½—ä¼¯ç‰¹Â·ç»´å°”ä¸ï¼ˆRobert Virdingï¼‰çš„ã€Šç¬¬ä¸€æ¡ç¼–ç¨‹è§„åˆ™ã€‹å¼ºåˆ¶æ‰§è¡Œçš„ï¼Œè¯¥æ¡è§„å®šï¼šâ€œä»»ä½•å¦ä¸€ç§è¶³å¤Ÿå¤æ‚çš„å¹¶å‘ç¨‹åºéƒ½ä½¿ç”¨å¦ä¸€ç§è¯­è¨€ï¼ŒåŒ…å«éæ­£å¼çš„ï¼Œä¸´æ—¶æŒ‡å®šçš„ï¼Œbugç¼ èº«çš„ç¼“æ…¢çš„Erlangä¸€åŠå®ç°ã€‚â€\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æƒ³æ¢ç´¢BEAM VMå†…éƒ¨ã€‚æˆ‘ä»¬å°†åœ¨é€‚ç”¨çš„æƒ…å†µä¸‹å°†å®ƒä»¬ä¸JVMè¿›è¡Œæ¯”è¾ƒå’Œå¯¹æ¯”ï¼Œå¼ºè°ƒæ‚¨ä¸ºä»€ä¹ˆè¦æ³¨æ„å®ƒä»¬å¹¶åŠ ä»¥æ³¨æ„ã€‚é•¿æœŸä»¥æ¥ï¼Œæ­¤ç»„ä»¶ä¸€ç›´è¢«è§†ä¸ºé»‘åŒ£å­ï¼Œå¹¶ä¸”åœ¨ä¸äº†è§£åŸå› æˆ–å«ä¹‰çš„æƒ…å†µä¸‹è¢«è§†ä¸ºç†æ‰€å½“ç„¶ã€‚ç°åœ¨è¯¥æ”¹å˜è¿™ç§æƒ…å†µäº†ï¼\nBEAMçš„äº®ç‚¹ å‘æ˜Erlangå’ŒBEAM VMæ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„æ­£ç¡®å·¥å…·ã€‚å®ƒä»¬æ˜¯ç”±çˆ±ç«‹ä¿¡å¼€å‘çš„ï¼Œæ—¨åœ¨å¸®åŠ©å®ç°å¤„ç†ç§»åŠ¨å’Œå›ºå®šç½‘ç»œçš„ç”µä¿¡åŸºç¡€è®¾æ–½ã€‚è¯¥åŸºç¡€æ¶æ„æœ¬è´¨ä¸Šæ˜¯é«˜åº¦å¹¶å‘å’Œå¯ä¼¸ç¼©çš„ã€‚å®ƒå¿…é¡»æ˜¾ç¤ºè½¯å®æ—¶å±æ€§ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ã€‚æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æ‰‹æœºä¸Šä¸ç¥–æ¯è¿›è¡Œç¯èŠé€šè¯æ—¶æ‰çº¿æˆ–Fortniteçš„åœ¨çº¿æ¸¸æˆä½“éªŒä¸ä¼šå—åˆ°ç³»ç»Ÿå‡çº§ï¼Œé«˜ç”¨æˆ·è´Ÿè½½æˆ–è½¯ä»¶ï¼Œç¡¬ä»¶å’Œç½‘ç»œä¸­æ–­çš„å½±å“ã€‚BEAM VMé€šè¿‡æä¾›å¯åœ¨å¯é¢„æµ‹çš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¹‹ä¸Šè¿è¡Œçš„å¾®è°ƒåŠŸèƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥è§£å†³è®¸å¤šæŒ‘æˆ˜ã€‚\nå®ƒçš„ç§˜è¯€æ˜¯è½»é‡çº§è¿›ç¨‹ï¼Œå®ƒä»¬ä¸å…±äº«å†…å­˜ï¼Œç”±è°ƒåº¦ç¨‹åºç®¡ç†ï¼Œè¯¥è°ƒåº¦ç¨‹åºå¯ä»¥è·¨å¤šä¸ªå†…æ ¸ç®¡ç†æ•°ç™¾ä¸‡ä¸ªè¿›ç¨‹ã€‚å®ƒä½¿ç”¨åŸºäºæ¯ä¸ªè¿›ç¨‹è¿è¡Œçš„åƒåœ¾æ”¶é›†å™¨ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†é«˜åº¦ä¼˜åŒ–ä»¥å‡å°‘å¯¹å…¶ä»–è¿›ç¨‹çš„å½±å“ã€‚ç»“æœï¼Œåƒåœ¾æ”¶é›†å™¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“è½¯å®æ—¶å±æ€§ã€‚BEAMä¹Ÿæ˜¯å”¯ä¸€ä½¿ç”¨è§„æ¨¡å¹¿æ³›ä¸”å…·æœ‰å†…ç½®åˆ†å‘æ¨¡å‹çš„VMï¼Œå®ƒå…·æœ‰å†…ç½®çš„åˆ†å‘æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…è®¸ç¨‹åºé€æ˜åœ°åœ¨å¤šå°è®¡ç®—æœºä¸Šè¿è¡Œã€‚\nJVMçš„äº®ç‚¹ Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰æ˜¯â€‹â€‹ç”±Sun Microsystemå¼€å‘çš„ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¯åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œçš„â€œä¸€æ¬¡å†™å…¥â€ä»£ç çš„å¹³å°ã€‚ä»–ä»¬åˆ›å»ºäº†ä¸€ç§ç±»ä¼¼äºC++çš„é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œä½†æ˜¯å†…å­˜å®‰å…¨ï¼Œå› ä¸ºå…¶è¿è¡Œæ—¶é”™è¯¯æ£€æµ‹ä¼šæ£€æŸ¥æ•°ç»„èŒƒå›´å’ŒæŒ‡é’ˆå–æ¶ˆå¼•ç”¨ã€‚åœ¨Internetæ—¶ä»£ï¼ŒJVMç”Ÿæ€ç³»ç»Ÿå˜å¾—éå¸¸æµè¡Œï¼Œä½¿å…¶æˆä¸ºä¼ä¸šæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å®é™…æ ‡å‡†ã€‚æ»¡è¶³å¹¿æ³›ç”¨ä¾‹çš„è™šæ‹Ÿæœºå’Œå¯æ»¡è¶³ä¼ä¸šå‘å±•éœ€æ±‚çš„ä»¤äººå°è±¡æ·±åˆ»çš„åº“é›†ä½¿å¹¿æ³›çš„é€‚ç”¨æ€§æˆä¸ºå¯èƒ½ã€‚\nJVMè®¾è®¡æ—¶è€ƒè™‘äº†æ•ˆç‡ã€‚å®ƒçš„å¤§å¤šæ•°æ¦‚å¿µæ˜¯æµè¡Œæ“ä½œç³»ç»Ÿä¸­åŠŸèƒ½çš„æŠ½è±¡ï¼Œä¾‹å¦‚æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„çº¿ç¨‹æ¨¡å‹ã€‚JVMæ˜¯é«˜åº¦å¯å®šåˆ¶çš„ï¼ŒåŒ…æ‹¬åƒåœ¾æ”¶é›†å™¨ï¼ˆGCï¼‰å’Œç±»åŠ è½½å™¨ã€‚ä¸€äº›æœ€å…ˆè¿›çš„GCå®ç°æä¾›é«˜åº¦å¯è°ƒæ•´çš„åŠŸèƒ½ï¼Œä»¥é€‚åº”åŸºäºå…±äº«å†…å­˜çš„ç¼–ç¨‹æ¨¡å‹ã€‚JVMå…è®¸æ‚¨åœ¨ç¨‹åºè¿è¡Œæ—¶æ›´æ”¹ä»£ç ã€‚è€Œä¸”ï¼ŒJITç¼–è¯‘å™¨å…è®¸å°†å­—èŠ‚ç ç¼–è¯‘ä¸ºæœ¬æœºä»£ç ï¼Œç›®çš„æ˜¯åŠ å¿«åº”ç”¨ç¨‹åºçš„å„ä¸ªéƒ¨åˆ†ã€‚\nJavaä¸–ç•Œä¸­çš„å¹¶å‘æ€§ä¸»è¦ä¸åœ¨å¹¶è¡Œçº¿ç¨‹ä¸­è¿è¡Œåº”ç”¨ç¨‹åºæœ‰å…³ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ˜¯å¿«é€Ÿçš„ã€‚ç”±äºå¹¶å‘åŸè¯­çš„å…±äº«å†…å­˜æ¨¡å‹å¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå› æ­¤ä½¿ç”¨å¹¶å‘åŸè¯­è¿›è¡Œç¼–ç¨‹æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸ºäº†å…‹æœè¿™äº›å›°éš¾ï¼Œäººä»¬å°è¯•ç®€åŒ–å’Œç»Ÿä¸€å¹¶å‘ç¼–ç¨‹æ¨¡å‹ï¼Œæœ€æˆåŠŸçš„å°è¯•æ˜¯Akkaæ¡†æ¶ã€‚\nå¹¶å‘ä¸å¹¶è¡Œ å¦‚æœéƒ¨åˆ†ä»£ç åœ¨å¤šä¸ªå†…æ ¸ï¼Œå¤„ç†å™¨æˆ–è®¡ç®—æœºä¸ŠåŒæ—¶è¿è¡Œï¼Œåˆ™æˆ‘ä»¬è°ˆè®ºå¹¶è¡Œä»£ç æ‰§è¡Œï¼Œè€Œå¹¶å‘ç¼–ç¨‹æ˜¯æŒ‡ç‹¬ç«‹å¤„ç†åˆ°è¾¾ç³»ç»Ÿçš„äº‹ä»¶ã€‚å¯ä»¥åœ¨å•çº¿ç¨‹ç¡¬ä»¶ä¸Šæ¨¡æ‹Ÿå¹¶å‘æ‰§è¡Œï¼Œè€Œå¹¶è¡Œæ‰§è¡Œåˆ™ä¸èƒ½ã€‚å°½ç®¡è¿™ç§åŒºåˆ«ä¼¼ä¹å¾ˆå¤æ€ªï¼Œä½†è¿™ç§å·®å¼‚å¯¼è‡´éœ€è¦è§£å†³çš„é—®é¢˜éå¸¸ä¸åŒã€‚æƒ³æƒ³å¾ˆå¤šå¨å¸ˆåœ¨åšä¸€ç›˜Carbonaraæ„å¤§åˆ©é¢ã€‚åœ¨å¹¶è¡Œæ–¹æ³•ä¸­ï¼Œå°†ä»»åŠ¡åˆ†é…ç»™å¯ç”¨å¨å¸ˆçš„æ•°é‡ï¼Œå¹¶ä¸”åªè¦å®Œæˆè¿™äº›å¨å¸ˆå®Œæˆå…¶ç‰¹å®šä»»åŠ¡çš„é€Ÿåº¦ï¼Œå°±å¯ä»¥å®Œæˆå•ä¸ªéƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ªå¹¶å‘çš„ä¸–ç•Œä¸­ï¼Œæ¯ä½å¨å¸ˆå°†è·å¾—ä¸€éƒ¨åˆ†ï¼Œæ¯ä½å¨å¸ˆå°†å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚æ‚¨å°†å¹¶è¡Œæ€§ç”¨äºé€Ÿåº¦ï¼Œå¹¶å‘æ€§ç”¨äºè§„æ¨¡ã€‚\nå¹¶è¡Œæ‰§è¡Œè¯•å›¾å°†é—®é¢˜çš„æœ€ä½³åˆ†è§£è§£å†³ä¸ºå½¼æ­¤ç‹¬ç«‹çš„éƒ¨åˆ†ã€‚å°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ï¼Œç‚¸ç“œé‡Œé˜¿å¡ç«è…¿ï¼Œå°†ä½©å…‹ç«‹è¯ºå¥¶é…ªç£¨ç¢1ã€‚å…±äº«æ•°æ®ï¼ˆæˆ–åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ä¸ºé¤ç›˜ï¼‰ç”±é”ï¼Œäº’æ–¥é”å’Œå„ç§å…¶ä»–æŠ€æœ¯å¤„ç†ï¼Œä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚å¦ä¸€ç§çœ‹å¾…è¿™ç§æƒ…å†µçš„æ–¹å¼æ˜¯å­˜åœ¨æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›åˆ©ç”¨å°½å¯èƒ½å¤šçš„å¹¶è¡ŒCPUèµ„æºæ¥å°½å¿«å®Œæˆå·¥ä½œã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¹¶â€‹â€‹å‘ç¼–ç¨‹å¤„ç†è®¸å¤šäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶åœ¨ä¸åŒçš„æ—¶é—´åˆ°è¾¾ç³»ç»Ÿï¼Œå¹¶å°è¯•åœ¨åˆç†çš„æ—¶é—´å†…å¤„ç†æ‰€æœ‰äº‹ä»¶ã€‚åœ¨å¤šæ ¸æˆ–åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸Šï¼ŒæŸäº›æ‰§è¡Œæ˜¯å¹¶è¡Œè¿è¡Œçš„ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ã€‚å¦ä¸€ç§çœ‹å¾…å®ƒçš„æ–¹æ³•æ˜¯ï¼ŒåŒä¸€ä½å¨å¸ˆæŒ‰ç…§å§‹ç»ˆç›¸åŒçš„é¡ºåºç®—æ³•ï¼Œå°†æ°´ç…®æ²¸ï¼Œç…®æ„å¤§åˆ©é¢ï¼Œæ··åˆé¸¡è›‹ç­‰ã€‚è·¨è¿‡ç¨‹ï¼ˆæˆ–åšé¥­ï¼‰çš„å˜åŒ–æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰ï¼Œè¿™äº›æ•°æ®ï¼ˆæˆ–æˆåˆ†ï¼‰å­˜åœ¨äºå¤šä¸ªå®ä¾‹ä¸­ã€‚\nJVMæ˜¯ä¸ºå¹¶è¡Œè€Œæ„å»ºçš„ï¼Œè€ŒBEAMæ˜¯ä¸ºå¹¶å‘æ„å»ºçš„ã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªæœ¬è´¨ä¸Šä¸åŒçš„é—®é¢˜ï¼Œéœ€è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚\nBEAMå’Œå¹¶å‘ BEAMæä¾›è½»é‡çº§æµç¨‹ä¸ºæ­£åœ¨è¿è¡Œçš„ä»£ç æä¾›ä¸Šä¸‹æ–‡ã€‚è¿™äº›è¿›ç¨‹ä¹Ÿç§°ä¸ºactorï¼Œä¸å…±äº«å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œå°†æ•°æ®ä»ä¸€ä¸ªè¿›ç¨‹å¤åˆ¶åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯è™šæ‹Ÿæœºé€šè¿‡å„ä¸ªè¿›ç¨‹æ‹¥æœ‰çš„é‚®ç®±å®ç°çš„åŠŸèƒ½ã€‚æ¶ˆæ¯ä¼ é€’æ˜¯ä¸€ç§éé˜»å¡æ“ä½œï¼Œè¿™æ„å‘³ç€å°†æ¶ˆæ¯å‘é€åˆ°å¦ä¸€ä¸ªè¿›ç¨‹å‡ ä¹æ˜¯å³æ—¶çš„ï¼Œå¹¶ä¸”ä¸ä¼šé˜»å¡å‘é€è€…çš„æ‰§è¡Œã€‚å‘é€çš„æ¶ˆæ¯é‡‡ç”¨ä¸å¯å˜æ•°æ®çš„å½¢å¼ï¼Œä»å‘é€è¿‡ç¨‹çš„å †æ ˆå¤åˆ¶åˆ°æ¥æ”¶è€…çš„é‚®ç®±ã€‚æ— éœ€åœ¨è¿›ç¨‹ä¹‹é—´ä½¿ç”¨é”å’Œäº’æ–¥é”å³å¯å®ç°æ­¤ç›®çš„ï¼Œè€Œåœ¨å¤šä¸ªè¿›ç¨‹å¹¶è¡Œå°†æ¶ˆæ¯å‘é€åˆ°åŒä¸€æ”¶ä»¶äººçš„æƒ…å†µä¸‹ï¼Œåªéœ€å¯¹é‚®ç®±è¿›è¡Œé”å®šå³å¯ã€‚\nä¸å˜çš„æ•°æ®å’Œæ¶ˆæ¯ä¼ é€’ä½¿ç¨‹åºå‘˜èƒ½å¤Ÿç¼–å†™å½¼æ­¤ç‹¬ç«‹å·¥ä½œçš„æµç¨‹ï¼Œå¹¶ä¸“æ³¨äºåŠŸèƒ½è€Œä¸æ˜¯å†…å­˜çš„ä½çº§ç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ã€‚äº‹å®è¯æ˜ï¼Œè¿™ç§ç®€å•çš„è®¾è®¡ä¸ä»…é€‚ç”¨äºå•ä¸ªçº¿ç¨‹ï¼Œè€Œä¸”é€‚ç”¨äºåœ¨åŒä¸€VMä¸­è¿è¡Œçš„æœ¬åœ°è®¡ç®—æœºä¸Šçš„å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å†…ç½®çš„åˆ†å‘ï¼Œåœ¨æ•´ä¸ªç½‘ç»œä¸Šé€šè¿‡VMå’Œè®¡ç®—æœºé›†ç¾¤è¿è¡Œã€‚å¦‚æœæ¶ˆæ¯åœ¨è¿›ç¨‹ä¹‹é—´æ˜¯ä¸å¯å˜çš„ï¼Œåˆ™å¯ä»¥ä¸åŠ é”åœ°å°†å®ƒä»¬å‘é€åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼ˆæˆ–è®¡ç®—æœºï¼‰ï¼Œä»è€Œåœ¨åˆ†å¸ƒå¼å¤šæ ¸ä½“ç³»ç»“æ„ä¸Šå‡ ä¹çº¿æ€§åœ°æ‰©å±•ã€‚è¿›ç¨‹åœ¨æœ¬åœ°VMä¸Šçš„å¯»å€æ–¹å¼ä¸VMç¾¤é›†ä¸­çš„å¯»å€æ–¹å¼ç›¸åŒï¼Œæ— è®ºæ¥æ”¶è¿›ç¨‹çš„ä½ç½®å¦‚ä½•ï¼Œæ¶ˆæ¯å‘é€éƒ½æ˜¯é€æ˜çš„ã€‚\nè¿›ç¨‹ä¸å…±äº«å†…å­˜ï¼Œå› æ­¤æ‚¨å¯ä»¥å¤åˆ¶æ•°æ®ä»¥æ¢å¤å¼¹æ€§å¹¶åˆ†å‘æ•°æ®ä»¥å®ç°è§„æ¨¡æ‰©å±•ã€‚è¿™æ„å‘³ç€åœ¨ä¸¤ä¸ªä¸åŒçš„æœºå™¨ä¸Šå…·æœ‰ç›¸åŒè¿›ç¨‹çš„ä¸¤ä¸ªå®ä¾‹ï¼Œå½¼æ­¤ä¹‹é—´å…±äº«çŠ¶æ€æ›´æ–°ã€‚å¦‚æœä¸€å°è®¡ç®—æœºå‘ç”Ÿæ•…éšœï¼Œåˆ™å¦ä¸€å°è®¡ç®—æœºå…·æœ‰æ•°æ®å‰¯æœ¬ï¼Œå¹¶ä¸”å¯ä»¥ç»§ç»­å¤„ç†è¯¥è¯·æ±‚ï¼Œä»è€Œä½¿ç³»ç»Ÿå…·æœ‰å®¹é”™èƒ½åŠ›ã€‚å¦‚æœä¸¤å°è®¡ç®—æœºéƒ½å¯è¿è¡Œï¼Œåˆ™ä¸¤ä¸ªè¿›ç¨‹éƒ½å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä»è€Œä¸ºæ‚¨æä¾›å¯ä¼¸ç¼©æ€§ã€‚BEAMä¸ºæ‰€æœ‰è¿™äº›æ— ç¼é›†æˆæä¾›äº†é«˜åº¦ä¼˜åŒ–çš„åŸè¯­ï¼Œè€ŒOTPï¼ˆâ€œæ ‡å‡†åº“â€ï¼‰åˆ™æä¾›äº†æ›´é«˜çº§åˆ«çš„ç»“æ„ä»¥ç®€åŒ–ç¨‹åºå‘˜çš„ç”Ÿæ´»ã€‚\nAkkaåœ¨å¤åˆ¶æ›´é«˜çº§åˆ«çš„ç»“æ„æ–¹é¢åšå¾—å¾ˆå¥½ï¼Œä½†æ˜¯ç”±äºç¼ºå°‘JVMæä¾›çš„åŸè¯­è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå—åˆ°äº†é™åˆ¶ï¼Œä»è€Œä½¿å…¶å¯ä»¥é«˜åº¦ä¼˜åŒ–å¹¶å‘æ€§ã€‚å°½ç®¡JVMçš„åŸè¯­æ”¯æŒæ›´å¹¿æ³›çš„ç”¨ä¾‹ï¼Œä½†ç”±äºå®ƒä»¬æ²¡æœ‰ç”¨äºé€šä¿¡çš„å†…ç½®åŸè¯­ä¸”é€šå¸¸åŸºäºå…±äº«å†…å­˜æ¨¡å‹ï¼Œå› æ­¤å®ƒä»¬ä½¿å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¼–ç¨‹å˜å¾—æ›´åŠ å›°éš¾ã€‚ä¾‹å¦‚ï¼Œæ‚¨åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä½•å¤„æ”¾ç½®å…±äº«å†…å­˜ï¼Ÿä»¥åŠè®¿é—®å®ƒçš„æˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ\nè°ƒåº¦å™¨ æˆ‘ä»¬æåˆ°è¿‡ï¼ŒBEAMçš„æœ€å¼ºåŠŸèƒ½ä¹‹ä¸€å°±æ˜¯èƒ½å¤Ÿå°†ç¨‹åºåˆ†è§£ä¸ºå°çš„ï¼Œè½»é‡çº§çš„è¿‡ç¨‹ã€‚ç®¡ç†è¿™äº›è¿‡ç¨‹æ˜¯è°ƒåº¦ç¨‹åºçš„ä»»åŠ¡ã€‚ä¸JVMå°†å…¶çº¿ç¨‹æ˜ å°„åˆ°OSçº¿ç¨‹å¹¶è®©æ“ä½œç³»ç»Ÿè°ƒåº¦å®ƒä»¬ä¸åŒï¼ŒBEAMå¸¦æœ‰è‡ªå·±çš„è°ƒåº¦ç¨‹åºã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒåº¦ç¨‹åºä¸ºæ¯ä¸ªå†…æ ¸å¯åŠ¨ä¸€ä¸ªOSçº¿ç¨‹ï¼Œå¹¶ä¼˜åŒ–å®ƒä»¬ä¹‹é—´çš„å·¥ä½œè´Ÿè½½ã€‚æ¯ä¸ªè¿‡ç¨‹éƒ½åŒ…å«è¦æ‰§è¡Œçš„ä»£ç å’Œéšæ—¶é—´å˜åŒ–çš„çŠ¶æ€ã€‚è°ƒåº¦ç¨‹åºä¼šé€‰æ‹©è¿è¡Œé˜Ÿåˆ—ä¸­å‡†å¤‡è¿è¡Œçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºå…¶èµ‹äºˆå®šé‡çš„reductionsï¼ˆè¯‘è€…æ³¨ï¼š2000ä¸ªï¼‰ï¼Œå…¶ä¸­æ¯æ¬¡reductionéƒ½å¤§è‡´ç­‰åŒäºä¸€æ¡æŒ‡ä»¤ã€‚ä¸€æ—¦è¿›ç¨‹ç”¨å°½äº†reductionsï¼Œä¼šè¢«I/Oé˜»å¡ï¼Œç­‰å¾…æ¶ˆæ¯æˆ–ä»£ç å®Œæˆï¼Œè°ƒåº¦ç¨‹åºå°±ä¼šåœ¨è¿è¡Œé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªè¿›ç¨‹å¹¶å°†å…¶åˆ†æ´¾ï¼ˆæ­¤å¥ç¿»è¯‘æœ‰é—®é¢˜ï¼šåŸæ–‡æ˜¯Once the process has either run out of reductions, is blocked by I/O, is waiting for a message or completes executing its code, the scheduler picks the next process in the run queue and dispatches it. å¦‚æœæ‚¨æœ‰æ›´å¥½çš„ç¿»è¯‘è¯·ä¸åæŒ‡æ•™ï¼‰ã€‚è¿™ç§è°ƒåº¦æŠ€æœ¯ç§°ä¸ºæŠ¢å…ˆå¼ã€‚\næˆ‘ä»¬å¤šæ¬¡æåˆ°Akkaæ¡†æ¶ï¼Œå› ä¸ºå®ƒçš„æœ€å¤§ç¼ºç‚¹æ˜¯éœ€è¦åœ¨è°ƒåº¦å¤„æ·»åŠ æ³¨è§£ï¼Œå› ä¸ºè°ƒåº¦ä¸æ˜¯åœ¨JVMçº§åˆ«è¿›è¡Œçš„ã€‚é€šè¿‡è§£é™¤ç¨‹åºå‘˜çš„æ§åˆ¶ï¼Œå¯ä»¥ä¿ç•™å’Œä¿è¯è½¯å®æ—¶å±æ€§ï¼Œä»è€Œå‡ä½äº†å¯¼è‡´è¿›ç¨‹é¥¿æ­»çš„é£é™©ã€‚\nè¿›ç¨‹å›´ç»•ç€è°ƒåº¦ç¨‹åºçº¿ç¨‹ï¼Œå¹¶æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨CPUã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è°ƒæ•´è°ƒåº¦ç¨‹åºï¼Œä½†æ˜¯å®ƒå¾ˆå°‘è§ï¼Œä»…åœ¨è¾¹ç¼˜å’Œè¾¹ç•Œæƒ…å†µä¸‹æ‰éœ€è¦ï¼Œå› ä¸ºé»˜è®¤é€‰é¡¹æ¶µç›–äº†å¤§å¤šæ•°ä½¿ç”¨æ¨¡å¼ã€‚\nå…³äºè°ƒåº¦ç¨‹åºï¼Œç»å¸¸å‡ºç°ä¸€ä¸ªæ•æ„Ÿçš„è¯é¢˜ï¼šå¦‚ä½•å¤„ç†æœ¬æœºå®ç°çš„å‡½æ•°ï¼ˆNIFï¼‰ã€‚NIFæ˜¯ç”¨Cç¼–å†™çš„ä»£ç ç‰‡æ®µï¼Œè¢«ç¼–è¯‘ä¸ºåº“å¹¶åœ¨ä¸BEAMç›¸åŒçš„å†…å­˜ç©ºé—´ä¸­è¿è¡Œä»¥æé«˜é€Ÿåº¦ã€‚NIFçš„é—®é¢˜åœ¨äºå®ƒä»¬ä¸æ˜¯æŠ¢å å¼çš„ï¼Œå¹¶ä¸”ä¼šå½±å“è°ƒåº¦ç¨‹åºã€‚åœ¨æœ€æ–°çš„BEAMç‰ˆæœ¬ä¸­ï¼Œæ·»åŠ äº†ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå³è„è°ƒåº¦ç¨‹åºï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶NIFã€‚è‚®è„çš„è°ƒåº¦ç¨‹åºæ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œçš„å•ç‹¬çš„è°ƒåº¦ç¨‹åºï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘NIFå¯¹ç³»ç»Ÿé€ æˆçš„ä¸­æ–­ã€‚è„è¿™ä¸ªè¯æ˜¯æŒ‡è¿™äº›è°ƒåº¦ç¨‹åºè¿è¡Œçš„ä»£ç çš„æ€§è´¨ã€‚\nåƒåœ¾æ”¶é›†å™¨ å½“ä»Šï¼Œç°ä»£çš„é«˜çº§ç¼–ç¨‹è¯­è¨€å¤§å¤šä½¿ç”¨åƒåœ¾å›æ”¶å™¨è¿›è¡Œå†…å­˜ç®¡ç†ã€‚BEAMè¯­è¨€ä¹Ÿä¸ä¾‹å¤–ã€‚å½“æ‚¨è¦ç¼–å†™é«˜çº§å¹¶å‘ä»£ç æ—¶ï¼Œä¿¡ä»»è™šæ‹Ÿæœºæ¥å¤„ç†èµ„æºå’Œç®¡ç†å†…å­˜éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºè¿™å¯ä»¥ç®€åŒ–ä»»åŠ¡ã€‚å½’åŠŸäºåŸºäºä¸å¯å˜çŠ¶æ€çš„å†…å­˜æ¨¡å‹ï¼Œåƒåœ¾æ”¶é›†å™¨çš„åŸºç¡€å®ç°éå¸¸ç®€å•æœ‰æ•ˆã€‚æ•°æ®è¢«å¤åˆ¶è€Œä¸æ˜¯çªå˜ï¼Œå¹¶ä¸”è¿›ç¨‹ä¸å…±äº«å†…å­˜è¿™ä¸€äº‹å®æ¶ˆé™¤äº†ä»»ä½•è¿›ç¨‹çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå› æ­¤ä¸éœ€è¦ç®¡ç†å®ƒä»¬ã€‚\nBEAMçš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰åœ¨æ¯ä¸ªè¿›ç¨‹çš„åŸºç¡€ä¸Šè¿è¡Œåƒåœ¾å›æ”¶ï¼Œè€Œä¸ä¼šå½±å“åœ¨è¿è¡Œé˜Ÿåˆ—ä¸­ç­‰å¾…çš„å…¶ä»–è¿›ç¨‹ã€‚ç»“æœï¼ŒErlangä¸­çš„åƒåœ¾æ”¶é›†ä¸ä¼šâ€œstop-the-worldâ€ã€‚å®ƒå¯ä»¥é˜²æ­¢å¤„ç†å»¶è¿Ÿé«˜å³°ï¼Œå› ä¸ºVMä¸ä¼šä»æ•´ä½“ä¸Šåœæ­¢â€”â€”ä»…ç‰¹å®šè¿›ç¨‹åœæ­¢ï¼Œå¹¶ä¸”ç»ä¸ä¼šåŒæ—¶åœæ­¢æ‰€æœ‰è¿›ç¨‹ã€‚å®é™…ä¸Šï¼Œè¿™åªæ˜¯æµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”è¢«è§†ä¸ºå¦ä¸€ç§reductionã€‚åƒåœ¾æ”¶é›†å™¨æ”¶é›†è¿‡ç¨‹å°†è¿‡ç¨‹æš‚åœå¾ˆçŸ­çš„æ—¶é—´é—´éš”ï¼Œé€šå¸¸æ˜¯å¾®ç§’ã€‚ä»£ä»·æ˜¯ï¼Œå°†æœ‰è®¸å¤šå°çš„çˆ†å‘ï¼ˆburstsï¼‰ï¼Œä»…åœ¨è¿›ç¨‹éœ€è¦æ›´å¤šå†…å­˜æ—¶æ‰è§¦å‘ã€‚å•ä¸ªè¿›ç¨‹é€šå¸¸ä¸ä¼šåˆ†é…å¤§é‡å†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œé€šè¿‡åœ¨ç»ˆæ­¢æ—¶ç«‹å³é‡Šæ”¾æ‰€æœ‰åˆ†é…çš„å†…å­˜ï¼Œè¿›ä¸€æ­¥é™ä½äº†å½±å“ã€‚JVMçš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å…·å¤‡åˆ‡æ¢åƒåœ¾æ”¶é›†å™¨çš„èƒ½åŠ›ï¼Œå› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨å•†ç”¨GCï¼Œè¿˜å¯ä»¥åœ¨JVMä¸­å®ç°ä¸é—´æ–­çš„GCã€‚\nLukas Larssonåœ¨ä¸€ç¯‡å‡ºè‰²çš„åšå®¢æ–‡ç« ä¸­è®¨è®ºäº†åƒåœ¾æ”¶é›†å™¨çš„åŠŸèƒ½ã€‚æœ‰è®¸å¤šå¤æ‚çš„ç»†èŠ‚ï¼Œä½†å·²å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ä»¥æœ‰æ•ˆåœ°å¤„ç†ä¸å¯å˜æ•°æ®ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿›ç¨‹åœ¨å †æ ˆå’Œå †ä¹‹é—´åˆ†é…äº†æ•°æ®ã€‚æœ€å¥½çš„æ–¹æ³•æ˜¯åœ¨çŸ­æš‚çš„è¿‡ç¨‹ä¸­å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œã€‚\nè¿™ä¸ªä¸»é¢˜ä¸Šç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜æ˜¯BEAMä½¿ç”¨å¤šå°‘å†…å­˜ã€‚è™šæ‹Ÿæœºåœ¨åå°åˆ†é…äº†å¤§å—å†…å­˜ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰åˆ†é…å™¨æ¥æœ‰æ•ˆåœ°å­˜å‚¨æ•°æ®å¹¶æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚è¿™æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„æ•ˆæœï¼š 1ï¼‰åœ¨ä¸éœ€è¦ç©ºé—´ä¹‹åï¼Œå·²ç”¨å†…å­˜é€æ¸å‡å°‘ 2ï¼‰é‡æ–°åˆ†é…å¤§é‡æ•°æ®å¯èƒ½æ„å‘³ç€å°†å½“å‰å·¥ä½œå†…å­˜åŠ å€ã€‚\nå¦‚æœç¡®å®éœ€è¦ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´åˆ†é…å™¨ç­–ç•¥æ¥å‡è½»ç¬¬ä¸€ä¸ªå½±å“ã€‚å¦‚æœæ‚¨å¯ä»¥çœ‹åˆ°ä¸åŒç±»å‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåˆ™ç¬¬äºŒä¸ªæ˜“äºç›‘è§†å’Œè®¡åˆ’ã€‚ï¼ˆWombatOAMå°±æ˜¯è¿™æ ·ä¸€ç§æä¾›å¼€ç®±å³ç”¨çš„ç³»ç»ŸæŒ‡æ ‡çš„ç›‘è§†å·¥å…·ã€‚ï¼‰\nçƒ­ä»£ç åŠ è½½ çƒ­ä»£ç åŠ è½½å¯èƒ½æ˜¯BEAMå¼•ç”¨æœ€å¤šçš„ç‹¬ç‰¹åŠŸèƒ½ã€‚çƒ­ä»£ç åŠ è½½æ„å‘³ç€å¯ä»¥é€šè¿‡æ›´æ”¹ç³»ç»Ÿä¸­çš„å¯è¿è¡Œä»£ç æ¥æ›´æ–°åº”ç”¨ç¨‹åºé€»è¾‘ï¼ŒåŒæ—¶ä¿ç•™å†…éƒ¨æµç¨‹çŠ¶æ€ã€‚è¿™æ˜¯é€šè¿‡æ›¿æ¢å·²åŠ è½½çš„BEAMæ–‡ä»¶å¹¶æŒ‡ç¤ºVMæ›¿æ¢æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­çš„ä»£ç å¼•ç”¨æ¥å®ç°çš„ã€‚\nå¯¹äºç”µä¿¡åŸºç¡€æ¶æ„æ— éœ€åœæœºä»£ç å‡çº§è€Œè¨€ï¼Œè¿™æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„åŠŸèƒ½ï¼Œè¢«è£å‡çš„ç¡¬ä»¶å¯ç”¨äºå¤„ç†é«˜å³°ã€‚å¦‚ä»Šï¼Œåœ¨å®¹å™¨åŒ–æ—¶ä»£ï¼Œå…¶ä»–æŠ€æœ¯ä¹Ÿå¯ä»¥å®ç°äº§çº¿çš„æ›´æ–°ã€‚ä»æœªä½¿ç”¨è¿‡å®ƒçš„äººä¼šè®¤ä¸ºå®ƒæ˜¯ä¸é‡è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨å¼€å‘å·¥ä½œæµç¨‹ä¸­ä»ç„¶æœ‰ç”¨ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡æ›¿æ¢éƒ¨åˆ†ä»£ç æ¥åŠ å¿«è¿­ä»£é€Ÿåº¦ï¼Œè€Œä¸å¿…é‡æ–°å¯åŠ¨ç³»ç»Ÿæ¥å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚å³ä½¿è¯¥åº”ç”¨ç¨‹åºå¹¶éè®¾è®¡ä¸ºå¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå‡çº§ï¼Œä¹Ÿå¯ä»¥å‡å°‘é‡æ–°ç¼–è¯‘å’Œé‡æ–°éƒ¨ç½²æ‰€éœ€çš„æ—¶é—´ã€‚\nä½•æ—¶ä¸ä½¿ç”¨BEAM æ­£ç¡®çš„å·¥å…·éå¸¸é‡è¦ã€‚æ‚¨éœ€è¦ä¸€ä¸ªé€Ÿåº¦æå¿«çš„ç³»ç»Ÿï¼Œä½†ä¸å…³å¿ƒå¹¶å‘æ€§å—ï¼Ÿå¹¶è¡Œå¤„ç†ä¸€äº›äº‹ä»¶ï¼Œå¹¶ä¸”å¿…é¡»å¿«é€Ÿå¤„ç†å®ƒä»¬ï¼Ÿæ˜¯å¦éœ€è¦è®¡ç®—å›¾å½¢ï¼Œäººå·¥æ™ºèƒ½æˆ–åˆ†ææ•°æ®ï¼Ÿæ²¿C ++ï¼ŒPythonæˆ–Javaè·¯çº¿èµ°ã€‚ç”µä¿¡åŸºç¡€è®¾æ–½ä¸éœ€è¦å¿«é€Ÿè¿è¡Œï¼Œå› æ­¤é€Ÿåº¦ä»æ¥éƒ½ä¸æ˜¯ä¼˜å…ˆäº‹é¡¹ã€‚åœ¨åŠ¨æ€ç±»å‹çš„è¾…åŠ©ä¸‹ï¼Œå®ƒå¿…é¡»åœ¨è¿è¡Œæ—¶è¿›è¡Œæ‰€æœ‰ç±»å‹æ£€æŸ¥ï¼Œè¿™æ„å‘³ç€ç¼–è¯‘å™¨æ—¶é—´ä¼˜åŒ–å¹¶ä¸é‚£ä¹ˆç®€å•ã€‚å› æ­¤ï¼Œæ•°å­—è¿ç®—æœ€å¥½ç•™ç»™JVMï¼ŒGoæˆ–å…¶ä»–ç¼–è¯‘æˆæœ¬åœ°è¯­è¨€çš„è¯­è¨€ä½¿ç”¨ã€‚æ¯«ä¸å¥‡æ€ªï¼Œåœ¨JVMä¸Šè¿è¡Œçš„Erlangç‰ˆæœ¬Erjangä¸Šçš„æµ®ç‚¹è¿ç®—æ¯”BEAMå¿«5000ï¼…ã€‚ä½†æ˜¯æˆ‘ä»¬çœ‹åˆ°BEAMå¤§æ”¾å¼‚å½©çš„åœ°æ–¹æ˜¯åˆ©ç”¨å®ƒçš„å¹¶å‘æ¥å®‰æ’æ•°å­—è¿ç®—ï¼Œå°†åˆ†æå¤–åŒ…ç»™Cï¼ŒJuliaï¼ŒPythonæˆ–Rustã€‚æ‚¨å¯ä»¥åœ¨BEAMå¤–éƒ¨åšmapï¼Œè€Œåœ¨BEAMå†…éƒ¨åšreduce(è¯‘è€…æ³¨ï¼šmap-reduceæ€æƒ³)ã€‚\nå£å¤´ç¦…æ€»æ˜¯å¾ˆå¿«ã€‚äººç±»æ„ŸçŸ¥åˆºæ¿€ï¼ˆäº‹ä»¶ï¼‰å¹¶åœ¨å¤§è„‘ä¸­è¿›è¡Œå¤„ç†éœ€è¦å‡ ç™¾æ¯«ç§’ï¼Œè¿™æ„å‘³ç€å¯¹äºè®¸å¤šåº”ç”¨è€Œè¨€ï¼Œå¾®ç§’æˆ–çº³ç§’çš„å“åº”æ—¶é—´å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨ä¹Ÿä¸ä¼šå°†BEAMç”¨äºå¾®æ§åˆ¶å™¨ï¼Œè¿™å¤ªæµªè´¹èµ„æºäº†ã€‚ä½†æ˜¯å¯¹äºå…·æœ‰æ›´å¤šå¤„ç†èƒ½åŠ›çš„åµŒå…¥å¼ç³»ç»Ÿï¼ˆå¤šæ ¸å·²æˆä¸ºå¸¸æ€ï¼‰ï¼Œæ‚¨éœ€è¦å¹¶å‘æ€§ï¼Œè€ŒBEAMä»¤äººçœ¼å‰ä¸€äº®ã€‚ä¸Šä¸–çºª90å¹´ä»£ï¼Œæˆ‘ä»¬å®ç°äº†ç”µè¯äº¤æ¢æœºï¼Œä»¥å¤„ç†è¿è¡Œåœ¨å…·æœ‰16MBå†…å­˜çš„åµŒå…¥å¼æ¿ä¸Šçš„æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ã€‚RaspberryPiéƒ½æœ‰å¤šå°‘å†…å­˜äº†ï¼Ÿè¿˜æœ‰ï¼Œç¡¬å®æ—¶ç³»ç»Ÿï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›BEAMç®¡ç†æ‚¨çš„å®‰å…¨æ°”å›Šæ§åˆ¶ç³»ç»Ÿã€‚ä½ éœ€è¦ç¡¬ä¿è¯ ä»…ä»…æ˜¯ç¡¬å®æ—¶æ“ä½œç³»ç»Ÿï¼Œæ²¡æœ‰åƒåœ¾æ”¶é›†æˆ–å¼‚å¸¸çš„è¯­è¨€ã€‚åœ¨è¯¸å¦‚GRiSPä¹‹ç±»çš„è£¸æœºä¸Šè¿è¡Œçš„Erlang VMçš„å®ç°å°†ä¸ºæ‚¨æä¾›ç±»ä¼¼çš„ä¿è¯ã€‚\nç»“è®º ä½¿ç”¨æ­£ç¡®çš„å·¥å…·å®Œæˆå·¥ä½œã€‚å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªè½¯å®æ—¶ç³»ç»Ÿï¼Œè€Œè¯¥ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿç«‹å³æ‰©å±•å¹¶ä¸”æ°¸è¿œä¸ä¼šå¤±è´¥ï¼Œå¹¶ä¸”æ— éœ€é‡æ–°å‘æ˜è½®å­å°±å¯ä»¥åšåˆ°ï¼Œé‚£ä¹ˆBEAMæ˜¯æ‚¨æ­£åœ¨å¯»æ‰¾çš„ç»è¿‡éªŒè¯çš„æŠ€æœ¯ã€‚å¯¹äºè®¸å¤šäººæ¥è¯´ï¼Œå®ƒå°±åƒä¸€ä¸ªé»‘åŒ£å­ã€‚ä¸çŸ¥é“å®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºé©¾é©¶æ³•æ‹‰åˆ©ï¼Œæ— æ³•è·å¾—æœ€ä½³æ€§èƒ½æˆ–æ— æ³•ç†è§£å¥‡æ€ªå£°éŸ³æ¥è‡ªé©¬è¾¾çš„å“ªä¸ªéƒ¨åˆ†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨åº”è¯¥æ›´å¤šåœ°äº†è§£BEAMï¼Œäº†è§£å…¶å†…éƒ¨ç»“æ„å¹¶å‡†å¤‡å¯¹å…¶è¿›è¡Œå¾®è°ƒå’Œä¿®å¤çš„åŸå› ã€‚å¯¹äºåœ¨å®é™…ä»»åŠ¡ä¸­ä½¿ç”¨Erlangå’ŒElixirçš„äººï¼ˆè¯‘è€…æ³¨ï¼šin anger çš„æ„æ€æ˜¯to do or use something in a real situationï¼‰ï¼Œæˆ‘ä»¬å¼€è®¾äº†ä¸€å¤©çš„è®²å¸ˆæŒ‡å¯¼è¯¾ç¨‹ï¼Œè¯¥è¯¾ç¨‹é€šä¿—æ˜“æ‡‚å¹¶è§£é‡Šæ‚¨æ‰€çœ‹åˆ°çš„å¾ˆå¤šå†…å®¹ï¼ŒåŒæ—¶ä¸ºæ‚¨å‡†å¤‡å¤§è§„æ¨¡å¤„ç†å¤§è§„æ¨¡å¹¶å‘åšå¥½å‡†å¤‡ã€‚åœ¨è¿™é‡Œäº†è§£æ›´å¤šã€‚æˆ‘ä»¬ä¹Ÿæ¨èErik Stenmanæ’°å†™çš„å…³äºBEAMçš„ä¹¦å’ŒDmytro Lytovchenkoçš„æ–‡ç« é›†â€”â€”BEAM Wisdomsã€‚\n","id":127,"section":"posts","summary":"ä½œè€…æ˜¯ Francesco Cesarini \u0026amp; Gabor Olah ä»»ä½•ç¼–ç¨‹è¯­è¨€åœ¨Erlangç”Ÿæ€ç³»ç»Ÿä¸­çš„æˆåŠŸéƒ½å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªç´§å¯†è€¦åˆçš„ç»„ä»¶ã€‚å®ƒä»¬æ˜¯ï¼š 1ï¼‰Erlangç¼–ç¨‹è¯­è¨€çš„è¯­ä¹‰ï¼Œå¹¶åœ¨å…¶ä¸Šå®ç°","tags":["erlang"],"title":"[è¯‘]BEAM vs JVM","uri":"https://lvsq.net/2020/05/beam-vs-jvm/","year":"2020"},{"content":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º\u0026quot;abcx\u0026quot;ï¼Œé•¿åº¦4ï¼Œè¯¦ç»†æè¿°å¯è®¿é—®https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/\n(let* ( [s \u0026#34;abbabcx\u0026#34;] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) å®ç°çš„æ€è·¯ä¸ºï¼š\nç”±äºå­—ç¬¦å¯ä»¥æœ‰ASCIIç è¡¨ç¤ºï¼Œæ•…å¯ä»¥ç”¨ä¸€ä¸ªé•¿åº¦ä¸º128çš„å‘é‡vecæ¥ä¿å­˜æ¯ä¸ªå­—ç¬¦åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æœ€åä¸€æ¬¡çš„ä½ç½®ã€‚ç»´æŠ¤ä¸€ä¸ªå˜é‡dæ¥è®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦çš„èµ·å§‹ä½ç½®ã€‚ å¦‚æœï¼š\nåˆ¤æ–­æŸå­—ç¬¦æ˜¯å¦é‡å¤ï¼š 1.1 æŸå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œæ‰§è¡Œç¬¬2æ­¥ 1.2 æŸå­—ç¬¦éç¬¬ä¸€æ¬¡å‡ºç°ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ï¼Œåœ¨dä¹‹åï¼Œåˆ™å°†dè®¾ç½®ä¸ºè¯¥å­—ç¬¦ä¸Šæ¬¡å‡ºç°çš„ä½ç½®ã€‚ç”±äºä¹‹å‰çš„æœ€å¤§é•¿åº¦å·²ç»ç”±ansä¿å­˜ï¼Œæ‰€ä»¥åªéœ€è¦è®¡ç®—å‰©ä¸‹çš„å­ä¸²çš„é•¿åº¦èƒ½ä¸èƒ½å¤§äºansï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆdè®°å½•æœ€è¿‘ä¸€æ¬¡å‡ºç°é‡å¤çš„å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®å°±å¥½äº† è®¡ç®—å½“å‰ä½ç½®å’Œdçš„é•¿åº¦len ä¿å­˜å…¶ä½ç½®åˆ°vec å¦‚æœlenå¤§äºansï¼Œæ”¹å˜ansä¸ºlen è¿™ç§å®ç°åªéœ€éå†ä¸€éå°±å¯ä»¥è®¡ç®—å‡ºç»“æœï¼Œæ€§èƒ½éå¸¸æ£’ã€‚å½“ç„¶æš´åŠ›è®¡ç®—æˆ–è€…æ»‘åŠ¨çª—å£ä¹Ÿå¯ä»¥å®ç°è¯¥åŠŸèƒ½ï¼Œåªæ˜¯éœ€è¦å¤šæ¬¡éå†ï¼Œæ€§èƒ½æ¯”ä¸ä¸Šã€‚\næ¦‚è¦åˆ†æ ä¸Šæ–‡è¯´åˆ°æ€§èƒ½é—®é¢˜ï¼Œæ‹¿ç‚¹æ•°æ®å‡ºæ¥è¯æ˜ä¸€ä¸‹å§ã€‚\nå°†ä¸Šé¢çš„ä»£ç ç¨å¾®æ”¹é€ ä¸€ä¸‹ï¼Œä½œä¸ºä¸€ä¸ªdefinitionï¼Œå¹¶ä¿å­˜åœ¨longest_substr.ssæ–‡ä»¶ä¸­ï¼Œ\n(define longest-substr (lambda (str) (let* ( [s str] [arr-index 0] [ans 0] [d -1] [vec (make-vector 128 -1)] [keep-last-position (lambda (c pos-in-s) (vector-set! vec c pos-in-s))] [scan (lambda (c pos-in-s) (let* ([previous-pos (vector-ref vec c)] [len 0]) (begin (when (and (\u0026gt;= previous-pos 0) (\u0026gt; previous-pos d)) (set! d previous-pos) ) (set! len (- pos-in-s d)) (keep-last-position c pos-in-s) (when (\u0026gt; len ans) (set! ans len)) ) ) )] ) ( string-for-each (lambda (e) (scan (char-\u0026gt;integer e) arr-index) (set! arr-index (+ arr-index 1))) s ) ans ) ) ) Chez Schemeæä¾›äº†ä¸€ä¸ªæ¦‚è¦åˆ†æå·¥å…·ï¼Œéå¸¸å¥½ç”¨ï¼Œæ¥è¯•ç”¨ä¸€ä¸‹ï¼š ç”Ÿæˆçš„htmlå¯ä»¥éå¸¸ç›´è§‚çš„çœ‹åˆ°è¯¥å‡½æ•°çš„æ‰§è¡Œæƒ…å†µ å­—ç¬¦ä¸²è¶Šé•¿ï¼Œæ‰§è¡Œæ¬¡æ•°è¶Šå¤šï¼Œæ‰§è¡Œæ—¶é—´æ˜¯å¤šå°‘å‘¢ï¼Ÿé€‰ä¸€ä¸ªä¸Šé¢ä¾‹å­ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²æ¥çœ‹çœ‹ï¼š\n\u0026gt; (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) (time (longest-substr \u0026#34;abcabcxsfsdfw232sdfssdfsdfsdfsf1234567890\u0026#34;)) no collections 0.000003672s elapsed cpu time 0.000002000s elapsed real time 1792 bytes allocated 12 \u0026gt; æ¶ˆè€—çš„CPUæ—¶é—´0.000003672sï¼Œå¯ä»¥è¯´éå¸¸çŸ­äº†ï¼Œä¸”åˆ†é…çš„å†…å­˜ä»…ä»…1792ä¸ªå­—èŠ‚ã€‚è¶…ä¹å¯»å¸¸çš„æ€§èƒ½ï¼Œæˆ‘æƒ³åº”è¯¥æœ‰ä¸¤ä¸ªæ–¹é¢åŸå› ï¼š\nç®—æ³• Scheme å’Œ Chez Scheme ","id":128,"section":"posts","summary":"å®ç° ä¸‹é¢å°†ä½¿ç”¨Schemeè¯­è¨€æ¥å®ç°â€œæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²â€ï¼Œå³ï¼Œå¯¹äºå­—ç¬¦ä¸²\u0026quot;abbabcx\u0026quot;,å…¶æœ€é•¿æ— é‡å¤å­—ç¬¦çš„å­ä¸²ä¸º","tags":["scheme"],"title":"æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²-Schemeå®ç°","uri":"https://lvsq.net/2020/03/longest-substr/","year":"2020"},{"content":"\nä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿åå‡½æ•°å¼ç¼–ç¨‹è§„åˆ™ï¼Œå°±å¯ä»¥å¿«é€Ÿè°ƒè¯•åº”ç”¨ç¨‹åºã€‚å½“å‡½æ•°è¢«éš”ç¦»æ—¶ï¼Œæ‚¨ä¸å¿…å¤„ç†å½±å“è¾“å‡ºçš„éšè—çŠ¶æ€çš„æ›´æ”¹ã€‚\nè½¯ä»¶å·¥ç¨‹å¸ˆå…¼ä½œè€…Eric Elliotå®šä¹‰äº†ä»¥ä¸‹å‡½æ•°ç¼–ç¨‹ã€‚\nå‡½æ•°å¼ç¼–ç¨‹æ˜¯é€šè¿‡ç»„åˆçº¯å‡½æ•°ï¼Œé¿å…å…±äº«çŠ¶æ€ï¼Œå¯å˜æ•°æ®å’Œå‰¯ä½œç”¨æ¥æ„å»ºè½¯ä»¶çš„è¿‡ç¨‹ã€‚å‡½æ•°å¼ç¼–ç¨‹æ˜¯å£°æ˜æ€§çš„ï¼Œè€Œä¸æ˜¯å‘½ä»¤æ€§çš„ï¼Œåº”ç”¨ç¨‹åºçŠ¶æ€é€šè¿‡çº¯å‡½æ•°æµåŠ¨ã€‚ä¸é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ç›¸åï¼Œåè€…é€šå¸¸å°†åº”ç”¨ç¨‹åºçŠ¶æ€ä¸å¯¹è±¡ä¸­çš„æ–¹æ³•å…±äº«å¹¶æ”¾ç½®åœ¨å¯¹è±¡ä¸­ã€‚\næˆ‘å°†æ›´è¿›ä¸€æ­¥ï¼šå‡½æ•°å¼ç¼–ç¨‹ï¼ˆå¦‚é¢å‘å¯¹è±¡å’Œè¿‡ç¨‹å¼ç¼–ç¨‹ï¼‰ä»£è¡¨ç€èŒƒå¼çš„è½¬å˜ã€‚å®ƒåœ¨ç¼–å†™ä»£ç æ—¶é‡‡ç”¨äº†ç‹¬ç‰¹çš„æ€ç»´æ–¹å¼ï¼Œå¹¶å¼•å…¥äº†ä¸€å¥—å…¨æ–°çš„è§„åˆ™ã€‚\n4ä¸ªé‡è¦æ¦‚å¿µ è¦å®Œå…¨æŒæ¡å‡½æ•°å¼ç¼–ç¨‹ï¼Œå¿…é¡»é¦–å…ˆäº†è§£ä»¥ä¸‹ç›¸å…³æ¦‚å¿µã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å‰¯ä½œç”¨ å‡½æ•°æ„æˆ å…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ã€‚\nçº¯å‡½æ•°å’Œå¹‚ç­‰ å¦‚æœç»™çº¯å‡½æ•°æä¾›ç›¸åŒçš„è¾“å…¥ï¼Œåˆ™å®ƒæ€»æ˜¯ä¼šè¿”å›ç›¸åŒçš„è¾“å‡ºã€‚æ­¤å±æ€§ä¹Ÿç§°ä¸ºå¹‚ç­‰ã€‚å¹‚ç­‰æ„å‘³ç€å‡½æ•°åº”å§‹ç»ˆè¿”å›ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸è°ƒç”¨æ¬¡æ•°æ— å…³ã€‚\nå‰¯ä½œç”¨ çº¯å‡½æ•°ä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„å‡½æ•°æ— æ³•ä¸å¤–éƒ¨ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚\nä¾‹å¦‚ï¼Œå‡½æ•°å¼ç¼–ç¨‹å°†APIè°ƒç”¨è§†ä¸ºå‰¯ä½œç”¨ã€‚ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºAPIè°ƒç”¨è¢«è®¤ä¸ºæ˜¯ä¸å—æ‚¨ç›´æ¥æ§åˆ¶çš„å¤–éƒ¨ç¯å¢ƒã€‚ä¸€ä¸ªAPIå¯èƒ½æœ‰å‡ ä¸ªä¸ä¸€è‡´çš„åœ°æ–¹ï¼Œä¾‹å¦‚è¶…æ—¶æˆ–å¤±è´¥ï¼Œæˆ–è€…ç”šè‡³å¯èƒ½è¿”å›æ„å¤–çš„å€¼ã€‚å®ƒä¸é€‚åˆçº¯å‡½æ•°çš„å®šä¹‰ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨APIæ—¶éƒ½éœ€è¦ä¸€è‡´çš„ç»“æœã€‚\nå…¶ä»–å¸¸è§çš„å‰¯ä½œç”¨åŒ…æ‹¬ï¼š\næ•°æ®å˜åŒ– DOMæ“ä½œ è¯·æ±‚æœ‰å†²çªçš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰æ—¶é—´time.Now() å‡½æ•°æ„æˆ å‡½æ•°æ„æˆçš„åŸºæœ¬æ€æƒ³å¾ˆç®€å•ï¼šå°†ä¸¤ä¸ªçº¯å‡½æ•°ç»„åˆåœ¨ä¸€èµ·ä»¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚è¿™æ„å‘³ç€ä¸ºç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡ºçš„æ¦‚å¿µåœ¨è¿™é‡Œä»ç„¶é€‚ç”¨ã€‚å› æ­¤ï¼Œä»ç®€å•çš„çº¯å‡½æ•°å¼€å§‹åˆ›å»ºæ›´é«˜çº§çš„å‡½æ•°å¾ˆé‡è¦ã€‚\nå…±äº«çŠ¶æ€å’Œä¸å˜æ•°æ® å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯åˆ›å»ºä¸ä¿æŒçŠ¶æ€çš„å‡½æ•°ã€‚å…±äº«çŠ¶æ€å°¤å…¶ä¼šåœ¨çº¯å‡½æ•°ä¸­å¼•å…¥å‰¯ä½œç”¨æˆ–å¯å˜æ€§é—®é¢˜ï¼Œä½¿å®ƒä»¬å˜å¾—ä¸çº¯ç²¹ã€‚\nä½†æ˜¯ï¼Œå¹¶éæ‰€æœ‰çŠ¶æ€éƒ½ä¸å¥½ã€‚æœ‰æ—¶ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªçŠ¶æ€æ‰èƒ½è§£å†³ç‰¹å®šçš„è½¯ä»¶é—®é¢˜ã€‚å‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿çŠ¶æ€å¯è§å’Œæ˜¾å¼ï¼Œä»¥æ¶ˆé™¤ä»»ä½•å‰¯ä½œç”¨ã€‚ç¨‹åºä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ä»çº¯å‡½æ•°ä¸­æ´¾ç”Ÿæ–°æ•°æ®ã€‚è¿™æ ·ï¼Œå°±ä¸éœ€è¦å¯èƒ½å¼•èµ·å‰¯ä½œç”¨çš„å¯å˜æ•°æ®ã€‚\nç°åœ¨æˆ‘ä»¬å·²ç»æ¶µç›–äº†åŸºç¡€ï¼Œè®©æˆ‘ä»¬å®šä¹‰ä¸€äº›åœ¨Goä¸­ç¼–å†™åŠŸèƒ½ä»£ç æ—¶è¦éµå¾ªçš„è§„åˆ™ã€‚\nåŠŸèƒ½ç¼–ç¨‹è§„åˆ™ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§èŒƒä¾‹ã€‚å› æ­¤ï¼Œå¾ˆéš¾ä¸ºè¿™ç§ç¼–ç¨‹é£æ ¼å®šä¹‰ç¡®åˆ‡çš„è§„åˆ™ã€‚ä¹Ÿä¸ä¸€å®šæ€»æ˜¯éµå¾ªè¿™äº›è§„åˆ™ã€‚æœ‰æ—¶ï¼Œæ‚¨ç¡®å®éœ€è¦ä¾èµ–æ‹¥æœ‰çŠ¶æ€çš„åŠŸèƒ½ã€‚\nä½†æ˜¯ï¼Œä¸ºäº†å°½å¯èƒ½ä¸¥æ ¼åœ°éµå¾ªå‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ï¼Œæˆ‘å»ºè®®åšæŒä»¥ä¸‹å‡†åˆ™ã€‚\næ²¡æœ‰å¯å˜æ•°æ®ä»¥é¿å…å‰¯ä½œç”¨ æ— çŠ¶æ€ï¼ˆæˆ–è€…éšå¼çŠ¶æ€ï¼Œä¾‹å¦‚å¾ªç¯è®¡æ•°å™¨ï¼‰ ç»™å˜é‡èµ‹å€¼åè¯·å‹¿ä¿®æ”¹ é¿å…å‰¯ä½œç”¨ï¼Œä¾‹å¦‚APIè°ƒç”¨ æˆ‘ä»¬åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªå¥½çš„â€œå‰¯ä½œç”¨â€æ˜¯å¼ºå¤§çš„æ¨¡å—åŒ–ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸æ˜¯è‡ªä¸Šè€Œä¸‹åœ°è¿›è¡Œè½¯ä»¶å·¥ç¨‹ï¼Œè€Œæ˜¯é¼“åŠ±è‡ªä¸‹è€Œä¸Šçš„ç¼–ç¨‹é£æ ¼ã€‚é¦–å…ˆå®šä¹‰æ¨¡å—ï¼ŒæŠŠå°†æ¥å¯èƒ½ä½¿ç”¨çš„åŒç±»çº¯å‡½æ•°ç»„åˆèµ·æ¥ã€‚æ¥ä¸‹æ¥ï¼Œå¼€å§‹ç¼–å†™é‚£äº›å°çš„ï¼Œæ— çŠ¶æ€çš„ç‹¬ç«‹å‡½æ•°ï¼Œä»¥åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæ¨¡å—ã€‚\nå®è´¨ä¸Šæˆ‘ä»¬æ˜¯åœ¨åˆ›å»ºé»‘åŒ£å­ã€‚ç¨åï¼Œæˆ‘ä»¬å°†æŒ‰ç…§è‡ªä¸‹è€Œä¸Šçš„æ–¹å¼å°†å„ä¸ªå—æ†ç»‘åœ¨ä¸€èµ·ã€‚è¿™ä½¿æ‚¨å¯ä»¥å»ºç«‹å¼ºå¤§çš„æµ‹è¯•åŸºç¡€ï¼Œå°¤å…¶æ˜¯å¯ä»¥éªŒè¯çº¯å‡½æ•°æ­£ç¡®æ€§çš„å•å…ƒæµ‹è¯•ã€‚\nä¸€æ—¦æ‚¨å¯ä»¥ä¿¡ä»»æ‚¨çš„æ¨¡å—ï¼Œå°±å¯ä»¥å°†æ¨¡å—æ†ç»‘åœ¨ä¸€èµ·äº†ã€‚å¼€å‘è¿‡ç¨‹ä¸­çš„è¿™ä¸€æ­¥è¿˜æ¶‰åŠç¼–å†™é›†æˆæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä¸¤ä¸ªç»„ä»¶çš„æ­£ç¡®é›†æˆã€‚\n5ä¸ªç¤ºä¾‹ ä¸ºäº†æ›´å…¨é¢åœ°æè¿°Goå‡½æ•°ç¼–ç¨‹çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬æ¢ç´¢äº”ä¸ªåŸºæœ¬ç¤ºä¾‹ã€‚\næ›´æ–°å­—ç¬¦ä¸² è¿™æ˜¯çº¯å‡½æ•°çš„æœ€ç®€å•ç¤ºä¾‹ã€‚é€šå¸¸ï¼Œå½“æ‚¨è¦æ›´æ–°å­—ç¬¦ä¸²æ—¶ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\nnameï¼š= \u0026#34;first name\u0026#34; nameï¼š= name + \u0026#34;last name\u0026#34; ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„è§„åˆ™ï¼Œå› ä¸ºä¸èƒ½åœ¨å‡½æ•°å†…ä¿®æ”¹å˜é‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥é‡å†™ä»£ç æ®µï¼Œä»¥ä¾¿æ¯ä¸ªå€¼éƒ½å…·æœ‰è‡ªå·±çš„å˜é‡ã€‚\nä¸‹é¢çš„ä»£ç æ®µä¸­çš„ä»£ç æ›´å…·å¯è¯»æ€§ã€‚\nfirstname := \u0026#34;first\u0026#34; lastname := \u0026#34;last\u0026#34; fullname := firstname + \u0026#34; \u0026#34; + lastname åœ¨æŸ¥çœ‹éå‡½æ•°å¼ä»£ç æ®µæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»æµè§ˆç¨‹åºä»¥ç¡®å®šæœ€æ–°çŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰¾åˆ°nameå˜é‡çš„ç»“æœå€¼ã€‚è¿™éœ€è¦æ›´å¤šçš„ç²¾åŠ›å’Œæ—¶é—´æ¥äº†è§£è¯¥åŠŸèƒ½çš„ä½œç”¨ã€‚\né¿å…æ›´æ–°æ•°ç»„ å¦‚å‰æ‰€è¿°ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„ç›®çš„æ˜¯ä½¿ç”¨ä¸å˜æ•°æ®é€šè¿‡çº¯å‡½æ•°å¾—å‡ºæ–°çš„ä¸å˜æ•°æ®çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡éœ€è¦æ›´æ–°æ•°ç»„æ—¶åˆ›å»ºä¸€ä¸ªæ–°æ•°ç»„æ¥å®ç°\nåœ¨éå‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæ›´æ–°æ•°ç»„å¦‚ä¸‹ï¼š\nnames := [3]string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} // Add Lucas to the array names[2] = \u0026#34;Lucas\u0026#34; è®©æˆ‘ä»¬æ ¹æ®åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹è¿›è¡Œå°è¯•ã€‚\nnames := []string{\u0026#34;Tom\u0026#34;, \u0026#34;Ben\u0026#34;} allNames := append(names, \u0026#34;Lucas\u0026#34;) é¿å…æ›´æ–°map è¿™æ˜¯å‡½æ•°ç¼–ç¨‹çš„æç«¯ç¤ºä¾‹ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰å­—ç¬¦ä¸²ç±»å‹çš„é”®å’Œæ•´æ•°ç±»å‹çš„å€¼çš„mapã€‚è¯¥mapåŒ…å«æˆ‘ä»¬ä»ç„¶ç•™åœ¨å®¶ä¸­çš„æ°´æœæ•°é‡ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬åˆšè´­ä¹°äº†è‹¹æœï¼Œå¹¶å¸Œæœ›å°†å…¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} // Buy five apples fruits[\u0026#34;apples\u0026#34;] = 5 æˆ‘ä»¬å¯ä»¥åœ¨åŠŸèƒ½ç¼–ç¨‹èŒƒä¾‹ä¸‹å®Œæˆç›¸åŒçš„åŠŸèƒ½ã€‚\nfruits := map[string]int{\u0026#34;bananas\u0026#34;: 11} newFruits := map[string]int{\u0026#34;apples\u0026#34;: 5} allFruits := make(map[string]int, len(fruits) + len(newFruits)) for k, v := range fruits { allFruits[k] = v } for k, v := range newFruits { allFruits[k] = v } ç”±äºæˆ‘ä»¬ä¸æƒ³ä¿®æ”¹åŸå§‹mapï¼Œå› æ­¤ä»£ç ä¼šéå†ä¸¤ä¸ªmapï¼Œå¹¶å°†å€¼æ·»åŠ åˆ°æ–°mapã€‚è¿™æ ·ï¼Œæ•°æ®ä¿æŒä¸å˜ã€‚\næ­£å¦‚æ‚¨å¯èƒ½é€šè¿‡ä»£ç çš„é•¿åº¦å¯ä»¥çœ‹å‡ºçš„é‚£æ ·ï¼Œæ­¤ä»£ç æ®µçš„æ€§èƒ½æ¯”å¯¹mapè¿›è¡Œç®€å•çš„å¯å˜æ›´æ–°è¦å·®å¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬è¦éå†ä¸¤ä¸ªmapã€‚è¿™æ˜¯æ‚¨ä¸ºä»£ç æ€§èƒ½äº¤æ¢æ›´å¥½çš„ä»£ç è´¨é‡çš„æ—¶é—´ã€‚\né«˜é˜¶å‡½æ•°å’ŒæŸ¯é‡ŒåŒ– å¤§å¤šæ•°ç¨‹åºå‘˜åœ¨ä»–ä»¬çš„ä»£ç ä¸­é€šå¸¸ä¸ä¼šä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼Œä½†æ˜¯åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æŸ¯é‡ŒåŒ–å¾ˆæ–¹ä¾¿ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå°†ä¸¤ä¸ªæ•´æ•°ç›¸åŠ ã€‚å°½ç®¡è¿™å·²ç»æ˜¯ä¸€ä¸ªçº¯ç²¹çš„åŠŸèƒ½ï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¯¦ç»†è¯´æ˜è¯¥ç¤ºä¾‹ï¼Œä»¥å±•ç¤ºå¦‚ä½•é€šè¿‡curringåˆ›å»ºæ›´é«˜çº§çš„åŠŸèƒ½ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ã€‚æ¥ä¸‹æ¥ï¼Œè¯¥å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°ä½œä¸ºé—­åŒ…ã€‚å› ä¸ºè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥å®ƒå°†è®°ä½å¤–éƒ¨èŒƒå›´ï¼Œè¯¥èŒƒå›´åŒ…å«åˆå§‹è¾“å…¥å‚æ•°ã€‚\nfunc add ï¼ˆx intï¼‰func ï¼ˆy intï¼‰int { return funcï¼ˆy intï¼‰int { return x + y } } ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•curryingå¹¶åˆ›å»ºæ›´å¤šé«˜çº§çº¯å‡½æ•°ã€‚\nfunc main() { // Create more variations add10 := add(10) add20 := add(20) // Currying fmt.Println(add10(1)) // 11 fmt.Println(add20(1)) // 21 } è¿™ç§æ–¹æ³•åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¾ˆå¸¸è§ï¼Œå°½ç®¡æ‚¨é€šå¸¸ä¸ä¼šåœ¨èŒƒå¼ä¹‹å¤–çœ‹åˆ°å®ƒã€‚\né€’å½’ é€’å½’æ˜¯ä¸€ç§é€šå¸¸ç”¨äºè§„é¿å¾ªç¯ä½¿ç”¨çš„è½¯ä»¶æ¨¡å¼ã€‚å› ä¸ºå¾ªç¯å§‹ç»ˆä¿æŒå†…éƒ¨çŠ¶æ€ä»¥æ˜ç¡®å¾ªç¯åœ¨å“ªä¸€è½®ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ä¸‹ä½¿ç”¨å¾ªç¯ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç‰‡æ®µå°è¯•è®¡ç®—æ•°å­—çš„é˜¶ä¹˜ã€‚é˜¶ä¹˜æ˜¯ä¸€ä¸ªæ•´æ•°ä¸å…¶ä¸‹æ‰€æœ‰æ•´æ•°çš„ä¹˜ç§¯ã€‚å› æ­¤ï¼Œé˜¶ä¹˜4ç­‰äº24ï¼ˆ= 4 * 3 * 2 * 1ï¼‰ã€‚\né€šå¸¸ï¼Œæ‚¨å°†ä¸ºæ­¤ä½¿ç”¨å¾ªç¯ã€‚\nfunc factorial(fac int) int { result := 1 for ; fac \u0026gt; 0; fac-- { result *= fac } return result } ä¸ºäº†åœ¨å‡½æ•°å¼ç¼–ç¨‹èŒƒä¾‹ä¸­å®Œæˆæ­¤ä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é€’å½’ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å°†ä¸€éåˆä¸€éåœ°è°ƒç”¨ç›¸åŒçš„å‡½æ•°ï¼Œç›´åˆ°è¾¾åˆ°é˜¶ä¹˜çš„æœ€ä½æ•´æ•°ä¸ºæ­¢ã€‚\nfunc calculateFactorial(fac int) int { if fac == 0 { return 1 } return fac * calculateFactorial(fac - 1) } ç»“è®º è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬ä»å‡½æ•°å¼ç¼–ç¨‹ä¸­å­¦åˆ°çš„çŸ¥è¯†ï¼š\nå°½ç®¡Golangæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†å®ƒå¹¶éä¸ºæ­¤ç›®çš„è€Œè®¾è®¡çš„ï¼Œå¦‚ç¼ºå°‘Mapï¼ŒFilterå’ŒReduceå‡½æ•°ã€‚ å‡½æ•°å¼ç¼–ç¨‹æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå› ä¸ºå‡½æ•°æ˜¯çº¯ç²¹çš„ï¼Œå› æ­¤æ˜“äºç†è§£ çº¯å‡½æ•°æ›´æ˜“äºæµ‹è¯•ï¼Œå› ä¸ºæ²¡æœ‰å†…éƒ¨çŠ¶æ€ä¼šæ”¹å˜è¾“å‡º åŸæ–‡åœ¨æ­¤: https://blog.logrocket.com/functional-programming-in-go/\n","id":129,"section":"posts","summary":"ä¸ºä»€ä¹ˆè¦ç”¨Goç»ƒä¹ å‡½æ•°å¼ç¼–ç¨‹ï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œæ­£æ˜¯ç”±äºç¼ºå°‘çŠ¶æ€å’Œå¯å˜æ•°æ®ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä½¿æ‚¨çš„ä»£ç æ›´æ˜“è¯»ï¼Œæ›´æ˜“äºæµ‹è¯•ä¸”ä¸å¤ªå¤æ‚ã€‚å¦‚æœé‡åˆ°é”™è¯¯ï¼Œåªè¦ä¸è¿","tags":["functional"],"title":"ä½¿ç”¨Golangè¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹","uri":"https://lvsq.net/2020/03/fp-in-go/","year":"2020"},{"content":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚\né˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š\næ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ªç©ºé˜Ÿåˆ—\né€‰æ‹©å‡½æ•° (empty-queue? \u0026lt;queue\u0026gt; ) æ£€æŸ¥é˜Ÿåˆ—æ˜¯å¦ä¸ºç©º (front-queue \u0026lt;queue\u0026gt; ) è¿”å›æœ€æ—©è¿›å…¥é˜Ÿåˆ—çš„æ•°æ®ï¼Œå…¶ä¸ä¼šä¿®æ”¹é˜Ÿåˆ— (length-queue \u0026lt;queue\u0026gt; ) è¿”å›é˜Ÿåˆ—é•¿åº¦\næ”¹å˜å‡½æ•° (insert-queue! \u0026lt;queue\u0026gt; \u0026lt;item\u0026gt; ) å°†æ•°æ®æ’å…¥æœ«ç«¯ (delete-queue! \u0026lt;queue\u0026gt; ) åˆ é™¤åˆ—å¤´çš„æ•°æ®\næ‰“å°å‡½æ•° (print-queue \u0026lt;queue\u0026gt;)\n(module FIFO-QUEUE (make-queue empty-queue? front-queue insert-queue! delete-queue! length-queue print-queue) (define front-ptr (lambda (q) (caar q))) (define set-front-ptr! (lambda (q item) (set-car! (car q) item))) (define rear-ptr (lambda (q) (cdar q))) (define set-rear-ptr! (lambda (q item) (set-cdr! (car q) item))) (define make-queue (lambda () (cons (cons \u0026#39;() \u0026#39;()) 0))) (define empty-queue? (lambda (q) (null? (front-ptr q)))) (define front-queue (lambda (q) (if (empty-queue? q) (error \u0026#34;FRONT called with an empty queue\u0026#34; q) (car (front-ptr q))))) (define (insert-queue! q item) (let ((new-pair (cons item \u0026#39;()))) (if (empty-queue? q) (begin (set-front-ptr! q new-pair) (set-rear-ptr! q new-pair) (set-cdr! q (+ 1 (cdr q))) q) (begin (set-cdr! (rear-ptr q) new-pair) (set-rear-ptr! q new-pair) (set-cdr! q ( + 1 (cdr q))) q) ) ) ) (define delete-queue! (lambda (q) (if (empty-queue? q) (error \u0026#34;DELETE! called with an empty queue\u0026#34; q) (begin (set-front-ptr! q (cdr (front-ptr q))) (set-cdr! q (- (cdr q) 1)) q) ) ) ) (define length-queue (lambda (q) (cdr q))) (define print-queue (lambda (q) (if (empty-queue? q) \u0026#39;() (front-ptr q)) )) ) å‰4ä¸ªè¿‡ç¨‹æ˜¯ç”¨äºå†…éƒ¨çš„å¸®åŠ©å‡½æ•°ï¼Œé˜Ÿåˆ—ç»´æŠ¤ä¸¤ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªæŒ‡å‘åˆ—å¤´ï¼ˆfront-ptrï¼‰,ä¸€ä¸ªæŒ‡å‘åˆ—å°¾ï¼ˆrear-ptrï¼‰ï¼Œè¿™æ ·å¯ä»¥å¼¥è¡¥åŸç”Ÿçš„set-car!å’Œset-cdr!çš„ä¸è¶³ã€‚\n\u0026gt; (load \u0026#34;/path/to/FIFO-QUEUE.scm\u0026#34;) ;;åŠ è½½FIFO-QUEUEæ¨¡å— \u0026gt; (import FIFO-QUEUE) \u0026gt; (define q (make-queue)) \u0026gt; (insert-queue! q 1) ;; (((1) 1) . 1), æœ€åä¸€ä¸ªæ•°å­—1è¡¨ç¤ºé˜Ÿåˆ—é•¿åº¦, åœ¨é˜Ÿåˆ—æœ‰åˆ é™¤æˆ–è€…æ’å…¥æ—¶ï¼ŒåŠæ—¶ä¿®æ”¹è¯¥å€¼ï¼Œä¸ºäº†åœ¨å–é˜Ÿåˆ—é•¿åº¦æ—¶å‡å°å¼€é”€ï¼Œå¦åˆ™è¦éå†ä¸€æ¬¡æ‰è¡Œ \u0026gt; (insert-queue! q 2) ;; (((1 2) 2) . 2) \u0026gt; (insert-queue! q 3) ;; (((1 2 3) 3) . 3) \u0026gt; (insert-queue! q 4) ;; (((1 2 3 4) 4) . 4) \u0026gt; (delete-queue! q) ;; (((2 3 4) 4) . 3) \u0026gt; (delete-queue! q) ;; (((3 4) 4) . 2) \u0026gt; (front-queue q) ;; 3 \u0026gt; (length-queue q) ;; 2 ","id":130,"section":"posts","summary":"é—²æ¥æ— äº‹ï¼Œç”¨Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—ï¼Œæ•°æ®ä»æœ«ç«¯æ’å…¥ï¼Œä»å‰ç«¯åˆ é™¤æˆ–è€…æŸ¥è¯¢ã€‚ é˜Ÿåˆ—å¯ä»¥çœ‹æˆæ˜¯ç”±ä¸‹é¢ä¸€ç»„æ“ä½œå®šä¹‰çš„ç»“æ„ï¼š æ„é€ å‡½æ•° (make-queue) è¿”å›ä¸€ä¸ª","tags":["scheme"],"title":"Schemeå®ç°ä¸€ä¸ªFIFOé˜Ÿåˆ—","uri":"https://lvsq.net/2020/03/fifo-queue/","year":"2020"},{"content":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯èƒ½ä½¿ç”¨Schemeæ ‡å‡†æœºåˆ¶ã€‚\nHash Tables ç•¥è¿‡ã€‚åº”ä½¿ç”¨æ ‡å‡†hash table.\nExtend-Syntax Macros æœ¬èŠ‚ä»‹ç»äº†extend-syntaxï¼Œå®ƒæ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§ä½†æ˜“äºä½¿ç”¨çš„åŸºäºæ¨¡å¼åŒ¹é…çš„è¯­æ³•æ‰©å±•å·¥å…·ã€‚ ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•è½¬æ¢ä¸ä½¿ç”¨define-syntaxå’Œsyntax-caseç¼–å†™çš„è¯­æ³•è½¬æ¢ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºextend-syntaxäº§ç”Ÿçš„è½¬æ¢ä¸ä¼šè‡ªåŠ¨éµå¾ªè¯æ³•ä½œç”¨åŸŸã€‚\né€šå¸¸ä¸å¯èƒ½å°†ä½¿ç”¨syntax-caseç¼–å†™çš„è¯­æ³•æŠ½è±¡ä¸ä½¿ç”¨extend-syntaxç¼–å†™çš„è¯­æ³•æŠ½è±¡æ— ç¼åœ°æ··åˆåœ¨ä¸€èµ·ã€‚ é€šå¸¸å°½å¯èƒ½åªä½¿ç”¨å…¶ä¸­ä¸€ç§ã€‚ ä»…åœ¨è¿ç§»åˆ°syntax-caseæ—¶æä¾›äº†å¯¹syntax-caseæ‰©å±•å™¨ä¸­extend-syntaxçš„æ”¯æŒã€‚\n(extend-syntax (name key \u0026hellip;) (pat fender template) \u0026hellip;)\næ ‡è¯†ç¬¦name æ˜¯è¦å®šä¹‰çš„å¥æ³•æ‰©å±•åæˆ–è¯­æ³•å…³é”®å­—ã€‚ å½“ç³»ç»Ÿæ‰©å±•å™¨å¤„ç†carä¸ºname çš„ä»»ä½•listè¡¨è¾¾å¼æ—¶ï¼Œå°†åœ¨è¯¥è¡¨è¾¾å¼ä¸Šè°ƒç”¨extend-syntaxç”Ÿæˆçš„è¯­æ³•è½¬æ¢è¿‡ç¨‹ã€‚ å…¶ä½™çš„æ ‡è¯†ç¬¦key \u0026hellip; æ˜¯åœ¨æ‰©å±•è¿‡ç¨‹ä¸­è¦åœ¨è¾“å…¥è¡¨è¾¾å¼ä¸­è¯†åˆ«çš„å…¶ä»–å…³é”®å­—ï¼ˆä¾‹å¦‚condä¸­çš„elseæˆ–caseï¼‰ã€‚\nkeyåˆ—è¡¨ä¹‹åçš„æ¯ä¸ªå­å¥éƒ½åŒ…å«ä¸€ä¸ªæ¨¡å¼pat ï¼Œä¸€ä¸ªå¯é€‰çš„fender å’Œä¸€ä¸ªtemplate ã€‚ å¯é€‰çš„fender ç»å¸¸è¢«çœç•¥ã€‚pat æŒ‡å®šäº†è¯­æ³•ï¼Œç”¨äºåŒ¹é…å­å¥ã€‚æ¨¡å¼ä¸­ä¸æ˜¯å…³é”®å­—ï¼ˆæ¨¡å¼å˜é‡ï¼‰çš„æ ‡è¯†ç¬¦ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ã€‚fender å¦‚æœå­˜åœ¨ï¼Œåˆ™æ˜¯Schemeè¡¨è¾¾å¼ï¼Œå®ƒæŒ‡å®šè¾“å…¥è¡¨è¾¾å¼ï¼ˆé€šè¿‡æ¨¡å¼å˜é‡è®¿é—®ï¼‰ä¸Šçš„é™„åŠ çº¦æŸï¼Œå¿…é¡»é€‰æ‹©è¿™äº›çº¦æŸæ‰èƒ½é€‰æ‹©å­å¥ã€‚template é€šå¸¸æ ¹æ®æ¨¡å¼å˜é‡æ¥æŒ‡å®šè¾“å‡ºé‡‡ç”¨ä»€ä¹ˆå½¢å¼ã€‚\nåœ¨æ‰©å±•è¿‡ç¨‹ä¸­ï¼Œè½¬æ¢è¿‡ç¨‹extend-syntaxä¼šå°è¯•ä»¥ç»™å®šçš„å­å¥çš„é¡ºåºå°†è¾“å…¥è¡¨è¾¾å¼ä¸æ¯ä¸ªæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœè¾“å…¥è¡¨è¾¾å¼åŒ¹é…äº†æŸä¸ªæ¨¡å¼ï¼Œåˆ™å°†æ¨¡å¼å˜é‡ç»‘å®šåˆ°è¾“å…¥è¡¨è¾¾å¼çš„ç›¸åº”éƒ¨åˆ†ï¼Œå¹¶å¯¹å­å¥çš„fender ï¼ˆå¦‚æœæœ‰ï¼‰è¿›è¡Œæ±‚å€¼ã€‚å¦‚æœfender è¿”å›ä¸€ä¸ªçœŸå€¼ï¼Œåˆ™æ‰§è¡Œç»™å®šçš„æ‰©å±•ã€‚ å¦‚æœè¾“å…¥ä¸æ¨¡å¼ä¸åŒ¹é…ï¼Œæˆ–è€…fender è¿”å›é”™è¯¯å€¼ï¼Œåˆ™è½¬æ¢è¿‡ç¨‹å°†å°è¯•ä¸‹ä¸€ä¸ªå­å¥ã€‚å¦‚æœæ— æ³•é€‰æ‹©ä»»ä½•å­å¥ï¼Œåˆ™ä¼šå¼•å‘æ¡ä»¶ç±»å‹**ï¼†assertion**çš„å¼‚å¸¸ã€‚\nåœ¨æ¨¡å¼å†…ï¼Œçœç•¥å·ï¼ˆ\u0026hellip;ï¼‰å¯ç”¨äºæŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªå‡ºç°çš„å‰é¢çš„æ¨¡å¼ç‰‡æ®µæˆ–åŸå‹ã€‚ç±»ä¼¼åœ°ï¼Œå¯ä»¥åœ¨è¾“å‡ºä¸­ä½¿ç”¨çœç•¥å·æ¥æŒ‡å®šé›¶ä¸ªæˆ–å¤šä¸ªæ‰©å±•åŸå‹çš„ç»“æ„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰©å±•åŸå‹å¿…é¡»åŒ…å«è¾“å…¥æ¨¡å¼åŸå‹çš„ä¸€éƒ¨åˆ†ã€‚\nç¬¬ä¸€ä¸ªä¾‹å­ï¼Œå®šä¹‰äº†rec, ä½¿ç”¨å•ä¸ªå…³é”®å­—ï¼Œä¸€ä¸ªå­å¥ï¼Œä¸”æ²¡æœ‰fenderå’Œçœç•¥å·\n(extend-syntax (rec) [(rec id val) (let ([id #f]) (set! id val) id)]) ç¬¬äºŒä¸ªä¾‹å­ï¼Œå®šä¹‰äº†whenï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨çœç•¥å·\n(extend-syntax (when) [(when test exp1 exp2 ...) (if test (begin exp1 exp2 ...) #f)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºletçš„å®šä¹‰ã€‚ letçš„å®šä¹‰æ˜¾ç¤ºäº†å¤šä¸ªçœç•¥å·çš„ä½¿ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªç”¨äºæ ‡è¯†ç¬¦/å€¼åºå¯¹ï¼Œå¦ä¸€ä¸ªç”¨äºbodyä¸­çš„è¡¨è¾¾å¼ã€‚å®ƒè¿˜è¡¨æ˜åŸå‹ä¸å¿…æ˜¯å•ä¸ªæ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”åœ¨templateä¸­å¯ä»¥å°†åŸå‹çš„å„ä¸ªéƒ¨åˆ†å½¼æ­¤åˆ†å¼€ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) ((lambda (x ...) b1 b2 ...) e ...)]) ä¸‹ä¸€ä¸ªç¤ºä¾‹æ˜¾ç¤ºlet*ï¼Œå…¶è¯­æ³•ä¸letç›¸åŒï¼Œä½†æ˜¯æ ¹æ®letä»¥ä¸¤ä¸ªå­å¥ï¼ˆä¸€ä¸ªç”¨äºåŸºæœ¬æƒ…å†µï¼Œä¸€ä¸ªç”¨äºé€’å½’æ­¥éª¤ï¼‰é€’å½’å®šä¹‰ï¼Œå› ä¸ºå®ƒå¿…é¡»äº§ç”Ÿä¸€ä¸ªåµŒå¥—ç»“æ„ã€‚\n(extend-syntax (let*) [(let* () b1 b2 ...) (let () b1 b2 ...)] [(let* ([x e] more ...) b1 b2 ...) (let ([x e]) (let* (more ...) b1 b2 ...))]) å®šä¹‰å¼andéœ€è¦3ä¸ªå­å¥ã€‚ç¬¬ä¸€ä¸ªå­å¥å¯¹äºè¯†åˆ«**(and)æ˜¯å¿…è¦çš„ï¼Œåä¸¤ä¸ªä»¥é€’å½’æ–¹å¼å®šä¹‰æ‰€æœ‰å…¶ä»–and**å½¢å¼ã€‚\n(extend-syntax (and) [(and) #t] [(and x) x] [(and x y ...) (if x (and y ...) #f)]) condçš„å®šä¹‰éœ€è¦å››ä¸ªå­å¥ã€‚ ä¸let*ä¸€æ ·ï¼Œå¿…é¡»å¯¹condè¿›è¡Œé€’å½’æè¿°ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒä¼šäº§ç”ŸåµŒå¥—çš„ifè¡¨è¾¾å¼ï¼Œéƒ¨åˆ†åŸå› æ˜¯ä¸€ä¸ªçœç•¥å·åŸå‹ä¸è¶³ä»¥æè¿°æ‰€æœ‰å¯èƒ½çš„condå­å¥ã€‚ condçš„å®šä¹‰è¿˜è¦æ±‚é™¤condä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æŒ‡å®šelseä½œä¸ºå…³é”®å­—ã€‚ è¿™æ˜¯å®šä¹‰ï¼š\n(extend-syntax (cond else) [(cond) #f] [(cond (else e1 e2 ...)) (begin e1 e2 ...)] [(cond (test) more ...) (or test (cond more ...))] [(cond (test e1 e2 ...) more ...) (if test (begin e1 e2 ...) (cond more ...))]) ä¸ºäº†ä½¿letçš„è¯­æ³•ç»å¯¹æ­£ç¡®ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¿…é¡»è¦æ±‚è¾“å…¥ä¸­çš„ç»‘å®šæ ‡è¯†ç¬¦æ˜¯ç¬¦å·ã€‚ å¦‚æœæˆ‘ä»¬è¾“å…¥ç±»ä¼¼**ï¼ˆletï¼ˆ[3 x]ï¼‰xï¼‰çš„å†…å®¹ï¼Œåˆ™ä¸ä¼šä»let**ä¸­å¾—åˆ°é”™è¯¯ï¼Œå› ä¸ºå®ƒä¸ä¼šæ£€æŸ¥éªŒè¯æ ‡è¯†ç¬¦ä½ç½®ä¸­çš„å¯¹è±¡æ˜¯å¦ä¸ºç¬¦å·ã€‚ ç›¸åï¼Œlambdaå¯èƒ½ä¼šæŠ±æ€¨ï¼Œæˆ–è€…å¯èƒ½æ˜¯æ‰©å±•å®Œæˆå¾ˆä¹…ä¹‹åçš„æ±‚å€¼ç¨‹åºã€‚ è¿™æ˜¯fenders èµ·ä½œç”¨çš„åœ°æ–¹ã€‚\n(extend-syntax (let) [(let ([x e] ...) b1 b2 ...) (andmap symbol? \u0026#39;(x ...)) ((lambda (x ...) b1 b2 ...) e ...)]) \u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰ä¸Šçš„symbol?çš„andmapç¡®ä¿æ¯ä¸ªç»‘å®šæ ‡è¯†ç¬¦éƒ½æ˜¯ä¸€ä¸ªç¬¦å·ã€‚ fender ä»…ä»…æ˜¯Schemeè¡¨è¾¾å¼ã€‚ åœ¨è¯¥è¡¨è¾¾å¼ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ä¸å­å¥çš„template éƒ¨åˆ†ç›¸åŒçš„è§„åˆ™æ¥æ‰©å±•å¼•ç”¨çš„å¯¹è±¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†**\u0026rsquo;ï¼ˆx \u0026hellip;ï¼‰**æ‰©å±•åˆ°æ ‡è¯†ç¬¦/å€¼å¯¹ä¸­çš„æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚\nextend-syntaxé€šå¸¸å¯ä»¥å¤„ç†æ‚¨çš„ä¸€åˆ‡éœ€æ±‚ï¼Œä½†æ˜¯æŸäº›è¯­æ³•æ‰©å±•å®šä¹‰è¦æ±‚èƒ½å¤ŸåŒ…å«å¯¹ä»»æ„Schemeè¡¨è¾¾å¼æ±‚å€¼çš„ç»“æœã€‚ è¯¥åŠŸèƒ½ç”±withæä¾›ã€‚\n(with ((pat expr) \u0026hellip;) template)\nwithä»…åœ¨extend-syntaxå†…éƒ¨çš„template å†…æœ‰æ•ˆã€‚ withæ¨¡å¼ä¸extend-syntaxæ¨¡å¼ç›¸åŒï¼Œwithè¡¨è¾¾å¼ä¸extend-syntaxçš„fenders ç›¸åŒï¼Œwithæ¨¡æ¿ä¸extend-syntaxæ¨¡æ¿ç›¸åŒã€‚\nwithå¯ç”¨äºå¼•å…¥æ–°çš„æ¨¡å¼æ ‡è¯†ç¬¦ï¼Œè¯¥æ ‡è¯†ç¬¦ç»‘å®šåˆ°extend-syntaxæ¨¡æ¿ä¸­çš„ä»»æ„Schemeè¡¨è¾¾å¼æ‰€ç”Ÿæˆçš„è¡¨è¾¾å¼ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œwithå…è®¸ä»extend-syntaxçš„å£°æ˜å¼æ ·å¼è½¬ä¸ºfull Schemeçš„è¿‡ç¨‹å¼æ ·å¼ã€‚\nwithçš„ä¸€ç§å¸¸è§ç”¨æ³•æ˜¯åœ¨æ¨¡æ¿ä¸­å¼•å…¥ä¸´æ—¶æ ‡è¯†ç¬¦æˆ–ä¸´æ—¶æ ‡è¯†ç¬¦åˆ—è¡¨ã€‚ å¦‚æœåœ¨extend-syntaxæ¡†æ¶å†…æ‰§è¡Œï¼Œwithä¹Ÿå¯ç”¨äºæ‰§è¡Œå¯èƒ½ç¬¨æ‹™æˆ–æ•ˆç‡ä½ä¸‹çš„å¤æ‚è½¬æ¢ã€‚\nä¾‹å¦‚ï¼Œoréœ€è¦ä½¿ç”¨ä¸´æ—¶æ ‡è¯†ç¬¦ã€‚ æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å®šä¹‰orï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (let ([temp x]) (if temp temp (or y ...)))]) è¿™ä¼šä¸€ç›´æœ‰æ•ˆï¼Œç›´åˆ°å°†orè¡¨è¾¾å¼æ”¾ç½®åœ¨tempå‘ç”Ÿçš„èŒƒå›´å†…ä¸ºæ­¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¥‡æ€ªçš„äº‹æƒ…ï¼Œå› ä¸ºextend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸã€‚ ï¼ˆè¿™æ˜¯define-syntaxä¼˜äºextend-syntaxçš„åŸå› ä¹‹ä¸€ã€‚ï¼‰\n(let ([temp #t]) (or #f temp)) â‡’ #f å¦‚æœå°†æ ‡è¯†ç¬¦tempæ¢ä¸ªåå­—ï¼Œåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚å°±å¯ä»¥ç†è§£\u0026quot;extend-syntaxä¸å°Šé‡è¯æ³•ä½œç”¨åŸŸ\u0026quot;è¿™å¥è¯äº†ã€‚ å®é™…ä¸Šï¼Œä¸Šè¿°çš„(let \u0026hellip;)è¡¨è¾¾å¼ï¼Œå±•å¼€ä¹‹åå°±å˜æˆäº†ï¼š\n(let ([temp #t]) (let ([temp #f]) (if temp temp (or temp)) ) ) ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œä½¿ç”¨gensymå’Œwithæ¥åˆ›å»ºä¸´æ—¶æ ‡è¯†ç¬¦ï¼Œå¦‚ä¸‹ï¼š\n(extend-syntax (or) [(or) #f] [(or x) x] [(or x y ...) (with ([temp (gensym)]) (let ([temp x]) (if temp temp (or y ...))))]) è€Œä¸”ï¼Œwithå¯ä»¥ä»¥extend-syntaxæ— æ³•ç›´æ¥ä½¿ç”¨çš„æ–¹å¼æ¥ç»„åˆè¾“å…¥æ¨¡å¼çš„å…ƒç´ ï¼Œä¾‹å¦‚ä»¥ä¸‹folding-plusç¤ºä¾‹:\n(extend-syntax (folding-plus) [(folding-plus x y) (and (number? \u0026#39;x) (number? \u0026#39;y)) (with ([val (+ \u0026#39;x \u0026#39;y)]) val)] [(folding-plus x y) (+ x y)]) å¦‚æœxå’Œyå‡ä¸ºæ•°å­—å¸¸æ•°ï¼Œåˆ™folding-plusæŠ˜å ä¸ºï¼ˆ+ x yï¼‰çš„å€¼ã€‚ å¦åˆ™ï¼Œfolding-plusè½¬æ¢ä¸ºï¼ˆ+ x yï¼‰ä»¥ä¾›ä»¥åè¯„ä¼°ã€‚ fenderåœ¨æ‰©å±•æ—¶æ£€æŸ¥æ“ä½œæ•°æ˜¯å¦ä¸ºæ•°å­—ï¼Œå¹¶ä½¿ç”¨withè¿›è¡Œæ±‚å€¼ã€‚ ä¸fenderä¸€æ ·ï¼Œæ‰©å±•ä»…åœ¨å¸¦å¼•å·çš„è¡¨è¾¾å¼å†…æ‰§è¡Œï¼Œå› ä¸ºquoteå°†æ•°æ®ä¸Schemeè¡¨è¾¾å¼çš„å…¶ä½™éƒ¨åˆ†åŒºåˆ†å¼€ã€‚\nä¸‹é¢çš„ç¤ºä¾‹åˆ©ç”¨withå…è®¸æˆ‘ä»¬å°†æ¨¡å¼ç»‘å®šåˆ°è¡¨è¾¾å¼è¿™ä¸€äº‹å®ï¼Œå°†æ¨¡å¼å˜é‡åˆ—è¡¨ç»‘å®šåˆ°ä¸´æ—¶ç¬¦å·åˆ—è¡¨ã€‚ æ­¤ä¸´æ—¶åˆ—è¡¨å¸®åŠ©æˆ‘ä»¬å®ç°sigmaè¯­æ³•æ‰©å±•ã€‚ sigmaä¸lambdaç›¸ä¼¼ï¼Œé™¤äº†å®ƒåœ¨æ ‡è¯†ç¬¦åˆ—è¡¨ä¸­åˆ†é…æ ‡è¯†ç¬¦è€Œä¸æ˜¯åˆ›å»ºæ–°ç»‘å®šä¹‹å¤–ã€‚ å®ƒå¯ç”¨äºå¹¶è¡Œæ‰§è¡Œä¸€ç³»åˆ—åˆ†é…ã€‚\n(extend-syntax (sigma) [(sigma (x ...) e1 e2 ...) (with ([(t ...) (map (lambda (x) (gensym)) \u0026#39;(x ...))]) (lambda (t ...) (set! x t) ... e1 e2 ...))]) (let ([x \u0026#39;a] [y \u0026#39;b]) ((sigma (x y) (list x y)) y x)) â‡’ (b a) ç»“æ„ä½“ æœ¬èŠ‚ä»‹ç»ä¸€ç§æœºåˆ¶ï¼Œç±»ä¼¼äºç¬¬7.15èŠ‚çš„recordå®šä¹‰æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å…è®¸ä½¿ç”¨å›ºå®šçš„å‘½åå­—æ®µé›†åˆ›å»ºæ•°æ®ç»“æ„ã€‚ ä¸recordç±»å‹ä¸åŒï¼Œç»“æ„ä½“ç±»å‹ä¸æ˜¯å”¯ä¸€ç±»å‹ï¼Œè€Œæ˜¯å®ç°ä¸ºå‘é‡ã€‚ å…·ä½“è€Œè¨€ï¼Œå°†ç»“æ„ä½“å®ç°ä¸ºå‘é‡ï¼Œå…¶é•¿åº¦æ¯”å­—æ®µæ•°å¤§ä¸€å€ï¼Œå¹¶ä¸”å…¶ç¬¬ä¸€ä¸ªå…ƒç´ åŒ…å«è¯¥ç»“æ„ä½“çš„ç¬¦å·åç§°ã€‚\nå°†ç»“æ„ä½“è¡¨ç¤ºä¸ºå‘é‡å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šç®€åŒ–ç»“æ„ä½“çš„è¯»å–å’Œæ‰“å°ä»¥åŠç»“æ„ä½“å®šä¹‰å·¥å…·çš„æ‰©å±•ã€‚ä½†æ˜¯ï¼Œå®ƒç¡®å®æœ‰ä¸€äº›ç¼ºç‚¹ã€‚ ä¸€ä¸ªæ˜¯åœ¨ä¸é€‚å½“çš„æƒ…å†µä¸‹ï¼Œç»“æ„ä½“å¯èƒ½ä¼šè¢«é”™è¯¯åœ°è§†ä¸ºæ™®é€šå‘é‡ã€‚å½“åœ¨ç¨‹åºä¸­å¤„ç†ç»“æ„ä½“å’Œå‘é‡æ—¶ï¼Œåœ¨æ£€æŸ¥æ›´é€šç”¨çš„å‘é‡ç±»å‹ä¹‹å‰ï¼Œå¿…é¡»æ³¨æ„å…ˆå¯»æ‰¾æ›´å…·ä½“çš„ç»“æ„ä½“ç±»å‹ï¼Œä¾‹å¦‚åœ¨ä¸€ç³»åˆ—condå­å¥ä¸­ã€‚ä¸€ä¸ªç±»ä¼¼çš„ç¼ºç‚¹æ˜¯ï¼Œç»“æ„ä½“å®ä¾‹å®¹æ˜“è¢«æœ‰æ„æˆ–æ— æ„åœ°â€œä¼ªé€ â€ã€‚ ä¹Ÿä¸å¯èƒ½æ§åˆ¶å¦‚ä½•æ‰“å°å’Œè¯»å–ç»“æ„ä½“ã€‚\né€šè¿‡define-structureåˆ›å»ºç»“æ„ä½“ã€‚ æ¯ä¸ªç»“æ„ä½“å®šä¹‰å¼éƒ½å®šä¹‰ä¸€ä¸ªæ„é€ è¿‡ç¨‹ï¼Œä¸€ä¸ªç±»å‹è°“è¯ï¼Œæ¯ä¸ªå­—æ®µçš„è®¿é—®è¿‡ç¨‹ä»¥åŠæ¯ä¸ªå­—æ®µçš„åˆ†é…è¿‡ç¨‹ã€‚define-structureå…è®¸ç¨‹åºå‘˜æ§åˆ¶å“ªäº›å­—æ®µæ˜¯æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°ï¼Œä»¥åŠå“ªäº›å­—æ®µç”±æ„é€ å‡½æ•°è¿‡ç¨‹æ˜¾å¼åˆå§‹åŒ–ã€‚define-structureéå¸¸ç®€å•ï¼Œä½†å¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´è¶³å¤Ÿå¼ºå¤§ï¼Œå¦‚æœè¿˜ä¸è¶³ä»¥åº”ä»˜åº”ç”¨ç¨‹åºçš„éœ€æ±‚è¿˜å¯ä»¥å¾ˆå®¹æ˜“çš„æ‰©å±•ä»¥æ»¡è¶³ä¹‹ã€‚ æœ¬èŠ‚æœ«å°¾ç»™å‡ºçš„define-structureå®šä¹‰å¯ä»¥ä½œä¸ºæ›´å¤æ‚å˜ä½“çš„èµ·ç‚¹ã€‚\n(define-structure (name id1 \u0026hellip;) ((id2 expr) \u0026hellip;))\ndefine-structureå½¢å¼å¯ä»¥å‡ºç°åœ¨ä»»æ„ä½ç½®ã€‚\ndefine-structureå®šä¹‰ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„name ï¼Œå¹¶åˆ›å»ºä¸€ç»„ç”¨äºæ„é€ å’Œæ“ä½œè¯¥ç»“æ„å®ä¾‹çš„è¿‡ç¨‹ã€‚ æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; å‘½åæ•°æ®ç»“æ„çš„å­—æ®µã€‚\nä¸‹é¢çš„è¿‡ç¨‹éƒ½æœ‰define-structureå®šä¹‰ï¼š\nåä¸º**make-**name çš„æ„é€ è¿‡ç¨‹ åä¸ºname? çš„ç±»å‹è°“è¯ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸ºname-field çš„è®¿é—®è¿‡ç¨‹ å¯¹äºæ¯ä¸€ä¸ªå­—æ®µid1 \u0026hellip; å’Œid2 \u0026hellip; ï¼Œéƒ½æœ‰åä¸º**set-**name-field! çš„åˆ†é…è¿‡ç¨‹ æ ‡è¯†ç¬¦id1 \u0026hellip; å‘½åçš„å­—æ®µç”±æ„é€ å‡½æ•°çš„å‚æ•°åˆå§‹åŒ–ã€‚ ç”±æ ‡è¯†ç¬¦id2 \u0026hellip; å‘½åçš„å­—æ®µè¢«æ˜¾å¼åˆå§‹åŒ–ä¸ºè¡¨è¾¾å¼expr \u0026hellip; çš„å€¼ã€‚æ¯ä¸ªè¡¨è¾¾å¼éƒ½åœ¨æ ‡è¯†ç¬¦id1 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…è¿›è¡Œæ±‚å€¼ï¼Œå¹¶ä¸”åœ¨æ ‡è¯†ç¬¦id2 \u0026hellip; ï¼ˆç»‘å®šåˆ°ç›¸åº”çš„å­—æ®µå€¼ï¼‰çš„èŒƒå›´å†…å‡ºç°ï¼ˆç±»ä¼¼let*ï¼‰ ã€‚\nä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæ„é€ å‡½æ•°çš„è¡Œä¸ºå°±åƒå®šä¹‰ä¸ºï¼š\n(define make-name (lambda (id1 ...) (let* ([id2 expr ] ...) body ))) å…¶ä¸­body æ ¹æ®æ ‡è¯†ç¬¦id1 \u0026hellip; å’Œid2 \u0026hellip; çš„å€¼æ„å»ºç»“æ„ä½“ã€‚\nå¦‚æœä¸éœ€è¦é™¤æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–çš„å­—æ®µä»¥å¤–çš„å…¶ä»–å­—æ®µï¼Œåˆ™å¯ä»¥çœç•¥ç¬¬äºŒä¸ªå­è¡¨è¾¾å¼*( (id2 expr) \u0026hellip;)* ã€‚\nä»¥ä¸‹ç®€å•ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨Schemeä¸­å®šä¹‰pairï¼ˆå¦‚æœå®ƒä»¬ä¸å­˜åœ¨çš„è¯ï¼‰ã€‚ è¿™ä¸¤ä¸ªå­—æ®µéƒ½ç”±æ„é€ å‡½æ•°è¿‡ç¨‹çš„å‚æ•°åˆå§‹åŒ–ã€‚\n(define-structure (pare car cdr)) (define p (make-pare â€™a â€™b)) (pare? p) â‡’ #t (pair? p) â‡’ #f (pare? â€™(a . b)) â‡’ #f (pare-car p) â‡’ a (pare-cdr p) â‡’ b (set-pare-cdr! p (make-pare \u0026#39;b \u0026#39;c)) (pare-car (pare-cdr p)) â‡’ b (pare-cdr (pare-cdr p)) â‡’ c ä»¥ä¸‹ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªæ–¹ä¾¿çš„å­—ç¬¦ä¸²æ•°æ®ç»“æ„ï¼Œç§°ä¸ºstrext-string ï¼Œè¯¥ç»“æ„ä¼šæ ¹æ®éœ€è¦å¢é•¿ã€‚æœ¬ä¾‹å­ä¸­ï¼Œä¼šæ˜¾å¼åœ°åˆå§‹åŒ–ä¸€ä¸ªå­—æ®µçš„å€¼ï¼Œè¯¥å­—æ®µåœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ã€‚\n(define-structure (stretch-string length fill) ([string (make-string length fill)])) (define stretch-string-ref (lambda (s i) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-ref (stretch-string-string s) i)))) (define stretch-string-set! (lambda (s i c) (let ([n (stretch-string-length s)]) (when (\u0026gt;= i n) (stretch-stretch-string! s (+ i 1) n)) (string-set! (stretch-string-string s) i c)))) (define stretch-string-fill! (lambda (s c) (string-fill! (stretch-string-string s) c) (set-stretch-string-fill! s c))) (define stretch-stretch-string! (lambda (s i n) (set-stretch-string-length! s i) (let ([str (stretch-string-string s)] [fill (stretch-string-fill s)]) (let ([xtra (make-string (- i n) fill)]) (set-stretch-string-string! s (string-append str xtra)))))) é€šå¸¸ï¼Œå¤§å¤šæ•°è‡ªåŠ¨å®šä¹‰çš„è¿‡ç¨‹éƒ½ç”¨äºå®šä¹‰æ›´ç‰¹æ®Šçš„è¿‡ç¨‹ï¼Œ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¯´çš„å°±æ˜¯stretch-string-ref ** å’Œstretch-string-set!ã€‚è€Œstretch-string-length** å’Œ stretch-string-stringæ˜¯æƒŸä¸€ç›´æ¥ä½¿ç”¨çš„è‡ªåŠ¨ç”Ÿæˆçš„è¿‡ç¨‹ã€‚\n(define ss (make-stretch-string 2 #\\X)) (stretch-string-string ss) â‡’ \u0026#34;XX\u0026#34; (stretch-string-ref ss 3) â‡’ #\\X (stretch-string-length ss) â‡’ 4 (stretch-string-string ss) â‡’ \u0026#34;XXXX\u0026#34; (stretch-string-fill! ss #\\@) (stretch-string-string ss) â‡’ \u0026#34;@@@@\u0026#34; (stretch-string-ref ss 5) â‡’ #\\@ (stretch-string-string ss) â‡’ \u0026#34;@@@@@@\u0026#34; (stretch-string-set! ss 7 #\\=) (stretch-string-length ss) â‡’ 8 (stretch-string-string ss) â‡’ \u0026#34;@@@@@@@=\u0026#34; ã€ŠThe Scheme Programming Languageã€‹ï¼ˆç¬¬4ç‰ˆï¼‰çš„8.4èŠ‚å®šä¹‰äº†define-structureçš„ç®€åŒ–å˜ä½“ï¼Œä½œä¸ºä½¿ç”¨syntax-caseçš„ç¤ºä¾‹ã€‚ ä¸‹é¢ç»™å‡ºçš„å®šä¹‰å®ç°äº†å®Œæ•´ç‰ˆæœ¬ã€‚\n(define-syntax define-structure (lambda (x) (define gen-id (lambda (template-id . args) (datum-\u0026gt;syntax template-id (string-\u0026gt;symbol (apply string-append (map (lambda (x) (if (string? x) x (symbol-\u0026gt;string (syntax-\u0026gt;datum x)))) args)))))) (syntax-case x () ((_ (name field1 ...)) (andmap identifier? #\u0026#39;(name field1 ...)) #\u0026#39;(define-structure (name field1 ...) ())) ((_ (name field1 ...) ((field2 init) ...)) (andmap identifier? #\u0026#39;(name field1 ... field2 ...)) (with-syntax ((constructor (gen-id #\u0026#39;name \u0026#34;make-\u0026#34; #\u0026#39;name)) (predicate (gen-id #\u0026#39;name #\u0026#39;name \u0026#34;?\u0026#34;)) ((access ...) (map (lambda (x) (gen-id x #\u0026#39;name \u0026#34;-\u0026#34; x)) #\u0026#39;(field1 ... field2 ...))) ((assign ...) (map (lambda (x) (gen-id x \u0026#34;set-\u0026#34; #\u0026#39;name \u0026#34;-\u0026#34; x \u0026#34;!\u0026#34;)) #\u0026#39;(field1 ... field2 ...))) (structure-length (+ (length #\u0026#39;(field1 ... field2 ...)) 1)) ((index ...) (let f ([i 1] [ids #\u0026#39;(field1 ... field2 ...)]) (if (null? ids) \u0026#39;() (cons i (f (+ i 1) (cdr ids))))))) #\u0026#39;(begin (define constructor (lambda (field1 ...) (let* ([field2 init] ...) (vector \u0026#39;name field1 ... field2 ...)))) (define predicate (lambda (x) (and (vector? x) (#3%fx= (vector-length x) structure-length) (eq? (vector-ref x 0) \u0026#39;name)))) (define access (lambda (x) (vector-ref x index))) ... (define assign (lambda (x update) (vector-set! x index update))) ...)))))) ","id":131,"section":"posts","summary":"æœ¬ç« ä»‹ç»äº†å½“å‰ç‰ˆæœ¬çš„Chez Schemeä¸­åŒ…å«çš„å‡ ä¸ªé¡¹ç›®ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¸ç³»ç»Ÿçš„è¾ƒæ—©ç‰ˆæœ¬å…¼å®¹ã€‚ç”±äºå…¼å®¹åŠŸèƒ½å¯èƒ½åœ¨æœªæ¥ä¼šè¢«æ”¾å¼ƒï¼Œæ‰€ä»¥æ–°é¡¹ç›®ä¸­åº”å°½å¯","tags":["scheme"],"title":"å…¼å®¹æ€§ï¼ˆCompatibility Features in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/compatibility/","year":"2020"},{"content":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹ç³»ç»Ÿï¼ˆpthreadsï¼‰ä¹‹ä¸Šå®ç°ï¼Œå¹¶åœ¨åŸºäºWindowsçš„ç³»ç»Ÿä¸Šç›´æ¥ä½¿ç”¨Windows APIã€‚ æœ‰å…³çº¿ç¨‹åˆ›å»ºå’Œäº¤äº’çš„åŸºæœ¬è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥é˜…ç³»ç»Ÿä¸Šçš„ç›¸åº”æ–‡æ¡£ã€‚\nå¤§å¤šæ•°åŸç”Ÿçš„Schemeè¿‡ç¨‹éƒ½æ˜¯çº¿ç¨‹å®‰å…¨ çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä»å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶è°ƒç”¨å®ƒä»¬ã€‚ è¿™åŒ…æ‹¬è¯¸å¦‚conså’Œmake-stringä¹‹ç±»çš„åˆ†é…æ“ä½œï¼Œè¯¸å¦‚carå’Œvector-refä¹‹ç±»çš„è®¿é—®å™¨ï¼Œè¯¸å¦‚**+å’Œsqrtä¹‹ç±»çš„æ•°å­—è¿ç®—ç¬¦ä»¥åŠè¯¸å¦‚appendå’Œmap**ä¹‹ç±»çš„éç ´åæ€§çš„é«˜çº§åŸç”Ÿæ“ä½œã€‚\nç®€å•çš„å˜åŠ¨è¿ç®—ç¬¦ï¼ˆä¾‹å¦‚set-carï¼ï¼Œvector-setï¼å’Œrecordå­—æ®µå˜åŠ¨å™¨ï¼‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åŒæ ·ï¼Œå¯¹å±€éƒ¨å˜é‡çš„åˆ†é…ï¼ŒåŒ…æ‹¬ï¼ˆæœªå¯¼å‡ºçš„ï¼‰åº“å’Œé¡¶çº§ç¨‹åºå˜é‡çš„åˆ†é…ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nå¤§å¤šæ•°I/Oæ“ä½œåº”è¢«è§†ä¸ºå…·æœ‰ç ´åæ€§ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šä¿®æ”¹ç«¯å£çš„å†…éƒ¨ç»“æ„ã€‚\nä½¿ç”¨æ²¡æœ‰è¿›è¡Œåˆé€‚çš„åŒæ­¥ç­–ç•¥çš„éçº¿ç¨‹å®‰å…¨çš„è¿ç®—ç¬¦å¯èƒ½ä¼šç ´åå®ƒä»¬æ‰€æ“ä½œçš„å¯¹è±¡ã€‚ è¿™ç§æŸåå¯èƒ½å¯¼è‡´é”™è¯¯çš„è¡Œä¸ºï¼Œå†…å­˜æ•…éšœï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿä¸­æ­¢çš„ä¸å¯æ¢å¤çš„é”™è¯¯ã€‚\nçº¿ç¨‹åˆ›å»º (fork-thread thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—0ä¸ªå‚æ•°çš„è¿‡ç¨‹ã€‚\nfork-threadåœ¨ä¸€ä¸ªæ–°çº¿ç¨‹ä¸­è°ƒç”¨thunk ï¼Œå¹¶è¿”å›ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ã€‚\né™¤äº†æ‰“å°å®ƒå¤–ï¼Œfork-threadè¿”å›çš„çº¿ç¨‹å¯¹è±¡æ— æ³•æ‰§è¡Œä»»ä½•æ“ä½œã€‚\né™¤äº†ä½¿ç”¨fork-threadä»¥å¤–ï¼Œå¯é€šè¿‡å¤–éƒ¨ä»£ç æ¥åˆ›å»ºçš„çº¿ç¨‹å¿…é¡»åœ¨è§¦åŠä»»ä½•Schemeæ•°æ®æˆ–è°ƒç”¨ä»»ä½•Schemeè¿‡ç¨‹ä¹‹å‰è°ƒç”¨Sactivate_thread\n(thread? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡ï¼Œè¿”å›#t,å¦åˆ™è¿”å›#f\n(get-thread-id)\nè¿”å›ï¼šå½“å‰çº¿ç¨‹çš„id\nçº¿ç¨‹idæ˜¯ç”±çº¿ç¨‹åˆ†é…çš„çº¿ç¨‹å·ï¼Œå¹¶ä¸”ä¸get-process-idè¿”å›çš„è¿›ç¨‹idæ²¡æœ‰å…³ç³»ï¼Œè¿›ç¨‹idåœ¨æ‰€æœ‰çº¿ç¨‹ä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚\näº’æ–¥é” (make-mutex)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„äº’æ–¥é”å¯¹è±¡\n(mutex? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯äº’æ–¥é”ï¼Œè¿”å›#t\n(mutex-acquire mutex) | (mutex-acquire mutex block?)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-acquireè·å–ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚å¯é€‰çš„boolå‚æ•°blockï¼Ÿ é»˜è®¤ä¸º#tï¼ŒæŒ‡å®šçº¿ç¨‹æ˜¯å¦åº”é˜»å¡ç­‰å¾…äº’æ–¥é”ã€‚blockï¼Ÿ å¦‚æœçœç•¥æˆ–ä¸ºtrueï¼Œåˆ™çº¿ç¨‹å°†é˜»å¡ï¼Œç›´åˆ°è·å–äº†äº’æ–¥é”ä¸ºæ­¢ï¼Œå¹¶è¿”å›æœªæŒ‡å®šçš„å€¼ã€‚\nå¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”äº’æ–¥é”å½“å‰å·²å±äºå…¶ä»–çº¿ç¨‹ï¼Œå½“å‰çº¿ç¨‹å¹¶ä¸ä¼šé˜»å¡ï¼Œè€Œæ˜¯ï¼Œmutex-acquireç«‹å³è¿”å›å€¼**#f**ï¼Œä»¥æŒ‡ç¤ºäº’æ–¥é”ä¸å¯ç”¨ã€‚ å¦‚æœblockï¼Ÿ ä¸ºfalseå¹¶ä¸”æˆåŠŸè·å–äº†äº’æ–¥é”ï¼Œmutex-acquireè¿”å›#tã€‚\näº’æ–¥é”åœ¨Posixçº¿ç¨‹æœ¯è¯­ä¸­æ˜¯é€’å½’çš„ï¼Œè¿™æ„å‘³ç€è°ƒç”¨çº¿ç¨‹å¯ä»¥ä½¿ç”¨äº’æ–¥é”è·å–ï¼ˆé‡æ–°ï¼‰è·å–å®ƒå·²ç»æ‹¥æœ‰çš„äº’æ–¥é”ï¼ˆæ³¨ï¼šé”æ˜¯å¯ä»¥é‡å…¥çš„ï¼‰ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‡Šæ”¾äº’æ–¥é”éœ€è¦æ‰§è¡Œç›¸ç­‰æ•°é‡çš„mutex-releaseã€‚\n(mutex-release mutex)\nmutex å¿…é¡»æ˜¯ä¸€ä¸ªäº’æ–¥é”ã€‚\nmutex-releaseé‡Šæ”¾ç”±mutex æ ‡è¯†çš„äº’æ–¥é”ã€‚ å¦‚æœmutex ä¸å±äºè°ƒç”¨çº¿ç¨‹ï¼ˆå³é‡Šæ”¾åˆ«äººçš„äº’æ–¥é”ï¼‰ï¼Œåˆ™ä¼šå¯¼è‡´æ— æ³•é¢„æ–™çš„è¡Œä¸ºã€‚\n(with-mutex mutex body1 body2 \u0026hellip;)\nwith-mutexè®¡ç®—è¡¨è¾¾å¼mutex ï¼Œå…¶å¿…é¡»å¯ä»¥è®¡ç®—ä¸ºä¸€ä¸ªäº’æ–¥é”ï¼Œè·å–é”ï¼Œå¹¶è®¡ç®—body1 body2 \u0026hellip; ,ç„¶åé‡Šæ”¾é”ã€‚æ— è®ºbodyæ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯é€šè¿‡æ§åˆ¶æ“ä½œï¼ˆå³å¯èƒ½ç”±äºé”™è¯¯è€ŒæŠ›åˆ°continuationï¼‰é‡Šæ”¾äº’æ–¥é‡ï¼Œè¿™éƒ½ä¼šå¯¼è‡´with-mutexå½¢å¼çš„éæœ¬åœ°é€€å‡ºã€‚å¦‚æœæ§åˆ¶éšåé€šè¿‡continuationè°ƒç”¨è¿”å›åˆ°bodyï¼Œåˆ™å°†é‡æ–°è·å–äº’æ–¥é”ã€‚\nä¸ç›´æ¥ä½¿ç”¨mutex-acquireå’Œmutex-releaseç›¸æ¯”ï¼Œä½¿ç”¨with-mutexé€šå¸¸æ›´æ–¹ä¾¿ï¼Œæ›´å®‰å…¨ã€‚\næ¡ä»¶ (make-condition)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„æ¡ä»¶å¯¹è±¡\n(thread-condition? obj)\nè¿”å›ï¼šå¦‚æœobj æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œè¿”å›#t\n(condition-wait cond mutex) | (condition-wait cond mutex timeout)\nè¿”å›ï¼šå¦‚æœè°ƒç”¨çº¿ç¨‹è¢«æ¡ä»¶å”¤é†’è¿”å›#tï¼Œå¦‚æœè°ƒç”¨çº¿ç¨‹è¶…æ—¶ç­‰å¾…è¿”å›#f\ncond å¿…é¡»æ˜¯æ¡ä»¶å¯¹è±¡ï¼Œå¹¶ä¸”mutex å¿…é¡»æ˜¯äº’æ–¥é”ã€‚ å¯é€‰å‚æ•°timeout æ˜¯ç±»å‹ä¸ºtime-durationæˆ–time-utcæˆ–**#fçš„æ—¶é—´è®°å½•ï¼Œè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶ã€‚ é»˜è®¤ä¸º#f**ã€‚\ncondition-waitç­‰å¾…ç”±cond æ ‡è¯†çš„æ¡ä»¶ï¼Œä¸”ç­‰å¾…æŒ‡å®šçš„timeoutæ—¶é•¿ã€‚åœ¨è°ƒç”¨condition-waitæ—¶ï¼Œè°ƒç”¨çº¿ç¨‹å¿…é¡»å·²è·å–äº’æ–¥é”mutex ã€‚ç”±äºè°ƒç”¨condition-waitçš„å‰¯ä½œç”¨è€Œé‡Šæ”¾äº†mutex ã€‚å½“ç¨åé€šè¿‡ä¸‹è¿°çš„è¿‡ç¨‹ä¹‹ä¸€ä»æ¡ä»¶å˜é‡é‡Šæ”¾çº¿ç¨‹æˆ–è¶…æ—¶åˆ°æœŸæ—¶ï¼Œå°†é‡æ–°è·å–mutex ï¼Œå¹¶è¿”å›condition-waitã€‚\n(condition-signal cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-signalé‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹çš„å…¶ä¸­ä¸€ä¸ªã€‚\n(condition-broadcast cond)\ncond å¿…é¡»æ˜¯ä¸€ä¸ªæ¡ä»¶å¯¹è±¡ã€‚\ncondition-broadcasté‡Šæ”¾æ‰€æœ‰ç­‰å¾…cond æ ‡è¯†çš„æ¡ä»¶å¯¹è±¡çš„çº¿ç¨‹\né” é”æ¯”äº’æ–¥é”æ›´åŸç”Ÿï¼Œä½†æ˜¯æ›´åŠ çµæ´»å’Œæœ‰æ•ˆã€‚\nåªè¦é”åœ¨è¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­åˆ†é…ï¼Œå®ƒä»¬è¿˜å¯ä»¥ç‹¬ç«‹äºçº¿ç¨‹ç³»ç»Ÿä½¿ç”¨ï¼ˆåŒ…æ‹¬åœ¨Chez Schemeçš„éçº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼‰ä»¥åœ¨åˆ†ç¦»çš„Schemeè¿›ç¨‹ä¸­æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ é”åªæ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³iptræˆ–uptrå¤–éƒ¨ç±»å‹ï¼Œå…¶ä¸­åŒ…å«ç›®æ ‡è®¡ç®—æœºçš„æœ¬æœºå­—èŠ‚åºï¼Œå¯èƒ½æ˜¯ä½¿ç”¨define-ftypeå®šä¹‰çš„å¤§ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚å¿…é¡»åœ¨é©»ç•™äºSchemeå †å¤–éƒ¨çš„å†…å­˜ä¸­æ˜¾å¼åˆ†é…å®ƒï¼Œå¹¶åœ¨é€‚å½“æ—¶æ˜¾å¼é‡Šæ”¾ã€‚å½“ä»…æ¶‰åŠçº¿ç¨‹æ—¶ï¼ˆå³ï¼Œå½“ä¸æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼‰ï¼Œå¯ä»¥é€šè¿‡foreign-allocåˆ†é…å†…å­˜ã€‚ å½“æ¶‰åŠå¤šä¸ªè¿›ç¨‹æ—¶ï¼Œåº”åœ¨è¿›ç¨‹å…±äº«çš„æŸä¸ªåŒºåŸŸä¸­åˆ†é…è¯¥é”ã€‚\nä½¿ç”¨ftype-init-lock! åˆå§‹åŒ–åï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥å°è¯•é€šè¿‡**ftype-lock!æˆ–ftype-spin-lock!é”å®šlock ã€‚ä¸€æ—¦é”å·²è¢«é”å®šå¹¶ä¸”åœ¨è§£é”ä¹‹å‰ï¼Œå³ä½¿é€šè¿‡æœ€è¿‘é”å®šå®ƒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œå†ä¸€æ¬¡å°è¯•é”å®šè¯¥é”ä¹Ÿä¼šå¤±è´¥ã€‚ ä»»ä½•è¿›ç¨‹æˆ–çº¿ç¨‹å¯ä»¥ä½¿ç”¨ftype-unlock!**æ¥è§£é”lockï¼Œè€Œä¸ä»…ä»…æ˜¯é€šè¿‡æœ€è¿‘é”å®šé”çš„è¿›ç¨‹æˆ–çº¿ç¨‹æ¥è§£é”ã€‚\né”æœºåˆ¶æä¾›çš„ç»“æ„å¾ˆå°‘ï¼Œå¹¶ä¸”åˆ†é…å’Œä½¿ç”¨ä¸­çš„é”™è¯¯å¯èƒ½å¯¼è‡´å†…å­˜é”™è¯¯ï¼Œæ­»é”å’Œå…¶ä»–é—®é¢˜ã€‚ å› æ­¤ï¼Œé€šå¸¸å»ºè®®ä»…å°†é”ç”¨ä½œæ›´é«˜çº§åˆ«æŠ½è±¡çš„ä¸€éƒ¨åˆ†ï¼Œä»¥ç¡®ä¿æŒ‰è§„èŒƒæ–¹å¼ä½¿ç”¨é”ã€‚\n(define lock (make-ftype-pointer uptr (foreign-alloc (ftype-sizeof uptr)))) (ftype-init-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #t (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-spin-lock! uptr () lock) (ftype-lock! uptr () lock) â‡’ #f (ftype-unlock! uptr () lock) (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-init-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-spin-lock! ftype-name (a \u0026hellip;) fptr-expr index)\n(ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-unlock! ftype-name (a \u0026hellip;) fptr-expr index)\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\n**ftype-init-lock!**åº”è¯¥åœ¨ä½¿ç”¨ä»»ä½•å…¶ä»–è¿ç®—ç¬¦ä¹‹å‰ç”¨äºåˆå§‹åŒ–é”ï¼› å¦‚æœä¸è¿™æ ·åšï¼Œåˆ™å…¶ä»–æ“ä½œç¬¦çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ã€‚\nftype-lock! å¯ç”¨äºåŠ é”ã€‚å¦‚æœå‘ç°åœ¨æ“ä½œæ—¶é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›#tï¼›å¦‚æœå‘ç°è¯¥é”å·²åŠ é”ï¼Œåˆ™è¿”å›#fä¸”ä¸æ›´æ”¹è¯¥é”ã€‚\nftype-spin-lock! ä¹Ÿå¯ä»¥ç”¨æ¥åŠ é”ã€‚ å¦‚æœåœ¨æ“ä½œæ—¶å‘ç°è¯¥é”å·²è§£é”ï¼Œåˆ™å°†å…¶é”å®šå¹¶è¿”å›ï¼› å¦‚æœå‘ç°è¯¥é”å·²é”å®šï¼Œå®ƒå°†ä¸€ç›´ç­‰å¾…ç›´åˆ°é”è¢«è§£é”ï¼Œç„¶åå†é”å®šå¹¶è¿”å›ã€‚å¦‚æœæ²¡æœ‰å…¶ä»–è¿›ç¨‹æˆ–è€…çº¿ç¨‹æ¥é‡Šæ”¾è¯¥é”ï¼Œè¯¥æ“ä½œä¸ä¼šè¿”å›ä¸”ä¸èƒ½ä»¥æ­£å¸¸çš„æ–¹å¼ï¼ˆåŒ…æ‹¬GCï¼‰ä¸­æ–­ã€‚ä¹Ÿä¸ä¿è¯å…¬å¹³ï¼Œå› æ­¤å³ä½¿å…¶ä»–è¿›ç¨‹æ­£åœ¨ä¸»åŠ¨é”å®šå’Œé‡Šæ”¾è¯¥é”ï¼Œè¿›ç¨‹ä¹Ÿå¯èƒ½æ— é™æœŸæŒ‚èµ·ã€‚\nftype-unlock! ç”¨äºè§£é”ã€‚å¦‚æœå‘ç°é”å·²è¢«é”å®šï¼Œåˆ™å°†å…¶è§£é”å¹¶è¿”å›ã€‚ å¦åˆ™ï¼Œå®ƒå°†è¿”å›è€Œä¸æ›´æ”¹é”ã€‚\nåŸå­æ“ä½œLocked increment and decrement å½“éœ€è¦åŸå­é€’å¢æˆ–é€’å‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¤„æè¿°çš„é”å®šæ“ä½œã€‚\n(ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-incr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\n(ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr) | (ftype-locked-decr! ftype-name (a \u0026hellip;) fptr-expr index)\nè¿”å›ï¼šå¦‚æœæ›´æ–°çš„å€¼ä¸º0ï¼Œåˆ™ä¸º#tï¼Œå¦åˆ™ä¸º#f\nå®ƒä»¬æ¯ä¸ªçš„è¯­æ³•éƒ½ç±»ä¼¼äºftype-set!ï¼Œå°½ç®¡å¸¦æœ‰éšå¼çš„val-expr ã€‚ ç‰¹åˆ«æ˜¯ï¼Œå¯¹fptr-expr å’Œè®¿é—®å™¨a \u0026hellip; çš„é™åˆ¶å’Œå¤„ç†æ˜¯ç›¸ä¼¼çš„ï¼Œä½†æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šæœ€åä¸€ä¸ªè®¿é—®å™¨æ‰€æŒ‡å®šçš„å­—æ®µï¼ˆè¯¥æ ¼å¼åœ¨å…¶ä¸Šè¿›è¡Œæ“ä½œï¼‰å¿…é¡»æ˜¯ä¸€ä¸ªå­—é•¿çš„æ•´æ•°ï¼Œå³ ï¼Œiptrï¼Œuptræˆ–å…·æœ‰æœ¬åœ°å­—èŠ‚åºçš„ç­‰æ•ˆé¡¹ã€‚\nftype-locked-incr! è‡ªåŠ¨è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œå°†å€¼åŠ 1ï¼Œç„¶åå°†æ–°å€¼å†™å›è¯¥å­—æ®µã€‚ åŒæ ·ï¼Œftype-locked-decr! åŸå­è¯»å–æŒ‡å®šå­—æ®µçš„å€¼ï¼Œä»è¯¥å€¼ä¸­å‡å»1ï¼Œç„¶åå°†æ–°å€¼å†™å›åˆ°è¯¥å­—æ®µä¸­ã€‚ å¦‚æœæ–°å€¼ä¸º0ï¼Œåˆ™ä¸¤è€…éƒ½è¿”å›#tï¼Œå¦åˆ™è¿”å›#fã€‚\nå¼•ç”¨è®¡æ•° åœ¨Schemeå †ä¹‹å¤–ç®¡ç†å†…å­˜çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨Schemeå­˜å‚¨ç®¡ç†ç³»ç»Ÿé€šè¿‡ftype guardians æ‰§è¡Œå¼•ç”¨è®¡æ•°ã€‚ åœ¨å¼•ç”¨è®¡æ•°çš„å†…å­˜ç®¡ç†ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½ä¿å­˜ç€æŒ‡å‘å®ƒçš„æŒ‡é’ˆè®¡æ•°ã€‚ å½“åˆ›å»ºä¸€ä¸ªæ–°çš„æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å¢åŠ ï¼›è€Œåœ¨åˆ é™¤æŒ‡é’ˆæ—¶ï¼Œè¯¥è®¡æ•°å‡å°ã€‚ å½“è®¡æ•°è¾¾åˆ°é›¶æ—¶ï¼Œä¸å†éœ€è¦è¯¥å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶å ç”¨çš„å†…å­˜ç”¨äºå…¶ä»–ç›®çš„ã€‚\n(ftype-guardian ftype-name)\nftype-name å¿…é¡»å‘½åä¸€ä¸ªftypeã€‚ ftypeçš„ç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼ˆæˆ–åœ¨unionsçš„æƒ…å†µä¸‹ä¸ºç¬¬ä¸€ä¸ªåŸºæœ¬å­—æ®µï¼‰å¿…é¡»æ˜¯å…·æœ‰æœ¬åœ°å°¾æ•°çš„å­—é•¿æ•´æ•°ï¼ˆiptræˆ–uptrï¼‰ã€‚ å‡å®šæ­¤å­—æ®µä¿å­˜å¼•ç”¨è®¡æ•°ã€‚\nè¿”å›æ–°çš„ftype guardian g ï¼Œå¯ä»¥ä½¿ç”¨å…¶æ³¨å†Œftype-name ç±»å‹ï¼ˆæˆ–ftype-nam eçš„æŸäº›å­ç±»å‹ï¼‰çš„ftype-pointerã€‚ é€šè¿‡ä½¿ç”¨ftypeæŒ‡é’ˆä½œä¸ºå‚æ•°è°ƒç”¨g ï¼Œå¯ä»¥å‘g æ³¨å†ŒftypeæŒ‡é’ˆã€‚\nftype guardianä¸ä¼šåƒæ™®é€šçš„guardiané‚£æ ·è‡ªåŠ¨ä¿æŠ¤å…¶æ³¨å†Œçš„ftypeæŒ‡é’ˆå…é­å›æ”¶ã€‚è€Œæ˜¯ï¼Œå¯¹äºæ¯ä¸ªé€šè¿‡æ™®é€šï¼ˆéå¼±ï¼Œéç›‘æŠ¤äººæŒ‡é’ˆï¼‰å˜å¾—ä¸å¯è®¿é—®çš„å·²æ³¨å†Œçš„ftypeæŒ‡é’ˆï¼Œguardianä¼šå‡å°‘ftypeæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚å¦‚æœå¼•ç”¨è®¡æ•°å€¼ä¸º0ï¼Œåˆ™ftypeæŒ‡é’ˆå°†ä¿ç•™å¹¶å¯ä»¥ä»guardianä¸­æ£€ç´¢ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆçš„å¼•ç”¨è®¡æ•°å€¼éé›¶ï¼Œåˆ™ä¸ä¼šä¿ç•™ftypeæŒ‡é’ˆã€‚å‡è®¾å›æ”¶å™¨å¤–éƒ¨çš„ä»£ç æ­£ç¡®ç»´æŠ¤äº†å¼•ç”¨è®¡æ•°ï¼Œåˆ™ä»ftype guardianæ£€ç´¢çš„å¯¹è±¡ï¼ˆé€šè¿‡ä¸å¸¦å‚æ•°çš„è°ƒç”¨ï¼‰å°†ç¡®ä¿å…·æœ‰0å¼•ç”¨è®¡æ•°ã€‚å›æ”¶å™¨ä½¿ç”¨ç­‰æ•ˆçš„ftype-locked-decr!æ¥å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œä»¥æ”¯æŒç”±å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜ä¸­çš„éSchemeå¯¹è±¡ã€‚åœ¨è¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œç¨‹åºæœ¬èº«åº”ä½¿ç”¨ftype-locked-incr! å’Œftype-locked-decr! æˆ–éSchemeç­‰æ•ˆé¡¹ï¼ˆä¾‹å¦‚ï¼Œç¬¬4.8èŠ‚ä¸­æ‰€è¿°Cè¯­è¨€çš„scheme.hä¸­çš„ LOCKED_INCRå’ŒLOCKED_DECRå®ï¼‰æ¥ç»´æŠ¤å¼•ç”¨è®¡æ•°ã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä¸ºftypeå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ftypeå’Œä¸€ä¸ªåˆ†é…å™¨ï¼Œè¯¥å¯¹è±¡é‡Šæ”¾ä»¥å‰åˆ†é…çš„ä¸”ä¸å†å¯è®¿é—®çš„ftypeå¯¹è±¡ã€‚\nmodule (A make-A free-dropped-As) (define-ftype A (struct [refcount uptr] [data int])) (define g (ftype-guardian A)) (define free-dropped-As (lambda () (let ([a (g)]) (when a (printf \u0026#34;freeing ~s\\n\u0026#34; (ftype-ref A (data) a)) (foreign-free (ftype-pointer-address a)) (free-dropped-As))))) (define make-A (lambda (n) (free-dropped-As) (let ([a (make-ftype-pointer A (foreign-alloc (ftype-sizeof A)))]) (ftype-set! A (refcount) a 1) (ftype-set! A (data) a n) (g a) a)))) æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†é…ï¼Œä¸¢å¼ƒå¹¶ç«‹å³å›æ”¶æŒ‡å‘Açš„ftypeæŒ‡é’ˆè¿›è¡Œæµ‹è¯•ã€‚\n\u0026gt; (do ([i 10 (fx- i 1)]) ((fx= i 0)) (make-A i) (collect)) freeing 10 freeing 9 freeing 8 freeing 7 freeing 6 freeing 5 freeing 4 freeing 3 freeing 2 \u0026gt; (free-dropped-As) freeing 1 ç”±ftype guardianä¿æŠ¤çš„å¯¹è±¡å¯èƒ½åŒ…å«æŒ‡å‘å…¶ä»–å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¿™äº›å…¶ä»–å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¹Ÿåº”åœ¨åˆ†é…åŒ…å«å¯¹è±¡æ—¶å¢åŠ ï¼Œå¹¶åœ¨é‡Šæ”¾åŒ…å«å¯¹è±¡æ—¶å‡å°‘ã€‚\nçº¿ç¨‹å‚æ•° (make-thread-parameter object) | (make-thread-parameter object procedure)\nåˆ›å»ºçº¿ç¨‹å‚æ•°åï¼Œå°†åœ¨æ¯ä¸ªå½“å‰çº¿ç¨‹å’Œå°†æ¥çš„çº¿ç¨‹ä¸­æ”¾ç½®ä¸€ä¸ªå•ç‹¬çš„ä½ç½®ï¼Œä»¥ä¿å­˜å‚æ•°çš„å†…éƒ¨çŠ¶æ€å˜é‡çš„å€¼ã€‚ ï¼ˆå½“è¯¥å‚æ•°å˜å¾—ä¸å¯è®¿é—®æ—¶ï¼Œå­˜å‚¨ç®¡ç†å™¨å¯ä»¥æ¶ˆé™¤è¯¥ä½ç½®ã€‚ï¼‰ä¸€ä¸ªçº¿ç¨‹ä¸­å¯¹çº¿ç¨‹å‚æ•°çš„æ›´æ”¹ä¸ä¼šè¢«å…¶ä»–ä»»ä½•çº¿ç¨‹çœ‹åˆ°ã€‚\nåˆ›å»ºæ–°çº¿ç¨‹æ—¶ï¼ˆè¯·å‚é˜…fork-threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»æ´¾ç”Ÿçº¿ç¨‹ç»§æ‰¿ã€‚ ç±»ä¼¼åœ°ï¼Œå½“ç¬¬ä¸€æ¬¡æ¿€æ´»é€šè¿‡å…¶ä»–æ–¹å¼åˆ›å»ºçš„çº¿ç¨‹æ—¶ï¼ˆè¯·å‚è§4.8èŠ‚ä¸­çš„Sactivate_threadï¼‰ï¼Œæ¯ä¸ªçº¿ç¨‹å‚æ•°çš„å½“å‰å€¼ï¼ˆè€Œéä½ç½®ï¼‰éƒ½ç”±æ–°çº¿ç¨‹ä»ä¸»ï¼ˆåŸå§‹ï¼‰çº¿ç¨‹ç»§æ‰¿ã€‚\nå¤§å¤šæ•°å†…ç½®å‚æ•°æ˜¯çº¿ç¨‹å‚æ•°ï¼Œä½†æœ‰äº›æ˜¯å…¨å±€çš„ã€‚ åœ¨ä»–ä»¬å®šä¹‰çš„åœ°æ–¹å·²ç»æ ‡æ³¨äº†æ˜¯çº¿ç¨‹çš„è¿˜æ˜¯å…¨å±€çš„ã€‚ åœ¨éçº¿ç¨‹ç‰ˆæœ¬çš„Chez Schemeä¸­ï¼Œå†…ç½®å…¨å±€å‚æ•°å’Œçº¿ç¨‹å‚æ•°ä¹‹é—´æ²¡æœ‰åŒºåˆ«ã€‚\nI/O ç¼“å†²åŒº Chez Schemeä¸ºæé«˜æ•ˆç‡è€Œç¼“å†²æ–‡ä»¶I/Oæ“ä½œï¼Œä½†æ˜¯ç¼“å†²çš„I/Oä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç¼“å†²ç«¯å£å¯èƒ½ä¼šç ´åè¯¥ç«¯å£ï¼Œä»è€Œå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶æœ€ç»ˆå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ã€‚\nå½“ä»¥ç¼“å†²æ¨¡å¼noneæ‰“å¼€æ—¶ï¼Œå¯ä»¥ç¦ç”¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ä¸Šçš„ç¼“å†²ã€‚ ä½†æ˜¯ï¼Œç”±äºéœ€è¦æ”¯æŒå…ˆè¡Œï¼ˆlookaheadï¼‰ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨è¾“å…¥ç«¯å£ä¸Šçš„ç¼“å†²ï¼Œå¹¶ä¸”ç”±äºè¦åœ¨å­—ç¬¦å’Œå­—èŠ‚ä¹‹é—´è¿›è¡Œè½¬æ¢çš„ä»£ç è½¬æ¢å™¨æœ‰æ—¶éœ€è¦å…ˆè¡Œè¾“å…¥ï¼Œå› æ­¤æ— æ³•å®Œå…¨ç¦ç”¨æ–‡æœ¬ç«¯å£ï¼ˆç”šè‡³æ˜¯æ–‡æœ¬è¾“å‡ºç«¯å£ï¼‰ä¸Šçš„ç¼“å†²ã€‚\nå› æ­¤ï¼Œé™¤éåœ¨äºŒè¿›åˆ¶è¾“å‡ºç«¯å£å¼€å¯ç¼“å†²æ¨¡å¼ä¸ºnoneçš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦åˆ™ä¸¤ä¸ªçº¿ç¨‹ç»ä¸åº”è¯¥å¹¶å‘åœ°è¯»å†™åŒä¸€ä¸ªç«¯å£ã€‚æ›¿ä»£æ–¹æ³•åŒ…æ‹¬æŒ‡å®šä¸€ä¸ªçº¿ç¨‹ä¸ºç»™å®šç«¯å£æ‰§è¡Œæ‰€æœ‰I / Oï¼Œå’Œä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›é€šç”¨ç«¯å£åŒ…è£…ç¨‹åºï¼Œä»…åœ¨è·å–äº’æ–¥é‡åæ‰å°†è¯·æ±‚è½¬å‘åˆ°ç«¯å£ã€‚\nåˆå§‹çš„æ§åˆ¶å°ä»¥åŠå½“å‰çš„è¾“å…¥å’Œè¾“å‡ºç«¯å£ä»¥åŠtranscriptç«¯å£éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¤šä¸ªçº¿ç¨‹å‘æ§åˆ¶å°æ‰“å°é”™è¯¯å’Œ/æˆ–è°ƒè¯•æ¶ˆæ¯æ˜¯å®‰å…¨çš„ã€‚å³ä½¿åœ¨åŒä¸€è¡Œå†…ï¼Œè¾“å‡ºä¹Ÿå¯èƒ½æ˜¯äº¤é”™çš„ï¼Œä½†æ˜¯ç«¯å£ä¸ä¼šæŸåã€‚ è¿™äº›ç«¯å£çš„çº¿ç¨‹å®‰å…¨æ€§æ˜¯é€šè¿‡ä¸ºæ¯ä¸ªI/Oæ“ä½œè·å–ä¸€ä¸ªäº’æ–¥é”çš„é«˜æˆæœ¬æ¥å®ç°çš„ã€‚\nå®ä¾‹ï¼šæœ‰ç•Œé˜Ÿåˆ— ä»¥ä¸‹ä»£ç æ‘˜è‡ªæ–‡ç« â€œA Scheme for native threads1â€ï¼Œå®ƒä½¿ç”¨è®¸å¤šçº¿ç¨‹ç³»ç»ŸåŠŸèƒ½å®ç°äº†æœ‰ç•Œé˜Ÿåˆ—ã€‚ æœ‰ç•Œé˜Ÿåˆ—å…·æœ‰å›ºå®šæ•°é‡çš„å¯ç”¨æ’æ§½ã€‚ å½“é˜Ÿåˆ—å·²æ»¡æ—¶å°è¯•å…¥é˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚ å°è¯•ä»ç©ºé˜Ÿåˆ—ä¸­å‡ºé˜Ÿä¼šå¯¼è‡´è°ƒç”¨çº¿ç¨‹é˜»å¡ã€‚\n(define-record-type bq (fields (immutable data) (mutable head) (mutable tail) (immutable mutex) (immutable ready) (immutable room)) (protocol (lambda (new) (lambda (bound) (new (make-vector bound) 0 0 (make-mutex) (make-condition) (make-condition)))))) (define dequeue! (lambda (q) (with-mutex (bq-mutex q) (let loop () (let ([head (bq-head q)]) (cond [(= head (bq-tail q)) (condition-wait (bq-ready q) (bq-mutex q)) (loop)] [else (bq-head-set! q (incr q head)) (condition-signal (bq-room q)) (vector-ref (bq-data q) head)])))))) (define enqueue! (lambda (item q) (with-mutex (bq-mutex q) (let loop () (let* ([tail (bq-tail q)] [tail^ (incr q tail)]) (cond [(= tail^ (bq-head q)) (condition-wait (bq-room q) (bq-mutex q)) (loop)] [else (vector-set! (bq-data q) tail item) (bq-tail-set! q tail^) (condition-signal (bq-ready q))])))))) (define incr (lambda (q i) (modulo (+ i 1) (vector-length (bq-data q))))) ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†æœ‰ç•Œé˜Ÿåˆ—åœ¨ä¸€ç»„çº¿ç¨‹ä¸­çš„åº”ç”¨ï¼Œè¿™äº›çº¿ç¨‹åˆ†åˆ«æ‰®æ¼”æ•°æ®çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ã€‚\n(define job-queue) (define die? #f) (define make-job (let ([count 0]) (define fib (lambda (n) (if (\u0026lt; n 2) n (+ (fib (- n 2)) (fib (- n 1)))))) (lambda (n) (set! count (+ count 1)) (printf \u0026#34;Adding job #~s = (lambda () (fib ~s))\\n\u0026#34; count n) (cons count (lambda () (fib n)))))) (define make-producer (lambda (n) (rec producer (lambda () (printf \u0026#34;producer ~s posting a job\\n\u0026#34; n) (enqueue! (make-job (+ 20 (random 10))) job-queue) (if die? (printf \u0026#34;producer ~s dying\\n\u0026#34; n) (producer)))))) (define make-consumer (lambda (n) (rec consumer (lambda () (printf \u0026#34;consumer ~s looking for a job~%\u0026#34; n) (let ([job (dequeue! job-queue)]) (if die? (printf \u0026#34;consumer ~s dying\\n\u0026#34; n) (begin (printf \u0026#34;consumer ~s executing job #~s~%\u0026#34; n (car job)) (printf \u0026#34;consumer ~s computed: ~s~%\u0026#34; n ((cdr job))) (consumer)))))))) (define (bq-test np nc) (set! job-queue (make-bq (max nc np))) (do ([np np (- np 1)]) ((\u0026lt;= np 0)) (fork-thread (make-producer np))) (do ([nc nc (- nc 1)]) ((\u0026lt;= nc 0)) (fork-thread (make-consumer nc)))) è¿™æ˜¯ç¤ºä¾‹ç¨‹åºè¿è¡Œåçš„å¯èƒ½çš„å‰å‡ è¡Œè¾“å‡ºï¼š\n\u0026gt; (begin (bq-test 3 4) (system \u0026#34;sleep 3\u0026#34;) (set! die? #t)) producer 3 posting a job Adding job #1 = (lambda () (fib 29)) producer 3 posting a job Adding job #2 = (lambda () (fib 26)) producer 3 posting a job Adding job #3 = (lambda () (fib 22)) producer 3 posting a job Adding job #4 = (lambda () (fib 21)) producer 2 posting a job Adding job #5 = (lambda () (fib 29)) producer 1 posting a job Adding job #6 = (lambda () (fib 29)) consumer 4 looking for a job producer 3 posting a job Adding job #7 = (lambda () (fib 24)) consumer 4 executing job #1 consumer 3 looking for a job producer 2 posting a job Adding job #8 = (lambda () (fib 26)) consumer 3 executing job #2 consumer 3 computed: 121393 consumer 3 looking for a job producer 1 posting a job Adding job #9 = (lambda () (fib 26)) ... åœ¨â€œA Scheme for native threads1â€ä¸­ç»™å‡ºäº†å…¶ä»–ç¤ºä¾‹ï¼ŒåŒ…æ‹¬å¯æ‚¬æŒ‚çº¿ç¨‹çš„å®šä¹‰å’Œåœ¨æ— æ³•è®¿é—®æ—¶è‡ªåŠ¨ç»ˆæ­¢çš„çº¿ç¨‹ã€‚\nR. Kent Dybvig. A Scheme for native threads. In Symposium in Honor of Mitchell Wand, August 2009. http://www.ccs.neu.edu/events/wand-symposium/.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","id":132,"section":"posts","summary":"ä¸‹é¢ä»‹ç»Chez Schemeçº¿ç¨‹ç³»ç»Ÿè¿‡ç¨‹å’Œè¯­æ³•å½¢å¼ã€‚ é™¤äº†é”ï¼Œé”å¢é‡å’Œé”å‡é‡ä¹‹å¤–ï¼Œçº¿ç¨‹ç³»ç»Ÿçš„åŠŸèƒ½åœ¨éåŸºäºWindowsçš„ç³»ç»Ÿä¸Šåœ¨Posixçº¿ç¨‹","tags":["thread","scheme"],"title":"çº¿ç¨‹ï¼ˆThread System in Chez Schemeï¼‰","uri":"https://lvsq.net/2020/02/thread/","year":"2020"},{"content":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å›æ”¶ä¸è¯¥å¯¹è±¡å…³è”çš„å­˜å‚¨ã€‚ ä¸ºäº†å›æ”¶æ­¤å­˜å‚¨ï¼ŒChez Schemeä½¿ç”¨äº†ä¸€ä¸ªåƒåœ¾æ”¶é›†å™¨ï¼Œè¯¥åƒåœ¾æ”¶é›†å™¨åœ¨ç¨‹åºè¿è¡Œæ—¶å®šæœŸè¿è¡Œã€‚ åƒåœ¾æ”¶é›†å™¨ä»ä¸€ç»„å·²çŸ¥çš„æ ¹å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œæœºå™¨æ³¨å†Œï¼‰ï¼ŒæŸ¥æ‰¾æ‰€æœ‰å¯è®¿é—®å¯¹è±¡ï¼Œå¹¶åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¤åˆ¶å®ƒä»¬ï¼Œä»¥æ¶ˆé™¤å¯è®¿é—®å¯¹è±¡ä¹‹é—´çš„ç¢ç‰‡ï¼Œå¹¶å›æ”¶ä¸å¯è®¿é—®å¯¹è±¡æ‰€å ç”¨çš„å­˜å‚¨ã€‚\nå›æ”¶ç”±é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºè‡ªåŠ¨è§¦å‘ï¼Œè¯¥å¤„ç†ç¨‹åºé€šè¿‡collect-requestä¸­æ–­è°ƒç”¨ï¼Œè¯¥ä¸­æ–­åœ¨åˆ†é…äº†å¤§çº¦nä¸ªå­—èŠ‚çš„å­˜å‚¨ç©ºé—´åå‘ç”Ÿï¼Œå…¶ä¸­næ˜¯å‚æ•°collect-trip-bytes çš„å€¼ã€‚ é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºé€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectç¨‹åºæ¥è¿›è¡Œä¼šç¡ã€‚ å¯ä»¥é€šè¿‡æ›´æ”¹å‚æ•°collect-request-handler çš„å€¼æ¥é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºã€‚ ç¨‹åºè¿˜å¯ä»¥é€šè¿‡ç›´æ¥è°ƒç”¨collectæ¥å¯¼è‡´åœ¨collect-requestä¸­æ–­ä¹‹é—´å‘ç”Ÿå›æ”¶ã€‚\nChez Schemeçš„å›æ”¶å™¨æ˜¯åŸºäºåˆ†ä»£ çš„ã€‚å®ƒæ ¹æ®å¯¹è±¡çš„å¹´é¾„ï¼ˆå¤§è‡´æ¥è¯´ï¼Œå›æ”¶å¹¸å­˜æ•°ï¼‰æ¥å¯¹å¯¹è±¡è¿›è¡Œåˆ†ç±»ï¼Œä¸”è€å¯¹è±¡æ¯”å¹´è½»å¯¹è±¡å›æ”¶çš„é¢‘ç‡è¦ä½ã€‚ç”±äºå¹´è½»å¯¹è±¡æ¯”è€å¯¹è±¡æ›´å¿«åœ°å˜ä¸ºä¸å¯è®¿é—®ï¼Œå› æ­¤ç»“æœæ˜¯å¤§å¤šæ•°çš„å›æ”¶èŠ±è´¹çš„æ—¶é—´æ›´å°‘ã€‚ç³»ç»Ÿè¿˜ç»´æŠ¤ä¸€ä¸ªé™æ€ä»£ï¼ˆstatic generation, ç±»ä¼¼Javaçš„æ°¸ä¹…ä»£ï¼‰ï¼Œä¸ä¼šå¯¹æ­¤å­˜å‚¨è¿›è¡Œå›æ”¶ã€‚ä»…å½“å‹ç¼©å †ï¼ˆScompact_heapï¼‰æˆ–è¦collectçš„target-generation å‚æ•°ä¸ºstaticç¬¦å·æ—¶ï¼Œæ‰å°†å¯¹è±¡æ”¾å…¥é™æ€ä»£ä¸­ã€‚\néé™æ€ä»£çš„ç¼–å·ä»æœ€å¹´è½»çš„ä¸–ä»£ï¼ˆå¼€å§‹äº0ï¼‰åˆ°collect-maximum-generationçš„å½“å‰å€¼ã€‚å­˜å‚¨ç®¡ç†å™¨å°†æ–°åˆ†é…çš„å¯¹è±¡æ”¾å…¥ç¬¬0ä»£ã€‚åœ¨ç¬¬0ä»£çš„å›æ”¶è¿‡ç¨‹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ç¬¬0ä»£çš„å¯¹è±¡æŒªåˆ°ç¬¬1ä»£ï¼Œç±»ä¼¼åœ°ï¼Œåœ¨ç¬¬1ä»£å›æ”¶æœŸé—´ï¼Œå­˜æ´»çš„ç¬¬0ä»£å’Œç¬¬1ä»£å¯¹è±¡ç§»åŠ¨åˆ°ç¬¬2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚åœ¨æœ€å¤§éé™æ€å¯¹è±¡å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å¹¸å­˜çš„éé™æ€å¯¹è±¡éƒ½å°†ç§»åŠ¨ï¼ˆå¯èƒ½è¿”å›ï¼‰åˆ°æœ€å¤§éé™æ€ä»£ä¸­ã€‚ é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œä¸€ä¸ªå¯¹è±¡æœ‰å¯èƒ½è·³è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ï¼Œä½†è¿™åœ¨è®¸å¤šå¯¹è±¡ä¸Šä¸å¤ªå¯èƒ½å‘ç”Ÿï¼Œå¹¶ä¸”å¦‚æœè¿™äº›å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œåˆ™æœ€ç»ˆå°†å›æ”¶å®ƒä»¬çš„å­˜å‚¨ã€‚\nç»´æŠ¤å†…éƒ¨è®¡æ•°å™¨gc-tripæ¥æ§åˆ¶ä½•æ—¶å›æ”¶æ¯ä¸€ä»£ã€‚ æ¯æ¬¡è°ƒç”¨ä¸å¸¦å‚æ•°çš„collect æ—¶ï¼ˆä»é»˜è®¤çš„collect-requestå¤„ç†ç¨‹åºå¼€å§‹ï¼‰ï¼Œgc-tripéƒ½ä¼šåŠ 1ã€‚åœ¨collect-generationåŸºæ•°ä¸ºr çš„æƒ…å†µä¸‹ï¼Œå›æ”¶çš„ä¸–ä»£ç¼–å·ä¸ºg ï¼Œå…¶gc-tripæ˜¯$r^g$çš„å€æ•°ã€‚ å¦‚æœå°†collect-generation-radixè®¾ç½®ä¸º4ï¼Œåˆ™ç³»ç»Ÿå°†æ¯æ¬¡æ”¶é›†0ä»£ï¼Œæ¯4æ¬¡æ”¶é›†1ä»£ï¼Œæ¯16æ¬¡æ”¶é›†2ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚\næ¯æ¬¡æŸä¸ªä¸–ä»£g è°ƒç”¨collectæ—¶ï¼Œè¯¥ä¸–ä»£g è¢«å›æ”¶ä¸”gc-tripå‰è¿›åˆ°ä¸‹ä¸ª$r^g$çš„è¾¹ç•Œï¼Œä½†æ˜¯ä¸ä¼šè¶…è¿‡$r^{g+1}$çš„è¾¹ç•Œï¼Œr ä¸å˜è¿˜æ˜¯collect-generation-radixçš„å€¼ã€‚\nå¦‚æœä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°tg è°ƒç”¨collectï¼Œåˆ™tg ç¡®å®šç›®æ ‡ä»£ã€‚ å½“g æ˜¯æœ€å¤§çš„éé™æ€ä»£æ—¶ï¼Œtg å¿…é¡»ä¸ºg æˆ–ä¸ºstaticã€‚ å¦åˆ™ï¼Œtg å¿…é¡»ä¸ºg æˆ–g + 1 ã€‚ å½“ç›®æ ‡ä»£æ˜¯staticç¬¦å·æ—¶ï¼Œéé™æ€ä»£ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å°†ç§»åŠ¨åˆ°é™æ€ä»£ä¸­ã€‚é™æ€ä»£ä¸­çš„å¯¹è±¡ä»ä¸ä¼šè¢«å›æ”¶ã€‚ è¿™åœ¨åŠ è½½å’Œåˆå§‹åŒ–åº”ç”¨ç¨‹åºçš„æ°¸ä¹…ä»£ç å’Œæ•°æ®ç»“æ„ä¹‹åéå¸¸æœ‰ç”¨ï¼Œä»¥å‡å°‘åç»­å›æ”¶çš„å¼€é”€ã€‚\né€šè¿‡è®¾ç½®æœ¬èŠ‚ä¸­æè¿°çš„å‚æ•°ï¼Œå¯ä»¥å¯¹å›æ”¶å™¨çš„è¡Œä¸ºè¿›è¡Œå®è´¨æ€§çš„è°ƒæ•´ã€‚é€šè¿‡é‡æ–°å®šä¹‰collect-requestå¤„ç†ç¨‹åºä¸”ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectï¼Œç”šè‡³æœ‰å¯èƒ½å®Œå…¨è¦†ç›–æ”¶é›†å™¨çš„é»˜è®¤ç­–ç•¥æ¥ç¡®å®šä½•æ—¶å›æ”¶æ¯ä¸ªä¸–ä»£ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡ä½¿ç”¨æ˜¾å¼çš„g å’Œtg å‚æ•°è°ƒç”¨collectæ¥é‡æ–°å®šä¹‰å¤„ç†ç¨‹åºï¼Œä»¥åœ¨é•¿æ—¶é—´å†…å°†æœ€å¤§çš„éé™æ€ä»£è§†ä¸ºé™æ€ä»£ï¼Œè¯¥å‚æ•°åœ¨è¯¥æ—¶é—´æ®µå†…ç»ä¸ç­‰äºæœ€å¤§çš„éé™æ€ä»£ã€‚\n(collect) | (collect g) | (collect g tg)\ng å¿…é¡»æ˜¯ä¸å¤§äºæœ€å¤§éé™æ€ä»£ï¼ˆcollect-maximum-generationè¿”å›çš„å€¼ï¼‰çš„éè´Ÿç¡®å®šç¼–å·ã€‚ å¦‚æœg å·²ç»æ˜¯æœ€å¤§çš„éé™æ€ä»£ç¼–å·ï¼Œåˆ™tg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg çš„fixnumæˆ–staticç¬¦å·ã€‚ å¦åˆ™ï¼Œtg å¿…é¡»æ˜¯ä¸€ä¸ªç­‰äºg æˆ–å¤§äºg çš„fixnumã€‚\næ­¤è¿‡ç¨‹ä½¿å­˜å‚¨ç®¡ç†å™¨æ‰§è¡Œåƒåœ¾å›æ”¶ã€‚ collectæ˜¯é€šè¿‡collect-requestå¤„ç†ç¨‹åºå®šæœŸè°ƒç”¨çš„ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ˜¾å¼è°ƒç”¨å®ƒï¼Œä»¥åœ¨ç‰¹å®šæ—¶é—´ï¼ˆä¾‹å¦‚ï¼Œåœ¨è®¡æ—¶è®¡ç®—ä¹‹å‰ï¼‰å¼ºåˆ¶è¿›è¡Œå›æ”¶ã€‚ åœ¨Chez Schemeçš„çº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼Œè°ƒç”¨collectçš„çº¿ç¨‹å¿…é¡»æ˜¯å”¯ä¸€çš„æ´»åŠ¨çº¿ç¨‹ã€‚\nç³»ç»Ÿå°†æ ¹æ®g å’Œtg ï¼ˆå¦‚æœæä¾›ï¼‰ç¡®å®šå›æ”¶å“ªäº›ä¸–ä»£ï¼Œå¦‚æœ¬èŠ‚çš„ä»‹ç»ä¸­æ‰€è¿°ã€‚\n(collect-rendezvous)\nè¯·æ±‚åƒåœ¾å›æ”¶çš„æ–¹å¼åº”è¯¥ä¸ç”±ç³»ç»Ÿè‡ªåŠ¨å‘èµ·çš„GCçš„æ–¹å¼ç›¸ä¸€è‡´ã€‚æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ç»è¿‡åè°ƒï¼Œä»¥ä¾¿å…¶ä¸­ä¸€ä¸ªè°ƒç”¨collect-requestå¤„ç†ç¨‹åºï¼Œè€Œå…¶ä»–çº¿ç¨‹æš‚åœç›´åˆ°å¤„ç†ç¨‹åºè¿”å›ã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœcollect-requestå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…collect-request-handlerï¼‰æ²¡æœ‰è°ƒç”¨collectï¼Œé‚£ä¹ˆcollect-rendezvouså®é™…ä¸Šä¸ä¼šæ‰§è¡Œåƒåœ¾å›æ”¶ã€‚\ncollect-notify\nå¦‚æœå°†collect-notifyè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¯å½“è¿è¡ŒGCæ—¶ï¼Œå›æ”¶å™¨éƒ½ä¼šæ‰“å°ä¸€æ¡æ¶ˆæ¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-notifyè®¾ç½®ä¸º#fã€‚\ncollect-trip-bytes\nChez Schemeåœ¨å†…éƒ¨ä»¥å¤§å—åˆ†é…å†…å­˜ï¼Œå¹¶é€šè¿‡å†…è”æ“ä½œå°†è¿™äº›å—ç»†åˆ†ä»¥æé«˜æ•ˆç‡ã€‚å­˜å‚¨ç®¡ç†å™¨ç¡®å®šæ˜¯å¦ä¸ºæ¯ä¸ªåˆ†é…çš„å¤§å—ä»…è¯·æ±‚ä¸€æ¬¡å›æ”¶ã€‚æ­¤å¤–ï¼Œåœ¨å­˜å‚¨ç®¡ç†å™¨è¯·æ±‚å›æ”¶å’Œå…‘ç°å›æ”¶è¯·æ±‚ä¹‹é—´å¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå°¤å…¶æ˜¯å¦‚æœé€šè¿‡with-interrupts-disabledæˆ–disable-interruptsä¸´æ—¶ç¦ç”¨äº†ä¸­æ–­æ—¶ã€‚å› æ­¤ï¼Œcollect-trip-bytesä»…æ˜¯ä¸€ç§è¿‘ä¼¼åº¦é‡ã€‚\ncollect-generation-radix\næ­¤å‚æ•°ç¡®å®šé»˜è®¤æƒ…å†µä¸‹çš„collect-requestå¤„ç†ç¨‹åºè°ƒç”¨ä¸å¸¦å‚æ•°çš„collectæ—¶å›æ”¶æ¯ä¸€ä»£çš„é¢‘ç‡ã€‚æ¯$r^g$æ¬¡å‘ç”Ÿä¸€æ¬¡å¯¹åº”ä¸–ä»£çš„å›æ”¶ï¼Œå…¶ä¸­r æ˜¯collect-generation-radixçš„å€¼ï¼Œg æ˜¯ä¸–ä»£æ•°ã€‚\nå°†collect-generation-radixè®¾ç½®ä¸º1ä¼šå¼ºåˆ¶æ‰€æœ‰ä¸–ä»£æ¯æ¬¡éƒ½è¢«å›æ”¶ï¼Œ å°†collect-generation-radixè®¾ç½®ä¸ºéå¸¸å¤§çš„æ•°ç›®å°†æ— é™æœŸæœ‰æ•ˆåœ°å»¶è¿Ÿè¾ƒæ—©çš„ä¸€ä»£çš„å›æ”¶ã€‚\ncollect-maximum-generation\næ­¤å‚æ•°ç¡®å®šå½“å‰å¯ä»¥ä½¿ç”¨çš„æœ€å¤§éé™æ€ä¸–ä»£æ•°,å®ƒçš„å€¼æ˜¯1åˆ°254èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚è®¾ç½®ä¸º1æ—¶ï¼Œä»…ä½¿ç”¨ä¸¤ä¸ªéé™æ€ç”Ÿæˆã€‚ è®¾ç½®ä¸º2æ—¶ï¼Œå°†ä½¿ç”¨ä¸‰ä¸ªéé™æ€ä¸–ä»£ï¼Œä¾æ­¤ç±»æ¨ã€‚ å½“è®¾ç½®ä¸º254æ—¶ï¼Œå°†ä½¿ç”¨255ä¸ªéé™æ€ä»£ï¼Œå†åŠ ä¸Šä¸€ä¸ªé™æ€ä»£ï¼Œæ€»å…±256ä¸ªä¸–ä»£ã€‚å¢åŠ ä¸–ä»£æ•°å¯ä»¥å‡å°‘äº†æ”¶é›†æ—§å¯¹è±¡çš„é¢‘ç‡ï¼Œæ½œåœ¨åœ°å‡å°‘äº†æ”¶é›†å¼€é”€ï¼Œä½†åŒæ—¶ä¹Ÿæ½œåœ¨åœ°å¢åŠ äº†ç³»ç»Ÿä¸­ä¿ç•™çš„ä¸å¯è®¿é—®å¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œå¢åŠ äº†æ‰€éœ€çš„å†…å­˜æ€»é‡ã€‚\ncollect-request-handler\ncollect-request-handlerçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“ç³»ç»Ÿè®¤ä¸ºåº”è¯¥è¦è¿›è¡ŒGCæ—¶ï¼ˆå³ï¼Œè‡ªä¸Šæ¬¡GCä»¥æ¥ï¼Œç³»ç»Ÿåˆ†é…äº†ç”±å‚æ•°collect-trip-bytesè§„å®šçš„å­˜å‚¨é‡ä¹‹åï¼‰ï¼Œè¯¥è¿‡ç¨‹åœ¨ä¸å¸¦å‚æ•°çš„æƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œcollect-request-handlerä»…è°ƒç”¨ä¸å¸¦å‚æ•°çš„collectã€‚ å¯ä»¥é€šè¿‡å°†collect-request-handlerè®¾ç½®ä¸ºä¸æ‰§è¡Œä»»ä½•æ“ä½œçš„è¿‡ç¨‹æ¥ç¦ç”¨è‡ªåŠ¨æ”¶é›†ï¼Œä¾‹å¦‚ï¼š\n(collect-request-handler void) ä¹Ÿå¯ä»¥åˆ©ç”¨é˜²æ­¢ä»»ä½•ä¸­æ–­çš„critical-sectionæ¥ä¸´æ—¶ç¦ç”¨GC\nrelease-minimum-generation\næ­¤å‚æ•°çš„å€¼å¿…é¡»ä»‹äº0åˆ°collect-maximum-generationçš„å€¼ï¼ˆåŒ…æ‹¬ï¼‰ä¹‹é—´ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºcollect-maximum-generationçš„å€¼ã€‚\nå½“åˆ†é…æ–°æ•°æ®ä¸”è¿›è¡ŒGCæ—¶ï¼Œstorage-managementä¼šè‡ªåŠ¨åœ°ä»æ“ä½œç³»ç»Ÿä¸­è¯·æ±‚é¢å¤–çš„è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ç›¸åº”åœ°ï¼Œåœ¨å †æ˜¾è‘—å‡å°çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå°è¯•å°†å…ˆå‰ä»æ“ä½œç³»ç»Ÿè·å¾—çš„æŸäº›è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä»…åœ¨é’ˆå¯¹æœ€å¤§éé™æ€æ—¶ä»£çš„GCä¹‹åæ‰è¿™æ ·åšã€‚ä¹Ÿå¯ä»¥è®©ç³»ç»Ÿåœ¨å¯¹æ›´å¹´è½»çš„ä¸–ä»£å›æ”¶ä¹‹åå°±æ‰§è¡Œæ­¤æ“ä½œï¼Œæ–¹æ³•æ˜¯å°†release-minimum-generationçš„å€¼æ›´æ”¹ä¸ºå°äºcollect-maximum-generationçš„å€¼ã€‚ç”±å‚æ•°æŒ‡å®šçš„ä¸–ä»£ï¼Œæˆ–è€…ä»»ä½•è¾ƒè€çš„ä¸–ä»£æ˜¯GCçš„ç›®æ ‡ä¸–ä»£æ—¶ï¼Œå­˜å‚¨ç®¡ç†ç³»ç»Ÿå°†åœ¨GCä¹‹åå°è¯•å°†ä¸éœ€è¦çš„è™šæ‹Ÿå†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿã€‚\nå½“collect-maximum-generationè®¾ç½®ä¸ºä¸€ä¸ªæ–°å€¼g æ—¶ï¼Œrelease-minimum-generationä¹ŸåŒæ—¶éšå¼åœ°æ›´æ”¹ä¸ºg ï¼Œæœ‰ä¸¤ä¸ªå‰æï¼šï¼ˆaï¼‰ä¿®æ”¹å‰è¿™ä¸¤ä¸ªå‚æ•°å…·æœ‰ç›¸åŒçš„å€¼ï¼›ï¼ˆbï¼‰release-minimum-generationçš„å€¼å¤§äºg\nheap-reserve-ratio\næ­¤å‚æ•°ç¡®å®šäº†ä¿ç•™çš„å†…å­˜çš„å¤§æ¦‚æ•°é‡ï¼ˆæ²¡æœ‰è¿”å›ç»™OSï¼Œå¦‚release-minimum-generationæ‰€æè¿°çš„ï¼‰ä¸å½“å‰å·²å ç”¨çš„å†…å­˜é‡ï¼ˆä¸åŒ…å«å·²å˜ä¸ºé™æ€çš„å†…å­˜åŒºåŸŸï¼‰çš„æ¯”ä¾‹ï¼Œå®ƒçš„å€¼å¿…é¡»æ˜¯ä¸ç²¾ç¡®çš„éè´Ÿæ•´æ•°å€¼ï¼› å¦‚æœè®¾ç½®ä¸ºç²¾ç¡®çš„å®æ•°å€¼ï¼Œåˆ™ç²¾ç¡®çš„å€¼å°†è½¬æ¢ä¸ºä¸ç²¾ç¡®çš„å€¼ã€‚é»˜è®¤å€¼1.0ï¼Œä¸ºæ¯ä¸ªå½“å‰å ç”¨çš„éé™æ€é¡µé¢ä¿ç•™ä¸€é¡µå†…å­˜ã€‚ å°†å…¶è®¾ç½®ä¸ºè¾ƒå°çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°çš„å¹³å‡è™šæ‹Ÿå†…å­˜å ç”¨é‡ï¼Œè€Œå°†å…¶è®¾ç½®ä¸ºè¾ƒå¤§çš„å€¼å¯èƒ½ä¼šå¯¼è‡´è¾ƒå°‘çš„æ“ä½œç³»ç»Ÿè°ƒç”¨ä»¥è¯·æ±‚å’Œé‡Šæ”¾å†…å­˜ç©ºé—´ã€‚\nå¼±åºå¯¹ï¼Œæš‚æ—¶åºå¯¹å’Œå®ˆæŠ¤è€…Weak Pairs, Ephemeron Pairs, and Guardians weak pairså…è®¸ç¨‹åºç»´æŠ¤æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆã€‚ æŒ‡å‘å¯¹è±¡çš„å¼±æŒ‡é’ˆä¸ä¼šé˜»æ­¢å­˜å‚¨ç®¡ç†ç³»ç»Ÿå›æ”¶è¯¥å¯¹è±¡ï¼Œä½†æ˜¯åªè¦è¯¥å¯¹è±¡åœ¨ç³»ç»Ÿä¸­æ˜¯å¯è®¿é—®çš„ï¼Œå®ƒä»ç„¶æœ‰æ•ˆã€‚\nephemeron pairsä¸weak pairsç±»ä¼¼ï¼Œä½†æ˜¯ephemeron pairsæ‹¥æœ‰ä¸¤ä¸ªæŒ‡é’ˆï¼Œå…¶ä¸­ä»…ä»…åœ¨ç¬¬ä¸€ä¸ªæŒ‡é’ˆå­˜åœ¨çš„æƒ…å†µç¬¬äºŒä¸ªæŒ‡é’ˆæ‰èƒ½å­˜åœ¨\nguardianså…è®¸ç¨‹åºä¿æŠ¤å¯¹è±¡å…é­åƒåœ¾å›æ”¶å™¨çš„é‡åˆ†é…ï¼Œå¹¶ç¡®å®šè¯¥å¯¹è±¡ä½•æ—¶è¢«é‡æ–°åˆ†é…ã€‚\nweak paris, ephemeron pairs å’Œguardianså…è®¸ç¨‹åºå°†æœ‰å…³å¯¹è±¡çš„ä¿¡æ¯ä¿ç•™åœ¨å•ç‹¬çš„æ•°æ®ç»“æ„ï¼ˆä¾‹å¦‚å“ˆå¸Œè¡¨ï¼‰ä¸­ï¼Œè€Œæ— éœ€æ‹…å¿ƒç»´æŠ¤æ­¤ä¿¡æ¯å°†å¯¼è‡´å¯¹è±¡æ— é™æœŸåœ°ä¿ç•™åœ¨ç³»ç»Ÿä¸­ã€‚\nå¦å¤–ï¼Œguardianså…è®¸æ— é™æœŸåœ°ä»é‡Šæ”¾å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡ï¼Œä»¥ä¾¿å¯ä»¥é‡ç”¨å®ƒä»¬ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨å­˜å‚¨åœ¨å¯¹è±¡ä¸­çš„æ•°æ®æ‰§è¡Œæ¸…ç†æˆ–å…¶ä»–æ“ä½œã€‚\n(weak-cons obj1 obj2)\nè¿”å›ï¼šä¸€ä¸ªæ–°çš„å¼±åºå¯¹\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚å¼±åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\nå¼±åºå¯¹å¯ä»¥ä½¿ç”¨**weak-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ å¼±åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆ å¼±åºå¯¹çš„carä¸­çš„å¼±æŒ‡é’ˆå°±åƒæ™®é€šæŒ‡é’ˆä¸€æ ·ï¼Œåªè¦å®ƒæŒ‡å‘çš„å¯¹è±¡å¯ä»¥é€šè¿‡ç³»ç»Ÿä¸­æŸä¸ªåœ°æ–¹çš„æ™®é€šï¼ˆéå¼±ï¼‰æŒ‡é’ˆè®¿é—®å³å¯ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåƒåœ¾æ”¶é›†å™¨åœ¨æŸä¸ªæ—¶å€™è¯†åˆ«å‡ºä¸å­˜åœ¨æŒ‡å‘è¯¥å¯¹è±¡çš„éå¼±æŒ‡é’ˆï¼Œåˆ™å®ƒå°†æ¯ä¸ªæŒ‡å‘è¯¥å¯¹è±¡çš„å¼±æŒ‡é’ˆæ›¿æ¢ä¸ºâ€œ broken weak-pointerâ€å¯¹è±¡**#!bwp**ï¼Œå¹¶ä¸¢å¼ƒè¯¥å¯¹è±¡ã€‚\nå¼±åºå¯¹çš„cdrå­—æ®µä¸æ˜¯å¼±æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨å¼±åºå¯¹æ¥æ„é€ å¼±ä¿æŒå¯¹è±¡çš„åˆ—è¡¨ã€‚å¯ä»¥åƒä½¿ç”¨æ™®é€šçš„åˆ—è¡¨çš„å¤„ç†æ“ä½œï¼ˆä¾‹å¦‚lengthï¼Œmapå’Œassvï¼‰æ¥æ“ä½œè¿™äº›listã€‚å¼±åºå¯¹å¯ä»¥ä½¿ç”¨set-car!å’Œset-cdr!æ¥ä¿®æ”¹ï¼› åœ¨set-car!ä¹‹åï¼Œcarå­—æ®µåŒ…å«æŒ‡å‘æ–°å¯¹è±¡çš„å¼±æŒ‡é’ˆï¼Œä»£æ›¿äº†æ—§å¯¹è±¡ã€‚å¼±åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ç›¸åŒã€‚ å¼±åºå¯¹æ²¡æœ‰readerè¯­æ³•ã€‚å¼±åºå¯¹åœ¨è¢«å†™å…¥ç„¶åè¢«è¯»å–æ—¶æˆä¸ºæ™®é€šå¯¹ã€‚\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (car p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (weak-pair? obj)\n(weak-pair? (weak-cons â€™a â€™b)) â‡’ #t (weak-pair? (cons â€™a â€™b)) â‡’ #f (weak-pair? \u0026#34;oops\u0026#34;) â‡’ #f (ephemeron-cons obj1 obj2)\nobj1 æ˜¯æ–°å¯¹çš„car, obj2æ„æˆäº†æ–°å¯¹çš„cdrã€‚æš‚æ—¶åºå¯¹å’Œæ™®é€šå¯¹æ˜¯æ— æ³•åŒºåˆ†çš„ï¼Œé™¤äº†è¿™ä¸¤ç§æ–¹å¼ï¼š\næš‚æ—¶åºå¯¹å¯ä»¥ä½¿ç”¨**ephemeron-pair?**è¿™ä¸ªè°“è¯æ¥åŒºåˆ«æ™®é€šå¯¹ æš‚æ—¶åºå¯¹ç»´æŠ¤äº†ä¸€ä¸ªæŒ‡å‘(car obj)çš„å¼±æŒ‡é’ˆï¼Œå¹¶ä¸”ä»…ä»…åœ¨pairçš„carå­˜åœ¨æ—¶cdræ‰èƒ½ä¿ç•™ æš‚æ—¶åºå¯¹çš„è¡Œä¸ºä¸å¼±åºå¯¹ç±»ä¼¼ï¼Œä¸è¿‡cdræœ‰ç‰¹æ®Šçš„å¤„ç†ï¼šå¦‚æœcarè¢«è®¾ç½®ä¸º**#!bwpçš„åŒæ—¶ä¹Ÿä¼šå°†cdrè®¾ç½®ä¸º#!bwp**ã€‚ç”±äºåŒæ—¶å°†carå’Œcdrå­—æ®µè®¾ç½®ä¸ºä¸º**#!bwp**ï¼Œå› æ­¤å¯ä»¥é€šè¿‡cdrå¯¹è±¡å¼•ç”¨carå¯¹è±¡è¿™ä¸€äº‹å®æœ¬èº«å¹¶ä¸æ„å‘³ç€å¿…é¡»ä¿ç•™carï¼ˆä¸å¼±åºå¯¹ä¸åŒï¼‰ã€‚ ç›¸åï¼Œå‡ºäºæŸç§åŸå› ï¼Œcarå¿…é¡»ç‹¬ç«‹äºcdrå¯¹è±¡ä¿å­˜ã€‚\nä¸å¼±åºå¯¹å’Œå…¶ä»–å¯¹ä¸€æ ·ï¼Œæš‚æ—¶åºå¯¹ä½¿ç”¨**set-car!å’Œset-cdr!**æ¥ä¿®æ”¹æ•°æ®ï¼Œæš‚æ—¶åºå¯¹çš„æ‰“å°æ–¹å¼ä¸æ™®é€šå¯¹ä¸€æ ·ï¼Œä½†æ²¡æœ‰readerè¯­æ³•\n(define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) (define x (cons \u0026#39;a \u0026#39;b)) (define p (ephemeron-cons x x)) (set! x \u0026#39;*) (collect) (car p) â‡’ #!bwp (cdr p) â‡’ #!bwp (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x x)) ; not an ephemeron pair (set! x \u0026#39;*) (collect) (car p) â‡’ (a . b) (cdr p) â‡’ (a . b) ä¸å¼±åºå¯¹ä¸€æ ·ï¼Œå¦‚æœåœ¨å°†xè®¾ç½®ä¸º*ä¹‹å‰è¿›è¡Œäº†åƒåœ¾å›æ”¶å°†è¯¥pairæå‡ä¸ºè¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™ä¸Šé¢ä¸­é—´ç¤ºä¾‹çš„æœ€åä¸¤ä¸ªè¡¨è¾¾å¼å®é™…ä¸Šå¯èƒ½è¿”å›ï¼ˆa . bï¼‰ã€‚ ä½†æ˜¯ï¼Œåœ¨ä¸Šé¢çš„æœ€åä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæœ€åä¸¤ä¸ªè¡¨è¾¾å¼çš„ç»“æœå°†å§‹ç»ˆä¸ºï¼ˆa . bï¼‰ï¼Œå› ä¸ºå¼±åºå¯¹çš„cdræŒæœ‰éå¼±å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥éå¼±å¼•ç”¨é˜»æ­¢carå­—æ®µå˜** #!bwp**ã€‚\n(ephemeron-pair? obj)\n(ephemeron-pair? (ephemeron-cons \u0026#39;a \u0026#39;b)) â‡’ #t (ephemeron-pair? (cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? (weak-cons \u0026#39;a \u0026#39;b)) â‡’ #f (ephemeron-pair? \u0026#34;oops\u0026#34;) â‡’ #f (bwp-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯æ–­å¼€çš„broken weak-pairå¯¹è±¡ï¼Œåˆ™è¿”å›#tï¼Œå¦åˆ™è¿”å›#f\n(bwp-object? #!bwp) â‡’ #t (bwp-object? \u0026#39;bwp) â‡’ #f (define x (cons \u0026#39;a \u0026#39;b)) (define p (weak-cons x \u0026#39;())) (set! x \u0026#39;*) (collect (collect-maximum-generation)) (car p) â‡’ #!bwp (bwp-object? (car p)) â‡’ #t (make-guardian)\nGuardiansç”±è¦ä¿æŠ¤çš„å¯¹è±¡ç»„çš„è¿‡ç¨‹è¡¨ç¤ºã€‚åˆ›å»ºguardianåï¼Œæ³¨å†Œå¯¹è±¡ç»„ä¸ºç©ºã€‚ é€šè¿‡å°†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ˆæŠ¤è€…ï¼Œå¯ä»¥å‘guardianæ³¨å†Œå¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) x â‡’ (aaa . bbb) (G x) æ³¨å†Œå¯¹è±¡æ—¶ä¹Ÿå¯ä»¥æŒ‡å®šâ€œrepresentativeâ€ï¼ˆå³ï¼Œyï¼‰å¯¹è±¡ã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(define y (cons \u0026#39;ccc \u0026#39;ddd)) y â‡’ (ccc . ddd) (G y \u0026#39;rep) ä¸å®ˆæŠ¤è€…å…³è”çš„ä¸€ç»„æ³¨å†Œå¯¹è±¡åœ¨é€»è¾‘ä¸Šç»†åˆ†ä¸ºä¸¤ä¸ªä¸ç›¸äº¤çš„å­ç»„ï¼šä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œå¯è®¿é—®â€å¯¹è±¡ï¼Œä¸€ä¸ªå­ç»„ç§°ä¸ºâ€œä¸å¯è®¿é—®â€å¯¹è±¡ã€‚ä¸å¯è®¿é—®çš„å¯¹è±¡æ˜¯å·²è¢«è¯æ˜æ— æ³•è®¿é—®çš„å¯¹è±¡ï¼ˆé€šè¿‡guardianæœºåˆ¶æœ¬èº«æˆ–é€šè¿‡å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µé™¤å¤–ï¼‰ï¼Œå¯è®¿é—®çš„å¯¹è±¡æ˜¯æœªç»è¯æ˜çš„å¯¹è±¡ã€‚â€œå·²è¯æ˜â€ä¸€è¯åœ¨è¿™é‡Œå¾ˆé‡è¦ï¼šå¯èƒ½æ˜¯å¯è®¿é—®ç»„ä¸­çš„æŸäº›å¯¹è±¡ç¡®å®æ˜¯ä¸å¯è®¿é—®çš„ï¼Œä½†è¿™å°šæœªå¾—åˆ°è¯æ˜ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç›´åˆ°å¯¹è±¡å®é™…ä¸Šå˜å¾—ä¸å¯è®¿é—®å¾ˆä¹…ä¹‹åï¼ˆåœ¨å½“å‰å®ç°ä¸­ï¼Œç›´åˆ°å‘ç”ŸåŒ…å«å¯¹è±¡çš„ä¸–ä»£çš„åƒåœ¾å›æ”¶ï¼‰ï¼Œæ‰å¯èƒ½åšå‡ºè¿™ç§è¯æ˜ã€‚\nå‘guardianæ³¨å†Œçš„å¯¹è±¡æœ€åˆè¢«æ”¾ç½®åœ¨å¯è®¿é—®ç»„ä¸­ï¼Œå¹¶åœ¨å®ƒä»¬å˜å¾—ä¸å¯è®¿é—®åçš„æŸä¸ªæ—¶åˆ»ç§»å…¥ä¸å¯è®¿é—®ç»„ã€‚ ä¸å¯è®¿é—®ç»„ä¸­çš„å¯¹è±¡æ˜¯é€šè¿‡è°ƒç”¨ä¸å¸¦å‚æ•°çš„guardianæ¥æ£€ç´¢çš„ã€‚ å¦‚æœä¸å¯è®¿é—®ç»„ä¸­æ²¡æœ‰å¯¹è±¡ï¼Œåˆ™guardianè¿”å›#fã€‚ ç»§ç»­ä¸Šé¢çš„ç¤ºä¾‹ï¼š\n(G) â‡’ #f (set! x #f) (set! y #f) (collect) (G) â‡’ (aaa . bbb) ; ä¹Ÿæœ‰å¯èƒ½è¿™ä¸ªåæ‰“å°å‡ºæ¥ (G) â‡’ rep ; è¿™ä¸ªå…ˆæ‰“å°å‡ºæ¥ (G) â‡’ #f å¯¹Gçš„åˆå§‹è°ƒç”¨è¿”å›#fï¼Œå› ä¸ºç»‘å®šåˆ°xå’Œyçš„å¯¹æ˜¯å‘Gæ³¨å†Œçš„å”¯ä¸€å¯¹è±¡ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥é€šè¿‡è¿™äº›ç»‘å®šè®¿é—®è¿™äº›åºå¯¹ã€‚è°ƒç”¨collectæ—¶ï¼Œå¯¹è±¡å°†ç§»å…¥ä¸å¯è®¿é—®çš„ç»„ã€‚ å› æ­¤ï¼Œå¯¹Gçš„ä¸¤ä¸ªè°ƒç”¨è¿”å›å…ˆå‰ç»‘å®šåˆ°xçš„åºå¯¹å’Œå…ˆå‰ç»‘å®šåˆ°yçš„åºå¯¹çš„representativeï¼Œå°½ç®¡å¯èƒ½ä¸æ‰€ç¤ºé¡ºåºç›¸åã€‚ ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äºå¼±åºå¯¹ï¼Œå¦‚æœå¯¹è±¡å·²è¿ç§»åˆ°è¾ƒè€çš„ä¸€ä»£ï¼Œåˆ™è°ƒç”¨collectå®é™…ä¸Šå¯èƒ½ä¸è¶³ä»¥è¯æ˜è¯¥å¯¹è±¡ä¸å¯è®¿é—®ã€‚ï¼‰\nå®é™…ä¸Šï¼Œä»guardiané‚£é‡Œè·å–çš„å¯¹è±¡åœ¨ä»»ä½•æ–¹é¢éƒ½æ²¡æœ‰ç‰¹æ®Šçš„åœ°ä½ã€‚ æ­¤åŠŸèƒ½é¿å…äº†å…±äº«æˆ–å¾ªç¯ç»“æ„å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ã€‚ ç”±ä¸å¯è®¿é—®å¯¹è±¡ç»„æˆçš„å…±äº«æˆ–å¾ªç¯ç»“æ„å°†è¢«å®Œæ•´ä¿ç•™ï¼Œå°†æ³¨å†Œç”±guardianä¿æŠ¤çš„éƒ¨åˆ†éƒ½æ”¾ç½®åœ¨è¯¥guardianä¸å¯è®¿é—®çš„é›†åˆä¸­ã€‚ ç„¶åï¼Œç¨‹åºå‘˜å¯ä»¥å®Œå…¨æ§åˆ¶ç»“æ„çš„å¤„ç†é¡ºåºã€‚\nä¸€ä¸ªå¯¹è±¡å¯ä»¥åœ¨guardianå¤„å¤šæ¬¡æ³¨å†Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å¤šæ¬¡æ£€ç´¢è¯¥å¯¹è±¡ï¼š\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (G x) (G x) (set! x #f) (collect) (G) â‡’ (aaa . bbb) (G) â‡’ (aaa . bbb) å®ƒä¹Ÿå¯ä»¥å‘ä¸æ­¢ä¸€ä¸ªguardianæ³¨å†Œï¼Œå¹¶ä¸”guardianæœ¬èº«ä¹Ÿå¯ä»¥å‘å…¶ä»–guardianæ³¨å†Œã€‚ åœ¨æ²¡æœ‰â€œrepresentativeâ€çš„æƒ…å†µä¸‹å‘guardianæ³¨å†Œçš„å¯¹è±¡ï¼Œå¹¶æ”¾ç½®åœ¨ä¸€ä¸ªå¼±åºå¯¹æˆ–æš‚æ—¶å¯¹çš„carå­—æ®µä¸­ï¼Œå…¶ç›´åˆ°ä»guardianå¤„å°†è¿”å›å¹¶ç”±ç¨‹åºä¸¢å¼ƒï¼Œæˆ–è€…ç›´åˆ°guardianæœ¬èº«è¢«ä¸¢å¼ƒä¸ºæ­¢ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (collect) (set! y (G)) y â‡’ (aaa . bbb) (car p) â‡’ (aaa . bbb) (set! y #f) (collect 1) (car p) â‡’ #!bwp å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæŒ‡å®šäº†representativeï¼ˆå¯¹è±¡æœ¬èº«é™¤å¤–ï¼‰ï¼Œåˆ™åœ¨ä»guardianå¤„è·å¾—representativeçš„åŒæ—¶ï¼Œä¹Ÿä¼šä»å¼±åºå¯¹æˆ–æš‚æ—¶åºå¯¹çš„carå­—æ®µä¸­ä¸¢å¼ƒå—ä¿æŠ¤çš„å¯¹è±¡ã€‚\n(define G (make-guardian)) (define x (cons \u0026#39;aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x \u0026#39;rep) (set! x #f) (collect) (G) â‡’ rep ; è·å¾—representativeçš„å€¼ (car p) â‡’ #!bwp ; è‡ªåŠ¨ä¸¢å¼ƒ ä¸‹é¢çš„ç¤ºä¾‹è¯´æ˜äº†å½“guardianæœ¬èº«ä¸¢å¼ƒæ—¶ï¼Œè¯¥å¯¹è±¡å·²è¢«é‡Šæ”¾å¹¶ä¸”å¼±åºå¯¹çš„carå­—æ®µè®¾ç½®ä¸º#!bwpï¼š\n(define G (make-guardian)) (define x (cons aaa \u0026#39;bbb)) (define p (weak-cons x \u0026#39;())) (G x) (set! x #f) (set! G #f) (collect) (car p) â‡’ #!bwp ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨guardianæ¥é‡Šæ”¾å¤–éƒ¨å­˜å‚¨ï¼Œå°±åƒç”±Cåº“â€œmallocâ€å’Œâ€œfreeâ€æ“ä½œç®¡ç†å­˜å‚¨ã€‚\n(define malloc (let ([malloc-guardian (make-guardian)]) (lambda (size) ; first free any storage that has been dropped. to avoid long ; delays, it might be better to deallocate no more than, say, ; ten objects for each one allocated (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f)))) ; then allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x)))) do-mallocå¿…é¡»è¿”å›ä¸€ä¸ªSchemeå¯¹è±¡â€œheaderâ€ï¼Œè¯¥headerå°è£…ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆï¼ˆå¯èƒ½æ˜¯æ— ç¬¦å·æ•´æ•°ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡æ­¤headerå¯¹å¤–éƒ¨å­˜å‚¨è¿›è¡Œæ‰€æœ‰è®¿é—®ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¿…é¡»æ³¨æ„åœ¨åˆ é™¤ç›¸åº”çš„headerä¹‹åï¼Œåœ¨Schemeä¹‹å¤–ä¸å­˜åœ¨æŒ‡å‘å¤–éƒ¨å­˜å‚¨çš„æŒ‡é’ˆã€‚ do-freeå¿…é¡»ä½¿ç”¨å°è£…çš„æŒ‡é’ˆé‡Šæ”¾å¤–éƒ¨å­˜å‚¨ã€‚è¿™ä¸¤ä¸ªåŸè¯­éƒ½å¯ä»¥ä½¿ç”¨å¤–éƒ¨åˆ†é…å’Œå¤–éƒ¨æ— å…³çš„å®šä¹‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¤–éƒ¨è¿‡ç¨‹å¯¼å…¥çš„Cåº“â€œmallocâ€å’Œâ€œfreeâ€è¿ç®—ç¬¦è¿›è¡Œå®šä¹‰ã€‚\nå¦‚æœä¸å¸Œæœ›è°ƒç”¨mallocæ¥é‡Šæ”¾å­˜å‚¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨collect-requestå¤„ç†å™¨æ¥æ£€æŸ¥å¹¶é‡Šæ”¾å·²ä¸¢å¼ƒçš„å­˜å‚¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define malloc) (let ([malloc-guardian (make-guardian)]) (set! malloc (lambda (size) ; allocate and register the new storage (let ([x (do-malloc size)]) (malloc-guardian x) x))) (collect-request-handler (lambda () ; first, invoke the collector (collect) ; then free any storage that has been dropped (let f () (let ([x (malloc-guardian)]) (when x (do-free x) (f))))))) é€šè¿‡ä¸€ç‚¹é‡æ„ï¼Œå°±æœ‰å¯èƒ½å°†å°è£…çš„å¤–éƒ¨åœ°å€æ³¨å†Œä¸ºå¸¦headerçš„representativeï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œdo-freeå°†ä»…å°†å¤–éƒ¨åœ°å€ä½œä¸ºå‚æ•°ã€‚ è¿™å°†ä½¿æ ‡å¤´ä¸€æ—¦å˜å¾—ä¸å¯è®¿é—®ï¼Œä¾¿å¯ä»¥å°†å…¶ä»Schemeå †ä¸­åˆ é™¤ã€‚\né”å¯¹è±¡Locking Objects æ¥è‡ªCè¯­è¨€çš„å˜é‡æˆ–æ•°æ®ç»“æ„åˆ°Schemeå¯¹è±¡çš„æ‰€æœ‰æŒ‡é’ˆï¼Œé€šå¸¸åº”åœ¨è¾“å…¥ï¼ˆæˆ–é‡æ–°è¾“å…¥ï¼‰Schemeä¹‹å‰ä¸¢å¼ƒã€‚ å½“æ— æ³•éµå¾ªè¯¥å‡†åˆ™æ—¶ï¼Œå¯ä»¥é€šè¿‡é”å®šå¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Slock_objecté”å®šè¯¥å¯¹è±¡ã€‚\n(lock-object obj)\né”å®šå¯¹è±¡å¯é˜²æ­¢å­˜å‚¨ç®¡ç†å™¨æ”¶å›æˆ–é‡å®šä½è¯¥å¯¹è±¡ã€‚ åº”è°¨æ…ä½¿ç”¨é”å®šï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å†…å­˜ç¢ç‰‡å¹¶å¢åŠ å­˜å‚¨ç®¡ç†å¼€é”€ã€‚\nå¦‚æœæœªè§£é”å¯¹è±¡ï¼Œé”å®šä¹Ÿä¼šå¯¼è‡´æ„å¤–ä¿ç•™å­˜å‚¨ç©ºé—´ã€‚ å¯ä»¥é€šè¿‡è§£é”å¯¹è±¡æˆ–ç­‰æ•ˆçš„Cåº“è¿‡ç¨‹Sunlock_objectæ¥è§£é”å¯¹è±¡ã€‚\né”å®šç«‹å³æ•°ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è¢«é™æ€åŒ–çš„å¯¹è±¡æ˜¯ä¸å¿…è¦ä½†æ— å®³çš„ã€‚\n(unlock-object obj)\né€šè¿‡è¿ç»­è°ƒç”¨lock-objectï¼ŒSlock_objectæˆ–åŒæ—¶è°ƒç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å¤šæ¬¡é”å®šå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»å…ˆé€šè¿‡ç›¸ç­‰æ¬¡æ•°çš„å¯¹unlock-objectæˆ–Sunlock_objectçš„è°ƒç”¨æ¥å°†å…¶è§£é”ã€‚\né™¤éå­˜åœ¨æŒ‡å‘å¯¹è±¡çš„å•ç‹¬çš„CæŒ‡é’ˆï¼Œå¦åˆ™ä¹Ÿæ— éœ€é”å®šåŒ…å«åœ¨é”å®šå¯¹è±¡ä¸­çš„å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œé”å®šåºå¯¹çš„carä¸­çš„å¯¹è±¡ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä»…å…è®¸é€šè¿‡å¤–éƒ¨å¯¹è±¡æ¥é—´æ¥è®¿é—®çš„å†…éƒ¨å¯¹è±¡ï¼Œåˆ™åº”å°†å…¶è§£é”ï¼Œä»¥ä¾¿å›æ”¶å™¨åœ¨å›æ”¶æœŸé—´å¯ä»¥è‡ªç”±åœ°é‡åˆ†é…å®ƒã€‚\nè§£é”ç«‹å³å€¼ï¼ˆä¾‹å¦‚ï¼Œfixnumï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ï¼‰æˆ–å·²è®¾ä¸ºé™æ€çš„å¯¹è±¡æ˜¯ä¸å¿…è¦çš„ï¼Œæ— æ•ˆçš„ï¼Œä½†æ— å®³ã€‚\n(locked-object? obj)\nè¿”å›ï¼šå¦‚æœobjæ˜¯é”å®šçš„ï¼Œç«‹å³çš„æˆ–é™æ€çš„ï¼Œè¿”å›#t\nå¦‚æœå›æ”¶å™¨æ— æ³•é‡åˆ†é…æˆ–å›æ”¶objï¼Œåˆ™è¯¥è°“è¯å°†è¿”å›trueï¼ŒåŒ…æ‹¬ç«‹å³å€¼ï¼Œä¾‹å¦‚fixnumsï¼Œå¸ƒå°”å€¼å’Œå­—ç¬¦ä»¥åŠå·²è®¾ä¸ºé™æ€çš„å¯¹è±¡ã€‚\n","id":133,"section":"posts","summary":"åƒåœ¾å›æ”¶ Schemeç¨‹åºä¸ä¼šæ˜¾å¼åœ°é‡Šæ”¾è¯¸å¦‚åºå¯¹ï¼Œå­—ç¬¦ä¸²å’Œè¿‡ç¨‹ä¹‹ç±»çš„Schemeå¯¹è±¡ã€‚ ç›¸åï¼Œä¸€æ—¦å­˜å‚¨ç®¡ç†ç³»ç»Ÿè¯æ˜ä¸å†å¯ä»¥è®¿é—®è¯¥å¯¹è±¡ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨","tags":["scheme"],"title":"å­˜å‚¨ç®¡ç†(Storage Management in Chez Scheme)","uri":"https://lvsq.net/2020/02/storage-management/","year":"2020"},{"content":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;)\nè¿”å›ï¼šæœªæŒ‡å®š\nè­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢ç¨‹åºç»§ç»­è¿è¡Œä½†å¯èƒ½åœ¨ä»¥åå¯¼è‡´æ›´ä¸¥é‡é—®é¢˜çš„æƒ…å†µã€‚ é€šå¸¸æœ€å¥½æ˜¯è¯†åˆ«ç¨‹åºå‘˜å·²è°ƒç”¨çš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç¨‹åºå‘˜å¯èƒ½ä¸çŸ¥é“çš„å…¶ä»–è¿‡ç¨‹ã€‚ msgå¿…é¡»ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶åº”æè¿°å¼‚å¸¸æƒ…å†µã€‚irritantå¯ä»¥æ˜¯ä»»ä½•Schemeå¯¹è±¡ï¼Œå¹¶ä¸”åº”åŒ…å«å¯èƒ½å¯¼è‡´æˆ–ä¸¥é‡æ¶‰åŠå¼‚å¸¸æƒ…å†µçš„å€¼ã€‚\n(assertion-violationf who msg irritant \u0026hellip;) | (errorf who msg irritant \u0026hellip;) | (warningf who msg irritant \u0026hellip;)\nè¿™äº›è¿‡ç¨‹ç±»ä¼¼äºassertion-violation, error, warning, æ‰€ä¸åŒçš„åœ¨äº msg è®¾å®šä¸ºä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²\nä¸­æ–­ Chez Schemeå…è®¸ç¨‹åºåœ¨å‘ç”Ÿå„ç§äº‹ä»¶æ—¶æ§åˆ¶Schemeç³»ç»Ÿçš„æ“ä½œï¼Œè¿™äº›äº‹ä»¶åŒ…æ‹¬é”®ç›˜ä¸­æ–­ï¼Œç”±set-timerè®¾ç½®çš„å†…éƒ¨è®¡æ—¶å™¨åˆ°æœŸï¼Œç”±ä¸­æ–­è°ƒç”¨å¼•å‘çš„æ–­ç‚¹æˆ–è€…æ¥è‡ªå­˜å‚¨ç®¡ç†å™¨çš„è¯·æ±‚å¯åŠ¨GCã€‚\næ— è®ºä½•æ—¶breakè¢«è°ƒç”¨ï¼Œç³»ç»Ÿéƒ½ä¼šç«‹å³å¯ç”¨ä¸­æ–­å¤„ç†ç¨‹åº\n(break who msg irritant \u0026hellip;) | (break who) | (break)\nbreakå‚æ•°éµå¾ªä¸Šè¿°errorfçš„åè®®ã€‚é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºï¼ˆè¯·å‚è§break-handlerï¼‰æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯å¹¶è°ƒç”¨è°ƒè¯•å™¨ã€‚å¯ä»¥çœç•¥æ ¼å¼å­—ç¬¦ä¸²å’Œå¯¹è±¡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºå‘å‡ºçš„æ¶ˆæ¯ä½¿ç”¨whoå‚æ•°æ ‡è¯†ä¸­æ–­ï¼Œä½†ä¸æä¾›æœ‰å…³ä¸­æ–­çš„æ›´å¤šä¿¡æ¯ã€‚å¦‚æœä¹Ÿçœç•¥äº†whoå‚æ•°ï¼Œåˆ™ä¸ä¼šç”Ÿæˆä»»ä½•æ¶ˆæ¯ã€‚å¦‚æœè°ƒè¯•å™¨æ­£å¸¸é€€å‡ºï¼Œåˆ™é»˜è®¤çš„ä¸­æ–­å¤„ç†ç¨‹åºå°†æ­£å¸¸è¿”å›ã€‚\nbreak-handler\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡ç¨‹ã€‚å½“å‰çš„ä¸­æ–­å¤„ç†ç¨‹åºç”±breakè°ƒç”¨ï¼Œå®ƒä¼ é€’å…¶å‚æ•°ã€‚æœ‰å…³é»˜è®¤ä¸­æ–­å¤„ç†ç¨‹åºçš„æè¿°ï¼Œè¯·å‚è§breakã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•ç¦ç”¨breaksã€‚\n(break-handler (lambda args (void))) (set-timer n)\nn å¿…é¡»ä¸ºéè´Ÿæ•´æ•°ã€‚å½“n ä¸ºéé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å¯åŠ¨ä¸€ä¸ªå†…éƒ¨è®¡æ—¶å™¨ï¼Œå…¶åˆå§‹å€¼ä¸ºnã€‚ç»è¿‡nä¸ªtickåï¼Œå°†å‘ç”Ÿè®¡æ—¶å™¨ä¸­æ–­ï¼Œä»è€Œå¯¼è‡´è®¡æ—¶å™¨ä¸­æ–­å¤„ç†ç¨‹åºè¢«è°ƒç”¨ã€‚tickä¸æ˜¯ç»Ÿä¸€çš„æ—¶é—´å•ä½ï¼Œè€Œæ˜¯åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºæ¯ä¸ªè¿‡ç¨‹è°ƒç”¨è¦å®Œæˆå¤šå°‘å·¥ä½œã€‚\nå½“nä¸ºé›¶æ—¶ï¼Œè®¾ç½®è®¡æ—¶å™¨å…³é—­è®¡æ—¶å™¨ã€‚\nengineæœºåˆ¶å»ºç«‹åœ¨è®¡æ—¶å™¨ä¸­æ–­ä¹‹ä¸Šï¼Œå› æ­¤ä¸åº”ä¸engineå…±åŒä½¿ç”¨ã€‚\n(register-signal-handler sig procedure)\nregister-signal-handlerç”¨äºä¸ºç»™å®šçš„åº•å±‚ä¿¡å·å»ºç«‹ä¿¡å·å¤„ç†ç¨‹åºã€‚ sigå¿…é¡»æ˜¯æ ‡è¯†æœ‰æ•ˆä¿¡å·çš„ç²¾ç¡®æ•´æ•°ï¼Œè¿‡ç¨‹åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚åœ¨æ³¨å†Œäº†ç»™å®šsignalçš„å¤„ç†ç¨‹åºä¹‹åï¼Œæ”¶åˆ°äº†ç»™å®šçš„signalä¼šè°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚signalç¼–å·ä¼šä¼ é€’ç»™è¯¥å¤„ç†ç¨‹åºï¼Œä»è€Œå…è®¸åŒä¸€å¤„ç†ç¨‹åºç”¨äºä¸åŒçš„ä¿¡å·ï¼ŒåŒæ—¶åŒºåˆ†å®ƒä»¬ã€‚\nä»¥è¿™ç§æ–¹å¼å¤„ç†çš„ä¿¡å·ç±»ä¼¼äºé”®ç›˜ä¸­æ–­ï¼Œå› ä¸ºåœ¨å°†ä¿¡å·ä¼ é€’åˆ°è¿›ç¨‹æ—¶ä¸ä¼šç«‹å³è°ƒç”¨å¤„ç†ç¨‹åºï¼Œè€Œæ˜¯åœ¨ä¿¡å·ä¼ é€’ååœ¨æŸä¸ªè¿‡ç¨‹è°ƒç”¨è¾¹ç•Œå¤„è°ƒç”¨è¯¥å¤„ç†ç¨‹åºã€‚å› æ­¤ï¼Œä¸ºå†…å­˜æ•…éšœï¼Œéæ³•æŒ‡ä»¤ç­‰å»ºç«‹å¤„ç†ç¨‹åºé€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºå¯¼è‡´æ•…éšœæˆ–éæ³•æŒ‡ä»¤çš„ä»£ç å°†åœ¨è°ƒç”¨å¤„ç†ç¨‹åºä¹‹å‰ç»§ç»­æ‰§è¡Œï¼ˆå¯èƒ½æ˜¯é”™è¯¯çš„ï¼‰ä¸€æ®µæ—¶é—´ã€‚\nå¦å¤–ï¼Œä»…åœ¨åŸºäºUnixçš„ç³»ç»Ÿä¸Šæ‰æ”¯æŒregister-signal-handlerã€‚\nç¯å¢ƒ ç¯å¢ƒæ˜¯åŒ…å«æ ‡è¯†ç¬¦ç»‘å®šçš„é¡¶çº§ï¼ˆfirst-classï¼‰å¯¹è±¡ã€‚å®ƒä»¬ç±»ä¼¼äºæ¨¡å—ï¼Œä½†æ˜¯ä¸æ¨¡å—ä¸åŒï¼Œå®ƒä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œæ“ä½œã€‚ç¯å¢ƒå¯ä»¥ä½œä¸ºevalï¼Œexpandä»¥åŠè¿‡ç¨‹çš„å®šä¹‰ï¼Œåˆ†é…æˆ–å¼•ç”¨é¡¶çº§å€¼çš„å¯é€‰å‚æ•°ã€‚\næœ‰å‡ ç§å†…ç½®ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¤åˆ¶ç°æœ‰ç¯å¢ƒæˆ–ä»ç°æœ‰ç¯å¢ƒä¸­é€‰æ‹©çš„ç»‘å®šæ¥åˆ›å»ºæ–°ç¯å¢ƒã€‚\nç¯å¢ƒå¯ä»¥æ˜¯å¯å˜çš„æˆ–ä¸å˜çš„ã€‚å¯å˜çš„ç¯å¢ƒå¯ä»¥ä½¿ç”¨æ–°çš„ç»‘å®šè¿›è¡Œæ‰©å±•ï¼Œå¯ä»¥ä¿®æ”¹å…¶ç°æœ‰ç»‘å®šï¼Œè¿˜å¯ä»¥åˆ†é…å…¶å˜é‡ã€‚ä¸å˜çš„ç¯å¢ƒä¸èƒ½ä»¥ä»»ä½•è¿™äº›æ–¹å¼è¿›è¡Œä¿®æ”¹ã€‚\nè”æƒ³ä¸€ä¸‹SICPä¸­å…³äºç¯å¢ƒçš„å†…å®¹ (environment? obj)\n(environment? (interaction-environment)) â‡’ #t (environment? \u0026#39;interaction-environment) â‡’ #f (environment? (copy-environment (scheme-environment))) â‡’ #t (environment? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #t (environment-mutable? env)\n(environment-mutable? (interaction-environment)) â‡’ #t (environment-mutable? (scheme-environment)) â‡’ #f (environment-mutable? (copy-environment (scheme-environment))) â‡’ #t (environment-mutable? (environment \u0026#39;(prefix (rnrs) $rnrs-))) â‡’ #f (scheme-environment)\nscheme-environmentè¿”å›ä¸€ä¸ªåŒ…å«åˆå§‹é¡¶çº§ç»‘å®šçš„ç¯å¢ƒã€‚è¯¥ç¯å¢ƒå¯¹åº”äºSchemeæ¨¡å—ã€‚æ­¤è¿‡ç¨‹è¿”å›çš„ç¯å¢ƒæ˜¯ä¸å¯å˜çš„ã€‚\n(define cons 3) (top-level-value \u0026#39;cons (scheme-environment)) â‡’ #\u0026lt;procedure cons\u0026gt; (set-top-level-value! \u0026#39;cons 3 (scheme-environment)) â‡’ exception (copy-environment env) | (copy-environment env mutable?) | (copy-environment env mutable? syms)\ncopy-environmentè¿”å›envçš„å‰¯æœ¬ï¼Œå³åŒ…å«ä¸env ç›¸åŒç»‘å®šçš„æ–°ç¯å¢ƒã€‚mutable? å¦‚æœä¸ºtrueï¼Œåˆ™è¯¥environmentæ˜¯å¯å˜çš„ï¼Œåä¹‹åˆ™ä¸å¯å˜ï¼›\nä»env å¤åˆ¶åˆ°æ–°ç¯å¢ƒçš„ç»‘å®šé›†ç”±syms ç¡®å®šï¼Œå…¶é»˜è®¤å€¼ä¸ºï¼ˆenvironment-symbols envï¼‰ã€‚æ¯ä¸ªsyms å…ƒç´ çš„ç»‘å®šï¼ˆå¦‚æœæœ‰ï¼‰éƒ½è¢«å¤åˆ¶åˆ°æ–°ç¯å¢ƒä¸­ï¼Œå¹¶ä¸”æ–°ç¯å¢ƒä¸­ä¸å­˜åœ¨å…¶ä»–ç»‘å®šã€‚\nåœ¨å½“å‰çš„å®ç°ä¸­ï¼Œæ°¸è¿œä¸ä¼šæ”¶é›†ç¯å¢ƒä½¿ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œå› æ­¤é‡å¤ä½¿ç”¨å¤åˆ¶ç¯å¢ƒæœ€ç»ˆå°†å¯¼è‡´ç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚\n(define e (copy-environment (scheme-environment))) (eval \u0026#39;(define cons +) e) (eval \u0026#39;(cons 3 4) e) â‡’ 7 (eval \u0026#39;(cons 3 4) (scheme-environment)) â‡’ (3 . 4) (environment-symbols env)\næ­¤è¿‡ç¨‹è¿”å›ä»£è¡¨ç¯å¢ƒenvä¸­ç»‘å®šçš„æ ‡è¯†ç¬¦çš„ç¬¦å·åˆ—è¡¨ã€‚å®ƒä¸»è¦ç”¨äºæ„å»ºè¦ä»ä¸€ç§ç¯å¢ƒå¤åˆ¶åˆ°å¦ä¸€ç§ç¯å¢ƒçš„ç¬¦å·åˆ—è¡¨ã€‚\n(define listless-environment (copy-environment (scheme-environment) #t (remq \u0026#39;list (environment-symbols (scheme-environment))))) (eval \u0026#39;(let ([x (cons 3 4)]) x) listless-environment) â‡’ (3 . 4) (eval \u0026#39;(list 3 4) listless-environment) â‡’ exception ç¼–è¯‘ã€æ±‚å€¼å’ŒåŠ è½½ (eval obj) | (eval obj env)\nevalå°†obj è§†ä¸ºè¡¨è¾¾å¼çš„è¡¨ç¤ºå½¢å¼ã€‚å®ƒåœ¨ç¯å¢ƒenvä¸­è®¡ç®—è¡¨è¾¾å¼å¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœæœªæä¾›ä»»ä½•ç¯å¢ƒï¼Œåˆ™é»˜è®¤ä¸ºç”±äº¤äº’ç¯å¢ƒè¿”å›çš„ç¯å¢ƒã€‚ å•å‚æ•°æ±‚å€¼æ˜¯Chez Schemeçš„æ‰©å±•ã€‚å½“ç¯å¢ƒå¯å˜æ—¶ï¼ŒChez Schemeè¿˜å…è®¸objè¡¨ç¤ºéè¡¨è¾¾å½¢å¼ï¼Œæ¯”å¦‚ä¸€ä¸ªdefinitionã€‚ Chez Schemeè¿˜å…è®¸objä½œä¸ºä¸€ä¸ªannotationï¼Œé»˜è®¤æ±‚å€¼ç¨‹åºåˆ©ç”¨æ³¨é‡Šå°†æºæ–‡ä»¶ä¿¡æ¯åˆå¹¶åˆ°é”™è¯¯æ¶ˆæ¯ä¸­ï¼Œå¹¶å°†æºæ–‡ä»¶ä¿¡æ¯ä¸ç¼–è¯‘åçš„ä»£ç ç›¸å…³è”ã€‚\nåœ¨Chez Schemeä¸­ï¼Œevalå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŒ…è£…å™¨ï¼Œä»…å°†å…¶å‚æ•°ä¼ é€’ç»™å½“å‰æ±‚å€¼å™¨ï¼ˆè¯·å‚é˜…current-evalï¼‰ã€‚é»˜è®¤çš„è¯„ä¼°å™¨æ˜¯compileï¼Œå®ƒé€šè¿‡å½“å‰çš„æ‰©å±•å™¨ï¼ˆå‚é˜…current-expandï¼‰æ‰©å±•è¡¨è¾¾å¼ï¼Œå¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œæ‰§è¡Œç”Ÿæˆçš„ä»£ç ï¼Œå¹¶è¿”å›å…¶å€¼ã€‚å¦‚æœå­˜åœ¨ç¯å¢ƒå‚æ•°env ï¼Œåˆ™compileå°†å…¶ä¼ é€’ç»™å½“å‰çš„æ‰©å±•å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ºsc-expandã€‚\n(compile obj) | (compile obj env)\nobj å¯ä»¥ä¸ºSchemeè¡¨è¾¾å¼ï¼Œåœ¨æŒ‡å®šçš„ç¯å¢ƒï¼ˆæˆ–äº¤äº’ç¯å¢ƒï¼Œå¦‚æœæœªæä¾›ç¯å¢ƒï¼‰ä¸­ä½¿ç”¨å½“å‰æ‰©å±•å™¨ï¼ˆcurrent-expandçš„å€¼ï¼‰è¿›è¡Œæ‰©å±•ï¼‰ï¼Œç¼–è¯‘ä¸ºæœºå™¨ä»£ç ï¼Œç„¶åæ‰§è¡Œã€‚ compileæ˜¯current-evalå‚æ•°çš„é»˜è®¤å€¼ã€‚\n(compile \u0026#39;(cons 1 2)) =\u0026gt; (1 . 2) (interpret obj) | (interpret obj env)\nè§£é‡Šç±»ä¼¼äºç¼–è¯‘ï¼Œåªæ˜¯è¡¨è¾¾å¼æ˜¯è§£é‡Šçš„è€Œä¸æ˜¯ç¼–è¯‘çš„ï¼ˆthe expression is interpreted rather than compiledï¼‰ã€‚è§£é‡Šå¯ä»¥ç”¨ä½œç¼–è¯‘çš„æ›¿ä»£å“ï¼Œä½†æœ‰ä»¥ä¸‹è­¦å‘Šï¼š\nè§£é‡Šåçš„ä»£ç è¿è¡Œé€Ÿåº¦å¤§å¤§é™ä½ è§£é‡Šåçš„ä»£ç ä¸ä¼šç”Ÿæˆæ£€æŸ¥å™¨ä¿¡æ¯ï¼Œå› æ­¤æ£€æŸ¥å™¨å¯¹äºè§£é‡Šçš„ä»£ç ä¸å¦‚åœ¨ç¼–è¯‘çš„ä»£ç ä¸­æœ‰ç”¨ã€ æ— æ³•è§£é‡Šå¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼ï¼Œå› æ­¤è§£é‡Šå™¨éœ€è¦ä¸ºæ‰€æœ‰å¤–éƒ¨è¿‡ç¨‹è¡¨è¾¾å¼è°ƒç”¨ç¼–è¯‘å™¨ï¼ˆè¿™æ˜¯é€æ˜å®Œæˆçš„ï¼‰ å½“æ±‚å€¼å½¢å¼è¿è¡Œæ—¶é—´è¾ƒçŸ­æ—¶ï¼Œè§£é‡Šæœ‰æ—¶æ¯”ç¼–è¯‘æ›´å¿«ï¼Œå› ä¸ºå®ƒé¿å…äº†åœ¨æ±‚å€¼ä¹‹å‰é€šè¿‡ç¼–è¯‘å®Œæˆçš„æŸäº›å·¥ä½œã€‚\n(load path) | (load path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚ loadè¯»å–å¹¶æ±‚å€¼path æŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œloadä½¿ç”¨evalæ±‚å€¼æºæ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-proc ï¼Œåˆ™loadå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-proc å¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\neval-procå‚æ•°æœ‰åŠ©äºå®ç°åµŒå…¥çš„ç±»ä¼¼äºSchemeçš„è¯­è¨€ï¼Œå¹¶æœ‰åŠ©äºä½¿ç”¨ç”¨äºSchemeç¨‹åºçš„æ›¿ä»£è¯„ä¼°æœºåˆ¶ã€‚ eval-procä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–ç”¨é€”ã€‚ä¾‹å¦‚ï¼Œ\n(load \u0026#34;myfile.ss\u0026#34; (lambda (x) (pretty-print (if (annotation? x) (annotation-stripped x) x)) (newline) (eval x))) å¯¹æ¯ä¸€ä¸ªè¡¨è¾¾å¼æ±‚å€¼ä¹‹å‰ä½¿ç”¨pretty-printæ‰“å°ã€‚\nå‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-library path) | (load-library path eval-proc)\nload-libraryä¸loadç›¸åŒï¼Œé™¤äº†å®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rsä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒï¼chezscheme**è¦†ç›–\n(load-program path) | (load-program path eval-proc)\npath å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚åŠ è½½ç¨‹åºè¯»å–å¹¶æ±‚å€¼pathæŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹ã€‚ è¯¥æ–‡ä»¶å¯èƒ½åŒ…å«æºä»£ç æˆ–ç›®æ ‡ä»£ç ã€‚å¦‚æœåŒ…å«æºä»£ç ï¼Œåˆ™åŠ è½½ç¨‹åºä¼šå°†ä»£ç ä»¥é¡¶çº§ç¨‹åºå½¢å¼åŒ…è£…èµ·æ¥ï¼Œä»¥ä¾¿å°†æ–‡ä»¶çš„å†…å®¹è§†ä¸ºRNRSé¡¶çº§ç¨‹åºï¼ˆSchemeç¼–ç¨‹è¯­è¨€ï¼Œç¬¬4ç‰ˆçš„10.3èŠ‚ï¼‰ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ è½½ç¨‹åºä½¿ç”¨evalæ±‚å€¼æ–‡ä»¶ä¸­æ‰¾åˆ°çš„æ¯ä¸ªæºè¡¨è¾¾å¼ã€‚å¦‚æœæŒ‡å®šäº†eval-procï¼Œåˆ™è£…å…¥ç¨‹åºå°†ä½¿ç”¨æ­¤è¿‡ç¨‹ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦è¯„ä¼°çš„è¡¨è¾¾å¼ã€‚ä¼ é€’ç»™eval-procçš„è¡¨è¾¾å¼å¯èƒ½æ˜¯æ³¨é‡Šæˆ–æœªæ³¨é‡Šçš„å€¼ã€‚ å‚æ•°source-directorysç¡®å®šäº†æœç´¢ç›®å½•ï¼Œä»¥æœç´¢æœªç”±ç»å¯¹è·¯å¾„åæ ‡è¯†çš„æºæ–‡ä»¶ã€‚\n(load-compiled-from-port input-port)\nload-compiled-from-portè¯»å–å¹¶æ±‚å€¼æ¥è‡ªinput-portçš„å¯¹è±¡ä»£ç çš„å†…å®¹ï¼Œè¿™äº›input-portæ˜¯äº‹å…ˆç”±è¯¸å¦‚compile-file, compile-script, compile-library, compile-to-portåˆ›å»ºçš„ è¿”å›å€¼æ˜¯æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œè¯¥è¡¨è¾¾å¼çš„ç¼–è¯‘å½¢å¼ä¸ºinput-portã€‚å¦‚æœinput-portä¸ºç©ºï¼Œåˆ™ç»“æœå€¼æœªæŒ‡å®šã€‚\n(compile-file input-filename) | (compile-file input-filename output-filename)\ninput-filename å’Œoutput-filename å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚input-filename å¿…é¡»æ˜¯å·²å­˜åœ¨çš„å¯è¯»æ–‡ä»¶ã€‚å®ƒå¿…é¡»åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªæºè¡¨è¾¾å¼çš„åºåˆ—ï¼›å¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œåˆ™ç¼–è¯‘æ–‡ä»¶ä¼šå¼•å‘æ¡ä»¶ç±»å‹ä¸ºï¼†syntaxçš„å¼‚å¸¸ã€‚\næ­£å¸¸æ±‚å€¼è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šç¼–è¯‘å’Œæ‰§è¡Œã€‚ compile-fileå¯¹æ•´ä¸ªæºæ–‡ä»¶æ‰§è¡Œç¼–è¯‘è¿‡ç¨‹ï¼Œä»è€Œç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚éšååŠ è½½ç›®æ ‡æ–‡ä»¶ï¼ˆè¯·å‚è§loadï¼‰æ—¶ï¼Œä¸éœ€è¦ç¼–è¯‘è¿‡ç¨‹ï¼Œå¹¶ä¸”æ–‡ä»¶åŠ è½½é€šå¸¸å¿«å‡ å€ã€‚\n(compile-script input-filename) | (compile-script input-filename output-filename)\ncompile-scriptä¸compile-fileç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºï¼Œå®ƒä¼šä»æºæ–‡ä»¶å¤åˆ¶å¼€å¤´çš„**#!è¡Œåˆ°ç›®æ ‡æ–‡ä»¶ï¼ŒåŒæ—¶è¯¥è¡Œä¸ä¼šè¢«å‹ç¼©ï¼Œå°½ç®¡å‚æ•°compile-compressed**è¢«è®¾ç½®ä¸º#tï¼Œå…¶ä»–ä»£ç ä¼šè¢«å‹ç¼©ï¼Œè¿™æ ·ä¼šä¿è¯æ“ä½œç³»ç»Ÿå¯ä»¥æ­£ç¡®åœ°è§£é‡Šã€‚\ncompile-scriptå…è®¸ä»æºè„šæœ¬åˆ›å»ºå·²ç¼–è¯‘çš„è„šæœ¬æ–‡ä»¶ï¼Œä»¥å‡å°‘è„šæœ¬åŠ è½½æ—¶é—´ã€‚ä¸æºä»£ç è„šæœ¬ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨**\u0026ndash;script**å‘½ä»¤è¡Œé€‰é¡¹è¿è¡Œå·²ç¼–è¯‘çš„è„šæœ¬ã€‚\n(compile-library input-filename) | (compile-library input-filename oiutput-filename)\ncompile-libraryä¸compile-fileç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒä¼šå°†è¾“å…¥æ–‡ä»¶è§†ä¸ºç”±éšå¼**ï¼ƒ!r6rs**ä½œä¸ºå‰ç¼€ã€‚è¿™æœ‰æ•ˆåœ°ç¦ç”¨äº†æ‰€æœ‰éR6RSè¯æ³•è¯­æ³•ï¼Œé™¤ééšåè¢«ï¼ƒ!chezschemeè¦†ç›–ã€‚\n(compile-program input-filename) | (compile-program input-filename output-filename)\ncompile-programç±»ä¼¼äºcompile-scriptï¼Œä½†ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒå®ç°äº†RNRSé¡¶çº§ç¨‹åºçš„è¯­ä¹‰ï¼Œè€Œcompile-scriptåˆ™å®ç°äº†äº¤äº’å¼é¡¶çº§ç¨‹åºçš„è¯­ä¹‰ã€‚ä¸é€šè¿‡compile-fileæˆ–compile-scriptè¿›è¡Œç¼–è¯‘ç›¸æ¯”ï¼Œç”Ÿæˆçš„å·²ç¼–è¯‘ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚\ncompile-programè¿”å›ç”±ç¼–è¯‘çš„é¡¶å±‚ç¨‹åºç›´æ¥è°ƒç”¨çš„åº“çš„åˆ—è¡¨ï¼Œä¸åŒ…æ‹¬ï¼ˆrnrsï¼‰å’Œï¼ˆchezschemeï¼‰ä¹‹ç±»çš„å†…ç½®åº“\n(compile-whole-program input-filename output-filename) | (compile-whole-program input-filename output-filename libs-visible?)\ncompile-whole-programæ¥å—ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºåç§°è¾“å…¥ï¼Œè¯¥æ–‡ä»¶åä¸ºé¡¶çº§ç¨‹åºå‘½åä¸ºâ€œ whole program optimizationâ€ï¼ˆwpoï¼‰æ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåŒ…å«è¯¥ç¨‹åºåŠå…¶æ‰€ä¾èµ–çš„æ¯ä¸ªåº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œå‰ææ˜¯éœ€è¦ä¸€ä¸ªå¯ä»¥æ‰¾åˆ°åº“çš„wpoæ–‡ä»¶ã€‚\nå¦‚æœwpoæ–‡ä»¶æ‰¾ä¸åˆ°æ‰€éœ€åº“ï¼Œä½†å¯ä»¥æ‰¾åˆ°è¯¥åº“çš„ç›®æ ‡æ–‡ä»¶ï¼Œåˆ™è¯¥åº“ä¸ä¼šåˆå¹¶åˆ°ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ã€‚è¿™äº›åº“å°†åœ¨è¿è¡Œæ—¶åŠ è½½ã€‚ compile-whole-programè¿”å›è¿™äº›åº“çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„åº“ï¼Œåˆ™ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶æ˜¯è‡ªåŒ…å«çš„ï¼Œå¹¶ä¸”compile-whole-programè¿”å›ç©ºåˆ—è¡¨ã€‚\nå¦‚æœlibs-visible? è®¾ç½®ä¸ºéfalseï¼Œåˆ™åº“åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶æ˜¯å¯è§çš„ï¼ˆä¾›environmentå’Œevalä½¿ç”¨ï¼‰ï¼Œä»»ä½•åˆå¹¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­å¹¶åœ¨è¿è¡Œæ—¶ä¿ç•™ä¸‹æ¥çš„ç›®æ ‡æ–‡ä»¶æ‰€è¦æ±‚çš„åº“éƒ½æ˜¯å¯è§çš„ã€‚\nå½“generate-wpo-fileså‚æ•°è®¾ç½®ä¸º#tæ—¶ï¼Œè¿‡ç¨‹compile-fileï¼Œcompile-programï¼Œcompile-libraryï¼Œcompile-scriptå’Œcompile-whole-libraryä¼šç”Ÿæˆwpoæ–‡ä»¶ä»¥åŠæ™®é€šç›®æ ‡æ–‡ä»¶ã€‚ ï¼ˆé»˜è®¤å€¼ä¸º#fï¼‰ã€‚å¦å¤–å¦‚æœä¼ é€’å¯é€‰çš„wpoç«¯å£æ—¶ï¼Œcompile-portå’Œcompile-to-portä¹Ÿä¼šè¿™æ ·åšã€‚\n(compile-whole-library input-filename output-filename)\ncompile-whole-libraryç±»ä¼¼äºcompile-whole-programï¼Œä¸åŒä¹‹å¤„åœ¨äºinput-filenameå¿…é¡»ä¸ºåº“æŒ‡å®šä¸€ä¸ªwpoæ–‡ä»¶ï¼Œæ‰€æœ‰åº“è‡ªåŠ¨æ˜¾ç¤ºï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„wpoæ–‡ä»¶ï¼ˆå½“generate-wpo-filesä¸º#tæ—¶ï¼‰ä»¥åŠç”¨äºç”Ÿæˆçš„åº“ç»„åˆçš„ç›®æ ‡æ–‡ä»¶ã€‚\n(compile-port input-port output-port) | (compile-port input-port output-port sfd) | (compile-port input-port output-port sfd wpo-port)\ninput-port å¿…é¡»æ˜¯æ–‡æœ¬è¾“å…¥ç«¯å£ã€‚out-port å’Œwpo-portï¼ˆå¦‚æœå­˜åœ¨ï¼‰å¿…é¡»æ˜¯äºŒè¿›åˆ¶è¾“å‡ºç«¯å£ã€‚å¦‚æœå­˜åœ¨sfd ,å¿…é¡»æ˜¯æºæ–‡ä»¶æè¿°ç¬¦ã€‚\n(make-boot-file output-filename base-boot-list input-filename \u0026hellip;)\næ‰€æœ‰å‚æ•°éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚\nmake-boot-fileå°†å¼•å¯¼æ ‡å¤´ï¼ˆboot headerï¼‰å†™å…¥ä»¥output-filename å‘½åçš„æ–‡ä»¶ï¼Œç„¶åä¾æ¬¡å†™å…¥æ¯ä¸ªinput-filename çš„ç›®æ ‡ä»£ç ã€‚å¦‚æœå°šæœªç¼–è¯‘è¾“å…¥æ–‡ä»¶ï¼Œmake-boot-fileå°†åœ¨å¯¹å…¶è¿›è¡Œç¼–è¯‘ã€‚\nå¼•å¯¼æ–‡ä»¶é€šè¿‡\u0026ndash;bootæˆ–-bå‘½ä»¤è¡Œé€‰é¡¹æ˜¾å¼åŠ è½½ï¼Œæˆ–åŸºäºå¯æ‰§è¡Œæ–‡ä»¶çš„åç§°éšå¼åŠ è½½ã€‚\n(make-boot-header output-filename base-boot1 base-boot2\u0026hellip;)\nè¯¥è¿‡ç¨‹å·²åŒ…å«åœ¨make-boot-fileä¸­ï¼Œå¹¶æä¾›äº†å‘åå…¼å®¹æ€§ã€‚\n(make-boot-header output-filename base-boot1 base-boot2 \u0026hellip;) ç­‰ä»·äºï¼š (make-boot-file output-filename â€™(base-boot1 base-boot2 \u0026hellip;))\næºç›®å½•å’Œæ–‡ä»¶ source-directories\nsource-directoriesçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²éƒ½å‘½åä¸€ä¸ªç›®å½•è·¯å¾„ã€‚å½“é€šè¿‡load, load-library, load-program, include, visit, or revisitåœ¨äº¤äº’å¼æ£€æŸ¥å™¨ä¸­å‘ç”Ÿè¯­æ³•é”™è¯¯æˆ–æ‰“å¼€æºæ–‡ä»¶æ—¶ï¼Œsource-directoryç¡®å®šç”¨äºæœç´¢æºæ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶çš„ç›®å½•é›†ã€‚\né»˜è®¤å€¼ä¸ºåˆ—è¡¨ï¼ˆâ€œ.â€ï¼‰ï¼Œè¿™æ„å‘³ç€ä»…åœ¨å½“å‰ç›®å½•ä¸­æˆ–ç›¸å¯¹äºå½“å‰ç›®å½•æ‰èƒ½æ‰¾åˆ°æºæ–‡ä»¶ï¼Œé™¤éä½¿ç”¨ç»å¯¹è·¯å¾„å‘½åã€‚\n(with-source-path who name procedure)\nè¿‡ç¨‹with-source-pathä¾æ¬¡æœç´¢å½“å‰æºç›®å½•è·¯å¾„ï¼Œä»¥æŸ¥æ‰¾å…·æœ‰æŒ‡å®šåç§°çš„æ–‡ä»¶ï¼Œå¹¶åœ¨ç»“æœä¸Šè°ƒç”¨è¿‡ç¨‹ã€‚å¦‚æœæœªæ‰¾åˆ°è¿™æ ·çš„æ–‡ä»¶ï¼Œåˆ™å¼•å‘**\u0026amp;assertionå’Œ\u0026amp;whoå¼‚å¸¸ï¼Œ\u0026amp;who**çš„å€¼ä¸ºwho çš„å€¼\nå¦‚æœname æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ä»¥./ï¼ˆWindowsä¸‹æ˜¯./ï¼‰ï¼Œæˆ–è€…../ï¼ˆWindowsä¸‹æ˜¯..\\ï¼‰ï¼Œæˆ–è€…æºç›®å½•åˆ—è¡¨ä¸­åªåŒ…å«â€œ.â€ï¼Œæˆ–è€…é»˜è®¤å€¼ \u0026ldquo;\u0026quot;ï¼Œç›¸å½“äº \u0026ldquo;.\u0026quot;ï¼Œä¸æ‰§è¡Œæœç´¢å¹¶è¿”å›nameã€‚\nwho å¿…é¡»æ˜¯ç¬¦å·ï¼Œname å¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œprocedure åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚\nä»¥ä¸‹ç¤ºä¾‹å‡å®šæ–‡ä»¶â€œ pieâ€å­˜åœ¨äºç›®å½•â€œ ../spamâ€ä¸­ï¼Œä½†ä¸åœ¨â€œ ../hamâ€æˆ–å½“å‰ç›®å½•ä¸­ã€‚\n(define find-file (lambda (fn) (with-source-path \u0026#39;find-file fn values))) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ exception in find-file: pie not found (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;pie\u0026#34;) â‡’ \u0026#34;../spam/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;/pie\u0026#34;) â‡’ \u0026#34;/pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../ham\u0026#34;)) (find-file \u0026#34;./pie\u0026#34;) â‡’ \u0026#34;./pie\u0026#34; (source-directories \u0026#39;(\u0026#34;.\u0026#34; \u0026#34;../spam\u0026#34;)) (find-file \u0026#34;../pie\u0026#34;) â‡’ \u0026#34;../ham/pie\u0026#34; ç¼–è¯‘å™¨ç®¡ç† optimize-level\nè¯¥å‚æ•°å¯ä»¥æ˜¯0ï¼Œ1ï¼Œ2ï¼Œ3è¿™4ä¸ªå€¼ä¸­çš„ä¸€ä¸ªã€‚\nç†è®ºä¸Šï¼Œæ­¤å‚æ•°æ§åˆ¶ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¼˜åŒ–é‡ã€‚ å®é™…ä¸Šï¼Œå®ƒåªæ˜¯é—´æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºä¼˜åŒ–çº§åˆ«3ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œä¸å®‰å…¨â€ä»£ç ï¼‰ä¸ä¼˜åŒ–çº§åˆ«0-2ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆâ€œå®‰å…¨â€ä»£ç ï¼‰ä¹‹é—´ã€‚ å®‰å…¨ä»£ç ä¼šæ‰§è¡Œå®Œæ•´ç±»å‹å’ŒèŒƒå›´æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼Œå°è¯•åº”ç”¨éè¿‡ç¨‹ï¼Œå°è¯•å¯¹non-pairçš„caræ“ä½œæˆ–å°è¯•å¼•ç”¨å‘é‡çš„æœ«å°¾ï¼Œå‡ä¼šå¯¼è‡´ å¼•å‘å¼‚å¸¸ã€‚ å¯¹äºä¸å®‰å…¨çš„ä»£ç ï¼Œç›¸åŒçš„æƒ…å†µå¯èƒ½ä¼šå¯¼è‡´æ— æ•ˆçš„å†…å­˜å¼•ç”¨ï¼ŒSchemeå †æŸåï¼ˆè¿™å¯èƒ½åœ¨ä»¥åå¼•èµ·çœ‹ä¼¼æ— å…³çš„é—®é¢˜ï¼‰ï¼Œç³»ç»Ÿå´©æºƒæˆ–å…¶ä»–ä¸è‰¯è¡Œä¸ºã€‚ä¸å®‰å…¨çš„ä»£ç é€šå¸¸ä¼šæ›´å¿«ï¼Œä½†æ˜¯åº”è¯¥è°¨æ…ä½¿ç”¨ä¼˜åŒ–çº§åˆ«3ï¼Œå¹¶ä¸”ä»…è¿ç”¨åœ¨å¿…é¡»å°½å¿«è¿è¡Œä¸”ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ä»£ç ä¸­ã€‚\nå°½ç®¡ç¼–è¯‘å™¨ä¸ºä¼˜åŒ–0è‡³2çº§ç”Ÿæˆäº†ç›¸åŒçš„ä»£ç ï¼Œä½†å¦‚æœéœ€è¦ï¼Œç”¨æˆ·å®šä¹‰çš„å®è½¬æ¢å™¨å¯ä»¥åŒºåˆ†ä¸åŒçš„çº§åˆ«ã€‚\nä¸€ç§ä½¿ç”¨ä¼˜åŒ–çº§åˆ«çš„æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ–‡ä»¶ä¸Šï¼Œå¼ºåˆ¶ä½¿ç”¨eval-whenã€‚ ä¾‹å¦‚:\n(eval-when (compile) (optimize-level 3)) ä¹Ÿå¯ä»¥é€šè¿‡\u0026ndash;optimize-levelå‘½ä»¤è¡Œé€‰é¡¹è®¾ç½®ä¼˜åŒ–çº§åˆ«ã€‚æ­¤é€‰é¡¹å¯¹äºé€šè¿‡\u0026ndash;programå‘½ä»¤è¡Œé€‰é¡¹åœ¨ä¼˜åŒ–çº§åˆ«3è¿è¡ŒRNRSé¡¶å±‚ç¨‹åºç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸ºeval-whenå¯¹RNRSé¡¶å±‚ç¨‹åºæ— æ•ˆã€‚\n($primitive variable) | ($primitive 2 variable) | ($primitive 3 variable)\nvariable å¿…é¡»æ˜¯ä¸€ä¸ªåŸå§‹procedureçš„åå­—ã€‚** $primitive**è¯­æ³•å½¢å¼å…è®¸ä»¥å•ä¸ªåŸå§‹å¼•ç”¨çš„ç²’åº¦æ§åˆ¶ä¼˜åŒ–çº§åˆ«ï¼Œå¹¶ä¸”å®ƒå¯ä»¥ç”¨äºè®¿é—®åŸå§‹å€¼ã€‚\nè¡¨è¾¾å¼ï¼ˆ$primitive variableï¼‰å¯ä»¥ç¼©å†™ä¸º**#%variable**ã€‚\n(#%car â€™(a b c)) â‡’ a (let ([car cdr]) (car \u0026#39;(a b c))) â‡’ (b c) (let ([car cdr]) (#%car \u0026#39;(a b c))) â‡’ a (begin (set! car cdr) (#%car \u0026#39;(a b c))) â‡’ a debug-level\nè¯¥å‚æ•°å¯ä»¥é‡‡ç”¨0ã€1ã€2å’Œ3è¿™å››ä¸ªå€¼ä¹‹ä¸€ã€‚å®ƒç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ä¿ç•™è°ƒè¯•ä¿¡æ¯çš„é‡è¦æ€§ï¼Œå…¶ä¸­0çš„é‡è¦æ€§æœ€ä½ï¼Œè€Œ3çš„é‡è¦æ€§æœ€é«˜ã€‚ é»˜è®¤å€¼æ˜¯1ã€‚ä»9.0ç‰ˆå¼€å§‹ï¼Œå®ƒä»…ç”¨äºç¡®å®šåœ¨éå°¾éƒ¨ä½ç½®é‡åˆ°çš„å¼•èµ·é”™è¯¯çš„è°ƒç”¨æ˜¯å¦è¢«è§†ä¸ºåœ¨å°¾éƒ¨ä½ç½®ï¼ˆå› æ­¤ï¼Œå¯¼è‡´è°ƒç”¨è€…çš„å¸§ä¸å‡ºç°åœ¨å †æ ˆå›æº¯ä¸­ï¼‰ã€‚ è¿™å‘ç”Ÿåœ¨ä½äº2çš„è°ƒè¯•çº§åˆ«ã€‚\næ¦‚è¦åˆ†æProfiling ChezSchemeæ”¯æŒä¸¤ç§ç±»å‹çš„é…ç½®æ–‡ä»¶ï¼šæºä»£ç æ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æã€‚\nå¯ç”¨æºæ¦‚è¦åˆ†æåï¼Œç¼–è¯‘å™¨ä¼šå¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œä»¥è®¡ç®—æ¯ä¸ªæºä»£ç è¡¨è¾¾å¼çš„æ‰§è¡Œæ¬¡æ•°ã€‚ è¯¥ä¿¡æ¯å¯ä»¥HTMLæ ¼å¼æ˜¾ç¤ºæˆ–æ‰“åŒ…åœ¨åˆ—è¡¨ä¸­ï¼Œä»¥è¿›è¡Œä»»æ„ç”¨æˆ·å®šä¹‰çš„å¤„ç†ã€‚ ä¹Ÿå¯ä»¥å°†å…¶è½¬å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†åŠ è½½åˆ°ç¼–è¯‘å™¨çš„æ¦‚è¦åˆ†æä¿¡æ¯æ•°æ®åº“ä¸­ï¼Œä»¥ç”¨äºæºä»£ç çº§ä¼˜åŒ–ã€‚\næºä»£ç æ¦‚è¦åˆ†æè‡³å°‘åŒ…å«ä¸‹é¢ä¸€äº›æ­¥éª¤ï¼š\nç¼–è¯‘ä»£ç ä¸”å¼€å¯source profiling è¿è¡Œç¼–è¯‘åçš„ä»£ç ç”Ÿæˆæºä»£ç æ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä¸” è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·æºæˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨æºæ¦‚è¦åˆ†æã€‚ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ï¼š\nprofile-dump-html ä»¥HTMLæ ¼å¼æ˜¾ç¤ºï¼Œä»¥ä¾¿ç¨‹åºå‘˜å¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ä½¿ç”¨å½©è‰²ç¼–ç ç³»ç»Ÿæ‰§è¡Œæ¯ä¸ªè¡¨è¾¾å¼çš„é¢‘ç‡ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥è½»æ¾å‘ç°â€œçƒ­ç‚¹â€ profile-dump-list ä»¥é€‚åˆç”¨æˆ·å®šä¹‰çš„åå¤„ç†çš„å½¢å¼; profile-dump ä»¥é€‚åˆäºé€šè¿‡ä¸Šè¿°æ–¹æ³•ä¹‹ä¸€æˆ–æŸäº›è‡ªå®šä¹‰æ–¹å¼è¿›è¡Œç¦»çº¿å¤„ç†çš„å½¢å¼ï¼Œæˆ– profile-dump-data ä»¥é€‚åˆåŠ è½½åˆ°ç¼–è¯‘å™¨æ•°æ®åº“ä¸­çš„å½¢å¼ã€‚\nç”±profile-dump-dataè½¬å‚¨çš„æ¦‚è¦åˆ†æä¿¡æ¯é€šè¿‡profile-load-dataåŠ è½½åˆ°ç¼–è¯‘å™¨çš„profilingæ•°æ®åº“ä¸­ã€‚ é™¤éé€šè¿‡profile-dump-dataæ˜¾å¼è½¬å‚¨å¹¶é€šè¿‡profile-load-dataåŠ è½½ï¼Œå¦åˆ™åˆ†æä¿¡æ¯å¯¹ç¼–è¯‘å™¨ä¸å¯ç”¨ã€‚\nå½“ä½¿ç”¨å—æ¦‚è¦æ–‡ä»¶ä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œæ­¥éª¤æ˜¯ç›¸ä¼¼çš„ï¼š\nç¼–è¯‘ä»£ç å¹¶å¼€å¯block profiling è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ è½¬å‚¨æ¦‚è¦åˆ†æä¿¡æ¯ åŠ è½½æ¦‚è¦ä¿¡æ¯ï¼Œä¸” é‡æ–°ç¼–è¯‘ä»£ç  é€šè¿‡å°†å‚æ•°compile-profileè®¾ç½®ä¸ºç¬¦å·å—æˆ–å¸ƒå°”å€¼#tï¼Œå¯ä»¥å¯ç”¨å—åˆ†æã€‚ æ¦‚è¦æ–‡ä»¶ä¿¡æ¯å¿…é¡»é€šè¿‡profile-dump-dataè½¬å‚¨ï¼Œå¹¶é€šè¿‡profile-load-dataåŠ è½½ã€‚ ä¸æºé…ç½®æ–‡ä»¶ä¿¡æ¯ä¸€æ ·ï¼Œå—é…ç½®æ–‡ä»¶ä¿¡æ¯å¯ä»¥ä¸è½¬å‚¨ä¿¡æ¯çš„åŠ è½½è¿‡ç¨‹ç›¸åŒæˆ–ä¸åŒã€‚\nå¯¹äºå—ä¼˜åŒ–ï¼Œè¦é‡æ–°ç¼–è¯‘çš„ä»£ç å¿…é¡»ç›¸åŒã€‚ é€šå¸¸ï¼Œè¿™æ„å‘³ç€æ‰€æ¶‰åŠçš„æ–‡ä»¶å¿…é¡»æœªç»ä¿®æ”¹ï¼Œå¹¶ä¸”å…¶ä»–ä»»ä½•æ›´æ”¹éƒ½ä¸ä¼šé—´æ¥å½±å“ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ã€‚\nå‡ºäºåŒæ ·çš„åŸå› ï¼Œå½“è¦åŒæ—¶ä½¿ç”¨æºæ¦‚è¦åˆ†æå’Œå—æ¦‚è¦åˆ†æä¿¡æ¯è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œå¿…é¡»å…ˆæ”¶é›†å¹¶åŠ è½½æºä¿¡æ¯ï¼Œç„¶åå†è¿è¡Œæ¶‰åŠå—æ¦‚è¦åˆ†æçš„ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡ç¼–è¯‘ã€‚ å³ï¼Œå¿…é¡»ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š\n1. ç¼–è¯‘ä»£ç å¹¶èµ·å¼€æºä»£ç æ¦‚è¦åˆ†æ 2. è¿è¡Œä»£ç ç”Ÿæˆsource-profilingä¿¡æ¯ 2. è½¬å‚¨source-profiling 3. åŠ è½½source-profiling 3. é‡æ–°ç¼–è¯‘ä»£ç ï¼Œå¹¶å¼€å¯å—æ¦‚è¦åˆ†æ 4. è¿è¡Œä»£ç ç”Ÿæˆblock-profilingä¿¡æ¯ 4. è½¬å‚¨block-profiling 5. åŠ è½½source-å’Œblock-profiling 5. é‡æ–°ç¼–è¯‘ä»£ç  æ ‡è®°æ¯ä¸ªæ­¥éª¤çš„æ•°å­—æ—¢æŒ‡ç¤ºæ­¥éª¤çš„é¡ºåºï¼ŒåˆæŒ‡ç¤ºå¿…é¡»åœ¨åŒä¸€è®¡åˆ’è¿‡ç¨‹ä¸­æ‰§è¡Œçš„é¡ºåºã€‚ ï¼ˆå¦‚æœéœ€è¦ï¼Œæ‰€æœ‰æ­¥éª¤éƒ½å¯ä»¥åœ¨åŒä¸€Schemeæµç¨‹ä¸­æ‰§è¡Œã€‚ï¼‰ å½“compile-profileè®¾ç½®ä¸ºé»˜è®¤å€¼#fæ—¶ï¼Œå°†ç¦ç”¨æºå’Œå—åˆ†æã€‚\nå‡è®¾æ–‡ä»¶/tmp/fatfib/fatfib.ssåŒ…å«ä»¥ä¸‹ä»£ç ï¼š\n(define fat+ (lambda (x y) (if (zero? y) x (fat+ (1+ x) (1- y))))) (define fatfib (lambda (x) (if (\u0026lt; x 2) 1 (fat+ (fatfib (1- x)) (fatfib (1- (1- x))))))) æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·åŠ è½½fatfib.sså¹¶ä¸”å¼€å¯æ¦‚è¦åˆ†æï¼š\n(parameterize ([compile-profile \u0026#39;source]) (load \u0026#34;/tmp/fatfib/fatfib.ss\u0026#34;)) ç„¶åè¿è¡Œä»£ç ï¼š\n(fatfib 20) â‡’ 10946 è¿è¡Œï¼ˆæˆ–å¤šæ¬¡è¿è¡Œï¼‰ä¹‹åï¼Œè½¬å‚¨æ¦‚è¦æ–‡ä»¶ä¸ºä¸€äº›htmlæ–‡ä»¶é›†åˆï¼š ä½¿ç”¨profile-dump-html\n(profile-dump-html) è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸ºprofile.htmlçš„æ–‡ä»¶\nåœ¨å›¾ä¸­ï¼Œæ‰§è¡Œæœ€é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘çº¢è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºï¼Œè€Œæ‰§è¡Œæœ€ä¸é¢‘ç¹çš„ä»£ç ä»¥æ¥è¿‘ç´«è‰²çš„é¢œè‰²çªå‡ºæ˜¾ç¤ºã€‚\ncompile-profile\nå½“å°†æ­¤å‚æ•°è®¾ç½®ä¸ºç¬¦å·sourceæˆ–å¸ƒå°”å€¼**#tæ—¶ï¼Œç¼–è¯‘å™¨å°†ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¿™äº›æŒ‡ä»¤å¯¹æºä»£ç çš„æ¯ä¸ªéƒ¨åˆ†æ‰§è¡Œçš„æ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸ºç¬¦å·blockæ—¶ï¼Œç¼–è¯‘å™¨ç±»ä¼¼åœ°ä½¿ç”¨æŒ‡ä»¤å¯¹ç”Ÿæˆçš„ä»£ç è¿›è¡Œæ£€æµ‹ï¼Œè¯¥æŒ‡ä»¤å¯¹æ¯ä¸ªä»£ç å—çš„æ‰§è¡Œæ¬¡æ•°è¿›è¡Œè®¡æ•°ã€‚ å½“è®¾ç½®ä¸º#f**ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œç¼–è¯‘å™¨ä¸ä¼šæ’å…¥è¿™äº›æŒ‡ä»¤ã€‚\nå½“compile-profileä¸ºéfalseæ—¶ç”Ÿæˆçš„ä»£ç è¾ƒå¤§ä¸”æ•ˆç‡è¾ƒä½ï¼Œå› æ­¤ä»…åœ¨éœ€è¦æ¦‚è¦åˆ†æä¿¡æ¯æ—¶æ‰åº”è®¾ç½®æ­¤å‚æ•°ã€‚å¯ç”¨æ¦‚è¦åˆ†ææ£€æµ‹åç¼–è¯‘çš„ä»£ç çš„æ¦‚è¦æ–‡ä»¶è®¡æ•°å™¨å°†æ— é™æœŸä¿ç•™ï¼Œå³ä½¿ä¸å®ƒä»¬å…³è”çš„ä»£ç å·²è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ è¿™æ ·å¯ä»¥å¾—åˆ°æ›´å®Œæ•´å’Œå‡†ç¡®çš„æ¦‚è¦åˆ†ææ•°æ®ï¼Œä½†ä¼šå¯¼è‡´åŠ¨æ€ç”Ÿæˆæˆ–åŠ è½½ä»£ç çš„ç¨‹åºå‡ºç°ç©ºé—´æ³„æ¼ï¼Œç¨‹åºå¯ä»¥é€šè¿‡profile-release-countersè¿‡ç¨‹æ˜¾å¼åœ°é‡Šæ”¾è®¡æ•°å™¨ï¼Œä»è€Œé¿å…æ½œåœ¨çš„ç©ºé—´æ³„æ¼ã€‚\n(profile-clear)\nè°ƒç”¨æ­¤è¿‡ç¨‹ä¼šæ¸…ç©ºæ¦‚è¦åˆ†æä¿¡æ¯ï¼Œä»£ç æ¯ä¸ªéƒ¨åˆ†å…³è”çš„è®¡æ•°éƒ½è¢«ç½®ä¸º0\n(profile-release-counters)\nè°ƒç”¨æ­¤è¿‡ç¨‹å°†ä¸¢å¼ƒæ¦‚è¦åˆ†æ\n(profile-dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆè‡ªå¯åŠ¨æˆ–ä¸Šæ¬¡è°ƒç”¨profile-clearä»¥æ¥æ”¶é›†çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ä¿¡æ¯çš„è½¬å‚¨ã€‚ å®ƒè¿”å›ä¸€ä¸ªpairçš„åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªpairçš„caræ˜¯ä¸€ä¸ªsource-objectï¼Œè€Œcdræ˜¯ä¸€ä¸ªç²¾ç¡®çš„éè´Ÿæ•´æ•°è®¡æ•°ã€‚\nprofile-dumpä¼˜äºprofile-dump-listçš„ä¼˜ç‚¹åœ¨äºï¼Œprofile-dumpä»…æ‰§è¡Œæœ€å°‘çš„å¤„ç†ï¼Œå¹¶ä¿ç•™å®Œæ•´çš„æºå¯¹è±¡ï¼ŒåŒ…æ‹¬å…¶åµŒå…¥å¼æºæ–‡ä»¶æè¿°ç¬¦ã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºå°†æ¦‚è¦åˆ†æä¿¡æ¯è½¬å‚¨åˆ°ä¸€å°è®¡ç®—æœºä¸Šçš„faslæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šè¿›è¡Œåç»­å¤„ç†ã€‚\n(profile-dump-html) | (profile-dump-html prefix) | (profile-dump-html prefix dump)\næ­¤è¿‡ç¨‹å°†ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªHTMLæ–‡ä»¶ï¼ŒåŒ…æ‹¬profile.htmlï¼ˆå…¶ä¸­åŒ…å«ç”¨é¢œè‰²ç¼–ç çš„æ‘˜è¦ä¿¡æ¯ï¼‰ï¼Œä»¥åŠä¸€ä¸ªæ–‡ä»¶source.htmlï¼Œå…¶ä¸­æ¯ä¸ªæºæ–‡ä»¶æºéƒ½åŒ…å«ç”¨æºä»£ç è¿›è¡Œé¢œè‰²ç¼–ç çš„å‰¯æœ¬ï¼Œå¦‚å‰å¯¼ä¸­æ‰€è¿°ï¼š åœ¨æœ¬èŠ‚ä¸­ã€‚ å¦‚æœæŒ‡å®šäº†prefix ï¼Œåˆ™å®ƒå¿…é¡»æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨ç”Ÿæˆçš„HTMLæ–‡ä»¶çš„åç§°ä¹‹å‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå‰ç¼€ä¸º**â€œ /tmp/â€ï¼Œåˆ™ç”Ÿæˆçš„æ–‡ä»¶å°†æ”¾ç½®åœ¨ç›®å½•/tmpä¸­ã€‚ åŸå§‹æ¦‚è¦åˆ†æä¿¡æ¯æ˜¯ä»è½¬å‚¨è·å–çš„ï¼Œé»˜è®¤ä¸ºprofile-dump**è¿”å›çš„å€¼\n(profile-palette)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯è‡³å°‘ä¸‰å¯¹çš„éç©ºå‘é‡ã€‚ æ¯ä¸ªpairçš„caræ˜¯èƒŒæ™¯è‰²ï¼Œè€Œcdræ˜¯å‰æ™¯ï¼ˆæ–‡æœ¬ï¼‰è‰²ã€‚ æ¯ç§é¢œè‰²éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ¯ä¸ªå­—ç¬¦ä¸²éƒ½åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ ç¬¬ä¸€ç»„ç”¨äºæœªé…ç½®çš„ä»£ç ï¼Œç¬¬äºŒå¯¹ç”¨äºæœªæ‰§è¡Œçš„é…ç½®çš„ä»£ç ã€‚ ç¬¬ä¸‰ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€ä½çš„ä»£ç ï¼Œç¬¬å››ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡å€’æ•°ç¬¬äºŒä½çš„ä»£ç ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªç”¨äºæ‰§è¡Œé¢‘ç‡æœ€é«˜çš„ä»£ç ã€‚ ç¨‹åºå‘˜å¯èƒ½å¸Œæœ›æä¾›è‡ªå·±çš„è°ƒè‰²æ¿ä»¥å¢å¼ºå¯è§æ€§æˆ–æ›´æ”¹æ‰€ç”¨é¢œè‰²çš„æ•°é‡ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œé»‘è‰²èƒŒæ™¯ç”¨äºæœªé…ç½®æ–‡ä»¶çš„ä»£ç ï¼Œç°è‰²èƒŒæ™¯ç”¨äºæœªæ‰§è¡Œçš„é…ç½®æ–‡ä»¶çš„ä»£ç ã€‚ æ ¹æ®æ‰§è¡Œé¢‘ç‡ï¼Œç´«è‰²åˆ°çº¢è‰²çš„èƒŒæ™¯é¢œè‰²ç”¨äºæ‰§è¡Œçš„æ¦‚è¦åˆ†æä»£ç ï¼Œè€Œæœ€é¢‘ç¹æ‰§è¡Œçš„ä»£ç ä½¿ç”¨çº¢è‰²ã€‚\n(profile-palette) â‡’ #((\u0026#34;#111111\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#607D8B\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#9C27B0\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#673AB7\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#3F51B5\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#2196F3\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00BCD4\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#4CAF50\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#CDDC39\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFEB3B\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFC107\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF9800\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#F44336\u0026#34; . \u0026#34;white\u0026#34;)) (profile-palette ; set palette with rainbow colors and black text ; for all but unprofiled or unexecuted code \u0026#39;#((\u0026#34;#000000\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#666666\u0026#34; . \u0026#34;white\u0026#34;) (\u0026#34;#8B00FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#6600FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#0000FF\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#00FF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FFFF00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF7F00\u0026#34; . \u0026#34;black\u0026#34;) (\u0026#34;#FF0000\u0026#34; . \u0026#34;black\u0026#34;))) ; red (profile-line-number-color)\næ­¤å‚æ•°çš„å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–#fã€‚ å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²åº”åŒ…å«HTMLå±‚å æ ·å¼è¡¨ï¼ˆCSSï¼‰é¢œè‰²è¯´æ˜ç¬¦ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸ºå­—ç¬¦ä¸²ï¼Œåˆ™profile-dump-htmlä½¿ç”¨æŒ‡å®šçš„é¢œè‰²åœ¨æ¯ä¸ªæºæ–‡ä»¶çš„htmlå‘ˆç°ä¸­åŒ…æ‹¬è¡Œå·ã€‚ å¦‚æœå‚æ•°è®¾ç½®ä¸º#fï¼Œåˆ™ä¸åŒ…å«è¡Œå·ã€‚\nä¸ªæ€§åŒ–ï¼ˆWaiter Customizationï¼‰ (new-cafe) | (new-cafe eval-proc)\nChez Schemeé€šè¿‡waiter æˆ–read-eval-printå¾ªç¯ï¼ˆREPLï¼‰ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚ waiteråœ¨ç§°ä¸ºcafÌeçš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚ å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œå°†ç”¨æˆ·ç½®äºcafÌeä¸­å¹¶åˆ†é…waiter ã€‚ new-cafeåœ¨æ—§çš„cafÌeä¹‹ä¸Šå¼€å¯äº†ä¸€ä¸ªæ–°çš„Scheme cafÌeã€‚ é™¤äº†å¯åŠ¨waiter ä¹‹å¤–ï¼Œnew-cafeè¿˜è®¾ç½®äº†cafÌeçš„é‡ç½®å’Œé€€å‡ºå¤„ç†ç¨‹åºï¼ˆè¯·å‚é˜…reset-handlerå’Œexit-handlerï¼‰ã€‚ é€€å‡ºcafÌeä¼šè¿”å›åˆ°åˆ›å»ºè¯¥cafÌeçš„cafÌeã€‚ä»æœ€åˆçš„cafÌeé€€å‡ºåä¼šå®Œå…¨é€€å‡ºäº†Schemeã€‚ cafÌeå¯ä»¥é€šè¿‡æ˜¾å¼è°ƒç”¨exitæˆ–é€šè¿‡æ¥æ”¶end-of-fileï¼ˆUnixç³»ç»Ÿä¸Šä¸ºâ€œ control-Dâ€ï¼‰æ¥é€€å‡ºã€‚åœ¨å‰ä¸€ç§æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™exitçš„ä»»ä½•å€¼éƒ½æ˜¯ä»new-cafeè¿”å›çš„ã€‚\n\u0026gt; (define x 1) \u0026gt; x 1 \u0026gt; (new-cafe) \u0026gt;\u0026gt; x 1 \u0026gt;\u0026gt; (define y 2) \u0026gt;\u0026gt; y 2 \u0026gt;\u0026gt; (exit 1) 1 å¦‚æœæŒ‡å®šäº†å¯é€‰çš„eval-proc å‚æ•°ï¼Œåˆ™ä½¿ç”¨eval-proc æ±‚å€¼ä»æ§åˆ¶å°è¾“å…¥çš„ç¨‹åºã€‚ å¦åˆ™ï¼Œå°†ä½¿ç”¨å‚æ•°current-eval çš„å€¼ã€‚ eval-procå¿…é¡»æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œå³è¦æ±‚å€¼çš„è¡¨è¾¾å¼ã€‚\n\u0026gt; (new-cafe (lambda (x) x)) \u0026gt;\u0026gt; 3 3 \u0026gt;\u0026gt; (a . (b . (c . ()))) (a b c) \u0026gt; (define sum (lambda (ls) (if (null? ls) 0 (+ (car ls) (sum (cdr ls)))))) \u0026gt; (new-cafe sum) \u0026gt;\u0026gt; (1 2 3) 6 æ—¶é—´å’Œæ—¥æœŸ æ—¶é—´ç”±æ—¶é—´å¯¹è±¡è¡¨ç¤ºã€‚ æ—¶é—´å¯¹è±¡è®°å½•ç‰¹å®šæ—¶é—´æˆ–æŒç»­æ—¶é—´çš„çº³ç§’å’Œç§’ï¼Œä»¥åŠæ ‡è¯†æ—¶é—´å¯¹è±¡æ€§è´¨çš„time type ã€‚ æ—¶é—´ç±»å‹æ˜¯ä»¥ä¸‹ç¬¦å·ä¹‹ä¸€ï¼š time-utc: ä»â€œçºªå…ƒâ€1970å¹´1æœˆ1æ—¥0ç‚¹0åˆ†0ç§’ä»¥æ¥çš„æ—¶é—´ time-monotonic: ä»è¿‡å»æŸä¸ªä»»æ„æ—¶é—´ç‚¹å¼€å§‹ç»è¿‡çš„æ—¶é—´ï¼Œç†æƒ³æƒ…å†µä¸‹æ— éœ€è¿›è¡Œè°ƒæ•´ã€‚ time-duration: ä¸¤ä¸ªæ—¶é—´çš„é—´éš”ã€‚å½“ä½œä¸ºcurrent-timeçš„å‚æ•°æ—¶ï¼Œå…¶è¡Œä¸ºä¸time-monotonicç±»ä¼¼ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºä¸¤ä¸ªæ—¶é—´å¯¹è±¡ç›¸å‡çš„ç»“æœ time-process: å½“å‰è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ time-thread: å½“å‰çº¿ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´é‡ã€‚ å¦‚æœæœªè¿è¡Œçº¿ç¨‹ï¼Œæˆ–è€…ç³»ç»Ÿä¸å…è®¸ç¡®å®šå•ä¸ªçº¿ç¨‹æ—¶é—´ï¼Œåˆ™è¯¥æ—¶é—´ä¸time-processç›¸åŒã€‚ time-collector-cpu: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†CPUæ¶ˆè€—çš„æ—¶é—´ã€‚ time-collector-real: å½“å‰è¿›ç¨‹ç”¨äºåƒåœ¾å›æ”¶çš„è¿™éƒ¨åˆ†å®æ—¶æ¶ˆè€—çš„æ—¶é—´\næ—¥æœŸç”±æ—¥æœŸå¯¹è±¡è¡¨ç¤ºã€‚ æ—¥æœŸå¯¹è±¡è®°å½•ç‰¹å®šæ—¥æœŸçš„çº³ç§’ï¼Œç§’ï¼Œåˆ†é’Ÿï¼Œå°æ—¶ï¼Œæ—¥ï¼Œæœˆå’Œå¹´ï¼Œä»¥åŠæ ‡è¯†æ—¶åŒºçš„åç§»é‡ã€‚\n(current-time) | (current-time time-type)\ntime-type å¿…é¡»æ˜¯ä¸Šè¿°çš„æ—¶é—´å¯¹è±¡ä¹‹ä¸€ï¼Œé»˜è®¤ä¸ºtime-utc\n(current-time) â‡’ #\u0026lt;time-utc 1198815722.473668000\u0026gt; (current-time â€™time-process) â‡’ #\u0026lt;time-process 0.120534264\u0026gt; (make-time type nsec sec)\ntype å¿…é¡»æ˜¯ä¸Šé¢åˆ—å‡ºçš„æ—¶é—´ç±»å‹ç¬¦å·ä¹‹ä¸€ã€‚ nsec è¡¨ç¤ºçº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚sec è¡¨ç¤ºç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç²¾ç¡®çš„æ•´æ•°ã€‚\n(make-time \u0026#39;time-utc 787511000 1198783214) (make-time \u0026#39;time-duration 10 5) (make-time \u0026#39;time-duration 10 -5) (time? obj)\n(time? (current-time)) â‡’ #t (time? (make-time â€™time-utc 0 0)) â‡’ #t (time? \u0026#34;1400 hours\u0026#34;) â‡’ #f (time-type time)\nè¿”å›time çš„æ—¶é—´ç±»å‹\n(time-nanosecond time)\nè¿”å›time çš„çº³ç§’\n(time-second time)\nè¿”å›time çš„ç§’\n(set-time-type! time type) | (set-time-nanosecond! time nsec) | (set-time-second! time sec)\næ¯ä¸€ä¸ªè¿‡ç¨‹éƒ½ä¼šä¿®æ”¹æ—¶é—´å¯¹è±¡ï¼Œåªæ”¹å˜å±€éƒ¨ï¼Œè€Œå…¶ä»–å€¼åˆ™ä¸å—å½±å“ã€‚ ä¾‹å¦‚ï¼Œset-time-nanosecond! åªæ›´æ”¹çº³ç§’æ—¶é—´ï¼Œè€Œä¸æ›´æ”¹ç§’æˆ–ç±»å‹ã€‚ ç‰¹åˆ«åœ°ï¼Œå½“æ—¶é—´å¯¹è±¡çš„ç±»å‹æ”¹å˜æ—¶ï¼Œå€¼å¹¶ä¸ä¼šæ›´æ”¹ã€‚\n(time=? time1 time2) | (time\u0026lt;? time1 time2) | (time\u0026gt;? time1 time2) | (time\u0026lt;=? time1 time2) | (time\u0026gt;=? time1 time2)\næ—¶é—´æ¯”è¾ƒã€‚\n(copy-time time)\nå¤åˆ¶æ—¶é—´ã€‚\n(define t1 (current-time)) (define t2 (copy-time t1)) (eq? t2 t1) â‡’ #f (eqv? (time-second t2) (time-second t1)) â‡’ #t (eqv? (time-nanosecond t2) (time-nanosecond t1)) â‡’ #t (time-difference time1 time2 ) | (time-difference! time1 time2 ) | (add-duration time timed) | (add-duration! time timed) | (subtract-duration time timed) | (subtract-duration! time timed)\nå¯¹äºtime-differenceï¼Œtime1å’Œtime2å¿…é¡»å…·æœ‰ç›¸åŒçš„æ—¶é—´ç±»å‹ï¼Œç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ å¯¹äºadd-durationï¼Œadd-durationï¼ï¼Œsubtract-durationå’Œsubtract-durationï¼ï¼Œtimedå¿…é¡»å…·æœ‰æ—¶é—´ç±»å‹time-durationï¼Œå¹¶ä¸”ç»“æœæ˜¯æ—¶é—´ç±»å‹ä¸æ—¶é—´ç›¸åŒçš„æ—¶é—´å¯¹è±¡ã€‚ time-differenceï¼ï¼Œadd-durationï¼å’Œsubtract-durationï¼ å¯èƒ½å…·æœ‰ç ´åæ€§ï¼Œå³æ¯ä¸ªå¯¹è±¡éƒ½å¯èƒ½ä¿®æ”¹å¹¶è¿”å›å…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ–è€…å¯èƒ½åˆ†é…äº†æ–°çš„æ—¶é—´å¯¹è±¡\n(let ([delay (make-time \u0026#39;time-duration 0 1)]) (let ([t1 (current-time \u0026#39;time-monotonic)]) (sleep delay) (let ([t2 (current-time \u0026#39;time-monotonic)]) (let ([t3 (time-difference t2 t1)]) (and (eq? (time-type t3) \u0026#39;time-duration) (time\u0026gt;=? t3 delay) (time=? (add-duration t1 t3) t2) (time=? (subtract-duration t2 t3) t1)))))) â‡’ #t (current-date) | (current-date offset)\nå¦‚ä¸Šæ‰€è¿°ï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»é‡ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥è·å¾—UTC.offsetè¡¨ç¤ºUTCä»¥ä¸œä»¥ç§’ä¸ºå•ä½çš„æ—¶åŒºåç§»é‡ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\nå¦‚æœæœªæä¾›offset ï¼Œåˆ™ä½¿ç”¨å½“å‰æ—¶åŒºçš„offsetï¼Œä»¥åŠdate-dstï¼Ÿ å’Œdate-zone-nameæŠ¥å‘Šæœ‰å…³æ—¶åŒºçš„ä¿¡æ¯ã€‚ å¦‚æœæä¾›äº†åç§»é‡ï¼Œé‚£ä¹ˆdate-dstï¼Ÿ å’Œç»“æœæ—¥æœŸå¯¹è±¡ä¸Šçš„date-zone-nameéƒ½æ˜¯**#f**ã€‚\n(current-date) â‡’ #\u0026lt;date Thu Dec 27 23:23:20 2007\u0026gt; (current-date 0) â‡’ #\u0026lt;date Fri Dec 28 04:23:20 2007\u0026gt; (date-zone-name (current-date)) â‡’ \u0026#34;EST\u0026#34; or other system-provided string (date-zone-name (current-date 0)) â‡’ #f (make-date nsec sec min hour day mon year) | (make-date nsec sec min hour day mon year offset)\nnsecä»£è¡¨çº³ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº$10^9$çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚secä»£è¡¨ç§’ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº62çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚minä»£è¡¨åˆ†é’Ÿï¼Œå¹¶ä¸”å¿…é¡»æ˜¯å°äº60çš„ç²¾ç¡®éè´Ÿæ•´æ•°ã€‚hourå¿…é¡»æ˜¯ç²¾ç¡®çš„éè´Ÿæ•´æ•° å°äº24ã€‚dayå¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤dayâ‰¤31ã€‚ï¼ˆå®é™…ä¸Šé™å¯èƒ½å–å†³äºæœˆä»½å’Œå¹´ä»½ã€‚ï¼‰monè¡¨ç¤ºæœˆä»½å¿…é¡»æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ï¼Œ1â‰¤monâ‰¤12ã€‚å¹´å¿…é¡» æ˜¯ä¸€ä¸ªç²¾ç¡®çš„æ•´æ•°ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå®ƒåº”è‡³å°‘ä¸º1970ã€‚offsetè¡¨ç¤ºUTCä»¥ä¸œçš„æ—¶åŒºåç§»ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚ å®ƒå¿…é¡»æ˜¯-86400åˆ°+86400ï¼ˆå«ï¼‰èŒƒå›´å†…çš„ç²¾ç¡®æ•´æ•°ã€‚ å¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»é‡æ¥æŒ‡å®šUTCã€‚\n(make-date 0 0 0 0 1 1 1970 0) â‡’ #\u0026lt;date Thu Jan 1 00:00:00 1970\u0026gt; (make-date 0 30 7 9 23 9 2007 -14400) â‡’ #\u0026lt;date Sun Sep 23 09:07:30 2007\u0026gt; (date-zone-name (make-date 0 30 7 9 23 9 2007 -14400)) â‡’ #f (string? (date-zone-name (make-date 0 30 7 9 23 9 2007))) â‡’ #t (date-nanosecond date) | (date-second date) | (date-minute date) | (date-hour date) | (date-day date) | (date-month date) | (date-year date) | (date-zone-offset date)\nå¦‚å­—é¢çš„æ„æ€ï¼Œ è¿”å›æ—¥æœŸçš„å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(date-week-day date) | (date-year-day date)\né€šè¿‡è¿™äº›è¿‡ç¨‹ï¼Œå¯ä»¥ç¡®å®šä»¥date è¡¨ç¤ºçš„æ—¥æœŸæ˜¯æ˜ŸæœŸå‡ è¿˜æ˜¯æ¯å¹´çš„æŸå¤©ã€‚ week-dayæ˜¯å°äº7çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0è¡¨ç¤ºæ˜ŸæœŸæ—¥ï¼Œ1è¡¨ç¤ºæ˜ŸæœŸä¸€ï¼Œä¾æ­¤ç±»æ¨ã€‚ year-dayæ˜¯å°äº367çš„ç²¾ç¡®éè´Ÿæ•´æ•°ï¼Œå…¶ä¸­0ä»£è¡¨ä¸€å¹´çš„ç¬¬ä¸€å¤©ï¼ˆ1æœˆ1æ—¥ï¼‰ï¼Œ1ä»£è¡¨ç¬¬äºŒå¤©ï¼Œ2ä»£è¡¨ç¬¬ä¸‰å¤©ï¼Œä¾æ­¤ç±»æ¨ã€‚\n(time-utc-\u0026gt;date time) | (time-utc-\u0026gt;date time offset) | (date-\u0026gt;time-utc date)\nè¿™äº›è¿‡ç¨‹ç”¨äºåœ¨æ—¶é—´å’Œæ—¥æœŸå¯¹è±¡ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ time-utc-\u0026gt;dateçš„æ—¶é—´å‚æ•°å¿…é¡»å…·æœ‰time-type utcï¼Œdate-\u0026gt;time-utcå§‹ç»ˆè¿”å›å¸¦æœ‰time-type utcçš„æ—¶é—´å¯¹è±¡ã€‚\nå¯¹äºtime-utc-\u0026gt;dateï¼Œoffset è¡¨ç¤ºUTCä»¥ä¸œçš„ç§’æ•°ä¸­çš„æ—¶åŒºåç§»ï¼Œå¦‚æœ¬èŠ‚å¼€å¤´æ‰€è¿°ã€‚ å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªä»‹äº-86400åˆ°+86400ï¼ˆå«ï¼‰ä¹‹é—´çš„ç²¾ç¡®æ•´æ•°ï¼Œå¹¶ä¸”é»˜è®¤ä¸ºæœ¬åœ°æ—¶åŒºåç§»é‡ã€‚ UTCå¯ä»¥é€šè¿‡ä¼ é€’é›¶åç§»æ¥è·å¾—ã€‚\n(date-and-time) | (date-and-time date)\nå­—ç¬¦ä¸²å§‹ç»ˆé‡‡ç”¨ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºçš„æ ¼å¼ï¼Œé•¿åº¦å§‹ç»ˆä¸º24ã€‚\n(date-and-time) â‡’ \u0026#34;Fri Jul 13 13:13:13 2001\u0026#34; (defined (make-date 0 0 0 0 1 1 2007 0)) (date-and-time d) â‡’ \u0026#34;Mon Jan 01 00:00:00 2007\u0026#34; (sleep time)\ntime å¿…é¡»æ˜¯ç±»å‹ä¸ºtime-durationçš„æ—¶é—´å¯¹è±¡ã€‚ sleep å¯¼è‡´è°ƒç”¨çº¿ç¨‹åœ¨å¤§çº¦ç”±æ—¶é—´å¯¹è±¡æŒ‡ç¤ºçš„æ—¶é—´é‡å†…æš‚åœæ“ä½œï¼Œé™¤éè¯¥è¿›ç¨‹æ”¶åˆ°ä¸­æ–­ç¡çœ æ“ä½œçš„ä¿¡å·ã€‚ å®é™…ç¡çœ æ—¶é—´å–å†³äºç³»ç»Ÿæ—¶é’Ÿçš„ç²’åº¦ä»¥åŠç³»ç»Ÿè¿è¡Œå…¶ä»–çº¿ç¨‹å’Œè¿›ç¨‹çš„ç¹å¿™ç¨‹åº¦ã€‚\næ—¶é—´å’Œç»Ÿè®¡ (time expr) timeæ±‚å€¼expr ï¼Œå¹¶ä¸”ä½œä¸ºå‰¯ä½œç”¨ï¼Œæ‰“å°ï¼ˆåˆ°console-outputç«¯å£ï¼‰cpuæ—¶é—´é‡ï¼Œå®æ—¶æ—¶é—´é‡ï¼Œåˆ†é…çš„å­—èŠ‚æ•°ä»¥åŠä¸æ±‚å€¼expr ç›¸å…³çš„æ”¶é›†å¼€é”€ã€‚\n\u0026gt; (time (collect)) (time (collect)) 1 collection 1 ms elapsed cpu time, including 1 ms collecting 1 ms elapsed real time, including 1 ms collecting 160 bytes allocated, including 8184 bytes reclaimed (cpu-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥æ¶ˆè€—çš„cpuæ—¶é—´é‡ã€‚\nè¯¥é‡ä»¥æ¯«ç§’ä¸ºå•ä½ã€‚ è¯¥æ•°é‡åŒ…æ‹¬â€œsystemâ€æ—¶é—´å’Œâ€œuserâ€æ—¶é—´ï¼Œå³ä»£è¡¨è¿›ç¨‹åœ¨å†…æ ¸ä¸­èŠ±è´¹çš„æ—¶é—´ä»¥åŠåœ¨è¿›ç¨‹æœ¬èº«ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚\n(real-time)\nè¿”å›ï¼šè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥ç»è¿‡çš„å®æ—¶æ—¶é—´\nä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´æ€»é‡\n(bytes-allocated) | (bytes-allocated g)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ•°\nå¦‚æœæä¾›äº†g ï¼Œåˆ™bytes-allocatedè¿”å›æŒ‡å®šgenerationä¸­å½“å‰ä¸ºSchemeå¯¹è±¡åˆ†é…çš„å­—èŠ‚æ•°ã€‚ g å¿…é¡»ä¸ºéè´Ÿç²¾ç¡®æ•´æ•°ï¼Œä¸”ä¸å¾—å¤§äºæœ€å¤§éé™æ€generationï¼Œå³ï¼Œcollect-maximum-generationè¿”å›çš„å€¼æˆ–ç¬¦å·ä¸ºstaticã€‚ å¦‚æœæœªæä¾›g ï¼Œåˆ™bytes-allocatedè¿”å›æ‰€æœ‰generationä¸­åˆ†é…çš„å­—èŠ‚æ€»æ•°ã€‚\n(initial-bytes-allocated)\nè¿”å›ï¼šåŠ è½½å¯åŠ¨æ–‡ä»¶ååˆ†é…çš„æ€»å­—èŠ‚æ•°\n(bytes-deallocated)\nè¿”å›ï¼šåƒåœ¾å›æ”¶å™¨é‡Šæ”¾çš„æ€»å­—èŠ‚æ•°\né€šè¿‡å°†ï¼ˆbytes-deallocatedï¼‰å’Œï¼ˆbytes-allocatedï¼‰ç›¸åŠ å¹¶å‡å»ï¼ˆinitial-bytes-allocatedï¼‰ï¼Œå¯ä»¥è·å¾—å½“å‰è¿›ç¨‹åˆ†é…çš„æ€»å­—èŠ‚æ•°ï¼ˆæ— è®ºæ˜¯å¦ä»åœ¨ä½¿ç”¨ä¸­ï¼‰ã€‚\n(current-memory-bytes)\nè¿”å›ï¼šå½“å‰åˆ†é…çš„å­—èŠ‚æ€»æ•°ï¼ŒåŒ…æ‹¬å¼€é”€.\ncurrent-memory-bytesè¿”å›å †çš„æ€»å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œä¸ä»…åŒ…æ‹¬Schemeå¯¹è±¡å ç”¨çš„å­—èŠ‚ï¼Œè¿˜åŒ…æ‹¬å„ç§å½¢å¼çš„å¼€é”€ï¼ˆåŒ…æ‹¬ç¢ç‰‡å’Œä¿ç•™ä½†å½“å‰ä¸å ç”¨çš„å†…å­˜ï¼‰ï¼Œå› æ­¤ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿä¸­å½“å‰è¿›ç¨‹çš„å †å†…å­˜é‡çš„å‡†ç¡®åº¦é‡å€¼\n(maximum-memory-bytes)\nè¿”å›ï¼šåˆ†é…è¿‡çš„æœ€å¤§å­—èŠ‚æ•°ï¼ŒåŒ…æ‹¬å¼€é”€\n(reset-maximum-memory-bytes!)\nå°†å †å†…å­˜çš„æœ€å¤§è®°å½•å€¼é‡ç½®ä¸ºå½“å‰å †å¤§å°\n(collections)\nè¿”å›ï¼šåˆ°ç›®å‰ä¸ºæ­¢çš„åƒåœ¾å›æ”¶æ¬¡æ•°\n(statistics)\nè¿”å›ï¼šåŒ…å«å½“å‰ç»Ÿè®¡ä¿¡æ¯çš„sstatsè®°å½•\nstatisticså°†å„ç§æ—¶é—´å’Œåˆ†é…ç»Ÿè®¡ä¿¡æ¯æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªsstatsè®°å½•ã€‚ sstatsè®°å½•å…·æœ‰ä»¥ä¸‹å­—æ®µï¼š\ncpu, æ¶ˆè€—çš„cpuæ—¶é—´ real, ç»è¿‡çš„æ—¶é—´ bytes, åˆ†é…çš„å­—èŠ‚æ•° gc-count, gcæ¬¡æ•° gc-real, gcç»å†çš„æ—¶é—´ gc-bytes, gcå›æ”¶çš„å­—èŠ‚æ•° æ‰€æœ‰å€¼éƒ½æ˜¯ä»ç³»ç»Ÿå¯åŠ¨å¼€å§‹ç®—\nstatisticså¯ä»¥åƒå¦‚ä¸‹å®šä¹‰ï¼š\n(define statistics (lambda () (make-sstats (current-time â€™time-thread) (current-time â€™time-monotonic) (- (+ (bytes-allocated) (bytes-deallocated)) (initial-bytes-allocated)) (collections) (current-time â€™time-collector-cpu) (current-time â€™time-collector-real) (bytes-deallocated)))) (make-sstats cpu real bytes gc-count gc-cpu gc-real gc-bytes) è¿”å›ï¼šsstatsè®°å½•\n(sstats-cpu s) | (sstats-real s) | (sstats-bytes s) | (sstats-gc-count s) | (sstats-gc-cpu s) | (sstats-gc-real s) | (sstats-gc-bytes s)\nè¿”å›ï¼šs å¯¹åº”çš„éƒ¨åˆ†çš„å€¼\n(set-sstats-cpu! s new-value) | (set-sstats-real! s new-value) | (set-sstats-bytes! s new-value) | (set-sstats-gc-count! s new-value) | (set-sstats-gc-cpu! s new-value) | (set-sstats-gc-real! s new-value) | (set-sstats-gc-bytes! s new-value)\nè®¾ç½®å¯¹åº”éƒ¨åˆ†çš„å€¼\n(sstats-difference s1 s2)\næ¯”è¾ƒä¸¤ä¸ªsstats\nenable-object-counts\nenable-object-countsçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå®ƒç¡®å®šæ”¶é›†å™¨åœ¨è¿è¡Œæ—¶æ˜¯å¦è®°å½•å¯¹è±¡è®¡æ•°ï¼Œä»è€Œç¡®å®šè¿‡ç¨‹å¯¹è±¡è®¡æ•°è¿”å›çš„object-countsæ˜¯å¦å‡†ç¡®ã€‚ ç”±äºå¯ç”¨å¯¹è±¡è®¡æ•°ä¼šå¢åŠ æ”¶é›†çš„å¼€é”€ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹è¯¥å‚æ•°è®¾ç½®ä¸º#fã€‚\n(object-counts)\nè¿‡ç¨‹object-countsxè¿”å›ä¸€ä¸ªåµŒå¥—çš„å…³è”åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨è¡¨ç¤ºä¸ºä¸€ä¸ªæˆ–å¤šä¸ªä¸–ä»£ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ´»åŠ¨å®ä¾‹çš„æ¯ä¸ªå †åˆ†é…çš„åŸå§‹ç±»å‹å’Œè®°å½•ç±»å‹åˆ†é…çš„å¯¹è±¡è®¡æ•°å’Œå­—èŠ‚ã€‚ ï¼ˆå †åˆ†é…çš„åŸºæœ¬ç±»å‹åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œpairå’Œå‘é‡ï¼Œä½†ä¸åŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼Œfixnumæˆ–å­—ç¬¦ã€‚ï¼‰ä»…å½“enable-object-countsxxä¸º#tæ—¶ï¼Œæ”¶é›†å™¨æ‰ä¼šæ”¶é›†å¯¹è±¡è®¡æ•°ã€‚\nobject-countsxè¿”å›çš„å…³è”åˆ—è¡¨å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š ((type (generation count . bytes) \u0026hellip;) \u0026hellip;)\ntypeæ˜¯åŸå§‹ç±»å‹çš„åç§°ï¼Œä»¥ç¬¦å·ï¼ˆä¾‹å¦‚ï¼Œå¯¹ï¼‰è¡¨ç¤ºï¼Œæˆ–è€…æ˜¯record-typeæè¿°ç¬¦ï¼ˆrtdï¼‰ã€‚ generationæ˜¯ä»‹äº0å’Œï¼ˆcollect-maximum-generationï¼‰çš„å€¼ï¼ˆåŒ…å«åœ¨å†…ï¼‰æˆ–è¡¨ç¤ºé™æ€ç”Ÿæˆçš„ç¬¦å·staticä¹‹é—´çš„éè´Ÿå›ºå®šç¼–å·ã€‚ countå’Œå­—èŠ‚æ˜¯éè´Ÿçš„fixnumã€‚\n(collect-request-handler void) (enable-object-counts #t) (define-record-type frob (fields x)) (define x (make-frob (make-frob #f))) (collect 3 3) (cdr (assoc 3 (cdr (assoc (record-type-descriptor frob) (object-counts))))) =\u0026gt; (2. 16) æˆæœ¬ä¸­å¿ƒ Cost Centers æˆæœ¬ä¸­å¿ƒç”¨äºåœ¨æ±‚å€¼é€‰å®šçš„ä»£ç æ®µæ—¶è·Ÿè¸ªåˆ†é…çš„å­—èŠ‚ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤å’Œ/æˆ–ç»è¿‡çš„CPUæ—¶é—´ã€‚ æˆæœ¬ä¸­å¿ƒæ˜¯é€šè¿‡è¿‡ç¨‹make-cost-centeråˆ›å»ºçš„ï¼Œè€Œæˆæœ¬æ˜¯é€šè¿‡with-cost-centerè¿‡ç¨‹è¿›è¡Œè·Ÿè¸ªçš„ã€‚\nä»…ä¸ºæ­¤ç›®çš„ä»£ç è·Ÿè¸ªåˆ†é…å’ŒæŒ‡ä»¤è®¡æ•°ã€‚ è¯¥å·¥å…·ç”±ä¸¤ä¸ªå‚æ•°æ§åˆ¶ï¼šgenerate-allocation-countså’Œgenerate-instruction-countsã€‚ é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ£€æµ‹ã€‚ å†…ç½®ç¨‹åºæ²¡æœ‰æ£€æµ‹ï¼Œè§£é‡Šä»£ç æˆ–éSchemeä»£ç ä¹Ÿæ²¡æœ‰ã€‚ ä»…å½“è¿‡ç¨‹with-cost-centerçš„å¯é€‰å‚æ•°*timed?*æœ‰å€¼ä¸”ä¸ä¸ºfalseæ—¶æ‰ä¼šè·Ÿè¸ªç»å†çš„æ—¶é—´\nwith-cost-centerè¿‡ç¨‹å³ä½¿åœ¨ä½¿ç”¨åŒä¸€æˆæœ¬ä¸­å¿ƒé‡æ–°è¾“å…¥ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä½¿ç”¨å¹¶é€šè¿‡ç»§ç»­è°ƒç”¨é€€å‡ºæˆ–é‡æ–°è¾“å…¥ä¸€æ¬¡æˆ–å¤šæ¬¡åï¼Œä¹Ÿè¦éµå¾ªä¸Šè¿°æ³¨æ„äº‹é¡¹æ¥å‡†ç¡®è·Ÿè¸ªæˆæœ¬ã€‚\ngenerate-allocation-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªåˆ†é…ç‚¹æ’å…¥ä¸€å°æ®µæŒ‡ä»¤ï¼Œä»¥è·Ÿè¸ªå‘ç”Ÿçš„åˆ†é…é‡ã€‚æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\ngenerate-instruction-counts\nå½“æ­¤å‚æ•°ä¸ºtrueæ—¶ï¼Œç¼–è¯‘å™¨å°†åœ¨ç”Ÿæˆçš„ä»£ç çš„æ¯ä¸ªå—ä¸­æ’å…¥ç®€çŸ­çš„æŒ‡ä»¤åºåˆ—ï¼Œä»¥è·Ÿè¸ªè¯¥å—æ‰§è¡Œçš„æŒ‡ä»¤æ•°ã€‚ æ­¤å‚æ•°æœ€åˆä¸ºfalseã€‚\n(make-cost-center)\nè¿”å›: æ–°çš„æˆæœ¬ä¸­å¿ƒ\n(with-cost-center cost-center thunk) | (with-cost-center timed? cost-center thunk)\nthunk å¿…é¡»æ˜¯ä¸€ä¸ªæ¥å—é›¶å‚æ•°çš„è¿‡ç¨‹ã€‚ with-cost-centerè°ƒç”¨ä¸å¸¦å‚æ•°çš„thunk å¹¶è¿”å›å…¶å€¼ã€‚ å®ƒè¿˜å¯ä»¥åŠ¨æ€è®¡ç®—åˆ†é…çš„å­—èŠ‚æ•°ï¼Œæ‰§è¡Œçš„æŒ‡ä»¤ä»¥åŠåœ¨è®¡ç®—thunk è°ƒç”¨æ—¶æ‰€ç»è¿‡çš„cpuæ—¶é—´ï¼Œå¹¶å°†è·Ÿè¸ªçš„æˆæœ¬æ·»åŠ åˆ°æˆæœ¬ä¸­å¿ƒè®°å½•ä¸­ã€‚\nå¦‚ä¸Šæ‰€è¿°ï¼Œä»…å¯¹äºå°†å‚æ•°generate-allocation-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªåˆ†é…è®¡æ•°ï¼Œå¹¶ä¸”ä»…å¯¹å°†generate-instruction-counts è®¾ç½®ä¸ºtrueçš„ç¼–è¯‘çš„ä»£ç è·Ÿè¸ªæŒ‡ä»¤è®¡æ•°ã€‚ ä»…åœ¨æä¾›timed? ä¸”ä¸ä¸ºfalseçš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šè·Ÿè¸ªcpuæ—¶é—´ï¼Œå…¶ä¸­åŒ…æ‹¬åœ¨å·²æµ‹é‡çš„ä»£ç ï¼Œæœªæµ‹é‡ä»£ç å’ŒéSchemeä»£ç ä¸­èŠ±è´¹çš„cpuæ—¶é—´ã€‚\n(cost-center-instruction-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„æŒ‡ä»¤æ•°\n(cost-center-allocation-count cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„å·²åˆ†é…å­—èŠ‚æ•°\n(cost-center-time cost-center)\nè¿”å›ï¼šæˆæœ¬ä¸­å¿ƒè·Ÿè¸ªçš„CPUæ—¶é—´\n(reset-cost-center! cost-center)\næ­¤è¿‡ç¨‹å°†æˆæœ¬ä¸­å¿ƒè®°å½•çš„æˆæœ¬é‡ç½®ä¸ºé›¶ã€‚\nå‚æ•° æœ¬èŠ‚ä»‹ç»äº†ç”¨äºåˆ›å»ºå’Œæ“ä½œå‚æ•°çš„æœºåˆ¶ã€‚ å¯ä»¥ä½¿ç”¨make-parameteræ–¹ä¾¿åœ°åˆ›å»ºæ–°å‚æ•°ã€‚ ä½†æ˜¯ï¼Œé™¤äº†å®ƒä»¬çš„è¡Œä¸ºå¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆèƒ½å°†å‚æ•°ä¸å…¶ä»–è¿‡ç¨‹åŒºåˆ†å¼€ã€‚ å¦‚æœè°ƒç”¨å‚æ•°æ—¶å¿…é¡»é‡‡å–æ¯”é€šè¿‡make-parameteræœºåˆ¶å®¹æ˜“å®¹çº³çš„æ›´ä¸ºå¤æ‚çš„åŠ¨ä½œï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨case-lambdaå®šä¹‰è¯¥å‚æ•°\n(make-parameter object) | (make-parameter object procudure)\nmake-parameteræ¥å—ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å†…éƒ¨å˜é‡çš„åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰æ˜¯åº”ç”¨äºåˆå§‹å€¼å’Œæ‰€æœ‰åç»­å€¼çš„è¿‡æ»¤å™¨ã€‚ è¿‡æ»¤å™¨åº”æ¥å—ä¸€ä¸ªå‚æ•°ã€‚ å¦‚æœè¯¥å€¼ä¸åˆé€‚ï¼Œåˆ™è¿‡æ»¤å™¨åº”å¼•å‘å¼‚å¸¸æˆ–å°†å€¼è½¬æ¢ä¸ºæ›´åˆé€‚çš„å½¢å¼ã€‚\nä¾‹å¦‚ï¼Œprint-lengthçš„é»˜è®¤å®šä¹‰å¦‚ä¸‹ï¼š\n(define print-length (make-parameter #f (lambda (x) (unless (or (not x) (and (fixnum? x) (fx\u0026gt;= x 0))) (assertion-violationf â€™print-length \u0026#34;~s is not a positive fixnum or #f\u0026#34; x)) x))) (print-length) â‡’ #f (print-length 3) (print-length) â‡’ 3 (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123...)\u0026#34; (print-length #f) (format\u0026#34;~s\u0026#34;â€™(123456)) â‡’ \u0026#34;(123456)\u0026#34; make-parameterçš„å®šä¹‰ä½¿ç”¨case-lambdaå¾ˆç®€å•ï¼š\n(define make-parameter (case-lambda [(init guard) (let ([v (guard init)]) (case-lambda [() v] [(u) (set! v (guard u))]))] [(init) (make-parameter init (lambda (x) x))])) (parameterize ((param expr) \u0026hellip;) body1 body2 \u0026hellip;)\nä½¿ç”¨è¯­æ³•å½¢å¼parameterizeï¼Œå¯ä»¥ä»¥ç±»ä¼¼äºæ™®é€šå˜é‡çš„fluid-letçš„æ–¹å¼æ›´æ”¹å‚æ•°çš„å€¼ã€‚ åœ¨è®¡ç®—bodyæ—¶ï¼Œå°†æ¯ä¸ªparam è®¾ç½®ä¸ºç›¸åº”çš„expr çš„å€¼ã€‚\n(define test (make-parameter 0)) (test) â‡’ 0 (test 1) (test) â‡’ 1 (parameterize ([test 2]) (test)) â‡’ 2 (test) â‡’ 1 (parameterize ([test 2]) (test 3) (test)) â‡’ 3 (test) â‡’ 1 (define k (lambda (x) x)) (begin (set! k (call/cc k)) â€™k) â‡’ k (parameterize ([test 2]) (test (call/cc k)) (test)) â‡’ k (test) â‡’ 1 (k3) â‡’3 (test) â‡’ 1 è™šæ‹Ÿå¯„å­˜å™¨Virtual registers ç¼–è¯‘å™¨æ”¯æŒä¸€ç»„æœ‰é™çš„è™šæ‹Ÿå¯„å­˜å™¨ ï¼Œä»¥ä¾›éœ€è¦é«˜é€Ÿï¼Œå…¨å±€å’Œå¯å˜å­˜å‚¨ä½ç½®çš„ç¨‹åºä½¿ç”¨ã€‚ å¼•ç”¨æˆ–åˆ†é…è™šæ‹Ÿå¯„å­˜å™¨å¯èƒ½æ¯”è®¿é—®å¯åˆ†é…çš„å±€éƒ¨å˜é‡æˆ–å…¨å±€å˜é‡æ›´å¿«ï¼Œå¹¶ä¸”è®¿é—®æ—¶æ°¸è¿œä¸ä¼šæ¯”å®ƒä»¬æ›´æ…¢ï¼Œè€Œä¸”è¿™æ ·åšçš„ä»£ç åºåˆ—é€šå¸¸æ›´å°ã€‚ åˆ†é…å¯èƒ½ä¼šæ˜¾è‘—åŠ å¿«ï¼Œå› ä¸ºä¸éœ€è¦è·Ÿè¸ªä»è™šæ‹Ÿå¯„å­˜å™¨åˆ°å¹´è½»å¯¹è±¡çš„æŒ‡é’ˆï¼Œå› ä¸ºå¯èƒ½å­˜åœ¨äºè¾ƒæ—©ä¸€ä¸–ä»£ä¸­çš„å¯å˜ä½ç½®ã€‚ åœ¨ç³»ç»Ÿçš„çº¿ç¨‹ç‰ˆæœ¬ä¸Šï¼Œè™šæ‹Ÿå¯„å­˜å™¨æ˜¯â€œæ¯ä¸ªçº¿ç¨‹â€çš„ï¼Œå› æ­¤å¯ä»¥ä»¥æ¯”çº¿ç¨‹å‚æ•°ä½å»‰çš„æ–¹å¼ç”¨ä½œthread-localå­˜å‚¨ã€‚\nè¯¥æ¥å£åŒ…å«ä¸‰ä¸ªè¿‡ç¨‹ï¼švirtual-register-countï¼ˆè¿”å›è™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡ï¼‰ï¼Œset-virtual-register!ï¼ˆè®¾ç½®æŒ‡å®šçš„è™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰å’Œvirtual-registerï¼ˆè·å–æŒ‡å®šè™šæ‹Ÿå¯„å­˜å™¨çš„å€¼ï¼‰ã€‚\nè™šæ‹Ÿå¯„å­˜å™¨ç”±å°äºè™šæ‹Ÿå¯„å­˜å™¨æ•°é‡çš„éè´Ÿfixnumç´¢å¼•æŒ‡å®šã€‚ ä¸ºäº†è·å¾—set-virtual-register!å’Œvirtual-registerçš„æœ€ä½³æ€§èƒ½ï¼Œç´¢å¼•åº”è¯¥æ˜¯ç›´æ¥åµŒå…¥åœ¨è°ƒç”¨ä¸­çš„å¸¸é‡ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡å¯¹è°ƒç”¨çš„ä¼˜åŒ–æ¥ä¼ æ’­ï¼‰ã€‚ ä¸ºäº†é¿å…å°†è¿™äº›å¸¸é‡æ”¾åœ¨æºä»£ç ä¸­ï¼Œç¨‹åºå‘˜åº”è€ƒè™‘ä½¿ç”¨æ ‡è¯†ç¬¦å®ä¸ºè™šæ‹Ÿå¯„å­˜å™¨å‘½åï¼Œä¾‹å¦‚ï¼š\n(define-syntax current-state (identifier-syntax [id (virtual-register 0)] [(set! id e) (set-virtual-register! 0 e)])) (set! current-state \u0026#39;start) current-state â‡’ start è™šæ‹Ÿå¯„å­˜å™¨å¿…é¡»è¢«è§†ä¸ºåº”ç”¨ç¨‹åºçº§èµ„æºï¼Œå³ï¼Œæ‰“ç®—ç”±å¤šä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨çš„åº“é€šå¸¸ä¸åº”ä½¿ç”¨è™šæ‹Ÿå¯„å­˜å™¨ï¼Œä»¥é¿å…ä¸åº”ç”¨ç¨‹åºä½¿ç”¨å¯„å­˜å™¨å†²çªã€‚\n(virtual-register-count)\nä»9.0ç‰ˆå¼€å§‹ï¼Œè™šæ‹Ÿå¯„å­˜å™¨çš„æ•°é‡è®¾ç½®ä¸º16ã€‚é™¤éé€šè¿‡æºé‡æ–°ç¼–è¯‘Chez Schemeï¼Œå¦åˆ™æ— æ³•æ›´æ”¹ã€‚\n(set-virtual-register! k x)\n**set-virtual-register!**å°†x å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­ã€‚ k å¿…é¡»æ˜¯å°äºï¼ˆvirtual-register-countï¼‰çš„å€¼çš„éè´Ÿfixnumã€‚\n(virtual-register k)\nvirtual-registerè¿”å›æœ€åä¸€æ¬¡å­˜å‚¨åœ¨è™šæ‹Ÿå¯„å­˜å™¨k ä¸­çš„å€¼ï¼ˆåœ¨å½“å‰çº¿ç¨‹ä¸Šï¼‰ã€‚\nç¯å¢ƒæŸ¥è¯¢å’Œè®¾ç½®Environmental Queries and Settings (scheme-version)\nChez Schemeçš„ç‰ˆæœ¬\n(threaded?)\nè¿”å›ï¼š#tï¼ˆå¦‚æœåœ¨ç³»ç»Ÿä¸ºçº¿ç¨‹ç‰ˆæœ¬ï¼‰ï¼Œå¦åˆ™è¿”å›#f\n(get-process-id)\nè¿”å›ï¼šå½“å‰è¿›ç¨‹çš„PID\n(getenv key)\nè¿”å›ï¼šç¯å¢ƒä¸­key çš„å€¼ï¼Œæˆ– #f\n(getenv \u0026#34;HOME\u0026#34;) â‡’ \u0026#34;/u/freddy\u0026#34; (putenv key value)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n(putenv \u0026#34;SCHEME\u0026#34; \u0026#34;rocks!\u0026#34;) (getenv \u0026#34;SCHEME\u0026#34;) â‡’ \u0026#34;rocks!\u0026#34; (get-registry key)\nè¿”å›ï¼škey çš„æ³¨å†Œè¡¨å€¼ï¼Œæˆ–è€…**#f**\n(put-registry! key val) | (remove-registry! key)\nkey å’Œ value å¿…é¡»æ˜¯å­—ç¬¦ä¸²\n","id":134,"section":"posts","summary":"å¼‚å¸¸ (warning who msg irritant \u0026hellip;) è¿”å›ï¼šæœªæŒ‡å®š è­¦å‘Šä¼šå¼•å‘æ¡ä»¶ç±»å‹ï¼†warningçš„æŒç»­å¼‚å¸¸ï¼Œå¹¶åº”ç”¨äºæè¿°ï¼†warningæ¡ä»¶ç±»å‹é€‚ç”¨çš„æƒ…å†µï¼Œé€šå¸¸æ˜¯ä¸€ç§ä¸åº”è¯¥é˜»æ­¢","tags":["scheme"],"title":"ç³»ç»Ÿæ“ä½œ(System Operations in Chez Scheme)","uri":"https://lvsq.net/2020/02/system-operations/","year":"2020"},{"content":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›trueçš„è°“è¯ã€ä»¥åŠæ¯ä¸ªå­—æ®µçš„è®¿é—®procedureå’Œé’ˆå¯¹å¯å˜å­—æ®µçš„èµ‹å€¼procedureã€‚æ€»çš„æ¥è¯´ï¼Œä¸Javaä¸­çš„POJOç±»æ¯”è¾ƒç›¸ä¼¼ï¼Œä¸è¿‡ä¸ç”¨è‡ªå®šä¹‰getterå’Œsetteræ–¹æ³•ï¼Œè¿™ä¸Kotlinå€’ä¸ºç±»ä¼¼ï¼Œä¾‹å¦‚ï¼š\n(define-record-type point (fields x y)) åˆ›å»ºäº†ä¸€ä¸ªåä¸ºpointçš„recordç±»å‹ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªå­—æ®µxå’Œyï¼Œå’Œå¦‚ä¸‹å‡ ä¸ªå®šä¹‰å¼ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼š\n(make-point x y) æ„é€ å‡½æ•° (point? obj) è°“è¯ (point-x p) å­—æ®µxçš„è®¿é—®å™¨ (point-y p) å­—æ®µyçš„è®¿é—®å™¨ é»˜è®¤ä¸‹ï¼Œå­—æ®µæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å¯ä»¥å£°æ˜ä¸ºå¯å˜çš„ï¼ˆmutableï¼‰ã€‚å¦‚ä¸‹å®šä¹‰pointä¸­ï¼Œå­—æ®µxæ˜¯å¯å˜çš„ï¼Œä½†yç»´æŒä¸å˜ï¼š\n(define-record-type point (fields (mutable x) y)) å½“ç„¶äº¦å¯æ˜¾å¼åœ°å°†å­—æ®µå£°æ˜ä¸ºä¸å¯å˜çš„ï¼š\n(define-record-type point (fields (mutable x) (immutable y))) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œdefine-record-typeé™¤äº†ç”Ÿæˆäº†ä¸Šè¿°çš„å‡ ä¸ªå®šä¹‰å¼ä¹‹å¤–ï¼Œè¿˜ä¸ºå­—æ®µxå¢åŠ äº†ä¸€ä¸ªèµ‹å€¼è¿‡ç¨‹ï¼š\n(point-x-set! p x)\nè¯¥èµ‹å€¼è¿‡ç¨‹å¯ä»¥ç”¨äºæ”¹å˜xçš„å†…å®¹\n(define p (make-point 36 -17)) (point-x-set! p (- (point-x p) 12)) (point-x p) =\u0026gt; 24 è‡ªåŠ¨ç”Ÿæˆçš„å‡ ä¸ªå®šä¹‰å¼æ˜¯å…è®¸æ”¹å˜åç§°çš„ï¼Œä¸‹é¢çš„pointå®šä¹‰å¼ï¼Œå…¶æ„é€ å‡½æ•°åä¸ºmkpoint, è°“è¯ä¸ºispoint?ï¼Œxå’Œyçš„è®¿é—®å™¨åˆ†åˆ«ä¸ºx-valå’Œy-val, xçš„èµ‹å€¼å™¨ä¸ºset-x-val!\n(define-record-type (point mkpoint ispoint?) (fields (mutable x x-val set-x-val!) (immutable y y-val))) é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ä¸€ä¸ªrecord definitionåˆ›å»ºä¸€ä¸ªæ–°ç±»å‹ï¼ˆä¸ºæ–¹ä¾¿ç†è§£ï¼Œå¯ä»¥ç”¨Javaæ¥è§£é‡Šï¼Œå³å¯¹äºåŒä¸€ä¸ªPOJOç±»newå‡ºä¸¤ä¸ªå®ä¾‹ï¼Œä½†è¿™ä¸¤ä¸ªå®ä¾‹å¹¶ä¸èƒ½equalï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n(define (f p) (define-record-type point (fields x y)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #f ç¬¬ä¸€ä¸ªfçš„è°ƒç”¨å³(f \u0026lsquo;make)è¿”å›ä¸€ä¸ªpointç±»å‹çš„pï¼Œå°†pä¼ é€’ç»™ç¬¬äºŒä¸ªfï¼Œä½†pæ˜¯ç”±ç¬¬ä¸€ä¸ªè°ƒç”¨ç”Ÿæˆçš„ç±»å‹ï¼Œæ‰€ä»¥point?è¿”å›#fã€‚æŒ‰ç…§SICPçš„è¯´æ³•ï¼Œè¿™ä¸¤ä¸ªdefine-record-typeå¹¶ä¸åœ¨ä¸€ä¸ªç¯å¢ƒä¸­ï¼Œåªæ˜¯åå­—ä¸€æ ·è€Œå·²ã€‚\né»˜è®¤çš„ç”Ÿäº§è¡Œä¸º(generative behavior)æˆ–è®¸å¯ä»¥ç”±è®°å½•å®šä¹‰å¼ä¸­çš„nongenerativeå­å¥æ¥é‡è½½ï¼š\n(define (f p) (define-record-type point (fields x y) (nongenerative)) (if (eq? p \u0026#39;make) (make-point 3 4) (point? p))) (f (f \u0026#39;make)) =\u0026gt; #t ä»¥è¿™ç§æ–¹å¼åˆ›å»ºçš„è®°å½•ç±»å‹ä»ç„¶ä¸åŒäºç”±å®šä¹‰å‡ºç°åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¸­åˆ›å»ºçš„è®°å½•ç±»å‹ï¼Œå³ä½¿è¿™äº›å®šä¹‰åœ¨è¯­æ³•ä¸Šæ˜¯ç›¸åŒçš„ï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative)) (point? p)) (g (f)) =\u0026gt; #f ç”šè‡³å¯ä»¥é€šè¿‡åœ¨nongenerativeå­å¥ä¸­åŒ…å«uidï¼ˆå”¯ä¸€idï¼‰æ¥è¦†ç›–å®ƒï¼š\n(define (f) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (make-point 3 4)) (define (g p) (define-record-type point (fields x y) (nongenerative really-the-same-point)) (point? p)) (g (f)) =\u0026gt; #t è®°å½•ç±»å‹å¯ä»¥å®šä¹‰ä¸ºæœ‰parentå­å¥çš„å­ç±»å‹ï¼Œå³ä¸€ä¸ªè®°å½•ç±»å‹å¯ä»¥å£°æ˜ä¸ºæŸä¸€ä¸ªè®°å½•ç±»å‹çš„å­ç±»å‹ï¼Œå¦‚æœæŒ‡å®šäº†çˆ¶ç±»å‹ï¼Œåˆ™å­ç±»å‹å°†ç»§æ‰¿çˆ¶ç±»å‹æ‰€æœ‰å­—æ®µï¼Œä¸”å­ç±»å‹çš„æ¯ä¸ªå®ä¾‹éƒ½è¢«è§†ä¸ºçˆ¶ç±»å‹çš„å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç±»å‹çš„è®¿é—®å™¨å’Œå­—æ®µç­‰ç­‰ã€‚\n(define-record-type point (fields x y)) (define-record-type cpoint (parent point) (fields color)) (define cp (make-cpoint 3 4 \u0026#39;red)) (point? (make-cpoint 3 4 \u0026#39;red)) =\u0026gt; #t (cpoint? (make-point 3 4)) =\u0026gt; #f (define cp (make-cpoint 3 4 \u0026#39;red)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (cpoint-color cp) =\u0026gt; red åˆ°ç›®å‰ä¸ºæ­¢ï¼Œdefine-record-typeå®šä¹‰çš„é»˜è®¤æ„é€ å‡½æ•°æ¥å—recordåŒ…å«çš„å­—æ®µä¸€æ ·å¤šçš„å‚æ•°ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥é‡å†™é»˜è®¤å€¼ï¼Œè¿™é‡Œéœ€è¦å¼•å…¥protocolå­å¥ï¼Œä»¥ä¸‹å®šä¹‰å°†åˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªå­—æ®µçš„ç‚¹è®°å½•ï¼šxï¼Œyå’Œdï¼Œå…¶ä¸­dè¡¨ç¤ºè·åŸç‚¹çš„ä½ç§»ã€‚æ„é€ å‡½æ•°ä»ç„¶åªæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œå³xå’Œyå€¼ï¼Œå¹¶å°†dåˆå§‹åŒ–ä¸ºxå’Œyå¹³æ–¹å’Œçš„å¹³æ–¹æ ¹ã€‚\n(define-record-type point (fields x y d) (protocol (lambda (new) (lambda (x y) (new x y (sqrt (+ (* x x) (* y y)))))))) (define p (make-point 3 4)) (point-x p) =\u0026gt; 3 (point-y p) =\u0026gt; 4 (point-d p) =\u0026gt; 5 å¦å¤–ï¼Œå­ç±»å‹çš„æ„é€ å‡½æ•°ä¸­çš„å‚æ•°é¡ºåºæ˜¯ä¸å¯æ”¹å˜çš„ï¼Œå³å…ˆæ˜¯çˆ¶ç±»å‹æ„é€ å‡½æ•°çš„å­—æ®µï¼Œç„¶åæ‰æ˜¯å­ç±»å‹çš„å‚æ•°ï¼Œå¦‚æœéœ€è¦æ”¹å˜å­ç±»å‹çš„æ„é€ å‡½æ•°çš„å‚æ•°é¡ºåºè¯¥å¦‚ä½•å‘¢ï¼Ÿ\n(define-record-type cpoint (parent point) (fields color) (protocol (lambda (pargs-\u0026gt;new) (lambda (x c y) ((pargs-\u0026gt;new x y) c))))) (define cp (make-cpoint 3 \u0026#39;red 4)) (point-x cp) =\u0026gt; 3 (point-y cp) =\u0026gt; 4 (point-d cp) =\u0026gt; 5 (cpoint-color cp) =\u0026gt; red æœ€åæ¥çœ‹çœ‹define-record-typeçš„è¯­æ³•å½¢å¼ï¼š\nsyntax: (define-record-type record-name clause \u0026hellip;)\nsyntax: (define-record-type (record-name constructor pred) clause \u0026hellip;)\nFields clauseè¯­æ³•å½¢å¼:\n(fields field-spec \u0026hellip;)\nfield-specå¿…é¡»æ˜¯ä¸‹é¢5ä¸ªä¸­çš„ä¸€ä¸ª:\nfield-name (immmutable field-name) (mutable field-name) (immmutable field-name accessor-name) (mutable field-name accessor-name mutator-name) define-record in Chez Scheme Chez Schemeä¾ç„¶æ”¯æŒ$R^6RS$ä¸­ä¼ ç»Ÿçš„recordç±»å‹çš„å®šä¹‰ï¼Œå¦å¤–è¿˜æä¾›ä¸€ä¸ªæ–°çš„è¯­æ³•ï¼Œå³define-recordï¼Œå…¶è¯­æ³•å½¢å¼ä¸define-record-typeä¸€æ ·ï¼Œæ‰€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œdefine-recordä¸­çš„å­—æ®µé»˜è®¤æ˜¯å¯å˜çš„ï¼Œè¿™ä¸$R^6RS$ä¸­çš„recordç›¸åï¼Œå› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªè®°å½•ç±»å‹æ—¶ï¼ŒåŒæ—¶ä¼šå®šä¹‰ä¸‹åˆ—è¿‡ç¨‹ï¼š\n(define-record point (x y)) (make-point x y) ;;\tconstructor (point? obj) ;;\tpredicate (point-x p) ;;\taccessor for field x (point-y p) ;;\taccessor for field y (set-point-x! p obj) ;;\tmutator for field x (set-point-y! p obj) ;;\tmutator for field y é€šè¿‡å¯¹define-record-typeçš„äº†è§£ï¼Œå¯ä»¥å‘ç°å…¶éå¸¸OOï¼Œsmalltalkæ˜¯å¦å—å…¶å½±å“ä¸å¾—è€ŒçŸ¥ï¼Œè‡³å°‘ç»è¿‡çºµå‘æ¯”è¾ƒå¯¹äºæˆ‘ä»¬å­¦ä¹ æŠ€æœ¯å¤§æœ‰è£¨ç›Šã€‚\n","id":135,"section":"posts","summary":"define-record-type Schemeè¯­è¨€ä¸­çš„define-record-typeå½¢å¼ç”¨æ¥å®šä¹‰ä¸€ä¸ªè®°å½•ç±»å‹ï¼Œå¹¶å®šä¹‰è¯¥ç±»å‹çš„æ„é€ å‡½æ•°ã€ä»…å¯¹è¯¥ç±»å‹çš„recordè¿”å›tr","tags":["scheme"],"title":"Schemeè¯­æ³•define-record-typeä»‹ç»","uri":"https://lvsq.net/2020/02/define-record-type/","year":"2020"},{"content":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥åœ¨ Chez Scheme ä¸­ä»¥â€œå¾®æ¨¡å—â€çº§åˆ«ä½¿ç”¨ï¼Œå› ä¸º Chez Scheme ä¸­çš„æ¨¡å—å’Œ import å½¢å¼å±äºå®šä¹‰ï¼Œå¹¶ä¸”å¯ä»¥å‡ºç°åœ¨å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»æ„ä½ç½®ï¼ŒåŒ…æ‹¬åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“æˆ–å…¶ä»–å±€éƒ¨ä½œç”¨åŸŸä¸­ã€‚\nå¾®æ¨¡å—ä¸å‡½æ•°å­°å¥½ï¼Ÿï¼Ÿï¼Ÿè¿˜æ˜¯è§†æƒ…å†µè€Œå®šï¼Ÿï¼Ÿï¼Ÿ\næ¨¡å—æ§åˆ¶ç»‘å®šçš„å¯è§æ€§ï¼Œå¯ä»¥ç”¨ä½œæ‰©å±•è¯æ³•ä½œç”¨åŸŸï¼Œä»¥å…è®¸æ›´ç²¾ç¡®åœ°æ§åˆ¶ç»‘å®šçš„å¯è§èŒƒå›´ã€‚æ¨¡å—å¯¼å‡ºæ ‡è¯†ç¬¦çš„ç»‘å®šï¼Œå³å˜é‡ç»‘å®šã€å…³é”®å­—ç»‘å®šæˆ–æ¨¡å—åç»‘å®šã€‚æ¨¡å—å¯ä»¥æ˜¯å…·åçš„æŠ‘æˆ–åŒ¿åçš„ã€‚åªè¦æ¨¡å—åå¯è§ï¼Œé‚£ä¹ˆåœ¨å…·åæ¨¡å—å‡ºç°å¤„å¯¼å…¥çš„ç»‘å®šéƒ½å¯è§ã€‚åŒ¿åæ¨¡å—ä¸­å¯¼å‡ºçš„ç»‘å®šï¼Œåœ¨æ¨¡å—å‡ºç°çš„åœ°æ–¹è¢«éšå¼åœ°å¯¼å…¥ã€‚åŒ¿åæ¨¡å—å¯ç”¨äºéšè—ä¸€ç»„ç»‘å®šä¸­çš„ä¸€äº›ç»‘å®šï¼ŒåŒæ—¶å…è®¸å…¶ä½™ç»‘å®šå¯è§ã€‚\nè¯­æ³• (module name interface defn \u0026hellip; init \u0026hellip;)\n(module interface defn \u0026hellip; init \u0026hellip;)\nname æ˜¯æ ‡è¯†ç¬¦ï¼Œdefn \u0026hellip; æ˜¯å®šä¹‰ï¼Œinit \u0026hellip; æ˜¯è¡¨è¾¾å¼ã€‚interface æ˜¯å½¢å¦‚ (export \u0026hellip;) çš„å¯¼å‡ºè¡¨ï¼Œå…¶ä¸­æ¯ä¸ª export éƒ½æ˜¯æ ‡è¯†ç¬¦ identifier æŠ‘æˆ–å½¢å¼ (identifier export \u0026hellip;)ã€‚\næ¨¡å—ç”±ä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰å®šä¹‰å’Œä¸€ç»„ï¼ˆå¯èƒ½ä¸ºç©ºçš„ï¼‰åˆå§‹åŒ–è¡¨è¾¾å¼åºåˆ—ç»„æˆã€‚æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ï¼ˆå¯ç†è§£ä¸ºå˜é‡æˆ–è€…çŠ¶æ€ï¼Œä¸‹åŒï¼‰åœ¨æ¨¡å—çš„ç¨‹åºä½“ä¸­å¯è§ï¼Œè¢«å¯¼å‡ºçš„æ ‡è¯†ç¬¦åœ¨æ¨¡å—çš„å¯¼å…¥ä½œç”¨åŸŸå†…äº¦å¯è§ã€‚æ¨¡å—æ¥å£ä¸­åˆ—å‡ºçš„æ¯ä¸ªæ ‡è¯†ç¬¦å¿…é¡»åœ¨è¯¥æ¨¡å—ä¸­å®šä¹‰æˆ–è¢«å¯¼å…¥è¯¥åˆ°æ¨¡å—ã€‚module å½¢å¼æ˜¯ä¸€ç§å®šä¹‰ï¼Œå› æ­¤å¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ï¼ŒåŒ…æ‹¬åµŒå¥—åœ¨ lambda è¡¨è¾¾å¼çš„ç¨‹åºä½“ã€ library å½¢å¼ã€é¡¶å±‚ç¨‹åºï¼Œä»¥åŠåµŒå¥—åœ¨å…¶ä»–æ¨¡å—ä¸­ã€‚æ­¤å¤–ï¼Œå› ä¸ºæ¨¡å—åçš„ä½œç”¨åŸŸä¸å…¶ä»–æ ‡è¯†ç¬¦ç›¸åŒï¼Œæ‰€ä»¥æ¨¡å—å’Œåº“å¯ä»¥åƒå˜é‡å’Œå…³é”®å­—é‚£æ ·å¯¼å‡ºæ¨¡å—åã€‚\næ¨¡å—åä¸å…¶ä»–æ ‡è¯†ç¬¦å ç”¨ç›¸åŒçš„åå­—ç©ºé—´ï¼Œå¹¶éµå¾ªç›¸åŒçš„ä½œç”¨åŸŸè§„åˆ™ã€‚é™¤éè¢«å¯¼å‡ºï¼Œå¦åˆ™æ¨¡å—ä¸­å®šä¹‰çš„æ ‡è¯†ç¬¦ä»…åœ¨è¯¥æ¨¡å—ä¸­å¯è§ã€‚\næ¨¡å—å†…çš„è¡¨è¾¾å¼å¯ä»¥å¼•ç”¨åœ¨æ¨¡å—å¤–éƒ¨ç»‘å®šçš„æ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (module m (plusx) (define plusx (lambda (y) (+ x y)))) (import m) (let ([x 4]) (plusx 5))) ; =\u0026gt; 8,æ³¨æ„ä¸æ˜¯9å“¦ï¼Œå¯ä»¥å°†plusxè§†ä¸ºï¼š(define plusx (lambda (y) (+ 3 y)))) åŒæ ·ï¼Œimportä¸ä¼šé˜»æ­¢è®¿é—®å‡ºç°å¯¼å…¥è¡¨å•çš„å¯è§æ ‡è¯†ç¬¦ï¼Œä½†importæ ‡è¯†ç¬¦æ‰€è¦†ç›–çš„å˜é‡é™¤å¤–ï¼ˆå•¥å«è¦†ç›–ï¼Œçœ‹ä¸‹é¢ä¸¤æ®µä»£ç ï¼‰ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import m) (list x y)) ; =\u0026gt; (local-x m-y) æ¨¡å—mä¸­å®šä¹‰äº†æ ‡è¯†ç¬¦y, åœ¨å…¶è¢«importä¹‹åä¼šè¦†ç›–letä¸­çš„yï¼›\n(module m (y) (define y \u0026#39;m-y)) (let () (import m) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (list x y)) ; =\u0026gt; (local-x local-y) ) å…ˆimport mï¼Œä¹‹åå†å®šä¹‰yï¼Œæ¨¡å—ä¸­å®šä¹‰çš„yä¸ä¼šè¦†ç›–letçš„yã€‚\nå¦ä¸€æ–¹é¢ï¼Œåœ¨æ¨¡å—ä¸­ä½¿ç”¨ import-only ä¼šå»ºç«‹ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨åŸŸï¼Œå…¶ä¸­å”¯ä¸€å¯è§çš„æ˜¯è¢«å¯¼å…¥æ¨¡å—æ‰€å¯¼å‡ºçš„æ ‡è¯†ç¬¦ï¼Œä¸‹é¢çš„ä»£ç ä¸­åªæœ‰yå¯è§ã€‚ å¯¹äºé™æ€éªŒè¯ï¼Œæœ‰æ—¶ä¸å¸Œæœ›ä½¿ç”¨ä»»ä½•æ ‡è¯†ç¬¦ï¼Œé™¤äº†æ˜ç¡®å¯¼å…¥æ¨¡å—æˆ–æœ¬åœ°èŒƒå›´çš„æ ‡è¯†ç¬¦å¤–ï¼Œè¿™æœ‰æ—¶æ˜¯åˆä¹éœ€è¦çš„ã€‚\n(module m (y) (define y \u0026#39;m-y)) (let ([x \u0026#39;local-x] [y \u0026#39;local-y]) (import-only m) x) ; =\u0026gt; Error: x is not visible é™¤éé€šè¿‡â€œimport-onlyâ€å¯¼å…¥çš„æ¨¡å—å¯¼å‡ºâ€œimportâ€æˆ–â€œimport-onlyâ€ä»¥åŠè‡³å°‘ä¸€ä¸ªæ¨¡å—çš„åç§°ï¼Œå¦åˆ™æ— æ³•åœ¨â€œimport-onlyâ€èŒƒå›´å†…è¿›è¡Œåç»­å¯¼å…¥ã€‚ è¦åˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—å¯¼å‡ºçš„éš”ç¦»èŒƒå›´è€Œåˆä¸ä½¿â€œimportâ€æˆ–â€œimport-onlyâ€å¯è§ï¼Œå¿…é¡»ä»¥ç›¸åŒçš„â€œimport-onlyâ€å½¢å¼åˆ—å‡ºæ‰€æœ‰è¦å¯¼å…¥çš„æ¨¡å—ã€‚\nå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«æ¯ä¸ªå…¶ä»–æ¨¡å—çš„å¯¼å‡ºçš„æ¨¡å—ã€‚\n(module m2 (y) (define y \u0026#39;y)) (module m1 (x) (define x \u0026#39;x)) (module mega-module (cons x y) (import m1) (import m2) (import scheme)) (let ([y 3]) (import-only mega-module) (cons x y)) ; =\u0026gt; (x . y) åœ¨å®ƒè¢«ç¼–è¯‘ä¹‹å‰ï¼Œæºç¨‹åºè¢«ç¿»è¯‘æˆä¸å«è¯­æ³•æŠ½è±¡ã€è¯­æ³•å®šä¹‰ã€åº“å®šä¹‰ã€æ¨¡å—å®šä¹‰ä»¥åŠ import å½¢å¼çš„æ ¸å¿ƒè¯­è¨€ç¨‹åºã€‚ç¿»è¯‘ç”±è¯­æ³•å±•å¼€å™¨è´Ÿè´£ï¼Œè¯­æ³•å±•å¼€å™¨ä»¥é€’å½’ä¸‹é™çš„æ–¹å¼å¤„ç†æºç¨‹åºä¸­çš„å½¢å¼ã€‚\nmodule å’Œ import ç‰¹æ®Šå½¢å¼ä»…å½±å“æ ‡è¯†ç¬¦(identifier)åœ¨æºç¨‹åºä¸­çš„å¯è§æ€§ï¼Œè€Œä¸å½±å“å…¶å«ä¹‰ã€‚ç‰¹åˆ«åœ°ï¼Œæ— è®ºå˜é‡è¢«ç»‘å®šåˆ°åœ¨æ¨¡å—å†…éƒ¨æˆ–å¤–éƒ¨å®šä¹‰çš„ä½ç½®ï¼Œimport éƒ½ä¸ä¼šå¼•å…¥æ–°ä½ç½®ã€‚ä¸ºäº†ä¿æŒç”±æ¨¡å—å’Œè¯­æ³•æŠ½è±¡å»ºç«‹çš„ä½œç”¨åŸŸå…³ç³»ï¼Œå±€éƒ¨å˜é‡åœ¨å¿…è¦æ—¶ä¼šè¢«é‡å‘½åã€‚å› æ­¤ï¼Œè¡¨è¾¾å¼ï¼š\n(let ([x 1]) (module m (x setter) (define-syntax x (identifier-syntax z)) (define setter (lambda (x) (set! z x))) (define z 5)) (let ([y x] [z 0]) (import m) (setter 3) (+ x y z))) ; =\u0026gt; 4 ç­‰ä»·äºä¸‹é¢çš„è¡¨è¾¾å¼ï¼Œå…¶ä¸­æ ‡è¯†ç¬¦è¢«ç»Ÿä¸€åœ°æ›´åï¼Œå¹¶å¸¦ä¸Šäº†ä¸‹æ ‡ï¼š\n(let ([x0 1]) (define-syntax x1 (identifier-syntax z1)) (define setter1 (lambda (x2) (set! z1 x2))) (define z1 5) (let ([y3 x0] [z3 0]) (setter1 3) (+ x1 y3 z3))) äº’é€’å½’module (module (a b) (module a (x) (define x (lambda () y))) (module b (y) (define y (lambda () x))) (import a) (import b)) æ­¤æ¨¡å¼çš„ä¸€èˆ¬åŒ–è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼Œå…è®¸å®šä¹‰å¤šä¸ªäº’é€’å½’çš„æ¨¡å—\n(define-syntax rec-modules (syntax-rules (module) [(_ (module m (id ...) form ...) ...) (module (m ...) (module m (id ...) form ...) ... (import m) ...)])) ç»„åˆmodule ç”±äºæ¨¡å—å¯ä»¥é‡æ–°å¯¼å‡ºæ‰€å¯¼å…¥çš„ç»‘å®šï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“åœ¨å•ä¸ªæ¨¡å—ä¸Šæä¾›å¤šä¸ªè§†å›¾ï¼Œå°±åƒä¸‹é¢çš„ s å’Œ t ä¸º r æä¾›çš„è§†å›¾é‚£æ ·ï¼Œæˆ–è€…å°†å‡ ä¸ªæ¨¡å—ç»„åˆæˆä¸€ä¸ªå¤åˆï¼Œå°±åƒ r é‚£æ ·ã€‚\n(module p (x y) (define x 1) (define y 2)) (module q (y z) (define y 3) (define z 4)) (module r (a b c d) (import* p (a x) (b y)) (import* q (c y) (d z))) (module s (a c) (import r)) (module t (b d) (import r)) import* ç¨å¾®è§£é‡Šä¸€ä¸‹import*, å…¶è¯­æ³•å®šä¹‰å¦‚ä¸‹ï¼š\n(define-syntax import* (syntax-rules () [(_ m) (begin)] [(_ m (new old)) (module (new) (module (tmp) (import m) (alias tmp old)) (alias new tmp))] [(_ m id) (module (id) (import m))] [(_ m spec0 spec1 ...) (begin (import* m spec0) (import* m spec1 ...))])) å®ƒæ”¯æŒé‡å‘½åimportçš„ç»‘å®šå’Œé€‰æ‹©æ€§å¯¼å…¥ç‰¹å®šçš„ç»‘å®šï¼Œæ— éœ€ä½¿ç”¨å†…ç½®çš„importå­å½¢å¼æ¥é€‰æ‹©å’Œé‡å‘½åæ ‡è¯†ç¬¦ï¼Œä¸¾ä¾‹æ¥è¯´ï¼š\n(let () (import* scheme (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) (let () (import* (rnrs) (+ cons) (cons +)) (+ (cons 1 2) (cons 3 4))) â‡’ (3 . 7) å…ƒå®šä¹‰Meta Definitions è¯­æ³•ï¼š(meta . definition)\nmeta å…³é”®å­—å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥æ”¾åœ¨ä»»ä½•å®šä¹‰å…³é”®å­—å‰é¢çš„å‰ç¼€ï¼Œä¾‹å¦‚ï¼Œ\n(meta define x 3)\nå®ƒå‘Šè¯‰å±•å¼€å™¨ï¼Œè¯¥å®šä¹‰å¼äº§ç”Ÿçš„ä»»ä½•å˜é‡å®šä¹‰éƒ½åªæ˜¯å±•å¼€æœŸå®šä¹‰ï¼Œåªèƒ½ç”¨äºå…¶ä»–å…ƒå®šä¹‰çš„å³ä¾§ï¼Œæœ€ä¸»è¦æ˜¯ç”¨åœ¨è½¬æ¢å™¨è¡¨è¾¾å¼ä¸­ã€‚å®ƒç”¨äºå®šä¹‰å±•å¼€æœŸè¾…åŠ©å‡½æ•°ï¼Œä»¥åŠä¾›ä¸€ä¸ªæˆ–å¤šä¸ª syntax-case è½¬æ¢å™¨æ‰€ä½¿ç”¨çš„å…¶ä»–ä¿¡æ¯ã€‚\nå…ƒå®šä¹‰çš„è¯­ä¹‰ç±»ä¼¼äºlet*ï¼Œå®ƒå¯ä»¥æ˜¯è‡ªé€’å½’ï¼Œä½†ä¸æ˜¯äº’é€’å½’çš„ã€‚\nå…ƒå®šä¹‰é€šè¿‡å®å±•å¼€ä¼ æ’­ï¼Œå› æ­¤å¯ä»¥ç¼–å†™ï¼Œä¾‹å¦‚ï¼š\n(module (a) (meta define-record foo (x)) (define-syntax a (let ([q (make-foo #\u0026#39;\u0026#39;q)]) (lambda (x) (foo-x q))))) a ï¼›=\u0026gt; q æ¡ä»¶å±•å¼€Conditional expansion å¯ä»¥é€šè¿‡ meta-cond åœ¨å±•å¼€æœŸåšå‡ºå†³ç­–ï¼Œè¿™ç±»ä¼¼äº condï¼Œä½†æ˜¯æ˜¯åœ¨å±•å¼€æœŸæ±‚å€¼å¹¶æµ‹è¯•è¡¨è¾¾å¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨é¢„æœŸä¸ºå®šä¹‰çš„ä¸Šä¸‹æ–‡ä¸­ä»¥åŠåœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚\nè¯­æ³•ï¼š(meta-cond clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ª clauseï¼Œå…¶ä½™çš„å¿…é¡»é‡‡å–ä»¥ä¸‹å½¢å¼ï¼š\n(test expr1 expr2 \u0026hellip;)\næœ€åä¸€ä¸ª cluase é™¤å¯é‡‡å–ä¸Šè¿°å½¢å¼å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ else å­å¥å½¢å¼ï¼š\n(else expr1 expr2 \u0026hellip;)\nåœ¨å±•å¼€æœŸé—´ï¼Œtest è¡¨è¾¾å¼ä¼šè¢«é¡ºåºåœ°æ±‚å€¼ï¼Œç›´åˆ°æŸæ¡è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸæˆ–è€…æ±‚å€¼å®Œæ‰€æœ‰çš„è¡¨è¾¾å¼ä¸ºæ­¢ã€‚å¦‚æœä¸€æ¡ test è¡¨è¾¾å¼æ±‚å€¼ä¸ºçœŸï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºåŒ…å«ç›¸åº”è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦‚æœæ²¡æœ‰æ±‚å€¼ä¸ºçœŸçš„ test è¡¨è¾¾å¼ï¼Œä¸”å­˜åœ¨ else å­å¥ï¼Œåˆ™ meta-cond å½¢å¼å°†å±•å¼€ä¸ºç”±æ¥è‡ªäº else å­å¥çš„è¡¨è¾¾å¼ expr1 expr2 \u0026hellip; æ‰€ç»„æˆçš„ begin å½¢å¼ã€‚å¦åˆ™ï¼Œmeta-cond è¡¨è¾¾å¼å±•å¼€ä¸ºå¯¹ void è¿‡ç¨‹çš„è°ƒç”¨ã€‚\nmeta-cond å¯ä»¥æŒ‰å¦‚ä¸‹å®šä¹‰ï¼š\n(define-syntax meta-cond (syntax-rules () [(_ [a0 a1 a2 ...] [b0 b1 b2 ...] ...) (let-syntax ([expr (cond [a0 (identifier-syntax (begin a1 a2 ...))] [b0 (identifier-syntax (begin b1 b2 ...))] ...)]) expr)])) meta-cond ç”¨äºåœ¨å±•å¼€æœŸä»ä¸€ç»„å¯èƒ½çš„å½¢å¼ä¸­è¿›è¡Œé€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œç¨‹åºå‘˜å¯ä»¥å®šä¹‰è¿‡ç¨‹çš„å®‰å…¨ï¼ˆè¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰å’Œä¸å®‰å…¨ï¼ˆä¸è¿›è¡Œé”™è¯¯æ£€æŸ¥ï¼‰ç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®ç¼–è¯‘æœŸä¼˜åŒ–çº§åˆ«å†³å®šè°ƒç”¨ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤º:\n(meta-cond [(= (optimize-level) 3) (unsafe-frob x)] [else (safe-frob x)]) åˆ«åAliases è¯­æ³•ï¼š(alias id1 id2)\nalias æ˜¯ä¸€ç±»å®šä¹‰ï¼Œå¯ä»¥å‡ºç°åœ¨å…¶ä»–å®šä¹‰å¯ä»¥å‡ºç°çš„ä»»ä½•ä½ç½®ã€‚å®ƒç”¨äºå°†ç»‘å®šä»ä¸€ä¸ªæ ‡è¯†ç¬¦è½¬ç§»åˆ°å¦ä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚\n(let ([x 3]) (alias y x) (set! y 4) (list x y)) ; =\u0026gt; (4 4) ç”±äºå±•å¼€æ˜¯ç”±å·¦è‡³å³è¿›è¡Œçš„ï¼Œåˆ«ååº”è¯¥å‡ºç°åœ¨å³ä¾§çš„æ ‡è¯†ç¬¦çš„å®šä¹‰ä¹‹åï¼Œä¾‹å¦‚ï¼š\n(let () (import-only (chezscheme)) (define y 3) (alias x y) x) ; =\u0026gt; 3 è€Œä¸æ˜¯ï¼š\n(let () (import-only (chezscheme)) (alias x y) (define y 3) x) ; =\u0026gt; exception: unbound identifier ","id":136,"section":"posts","summary":"Modules æ¨¡å—ç”¨äºå¸®åŠ©å°†ç¨‹åºç»„ç»‡æˆå•ç‹¬çš„éƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†é€šè¿‡å£°æ˜å¥½çš„æ¥å£å¹²å‡€åœ°äº¤äº’ã€‚å°½ç®¡æ¨¡å—åŒ–ç¼–ç¨‹é€šå¸¸å¯ä»¥ä¸ºå¤šäººå‚åŠ çš„å¤§å‹ç¨‹åºå¼€å‘å¸¦æ¥ä¾¿åˆ©ï¼Œä½†å®ƒä¹Ÿå¯ä»¥","tags":["modules"],"title":"Chez Scheme Modules","uri":"https://lvsq.net/2020/01/modules/","year":"2020"},{"content":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚\n(define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_ ((a1 v1) (a2 v2) ...) bodys ...) (let ((a1 v1)) (my-let* ((a2 v2) ...) bodys ...)) ) ) ) æ³¨æ„ï¼Œmy-let*æ˜¯å¯ä»¥é€’å½’ä½¿ç”¨çš„ï¼Œä»¥åŠ**\u0026hellip;**çš„ç”¨æ³•ã€‚\n(define-syntax my-let* (syntax-rules () ( (_ () bodys ...) (let () bodys ...) ) ( (_ ((a1 v1) ...) bodys ...) (let () (define a1 v1) ... bodys ... ) ) ) ) è¿™ä¸ªå®ç°æ–¹å¼ä¸ä¸Šé¢çš„ä¸åŒï¼Œä¸Šé¢çš„æ˜¯åµŒå¥—letï¼Œè¿™é‡Œå°†ç›´æ¥æŒ‰é¡ºåºdefineå†…éƒ¨å˜é‡ï¼Œä»£ç æ›´çŸ­ã€‚æ³¨æ„æ­¤å¤„çš„**\u0026hellip;**çš„ç”¨æ³•ã€‚\n","id":137,"section":"posts","summary":"å®ç°Let*è¯­æ³•çš„ä¸¤ç§æ–¹å¼ï¼Œä¸»è¦ç›®çš„æ˜¯è®°å½•ä¸¤ç§ç¼–ç¨‹æ€è·¯ï¼Œåœ¨ç¼–å†™å…¶ä»–ç¨‹åºæ—¶åº”è¯¥ä¹Ÿæœ‰æ‰€è£¨ç›Šã€‚ (define-syntax my-let* (syntax-rules () ((_ () bodys ...) (let () bodys ...)) ( (_ ((a1 v1)) bodys ...) (let ((a1 v1)) bodys ...) ) ( (_","tags":["scheme"],"title":"è‡ªå®šä¹‰ Let*","uri":"https://lvsq.net/2020/01/my-let/","year":"2020"},{"content":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©å±•æœŸé—´ä¼šæš‚æ—¶æ›´æ”¹keywordçš„ç°æœ‰ç»‘å®šï¼Œè€Œä¸æ˜¯å¼•å…¥keywordçš„æ–°ç»‘å®šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰©å±•form1 form2 \u0026hellip;çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªkeywordçš„å¯è§èŒƒå›´ï¼ˆæˆ–é¡¶çº§ï¼‰å°†ä¼šä¸´æ—¶æ›¿æ¢ä¸ºæ–°çš„ç»‘å®šå…³ç³»ã€‚\n(let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 2 ) ) ) (let ([f (lambda (x) (+ x 1))]) (let-syntax ([g (syntax-rules () [(_ x) (f x)])]) (fluid-let-syntax ([f (syntax-rules () [(_ x) x])]) (g 1) =\u0026gt; 1 ) ) ) å¯¹æ¯”ä¸Šè¿°ä¸¤æ®µä»£ç ï¼Œå¯çŸ¥ï¼šä¸¤ä¸ªè¡¨è¾¾å¼åŸºæœ¬ç›¸åŒçš„ï¼Œé™¤äº†å‰è€…é‡‡ç”¨å†…éƒ¨let-synctaxè¯­æ³•ï¼Œç¬¬äºŒä¸ªé‡‡ç”¨fluid-let-syntaxè¯­æ³•ã€‚åœ¨ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œ(g 1)æ‰©å±•ä¸­çš„å‡ºç°çš„få¼•ç”¨çš„æ˜¯let-boundçš„å˜é‡fï¼Œè€Œç¬¬äºŒä¸ªè¡¨è¾¾å¼ï¼Œfå¼•ç”¨çš„æ˜¯ç”±fluid-let-syntaxç»‘å®šçš„f\n","id":138,"section":"posts","summary":"Fluid Keyword Bindings fluid-let-syntax è¯­æ³•: fluid-let-syntax ((keyword expr) \u0026hellip;) form1 form2 \u0026hellip;) fluid-let-syntaxä¸æ ‡å‡†letè¯­æ³•ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºFluid-let-syntaxåœ¨å…¶bodyæ‰©","tags":["module","syntactic"],"title":"Syntactic Extension and Modules in Chez Scheme","uri":"https://lvsq.net/2020/01/syntactic-extension-and-modules/","year":"2020"},{"content":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„å¯ä»¥å…±äº«æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ–æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼Œåœ¨é‡‡ç”¨æ­¤ç§å‚æ•°ä¼ é€’è§„åˆ™çš„è¯­è¨€çš„è§£é‡Šå™¨ä¸­ï¼Œå¯ä»¥ç”¨ boxes å®ç° call-by-reference çš„è¯­ä¹‰ã€‚è§£é‡Šæœ‰ç‚¹ç»•ï¼ŒæŒ‰æˆ‘çš„ç†è§£boxeså°±ç›¸å½“äºGolangçš„structã€Javaä¸­çš„ç±»ï¼Œå°†ä¸€äº›çŠ¶æ€åŒ…è£…æˆä¸€ä¸ªæ•´å—ï¼Œå¤–ç•Œé€šè¿‡å¼•ç”¨è¯¥æ•´å—çš„æŒ‡é’ˆæ¥è®¿é—®å†…éƒ¨çš„å„ä¸ªçŠ¶æ€ã€‚\nBoxes çš„å­—é¢å½¢å¼å¸¦æœ‰å‰ç¼€ #\u0026amp; (å‘éŸ³ä¸º â€œhash-ampersandâ€). ä¾‹å¦‚ï¼Œ #\u0026amp;(a b c) æ˜¯ä¸€ä¸ª boxï¼Œå†…å®¹ä¸ºåˆ—è¡¨ (a b c). è¯»å–å™¨è‹¥é‡åˆ° #!r6rs ï¼Œåˆ™ä¼šåœ¨å…¶åçš„è¾“å…¥æµä¸­ç¦ç”¨ box è¯­æ³•ï¼Œé™¤éåœ¨æ›´è¿‘çš„ä½ç½®é‡åˆ° #!chezscheme.\næ‰€æœ‰ boxes é»˜è®¤æ˜¯å¯å˜çš„ï¼ŒåŒ…æ‹¬å¸¸é‡ã€‚ç¨‹åºå¯ä»¥é€šè¿‡ box-immutable åˆ›å»ºä¸å¯å˜ boxes. å°è¯•ä¿®æ”¹ä¸å¯å˜ box ä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ç”¨æ³•ï¼š\n(box? obj) å¦‚æœ obj æ˜¯ box, åˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box? \u0026#39;#\u0026amp;a) =\u0026gt; #t (box? \u0026#39;a) =\u0026gt; #f (box? (box 3)) =\u0026gt; #t (box obj) åˆ›å»ºä¸€ä¸ªç”±objç»„æˆçš„box\n(box \u0026#39;a) =\u0026gt; #\u0026amp;a (box (box \u0026#39;(a b c))) =\u0026gt; #\u0026amp;#\u0026amp;(a b c) (unbox box) è¿”å›boxçš„å†…å®¹\n(unbox #\u0026amp;a) =\u0026gt; a (unbox #\u0026amp;#\u0026amp;(a b c)) =\u0026gt; #\u0026amp;(a b c) (let ([b (box \u0026#34;hi\u0026#34;)]) (unbox b)) =\u0026gt; \u0026#34;hi\u0026#34; (set-box! box obj) box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ set-box! æŠŠ box çš„å†…å®¹è®¾ç½®ä¸º obj.\n(let ([b (box \u0026#39;x)]) (set-box! b \u0026#39;y) b) =\u0026gt; #\u0026amp;y (let ([incr! (lambda (x) (set-box! x (+ (unbox x) 1)))]) (let ([b (box 3)]) (incr! b) (unbox b))) =\u0026gt; 4 (box-cas! box old-obj new-obj) å¦‚æœ box è¢«æ”¹å˜ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f. box å¿…é¡»æ˜¯å¯å˜çš„ã€‚ è‹¥ box å¾…æ›¿æ¢çš„å†…å®¹å’Œ old-obj ç›¸åŒ(åŸºäº eq?), åˆ™ box-cas! è‡ªåŠ¨å°† box çš„å†…å®¹æ›¿æ¢ä¸º new-obj; è‹¥ä¸ç›¸åŒï¼Œåˆ™ box ä¿æŒä¸å˜ã€‚å³CASæ“ä½œï¼ŒåŸå­çš„ã€‚\n(define b (box \u0026#39;old)) (box-cas! b \u0026#39;old \u0026#39;new) =\u0026gt; #t (unbox b) =\u0026gt; \u0026#39;new (box-cas! b \u0026#39;other \u0026#39;wrong) =\u0026gt; #f (unbox b) =\u0026gt; \u0026#39;new (mutable-box? obj) å¦‚æœ obj æ˜¯å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(immutable-box? obj) å¦‚æœ obj æ˜¯ä¸å¯å˜çš„ box ï¼Œåˆ™ä¸º #t, å¦åˆ™ä¸º #f.\n(box-immutable obj) è¿”å›ä¸€ä¸ªå†…å®¹ä¸ºobjçš„ä¸å¯å˜çš„boxã€‚Boxes é€šå¸¸ç”¨æ¥æ”¯æŒå…±äº«çš„ï¼Œå¯å˜çš„ç»“æ„ï¼Œæ‰€ä»¥ä¸å¯å˜çš„ box ä¸€èˆ¬æ²¡ä»€ä¹ˆç”¨ã€‚\n","id":139,"section":"posts","summary":"Chez Schemeä¸­æœ‰ä¸€ç§Boxesç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•å…ƒç´ å¯¹è±¡ï¼Œä¸»è¦ç”¨äºæä¾›ä¸€ä¸ªâ€œé¢å¤–çš„é—´æ¥å±‚â€ã€‚è¿™ä¸ªé¢å¤–çš„é—´æ¥å±‚ï¼Œé€šå¸¸ç”¨äºä½¿å¤šä¸ªä»£ç å—æˆ–æ•°æ®ç»“æ„","tags":["scheme"],"title":"Chez Schemeä¸­Boxesä»‹ç»","uri":"https://lvsq.net/2020/01/boxes-in-chez/","year":"2020"},{"content":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x)))\n(atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦ï¼›list-headå’ŒSchemeæ ‡å‡†è¿‡ç¨‹list-tailå¯èƒ½ä¼šåŒæ—¶ä½¿ç”¨æ¥åˆ‡å‰²ä¸€ä¸ªlistï¼Œä¸åŒç‚¹åœ¨äºï¼Œlist-tailä¸ä¼šåˆ†é…å†…å­˜è€Œåªæ˜¯è¿”å›æºlistçš„ä¸€ä¸ªå­åˆ—è¡¨ï¼Œlist-headæ€»æ˜¯è¿”å›æºlistå‰nä¸ªå…ƒç´ çš„å‰¯æœ¬\n(list-head \u0026#39;(a b c) 0) â‡’ () (list-head \u0026#39;(a b c) 2) â‡’ (a b) (list-head \u0026#39;(a b c) 3) â‡’ (a b c) (list-head \u0026#39;(a b c . d) 2) â‡’ (a b) (list-head \u0026#39;(a b c . d) 3) â‡’ (a b c) (list-head \u0026#39;#1=(a . #1#) 5) â‡’ (a a a a a) last-pair(Chez) ç”¨æ³•ï¼š(last-pair list) åˆ—è¡¨ä¸èƒ½ä¸ºç©ºã€‚ last-pairè¿”å›åˆ—è¡¨çš„æœ€åä¸€å¯¹ï¼ˆpairï¼‰ï¼ˆä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼‰, listå¯èƒ½æ˜¯ä¸æ­£ç¡®çš„åˆ—è¡¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€åä¸€å¯¹æ˜¯åŒ…å«æœ€åä¸€ä¸ªå…ƒç´ å’Œç»ˆæ­¢å¯¹è±¡çš„ä¸€ä¸ªpairã€‚\n(last-pair \u0026#39;(a b c d)) â‡’ (d) (last-pair \u0026#39;(a b c.d)) â‡’ (c . d) list-copy(Chez) ç”¨æ³•ï¼š (list-copy list) è¿”å›ä¸€ä¸ªlistçš„å‰¯æœ¬ï¼Œequal?ï¼ˆç»“æ„å’Œå€¼ç›¸åŒï¼‰åˆ¤æ–­ä¸º#t\nlist*(Chez) ç”¨æ³•ï¼š(list* obj \u0026hellip; final-obj) è¿”å›ä¸€ä¸ªç”±obj \u0026hellip; final-obj ç»„æˆçš„list, ä¸R6RSçš„**cons***ç›¸åŒ\nmake-list(Chez) ç”¨æ³•ï¼š (make-list n) æˆ–è€… (make-list n obj) è¿”å›nä¸ªå¯¹è±¡çš„åˆ—è¡¨ã€‚næ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œ å¦‚æœobjä¸æŒ‡å®šï¼Œåˆ™è¿”å›çš„listæ˜¯ä¸ç¡®å®šçš„\n(make-list 0 \u0026#39;()) =\u0026gt; () (make-list 3 0) =\u0026gt; (0 0 0) (make-list 2 \u0026#34;hi\u0026#34;) =\u0026gt; (\u0026#34;hi\u0026#34; \u0026#34;hi\u0026#34;) iota(Chez) ç”¨æ³•ï¼š(iota n) è¿”å›ä» 0ï¼ˆåŒ…å«ï¼‰åˆ° nï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨ï¼Œné¡»ä¸ºç²¾ç¡®çš„éè´Ÿæ•´æ•°\n(iota 0) =\u0026gt; () (iota 5) =\u0026gt; (0 1 2 3 4) enumerate(Chez) ç”¨æ³•ï¼š (enumerate ls) è¿”å›: ä» 0ï¼ˆåŒ…å«ï¼‰åˆ°é•¿åº¦ lsï¼ˆä¸åŒ…å«ï¼‰çš„æ•´æ•°åˆ—è¡¨\n(enumerate \u0026#39;()) =\u0026gt; () (enumerate \u0026#39;(a b c)) =\u0026gt; (0 1 2) (let ([ls \u0026#39;(a b c)]) (map cons ls (enumerate ls))) =\u0026gt; ((a . 0) (b . 1) (c . 2)) remq! | remv! | remove!(Chez) ç”¨æ³•ï¼š (remq! obj list) | (remv! obj list) | (remove! obj list) è¿”å›: åˆ—è¡¨ä¸­æ‰€æœ‰ obj éƒ½è¢«ç§»é™¤åçš„åˆ—è¡¨ è¿™äº›è¿‡ç¨‹ä¸ R6RS ä¸­çš„ remq, remv, åŠ remove è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯ remq!, remv! å’Œ remove! ä½¿ç”¨è¾“å…¥åˆ—è¡¨ä¸­çš„pairæ¥æ„æˆè¾“å‡ºåˆ—è¡¨ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„ç›¸åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(remq! \u0026#39;a \u0026#39;(a b a c a d)) â‡’ (b c d) (remv! #\\a \u0026#39;(#\\a #\\b #\\c)) =\u0026gt; (#\\b #\\c) (remove! \u0026#39;(c) \u0026#39;((a) (b) (c))) =\u0026gt; ((a) (b)) substq | substv | subst | substq! | substv! | subst!(Chez) ç”¨æ³•ï¼š (subs* new old tree) è¿”å›ï¼šåœ¨treeä¸­å°†åŒ¹é…åˆ°çš„oldå…ƒç´ å…¨éƒ¨æ›¿æ¢ä¸ºnewä¹‹åçš„tree. å¯¹äº substq å’Œ substq! ï¼Œç›¸ç­‰æ€§æµ‹è¯•æ˜¯åŸºäº eq?, substv å’Œ substv! æ˜¯åŸºäº eqv?, è€Œ subst å’Œ subst! æ˜¯åŸºäº equal? substq!, substv!, å’Œ subst! æ‰§è¡Œç ´åæ€§çš„æ›¿æ¢ã€‚å®ƒä»¬è¿›è¡Œè¾ƒå°‘çš„ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”å®ƒä»¬éç ´åæ€§çš„å¯¹åº”ç‰ˆæœ¬æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(substq \u0026#39;a \u0026#39;b \u0026#39;((b c) b a)) =\u0026gt; ((a c) a a) (substv 2 1 \u0026#39;((1 . 2) (1 . 4) . 1)) =\u0026gt; ((2 . 2) (2 . 4) . 2) (subst \u0026#39;a \u0026#39;(a . b) \u0026#39;((a . b) (c a . b) . c)) =\u0026gt; (a (c . a) . c) (let ([tr \u0026#39;((b c) b a)]) (substq! \u0026#39;a \u0026#39;b tr) tr) =\u0026gt; ((a c) a a) reverse! ç”¨æ³•ï¼š(reverse! list) è¿”å›ï¼šå°†åŸliståå‘è¾“å‡º reverse! é€šè¿‡åè½¬å…¶é“¾æ¥ç ´åæ€§åœ°åå‘æ’åºåˆ—è¡¨ã€‚ä»¥ reverse! å–ä»£ reverse å‡å°‘äº†ç©ºé—´åˆ†é…ï¼Œä½†å¹¶ä¸ä¸€å®šæ¯”ä½¿ç”¨ reverse æ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(reverse! \u0026#39;()) =\u0026gt; () (reverse! \u0026#39;(a b c)) =\u0026gt; (c b a) (let ([x \u0026#39;(a b c)]) (reverse! x) x) =\u0026gt; (a) (let ([x \u0026#39;(a b c)]) (set! x (reverse! x)) x) =\u0026gt; (c b a) append! ç”¨æ³•ï¼š(append! list \u0026hellip;) è¿”å›ï¼šå°†æ‰€æœ‰è¾“å…¥listä¸²è”èµ·æ¥çš„åˆ—è¡¨ å¦‚åŒ append, append! è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå…¶ä¸­å…ƒç´ ä¾æ¬¡ä¸ºç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç¬¬ä¸‰ä¸ªåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œç­‰ç­‰ã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œ append! é‡ç”¨æ‰€æœ‰å‚æ•°ä¸­çš„ç‚¹å¯¹ä»¥æ„é€ æ–°åˆ—è¡¨ã€‚å³ï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨å‚æ•°çš„æœ€åä¸€ä¸ªcdr, å…¶åä¸€å…ƒç´ å˜ä¸ºæŒ‡å‘ä¸‹ä¸€ä¸ªåˆ—è¡¨å‚æ•°ã€‚é™¤æœ€åä¸€ä¸ªå‚æ•°å¤–ï¼Œå¦‚æœä»»ä¸€å‚æ•°ä¸ºç©ºåˆ—è¡¨ï¼Œå®ƒå®è´¨ä¸Šä¼šè¢«å¿½ç•¥ã€‚æœ€åä¸€ä¸ªå‚æ•°ï¼ˆå¹¶ä¸ä¸€å®šå¾—æ˜¯åˆ—è¡¨ï¼‰æ˜¯ä¸å˜çš„ã€‚\nç›¸æ¯”äº append, append! è¿›è¡Œæ›´å°‘çš„ç©ºé—´åˆ†é…ï¼ˆå› ä¸ºåªä¿®æ”¹æŒ‡é’ˆï¼Œå¹¶æ²¡æœ‰æ•°æ®æ‹·è´ï¼‰ï¼Œä½†å¹¶ä¸ä¸€å®šæ›´å¿«ã€‚å¦‚æœæ»¥ç”¨ï¼Œä¼šå¾ˆå®¹æ˜“å¯¼è‡´æ··ä¹±æˆ–é”™è¯¯çš„ç»“æœã€‚\n(append! \u0026#39;(a b) \u0026#39;(c d)) =\u0026gt; (a b c d) (let ([x \u0026#39;(a b)]) (append! x \u0026#39;(c d)) x) =\u0026gt; (a b c d) (append \u0026#39;(1 2 (3 4)) \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) (append \u0026#39;(1 2 (3 4)) \u0026#39;() \u0026#39;(5 6)) =\u0026gt; (1 2 (3 4) 5 6) ","id":140,"section":"posts","summary":"Pairs and Lists atom? atom? ç›¸å½“äº (lambda (x) (not (pair? x))) (atom? \u0026#39;(a b c)) â‡’ #f (atom? \u0026#39;(3 . 4)) â‡’ #f (atom? \u0026#39;()) â‡’ #t (atom? 3) â‡’ #t list-head(Chez) ç”¨æ³•ï¼š(list-head list n) næ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸”å°äºç­‰äºlistçš„é•¿åº¦","tags":["scheme"],"title":"Scheme/Chez Scheme å¯¹è±¡æ“ä½œ","uri":"https://lvsq.net/2019/12/operations-on-objects/","year":"2019"},{"content":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚\n(make-engine thunk)\né€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thunk(å½¢å®è½¬æ¢ç¨‹åº)ç»™make-engineæ¥åˆ›å»ºä¸€ä¸ªengineã€‚thunkçš„bodyæ˜¯ä¼šè¢«engineæ‰§è¡Œçš„è®¡ç®—ï¼Œengineæœ¬èº«æ˜¯å¸¦3ä¸ªå‚æ•°çš„è¿‡ç¨‹ï¼š\nticksï¼š ä¸€ä¸ªæ­£æ•´æ•°ï¼ŒæŒ‡å®šæä¾›ç»™engineçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼ˆåŸæ–‡ç”¨çš„æ˜¯fuelè¿™ä¸ªå•è¯ï¼Œæ„æ€æ˜¯ç‡ƒæ–™ï¼Œæ­£å¯¹åº”è¿™engineçš„æœ¬æ„ï¼Œååˆ†è´´åˆ‡ï¼‰çš„æ•°é‡ï¼Œengineå°†ä¼šæ‰§è¡Œåˆ°æ—¶é—´ç‰‡ç”¨å®Œæˆ–è€…è®¡ç®—å®Œæˆä¸ºæ­¢ï¼› completeï¼š ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç”¨äºæŒ‡å®šè®¡ç®—å®Œæˆåçš„æ“ä½œã€‚å®ƒçš„å‚æ•°æ˜¯å‰©ä½™çš„æ—¶é—´ç‰‡æ•°é‡å’Œè®¡ç®—äº§ç”Ÿçš„å€¼ï¼› expireï¼š ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°æŒ‡å®šå¦‚æœåœ¨è®¡ç®—å®Œæˆä¹‹å‰æ—¶é—´ç‰‡ç”¨å®Œäº†è¯¥æ€ä¹ˆåŠã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªèƒ½ä»ä¸­æ–­ç‚¹ç»§ç»­è¿›è¡Œè®¡ç®—çš„æ–°å¼•æ“ã€‚ å°†å¼•æ“åº”ç”¨äºå…¶å‚æ•°æ—¶ï¼Œå®ƒå°†å¼€å¯ä¸€ä¸ªæ—¶é•¿ä¸ºticksçš„è®¡æ—¶å™¨ï¼Œå¦‚æœå¼•æ“è®¡ç®—åœ¨è®¡æ—¶å™¨æ‰§è¡Œä¹‹å‰å®Œæˆï¼Œç³»ç»Ÿå°†è°ƒç”¨completeï¼Œå¹¶å°†å‰©ä½™çš„tickså’Œè®¡ç®—äº§ç”Ÿçš„å€¼ä¼ é€’ç»™å®ƒï¼›\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœè®¡æ—¶å™¨åœ¨å¼•æ“è®¡ç®—å®Œæˆä¹‹å‰è€—å°½äº†ï¼Œåˆ™ç³»ç»Ÿä¼šä»ä¸­æ–­è®¡ç®—çš„continuationä¸­åˆ›å»ºä¸€ä¸ªæ–°å¼•æ“ï¼Œå¹¶ä½¿è¯¥å¼•æ“è¿‡æœŸã€‚completeå’Œexpireä¼šè¢«æ–°å¼•æ“ç»§ç»­ä½¿ç”¨ã€‚If, on the other hand, the timer goes off before the engine computation completes, the system creates a new engine from the continuation of the in- terrupted computation and passes this engine to expire. complete and expire are invoked in the continuation of the engine invocation.\nçœ‹çœ‹å…·ä½“çš„ä¾‹å­ï¼š\n(define eng (make-engine (lambda () 3))) (eng 10 ;; ticks (lambda (ticks value) value) ;; complete (lambda (x) x) ;; expire ) â‡’ 3 é€šå¸¸å°†åˆ—è¡¨ä½œä¸ºå®Œæ•´è¿‡ç¨‹ä¼ é€’ç»™å¼•æ“ï¼Œä½¿å¼•æ“å®Œæˆæ—¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å‰©ä½™çš„ticksï¼Œå¦ä¸€ä¸ªå…ƒç´ æ˜¯è®¡ç®—è¿”å›çš„å€¼ï¼Œè¿™é€šå¸¸å¾ˆæœ‰ç”¨ã€‚\n(define eng (make-engine (lambda () 3))) (eng 10 list (lambda (x) x)) â‡’ (9 3) åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œè®¡ç®—å€¼ä¸º3ï¼Œè¿˜å‰©ä¸‹9ä¸ªæ—¶é—´ç‰‡ï¼Œå³ï¼Œéœ€è¦ä¸€å•ä½çš„æ—¶é—´ç‰‡æ¥è®¡ç®—å‡º3ã€‚\nå†çœ‹ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­ï¼š å…ˆå®šä¹‰ä¸€ä¸ªè®¡ç®—è£´æ³¢é‚£åˆ‡å€¼çš„å‡½æ•°\n(define fibonacci (lambda (n) (let fib ([i n]) (cond [(= i 0) 0] [(= i 1) 1] [else (+ (fib (- i 1)) (fib (- i 2)))])))) åˆ›å»ºengine\n(define eng (make-engine (lambda () (fibonacci 10)))) (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ \u0026#34;expired\u0026#34; (eng 50 list (lambda (new-eng) (set! eng new-eng) \u0026#34;expired\u0026#34;)) â‡’ (21 55) æ¯æ¬¡æ—¶é—´ç‰‡ï¼ˆç‡ƒæ–™ï¼‰ç”¨å®Œæ—¶ï¼Œåˆ°æœŸç¨‹åºéƒ½ä¼šå°†engåˆ†é…ç»™æ–°å¼•æ“ã€‚æ•´ä¸ªè®¡ç®—éœ€è¦4ä¸ªblocksï¼Œæ¯ä¸ªblockåŒ…å«50ä¸ªticksã€‚æœ€å50ä¸ªç‡ƒæ–™ä¸­ï¼Œæœ‰21ä¸ªéƒ½ç”¨æ‰äº†ã€‚å› æ­¤ï¼Œä½¿ç”¨çš„ç‡ƒæ–™æ€»é‡ä¸º179ä¸ªã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ç»Ÿè®¡ä¸€ä¸‹æ¶ˆè€—çš„ticksæ•°é‡\n(define mileage (lambda (thunk) (let loop ([eng (make-engine thunk)] [total-ticks 0]) (eng 50 (lambda (ticks . values) (+ total-ticks (- 50 ticks))) (lambda (new-eng) (loop new-eng (+ total-ticks 50))))))) (mileage (lambda () (fibonacci 10))) â‡’ 179 å†çœ‹çœ‹ä¸€ä¸ªä¾‹å­â€”â€”round-robin:\n(define round-robin (lambda (engs) (if (null? engs) \u0026#39;() ((car engs) 1 ;;ticks (lambda (ticks value) (cons value (round-robin (cdr engs)))) ;;complete (lambda (eng) ;;expire (round-robin (append (cdr engs) (list eng)))))))) (round-robin (map (lambda (x) (make-engine (lambda () (fibonacci x)))) \u0026#39;(4 5 2 8 3 7 6 2))) â‡’ (1 1 2 3 5 8 13 21) è¿™æ®µä»£ç éœ€è¦è´¹äº›æ€é‡ï¼Œé¦–å…ˆmapå‡½æ•°åˆ›å»ºäº†8ä¸ªengine, ç„¶åä»£å…¥round-robinå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¾æ¬¡æ‰§è¡Œå„ä¸ªengineï¼Œä½†æ˜¯æ¯ä¸ªengineåˆ†é…çš„æ—¶é—´ç‰‡åªæœ‰1ï¼Œå¯¹äºå‚æ•°\u0026rsquo;(4 5 2 8 3 7 6 2)ï¼Œæ•°å­—è¶Šå°ï¼Œè¶Šå…ˆæ‰§è¡Œå®Œæˆï¼Œæ‰€ä»¥è¶Šæ—©æ‰§è¡Œcompleteå‡½æ•°ï¼Œæœ€ç»ˆç»“æœå°±æ˜¯æ’å¥½é¡ºåºçš„äº†ï¼Œå¾ˆæ£’çš„ç¨‹åºï¼\n","id":141,"section":"posts","summary":"Engine(å¼•æ“)æ˜¯æ”¯æŒæ—¶é—´æŠ¢å  çš„é«˜çº§æŠ½è±¡è¿‡ç¨‹ï¼Œ å®ƒå¯è¢«ç”¨äºæ¨¡æ‹Ÿå¤šä»»åŠ¡å¤„ç†ã€å®ç°æ“ä½œç³»ç»Ÿå†…æ ¸å’Œéç¡®å®šæ€§è®¡ç®—ã€‚ (make-engine thunk) é€šè¿‡ä¼ é€’ä¸€ä¸ªæ— å‚æ•°çš„thun","tags":["engine","scheme"],"title":"Engine in Scheme","uri":"https://lvsq.net/2019/12/engine-in-scheme/","year":"2019"},{"content":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schemeæä¾›äº†caseè¯­æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œè¿™ä¸Javaä¸­çš„switchè¯­æ³•éå¸¸ç›¸ä¼¼ã€‚\næˆ‘ä»¬æ¥çœ‹çœ‹caseçš„è¯­æ³•ï¼š\n(case expr0 clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªclauseä¹‹å¤–ï¼Œæ¯ä¸ªå­å¥éƒ½å¿…é¡»é‡‡ç”¨ä»¥ä¸‹å½¢å¼ä¹‹ä¸€ï¼š\n((key \u0026hellip;) expr1 expr2 \u0026hellip;) (key expr1 expr2 \u0026hellip;) æ¯ä¸€ä¸ªkeyå€¼éƒ½åº”è¯¥æ˜¯ä¸åŒçš„ï¼Œæœ€åä¸€ä¸ªå­å¥è¦ä¹ˆæ˜¯ä¸Šè¿°é‚£ç§å½¢å¼ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªåƒä¸‹é¢è¿™æ ·çš„elseå­å¥\n(else expr1 expr2 \u0026hellip;) é‚£ä¹ˆè¿”å›å€¼æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n(define p (lambda (x) (case x [(\u0026#34;abc\u0026#34; \u0026#34;def\u0026#34;) \u0026#39;one \u0026#39;1] [((a b c)) \u0026#39;two] [else #f]))) (p (string #\\d #\\e #\\f)) â‡’ 1 (p \u0026#39;(a b c)) â‡’ two (p \u0026#34;eee\u0026#34;) â‡’ #f ä¸Šé¢çš„ä¾‹å­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°pï¼Œæ¥æ”¶ä¸€ä¸ªå‚æ•°x\nå¦‚æœxä¸ºå­—ç¬¦ä¸²\u0026quot;abc\u0026quot;æˆ–è€…\u0026quot;def\u0026quot;ï¼Œåˆ™è¿”å›1ï¼› å¦‚æœxä¸ºåˆ—è¡¨((a b c)ï¼Œåˆ™è¿”å›two å…¶ä»–æƒ…å†µè¿”å›#f å¯è§ï¼Œæœ‰äº†caseè¯­æ³•å¤šæ¡ä»¶åˆ¤æ–­å†™èµ·æ¥å°±æ–¹ä¾¿å¾ˆå¤šï¼Œå¹¶ä¸”ä»£ç ä¹Ÿå®¹æ˜“è¯»äº†ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥ç”¨condæ¥å†™ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æè¿°caseçš„è¯­æ³•è€Œæ²¡æœ‰ä½¿ç”¨cond\nå†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå°±ä¸ç”¨è§£é‡Šäº†ï¼š\n(let ([ls \u0026#39;(ii iv)]) (case (cadr ls) [i 1] [ii 2] [iii 3] [(iiii iv) 4] [else \u0026#39;out-of-range])) â‡’ 4 record-case æ¥çœ‹çœ‹å¦ä¸€ä¸ªå¾ˆç±»ä¼¼çš„æ‰©å±•ï¼Œä¹Ÿååˆ†æœ‰ç”¨ï¼Œå®ƒå°±æ˜¯record-caseã€‚å®ƒå¯ä»¥ä»¥recordä¸ºå•ä½æ¥åšæ¡ä»¶åˆ¤æ–­å¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚\nè¯­æ³•æ ¼å¼ï¼š (record-case expr clause1 clause2 \u0026hellip;)\né™¤äº†æœ€åä¸€ä¸ªå­å¥ä¹‹å¤–ï¼Œæ¯ä¸ªclauseçš„æ ¼å¼å¦‚ä¸‹ï¼š\n((key \u0026hellip;) formals body1 body2 \u0026hellip;)\næ¯ä¸€ä¸ªkeyéƒ½ä¸åº”è¯¥ç›¸åŒ, æœ€åä¸€ä¸ªclauseå¯èƒ½æ˜¯ä¸Šè¿°çš„æ ¼å¼æˆ–è€…æ˜¯ä¸€ä¸ªelseå­å¥ï¼š\n(else body1 body2 \u0026hellip;)\nexprå¿…é¡»æ˜¯ä¸€ä¸ªpairã€‚Chezä¼šæ‹¿(car expr)ä¸å„ä¸ªå­å¥ä¸­çš„keyè¿›è¡Œæ¯”è¾ƒï¼ˆç”¨eqv?ï¼‰æ¥ç¡®å®šå“ªä¸€ä¸ªclauseåŒ¹é…, ç„¶å(cdr expr)å°†ä¸formalsç»‘å®šã€‚\næ¥çœ‹æ¢ä¸€ä¸ªä¾‹å­ï¼š\n(define calc (lambda (x) (record-case x [(add) (x y) (+ x y)] [(sub) (x y) (- x y)] [(mul) (x y) (* x y)] [(div) (x y) (/ x y)] [else (assertion-violationf \u0026#39;calc \u0026#34;invalid expression ~s\u0026#34; x)]))) (calc \u0026#39;(add 3 4)) =\u0026gt; 7 (calc \u0026#39;(div 3 4)) =\u0026gt; 3/4 ","id":142,"section":"posts","summary":"case SchemeåŸç”Ÿæä¾›äº†ifè¯­æ³•ï¼Œç”¨äºåˆ¤æ–­ååˆ†ä¾¿åˆ©ï¼Œä½†æ˜¯å¯¹äºæŸäº›å¤šäºä¸€ä¸ªçš„æ¡ä»¶ï¼Œå°±åªèƒ½åµŒå¥—å†™ifæ¥å®ç°äº†ï¼Œå†™èµ·æ¥æœ‰äº›ä¸ä¾¿ï¼ŒChez Schem","tags":["chez","scheme"],"title":"Chez Schemeä¸­çš„caseæ‰©å±•","uri":"https://lvsq.net/2019/12/case-in-chez-scheme/","year":"2019"},{"content":" æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´è‡³ï¼Œå…‹å°½å…¶ç”¨ï¼Œä¸Šä¸‹ä¸€ä½“ï¼Œä¿±ä¸å€¦è€Œäº‹å¯æ¯•çŸ£\nå‘¨äº‘æˆåº·ï¼Œæ±‰è¨€æ–‡æ™¯ã€‚æ— æœ‰å…­åå¹´ä¸æ°‘ä¼‘æ¯ï¼Œç´¯è—è“„ç§¯ï¼Œæ±‰æ­¦å¼€ç–†ä¹‹åŠŸä¾¿æ˜¯ç©ºæ–‡ï¼Œæ­¤åšç§¯è–„å‘è€³ï¼Œä¿—è¯­è¨€ï¼Œèƒ³è†Šæ”¶å›æ¥ï¼Œæ‰“å‡ºå»æ‰æœ‰åŠ›\næ­¦å¸ä¸€ä»£é›„ä¸»ï¼Œæ–‡æ²»æ­¦åŠŸï¼Œå¥‹é«˜ç¥–ä¹‹ä½™çƒˆï¼Œæ‰¿ä¸‰ç‹ä¹‹åœ£ç»ªï¼Œå¼€ä¸‡ä¸–ä¸æ‹”ä¹‹åŸºï¼Œå¾å›½æ–¯æ°‘ä¹‹å¹¸ï¼Œé“­è®°æ±‰é’\n","id":143,"section":"posts","summary":"æ˜“ç»æ›°ï¼šé€šå…¶å˜ï¼Œä½¿æ°‘ä¸å€¦ã€‚å¼•é¢œå¸ˆå¤æ³¨ï¼šæ­¤æ˜“ä¸‹ç³»ä¹‹è¾ä¹Ÿï¼Œè¨€é€šç‰©ä¹‹å˜ï¼Œèƒ¡èƒ½ä¹å…¶å™¨ç”¨ï¼Œä¸è§£å€¦ä¹Ÿã€‚ä¸æ‰ç§åº¦å…¶æ„ï¼Œç™½è¯è¨€ä¹‹ï¼šäººç‰©ä¸€ç†ï¼Œåº”æ˜å…¶æ ¼ï¼Œé¡ºå…¶å…´","tags":["éšæƒ³"],"title":"ç»§å­¦å½•","uri":"https://lvsq.net/2019/12/think/","year":"2019"},{"content":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚\nå…ˆçœ‹çœ‹è¯¥è¯­æ³•æè¿°ï¼š (fluid-let ((var expr) \u0026hellip;) body1 body2 \u0026hellip;) returns: the values of the body body1 body2 \u0026hellip; libraries: (chezscheme)\nè¯¥Bindingçš„ä½œç”¨ç±»ä¼¼å±€éƒ¨å˜é‡ï¼Œä¸set! æ¯”è¾ƒç›¸ä¼¼ã€‚ç”±fluid-letå®šä¹‰çš„å˜é‡å¿…é¡»å·²ç»‘å®šåˆ°é¡¶å±‚(top level)æˆ–è€…å°é—­çš„lambdaå†…æˆ–è€…å…¶ä»–å½¢å¼çš„ç»‘å®šï¼Œè¿™å¾ˆå…³é”®ï¼\nè¯·çœ‹ä»£ç ï¼š\n(let ([x 3]) (+ (fluid-let ([x 5]) x) x)) â‡’ 8 å…ˆå®šä¹‰å˜é‡x=3ï¼Œç„¶ååœ¨åŠ æ³•æ“ä½œå½“ä¸­ä¸´æ—¶å°†xçš„å€¼æ”¹ä¸º5ï¼Œæœ€åç»“æœä¸º8ï¼Œå¦‚æœå°†fluid-letä¸­çš„xæ¢ä¸ªåå­—ï¼Œæ¯”å¦‚yï¼Œå°†å¦‚ä½•å‘¢ï¼Ÿ ä¼šå¾—åˆ°ä¸€ä¸ªå¼‚å¸¸ï¼š\nException: variable y is not bound\nyæ²¡æœ‰ç»‘å®šï¼Œæ˜¯çš„ï¼Œyå³æ²¡æœ‰åœ¨é¡¶å±‚ä¸­è¢«å®šä¹‰ï¼Œä¹Ÿæœªåœ¨æŸä¸ªlambdaä¸­æˆ–è€…ä»»ä½•å…¶ä»–å½¢å¼ï¼Œè¿™é‡Œåªèƒ½æ˜¯x\nå†å­¦ä¹ ä¸‹ä¸¤ä¸ªä¾‹å­ï¼ŒåŠ æ·±å°è±¡ï¼š\n(let ([x \u0026#39;a]) (letrec ([f (lambda (y) (cons x y))]) (fluid-let ([x \u0026#39;b]) (f \u0026#39;c)) )) â‡’ (b . c) (let ([x \u0026#39;a]) (call/cc (lambda (k) (fluid-let ([x \u0026#39;b]) (letrec ([f (lambda (y) (k \u0026#39;*))]) (f \u0026#39;*))))) x) â‡’ a Fluid Bindingå®é™…ä¸Šæ˜¯Schemeå¯¹Dynamic Scopingçš„ä¿ç•™ï¼ŒSchemeä½¿ç”¨çš„æ˜¯Lexical Scopingï¼Œ å¯¹äºè¿™ä¸¤ç§Scopingæ›´è¯¦ç»†çš„æè¿°å¯å‚è€ƒLexical Scoping and Dynamic Scoping\n","id":144,"section":"posts","summary":"Fluid Bindingæ˜¯Chezå¦ä¸€ä¸ªæ‰©å±•ï¼Œè¿™ä¸ªåè¯ä¸å¤ªå¥½ç¿»è¯‘ï¼Œæˆ‘æƒ³æƒ³æš‚æ—¶å°±å«æ˜“å˜ç»‘å®šå§ï¼Œå¦‚æœæœ‰æ›´å¥½çš„ç¿»è¯‘è¯·åœ¨æ–‡åçš„è¯„è®ºä¸­å°½æƒ…å‘è¡¨ã€‚ å…ˆçœ‹çœ‹è¯¥è¯­æ³•æ","tags":["fluid-let","Scheme"],"title":"Fluid Binding in Chez Scheme","uri":"https://lvsq.net/2019/12/fluid-binding/","year":"2019"},{"content":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚\nè¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec var expr) syntax returns: value of expr libraries: (chezscheme)\nThe syntactic form rec creates a recursive object from expr by establishing a binding of var within expr to the value of expr. In essence, it is a special case of letrec for self-recursive objects.\nThis form is useful for creating recursive objects (especially procedures) that do not depend on external variables for the recursion, which are sometimes undesirable because the exter-nal bindings can change. For example, a recursive procedure defined at top level depends on the value of the top-level variable given as its name. If the value of this variable should change, the meaning of the procedure itself would change. If the procedure is defined instead with rec, its meaning is independent of the variable to which it is bound.\nç®€è¦ç¿»è¯‘ä¸€ä¸‹ï¼š è¯­æ³•rec é€šè¿‡åœ¨exprä¸­å»ºç«‹varä¸exprçš„å€¼çš„ç»‘å®šï¼Œåˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™æ˜¯letrecç”¨äºè‡ªé€’å½’å¯¹è±¡çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚\nè¯­æ³•recé€šè¿‡ç»‘å®šexprä¸­åˆ›å»ºä¸€ä¸ªé€’å½’å¯¹è±¡ï¼Œç”¨æ¥ è¿™ç§å½¢å¼å¯¹äºåˆ›å»ºä¸ä¾èµ–äºå¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’çš„é€’å½’å¯¹è±¡ï¼ˆå°¤å…¶æ˜¯è¿‡ç¨‹ï¼‰å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤–éƒ¨ç»‘å®šå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥æœ‰æ—¶è¿™æ˜¯ä¸å¯å–çš„ã€‚\nçœ‹ä¸€ä¸ªä¾‹å­æ¥æ„Ÿå—ä¸€ä¸‹ï¼š ç»™å®šä¸€ä¸ªå…¨æ˜¯æ•°å­—çš„listï¼Œå¯¹äºæ¯ä¸€ä¸ªæ•°å­—nï¼Œç®—å‡º$1+2+\u0026hellip;+n$çš„å’Œï¼Œæœ€ç»ˆè¿”å›å’Œçš„list.\n(map (rec sum (lambda (x) (if (= x 0) 0 (+ x (sum (- x 1)))))) â€™(0 1 2 3 4 5)) â‡’ (0 1 3 6 10 15) å¦‚æœæ²¡æœ‰recè¯­æ³•ï¼Œç”¨letrecä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ç¨æ˜¾éº»çƒ¦ï¼Œä»£ç ä¹Ÿå¤šä¸€äº›ï¼Œæ‰€ä»¥recè¿˜æ˜¯å¾ˆå¥½ç”¨çš„\næœ€åçœ‹ä¸€ä¸‹recè¯­æ³•çš„å®šä¹‰ï¼š\n(define-syntax rec (syntax-rules () [(_ x e) (letrec ((x e)) x)])) ","id":145,"section":"posts","summary":"recè¯­æ³•æ˜¯Chez Schemeä¸­ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‰©å±•ï¼Œåœ¨ä¸ä¾èµ–å¤–éƒ¨å˜é‡è¿›è¡Œé€’å½’æ—¶å°†å¾ˆæœ‰ç”¨ï¼Œå¯ä»¥å‡è½»ä»£ç ä¸”ä½¿ä»£ç æ›´åŠ å®¹æ˜“é˜…è¯»ã€‚ è¿™æ˜¯è¯­æ³•æè¿°ï¼š (rec","tags":["Scheme","Chez","rec"],"title":"Recursive Bindings in Chez Scheme","uri":"https://lvsq.net/2019/12/recursive-bindings/","year":"2019"},{"content":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›æ—¶é—´ï¼ŒåŠ¨æ‰‹å†™äº†ä¸€ä¸ªï¼Œç›®å‰å·²ç»åœ¨å…¬å¸å†…éƒ¨è¿è¡Œäº†å‡ å¹´ï¼Œæ•ˆæœè‰¯å¥½ï¼Œå¹¶ä¸”å·²ç»å¼€æºåœ¨Githubä¸Šï¼Œä»¥é£¨å„ä½ã€‚\nç‰¹ç‚¹ï¼š\nAPIç®€æ´\næ”¯æŒ3ç§äº‹ä»¶ï¼š\nUP DOWN JOIN åŸºäºVert.X\nå¼•å…¥ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;net.lvsq\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jgossip\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\nint gossip_port = 60001; String cluster = \u0026#34;gossip_cluster\u0026#34;; GossipSettings settings = new GossipSettings(); settings.setGossipInterval(1000); try { String myIpAddress = InetAddress.getLocalHost().getHostAddress(); List\u0026lt;SeedMember\u0026gt; seedNodes = new ArrayList\u0026lt;\u0026gt;(); SeedMember seed = new SeedMember(); seed.setCluster(cluster); seed.setIpAddress(myIpAddress); seed.setPort(60001); seedNodes.add(seed); gossipService = new GossipService(cluster, myIpAddress, gossip_port, null, seedNodes, settings, (member, state) -\u0026gt;System.out.println(\u0026#34;member:\u0026#34; + member + \u0026#34; state: \u0026#34; + state)); } catch (Exception e) { e.printStackTrace(); } gossipService.start(); è¯¦ç»†ä»‹ç»è¯·çœ‹ =\u0026gt; é¡¹ç›®åœ°å€\næ¬¢è¿å¤§å®¶forkï¼Œ å¦‚æœè§‰å¾—å¥½è¯·start ~~~\n","id":146,"section":"posts","summary":"Gossipæ˜¯ä¸€ç§ä¸€è‡´æ€§åè®®ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å½“ä¸­æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œç½‘ä¸Šæœ‰ä¸€äº›å¼€æºå®ç°ï¼Œä½†æ˜¯å¹¶ä¸å¥½ç”¨æœ‰äº›ç”šè‡³å‡ºç°äº†ä¸€äº›bugï¼Œäºæ˜¯ä¹ï¼ŒèŠ±äº†ä¸€äº›","tags":["jgossip","gossip"],"title":"Jgossip - gossipåè®®çš„å¼€æºå®ç°","uri":"https://lvsq.net/2019/12/jgossip/","year":"2019"},{"content":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ \nGolangçš„å®ç°ï¼š\n/** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result := \u0026amp;ListNode{} nodes := []*ListNode{} var carry = 0 for { node, c := add(l1, l2, carry) carry = c if node != nil { nodes = append(nodes, node) if l1 != nil \u0026amp;\u0026amp; l1.Next != nil { l1 = l1.Next } else { l1 = nil } if l2 != nil \u0026amp;\u0026amp; l2.Next != nil { l2 = l2.Next } else { l2 = nil } if carry \u0026gt; 0 \u0026amp;\u0026amp; (l1 == nil \u0026amp;\u0026amp; l2 == nil) { nodes = append(nodes, \u0026amp;ListNode{Val:carry}) } } else { break } } for i, n := range nodes{ if i == 0 { result = n } if i + 1 \u0026lt; len(nodes) { n.Next = nodes[i + 1] } } return result } func add (n1 *ListNode, n2 *ListNode, carry int) (*ListNode, int) { node := \u0026amp;ListNode{} if (n1 == nil \u0026amp;\u0026amp; n2 == nil) { return nil, 0 } if n1 == nil { n1 = \u0026amp;ListNode{Val : 0} } if n2 == nil { n2 = \u0026amp;ListNode{Val : 0} } sum := n1.Val + n2.Val + carry carry = 0 if sum \u0026gt; 9 { carry = 1 sum = sum - 10 } node.Val = sum return node, carry } ä¸‹é¢æä¾›Schemeç‰ˆæœ¬çš„å®ç°ã€(1 0) + (9 1 2) = (0 2 2)ã€‘ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œä¸é¢˜ç›®è¦æ±‚ç¨æœ‰ä¸åŒï¼Œè¿™é‡Œé‡‡ç”¨listï¼Œè€Œä¸æ˜¯é¢˜ç›®è¦æ±‚çš„é“¾è¡¨ï¼Œä½†å®é™…ä¸Šåº”æ˜¯ä¸€æ ·çš„ã€‚æ¯”è¾ƒä¹‹ä¸‹å¯ä»¥çœ‹å‡ºï¼Œç›¸å¯¹è€Œè¨€ï¼ŒSchemeè¯­è¨€çš„å®ç°æ›´åŠ ç®€çŸ­ä¼˜é›…ï¼Œå¾—ç›Šäºå…¶å¼ºå¤§çš„è¡¨è¾¾èƒ½åŠ›\n(letrec ( [Polishing (lambda (l num) (if (eq? num 0) l (Polishing (append l \u0026#39;(0)) (- num 1))) ) ] [Align (lambda (l1 l2) (let ([len1 (length l1)] [len2 (length l2)]) (if [eq? len1 len2] [list l1 l2] [if (\u0026gt; len1 len2) (list l1 (Polishing l2 (- len1 len2))) (list (Polishing l1 (- len2 len1)) l2)])) ) ] [Add (lambda (l1 l2) (let ([ l (Align l1 l2)]) (Carry (map (lambda (x y) (+ x y)) (car l) (cadr l)) 0) ) ) ] [Carry (lambda (l c) (if (null? l) (if [eq? c 0] \u0026#39;() [cons c l]) (cons (mod ( + (car l) c ) 10) (Carry (cdr l) (quotient ( + (car l) c) 10))) ) ) ]) (Add \u0026#39;(1 0) \u0026#39;(9 1 2))) Golangç‰ˆæœ¬å’ŒSchemeç‰ˆæœ¬çš„å®ç°æ€è·¯ä¸ç›¸åŒï¼Œç®€è¦æè¿°ä¸€ä¸‹åè€…ï¼š\n(1 0) + (9 1 2), å…ˆè¿›è¡Œè¡¥ä½ï¼š (1 0 0) + (9 1 2), æŒ‰é¡ºåºç›¸åŠ ï¼Œå¾—ï¼š (10 1 2), å†è®¡ç®—è¿›ä½ï¼š (0 2 2) ","id":147,"section":"posts","summary":"æœ¬æ–‡åœ¨äºè§£ç­”LeetCodeä¸­çš„ç¬¬äºŒé¢˜ï¼Œé—®é¢˜çš„æè¿°å¯å‚è§ ä¸¤æ•°ç›¸åŠ  Golangçš„å®ç°ï¼š /** * Definition for singly-linked list. * type ListNode struct { * Val int * Next *ListNode * } */ func addTwoNumbers(l1 *ListNode, l2 *ListNode) *ListNode { result","tags":["Scheme","leetcode"],"title":"ä¸¤æ•°ç›¸åŠ ","uri":"https://lvsq.net/2019/12/leetcode-2/","year":"2019"},{"content":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘ã€‚\né—®é¢˜æè¿° å‡è®¾æˆ‘ä»¬å·²ç»æœ‰è¶³å¤Ÿå¤šçš„1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†é’±å¸ï¼Œä»»æ„ç»™å®šé‡‘é¢æ¯”å¦‚1å…ƒï¼Œé—®æœ‰å¤šå°‘ç§ç»„åˆæ–¹å¼ï¼Ÿ æ¢è¨€ä¹‹ï¼Œ$$1x+2y+5z = 100$$ æ±‚x,y,zçš„è§£æœ‰å¤šå°‘ä¸ª\næ€è·¯ ç»„åˆæ–¹å¼çš„æ€»å’Œåº”ä¸ºï¼š\nä»»æ„æ‰£å»ä¸€ç§é’±å¸æ¯”å¦‚1åˆ†ï¼Œ1å…ƒé‡‡ç”¨2åˆ†ï¼Œ5åˆ†ä¸¤ç§é’±å¸çš„ç»„åˆæ•°ï¼Œå†åŠ ä¸Šï¼š\næ€»é¢ä¸ºï¼ˆ1å…ƒ-1åˆ†ï¼‰ï¼Œé‡‡ç”¨1åˆ†ï¼Œ2åˆ†ï¼Œ5åˆ†ä¸‰ç§é’±å¸çš„ç»„åˆæ•°ï¼›\nå¾ˆæ˜æ˜¾è¿™å¯ä»¥å¾ˆå®¹æ˜“ç”¨é€’å½’å®ç°\nç¨ä½œä¸€ç‚¹è§£é‡Šï¼š\na. ä¸Šé¢ä¸¤æ­¥çš„æ„æ€æ˜¯ï¼šä¸å¸¦1åˆ†çš„ç»„åˆæ•° + å¸¦1åˆ†çš„ç»„åˆæ•° = å…¨éƒ¨çš„ç»„åˆæ•°ï¼› è¿™æ˜¯æ˜¾è€Œæ˜“è§çš„\nb. ä¸Šè¿°ç¬¬2æ­¥ï¼Œï¼ˆ1å…ƒ-1åˆ†ï¼‰çš„æ„æ€æ˜¯ï¼šè¿™æ ·å¯ä»¥ä¿è¯ä»»æ„ä¸€ç§ç»„åˆæ–¹å¼å†åŠ 1åˆ†éƒ½ç­‰äº1å…ƒï¼Œä¿è¯è‡³å°‘æœ‰1ä¸ª1åˆ†çš„é’±å¸\n(letrec [ (A (lambda (n d) (if (= 0 (mod n d)) 1 0))) (B (lambda (n d) (cond [(not (pair? d)) 0] [(null? d) 0] [(= 0 n) 1] [(\u0026gt; 0 n) 0] [(= 1 (length d)) (A n (car d))] [else ( + (B n (cdr d)) (B (- n (car d)) d)) ] ) ) ) ] [B 100 \u0026#39;(1 2 5)] ) ","id":148,"section":"posts","summary":"æœ€è¿‘åŒäº‹å‚åŠ å…¬å¸çš„é»‘å®¢ç«èµ›ï¼Œæœ‰ä¸€é“é¢˜ç›®ä¸é’±å¸ç»„åˆé—®é¢˜æ¯”è¾ƒåƒï¼Œè®°å¾—SICPé‡Œé¢æœ‰æ‰€æè¿°ï¼Œæ­£å¥½ä¸æ˜¯å¾ˆå¿™ï¼Œå°±è¯•ç€å®ç°è¯¥ç®—æ³•ï¼Œç”¨Schemeè¯­è¨€å¼€å‘","tags":["Scheme","SICP"],"title":"é’±å¸ç»„åˆé—®é¢˜","uri":"https://lvsq.net/2019/12/count-coins/","year":"2019"},{"content":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quot;x-\u0026quot;ï¼‰è¯¥å¦‚ä½•å¼€å‘åšç´§è¦çš„ä»‹ç»ã€‚\nä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œæœ‰ä¸€ç‚¹éœ€è¦keep in mindï¼Œå³å¢åŠ æ‰©å±•çš„ä½ç½®ä¸åŒï¼Œæ‰€ç”¨çš„æ–¹æ³•ä¸åŒï¼Œæ‰€ä»¥éœ€è¦å¯¹Swaggerçš„æ ‡å‡†æœ‰æ‰€äº†è§£ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ springfoxç›®å‰åªå…è®¸ä¸‰ç§æ‰©å±•å®ç°:\nListVendorExtension:åˆ—è¡¨çš„å½¢å¼,è¯¥å¯¹è±¡æ”¯æŒæ³›å‹ï¼Œæœ€ç»ˆå½¢å¼ï¼šâ€x-fieldâ€:[{field:value}] ObjectVendorExtension:å¯¹è±¡çš„æ‰©å±•å½¢å¼,æœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯ï¼šâ€x-fieldâ€:[{field:value}] StringVendorExtension:stringç±»å‹çš„æ‰©å±•å®ç°ï¼Œæœ€ç»ˆçš„æ‰©å±•å½¢å¼æ˜¯â€x-fieldâ€:â€valueâ€ Swaggeræ ¹å¯¹è±¡æ‰©å±• ä»¥åœ¨infoä¸­æ·»åŠ ä¸€ä¸ªx-logoä¸ºä¾‹\n\u0026#34;info\u0026#34;: { \u0026#34;description\u0026#34;: \u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0\u0026#34;, \u0026#34;title\u0026#34;: \u0026#34;swagger-bootstrap-uiï¼ï¼ï¼\u0026#34;, \u0026#34;termsOfService\u0026#34;: \u0026#34;http://www.xxx.com/\u0026#34;, \u0026#34;contact\u0026#34;: { \u0026#34;name\u0026#34;: pxxxx@domain.com\u0026#34; }, \u0026#34;x-logo\u0026#34;: { \u0026#34;url\u0026#34;: \u0026#34;http://\u0026#34;, \u0026#34;color\u0026#34;: \u0026#34;#090807\u0026#34; } }, ... åå°ä»£ç ï¼š\nObjectVendorExtension logo = new ObjectVendorExtension(\u0026#34;x-logo\u0026#34;); logo.addProperty(new StringVendorExtension(\u0026#34;url\u0026#34;, \u0026#34;https://xxx.svg\u0026#34;)); logo.addProperty(new StringVendorExtension(\u0026#34;color\u0026#34;, \u0026#34;#090807\u0026#34;)); return new ApiInfoBuilder() .title(\u0026#34;swagger-bootstrap-uiï¼ï¼\u0026#34;) .extensions(Lists.newArrayList(logo)) .description(\u0026#34;\u0026lt;div style=\u0026#39;font-size:14px;color:red;\u0026#39;\u0026gt;swagger-bootstrap-ui-demo RESTful APIs\u0026lt;/div\u0026gt;\u0026#34;) .termsOfServiceUrl(\u0026#34;http://www.xxx.com/\u0026#34;) .version(\u0026#34;1.0.0\u0026#34;) .build(); å†…éƒ¨å¯¹è±¡æ‰©å±• ç»™Pathæ·»åŠ ä¸€ä¸ªæ‰©å±•å±æ€§x-orderä¸ºä¾‹\n@Component @Order(Ordered.HIGHEST_PRECEDENCE+100) public class OperationPositionBulderPlugin implements OperationBuilderPlugin { @Override public void apply(OperationContext context) { context.operationBuilder().extensions(Lists.newArrayList(new StringVendorExtension(\u0026#34;x-order\u0026#34;,\u0026#34;1\u0026#34;))); } @Override public boolean supports(DocumentationType delimiter) { return true; } } è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ\n","id":149,"section":"posts","summary":"Swaggeræˆ–è€…å«OpenAPIæ˜¯ä¸€å¥—å®Œå¤‡ä¸”é€šç”¨çš„APIæ ‡å‡†ï¼Œæœ¬æ–‡å¹¶ä¸ä»‹ç»Swaggerçš„ç”¨æ³•ï¼Œä»…é’ˆå¯¹æŸäº›åœºæ™¯éœ€è¦æ‰©å±•ï¼ˆæ‰©å±•éœ€è¦ä»¥\u0026quo","tags":["swagger","vendorExtensions"],"title":"Swagger å¦‚ä½•ä½¿ç”¨vendorExtensionsè¿›è¡Œæ‰©å±•","uri":"https://lvsq.net/2019/11/swagger-vendor/","year":"2019"},{"content":" ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹ï¼Œå¦‚å¹³åŸå›å¹¿çº³å¼‚å›½å®¾å®¢ï¼›è‹ç§¦ä¸Šä¹¦äºä¸ƒå›½ï¼›è€å­éæ¸¸å¤©ä¸‹è€…çš†å¯è¯å„å›½æ–‡å­—å¹¶æ— å¤§ä¹–ã€‚ ã€Šå²ç±€ç¯‡ã€‹æ–‡é¦–ç›–äº‘â€œå¤ªå²ç±€ä¹¦â€ï¼Œäººå¤šè¯¯ä»¥å¤ªå²ç±€æ‰€ä½œï¼Œå¦‚æ­¤ä¾¿æœ›æ–‡ç”Ÿä¹‰äº†ã€‚å¤ªå²ä¹ƒå®˜èŒï¼Œç‹å›½ç»´å…ˆç”Ÿå¼•ã€Šè¯´æ–‡ã€‹è§£é‡Šï¼Œç±€å³è¯»ï¼Œè¯»å³ç±€ä¹¦ã€‚å¦å¤ªå²ç±€ä¹¦ä¹ƒå‘¨ä¸–ä¹‹æˆè¯­ï¼Œç»éäººåã€‚ è¿‘æ—¥å¾—é—»æ±‰æ–‡å¸éœ¸é™µè¢«å‘ç°ï¼Œè‡ªå…ƒä»¥é™ï¼Œè°¬ä¼ éœ¸é™µåœ¨å‡¤å‡°å˜´ï¼Œå¦‚ä»Šå¾—ä»¥ç¡®è®¤ï¼Œæ­¤æ¡ˆç»ˆäºå‹¾é”€ã€‚ã€Šæ±‰ä¹¦.æ–‡å¸çºªã€‹è½½ï¼šâ€œä¹™å·³ï¼Œè‘¬éœ¸é™µâ€ã€‚å‡¤å‡°å˜´ä¹Ÿå¥½ï¼Œæ±Ÿæ‘ä¹Ÿç½¢ï¼Œåœ¨å²ä¹¦ä¸Šåªæ˜¯ä¸€è¡Œå­—ã€‚å‘¨çŸ¥å…¬å…ƒå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå½“æ—¶æœ‰ä¸ªâ€œå«å›½â€å¹¶æœªç»Ÿä¸€ï¼Œä½†æ˜¯å²ä¹¦ä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œå‰221å¹´ï¼Œç§¦å§‹çš‡ç»Ÿä¸€å…­å›½ï¼Œå«å›½é™¤å¤–ã€‚â€ï¼›960å¹´ï¼Œå®‹æœç»Ÿä¸€ä¸­åŸï¼Œä½†æ˜¯ç°åœ¨çš„æ±Ÿæµ™åœ°åŒºè¿˜å­˜åœ¨ä¸€ä¸ªâ€œå´è¶Šå›½â€ï¼Œè¿‡äº†18å¹´æ‰çŒ®åœŸå…¥å®‹ï¼Œå²ä¹¦ä¹Ÿä¸ä¼šè¿™ä¹ˆå†™ï¼šâ€œ960å¹´ï¼Œå®‹æœ‰ä¸­å›½ï¼Œå´è¶Šé™¤å¤–â€ã€‚å«å›½å’Œå´è¶Šéƒ½åªæ˜¯å²ä¹¦ä¸Šçš„ä¸€è¡Œå­—ï¼Œè¿™å°±æ˜¯å†å²çš„çœ‹æ³•ã€‚1949å¹´ï¼Œå…±äº§å…šç»Ÿä¸€äº†ä¸­å›½ï¼Œå°æ¹¾å­¤æ‚¬ä¸€éš…ï¼Œå…¶å¤„å¢ƒå’Œå‰è€…æ¯”ç…§å¹¶æ— äºŒè‡´ï¼Œå°†æ¥å²ä¹¦ä¸Šçš„å°æ¹¾ä¹Ÿåªæ˜¯ä¸€è¡Œå­—ã€‚ ","id":150,"section":"posts","summary":"ç§¦å§‹çš‡å³å¾—å¤©ä¸‹ï¼ŒåŒåº¦é‡è¡¡ï¼Œçš†å› å„å›½å·®åˆ«å¤ªå¤§ï¼Œæ­¤ç§è¯´æ³•å¤šè§äºå†å²è¯¾æœ¬ï¼Œä½†æœ‰é—®é¢˜ã€‚æœ‰æˆè¯­å«æœç§¦æš®æ¥šï¼Œå¦‚è‹¥å·®å¼‚å¤ªå¤§ï¼Œå¿…éš¾å»ç§¦é€‚æ¥šã€‚å‘¨å§¬ä»¥æœ«äº¤é€šæ®·ç¹","tags":["æ–‡å²"],"title":"å†å²ä¸èƒ½ç¢°","uri":"https://lvsq.net/2019/11/do-not-touch-history/","year":"2019"},{"content":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»åŠ¨8ä¸ªå­—ç¬¦ C-x C-f æŸ¥æ‰¾æˆ–è€…æ–°å»ºä¸€ä¸ªæ–‡ä»¶ C-x C-b åˆ—å‡ºç¼“å†²åŒºã€‚ C-x 1 å…³é—­ç¼“å†²åŒºåˆ—è¡¨ã€‚å°†éœ€è¦åˆ é™¤çš„ç¼“å†²åŒºæ ‡â€œdâ€(é€‰ä¸­ï¼ŒæŒ‰d),ç„¶åæŒ‰â€œxâ€æ‰§è¡Œåˆ é™¤æ ‡è®°çš„æ‰€æœ‰ç¼“å†²åŒº C-x b åˆ‡æ¢ç¼“å†²åŒºï¼Œè¾“å…¥ç¼“å†²åŒºåå­—ï¼ŒRET C-x C-q å¼€å¯æˆ–è€…å…³é—­bufferçš„åªè¯»æ¨¡å¼ C-x k å…³é—­å½“å‰ç¼“å†²åŒº C-x C-s ä¿å­˜å½“å‰æ–‡ä»¶ C-x s ä¿å­˜æ‰€æœ‰æ–‡ä»¶ C-x h å…¨é€‰ M-w å¤åˆ¶ C-y ç²˜è´´ C-w å‰ªåˆ‡ C-s å¾€å‰æœç´¢ C-r å¾€åæœç´¢. DEL ä¹Ÿå¯ä»¥å¾€åæœç´¢ï¼Œ C-/ undo M-x calendar æ‰“å¼€æ—¥å†ã€‚æŒ‰ q é€€å‡ºã€‚ã€g d åˆ°æŒ‡å®šæ—¥æœŸã€‘ã€. åˆ°ä»Šæ—¥ï¼ˆä¸å±…ä¸­ï¼‰ã€‘ã€\u0026gt; å‰ä¸€ä¸ªæœˆã€‘ã€\u0026lt; åä¸€ä¸ªæœˆã€‘ M-x *-mode é€‰æ‹©Major mode M-x shell è¿è¡Œä¸€ä¸ªshell M-x eshell è¿è¡Œä¸€ä¸ªeshell C-a ç§»åˆ°è¡Œé¦– C-a C-kã€C-S-backspace åˆ é™¤æ•´è¡Œ C-u 5 C-S-backspaceã€M-5 C-S-backspace åˆ é™¤å5è¡Œï¼Œä¸åŠ æ•°å­—åˆ™åˆ é™¤4è¡Œï¼ˆé»˜è®¤ï¼‰ï¼Œå¦‚æœæ•°å­—ä¸ºè´Ÿæ•°ï¼Œåˆ™å¾€å‰åˆ  C-g åœæ­¢å½“å‰çš„å‘½ä»¤ C-k åˆ é™¤ä»å…‰æ ‡ä½ç½®åˆ°è¡Œå°¾æ‰€æœ‰å­—ç¬¦ M-% æŸ¥æ‰¾åŠæ›¿æ¢ã€‚è¾“å…¥è¦è¢«æ›¿æ¢çš„è¯ï¼Œå›è½¦ï¼Œç„¶åè¾“å…¥è¦æ›¿æ¢çš„è¯ï¼Œå†å›è½¦ã€‚è¾“å…¥==y==æ›¿æ¢å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==n==å¿½ç•¥å¹¶è·³åˆ°ä¸‹ä¸€ä¸ªï¼Œè¾“å…¥==q==ç»“æŸï¼Œ è¾“å…¥ ==!== æ›¿æ¢å‰©ä¸‹çš„å…¨éƒ¨ M-x occur RET xxx RET æ–°å¼€ä¸€ä¸ªçª—å£æ¥åˆ—å‡ºåŒ¹é…çš„è¡Œï¼Œç‚¹å‡»å°±ä¼šè·³è½¬åˆ°å¯¹åº”çš„ä½ç½®ï¼Œç¼–ç¨‹æ—¶æœ‰ç”¨ C-x C-t å½“å‰è¡Œä¸ä¸Šä¸€è¡Œæ¢ä½ç½® Org-Mode å¿«æ·é”® ç”¨é€” C-c . æ’å…¥æ—¶é—´ C-c C-e å¯¼å‡ºå…¶å®ƒæ ¼å¼ C-c C-s åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==SCHEDULED==â€å…³é”®å­—çš„æ—¶é—´æˆ³ã€‚ C-c C-d åœ¨æ ‡é¢˜ä¸‹é¢æ’å…¥ä¸€ä¸ªå¸¦æœ‰â€œ==DEADLINE==â€å…³é”®å­—çš„æ—¶é—´æˆ³ C-c C-t å°†å½“å‰é¡¹çš„çŠ¶æ€åœ¨ï¼ˆunmarkedï¼‰-\u0026gt;TODO-\u0026gt;DONE ä¹‹é—´å¾ªç¯åˆ‡æ¢ M-RET æ’å…¥ä¸€ä¸ªåŒçº§æ ‡é¢˜ M-LEFT/RIGHT å°†å½“å‰çš„æ ‡é¢˜æå‡/é™ä½ä¸€ä¸ªç­‰çº§ C-c C-c æ’å…¥æ ‡ç­¾tagã€‚ å…‰æ ‡åœ¨æ ‡é¢˜ä¸­ C-c C-q æ’å…¥æ ‡ç­¾tagã€‚å…‰æ ‡åœ¨ä»»æ„ä½ç½® C-c , è®¾ç½®å½“å‰æ ‡é¢˜çš„ä¼˜å…ˆçº§,â€™Aâ€˜ã€â€™Bâ€˜å’Œâ€™Câ€˜ã€‚â€™Aâ€˜æ˜¯æœ€é«˜çº§åˆ«ï¼Œå¦‚ä¸æŒ‡å®šï¼Œâ€™Bâ€˜æ˜¯é»˜è®¤çš„ C-c \\ æŸ¥æ‰¾æ ‡ç­¾tag S-Tab å±•å¼€æ‰€æœ‰æ ‡é¢˜ Tab å±•å¼€å…‰æ ‡æ‰€åœ¨æ ‡é¢˜ [==[== Link ==][== Description]==]== åˆ›å»ºé“¾æ¥ C-c C-l ç¼–è¾‘é“¾æ¥ C-c C-o æ‰“å¼€é“¾æ¥ C-c | (ç«–çº¿ï¼Œnot L) è¾“å…¥ åˆ— x è¡Œï¼Œ æ’å…¥ä¸€ä¸ªè¡¨æ ¼ [/] æˆ–è€… [%] é€šè¿‡åœ¨TODOé¡¹ç›®ä¸‹æ–°å»ºä¸€ä¸ªå¤§çº²æ ‘ï¼Œå¹¶åœ¨å­æ ‘ä¸Šæ ‡è®°å­ä»»åŠ¡æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ä¸ºäº†èƒ½å¯¹å·²ç»å®Œæˆçš„ä»»åŠ¡æœ‰ä¸ªå¤§è‡´çš„äº†è§£ï¼Œä½ å¯ä»¥åœ¨æ ‡é¢˜çš„ä»»ä½•åœ°æ–¹æ’å…¥â€˜[/]â€™æˆ–è€…â€˜[%]â€™ã€‚å½“æ¯ä¸ªå­ä»»åŠ¡çš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œæˆ–è€…å½“ä½ åœ¨æ ‡è®°ä¸ŠæŒ‰ C-c C-æ—¶ï¼Œè¿™äº›æ ‡è®°çŠ¶æ€ä¹Ÿä¼šéšä¹‹æ›´æ–° \u0026lt;s Tab å¼€å¯ä¸€ä¸ªä»£ç å—ã€‚ #+begin_src c -n -t -h 7 -w 40: cä¸ºæ‰€æ·»åŠ çš„è¯­è¨€,-n æ˜¾ç¤ºè¡Œå·,-t æ¸…é™¤æ ¼å¼,-h 7 è®¾ç½®é«˜åº¦ä¸º7 -w 40è®¾ç½®å®½åº¦ä¸º40 C-c ' æ‰“å¼€ä¸€ä¸ªbuffer, è¾“å…¥ä»£ç ï¼Œå†æŒ‰ä¸€æ¬¡å¿«æ·é”®ï¼Œå°†ä»£ç å†™å…¥buffer C-c C-c è¿è¡Œæºä»£ç ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªRESULTå— å†…å®¹å…ƒæ•°æ® è¯¦æƒ…è§æ–‡å Markdown-Mode å¿«æ·é”® ç”¨é€” C-c C-c p ç”Ÿæˆä¸´æ—¶æ–‡ä»¶å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-c v ç”Ÿæˆ basename.html å¹¶åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆ C-c C-a u æ’å…¥=\u0026lt;\u0026gt;=è¿™æ ·çš„é“¾æ¥ C-c C-a f æ’å…¥è„šæ³¨é“¾æ¥ C-c C-a l æ’å…¥==è¿™æ ·çš„é“¾æ¥ Org-Mode å†…å®¹å…ƒæ•°æ® å¿«æ·é”® å†…å®¹ ç”¨é€” s #+begin_src \u0026hellip; #+end_src e #+begin_example \u0026hellip; #+end_example : å•è¡Œçš„ä¾‹å­ä»¥å†’å·å¼€å¤´ q #+begin_quote \u0026hellip; #+end_quote é€šå¸¸ç”¨äºå¼•ç”¨ï¼Œä¸é»˜è®¤æ ¼å¼ç›¸æ¯”å·¦å³éƒ½ä¼šç•™å‡ºç¼©è¿› v #+begin_verse \u0026hellip; #+end_verse é»˜è®¤å†…å®¹ä¸æ¢è¡Œï¼Œéœ€è¦ç•™å‡ºç©ºè¡Œæ‰èƒ½æ¢è¡Œ c #+begin_center \u0026hellip; #+end_center l #+begin_latex \u0026hellip; #+end_latex L #+latex: h #+begin_html \u0026hellip; #+end_html H #+html: a #+begin_ascii \u0026hellip; #+end_ascii A #+ascii: i #+index: line I #+include: line ","id":151,"section":"posts","summary":"M -\u0026gt; Alt(option) S -\u0026gt; Shift å¿«æ·é”® ç”¨é€” M-v ä¸Šï¼ˆåï¼‰ä¸€å± C-v ä¸‹ï¼ˆå‰ï¼‰ä¸€å± C-x 0 å…³é—­å½“å‰çª—å£ C-l é‡ç»˜å±å¹•ï¼Œå°†å…‰æ ‡æ‰€åœ¨è¡Œç½®äºå±å¹•ä¸­å¤® C-u(M-num) é‡å¤æ‰§è¡Œã€‚C-u 8 C-f(M-8 C-u) ä¼šæŠŠå…‰æ ‡å¾€å‰ç§»","tags":["emacs"],"title":"Emacs","uri":"https://lvsq.net/2019/11/emacs/","year":"2019"}],"tags":[{"title":"About","uri":"https://lvsq.net/tags/about/"},{"title":"Chez","uri":"https://lvsq.net/tags/chez/"},{"title":"Emacs","uri":"https://lvsq.net/tags/emacs/"},{"title":"Engine","uri":"https://lvsq.net/tags/engine/"},{"title":"Erlang","uri":"https://lvsq.net/tags/erlang/"},{"title":"Fluid-Let","uri":"https://lvsq.net/tags/fluid-let/"},{"title":"Functional","uri":"https://lvsq.net/tags/functional/"},{"title":"Golang","uri":"https://lvsq.net/tags/golang/"},{"title":"Gossip","uri":"https://lvsq.net/tags/gossip/"},{"title":"Jgossip","uri":"https://lvsq.net/tags/jgossip/"},{"title":"Leetcode","uri":"https://lvsq.net/tags/leetcode/"},{"title":"Lexical","uri":"https://lvsq.net/tags/lexical/"},{"title":"Lisp","uri":"https://lvsq.net/tags/lisp/"},{"title":"Module","uri":"https://lvsq.net/tags/module/"},{"title":"Modules","uri":"https://lvsq.net/tags/modules/"},{"title":"Pl","uri":"https://lvsq.net/tags/pl/"},{"title":"Racket","uri":"https://lvsq.net/tags/racket/"},{"title":"Rec","uri":"https://lvsq.net/tags/rec/"},{"title":"Scheme","uri":"https://lvsq.net/tags/scheme/"},{"title":"Scoping","uri":"https://lvsq.net/tags/scoping/"},{"title":"SICP","uri":"https://lvsq.net/tags/sicp/"},{"title":"Swagger","uri":"https://lvsq.net/tags/swagger/"},{"title":"Syntactic","uri":"https://lvsq.net/tags/syntactic/"},{"title":"Thread","uri":"https://lvsq.net/tags/thread/"},{"title":"VendorExtensions","uri":"https://lvsq.net/tags/vendorextensions/"},{"title":"æ–‡å²","uri":"https://lvsq.net/tags/%E6%96%87%E5%8F%B2/"},{"title":"éšæƒ³","uri":"https://lvsq.net/tags/%E9%9A%8F%E6%83%B3/"}]}